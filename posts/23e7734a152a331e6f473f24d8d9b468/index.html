<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java 内存映射处理大文件 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java 内存映射处理大文件" />
<meta property="og:description" content="Java中用内存映射处理大文件 2012-06-20 14:16 tobacco5648 tobacco5648博客 字号：T |T 在处理大文件时，如果利用普通的FileInputStream 或者FileOutputStream 抑或RandomAccessFile 来进行频繁的读写操作，都将导致进程因频繁读写外存而降低速度.如下为一个对比实验。
AD： 51CTO 网&#43; 第十二期沙龙：大话数据之美_如何用数据驱动用户体验
在处理大文件时，如果利用普通的FileInputStream 或者FileOutputStream 抑或RandomAccessFile 来进行频繁的读写操作，都将导致进程因频繁读写外存而降低速度.如下为一个对比实验。
package test; import java.io.BufferedInputStream; import java.io.FileInputStream; import java.io.FileNotFoundException; import java.io.IOException; import java.io.RandomAccessFile; import java.nio.MappedByteBuffer; import java.nio.channels.FileChannel; public class Test { public static void main(String[] args) { try { FileInputStream fis=new FileInputStream(&#34;/home/tobacco/test/res.txt&#34;); int sum=0; int n; long t1=System.currentTimeMillis(); try { while((n=fis.read())&gt;=0){ sum&#43;=n; } } catch (IOException e) { // TODO Auto-generated catch block e." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/23e7734a152a331e6f473f24d8d9b468/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-25T19:59:35+08:00" />
<meta property="article:modified_time" content="2016-05-25T19:59:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java 内存映射处理大文件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="entry-header"> 
 <h2> </h2> 
 <h2><span style="font-size:14px">Java中用内存映射处理大文件</span></h2> 
 <div class="msg"> 
  <div> 
   <span style="font-size:14px">2012-06-20 14:16 tobacco5648 tobacco5648博客 <span class="f12-a"> <a target="_blank" href="#commment" rel="nofollow noopener noreferrer"></a></span>字号：<span class="f14-b"><a target="_blank" href="" rel="nofollow noopener noreferrer">T</a></span> |<span class="f16-b"><a target="_blank" href="" rel="nofollow noopener noreferrer">T</a></span></span> 
  </div> 
  <div id="books" class="artHd" style="padding-bottom:5px; padding-left:25px; padding-right:25px; padding-top:5px"> 
   <span style="font-size:14px"></span> 
  </div> 
  <div class="fav"> 
   <a target="_blank" title="一键收藏，随时查看，分享好友！" href="" rel="nofollow noopener noreferrer"><span style="font-size:14px"><img border="0" alt="一键收藏，随时查看，分享好友！" src="https://images2.imgbox.com/86/dd/jdVwBNmT_o.gif"></span></a> 
  </div> 
 </div> 
 <div class="brieftext"> 
  <p class="f14 green"><span style="font-size:14px">在处理大文件时，如果利用普通的FileInputStream 或者FileOutputStream 抑或RandomAccessFile 来进行频繁的读写操作，都将导致进程因频繁读写外存而降低速度.如下为一个对比实验。</span></p> 
  <p class="ad"><span style="font-size:14px">AD： </span><a target="_blank" href="http://mobile.51cto.com/mobile/mdsa12/" rel="nofollow noopener noreferrer" style="color:red; text-decoration:none"><span style="font-size:14px">51CTO 网+ 第十二期沙龙：大话数据之美_如何用数据驱动用户体验</span></a><span style="font-size:14px"></span></p> 
 </div> 
 <div id="indexlist" class="tag bgF8F8F8"> 
  <ul id="indexliststr"><li><span style="font-size:14px"></span> 
  </li></ul> 
  <br class="dle"> 
 </div> 
 <div class="content bgF8F8F8 f14"> 
  <div id="content"> 
   <p><span style="font-size:14px"></span></p> 
   <p><span style="font-size:14px">在处理大文件时，如果利用普通的FileInputStream 或者FileOutputStream 抑或RandomAccessFile 来进行频繁的读写操作，都将导致进程因频繁读写外存而降低速度.如下为一个对比实验。</span></p> 
   <pre>    
    <ol class="dp-j"><li class="alt"><span style="font-size:14px"><span class="keyword">package</span> test;  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.BufferedInputStream;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.io.FileInputStream;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.FileNotFoundException;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.io.IOException;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.RandomAccessFile;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.nio.MappedByteBuffer;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.nio.channels.FileChannel;  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">public</span> <span class="keyword">class</span> Test {  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px">      </span></li><li><span style="font-size:14px">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) {  </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            FileInputStream fis=<span class="keyword">new</span> FileInputStream(<span class="string">"/home/tobacco/test/res.txt"</span>);  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li><span style="font-size:14px">            <span class="keyword">try</span> {  </span></li><li class="alt"><span style="font-size:14px">                <span class="keyword">while</span>((n=fis.read())&gt;=<span class="number">0</span>){  </span></li><li><span style="font-size:14px">                    sum+=n;  </span></li><li class="alt"><span style="font-size:14px">                }  </span></li><li><span style="font-size:14px">            } <span class="keyword">catch</span> (IOException e) {  </span></li><li class="alt"><span style="font-size:14px">                <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">                e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">            }  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li class="alt"><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li class="alt"><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">            e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">        }  </span></li><li><span style="font-size:14px">          </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            FileInputStream fis=<span class="keyword">new</span> FileInputStream(<span class="string">"/home/tobacco/test/res.txt"</span>);  </span></li><li class="alt"><span style="font-size:14px">            BufferedInputStream bis=<span class="keyword">new</span> BufferedInputStream(fis);  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">                <span class="keyword">while</span>((n=bis.read())&gt;=<span class="number">0</span>){  </span></li><li class="alt"><span style="font-size:14px">                    sum+=n;  </span></li><li><span style="font-size:14px">                }  </span></li><li class="alt"><span style="font-size:14px">            } <span class="keyword">catch</span> (IOException e) {  </span></li><li><span style="font-size:14px">                <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">                e.printStackTrace();  </span></li><li><span style="font-size:14px">            }  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li class="alt"><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">            e.printStackTrace();  </span></li><li><span style="font-size:14px">        }  </span></li><li class="alt"><span style="font-size:14px">          </span></li><li><span style="font-size:14px">        MappedByteBuffer buffer=<span class="keyword">null</span>;  </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            buffer=<span class="keyword">new</span> RandomAccessFile(<span class="string">"/home/tobacco/test/res.txt"</span>,<span class="string">"rw"</span>).getChannel().map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, <span class="number">1253244</span>);  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li><span style="font-size:14px">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1253244</span>;i++){  </span></li><li class="alt"><span style="font-size:14px">                n=<span class="number">0x000000ff</span>&amp;buffer.get(i);  </span></li><li><span style="font-size:14px">                sum+=n;  </span></li><li class="alt"><span style="font-size:14px">            }  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li class="alt"><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li class="alt"><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">            e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">        } <span class="keyword">catch</span> (IOException e) {  </span></li><li><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">            e.printStackTrace();  </span></li><li><span style="font-size:14px">        }  </span></li><li class="alt"><span style="font-size:14px"> </span></li><li><span style="font-size:14px">    }  </span></li><li class="alt"><span style="font-size:14px"> </span></li><li><span style="font-size:14px">}  </span></li></ol></pre> 
   <p><span style="font-size:14px">测试文件为一个大小为1253244字节的文件。测试结果：</span></p> 
   <pre>    
    <ol class="dp-xml"><li class="alt"><span style="font-size:14px">sum:220152087 time:1464  </span></li><li><span style="font-size:14px">sum:220152087 time:72  </span></li><li class="alt"><span style="font-size:14px">sum:220152087 time:25 </span></li></ol></pre> 
   <p><span style="font-size:14px">说明读数据无误。删去其中的数据处理部分。</span></p> 
   <pre>    
    <ol class="dp-j"><li class="alt"><span style="font-size:14px"><span class="keyword">package</span> test;  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.BufferedInputStream;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.io.FileInputStream;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.FileNotFoundException;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.io.IOException;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.io.RandomAccessFile;  </span></li><li><span style="font-size:14px"><span class="keyword">import</span> java.nio.MappedByteBuffer;  </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">import</span> java.nio.channels.FileChannel;  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px"><span class="keyword">public</span> <span class="keyword">class</span> Test {  </span></li><li><span style="font-size:14px"> </span></li><li class="alt"><span style="font-size:14px">      </span></li><li><span style="font-size:14px">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) {  </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            FileInputStream fis=<span class="keyword">new</span> FileInputStream(<span class="string">"/home/tobacco/test/res.txt"</span>);  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li><span style="font-size:14px">            <span class="keyword">try</span> {  </span></li><li class="alt"><span style="font-size:14px">                <span class="keyword">while</span>((n=fis.read())&gt;=<span class="number">0</span>){  </span></li><li><span style="font-size:14px">                    <span class="comment">//sum+=n; </span> </span></li><li class="alt"><span style="font-size:14px">                }  </span></li><li><span style="font-size:14px">            } <span class="keyword">catch</span> (IOException e) {  </span></li><li class="alt"><span style="font-size:14px">                <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">                e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">            }  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li class="alt"><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li class="alt"><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">            e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">        }  </span></li><li><span style="font-size:14px">          </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            FileInputStream fis=<span class="keyword">new</span> FileInputStream(<span class="string">"/home/tobacco/test/res.txt"</span>);  </span></li><li class="alt"><span style="font-size:14px">            BufferedInputStream bis=<span class="keyword">new</span> BufferedInputStream(fis);  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">                <span class="keyword">while</span>((n=bis.read())&gt;=<span class="number">0</span>){  </span></li><li class="alt"><span style="font-size:14px">                    <span class="comment">//sum+=n; </span> </span></li><li><span style="font-size:14px">                }  </span></li><li class="alt"><span style="font-size:14px">            } <span class="keyword">catch</span> (IOException e) {  </span></li><li><span style="font-size:14px">                <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">                e.printStackTrace();  </span></li><li><span style="font-size:14px">            }  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li class="alt"><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">            e.printStackTrace();  </span></li><li><span style="font-size:14px">        }  </span></li><li class="alt"><span style="font-size:14px">          </span></li><li><span style="font-size:14px">        MappedByteBuffer buffer=<span class="keyword">null</span>;  </span></li><li class="alt"><span style="font-size:14px">        <span class="keyword">try</span> {  </span></li><li><span style="font-size:14px">            buffer=<span class="keyword">new</span> RandomAccessFile(<span class="string">"/home/tobacco/test/res.txt"</span>,<span class="string">"rw"</span>).getChannel().map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, <span class="number">1253244</span>);  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">int</span> sum=<span class="number">0</span>;  </span></li><li><span style="font-size:14px">            <span class="keyword">int</span> n;  </span></li><li class="alt"><span style="font-size:14px">            <span class="keyword">long</span> t1=System.currentTimeMillis();  </span></li><li><span style="font-size:14px">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1253244</span>;i++){  </span></li><li class="alt"><span style="font-size:14px">                <span class="comment">//n=0x000000ff&amp;buffer.get(i); </span> </span></li><li><span style="font-size:14px">                <span class="comment">//sum+=n; </span> </span></li><li class="alt"><span style="font-size:14px">            }  </span></li><li><span style="font-size:14px">            <span class="keyword">long</span> t=System.currentTimeMillis()-t1;  </span></li><li class="alt"><span style="font-size:14px">            System.out.println(<span class="string">"sum:"</span>+sum+<span class="string">"  time:"</span>+t);  </span></li><li><span style="font-size:14px">        } <span class="keyword">catch</span> (FileNotFoundException e) {  </span></li><li class="alt"><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li><span style="font-size:14px">            e.printStackTrace();  </span></li><li class="alt"><span style="font-size:14px">        } <span class="keyword">catch</span> (IOException e) {  </span></li><li><span style="font-size:14px">            <span class="comment">// TODO Auto-generated catch block </span> </span></li><li class="alt"><span style="font-size:14px">            e.printStackTrace();  </span></li><li><span style="font-size:14px">        }  </span></li><li class="alt"><span style="font-size:14px"> </span></li><li><span style="font-size:14px">    }  </span></li><li class="alt"><span style="font-size:14px"> </span></li><li><span style="font-size:14px">} </span></li></ol></pre> 
   <p><span style="font-size:14px">测试结果：</span></p> 
   <pre>    
    <ol class="dp-xml"><li class="alt"><span style="font-size:14px">sum:0 time:1458  </span></li><li><span style="font-size:14px">sum:0 time:67  </span></li><li class="alt"><span style="font-size:14px">sum:0 time:8 </span></li></ol></pre> 
   <p><span style="font-size:14px">由此可见，将文件部分或者全部映射到内存后进行读写，速度将提高很多。</span></p> 
   <p><span style="font-size:14px">这是因为内存映射文件首先将外存上的文件映射到内存中的一块连续区域，被当成一个字节数组进行处理，读写操作直接对内存进行操作，而后再将内存区域重新映射到外存文件，这就节省了中间频繁的对外存进行读写的时间，大大降低了读写时间。</span></p> 
   <p><span style="font-size:14px">原文链接：</span><a target="_blank" href="http://blog.csdn.net/tobacco5648/article/details/7679105" rel="noopener noreferrer"><span style="font-size:14px">http://blog.csdn.net/tobacco5648/article/details/7679105</span></a></p> 
  </div> 
 </div> 
 <h2><span style="font-size:14px"></span> </h2> 
 <h2> </h2> 
 <h2> </h2> 
 <h2>使用Java处理大文件</h2> 
</div> 
<div class="entry-meta"> 
 <p class="entry-meta-hide-on-mobile">2014/04/07 | 分类： <a target="_blank" title="查看 Web开发 中的全部文章" href="http://www.importnew.com/cat/web-development" rel="category tag noopener noreferrer"> <span style="color:#0099cc">Web开发</span></a> | <a target="_blank" title="《使用Java处理大文件》上的评论" href="http://www.importnew.com/10712.html#comments" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">7 条评论</span></a> </p> 
 <div class="jiathis_style" style="margin:0px; display:block; clear:both"> 
  <span class="jiathis_txt">分享到：</span> 
  <a target="_blank" class="jiathis_button_tsina" title="分享到微博"><span class="jiathis_txt jtico jtico_tsina"></span></a> 
  <a target="_blank" class="jiathis_button_weixin" title="分享到微信"><span class="jiathis_txt jtico jtico_weixin"></span></a> 
  <a target="_blank" class="jiathis_button_qzone" title="分享到QQ空间"><span class="jiathis_txt jtico jtico_qzone"></span></a> 
  <a target="_blank" class="jiathis_button_fb" title="分享到Facebook"><span class="jiathis_txt jtico jtico_fb"></span></a> 
  <a target="_blank" class="jiathis_button_renren" title="分享到人人网"><span class="jiathis_txt jtico jtico_renren"></span></a> 
  <a target="_blank" class="jiathis_button_douban" title="分享到豆瓣"><span class="jiathis_txt jtico jtico_douban"></span></a> 
  <a target="_blank" class="jiathis_button_readitlater"></a> 
  <a target="_blank" class="jiathis_button_evernote" title="分享到印象笔记"><span class="jiathis_txt jtico jtico_evernote"></span></a> 
  <a target="_blank" class="jiathis_button_ydnote" title="分享到有道云笔记"><span class="jiathis_txt jtico jtico_ydnote"></span></a> 
  <a target="_blank" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" href="http://www.jiathis.com/share?uid=1745061" rel="nofollow noopener noreferrer"></a> 
  <a target="_blank" class="jiathis_counter_style"><span id="jiathis_counter_29" class="jiathis_button_expanded jiathis_counter jiathis_bubble_style" title="累计分享29次"><span style="color:#0099cc">29</span></span></a> 
 </div> 
 <p></p> 
 <p></p> 
</div> 
<div class="entry"> 
 <div class="copyright-area">
   本文由 
  <a target="_blank" href="http://www.importnew.com/" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">ImportNew</span></a> - 
  <a target="_blank" href="http://www.importnew.com/author/songtao" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">踏雁寻花</span></a> 翻译自 
  <a target="_blank" class="external" href="http://www.javacodegeeks.com/2013/01/processing-huge-files-with-java.html" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">javacodegeeks</span></a>。欢迎加入 
  <a target="_blank" class="external" href="http://group.jobbole.com/category/feedback/trans-team/" rel="nofollow noopener noreferrer"><span style="color:#0099cc">翻译小组</span></a>。转载请见文末要求。 
 </div> 
 <p>我最近要处理一套存储历史实时数据的大文件<a target="_blank" class="external" href="http://truefx.com/?page=downloads" rel="nofollow noopener noreferrer"><span style="color:#0099cc">fx market data</span></a>，我很快便意识到，使用传统的InputStream不能够将它们读取到内存，因为每一个文件都超过了4G。甚至编辑器都不能够打开这些文件。</p> 
 <p>在这种特殊情况下，我可以写一个简单的bash脚本将这些文件分成更小的文件块，然后再读取它。但是我不想这样做，因为二进制格式会使这个方法失效。</p> 
 <p>处理这个问题的方式通常就是使用内存映射文件递增地处理区域的数据。关于内存映射文件的一个好处就是它们不会使用虚拟内存和换页空间，因为它们是从磁盘上的文件返回来的数据。</p> 
 <p>很好，让我们来看一看这些文件和额外的一些数据。似乎它们使用逗号分隔的字段包含ASCII文本行。</p> 
 <p>格式：<code>[currency-pair],[timestamp],[bid-price],[ask-price]</code></p> 
 <p>例子：<code>EUR/USD,20120102 00:01:30.420,1.29451,1.2949</code></p> 
 <p>我可以为这种格式去写一个程序，但是，读取文件和解析文件是无关的概念。让我们退一步来想一个通用的设计，当在将来面临相似的问题时这个设计可以被重复利用。</p> 
 <p>这个问题可以归结为递增地解码一个已经在无限长的数组中被编码的记录，并且没有耗尽内存。实际上，以逗号分割的示例格式编码与通常的解决方案是不相关的。所以，很明显需要一个解码器来处理不同的格式。</p> 
 <p>再来看，知道整个文件处理完成，每一条记录都不能被解析并保存在内存中，所以我们需要一种方式来转移记录，在它们成为垃圾被回收之前可以被写到其他地方，例如磁盘或者网络。</p> 
 <p>迭代器是处理这个需求的很好的抽象，因为它们就像游标一样，可以正确的指向某个位置。每一次迭代都可以转发文件指针，并且可以让我们使用数据做其他的事情。</p> 
 <p>首先来写一个Decoder 接口，递增地把对象从<a target="_blank" class="external" href="http://docs.oracle.com/javase/1.4.2/docs/api/java/nio/MappedByteBuffer.html" rel="nofollow noopener noreferrer"><span style="color:#0099cc">MappedByteBuffer</span></a>中解码，如果buffer中没有对象，则返回null。</p> 
 <div> 
  <div id="highlighter_576967" class="syntaxhighlighter notranslate java ie"> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java keyword">public</code> 
         <code class="java keyword"> interface</code> 
         <code class="java plain">Decoder&lt;T&gt; { </code> 
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">T decode(ByteBuffer buffer);</code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>然后让FileReader 实现Iterable接口。每一个迭代器将会处理下一个4096字节的数据，并使用Decoder把它们解码成一个对象的List集合。注意，FileReader 接收文件(files)的list对象，这样是很好的，因为它可以遍历数据，并且不需要考虑聚合的问题。顺便说一下，4096个字节块对于大文件来说是非常小的。</p> 
 <div> 
  <div id="highlighter_520720" class="syntaxhighlighter notranslate java ie "> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> 
       <div class="line number4 index3 alt1">
         4 
       </div> 
       <div class="line number5 index4 alt2">
         5 
       </div> 
       <div class="line number6 index5 alt1">
         6 
       </div> 
       <div class="line number7 index6 alt2">
         7 
       </div> 
       <div class="line number8 index7 alt1">
         8 
       </div> 
       <div class="line number9 index8 alt2">
         9 
       </div> 
       <div class="line number10 index9 alt1">
         10 
       </div> 
       <div class="line number11 index10 alt2">
         11 
       </div> 
       <div class="line number12 index11 alt1">
         12 
       </div> 
       <div class="line number13 index12 alt2">
         13 
       </div> 
       <div class="line number14 index13 alt1">
         14 
       </div> 
       <div class="line number15 index14 alt2">
         15 
       </div> 
       <div class="line number16 index15 alt1">
         16 
       </div> 
       <div class="line number17 index16 alt2">
         17 
       </div> 
       <div class="line number18 index17 alt1">
         18 
       </div> 
       <div class="line number19 index18 alt2">
         19 
       </div> 
       <div class="line number20 index19 alt1">
         20 
       </div> 
       <div class="line number21 index20 alt2">
         21 
       </div> 
       <div class="line number22 index21 alt1">
         22 
       </div> 
       <div class="line number23 index22 alt2">
         23 
       </div> 
       <div class="line number24 index23 alt1">
         24 
       </div> 
       <div class="line number25 index24 alt2">
         25 
       </div> 
       <div class="line number26 index25 alt1">
         26 
       </div> 
       <div class="line number27 index26 alt2">
         27 
       </div> 
       <div class="line number28 index27 alt1">
         28 
       </div> 
       <div class="line number29 index28 alt2">
         29 
       </div> 
       <div class="line number30 index29 alt1">
         30 
       </div> 
       <div class="line number31 index30 alt2">
         31 
       </div> 
       <div class="line number32 index31 alt1">
         32 
       </div> 
       <div class="line number33 index32 alt2">
         33 
       </div> 
       <div class="line number34 index33 alt1">
         34 
       </div> 
       <div class="line number35 index34 alt2">
         35 
       </div> 
       <div class="line number36 index35 alt1">
         36 
       </div> 
       <div class="line number37 index36 alt2">
         37 
       </div> 
       <div class="line number38 index37 alt1">
         38 
       </div> 
       <div class="line number39 index38 alt2">
         39 
       </div> 
       <div class="line number40 index39 alt1">
         40 
       </div> 
       <div class="line number41 index40 alt2">
         41 
       </div> 
       <div class="line number42 index41 alt1">
         42 
       </div> 
       <div class="line number43 index42 alt2">
         43 
       </div> 
       <div class="line number44 index43 alt1">
         44 
       </div> 
       <div class="line number45 index44 alt2">
         45 
       </div> 
       <div class="line number46 index45 alt1">
         46 
       </div> 
       <div class="line number47 index46 alt2">
         47 
       </div> 
       <div class="line number48 index47 alt1">
         48 
       </div> 
       <div class="line number49 index48 alt2">
         49 
       </div> 
       <div class="line number50 index49 alt1">
         50 
       </div> 
       <div class="line number51 index50 alt2">
         51 
       </div> 
       <div class="line number52 index51 alt1">
         52 
       </div> 
       <div class="line number53 index52 alt2">
         53 
       </div> 
       <div class="line number54 index53 alt1">
         54 
       </div> 
       <div class="line number55 index54 alt2">
         55 
       </div> 
       <div class="line number56 index55 alt1">
         56 
       </div> 
       <div class="line number57 index56 alt2">
         57 
       </div> 
       <div class="line number58 index57 alt1">
         58 
       </div> 
       <div class="line number59 index58 alt2">
         59 
       </div> 
       <div class="line number60 index59 alt1">
         60 
       </div> 
       <div class="line number61 index60 alt2">
         61 
       </div> 
       <div class="line number62 index61 alt1">
         62 
       </div> 
       <div class="line number63 index62 alt2">
         63 
       </div> 
       <div class="line number64 index63 alt1">
         64 
       </div> 
       <div class="line number65 index64 alt2">
         65 
       </div> 
       <div class="line number66 index65 alt1">
         66 
       </div> 
       <div class="line number67 index66 alt2">
         67 
       </div> 
       <div class="line number68 index67 alt1">
         68 
       </div> 
       <div class="line number69 index68 alt2">
         69 
       </div> 
       <div class="line number70 index69 alt1">
         70 
       </div> 
       <div class="line number71 index70 alt2">
         71 
       </div> 
       <div class="line number72 index71 alt1">
         72 
       </div> 
       <div class="line number73 index72 alt2">
         73 
       </div> 
       <div class="line number74 index73 alt1">
         74 
       </div> 
       <div class="line number75 index74 alt2">
         75 
       </div> 
       <div class="line number76 index75 alt1">
         76 
       </div> 
       <div class="line number77 index76 alt2">
         77 
       </div> 
       <div class="line number78 index77 alt1">
         78 
       </div> 
       <div class="line number79 index78 alt2">
         79 
       </div> 
       <div class="line number80 index79 alt1">
         80 
       </div> 
       <div class="line number81 index80 alt2">
         81 
       </div> 
       <div class="line number82 index81 alt1">
         82 
       </div> 
       <div class="line number83 index82 alt2">
         83 
       </div> 
       <div class="line number84 index83 alt1">
         84 
       </div> 
       <div class="line number85 index84 alt2">
         85 
       </div> 
       <div class="line number86 index85 alt1">
         86 
       </div> 
       <div class="line number87 index86 alt2">
         87 
       </div> 
       <div class="line number88 index87 alt1">
         88 
       </div> 
       <div class="line number89 index88 alt2">
         89 
       </div> 
       <div class="line number90 index89 alt1">
         90 
       </div> 
       <div class="line number91 index90 alt2">
         91 
       </div> 
       <div class="line number92 index91 alt1">
         92 
       </div> 
       <div class="line number93 index92 alt2">
         93 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java keyword">public</code> 
         <code class="java keyword"> class</code> 
         <code class="java plain">FileReader </code> 
         <code class="java keyword">implements</code> 
         <code class="java plain">Iterable&lt;List&lt;T&gt;&gt; {<!-- --></code> 
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">static</code> 
         <code class="java keyword">final</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">CHUNK_SIZE = </code> 
         <code class="java value">4096</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">final</code> 
         <code class="java plain">Decoder&lt;T&gt; decoder;</code> 
        </div> 
        <div class="line number4 index3 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">Iterator&lt;File&gt; files;</code> 
        </div> 
        <div class="line number5 index4 alt2"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number6 index5 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">FileReader(Decoder&lt;T&gt; decoder, File... files) {<!-- --></code> 
        </div> 
        <div class="line number7 index6 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">(decoder, Arrays.asList(files));</code> 
        </div> 
        <div class="line number8 index7 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number9 index8 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">FileReader(Decoder&lt;T&gt; decoder, List&lt;File&gt; files) {<!-- --></code> 
        </div> 
        <div class="line number10 index9 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.files = files.iterator();</code> 
        </div> 
        <div class="line number11 index10 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.decoder = decoder;</code> 
        </div> 
        <div class="line number12 index11 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number13 index12 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">static</code> 
         <code class="java plain">&lt;T&gt; FileReader&lt;T&gt; create(Decoder&lt;T&gt; decoder, List&lt;File&gt; files) {<!-- --></code> 
        </div> 
        <div class="line number14 index13 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">FileReader&lt;T&gt;(decoder, files);</code> 
        </div> 
        <div class="line number15 index14 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number16 index15 alt1"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number17 index16 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">static</code> 
         <code class="java plain">&lt;T&gt; FileReader&lt;T&gt; create(Decoder&lt;T&gt; decoder, File... files) {<!-- --></code> 
        </div> 
        <div class="line number18 index17 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">FileReader&lt;T&gt;(decoder, files);</code> 
        </div> 
        <div class="line number19 index18 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number20 index19 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number21 index20 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">Iterator&lt;List&lt;T&gt;&gt; iterator() {<!-- --></code> 
        </div> 
        <div class="line number22 index21 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">Iterator&lt;List&lt;T&gt;&gt;() {<!-- --></code> 
        </div> 
        <div class="line number23 index22 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">List&lt;T&gt; entries;</code> 
        </div> 
        <div class="line number24 index23 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">chunkPos = </code> 
         <code class="java value">0</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number25 index24 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">MappedByteBuffer buffer;</code> 
        </div> 
        <div class="line number26 index25 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">FileChannel channel;</code> 
        </div> 
        <div class="line number27 index26 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number28 index27 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">boolean</code> 
         <code class="java plain">hasNext() { </code> 
        </div> 
        <div class="line number29 index28 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(buffer ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">|| !buffer.hasRemaining()) {<!-- --></code> 
        </div> 
        <div class="line number30 index29 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">buffer = nextBuffer(chunkPos);</code> 
        </div> 
        <div class="line number31 index30 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(buffer ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number32 index31 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">false</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number33 index32 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number34 index33 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number35 index34 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">T result =</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number36 index35 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">while</code> 
         <code class="java plain">((result = decoder.decode(buffer)) !=</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number37 index36 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(entries ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number38 index37 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java plain">entries =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">ArrayList&lt;T&gt;();</code> 
        </div> 
        <div class="line number39 index38 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number40 index39 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">entries.add(result);</code> 
        </div> 
        <div class="line number41 index40 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number42 index41 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// set next MappedByteBuffer chunk</code> 
        </div> 
        <div class="line number43 index42 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">chunkPos += buffer.position();</code> 
        </div> 
        <div class="line number44 index43 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">buffer =</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number45 index44 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(entries !=</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number46 index45 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">true</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number47 index46 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
         <code class="java keyword">else</code> 
         <code class="java plain">{ </code> 
        </div> 
        <div class="line number48 index47 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">Closeables.closeQuietly(channel);</code> 
        </div> 
        <div class="line number49 index48 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">false</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number50 index49 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number51 index50 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number52 index51 alt1"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number53 index52 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">MappedByteBuffer nextBuffer(</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">position) {<!-- --></code> 
        </div> 
        <div class="line number54 index53 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">try</code> 
         <code class="java plain">{<!-- --></code> 
        </div> 
        <div class="line number55 index54 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(channel ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">|| channel.size() == position) {<!-- --></code> 
        </div> 
        <div class="line number56 index55 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(channel !=</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number57 index56 alt2"> 
         <code class="java spaces">              </code> 
         <code class="java plain">Closeables.closeQuietly(channel);</code> 
        </div> 
        <div class="line number58 index57 alt1"> 
         <code class="java spaces">              </code> 
         <code class="java plain">channel =</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number59 index58 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number60 index59 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(files.hasNext()) {<!-- --></code> 
        </div> 
        <div class="line number61 index60 alt2"> 
         <code class="java spaces">              </code> 
         <code class="java plain">File file = files.next();</code> 
        </div> 
        <div class="line number62 index61 alt1"> 
         <code class="java spaces">              </code> 
         <code class="java plain">channel =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">RandomAccessFile(file,</code> 
         <code class="java string">"r"</code> 
         <code class="java plain">).getChannel();</code> 
        </div> 
        <div class="line number63 index62 alt2"> 
         <code class="java spaces">              </code> 
         <code class="java plain">chunkPos =</code> 
         <code class="java value">0</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number64 index63 alt1"> 
         <code class="java spaces">              </code> 
         <code class="java plain">position =</code> 
         <code class="java value">0</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number65 index64 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java plain">}</code> 
         <code class="java keyword">else</code> 
         <code class="java plain">{ </code> 
        </div> 
        <div class="line number66 index65 alt1"> 
         <code class="java spaces">              </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number67 index66 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number68 index67 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number69 index68 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">long</code> 
         <code class="java plain">chunkSize = CHUNK_SIZE;</code> 
        </div> 
        <div class="line number70 index69 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(channel.size() - position &lt; chunkSize) {<!-- --></code> 
        </div> 
        <div class="line number71 index70 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java plain">chunkSize = channel.size() - position;</code> 
        </div> 
        <div class="line number72 index71 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number73 index72 alt2"> 
         <code class="java spaces">           </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">channel.map(FileChannel.MapMode.READ_ONLY, chunkPos, chunkSize);</code> 
        </div> 
        <div class="line number74 index73 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
         <code class="java keyword">catch</code> 
         <code class="java plain">(IOException e) {<!-- --></code> 
        </div> 
        <div class="line number75 index74 alt2"> 
         <code class="java spaces">           </code> 
         <code class="java plain">Closeables.closeQuietly(channel);</code> 
        </div> 
        <div class="line number76 index75 alt1"> 
         <code class="java spaces">           </code> 
         <code class="java keyword">throw</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">RuntimeException(e);</code> 
        </div> 
        <div class="line number77 index76 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number78 index77 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number79 index78 alt2"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number80 index79 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number81 index80 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">List&lt;T&gt; next() {<!-- --></code> 
        </div> 
        <div class="line number82 index81 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">List&lt;T&gt; res = entries;</code> 
        </div> 
        <div class="line number83 index82 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">entries =</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number84 index83 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">res;</code> 
        </div> 
        <div class="line number85 index84 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number86 index85 alt1"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number87 index86 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number88 index87 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">void</code> 
         <code class="java plain">remove() { </code> 
        </div> 
        <div class="line number89 index88 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">throw</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">UnsupportedOperationException();</code> 
        </div> 
        <div class="line number90 index89 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number91 index90 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java plain">};</code> 
        </div> 
        <div class="line number92 index91 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number93 index92 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>下一个任务就是写一个Decoder 。针对逗号分隔的任何文本格式，编写一个TextRowDecoder 类。接收的参数是每行字段的数量和一个字段分隔符，返回byte的二维数组。TextRowDecoder 可以被操作不同字符集的特定格式解码器重复利用。</p> 
 <div> 
  <div id="highlighter_232957" class="syntaxhighlighter notranslate java ie"> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> 
       <div class="line number4 index3 alt1">
         4 
       </div> 
       <div class="line number5 index4 alt2">
         5 
       </div> 
       <div class="line number6 index5 alt1">
         6 
       </div> 
       <div class="line number7 index6 alt2">
         7 
       </div> 
       <div class="line number8 index7 alt1">
         8 
       </div> 
       <div class="line number9 index8 alt2">
         9 
       </div> 
       <div class="line number10 index9 alt1">
         10 
       </div> 
       <div class="line number11 index10 alt2">
         11 
       </div> 
       <div class="line number12 index11 alt1">
         12 
       </div> 
       <div class="line number13 index12 alt2">
         13 
       </div> 
       <div class="line number14 index13 alt1">
         14 
       </div> 
       <div class="line number15 index14 alt2">
         15 
       </div> 
       <div class="line number16 index15 alt1">
         16 
       </div> 
       <div class="line number17 index16 alt2">
         17 
       </div> 
       <div class="line number18 index17 alt1">
         18 
       </div> 
       <div class="line number19 index18 alt2">
         19 
       </div> 
       <div class="line number20 index19 alt1">
         20 
       </div> 
       <div class="line number21 index20 alt2">
         21 
       </div> 
       <div class="line number22 index21 alt1">
         22 
       </div> 
       <div class="line number23 index22 alt2">
         23 
       </div> 
       <div class="line number24 index23 alt1">
         24 
       </div> 
       <div class="line number25 index24 alt2">
         25 
       </div> 
       <div class="line number26 index25 alt1">
         26 
       </div> 
       <div class="line number27 index26 alt2">
         27 
       </div> 
       <div class="line number28 index27 alt1">
         28 
       </div> 
       <div class="line number29 index28 alt2">
         29 
       </div> 
       <div class="line number30 index29 alt1">
         30 
       </div> 
       <div class="line number31 index30 alt2">
         31 
       </div> 
       <div class="line number32 index31 alt1">
         32 
       </div> 
       <div class="line number33 index32 alt2">
         33 
       </div> 
       <div class="line number34 index33 alt1">
         34 
       </div> 
       <div class="line number35 index34 alt2">
         35 
       </div> 
       <div class="line number36 index35 alt1">
         36 
       </div> 
       <div class="line number37 index36 alt2">
         37 
       </div> 
       <div class="line number38 index37 alt1">
         38 
       </div> 
       <div class="line number39 index38 alt2">
         39 
       </div> 
       <div class="line number40 index39 alt1">
         40 
       </div> 
       <div class="line number41 index40 alt2">
         41 
       </div> 
       <div class="line number42 index41 alt1">
         42 
       </div> 
       <div class="line number43 index42 alt2">
         43 
       </div> 
       <div class="line number44 index43 alt1">
         44 
       </div> 
       <div class="line number45 index44 alt2">
         45 
       </div> 
       <div class="line number46 index45 alt1">
         46 
       </div> 
       <div class="line number47 index46 alt2">
         47 
       </div> 
       <div class="line number48 index47 alt1">
         48 
       </div> 
       <div class="line number49 index48 alt2">
         49 
       </div> 
       <div class="line number50 index49 alt1">
         50 
       </div> 
       <div class="line number51 index50 alt2">
         51 
       </div> 
       <div class="line number52 index51 alt1">
         52 
       </div> 
       <div class="line number53 index52 alt2">
         53 
       </div> 
       <div class="line number54 index53 alt1">
         54 
       </div> 
       <div class="line number55 index54 alt2">
         55 
       </div> 
       <div class="line number56 index55 alt1">
         56 
       </div> 
       <div class="line number57 index56 alt2">
         57 
       </div> 
       <div class="line number58 index57 alt1">
         58 
       </div> 
       <div class="line number59 index58 alt2">
         59 
       </div> 
       <div class="line number60 index59 alt1">
         60 
       </div> 
       <div class="line number61 index60 alt2">
         61 
       </div> 
       <div class="line number62 index61 alt1">
         62 
       </div> 
       <div class="line number63 index62 alt2">
         63 
       </div> 
       <div class="line number64 index63 alt1">
         64 
       </div> 
       <div class="line number65 index64 alt2">
         65 
       </div> 
       <div class="line number66 index65 alt1">
         66 
       </div> 
       <div class="line number67 index66 alt2">
         67 
       </div> 
       <div class="line number68 index67 alt1">
         68 
       </div> 
       <div class="line number69 index68 alt2">
         69 
       </div> 
       <div class="line number70 index69 alt1">
         70 
       </div> 
       <div class="line number71 index70 alt2">
         71 
       </div> 
       <div class="line number72 index71 alt1">
         72 
       </div> 
       <div class="line number73 index72 alt2">
         73 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java keyword">public</code> 
         <code class="java keyword"> class</code> 
         <code class="java plain">TextRowDecoder </code> 
         <code class="java keyword">implements</code> 
         <code class="java plain">Decoder&lt;</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][]&gt; {<!-- --></code> 
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">static</code> 
         <code class="java keyword">final</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">LF = </code> 
         <code class="java value">10</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">final</code> 
         <code class="java keyword">int</code> 
         <code class="java plain">numFields; </code> 
        </div> 
        <div class="line number4 index3 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">final</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">delimiter; </code> 
        </div> 
        <div class="line number5 index4 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">TextRowDecoder(</code> 
         <code class="java keyword">int</code> 
         <code class="java plain">numFields,</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">delimiter) {<!-- --></code> 
        </div> 
        <div class="line number6 index5 alt1"> 
         <code class="java spaces">   </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.numFields = numFields;</code> 
        </div> 
        <div class="line number7 index6 alt2"> 
         <code class="java spaces">   </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.delimiter = delimiter;</code> 
        </div> 
        <div class="line number8 index7 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number9 index8 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number10 index9 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][] decode(ByteBuffer buffer) {<!-- --></code> 
        </div> 
        <div class="line number11 index10 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">lineStartPos = buffer.position();</code> 
        </div> 
        <div class="line number12 index11 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">limit = buffer.limit();</code> 
        </div> 
        <div class="line number13 index12 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">while</code> 
         <code class="java plain">(buffer.hasRemaining()) {<!-- --></code> 
        </div> 
        <div class="line number14 index13 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">b = buffer.get();</code> 
        </div> 
        <div class="line number15 index14 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(b == LF) {<!-- --></code> 
         <code class="java comments">// reached line feed so parse line</code> 
        </div> 
        <div class="line number16 index15 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">lineEndPos = buffer.position();</code> 
        </div> 
        <div class="line number17 index16 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// set positions for one row duplication</code> 
        </div> 
        <div class="line number18 index17 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(buffer.limit() &lt; lineEndPos +</code> 
         <code class="java value">1</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number19 index18 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">buffer.position(lineStartPos).limit(lineEndPos);</code> 
        </div> 
        <div class="line number20 index19 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
         <code class="java keyword">else</code> 
         <code class="java plain">{ </code> 
        </div> 
        <div class="line number21 index20 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">buffer.position(lineStartPos).limit(lineEndPos +</code> 
         <code class="java value">1</code> 
         <code class="java plain">);</code> 
        </div> 
        <div class="line number22 index21 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number23 index22 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][] entry = parseRow(buffer.duplicate());</code> 
        </div> 
        <div class="line number24 index23 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(entry !=</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number25 index24 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java comments">// reset main buffer</code> 
        </div> 
        <div class="line number26 index25 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">buffer.position(lineEndPos);</code> 
        </div> 
        <div class="line number27 index26 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">buffer.limit(limit);</code> 
        </div> 
        <div class="line number28 index27 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java comments">// set start after LF</code> 
        </div> 
        <div class="line number29 index28 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">lineStartPos = lineEndPos;</code> 
        </div> 
        <div class="line number30 index29 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number31 index30 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">entry;</code> 
        </div> 
        <div class="line number32 index31 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number33 index32 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number34 index33 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java plain">buffer.position(lineStartPos);</code> 
        </div> 
        <div class="line number35 index34 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number36 index35 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number37 index36 alt2"> 
         <code class="java spaces">  </code>  
        </div> 
        <div class="line number38 index37 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][] parseRow(ByteBuffer buffer) {<!-- --></code> 
        </div> 
        <div class="line number39 index38 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">fieldStartPos = buffer.position();</code> 
        </div> 
        <div class="line number40 index39 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">fieldEndPos =</code> 
         <code class="java value">0</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number41 index40 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">fieldNumber =</code> 
         <code class="java value">0</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number42 index41 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][] fields =</code> 
         <code class="java keyword">new</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[numFields][];</code> 
        </div> 
        <div class="line number43 index42 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">while</code> 
         <code class="java plain">(buffer.hasRemaining()) {<!-- --></code> 
        </div> 
        <div class="line number44 index43 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">b = buffer.get();</code> 
        </div> 
        <div class="line number45 index44 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(b == delimiter || b == LF) {<!-- --></code> 
        </div> 
        <div class="line number46 index45 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">fieldEndPos = buffer.position();</code> 
        </div> 
        <div class="line number47 index46 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// save limit</code> 
        </div> 
        <div class="line number48 index47 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">limit = buffer.limit();</code> 
        </div> 
        <div class="line number49 index48 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// set positions for one row duplication</code> 
        </div> 
        <div class="line number50 index49 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">buffer.position(fieldStartPos).limit(fieldEndPos);</code> 
        </div> 
        <div class="line number51 index50 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">fields[fieldNumber] = parseField(buffer.duplicate(), fieldNumber, fieldEndPos - fieldStartPos -</code> 
         <code class="java value">1</code> 
         <code class="java plain">);</code> 
        </div> 
        <div class="line number52 index51 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">fieldNumber++;</code> 
        </div> 
        <div class="line number53 index52 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// reset main buffer</code> 
        </div> 
        <div class="line number54 index53 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">buffer.position(fieldEndPos);</code> 
        </div> 
        <div class="line number55 index54 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">buffer.limit(limit);</code> 
        </div> 
        <div class="line number56 index55 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// set start after LF</code> 
        </div> 
        <div class="line number57 index56 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">fieldStartPos = fieldEndPos;</code> 
        </div> 
        <div class="line number58 index57 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number59 index58 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(fieldNumber == numFields) {<!-- --></code> 
        </div> 
        <div class="line number60 index59 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">fields;</code> 
        </div> 
        <div class="line number61 index60 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number62 index61 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number63 index62 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number64 index63 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number65 index64 alt2"> 
         <code class="java spaces">  </code>  
        </div> 
        <div class="line number66 index65 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[] parseField(ByteBuffer buffer,</code> 
         <code class="java keyword">int</code> 
         <code class="java plain">pos, </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">length) { </code> 
        </div> 
        <div class="line number67 index66 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[] field =</code> 
         <code class="java keyword">new</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[length];</code> 
        </div> 
        <div class="line number68 index67 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">for</code> 
         <code class="java plain">(</code> 
         <code class="java keyword">int</code> 
         <code class="java plain">i = </code> 
         <code class="java value">0</code> 
         <code class="java plain">; i &lt; field.length; i++) {<!-- --></code> 
        </div> 
        <div class="line number69 index68 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java plain">field[i] = buffer.get();</code> 
        </div> 
        <div class="line number70 index69 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number71 index70 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">field;</code> 
        </div> 
        <div class="line number72 index71 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number73 index72 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>这是文件被处理的过程。每一个List包含的元素都从一个单独的buffer中解码，每一个元素都是被TextRowDecoder定义的byte二维数组。</p> 
 <div> 
  <div id="highlighter_740675" class="syntaxhighlighter notranslate java ie"> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> 
       <div class="line number4 index3 alt1">
         4 
       </div> 
       <div class="line number5 index4 alt2">
         5 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java plain">TextRowDecoder decoder =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">TextRowDecoder(</code> 
         <code class="java value">4</code> 
         <code class="java plain">, comma);</code> 
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java plain">FileReader&lt;</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][]&gt; reader = FileReader.create(decoder, file.listFiles());</code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java keyword">for</code> 
         <code class="java plain"> (List&lt;</code> 
         <code class="java keyword">byte</code> 
         <code class="java plain">[][]&gt; chunk : reader) {<!-- --></code> 
        </div> 
        <div class="line number4 index3 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java comments">// do something with each chunk</code> 
        </div> 
        <div class="line number5 index4 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>我们可以在这里打住，不过还有额外的需求。每一行都包含一个时间戳，每一批都必须分组，使用时间段来代替buffers，如按照天分组、或者按照小时分组。我还想要遍历每一批的数据，因此，第一反应就是，为FileReader创建一个Iterable包装器，实现它的行为。一个额外的细节，每一个元素必须通过实现Timestamped接口（这里没有显示）提供时间戳到PeriodEntries。</p> 
 <div> 
  <div id="highlighter_110767" class="syntaxhighlighter notranslate java ie"> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> 
       <div class="line number4 index3 alt1">
         4 
       </div> 
       <div class="line number5 index4 alt2">
         5 
       </div> 
       <div class="line number6 index5 alt1">
         6 
       </div> 
       <div class="line number7 index6 alt2">
         7 
       </div> 
       <div class="line number8 index7 alt1">
         8 
       </div> 
       <div class="line number9 index8 alt2">
         9 
       </div> 
       <div class="line number10 index9 alt1">
         10 
       </div> 
       <div class="line number11 index10 alt2">
         11 
       </div> 
       <div class="line number12 index11 alt1">
         12 
       </div> 
       <div class="line number13 index12 alt2">
         13 
       </div> 
       <div class="line number14 index13 alt1">
         14 
       </div> 
       <div class="line number15 index14 alt2">
         15 
       </div> 
       <div class="line number16 index15 alt1">
         16 
       </div> 
       <div class="line number17 index16 alt2">
         17 
       </div> 
       <div class="line number18 index17 alt1">
         18 
       </div> 
       <div class="line number19 index18 alt2">
         19 
       </div> 
       <div class="line number20 index19 alt1">
         20 
       </div> 
       <div class="line number21 index20 alt2">
         21 
       </div> 
       <div class="line number22 index21 alt1">
         22 
       </div> 
       <div class="line number23 index22 alt2">
         23 
       </div> 
       <div class="line number24 index23 alt1">
         24 
       </div> 
       <div class="line number25 index24 alt2">
         25 
       </div> 
       <div class="line number26 index25 alt1">
         26 
       </div> 
       <div class="line number27 index26 alt2">
         27 
       </div> 
       <div class="line number28 index27 alt1">
         28 
       </div> 
       <div class="line number29 index28 alt2">
         29 
       </div> 
       <div class="line number30 index29 alt1">
         30 
       </div> 
       <div class="line number31 index30 alt2">
         31 
       </div> 
       <div class="line number32 index31 alt1">
         32 
       </div> 
       <div class="line number33 index32 alt2">
         33 
       </div> 
       <div class="line number34 index33 alt1">
         34 
       </div> 
       <div class="line number35 index34 alt2">
         35 
       </div> 
       <div class="line number36 index35 alt1">
         36 
       </div> 
       <div class="line number37 index36 alt2">
         37 
       </div> 
       <div class="line number38 index37 alt1">
         38 
       </div> 
       <div class="line number39 index38 alt2">
         39 
       </div> 
       <div class="line number40 index39 alt1">
         40 
       </div> 
       <div class="line number41 index40 alt2">
         41 
       </div> 
       <div class="line number42 index41 alt1">
         42 
       </div> 
       <div class="line number43 index42 alt2">
         43 
       </div> 
       <div class="line number44 index43 alt1">
         44 
       </div> 
       <div class="line number45 index44 alt2">
         45 
       </div> 
       <div class="line number46 index45 alt1">
         46 
       </div> 
       <div class="line number47 index46 alt2">
         47 
       </div> 
       <div class="line number48 index47 alt1">
         48 
       </div> 
       <div class="line number49 index48 alt2">
         49 
       </div> 
       <div class="line number50 index49 alt1">
         50 
       </div> 
       <div class="line number51 index50 alt2">
         51 
       </div> 
       <div class="line number52 index51 alt1">
         52 
       </div> 
       <div class="line number53 index52 alt2">
         53 
       </div> 
       <div class="line number54 index53 alt1">
         54 
       </div> 
       <div class="line number55 index54 alt2">
         55 
       </div> 
       <div class="line number56 index55 alt1">
         56 
       </div> 
       <div class="line number57 index56 alt2">
         57 
       </div> 
       <div class="line number58 index57 alt1">
         58 
       </div> 
       <div class="line number59 index58 alt2">
         59 
       </div> 
       <div class="line number60 index59 alt1">
         60 
       </div> 
       <div class="line number61 index60 alt2">
         61 
       </div> 
       <div class="line number62 index61 alt1">
         62 
       </div> 
       <div class="line number63 index62 alt2">
         63 
       </div> 
       <div class="line number64 index63 alt1">
         64 
       </div> 
       <div class="line number65 index64 alt2">
         65 
       </div> 
       <div class="line number66 index65 alt1">
         66 
       </div> 
       <div class="line number67 index66 alt2">
         67 
       </div> 
       <div class="line number68 index67 alt1">
         68 
       </div> 
       <div class="line number69 index68 alt2">
         69 
       </div> 
       <div class="line number70 index69 alt1">
         70 
       </div> 
       <div class="line number71 index70 alt2">
         71 
       </div> 
       <div class="line number72 index71 alt1">
         72 
       </div> 
       <div class="line number73 index72 alt2">
         73 
       </div> 
       <div class="line number74 index73 alt1">
         74 
       </div> 
       <div class="line number75 index74 alt2">
         75 
       </div> 
       <div class="line number76 index75 alt1">
         76 
       </div> 
       <div class="line number77 index76 alt2">
         77 
       </div> 
       <div class="line number78 index77 alt1">
         78 
       </div> 
       <div class="line number79 index78 alt2">
         79 
       </div> 
       <div class="line number80 index79 alt1">
         80 
       </div> 
       <div class="line number81 index80 alt2">
         81 
       </div> 
       <div class="line number82 index81 alt1">
         82 
       </div> 
       <div class="line number83 index82 alt2">
         83 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java spaces">      </code>  
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">class</code> 
         <code class="java plain">PeriodEntries&lt;T </code> 
         <code class="java keyword">extends</code> 
         <code class="java plain">Timestamped&gt; </code> 
         <code class="java keyword">implements</code> 
         <code class="java plain">Iterable&lt;List&lt;T&gt;&gt; {<!-- --></code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">final</code> 
         <code class="java plain">Iterator&lt;List&lt;T </code> 
         <code class="java keyword">extends</code> 
         <code class="java plain">Timestamped&gt;&gt; entriesIt;</code> 
        </div> 
        <div class="line number4 index3 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">final</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">interval; </code> 
        </div> 
        <div class="line number5 index4 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">PeriodEntries(Iterable&lt;List&lt;T&gt;&gt; entriesIt,</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">interval) {<!-- --></code> 
        </div> 
        <div class="line number6 index5 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.entriesIt = entriesIt.iterator();</code> 
        </div> 
        <div class="line number7 index6 alt2"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">this</code> 
         <code class="java plain">.interval = interval;</code> 
        </div> 
        <div class="line number8 index7 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number9 index8 alt2"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number10 index9 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">static</code> 
         <code class="java plain">&lt;T </code> 
         <code class="java keyword">extends</code> 
         <code class="java plain">Timestamped&gt; PeriodEntries&lt;T&gt; create(Iterable&lt;List&lt;T&gt;&gt; entriesIt,</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">interval) {<!-- --></code> 
        </div> 
        <div class="line number11 index10 alt2"> 
         <code class="java spaces">   </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">PeriodEntries&lt;T&gt;(entriesIt, interval);</code> 
        </div> 
        <div class="line number12 index11 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number13 index12 alt2"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number14 index13 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number15 index14 alt2"> 
         <code class="java spaces">  </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">Iterator&lt;List&lt;T</code> 
         <code class="java keyword">extends</code> 
         <code class="java plain">Timestamped&gt;&gt; iterator() {<!-- --></code> 
        </div> 
        <div class="line number16 index15 alt1"> 
         <code class="java spaces">    </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">Iterator&lt;List&lt;T&gt;&gt;() {<!-- --></code> 
        </div> 
        <div class="line number17 index16 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">Queue&lt;List&lt;T&gt;&gt; queue =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">LinkedList&lt;List&lt;T&gt;&gt;();</code> 
        </div> 
        <div class="line number18 index17 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">previous; </code> 
        </div> 
        <div class="line number19 index18 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java plain">Iterator&lt;T&gt; entryIt;</code> 
        </div> 
        <div class="line number20 index19 alt1"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number21 index20 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number22 index21 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">boolean</code> 
         <code class="java plain">hasNext() { </code> 
        </div> 
        <div class="line number23 index22 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(!advanceEntries()) {<!-- --></code> 
        </div> 
        <div class="line number24 index23 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">false</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number25 index24 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number26 index25 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">T entry =  entryIt.next();</code> 
        </div> 
        <div class="line number27 index26 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">long</code> 
         <code class="java plain">time = normalizeInterval(entry);</code> 
        </div> 
        <div class="line number28 index27 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(previous ==</code> 
         <code class="java value">0</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number29 index28 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">previous = time;</code> 
        </div> 
        <div class="line number30 index29 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number31 index30 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(queue.peek() ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">) {<!-- --></code> 
        </div> 
        <div class="line number32 index31 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">List&lt;T&gt; group =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">ArrayList&lt;T&gt;();</code> 
        </div> 
        <div class="line number33 index32 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">queue.add(group);</code> 
        </div> 
        <div class="line number34 index33 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number35 index34 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">while</code> 
         <code class="java plain">(previous == time) {<!-- --></code> 
        </div> 
        <div class="line number36 index35 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">queue.peek().add(entry);</code> 
        </div> 
        <div class="line number37 index36 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(!advanceEntries()) {<!-- --></code> 
        </div> 
        <div class="line number38 index37 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">break</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number39 index38 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number40 index39 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">entry = entryIt.next();</code> 
        </div> 
        <div class="line number41 index40 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">time = normalizeInterval(entry);</code> 
        </div> 
        <div class="line number42 index41 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number43 index42 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">previous = time;</code> 
        </div> 
        <div class="line number44 index43 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">List&lt;T&gt; result = queue.peek();</code> 
        </div> 
        <div class="line number45 index44 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(result ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">|| result.isEmpty()) {<!-- --></code> 
        </div> 
        <div class="line number46 index45 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">false</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number47 index46 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number48 index47 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">true</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number49 index48 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number50 index49 alt1"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number51 index50 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">boolean</code> 
         <code class="java plain">advanceEntries() {<!-- --></code> 
        </div> 
        <div class="line number52 index51 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java comments">// if there are no rows left</code> 
        </div> 
        <div class="line number53 index52 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(entryIt ==</code> 
         <code class="java keyword">null</code> 
         <code class="java plain">|| !entryIt.hasNext()) {<!-- --></code> 
        </div> 
        <div class="line number54 index53 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java comments">// try get more rows if possible</code> 
        </div> 
        <div class="line number55 index54 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java keyword">if</code> 
         <code class="java plain">(entriesIt.hasNext()) {<!-- --></code> 
        </div> 
        <div class="line number56 index55 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java plain">entryIt = entriesIt.next().iterator();</code> 
        </div> 
        <div class="line number57 index56 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">true</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number58 index57 alt1"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
         <code class="java keyword">else</code> 
         <code class="java plain">{ </code> 
        </div> 
        <div class="line number59 index58 alt2"> 
         <code class="java spaces">            </code> 
         <code class="java comments">// no more rows</code> 
        </div> 
        <div class="line number60 index59 alt1"> 
         <code class="java spaces">            </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">false</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number61 index60 alt2"> 
         <code class="java spaces">          </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number62 index61 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number63 index62 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java keyword">true</code> 
         <code class="java plain">;</code> 
        </div> 
        <div class="line number64 index63 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number65 index64 alt2"> 
         <code class="java spaces"> </code>  
        </div> 
        <div class="line number66 index65 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">private</code> 
         <code class="java keyword">long</code> 
         <code class="java plain">normalizeInterval(Timestamped entry) {<!-- --></code> 
        </div> 
        <div class="line number67 index66 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">long</code> 
         <code class="java plain">time = entry.getTime();</code> 
        </div> 
        <div class="line number68 index67 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">int</code> 
         <code class="java plain">utcOffset = TimeZone.getDefault().getOffset(time);</code> 
        </div> 
        <div class="line number69 index68 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">long</code> 
         <code class="java plain">utcTime = time + utcOffset;</code> 
        </div> 
        <div class="line number70 index69 alt1"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">long</code> 
         <code class="java plain">elapsed = utcTime % interval;</code> 
        </div> 
        <div class="line number71 index70 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">time - elapsed;</code> 
        </div> 
        <div class="line number72 index71 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number73 index72 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number74 index73 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java plain">List&lt;T&gt; next() {<!-- --></code> 
        </div> 
        <div class="line number75 index74 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">return</code> 
         <code class="java plain">queue.poll();</code> 
        </div> 
        <div class="line number76 index75 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number77 index76 alt2"> 
         <code class="java spaces">      </code> 
         <code class="java color1">@Override</code> 
        </div> 
        <div class="line number78 index77 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java keyword">public</code> 
         <code class="java keyword">void</code> 
         <code class="java plain">remove() { </code> 
        </div> 
        <div class="line number79 index78 alt2"> 
         <code class="java spaces">        </code> 
         <code class="java keyword">throw</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">UnsupportedOperationException();</code> 
        </div> 
        <div class="line number80 index79 alt1"> 
         <code class="java spaces">      </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number81 index80 alt2"> 
         <code class="java spaces">   </code> 
         <code class="java plain">};</code> 
        </div> 
        <div class="line number82 index81 alt1"> 
         <code class="java spaces">  </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number83 index82 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>最后的处理代码通过引入这个函数并无太大变动，只有一个干净的且紧密的循环，不必关心文件、缓冲区、时间周期的分组元素。PeriodEntries也是足够的灵活管理任何时长的时间。</p> 
 <div> 
  <div id="highlighter_44812" class="syntaxhighlighter notranslate java ie"> 
   <table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"> 
       <div class="line number1 index0 alt2">
         1 
       </div> 
       <div class="line number2 index1 alt1">
         2 
       </div> 
       <div class="line number3 index2 alt2">
         3 
       </div> 
       <div class="line number4 index3 alt1">
         4 
       </div> 
       <div class="line number5 index4 alt2">
         5 
       </div> 
       <div class="line number6 index5 alt1">
         6 
       </div> 
       <div class="line number7 index6 alt2">
         7 
       </div> 
       <div class="line number8 index7 alt1">
         8 
       </div> 
       <div class="line number9 index8 alt2">
         9 
       </div> 
       <div class="line number10 index9 alt1">
         10 
       </div> 
       <div class="line number11 index10 alt2">
         11 
       </div> </td><td class="code"> 
       <div class="container"> 
        <div class="line number1 index0 alt2"> 
         <code class="java plain">TrueFxDecoder decoder =</code> 
         <code class="java keyword">new</code> 
         <code class="java plain">TrueFxDecoder();</code> 
        </div> 
        <div class="line number2 index1 alt1"> 
         <code class="java plain">FileReader&lt;TrueFxData&gt; reader = FileReader.create(decoder, file.listFiles());</code> 
        </div> 
        <div class="line number3 index2 alt2"> 
         <code class="java keyword">long</code> 
         <code class="java plain"> periodLength = TimeUnit.DAYS.toMillis(</code> 
         <code class="java value">1</code> 
         <code class="java plain">);</code> 
        </div> 
        <div class="line number4 index3 alt1"> 
         <code class="java plain">PeriodEntries&lt;TrueFxData&gt; periods = PeriodEntries.create(reader, periodLength);</code> 
        </div> 
        <div class="line number5 index4 alt2"> 
         <code class="java spaces">  </code>  
        </div> 
        <div class="line number6 index5 alt1"> 
         <code class="java keyword">for</code> 
         <code class="java plain"> (List&lt;TrueFxData&gt; entries : periods) { </code> 
        </div> 
        <div class="line number7 index6 alt2"> 
         <code class="java spaces">   </code> 
         <code class="java comments">// data for each day</code> 
        </div> 
        <div class="line number8 index7 alt1"> 
         <code class="java spaces">   </code> 
         <code class="java keyword">for</code> 
         <code class="java plain">(TrueFxData entry : entries) {<!-- --></code> 
        </div> 
        <div class="line number9 index8 alt2"> 
         <code class="java spaces">     </code> 
         <code class="java comments">// process each entry</code> 
        </div> 
        <div class="line number10 index9 alt1"> 
         <code class="java spaces">   </code> 
         <code class="java plain">}</code> 
        </div> 
        <div class="line number11 index10 alt2"> 
         <code class="java plain">}</code> 
        </div> 
       </div> </td></tr></tbody></table> 
  </div> 
 </div> 
 <p>你也许意识到了，使用集合不可能解决这样的问题；选择迭代器是一个关键的设计决策，能够解析兆字节的数组，且不会消耗过多的空间。</p> 原文链接： 
 <a target="_blank" class="external" href="http://www.javacodegeeks.com/2013/01/processing-huge-files-with-java.html" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">javacodegeeks</span></a> 翻译： 
 <a target="_blank" href="http://www.importnew.com/" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">ImportNew.com </span></a>- 
 <a target="_blank" href="http://www.importnew.com/author/songtao" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">踏雁寻花</span></a> 
 <br> 译文链接： 
 <a target="_blank" href="http://www.importnew.com/10712.html" rel="nofollow noopener noreferrer"> <span style="color:#0099cc">http://www.importnew.com/10712.html</span></a> 
 <br> [ 
 <span style="color:#ff0000"><strong>转载请保留原文出处、译者和译文链接。</strong></span>] 
 <br> 
 <br> 
 <div id="author-bio"> 
  <h4 class="widget-title">关于作者： <a target="_blank" href="http://www.importnew.com/author/songtao" rel="nofollow noopener noreferrer"> 踏雁寻花</a> </h4> 
  <div class="alignleft"> 
   <a target="_blank" href="http://www.importnew.com/author/songtao" rel="nofollow noopener noreferrer"></a> 
  </div> 
  <p>个人主页：<strong><a target="_blank" class="external" href="http://www.songtao.me/" rel="nofollow noopener noreferrer"><span style="color:#0099cc">踏雁寻花 | 记录生活、工作、学习的一个挨踢人的博客</span></a></strong> 新浪微博：<strong><a target="_blank" class="external" href="http://weibo.com/songtaodreamer" rel="nofollow noopener noreferrer"><span style="color:#0099cc">@踏雁寻花</span></a></strong></p> 
  <p><a target="_blank" href="http://www.importnew.com/author/songtao" rel="nofollow noopener noreferrer" style="text-decoration:none"><span style="color:#0099cc">查看踏雁寻花的更多文章 &gt;&gt;</span></a></p> 
  <p> </p> 
  <p> </p> 
  <p> </p> 
  <div id="article_details" class="details"> 
   <div class="article_title"> 
    <span class="ico ico_type_Original"></span> 
    <h2><span class="link_title"><a target="_blank" href="/dengqiaodey/article/details/7856814" rel="nofollow noopener noreferrer"><span style="color:#000000">java读写文件</span></a></span></h2> 
    <h2><span class="link_title"></span>  <span style="font-size:14px">  import java.io.BufferedOutputStream;</span></h2> 
   </div> 
   <div id="article_content" class="article_content"> 
    <p>    import  java.io.BufferedReader;</p> 
    <p>    import java.io.File;</p> 
    <p>    import java.io.FileOutputStream;</p> 
    <p>   import java.io.FileReader;</p> 
    <p>   import java.io.FileWriter;</p> 
    <p>   import java.io.IOException;</p> 
    <p>   import java.io.OutputStreamWriter;</p> 
    <p><br> </p> 
    <p>     public void ReadFile(String filename) {<!-- --></p> 
    <p>          File file=new File(filename);</p> 
    <p>         BufferedReader reader=null;</p> 
    <p>      try{<!-- --></p> 
    <p>               reader=new BufferedReader(new FileReader(file));   //如果是读大文件  则  new BufferedReader(new FileReader(file),5*1024*1024);  即，设置缓存</p> 
    <p>               String tempString=null;</p> 
    <p>               while((tempString=reader.readLine())!=null)</p> 
    <p>               {<!-- --></p> 
    <p>                    //进行操作.....</p> 
    <p>              }</p> 
    <p>            reader.close();</p> 
    <p>       }catch(IOException e){<!-- --></p> 
    <p>             e.printStackTrace();</p> 
    <p>      }finally{<!-- --></p> 
    <p>           if(reader!=null)</p> 
    <p>         {<!-- --></p> 
    <p>               try{<!-- --></p> 
    <p>                      reader.close();</p> 
    <p>               }catch(IOException e)</p> 
    <p>             {<!-- --></p> 
    <p>             e.printStackTrace();</p> 
    <p>            }</p> 
    <p>          }</p> 
    <p>       }</p> 
    <p>}</p> 
    <p>二、写文件</p> 
    <p></p> 
    <p></p> 
    <p>    import java.io.BufferedOutputStream;</p> 
    <p>    import  java.io.BufferedReader;</p> 
    <p>   import  java.io.BufferedWriter;</p> 
    <p>    import java.io.File;</p> 
    <p>    import java.io.FileOutputStream;</p> 
    <p>   import java.io.FileReader;</p> 
    <p>   import java.io.FileWriter;</p> 
    <p>   import java.io.IOException;</p> 
    <p>   import java.io.OutputStreamWriter;</p> 
    <p></p> 
    <br> 
    <p>    public void method1(String file,String content){<!-- --></p> 
    <p>     BufferedWriter out=null;</p> 
    <p>     try{<!-- --></p> 
    <p>           out=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file,true)));  //追加的方法</p> 
    <p>          out.write(content);</p> 
    <p>          out.write("\r\n");</p> 
    <p>   }catch(IOException e){<!-- --></p> 
    <p>             e.printStackTrace();</p> 
    <p>      }finally{<!-- --></p> 
    <p>     try{<!-- --></p> 
    <p>    out.close();</p> 
    <p>  }catch(IOException e){<!-- --></p> 
    <p>             e.printStackTrace();</p> 
    <p>      }</p> 
    <p>}</p> 
    <p>}</p> 
    <p><br> </p> 
    <p>public void main(String[] args)</p> 
    <p>{<!-- --></p> 
    <p>   String filename="D:\a.txt";</p> 
    <p>  File f=new File(filename);</p> 
    <p> if(f.exists()){<!-- --></p> 
    <p>    f.delete();</p> 
    <p>}</p> 
    <p>f.createNewFile();</p> 
    <p>String ss="sssssss";</p> 
    <p>method1(filename,ss);</p> 
    <p>}</p> 
    <p><br> </p> 
    <p>===========================华丽丽的分隔符=============================</p> 
    <p>在实践中发现上面的方法最多也就能处理10M以内的数据，从而编辑此文章。</p> 
    <p>想要真正处理上百M，甚至上G的文件，那就要用到java的nio包：</p> 
    <p>下面的代码转自【http://www.oschina.net/code/snippet_54100_7938】</p> 
    <p>import java.io.BufferedReader; <br> import java.io.File; <br> import java.io.FileInputStream; <br> import java.io.IOException; <br> import java.io.RandomAccessFile; <br> import java.nio.ByteBuffer; <br> import java.nio.channels.FileChannel; <br> <br> <br> public class TestNio { <br> <br> <span style="white-space:pre"></span>public static void main(String args[]) throws Exception{ <br> <span style="white-space:pre"></span>int bufSize = 100; <br> <span style="white-space:pre"></span>File fin = new File("D:\\workspace\\test\\usagetracking.log"); <br> <span style="white-space:pre"></span>File fout = new File("D:\\workspace\\test\\usagetracking2.log"); <br> <br> <br> <span style="white-space:pre"></span>FileChannel fcin = new RandomAccessFile(fin, "r").getChannel(); <br> <span style="white-space:pre"></span>ByteBuffer rBuffer = ByteBuffer.allocate(bufSize); <br> <br> <br> <span style="white-space:pre"></span>FileChannel fcout = new RandomAccessFile(fout, "rws").getChannel(); <br> <span style="white-space:pre"></span>ByteBuffer wBuffer = ByteBuffer.allocateDirect(bufSize); <br> <br> <br> <br> <br> <span style="white-space:pre"></span>readFileByLine(bufSize, fcin, rBuffer, fcout, wBuffer); <br> <br> <br> <span style="white-space:pre"></span>System.out.print("OK!!!"); <br> <span style="white-space:pre"></span>} <br> <br> /*读文件同时写文件*/<br> <span style="white-space:pre"></span>public static void readFileByLine(int bufSize, FileChannel fcin, ByteBuffer rBuffer, FileChannel fcout, ByteBuffer wBuffer){ <br> <span style="white-space:pre"></span>String enterStr = "\n"; <br> <span style="white-space:pre"></span>try{ <br> <span style="white-space:pre"></span>byte[] bs = new byte[bufSize]; <br> <br> <br> <span style="white-space:pre"></span>int size = 0; <br> <span style="white-space:pre"></span>StringBuffer strBuf = new StringBuffer(""); <br> <span style="white-space:pre"></span>//while((size = fcin.read(buffer)) != -1){ <br> <span style="white-space:pre"></span>while(fcin.read(rBuffer) != -1){ <br> <span style="white-space:pre"></span>     int rSize = rBuffer.position(); <br> <span style="white-space:pre"></span>     rBuffer.rewind(); <br> <span style="white-space:pre"></span>     rBuffer.get(bs); <br> <span style="white-space:pre"></span>     rBuffer.clear(); <br> <span style="white-space:pre"></span>     String tempString = new String(bs, 0, rSize); <br> <span style="white-space:pre"></span>     //System.out.print(tempString); <br> <span style="white-space:pre"></span>     //System.out.print("&lt;200&gt;"); <br> <br> <br> <span style="white-space:pre"></span>     int fromIndex = 0; <br> <span style="white-space:pre"></span>     int endIndex = 0; <br> <span style="white-space:pre"></span>     while((endIndex = tempString.indexOf(enterStr, fromIndex)) != -1){ <br> <span style="white-space:pre"></span>      String line = tempString.substring(fromIndex, endIndex); <br> <span style="white-space:pre"></span>      line = new String(strBuf.toString() + line); <br> <span style="white-space:pre"></span>      //System.out.print(line); <br> <span style="white-space:pre"></span>      //System.out.print("&lt;/over/&gt;"); <br> <span style="white-space:pre"></span>      //write to anthone file <br> <span style="white-space:pre"></span>      writeFileByLine(fcout, wBuffer, line); <br> <br> <br> <span style="white-space:pre"></span>      <br> <span style="white-space:pre"></span>      strBuf.delete(0, strBuf.length()); <br> <span style="white-space:pre"></span>      fromIndex = endIndex + 1; <br> <span style="white-space:pre"></span>     } <br> <span style="white-space:pre"></span>     if(rSize &gt; tempString.length()){ <br> <span style="white-space:pre"></span>     strBuf.append(tempString.substring(fromIndex, tempString.length())); <br> <span style="white-space:pre"></span>     }else{ <br> <span style="white-space:pre"></span>     strBuf.append(tempString.substring(fromIndex, rSize)); <br> <span style="white-space:pre"></span>     } <br> <span style="white-space:pre"></span>} <br> <span style="white-space:pre"></span>} catch (IOException e) { <br> <span style="white-space:pre"></span>// TODO Auto-generated catch block <br> <span style="white-space:pre"></span>e.printStackTrace(); <br> <span style="white-space:pre"></span>} <br> <span style="white-space:pre"></span>} <br> <br> /*写文件*/<br> <span style="white-space:pre"></span>public static void writeFileByLine(FileChannel fcout, ByteBuffer wBuffer, String line){ <br> <span style="white-space:pre"></span>try { <br> <span style="white-space:pre"></span>//write on file head <br> <span style="white-space:pre"></span>//fcout.write(wBuffer.wrap(line.getBytes())); <br> <span style="white-space:pre"></span>//wirte append file on foot <br> <span style="white-space:pre"></span>fcout.write(wBuffer.wrap(line.getBytes()), fcout.size()); <br> <br> <br> <span style="white-space:pre"></span>} catch (IOException e) { <br> <span style="white-space:pre"></span>// TODO Auto-generated catch block <br> <span style="white-space:pre"></span>e.printStackTrace(); <br> <span style="white-space:pre"></span>} <br> <span style="white-space:pre"></span>} <br> <br> <br> } <br> </p> 
   </div> 
  </div> 
  <p> </p> 
 </div> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6b835a3efc2060db19780c2b3476e6b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java单例模式的各种写法和最优写法推荐</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/948e50949ca53d2ba1c2d90af589fb1b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Apache顶级项目介绍7 － HBase</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>