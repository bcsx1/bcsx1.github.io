<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Akka 学习（七）Actor的生命周期 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Akka 学习（七）Actor的生命周期" />
<meta property="og:description" content="参考文章
Gitter Chat，Akka 在线交流平台Akka Forums，Akka 论坛Akka in GitHub，Akka 开源项目仓库Akka Official Website，Akka 官网Akka Java API，Akka 应用程序编程接口《Akka入门与实践》 [加]Jason Goodwin（贾森·古德温） 文章系列
Akka 学习（一）Actor 初步认识与环境搭建 已完成 Akka 学习（二）第一个入门程序 已完成 Akka 学习（三）Actor的基本使用 已完成 Akka 学习（四）Remote Actor 已完成 Akka 学习（五）消息传递的方式 已完成 Akka 学习（六）Actor的监督机制 已完成 Akka 学习（七）Actor的生命周期 已完成 Akka 学习（八）路由与Dispatcher 已完成 Akka 学习（九）Akka Cluster 已完成 Akka 基础篇就此结束了，Akka基础篇主要介绍Akka的基本概念与一些基本术语，使用方式
代码：https://github.com/Eason-shu/Akka
在Actor的生命周期中会调用几个方法，我们在需要时可以重写这些方法。
● prestart()：在构造函数之后调用。
● postStop()：在重启之前调用。
● preRestart(reason, message)：默认情况下会调用postStop()。
● postRestart()：默认情况下会调用preStart()。
一 生命周期 1.1 基本介绍 package com.shu; import akka.actor.AbstractActor; import scala." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ee08ce988117da2db1c552865ceb7cca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-12T16:14:22+08:00" />
<meta property="article:modified_time" content="2022-12-12T16:14:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Akka 学习（七）Actor的生命周期</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考文章</p> 
<ul><li><a href="https://gitter.im/akka/akka?source=orgpage" rel="nofollow">Gitter Chat</a>，Akka 在线交流平台</li><li><a href="https://discuss.lightbend.com/c/akka/" rel="nofollow">Akka Forums</a>，Akka 论坛</li><li><a href="https://github.com/akka/akka">Akka in GitHub</a>，Akka 开源项目仓库</li><li><a href="https://akka.io/" rel="nofollow">Akka Official Website</a>，Akka 官网</li><li><a href="https://doc.akka.io/japi/akka/2.6/overview-summary.html" rel="nofollow">Akka Java API</a>，Akka 应用程序编程接口</li><li>《Akka入门与实践》 [加]Jason Goodwin（贾森·古德温）</li></ul> 
<p>文章系列</p> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128210469">Akka 学习（一）Actor 初步认识与环境搭建</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128210518">Akka 学习（二）第一个入门程序</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128219064">Akka 学习（三）Actor的基本使用</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128219098">Akka 学习（四）Remote Actor</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128259074">Akka 学习（五）消息传递的方式</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128259681">Akka 学习（六）Actor的监督机制</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128269188">Akka 学习（七）Actor的生命周期</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128277337?spm=1001.2014.3001.5502">Akka 学习（八）路由与Dispatcher</a> 已完成</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <a href="https://blog.csdn.net/weixin_44451022/article/details/128286970?spm=1001.2014.3001.5502">Akka 学习（九）Akka Cluster</a> 已完成</li></ul> 
<p>Akka 基础篇就此结束了，Akka基础篇主要介绍Akka的基本概念与一些基本术语，使用方式<br> 代码：<a href="https://github.com/Eason-shu/Akka">https://github.com/Eason-shu/Akka</a><br> 在Actor的生命周期中会调用几个方法，我们在需要时可以重写这些方法。<br> ● prestart()：在构造函数之后调用。<br> ● postStop()：在重启之前调用。<br> ● preRestart(reason, message)：默认情况下会调用postStop()。<br> ● postRestart()：默认情况下会调用preStart()。</p> 
<h2><a id="__28"></a>一 生命周期</h2> 
<h3><a id="11__29"></a>1.1 基本介绍</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>shu</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span><span class="token class-name">AbstractActor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">scala<span class="token punctuation">.</span></span><span class="token class-name">Option</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description: 生命周期ActorDemo
 * @author: shu
 * @createDate: 2022/12/10 11:33
 * @version: 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LifeActorDemo</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractActor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 在构造函数之后调用 ,可以完成一些初始化
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 在重启之前调用
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 即将重启"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    


    <span class="token comment">/**
     * 要注意的是preRestart和postRestart只在重启的时候才会被调用。它们默认调用了preStart和postStop，但是调用它们的时候就不再直接调用preStart和postStop了。
     * @param reason
     * @param message
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preRestart</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> reason<span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preRestart</span><span class="token punctuation">(</span>reason<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 即将重启 调用preStart初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token comment">/**
     * 要注意的是preRestart和postRestart只在重启的时候才会被调用。它们默认调用了preStart和postStop，但是调用它们的时候就不再直接调用preStart和postStop了。
     * @param reason
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postRestart</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> reason<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postRestart</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 即将重启 调用postStop方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 收到消息
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Receive</span> <span class="token function">createReceive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>要注意的是preRestart和postRestart只在重启的时候才会被调用。它们默认调用了preStart和postStop，但是调用它们的时候就不再直接调用preStart和postStop了。</li><li>这样我们就能够决定，到底是只在Actor启动或停止的时候调用一次preStart和postStop，还是每次重启一个Actor的时候就调用preStart和postStop。</li></ul> 
<p><img src="https://images2.imgbox.com/7d/52/RtqYWHeX_o.jpg" alt="epub_22651331_38.jpg"></p> 
<h3><a id="12__112"></a>1.2 自定义监督策略</h3> 
<p>重写Actor的supervisorStrategy方法</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 可以制定系你的监督策越
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SupervisorStrategy</span> <span class="token function">supervisorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//         super.supervisorStrategy();</span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OneForOneStrategy</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"1 minute"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PartialFunction</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="13_killActor_125"></a>1.3 终止或kill一个Actor</h3> 
<p>有多种不同的方法可以用来停止一个Actor，下面任一方法都可以停止Actor：<br> ● 调用ActorSystem.stop(actorRef)；<br> ● 调用ActorContext.stop(actorRef)；<br> ● 给Actor发送一条PoisonPill消息，会在Actor完成消息处理后将其停止；<br> ● 给Actor发送一条kill消息，会导致Actor抛出ActorKilledException异常</p> 
<blockquote> 
 <p>对比</p> 
</blockquote> 
<ol><li>调用context.stop或system.stop会导致Actor立即停止</li><li>发送PoisonPill消息则会在Actor处理完消息后将其停止</li><li>不同的是，kill不会马上直接停止Actor，而是会导致Actor抛出一个ActorKilledException，</li></ol> 
<h3><a id="14_DeathWatch_136"></a>1.4 生命周期监控和DeathWatch</h3> 
<ul><li>监督机制描述了如何对子Actor的状态进行响应。</li><li>而Actor也可以对其他任何Actor进行监督。</li><li>通过调用context.watch(actorRef)注册后，Actor就能够监控另一个Actor的终止，而调用context.unwatch(actorRef)就可以取消监控注册。</li><li>如果被监控的Actor停止了，负责监控的Actor就会收到一条Terminated(ActorRef)消息。</li></ul> 
<h3><a id="15__142"></a>1.5 状态</h3> 
<p>我们已经介绍过，Actor能够安全地存储状态，它允许我们使用无锁的方式并发处理状态，现在我们就来介绍Actor如何通过不同的状态来改变它的行为。</p> 
<h4><a id="151_stash_144"></a>1.5.1 在状态之间暂存消息（stash）</h4> 
<ul><li>Akka提供了一种叫做stash的机制来支持这一功能。stash消息会把消息暂存到一个独立的队列中，该队列中存储目前无法处理的消息</li><li>unstash则把消息从暂存队列中取出，放回邮箱队列中，Actor就能继续处理这些消息了。</li><li>在我们实际开发中，比如终端不在线，需要上线后执行一些操作，我就可以用这个机制来解决这个问题，实际上就是把消息缓存到一个队列中，但是如果缓存过多会造成内存泄漏，邮箱拥挤。</li></ul> 
<pre><code class="prism language-java">        <span class="token keyword">if</span><span class="token punctuation">(</span>cantHandleMessage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 缓存消息</span>
            <span class="token function">stash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理消息</span>
            <span class="token function">handleMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 取出消息</span>
            unstash（）
        <span class="token punctuation">}</span> 
</code></pre> 
<p>要注意的是，虽然stash()和unstash()在希望快速改变状态的时候使用起来非常方便，但是stash消息的状态一定要和某个时间限制进行绑定，否则就有可能填满邮箱。</p> 
<blockquote> 
 <p>案例</p> 
</blockquote> 
<pre><code class="prism language-java">        <span class="token keyword">private</span> <span class="token class-name">Boolean</span> online <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">PartialFunction</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">RecieveBuilder</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>online<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                          <span class="token function">processMessage</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">stash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Connected</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    online <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token function">unstash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Disconnected</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> online <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="152_HotswapBecomeUnbecome_181"></a>1.5.2 热交换（Hotswap）:Become/Unbecome</h4> 
<p>Akka提供了become()和unbecome()，用于管理不同的行为，这一用法可以大大改善代码的可读性。在Actor的context()中，有两个方法：<br> ● become(PartialFunction behavior)：这个方法将receive块中定义的行为修改为一个新的PartialFunction。<br> ● unbecome()：这个方法将Actor的行为修改回默认行为。</p> 
<pre><code class="prism language-java">        <span class="token keyword">public</span> <span class="token class-name">PartialFunction</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">RecieveBuilder</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token function">stash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Connected</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">become</span><span class="token punctuation">(</span>online<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">unstash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token keyword">private</span> <span class="token class-name">PartialFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">BoxedUnit</span><span class="token punctuation">&gt;</span></span> <span class="token function">online</span><span class="token punctuation">(</span>
            <span class="token keyword">final</span> <span class="token class-name">ActorRef</span> another<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token class-name">RecieveBuilder</span>
                    <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token function">processMessage</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre> 
<p>每个状态的行为都定义在自己独立的PartialFunction中，在PartialFunction中，使用模式匹配来定义不同的行为。这样我们就能够互不影响地阅读Actor中不同状态的行为。</p> 
<h4><a id="153_Finite_State_Machine_FSM_203"></a>1.5.3 有限自动机（Finite State Machine, FSM）</h4> 
<p>和热交换很相似的是，FSM中也有状态以及基于状态的行为变化，跟热交换比起来，FSM是一个更重量级的抽象概念，需要更多的代码和类型才能够实现并运行。所以通常来说，热交换是一个更简单、可读性更高的选择。</p> 
<pre><code class="prism language-java">        <span class="token function">when</span><span class="token punctuation">(</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">,</span>
            <span class="token function">matchEvent</span><span class="token punctuation">(</span><span class="token class-name">FlushMsg</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    container<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token class-name">Tcp<span class="token punctuation">.</span>Connected</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                          <span class="token keyword">return</span> <span class="token function">goTo</span><span class="token punctuation">(</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                          <span class="token keyword">return</span> <span class="token function">goTo</span><span class="token punctuation">(</span><span class="token constant">CONNECTED_AND_PENDING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span><span class="token constant">CONNECTED</span><span class="token punctuation">,</span>
            <span class="token function">matchEvent</span><span class="token punctuation">(</span><span class="token class-name">FlushMsg</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    container<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token function">goTo</span><span class="token punctuation">(</span><span class="token constant">CONNECTED_AND_PENDING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">when</span><span class="token punctuation">(</span><span class="token constant">CONNECTED_AND_PENDING</span><span class="token punctuation">,</span>
            <span class="token function">matchEvent</span><span class="token punctuation">(</span><span class="token class-name">FlushMsg</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">stay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token class-name">GetRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                container<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">goTo</span><span class="token punctuation">(</span><span class="token constant">CONNECTED_AND_PENDING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">scala<span class="token punctuation">.</span></span>PartialFunction</span> pf <span class="token operator">=</span> <span class="token class-name">ReceiveBuilder</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            x <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span><span class="token constant">CONNECTED</span><span class="token punctuation">,</span> pf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="17__240"></a>1.7 案例</h3> 
<p>结构图<br> 纯属虚构，方便自己理解上面的知识（Java代码实现）<br> <img src="https://images2.imgbox.com/1a/c5/DX8ygwKF_o.jpg" alt=""></p> 
<blockquote> 
 <p>失败生命周期的处理</p> 
</blockquote> 
<p>● prestart()：在构造函数之后调用。<br> ● postStop()：在重启之前调用。<br> ● preRestart(reason, message)：默认情况下会调用postStop()。<br> ● postRestart()：默认情况下会调用preStart()。<br> <img src="https://images2.imgbox.com/52/a3/mqsO7hor_o.png" alt="image.png"><br> 我们可以发现当Actor内部发生了错误，他并不是终止了程序而是重新启动。</p> 
<blockquote> 
 <p>自定义监督策越</p> 
</blockquote> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 自定义监督策越
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SupervisorStrategy</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OneForOneStrategy</span><span class="token punctuation">(</span>
                    <span class="token number">10</span><span class="token punctuation">,</span>
                    <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">DeciderBuilder</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">matchAny</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">escalate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 自定义策越
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SupervisorStrategy</span> <span class="token function">supervisorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>10和Duration.create(1, TimeUnit.MINUTES)分别传递给maxNrOfRetries和withinTimeRange参数，这意味着策略每分钟重新启动一个子级最多10次。如果在withinTimeRange持续时间内重新启动计数超过maxNrOfRetries，则子 Actor 将停止。</p> 
<blockquote> 
 <p>基本效果图</p> 
</blockquote> 
<ul><li>服务端</li></ul> 
<ol><li>上线</li><li>请求数据</li><li>下线</li></ol> 
<p><img src="https://images2.imgbox.com/e9/77/oPvrsnR8_o.png" alt="image.png"></p> 
<ul><li>客服端</li></ul> 
<p><img src="https://images2.imgbox.com/88/26/dKUKXxmN_o.png" alt="image.png"></p> 
<blockquote> 
 <p>关键代码</p> 
</blockquote> 
<ul><li>服务端</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>shu<span class="token punctuation">.</span>terminal</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Tcp</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>japi<span class="token punctuation">.</span></span><span class="token class-name">Function</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>japi<span class="token punctuation">.</span>pf<span class="token punctuation">.</span></span><span class="token class-name">DeciderBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>japi<span class="token punctuation">.</span>pf<span class="token punctuation">.</span></span><span class="token class-name">ReceiveBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span></span><span class="token class-name">AskableActorRef</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Timeout</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>shu<span class="token punctuation">.</span>meter<span class="token punctuation">.</span></span><span class="token class-name">MeterDemoActor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">pojo<span class="token punctuation">.</span></span><span class="token class-name">Login</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">pojo<span class="token punctuation">.</span></span><span class="token class-name">Logout</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">pojo<span class="token punctuation">.</span></span><span class="token class-name">Meter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">pojo<span class="token punctuation">.</span></span><span class="token class-name">MeterRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">scala<span class="token punctuation">.</span></span><span class="token class-name">Option</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">scala<span class="token punctuation">.</span></span><span class="token class-name">PartialFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Await</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">scala<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">scala<span class="token punctuation">.</span>compat<span class="token punctuation">.</span>java8<span class="token punctuation">.</span></span><span class="token class-name">FutureConverters</span><span class="token punctuation">.</span><span class="token static">toJava</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletionStage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description:
 * @author: shu
 * @createDate: 2022/12/10 14:52
 * @version: 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TerminalDemoActor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractActor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 自定义监督策越
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SupervisorStrategy</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OneForOneStrategy</span><span class="token punctuation">(</span>
                    <span class="token number">10</span><span class="token punctuation">,</span>
                    <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">DeciderBuilder</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">matchAny</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">SupervisorStrategy<span class="token punctuation">.</span>Directive</span><span class="token punctuation">)</span> <span class="token class-name">SupervisorStrategy</span><span class="token punctuation">.</span><span class="token function">escalate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 在线状态
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> <span class="token class-name">Online</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 在构造函数之后调用 ,可以完成一些初始化
     *
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 在重启之前调用
     *
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 即将重启"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 要注意的是preRestart和postRestart只在重启的时候才会被调用。它们默认调用了preStart和postStop，但是调用它们的时候就不再直接调用preStart和postStop了。
     *
     * @param reason
     * @param message
     * @throws Exception
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preRestart</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> reason<span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">preRestart</span><span class="token punctuation">(</span>reason<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Life 即将重启 调用preStart初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 自定义策越
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SupervisorStrategy</span> <span class="token function">supervisorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 收到小消息
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Receive</span> <span class="token function">createReceive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ReceiveBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 连接成功</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Login</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 在线状态改变</span>
                    <span class="token function">setOnline</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 回应消息,登录成功</span>
                    <span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到登录请求"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 连接成功</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Logout</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> x <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 在线状态改变</span>
                    <span class="token function">setOnline</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 回应消息,登录成功</span>
                    <span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到注销请求"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 请求数据</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">MeterRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 在线</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getOnline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 获取消息</span>
                        <span class="token class-name">Future</span> sFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AskableActorRef</span><span class="token punctuation">(</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">actorOf</span><span class="token punctuation">(</span><span class="token class-name">Props</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MeterDemoActor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span><span class="token class-name">Timeout</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meter</span><span class="token punctuation">&gt;</span></span> cs <span class="token operator">=</span> <span class="token function">toJava</span><span class="token punctuation">(</span>sFuture<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meter</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Meter</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> cs<span class="token punctuation">;</span>
                        <span class="token comment">// 消息发送给客服端</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 未找到消息</span>
                <span class="token punctuation">.</span><span class="token function">matchAny</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span>
                        <span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tell</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Status<span class="token punctuation">.</span>Failure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">getOnline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Online</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnline</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span> online<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Online</span> <span class="token operator">=</span> online<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>客服端</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">client</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span><span class="token class-name">ActorSelection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>actor<span class="token punctuation">.</span></span><span class="token class-name">ActorSystem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span></span><span class="token class-name">AskableActorSelection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">akka<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Timeout</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">pojo<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletionStage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">scala<span class="token punctuation">.</span>compat<span class="token punctuation">.</span>java8<span class="token punctuation">.</span></span><span class="token class-name">FutureConverters</span><span class="token punctuation">.</span><span class="token static">toJava</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description:
 * @author: shu
 * @createDate: 2022/12/10 18:22
 * @version: 1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TerminalClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ActorSystem</span> system <span class="token operator">=</span> <span class="token class-name">ActorSystem</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"LocalSystem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ActorSelection</span> remoteTerminal<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TerminalClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> remoteAddress<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        remoteTerminal <span class="token operator">=</span> system<span class="token punctuation">.</span><span class="token function">actorSelection</span><span class="token punctuation">(</span><span class="token string">"akka.tcp://terminal@"</span> <span class="token operator">+</span>
                remoteAddress<span class="token operator">+</span> <span class="token string">"/user/terminal-server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 获取消息
     * @param key
     * @param value
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CompletionStage</span> <span class="token function">getMeterInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">toJava</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AskableActorSelection</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MeterRequest</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Timeout</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 上线
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CompletionStage</span> <span class="token function">sendLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">toJava</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AskableActorSelection</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span><span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Timeout</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 下线
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CompletionStage</span> <span class="token function">sendLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">toJava</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AskableActorSelection</span><span class="token punctuation">(</span>remoteTerminal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Logout</span><span class="token punctuation">(</span><span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Timeout</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre> 
<p>具体案例代码：<a href="https://github.com/Eason-shu/Akka">https://github.com/Eason-shu/Akka</a><br> demo03 ,demo04</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ab5b81277c7ce8c55c2cf12efdb77c65/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VUE父子组件动态显示或隐藏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27da470ead26de48932a0c8e4a8fe2f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">两种方式实现Kepware与PLC之间的心跳检测</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>