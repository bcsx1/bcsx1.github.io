<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2022 Pwnhub冬季赛 WP - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2022 Pwnhub冬季赛 WP" />
<meta property="og:description" content="2022 Pwnhub冬季赛 笔者以星盟安全团队队员的身份参与了本次比赛，在队内师傅们的共同努力下，最终取得了较为理想的成绩。
赛中，笔者AK了密码，非预期出了两道AI题，以及半道Airdrop取证相关的MISC题，这里便仅对以上题目进行记录、分享。
排名 rank 3
Crypto ASR 题目 from gmpy2 import * from Crypto.Util.number import * from secret import flag m = bytes_to_long(flag) R = getPrime(256) S = getPrime(512) A = getPrime(1024) N = R * S * A c = pow(m, 0x10001, N) RA = R &amp; A print(&#39;RSA1&#39;,hex(RA * S)) print(&#39;RSA2&#39;,hex(RA | S)) print(&#39;c&#39;, hex(c)) print(&#39;N&#39;,hex(N)) # RSA1 0x97be543979cb98c109103fa118c1c930ff13a6b2562166417021afd6e46cb0837a5cc5f4094fcea5fcc33efdfa495050e0fb8269922b3ee2d403210ed1ba339af2dc3d4e8952f0c784fcc655436cf255b98cdaf8080df47f6c28bc0bae68c713 # RSA2 0xa887aa84f3a0bd8b79ed59a7bb98d8e58a85414f85cf2ddf53ff4bd9294bfdadf7d6d6adfe7fbed55fc71b5a6bfcfe79ced27e2f41e7546a8679daf5b63dda37 # c 0x2f62fb7e7e8e27823193119f8412050ade9084ade25261a5875da23a07d5d5145e72d460697984d8aa668a25822009a4fdc85df2b208941cd3219b312f21c3c7bc4ef7aa8c18b4f91a0e815fe1892fca0f72406e571fbd0fea2c4710c601165ccd7e8a5a828721a5e2c956b732223d683d1413ef393b5f80a431c52bf9099e22b8e27daafb9d3e055242b89b5419b8925744ccf348e1bea519225af8efe7dbcc202425251039cbfe6b892a7fcf7e9d72224ea9381e3fb32ab837139af4b4112a3c7a6571c88e7d6c5db4c3f91e25edd15eb5544ef2f29a9e1bb1062ec86f1902 # N 0x58a7ff25292651e1a8d82656d64fe3b458d6e688405e85aa6c02e0c33469ad3dbaef6c6eaf8faf22f2d15e80856ab7b90a40fd50c36f7b59932bc94e6fb4fabefa87b11bf4ef74df4ccf8d254f0c6812628df3c5b3786af35e3dde9c87b462d1a565af6f100750718ccb7235174947f00cec5836765150f1680d0c58a5f9ea2473a6033c218c75664dc53377dde9386f37e1a89d77e61a716129d290c5a41f81cd3490bab6fe51f232ab27cb1ac9c8eb88e908c12109a125b7439c25b6879283a17a3467823fbb089709eb836cfd03386cc4bf186eb45401472ab0bdec605fd7 题解 R S A 1 = R A ∗ S RSA1=RA * S RSA1=RA∗S 且 N = R ∗ S ∗ A N = R * S * A N=R∗S∗A， 易知: S = g c d ( R S A 1 , N ) S = gcd(RSA1, N) S=gcd(RSA1,N)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/49533920bc7eff1bb9ca427e2a107e38/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-21T20:37:05+08:00" />
<meta property="article:modified_time" content="2022-12-21T20:37:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2022 Pwnhub冬季赛 WP</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="2022_Pwnhub_0"></a>2022 Pwnhub冬季赛</h2> 
<p>笔者以<a href="https://jq.qq.com/?_wv=1027&amp;k=01xVK4gp" rel="nofollow"><strong>星盟安全团队</strong></a>队员的身份参与了本次比赛，在队内师傅们的共同努力下，最终取得了较为理想的成绩。</p> 
<p>赛中，笔者AK了密码，非预期出了两道AI题，以及半道Airdrop取证相关的MISC题，这里便仅对以上题目进行记录、分享。</p> 
<h3><a id="_6"></a>排名</h3> 
<p><strong>rank 3</strong><br> <img src="https://images2.imgbox.com/19/e1/eYObuleR_o.png" alt="rank 3"></p> 
<h3><a id="Crypto_11"></a>Crypto</h3> 
<h4><a id="ASR_13"></a>ASR</h4> 
<h5><a id="_15"></a>题目</h5> 
<pre><code class="prism language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

R <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
S <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
A <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

N <span class="token operator">=</span> R <span class="token operator">*</span> S <span class="token operator">*</span> A
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">0x10001</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>

RA <span class="token operator">=</span> R <span class="token operator">&amp;</span> A
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'RSA1'</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>RA <span class="token operator">*</span> S<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'RSA2'</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>RA <span class="token operator">|</span> S<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># RSA1 0x97be543979cb98c109103fa118c1c930ff13a6b2562166417021afd6e46cb0837a5cc5f4094fcea5fcc33efdfa495050e0fb8269922b3ee2d403210ed1ba339af2dc3d4e8952f0c784fcc655436cf255b98cdaf8080df47f6c28bc0bae68c713</span>
<span class="token comment"># RSA2 0xa887aa84f3a0bd8b79ed59a7bb98d8e58a85414f85cf2ddf53ff4bd9294bfdadf7d6d6adfe7fbed55fc71b5a6bfcfe79ced27e2f41e7546a8679daf5b63dda37</span>
<span class="token comment"># c 0x2f62fb7e7e8e27823193119f8412050ade9084ade25261a5875da23a07d5d5145e72d460697984d8aa668a25822009a4fdc85df2b208941cd3219b312f21c3c7bc4ef7aa8c18b4f91a0e815fe1892fca0f72406e571fbd0fea2c4710c601165ccd7e8a5a828721a5e2c956b732223d683d1413ef393b5f80a431c52bf9099e22b8e27daafb9d3e055242b89b5419b8925744ccf348e1bea519225af8efe7dbcc202425251039cbfe6b892a7fcf7e9d72224ea9381e3fb32ab837139af4b4112a3c7a6571c88e7d6c5db4c3f91e25edd15eb5544ef2f29a9e1bb1062ec86f1902</span>
<span class="token comment"># N 0x58a7ff25292651e1a8d82656d64fe3b458d6e688405e85aa6c02e0c33469ad3dbaef6c6eaf8faf22f2d15e80856ab7b90a40fd50c36f7b59932bc94e6fb4fabefa87b11bf4ef74df4ccf8d254f0c6812628df3c5b3786af35e3dde9c87b462d1a565af6f100750718ccb7235174947f00cec5836765150f1680d0c58a5f9ea2473a6033c218c75664dc53377dde9386f37e1a89d77e61a716129d290c5a41f81cd3490bab6fe51f232ab27cb1ac9c8eb88e908c12109a125b7439c25b6879283a17a3467823fbb089709eb836cfd03386cc4bf186eb45401472ab0bdec605fd7</span>
</code></pre> 
<h5><a id="_43"></a>题解</h5> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         R 
        
       
         S 
        
       
         A 
        
       
         1 
        
       
         = 
        
       
         R 
        
       
         A 
        
       
         ∗ 
        
       
         S 
        
       
      
        RSA1=RA * S 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">RS</span><span class="mord mathnormal">A</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">R</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span></span></span></span></span> 且<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
         = 
        
       
         R 
        
       
         ∗ 
        
       
         S 
        
       
         ∗ 
        
       
         A 
        
       
      
        N = R * S * A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0077em;">R</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span>， 易知: <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         S 
        
       
         = 
        
       
         g 
        
       
         c 
        
       
         d 
        
       
         ( 
        
       
         R 
        
       
         S 
        
       
         A 
        
       
         1 
        
       
         , 
        
       
         N 
        
       
         ) 
        
       
      
        S = gcd(RSA1, N) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0576em;">RS</span><span class="mord mathnormal">A</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mclose">)</span></span></span></span></span></p> 
<p>由题目可知，S是512位的大数，一般flag转数字后是没512位那么大的。再根据同余式性质，可以直接把N的因子S<strong>当作新的模数n</strong></p> 
<p>而素数S的欧拉函数有: <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         p 
        
       
         h 
        
       
         i 
        
       
         = 
        
       
         S 
        
       
         − 
        
       
         1 
        
       
      
        phi = S-1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>. 再下来，就是最基本的RSA解密了.</p> 
<p>至于为什么能<strong>篡改N</strong>，这里给出证明如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
           
             n 
            
           
          
          
           
            
             
            
              = 
             
            
              p 
             
            
              ∗ 
             
            
              q 
             
            
           
          
         
         
          
           
           
             c 
            
           
          
          
           
            
             
            
              = 
             
             
             
               m 
              
             
               e 
              
             
             
             
             
             
               m 
              
             
               o 
              
             
               d 
              
               
            
              n 
             
            
           
          
         
         
          
           
            
            
              c 
             
            
              + 
             
            
              k 
             
            
              • 
             
            
              p 
             
            
              • 
             
            
              q 
             
            
           
          
          
           
            
             
            
              = 
             
             
             
               m 
              
             
               e 
              
             
            
           
          
         
         
          
           
           
             c 
            
           
          
          
           
            
             
            
              = 
             
             
             
               m 
              
             
               e 
              
             
             
             
             
             
               m 
              
             
               o 
              
             
               d 
              
               
            
              p 
             
            
           
          
         
        
       
         \begin{aligned} n &amp;= p*q \\ c &amp;= m^e \mod n \\ c +k•p•q &amp;= m^e \\ c &amp;= m^e \mod p \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6em; vertical-align: -2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span><span class="mord">•</span><span class="mord mathnormal">p</span><span class="mord">•</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.25em;"><span class="" style="top: -5.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span></span></span><span class="" style="top: -3.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7144em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7144em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -0.91em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7144em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right: 1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.75em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br> 再推广下，无论n有多少因子构成，只要求出<strong>n的任何一个因子其实都可以拿来当新的n来用</strong></p> 
<p>但若要正确求出明文，就还得满足<strong>这个因子大于m</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum

RSA1 <span class="token operator">=</span> <span class="token number">0x97be543979cb98c109103fa118c1c930ff13a6b2562166417021afd6e46cb0837a5cc5f4094fcea5fcc33efdfa495050e0fb8269922b3ee2d403210ed1ba339af2dc3d4e8952f0c784fcc655436cf255b98cdaf8080df47f6c28bc0bae68c713</span>
c <span class="token operator">=</span> <span class="token number">0x2f62fb7e7e8e27823193119f8412050ade9084ade25261a5875da23a07d5d5145e72d460697984d8aa668a25822009a4fdc85df2b208941cd3219b312f21c3c7bc4ef7aa8c18b4f91a0e815fe1892fca0f72406e571fbd0fea2c4710c601165ccd7e8a5a828721a5e2c956b732223d683d1413ef393b5f80a431c52bf9099e22b8e27daafb9d3e055242b89b5419b8925744ccf348e1bea519225af8efe7dbcc202425251039cbfe6b892a7fcf7e9d72224ea9381e3fb32ab837139af4b4112a3c7a6571c88e7d6c5db4c3f91e25edd15eb5544ef2f29a9e1bb1062ec86f1902</span>
N <span class="token operator">=</span> <span class="token number">0x58a7ff25292651e1a8d82656d64fe3b458d6e688405e85aa6c02e0c33469ad3dbaef6c6eaf8faf22f2d15e80856ab7b90a40fd50c36f7b59932bc94e6fb4fabefa87b11bf4ef74df4ccf8d254f0c6812628df3c5b3786af35e3dde9c87b462d1a565af6f100750718ccb7235174947f00cec5836765150f1680d0c58a5f9ea2473a6033c218c75664dc53377dde9386f37e1a89d77e61a716129d290c5a41f81cd3490bab6fe51f232ab27cb1ac9c8eb88e908c12109a125b7439c25b6879283a17a3467823fbb089709eb836cfd03386cc4bf186eb45401472ab0bdec605fd7</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
S <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>RSA1<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span>
phi <span class="token operator">=</span> S<span class="token operator">-</span><span class="token number">1</span>
d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag{b66f68258f184bd7afddd32c1518eed0}</span>
</code></pre> 
<h4><a id="_76"></a>大杂烩</h4> 
<h5><a id="_78"></a>题目</h5> 
<pre><code class="prism language-python"><span class="token comment"># sage</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> random <span class="token keyword">import</span> <span class="token operator">*</span>

padding <span class="token operator">=</span> <span class="token keyword">lambda</span> num<span class="token punctuation">,</span> bit_len<span class="token punctuation">:</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">512</span> <span class="token operator">-</span> bit_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> getrandbits<span class="token punctuation">(</span><span class="token number">512</span> <span class="token operator">-</span> bit_len<span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token string">b'**************************************'</span>
m1<span class="token punctuation">,</span> m2 <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> next_prime<span class="token punctuation">(</span>padding<span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m1<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> next_prime<span class="token punctuation">(</span>padding<span class="token punctuation">(</span>m2<span class="token punctuation">,</span> m2<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
e <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">,</span> b <span class="token operator">=</span> e <span class="token operator">&amp;</span> <span class="token number">0x3ffffffffff</span><span class="token punctuation">,</span> e <span class="token operator">&gt;&gt;</span> <span class="token number">42</span>
N <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
E <span class="token operator">=</span> EllipticCurve<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>
NN <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
S <span class="token operator">=</span> inverse<span class="token punctuation">(</span>getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NN<span class="token punctuation">)</span> <span class="token operator">*</span> inverse<span class="token punctuation">(</span>getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NN<span class="token punctuation">)</span>
d1 <span class="token operator">=</span> d <span class="token operator">&gt;&gt;</span> <span class="token number">512</span>
d2 <span class="token operator">=</span> d <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">512</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
enc1 <span class="token operator">=</span> S <span class="token operator">*</span> d1 <span class="token operator">%</span> NN
enc2 <span class="token operator">=</span> S <span class="token operator">*</span> d2 <span class="token operator">%</span> NN

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n ='</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a ='</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'N ='</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'POINT ='</span><span class="token punctuation">,</span> E<span class="token punctuation">.</span>lift_x<span class="token punctuation">(</span><span class="token number">996</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'enc1 ='</span><span class="token punctuation">,</span> enc1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'enc2 ='</span><span class="token punctuation">,</span> enc2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'NN ='</span><span class="token punctuation">,</span> NN<span class="token punctuation">)</span>


<span class="token comment"># n = 117749279680045360245987277946945707343578937283621512842997606104123872211782263906911929773756533011817679794905642225389185861207256322349591633257348367854563703050789889773031032949742664695416275919382068347995088593380486820784360816053546651916291080971628354468517506190756456913824397593128781030749</span>
<span class="token comment"># a = 1755716071599</span>
<span class="token comment"># N = 236038564943567983056828121309828109017</span>
<span class="token comment"># POINT = (996 : 151729833458737979764886336489671975339 : 1)</span>
<span class="token comment"># enc1 = 98662590652068949920571979585725979127266112216583776160769090971169664292493813021843624362593669574513220457664819153878956311077379392531742253343961645534972639309537402874636739745717765969720117162780620981639015788423324884640935466801234207019510919768602974162878323777374364290185048275714332671356</span>
<span class="token comment"># enc2 = 58738699705013897273174837829098879580829898980458718341881900446701910685043213698485036350888862454440118347362218485065377354137391792039111639199258042591959084091242821874819864955504791788260187064338245516327147327866373690756260239728218244294166383516151782123688633986853602732137707507845681977204</span>
<span class="token comment"># NN = 149794788177729409820185150543033616327574456754306207341321223589733698623477041345453230785413920341465642754285280273761269552897080096162195035057667200692677841848045965505750839903359478511509753781737513122660495056746669041957643882516287304836822410136985711091802722010788615177574143908444311475347</span>
</code></pre> 
<h5><a id="_123"></a>题解</h5> 
<ol><li><a href="https://stackoverflow.com/questions/11043648/calculate-the-y-coordinate-of-a-point-of-a-elliptic-curve-with-sage" rel="nofollow">解方程</a>求b，恢复出e</li><li><a href="https://blog.soreatu.com/posts/an-introduction-to-ntruencrypt-through-a-ctf-challenge/" rel="nofollow">构造格</a>求出d1、d2，恢复出d</li><li><a href="https://aidaip.github.io/crypto/2019/08/21/RSA-%E5%B7%B2%E7%9F%A5ed%E5%88%86%E8%A7%A3n.html" rel="nofollow">已知e、d分解n</a>，得到p、q</li><li>由p、q恢复出flag</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># Sage</span>
<span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> libnum
<span class="token keyword">import</span> random

a <span class="token operator">=</span> <span class="token number">1755716071599</span>
N <span class="token operator">=</span> <span class="token number">236038564943567983056828121309828109017</span>
x<span class="token punctuation">,</span>y <span class="token operator">=</span> <span class="token number">996</span><span class="token punctuation">,</span><span class="token number">151729833458737979764886336489671975339</span>
PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># y^2 = x^3 + a*x + b</span>
f <span class="token operator">=</span> x<span class="token operator">^</span><span class="token number">3</span><span class="token operator">+</span>a<span class="token operator">*</span>x<span class="token operator">+</span>b<span class="token operator">-</span>y<span class="token operator">^</span><span class="token number">2</span>
b <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token operator">&lt;&lt;</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">+</span>a



enc1 <span class="token operator">=</span> <span class="token number">98662590652068949920571979585725979127266112216583776160769090971169664292493813021843624362593669574513220457664819153878956311077379392531742253343961645534972639309537402874636739745717765969720117162780620981639015788423324884640935466801234207019510919768602974162878323777374364290185048275714332671356</span>
enc2 <span class="token operator">=</span> <span class="token number">58738699705013897273174837829098879580829898980458718341881900446701910685043213698485036350888862454440118347362218485065377354137391792039111639199258042591959084091242821874819864955504791788260187064338245516327147327866373690756260239728218244294166383516151782123688633986853602732137707507845681977204</span>
NN <span class="token operator">=</span> <span class="token number">149794788177729409820185150543033616327574456754306207341321223589733698623477041345453230785413920341465642754285280273761269552897080096162195035057667200692677841848045965505750839903359478511509753781737513122660495056746669041957643882516287304836822410136985711091802722010788615177574143908444311475347</span>

A<span class="token punctuation">,</span> d1 <span class="token operator">=</span> matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> enc1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> NN<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
A<span class="token punctuation">,</span> d2 <span class="token operator">=</span> matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> enc2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> NN<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
d1 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
d2 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span>
d2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token punctuation">(</span>d1<span class="token operator">&lt;&lt;</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token operator">+</span>d2


n <span class="token operator">=</span> <span class="token number">117749279680045360245987277946945707343578937283621512842997606104123872211782263906911929773756533011817679794905642225389185861207256322349591633257348367854563703050789889773031032949742664695416275919382068347995088593380486820784360816053546651916291080971628354468517506190756456913824397593128781030749</span>

<span class="token keyword">def</span> <span class="token function">divide_pq</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> e<span class="token operator">*</span>d <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        t <span class="token operator">=</span> k
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> t <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            t <span class="token operator">//=</span> <span class="token number">2</span>
            x <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            <span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">and</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> n<span class="token operator">//</span>p<span class="token punctuation">)</span>

p<span class="token punctuation">,</span> q <span class="token operator">=</span> divide_pq<span class="token punctuation">(</span>e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">if</span> p<span class="token operator">&gt;</span>q<span class="token punctuation">:</span>
    p<span class="token punctuation">,</span>q <span class="token operator">=</span> q<span class="token punctuation">,</span>p
    
list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
num <span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    flag1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>p <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">512</span> <span class="token operator">-</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'flag{'</span> <span class="token keyword">in</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            list1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    num <span class="token operator">+=</span> <span class="token number">1</span>
flag2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>q<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token operator">-</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>flag2<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># flag{e89f47939d12434cb201080d8b240774}</span>
</code></pre> 
<h4><a id="payorder_195"></a>payorder</h4> 
<h5><a id="_197"></a>题目</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/python3</span>
<span class="token comment">#coding:utf-8</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> string
<span class="token keyword">import</span> random
<span class="token keyword">import</span> signal
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> sha256
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token punctuation">,</span> b64decode

coins <span class="token operator">=</span> <span class="token number">1000</span>
sk <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>string<span class="token punctuation">.</span>printable<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

flags <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'fl'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'la'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'ag'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'fla'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'lag'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> name<span class="token punctuation">,</span> coin <span class="token keyword">in</span> flags<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">:</span><span class="token format-spec">4s</span><span class="token punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>coin<span class="token punctuation">:</span><span class="token format-spec">6d</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        x <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    _id <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Which one? '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    product<span class="token punctuation">,</span> price <span class="token operator">=</span> flags<span class="token punctuation">[</span>_id<span class="token punctuation">]</span>
    timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000000</span><span class="token punctuation">)</span>
    link <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'p=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>product<span class="token punctuation">}</span></span><span class="token string">&amp;c=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>price<span class="token punctuation">}</span></span><span class="token string">&amp;t=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>timestamp<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    sign <span class="token operator">=</span> sha256<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'k=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sk<span class="token punctuation">}</span></span><span class="token string">&amp;</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>link<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    link <span class="token operator">=</span> b64encode<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>link<span class="token punctuation">}</span></span><span class="token string">&amp;s=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sign<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Order: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>link<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> coins
    link <span class="token operator">=</span> b64decode<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Order: '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    payments <span class="token operator">=</span> link<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'&amp;'</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> payments<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b's='</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payments<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token string">"Invalid"</span>

    link<span class="token punctuation">,</span> sign <span class="token operator">=</span> link<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> link<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    signchk <span class="token operator">=</span> sha256<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'k=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sk<span class="token punctuation">}</span></span><span class="token string">&amp;'</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> link<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> signchk<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> sign<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Invalid Order!'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">for</span> payment <span class="token keyword">in</span> payments<span class="token punctuation">:</span>
        <span class="token keyword">if</span> payment<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'p='</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            product <span class="token operator">=</span> payment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> payment<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'c='</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            coin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>payment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> coins <span class="token operator">&lt;</span> coin<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Go away you poor bastard!'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    coins <span class="token operator">-=</span> coin
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Your current coins: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>coins<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'You have bought </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>product<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> product <span class="token operator">==</span> <span class="token string">'flag'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Good job! Here is your flag: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>flag<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    funcs <span class="token operator">=</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> order<span class="token punctuation">,</span> pay<span class="token punctuation">,</span> exit<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Welcome Flag Store"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Your Coins: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>coins<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1. Show flags"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2. Get order"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3. Pay coin"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"4. Bye~"</span><span class="token punctuation">)</span>
        funcs<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'&gt; '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    signal<span class="token punctuation">.</span>alarm<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
    menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_285"></a>题解</h5> 
<p>关注如下代码</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> payment <span class="token keyword">in</span> payments<span class="token punctuation">:</span>
  <span class="token keyword">if</span> payment<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'p='</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    product <span class="token operator">=</span> payment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> payment<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'c='</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      coin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>payment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>也就是说，若我们能实现在已有link后加上<code>&amp;p=flag</code>， 且获得对应的sign，便可以低价购买flag</p> 
<p>而为实现这一想法，需要用上<a href="https://xz.aliyun.com/t/2563" rel="nofollow">哈希长度拓展攻击</a></p> 
<blockquote> 
 <p>当知道hash(secret + message)的值及secret长度的情况下，可以轻松推算出hash(secret + message||padding||m’)。在这里m’是任意数据，||是连接符，可以为空,padding是secret后的填充字节。</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> hashpumpy <span class="token keyword">import</span> hashpump  <span class="token comment"># https://github.com/bwall/HashPump</span>
<span class="token keyword">import</span> base64

sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'47.97.127.1'</span><span class="token punctuation">,</span> <span class="token number">25839</span><span class="token punctuation">)</span>  <span class="token comment"># nc 47.97.127.1 25839</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'&gt; '</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'2'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Which one? '</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Order: '</span><span class="token punctuation">)</span>
Order <span class="token operator">=</span> sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
Order <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>Order<span class="token punctuation">)</span>

<span class="token comment"># hashpump(hexdigest, original_data, data_to_add, key_length) -&gt; (digest, message)</span>
hexdigest <span class="token operator">=</span> Order<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
original_data <span class="token operator">=</span> Order<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
data_to_add <span class="token operator">=</span> <span class="token string">'&amp;p=flag'</span>
<span class="token keyword">for</span> len_sk <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'3'</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'Order: '</span><span class="token punctuation">)</span>
    key_length <span class="token operator">=</span> len_sk <span class="token operator">+</span> <span class="token number">3</span>  <span class="token comment"># k={sk}&amp;</span>
    new_hash<span class="token punctuation">,</span> new <span class="token operator">=</span> hashpump<span class="token punctuation">(</span>hexdigest<span class="token punctuation">,</span> original_data<span class="token punctuation">,</span> data_to_add<span class="token punctuation">,</span> key_length<span class="token punctuation">)</span>
    Order <span class="token operator">=</span> new<span class="token operator">+</span><span class="token string">b'&amp;s='</span><span class="token operator">+</span>new_hash<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Order <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>Order<span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>Order<span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'Your current coins: 990'</span> <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># flag{a1dc2134088618c456457dc01e51280e}</span>
        <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'&gt; '</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="other_339"></a>other</h3> 
<h4><a id="_341"></a>垃圾邮件分析</h4> 
<p>先过工作量证明，然后肉眼分析是不是垃圾邮件，得解</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> string <span class="token keyword">import</span> ascii_letters<span class="token punctuation">,</span> digits
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> product
table <span class="token operator">=</span> ascii_letters <span class="token operator">+</span> digits
Xnum <span class="token operator">=</span><span class="token number">4</span>
tail <span class="token operator">=</span> <span class="token string">"tFSZMu4V3cPeYvj14QiMPFpUqLb6"</span>
_hash <span class="token operator">=</span> <span class="token string">"cfa54fcb299c25df405223d0ec0eabeb73f91a4229e3b52b99a6ef7aac567882"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> product<span class="token punctuation">(</span>table<span class="token punctuation">,</span> repeat<span class="token operator">=</span>Xnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token comment"># print(head)</span>
    t <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">(</span>tail <span class="token operator">+</span> head<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> t <span class="token operator">==</span> _hash<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'爆破成功！结果是：'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
</code></pre> 
<p>交互</p> 
<pre><code>(base) 0HB@Caliburn ~ % nc 47.97.127.1 26120
sha256(tFSZMu4V3cPeYvj14QiMPFpUqLb6 + xxxx) = cfa54fcb299c25df405223d0ec0eabeb73f91a4229e3b52b99a6ef7aac567882
xxxx = KiYX

         ### #### ####   ###### ####### ######  
        ## ## ##   ##    # ## #  ##   #  ##  ## 
         #    ##   ##      ##    ## #    ##  ## 
       ####   ##   ##      ##    ####    #####  
        ##    ##   ##   #  ##    ## #    ## ##  
        ##    ##   ##  ##  ##    ##   #  ##  ## 
       ####  #### ####### ####  ####### #### ## 


       1. In this challenge, you are required to classify a
          bunch of e-mail texts into ham/spam categories
       2. You will recive 50 samples as the training data
       3. And I will give you 10 samples to validate your
          trained model
       4. Solve them to win the flag!

Press ENTER to continue... 
################################################################################
Training data 1/50: SPAM
--------------------------------------------------------------------------------
b"Subject: bait - excelled @ em . ca when can you start\r\n+ unable to see graphics ? please go here to view this email . +\r\nhi\r\nbait - excelled @ em . ca ,\r\nyour name was given to us as someone who might be interested in getting\r\nout of the rat race . are you really ?\r\nif so , keep reading ! being in charge of yourself and your life is the only\r\nway to go .\r\nthere are literally thousands of us who are making a good living at home\r\non the internet , and there ' s no reason why you can ' t be one of us . and i ' m\r\ntalking about a legitimate business you can be proud of .\r\njust visit our site when you have a minute ,\r\nand you ' ll know right away if this is what you ' ve been searching for .\r\nlooking forward to helping you get out of the rat race !\r\ntake care !\r\nif you would prefer not to receive email advertisements from this advertiser in the future , visit us here .\r\n+ + + + +\r\nthe preceding advertisement was sent from sweepsatstake . com .\r\nif you would like to stop receiving advertisements from sweepsatstake . com in the future , please\r\n+ + + + +\r\n"
Press ENTER to continue... 
################################################################################
Training data 2/50: SPAM
--------------------------------------------------------------------------------
b'Subject: re : 63 % - off \\ / iagra , cialis , ambien , soma and other drugs hamster disputing\r\ncentroid terminates benzedrine boggled zebra\r\nvenn disengaging inferiors burdensome tortoise\r\nconfusing congenial ires named\r\nbeater absorbing boundlessness\r\nbetterments popsicles david stud enlarges\r\nleaflets delphinus pickering participle'
Press ENTER to continue... 


......


Press ENTER to continue... 
################################################################################


......


Testing data 9/10
--------------------------------------------------------------------------------
b"Subject: fwd : need meds xanaix | = v @ 1 | um ' vl @ gra pnter : m : in _ somia | hooso\r\nwe believe ordering medication should be as simple as ordering anything else on the internet : private , secure , and easy .\r\nwe have : ` som : a : # pntermin . vl @ gra = / v / alium _ xana _ x _ - ativ ` @ n\r\nplus : p : @ xil , busp @ : r , a ` dipex , ionam | * n , m 3 rid ` ia , x 3 nic . a | , ambi 3 ' n , s : 0 nata , fl 3 x . eril , ce | : 3 brex , f ' ioric 3 t , tram : @ do | , uitr @ ` m , l 3 . vitra , prop . 3 cia , ac . yc | 0 vir , pr ` 0 z @ c\r\nwe offer you a choice of original and generic medications .\r\nenjoy deep discount meds here .\r\n"
The category is (H for ham/S for spam): 
S
################################################################################
Testing data 10/10
--------------------------------------------------------------------------------
b'Subject: get your college degree online !\r\n'
The category is (H for ham/S for spam): 
S
################################################################################

        Good job! Just take it:
        flag{3acf10d4ed12d34ed63e62ec225c077f}

Press ENTER to continue... %                                                    (base) 0HB@Caliburn ~ % 
</code></pre> 
<h4><a id="_427"></a>文字频率分析</h4> 
<h5><a id="_429"></a>题目</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> time
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont<span class="token punctuation">,</span> ImageFilter
<span class="token keyword">import</span> io
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
<span class="token keyword">import</span> hashlib


<span class="token keyword">def</span> <span class="token function">pow</span><span class="token punctuation">(</span>hard_level<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> hard_level <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">:</span>
        hard_level <span class="token operator">=</span> <span class="token number">30</span>

    m <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    c <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>m<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    part <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">32</span> <span class="token operator">-</span> hard_level<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'plaintext: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>part<span class="token punctuation">}</span></span><span class="token string">'</span></span> <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">*</span> hard_level<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'md5_hex -&gt; </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>c<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> part<span class="token punctuation">,</span> c


<span class="token keyword">def</span> <span class="token function">crack</span><span class="token punctuation">(</span>part<span class="token punctuation">,</span> c<span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>part<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>level <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>
    _limit <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> level <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> s <span class="token operator">&lt;=</span> _limit<span class="token punctuation">:</span>
        s <span class="token operator">+=</span> <span class="token number">1</span>
        seed <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> c<span class="token punctuation">:</span>
            <span class="token keyword">return</span> seed


<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span>nums<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        result<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">]</span>
    <span class="token keyword">return</span> data<span class="token punctuation">,</span> result


<span class="token keyword">def</span> <span class="token function">makeImage</span><span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>size <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> size <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            img<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>pngs<span class="token punctuation">[</span>data<span class="token punctuation">[</span>x <span class="token operator">+</span> y <span class="token operator">*</span> size<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> y <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 怀疑写反了</span>
    content <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'flag.png'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Easy pow:"</span><span class="token punctuation">)</span>
    pm<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"What's is plaintext?\n&gt; "</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>m<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> c<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    data<span class="token punctuation">,</span> result <span class="token operator">=</span> getData<span class="token punctuation">(</span><span class="token punctuation">)</span>
    png <span class="token operator">=</span> makeImage<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'now, you get a png: '</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>png<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"##The end, please tell me your list:"</span><span class="token punctuation">)</span>
    _start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'&gt; '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
    _end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> _end <span class="token operator">-</span> _start <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'timeouted'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

    <span class="token keyword">if</span> _input <span class="token operator">==</span> result<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Got it!"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Sorry, try again.'</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'loading pngs, please waiting...'</span><span class="token punctuation">)</span>
    pngs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    seed <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pngs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/app/src/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>seed<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">.png'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS<span class="token punctuation">)</span><span class="token punctuation">)</span>
    game<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_524"></a>题解</h5> 
<h6><a id="Step1_527"></a>Step1</h6> 
<p>先交互，得到一张有400个字符串的png大图（test.png）<br> <img src="https://images2.imgbox.com/b7/2f/XnhptVeV_o.png" alt="test"></p> 
<p>分割png，去重得到26个字母，根据密码表肉眼识别后手动改名为对应字母</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont<span class="token punctuation">,</span> ImageFilter


size <span class="token operator">=</span> <span class="token number">20</span>
imgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
png <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/Users/0HB/Desktop/分析/test.png'</span><span class="token punctuation">)</span>
pngs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> png<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> y <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> tmp <span class="token keyword">not</span> <span class="token keyword">in</span> pngs<span class="token punctuation">:</span>  <span class="token comment"># 去重</span>
            pngs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>

<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pngs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">26</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pngs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pngs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'/Users/0HB/Desktop/分析/seeds/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">.png'</span></span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/a5/eMrnA9fs_o.png" alt="密码表"></p> 
<p><img src="https://images2.imgbox.com/03/89/qdeowNoQ_o.png" alt="seeds"></p> 
<h6><a id="Step2_559"></a>Step2</h6> 
<p>再次交互，将得到新的大图分割成400份，每一份都在26个字母图中查在哪个位置，即可分别识别出对应字母</p> 
<p>最后仿照题目中result列表的生成方式，恢复出result，发送之得到flag</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> string <span class="token keyword">import</span> digits
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> product
<span class="token keyword">import</span> base64<span class="token punctuation">,</span> hashlib
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

table <span class="token operator">=</span> <span class="token string">'abcdef'</span> <span class="token operator">+</span> digits


<span class="token keyword">class</span> <span class="token class-name">Solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># nc 47.97.127.1 24929</span>
        self<span class="token punctuation">.</span>sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'47.97.127.1'</span><span class="token punctuation">,</span> <span class="token number">24929</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">proof_of_work</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        GeShi <span class="token operator">=</span> <span class="token string">b"What's is plaintext?"</span>
        proof <span class="token operator">=</span> self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>GeShi<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"What's is plaintext?"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>proof<span class="token punctuation">)</span>
        Xnum <span class="token operator">=</span> <span class="token number">6</span>
        tail <span class="token operator">=</span> proof<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'plaintext: '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'??????'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        _hash <span class="token operator">=</span> proof<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-&gt; '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'\n'</span> <span class="token keyword">in</span> _hash<span class="token punctuation">:</span>
            _hash <span class="token operator">=</span> _hash<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未知数："</span><span class="token punctuation">,</span> Xnum<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>_hash<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始爆破！'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> product<span class="token punctuation">(</span>table<span class="token punctuation">,</span> repeat<span class="token operator">=</span>Xnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token comment"># print(head)</span>
            t <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">(</span>tail<span class="token operator">+</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> t <span class="token operator">==</span> _hash<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'爆破成功！结果是：'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>tail<span class="token operator">+</span>head<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token punctuation">(</span>tail<span class="token operator">+</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

    <span class="token keyword">def</span> <span class="token function">fxxk</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        size <span class="token operator">=</span> <span class="token number">20</span>
        seed <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>
        result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        ans <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> seed<span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'/Users/0HB/Desktop/分析/seeds/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">.png'</span></span>
            ans<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># .resize((50, 50), Image.ANTIALIAS) 很关键</span>

        png <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/Users/0HB/Desktop/分析/flag.png'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tmp1 <span class="token operator">=</span> png<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> y <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                c <span class="token operator">=</span> ans<span class="token punctuation">.</span>index<span class="token punctuation">(</span>tmp1<span class="token punctuation">)</span>
                result<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> result

    <span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>proof_of_work<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'now, you get a png:'</span><span class="token punctuation">)</span>
        tmp <span class="token operator">=</span> self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'##The end, please tell me your list:'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'##The end, please tell me your list:'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        tmp <span class="token operator">=</span> tmp<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        img_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/Users/0HB/Desktop/分析/flag.png'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'图片已生成！'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'&gt; '</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fxxk<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># flag{cedf7a5c55e775f73080357b358af0ac}</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    solution <span class="token operator">=</span> Solve<span class="token punctuation">(</span><span class="token punctuation">)</span>
    solution<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Misc_646"></a>Misc</h3> 
<h4><a id="_648"></a>空投之王</h4> 
<h5><a id="_650"></a>题解</h5> 
<p>题目给出日志文件，要求找到Airdrop发送者的手机号。</p> 
<p>搜索，找到资料<a href="https://archive.ph/he1re#selection-429.250-429.277" rel="nofollow">通过分析iOS 15中的sysdiagnose日志确定AirDrop数据的发送电话号码</a></p> 
<blockquote> 
 <p><strong>通过爆破在接收苹果设备的系统诊断日志中发现的部分SHA256哈希条目来获得发件人的电话号码</strong></p> 
</blockquote> 
<p>根据文章，又因为笔者使用的是MacOS，非常方便地找到并打开了<strong>system_logs.logarchive</strong></p> 
<p>筛选好时间、进程类型以及关键词（<strong>Phone=[</strong>），有如下:</p> 
<p><img src="https://images2.imgbox.com/de/8d/UdfQe8jX_o.png" alt="在这里插入图片描述"></p> 
<pre><code>[58299...893d4]
[58299...e18e4]
[11cbd...893d4]
[11cbd...e18e4]
[fade7...e461b]
</code></pre> 
<p>这里泄漏出来了电话号码sha256后，前六位以及末六位的值，接下来只需写脚本爆破即可。</p> 
<p>思路通了，但Python爆的着实有·慢，最后队里Mu.Chen师傅利用已有取证工具一把梭了…</p> 
<p>彳亍，那么便没再做研究了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/985a8de30997eab9956251178c0958f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【maven工程的pom.xml文件内部结构详解&#43;maven工程的多层次依赖管理】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b6fb5bac10a128a542e9a44266e9e583/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【嵌入式操作系统】 Linux操作系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>