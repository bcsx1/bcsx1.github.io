<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sequelize和sql之间的对应关系，入门文章 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Sequelize和sql之间的对应关系，入门文章" />
<meta property="og:description" content="如果你觉得Sequelize的文档有点多、杂，不方便看，可以看看这篇。
在使用NodeJS来关系型操作数据库时，为了方便，通常都会选择一个合适的ORM（Object Relationship Model）框架。毕竟直接操作SQL比较繁琐，通过ORM框架，我们可以使用面向对象的方式来操作表。NodeJS社区有很多的ORM框架，我比较喜欢Sequelize，它功能丰富，可以非常方便的进行连表查询。
这篇文章我们就来看看，Sequelize是如何在SQL之上进行抽象、封装，从而提高开发效率的。
安装 这篇文章主要使用MySQL、Sequelize、co来进行介绍。安装非常简单：
$ npm install --save co $ npm install --save sequelize $ npm install --save mysql 代码模板如下：
var Sequelize = require(&#39;sequelize&#39;); var co = require(&#39;co&#39;); co(function* () { // code here }).catch(function(e) { console.log(e); }); 基本上，Sequelize的操作都会返回一个Promise，在co的框架里面可以直接进行yield，非常方便。
建立数据库连接 var sequelize = new Sequelize( &#39;sample&#39;, // 数据库名 &#39;root&#39;, // 用户名 &#39;zuki&#39;, // 用户密码 { &#39;dialect&#39;: &#39;mysql&#39;, // 数据库使用mysql &#39;host&#39;: &#39;localhost&#39;, // 数据库服务器ip &#39;port&#39;: 3306, // 数据库服务器端口 &#39;define&#39;: { // 字段以下划线（_）来分割（默认是驼峰命名风格） &#39;underscored&#39;: true } } ); 定义单张表 Sequelize：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9375726b2a02f23abec2e8aa933378e8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-05T13:42:42+08:00" />
<meta property="article:modified_time" content="2018-01-05T13:42:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Sequelize和sql之间的对应关系，入门文章</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <em>如果你觉得<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">Sequelize</a>的文档有点多、杂，不方便看，可以看看这篇。</em></p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>来关系型操作数据库时，为了方便，通常都会选择一个合适的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>（Object Relationship Model）框架。毕竟直接操作<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>比较繁琐，通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我们可以使用面向对象的方式来操作表。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>社区有很多的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我比较喜欢<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>，它功能丰富，可以非常方便的进行连表查询。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章我们就来看看，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>是如何在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>之上进行抽象、封装，从而提高开发效率的。</p> 
<h2 id="articleHeader0" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 安装</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章主要使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>MySQL</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>来进行介绍。安装非常简单：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="bash" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>$ npm install --save co
$ npm install --save sequelize
$ npm install --save mysql</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 代码模板如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Sequelize = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'sequelize'</span>);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> co = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'co'</span>);

co(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>* (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// code here</span>
}).catch(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(e);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 基本上，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的操作都会返回一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Promise</code>，在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>的框架里面可以直接进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>yield</code>，非常方便。</p> 
<h2 id="articleHeader1" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 建立数据库连接</h2> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin-right:0px; margin-bottom:1.5em; margin-left:0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative; margin-top:1.5em!important'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> sequelize = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> Sequelize(
    <span class="hljs-string" style="color:rgb(221,17,68)">'sample'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'root'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'zuki'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户密码</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'dialect'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'mysql'</span>,  <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库使用mysql</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'host'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'localhost'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器ip</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'port'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3306</span>,        <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器端口</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'define'</span>: {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段以下划线（_）来分割（默认是驼峰命名风格）</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'underscored'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);</code></pre> 
<h2 id="articleHeader2" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 定义单张表</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 默认表名（一般这里写单数），生成时会自动转换成复数形式</span>
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这个值还会作为访问模型相关的模型时的属性名，所以建议用小写形式</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段定义（主键、created_at、updated_at默认包含，不用特殊定义）</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">VARCHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 几点说明：</p> 
<ol style="margin-top:1.5em; margin-bottom:1.5em; margin-left:3em; padding-left:0px; color:rgb(51,51,51)"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">建表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>会自动执行的意思是你主动调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>的时候。类似这样：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>User.sync({force: true});</code>（加<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>force:true</code>，会先删掉表后再建表）。我们也可以先定义好表结构，再来定义<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>模型，这时可以不用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>。两者在定义阶段没有什么关系，直到我们真正开始操作模型时，才会触及到表的操作，但是我们当然还是要尽量保证模型和表的同步（可以借助一些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>migration</code>工具）。自动建表功能有风险，使用需谨慎。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">所有数据类型，请参考文档<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/api/datatypes/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">数据类型</a>。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">模型还可以定义虚拟属性、类方法、实例方法，请参考文档：<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/docs/models-definition/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">模型定义</a></p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">其他一些特殊定义如下所示：</p> </li></ol> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    },
    {
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 自定义表名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'freezeTableName'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'tableName'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'xyz_users'</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否需要增加createdAt、updatedAt、deletedAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'timestamps'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 不需要createdAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'createdAt'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将updatedAt字段改个名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'updatedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'utime'</span>

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将deletedAt字段改名</span>
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 同时需要设置paranoid为true（此种模式下，删除数据时不会进行物理删除，而是设置deletedAt为当前时间</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'deletedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'dtime'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'paranoid'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
    }
);</code></pre> 
<h2 id="articleHeader3" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 单表增删改查</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>获取的模型对象都是一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DAO</code>（Data Access Object）对象，这些对象会拥有许多操作数据库表的实例对象方法（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>save</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>update</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>等），需要获取“干净”的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>JSON</code>对象可以调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>get({'plain': true})</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过模型的类方法可以获取模型对象（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findById</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>等）。</p> 
<h3 id="articleHeader4" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 增</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：build后对象只存在于内存中，调用save后才操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = User.build({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'2'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小明'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>会为主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>设置<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DEFAULT</code>值来让数据库产生自增值，还将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>created_at</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>字段，非常方便。</p> 
<h3 id="articleHeader5" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 改</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：操作对象属性（不会操作db），调用save后操作db</span>
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接update操作db</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update({
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 15:00:04'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 更新操作时，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>将将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>，非常方便。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果想限制更新属性的白名单，可以这样写：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1</span>
user.emp_id = <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>;
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>},
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这样就只会更新<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>nick</code>字段，而<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>emp_id</code>会被忽略。这种方法在对表单提交过来的一大推数据中只更新某些属性的时候比较有用。</p> 
<h3 id="articleHeader6" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 删</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.destroy();</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有个特殊的地方是，如果我们开启了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>paranoid</code>（偏执）模式，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>的时候不会执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句，而是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UPDATE</code>语句将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>deleted_at</code>字段设置为当前时间（一开始此字段值为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>）。我们可以使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.destroy({force: true})</code>来强制删除，从而执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句进行物理删除。</p> 
<h3 id="articleHeader7" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 查</h3> 
<h4 id="articleHeader8" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查全部</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader9" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 限制字段</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader10" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 字段重命名</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'user_nick'</span>]
    ]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader11" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> where子句</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置项基本上完全支持了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>子句的功能，非常强大。我们一步步来进行介绍。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 基本条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>
    }
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k = v</code>，同时一个对象的多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>对被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>条件，即：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1: v1, k2: v2</code>转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1 = v1 AND k2 = v2</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有2个要点：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IS NULL</code>（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>= NULL</code><br> 这种语法）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是数组，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IN</code>条件（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>=[1,2,3]</code>这种语法，况且也没数组这种类型）</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 操作符</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 操作符是对某个字段的进一步约束，可以有多个（对同一个字段的多个操作符会被转化为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>）。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id = 1</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id != 2</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$gt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt; 6</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$gte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt;= 6</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt; 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,              <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt;= 10</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$between'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">6</span>, <span class="hljs-number" style="color:rgb(0,128,128)">10</span>],     <span class="hljs-comment" style="color:rgb(153,153,136)">// id BETWEEN 6 AND 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notBetween'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">11</span>, <span class="hljs-number" style="color:rgb(0,128,128)">15</span>], <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT BETWEEN 11 AND 15</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>],           <span class="hljs-comment" style="color:rgb(153,153,136)">// id IN (1, 2)</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notIn'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]         <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT IN (3, 4)</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>,          <span class="hljs-comment" style="color:rgb(153,153,136)">// nick LIKE '%a%'</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notLike'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>         <span class="hljs-comment" style="color:rgb(153,153,136)">// nick NOT LIKE '%a'</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'updated_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>,             <span class="hljs-comment" style="color:rgb(153,153,136)">// updated_at IS NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// created_at IS NOT NULL</span>
        }
    }
});
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> != <span class="hljs-number" style="color:rgb(0,128,128)">2</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt; <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt;= <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt; <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt;= <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">11</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">15</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>)
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里我们发现，其实相等条件<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>这种写法是操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$eq: v}</code>的简写。而要实现不等条件就必须使用操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$ne: v}</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 上面我们说的条件查询，都是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>查询，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>同时也支持<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>OR</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NOT</code>、甚至多种条件的联合查询。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> AND条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> OR条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> NOT条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 转换规则</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们这里做个总结。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置的转换规则的伪代码大概如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">translate</span>(<span class="hljs-params">where</span>) </span>{

    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (k, v <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> where) {

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == 表字段) {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 先统一转为操作符形式</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 基本值) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: 'xxx'</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: v};
            }
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 数组) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: [1, 2, 3]</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: v};
            }

            <span class="hljs-comment" style="color:rgb(153,153,136)">// 操作符转换</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (opk, opv <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> v) {
                <span class="hljs-comment" style="color:rgb(153,153,136)">// op将opk转换对应的SQL表示</span>
                =&gt; k + op(opk, opv) + AND; 
            }
        }

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 逻辑操作符处理</span>

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + OR;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>) {
            NOT +
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

    }

    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">op</span>(<span class="hljs-params">opk, opv</span>) </span>{
        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">switch</span> (opk) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$eq</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$ne</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'!='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NOT NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$between</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notBetween</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$in</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notIn</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$like</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'LIKE '</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notLike</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT LIKE '</span> + opv;
        }
    }

}
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们看一个复杂例子，基本上就是按上述流程来进行转换。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]
                }
            },
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
                ]
            }
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>)
)
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 排序</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'order'</span>: [
        [<span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'DESC'</span>],
        [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
    ]
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ORDER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BY</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DESC</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 分页</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> countPerPage = <span class="hljs-number" style="color:rgb(0,128,128)">20</span>, currentPage = <span class="hljs-number" style="color:rgb(0,128,128)">5</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: countPerPage,                      <span class="hljs-comment" style="color:rgb(153,153,136)">// 每页多少条</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: countPerPage * (currentPage - <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)  <span class="hljs-comment" style="color:rgb(153,153,136)">// 跳过多少条</span>
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">80</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他查询方法</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询一条数据</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findOne({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询并获取数量</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> result = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAndCountAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">20</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(result);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">count</span>(*) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`count`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个方法会执行2个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result</code>对象将包含2个字段：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.count</code>是数据总数，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.rows</code>是符合查询条件的所有数据。</p> 
<h3 id="articleHeader12" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 批量操作</h3> 
<h4 id="articleHeader13" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 插入</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.bulkCreate(
    [
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>}
    ]
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里需要注意，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>数组里面每个对象的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值会是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>。如果需要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值，可以重新取下数据。</p> 
<h4 id="articleHeader14" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 更新</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>},
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]
        }
    }
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:51:05'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>其实是一个数组，里面只有一个元素，表示更新的数据条数（看起来像是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>bug</code>）。</p> 
<h4 id="articleHeader15" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删除</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.destroy({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>是一个数字，表示删除的数据条数。</p> 
<h2 id="articleHeader16" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 关系</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系一般有三种：一对一、一对多、多对多。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>提供了清晰易用的接口来定义关系、进行表间的操作。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 当说到关系查询时，一般会需要获取多张表的数据。有建议用连表查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的，有不建议的。我的看法是，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>查询这种黑科技在数据量小的情况下可以使用，基本没有什么影响，数据量大的时候，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的性能可能会是硬伤，应该尽量避免，可以分别根据索引取单表数据然后在应用层对数据进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>merge</code>。当然，查询时一定要分页，不要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>。</p> 
<h3 id="articleHeader17" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对一</h3> 
<h4 id="articleHeader18" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Account = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'account'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * User的实例对象将拥有getAccount、setAccount、addAccount方法
 */</span>
User.hasOne(Account);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Account的实例对象将拥有getUser、setUser、addUser方法
 */</span>
Account.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，这种关系中外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account</code>上。另外，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>还给我们生成了外键约束。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 一般来说，外键约束在有些自己定制的数据库系统里面是禁止的，因为会带来一些性能问题。所以，建表的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>一般就去掉约束，同时给外键加一个索引（加速查询），数据的一致性就靠应用层来保证了。</p> 
<h4 id="articleHeader19" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = user.createAccount({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>作为外键在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>accounts</code>表里插入一条数据。</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Account.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);
anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(anotherAccount);
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">2</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据，此时外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>是空的，还没有关联user</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出当前<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>并将其<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为`NUL（为了保证一对一关系）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">设置新的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>acount</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，生成关系</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(<span class="hljs-literal" style="color:rgb(0,128,128)">null</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:11:35'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里的删除实际上只是“切断”关系，并不会真正的物理删除记录。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>设置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，完成关系的“切断”</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getAccount();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里就是调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>getAccount</code>方法，根据外键来获取对应的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 但是其实我们用面向对象的思维来思考应该是获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的时候就能通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.account</code>的方式来访问<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>对象。这可以通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>（急加载，和懒加载相反）来实现。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>的含义是说，取一个模型的时候，同时也把相关的模型数据也给我取过来（我很着急，不能按默认那种取一个模型就取一个模型的方式，我还要更多）。方法如下：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, {
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Account]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));
<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * 输出类似：
 { id: 1,
  emp_id: '1',
  created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  account:
   { id: 2,
     email: 'b',
     created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     user_id: 1 } }
 */</span></code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，我们对2个表进行了一个外联接，从而在取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的同时也获取到了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他补充说明</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果我们重复调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>方法，实际上会在数据库里面生成多条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>一样的数据，并不是真正的一对一。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 所以，在应用层保证一致性时，就需要我们遵循良好的编码约定。新增就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>，更改就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setAccount</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 也可以给<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UNIQUE</code>约束，在数据库层面保证一致性，这时就需要做好<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>try/catch</code>，发生插入异常的时候能够知道是因为插入了多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 另外，我们上面都是使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>来对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>进行操作。实际上反向操作也是可以的，这是因为我们定义了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account.belongsTo(User)</code>。在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>里面定义关系时，关系的调用方会获得相关的“关系”方法，一般为了两边都能操作，会同时定义双向关系（这里双向关系指的是模型层面，并不会在数据库表中出现两个表都加上外键的情况，请放心）。</p> 
<h3 id="articleHeader20" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对多</h3> 
<h4 id="articleHeader21" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * User的实例对象将拥有getNotes、setNotes、addNote、createNote、removeNote、hasNote方法
 */</span>
User.hasMany(Note);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Note的实例对象将拥有getUser、setUser、createUser方法
 */</span>
Note.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种关系中，外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了多的一端（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表）。同时相关的模型也自动获得了一些方法。</p> 
<h4 id="articleHeader22" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>NSERT INTO `users` 
(`id`,`emp_id`,`updated_at`,`created_at`) 
VALUES 
(DEFAULT,'1','2015-11-03 23:52:05','2015-11-03 23:52:05');

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值作为外键直接在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表里插入一条数据。</p> </li></ul> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.addNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，此时该条数据的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为空</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值再更新该条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，设置好外键，完成关系建立</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 为user增加note1、note2</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 先创建note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'d'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// user拥有的note更改为note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([note3, note4]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 省去了创建语句 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查询所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note4</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，完成关系建立</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里为啥还要查出所有的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据呢？因为我们需要根据传人<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>setNotes</code>的数组来计算出哪些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>要切断关系、哪些要新增关系，所以就需要查出来进行一个计算集合的“交集”运算。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:50:08'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 实际上，上面说到的“改”已经有“删”的操作了（去掉<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的关系）。这里的操作是删掉用户的所有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，直接执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setNotes([])</code>即可。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查出所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 还有一个真正的删除方法，就是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>removeNote</code>。如下所示：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.removeNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 01:40:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getNotes({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>很简单，直接根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值来查询满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>即可。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>属于哪个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [User],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note属于哪个user可以通过note.user访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法，因为获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况3</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，同时获取该<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Note],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});
users.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">user</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// user的notes可以通过user.notes访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:51:35'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 一点补充</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于各种join的区别，可以参考：<a target="_blank" href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/</a>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>我想再啰嗦几句。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>里面传递的是去取相关模型，默认是取全部，我们也可以再对这个模型进行一层过滤。像下面这样：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 查询创建时间在今天之前的所有user，同时获取他们note的标题中含有关键字css的所有note</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note,
            <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
                <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
                }
            }
        }
    ],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:58:31'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 注意：当我们对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>的模型加了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>过滤时，会使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>来进行查询，这样保证只有那些拥有标题含有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>css</code>关键词<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>的用户才会返回。</p> 
<h3 id="articleHeader23" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 多对多关系</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在多对多关系中，必须要额外一张关系表来将2个表进行关联，这张表可以是单纯的一个关系表，也可以是一个实际的模型（含有自己的额外属性来描述关系）。我比较喜欢用一个模型的方式，这样方便以后做扩展。</p> 
<h4 id="articleHeader24" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tag = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tagging = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tagging'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.INTEGER(),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">// Note的实例拥有getTags、setTags、addTag、addTags、createTag、removeTag、hasTag方法</span>
Note.belongsToMany(Tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});
<span class="hljs-comment" style="color:rgb(153,153,136)">// Tag的实例拥有getNotes、setNotes、addNote、addNotes、createNote、removeNote、hasNote方法</span>
Tag.belongsToMany(Note, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>, 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，多对多关系中单独生成了一张关系表，并设置了2个外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>来和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>进行关联。关于关系表的命名，我比较喜欢使用动词，因为这张表是用来表示两张表的一种联系，而且这种联系多数时候伴随着一种动作。比如：用户收藏商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>collecting</code>）、用户购买商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>buying</code>）、用户加入项目（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>joining</code>）等等。</p> 
<h4 id="articleHeader25" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 增</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.createTag({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>}, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">0</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>表中插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的值设置外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>以及关系模型本身需要的属性（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>type: 0</code>）在关系表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tagging</code>中插入记录</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系表本身需要的属性，通过传递一个额外的对象给设置方法来实现。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTag(tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法和上面的方法实际上是一样的。只是我们先手动<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>create</code>了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Tag</code>模型。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法可以进行批量添加。当执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>addTags</code>时，实际上就是设置好对应的外键及关系模型本身的属性，然后在关系表中批量的插入数据。</p> 
<h4 id="articleHeader26" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 改</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 将tag改掉</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([tag3, tag4], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 前面添加部分的sql，和上面一样*/</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 更改部分的sql */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 先删除关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 插入新关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">4</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 执行逻辑是，先将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag2</code>在关系表中的关系删除，然后再将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag4</code>对应的关系插入关系表。</p> 
<h4 id="articleHeader27" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2, tag3], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 删除一个</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.removeTag(tag1);

<span class="hljs-comment" style="color:rgb(153,153,136)">// 全部删除</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除一个 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除全部 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 删除一个很简单，直接将关系表中的数据删除。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 全部删除时，首先需要查出关系表中<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>对应的所有数据，然后一次删掉。</p> 
<h4 id="articleHeader28" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.getTags({
    <span class="hljs-comment" style="color:rgb(153,153,136)">//这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 关系模型可以通过tag.tagging来访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种查询，就是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>所在的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// tag的notes可以通过tag.notes访问，关系模型可以通过tag.notes[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询就稍微有点复杂。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggings</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Tag
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note的tags可以通过note.tags访问，关系模型通过note.tags[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询和上面的查询类似。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggins</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h2 id="articleHeader29" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 其他没有涉及东西</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章已经够长了，但是其实我们还有很多没有涉及的东西，比如：聚合函数及查询（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>having</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>group by</code>）、模型的验证（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>validate</code>）、定义钩子（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>hooks</code>）、索引等等。</p> 
<p style="margin-top:1.5em; margin-bottom:0px; color:rgb(51,51,51); font-size:14px; text-align:start"> 这些主题下次再来写写。</p> 
<p style="margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <em>如果你觉得<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">Sequelize</a>的文档有点多、杂，不方便看，可以看看这篇。</em></p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>来关系型操作数据库时，为了方便，通常都会选择一个合适的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>（Object Relationship Model）框架。毕竟直接操作<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>比较繁琐，通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我们可以使用面向对象的方式来操作表。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>社区有很多的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我比较喜欢<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>，它功能丰富，可以非常方便的进行连表查询。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章我们就来看看，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>是如何在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>之上进行抽象、封装，从而提高开发效率的。</p> 
<h2 id="articleHeader0" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 安装</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章主要使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>MySQL</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>来进行介绍。安装非常简单：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="bash" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>$ npm install --save co
$ npm install --save sequelize
$ npm install --save mysql</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 代码模板如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Sequelize = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'sequelize'</span>);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> co = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'co'</span>);

co(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>* (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// code here</span>
}).catch(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(e);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 基本上，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的操作都会返回一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Promise</code>，在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>的框架里面可以直接进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>yield</code>，非常方便。</p> 
<h2 id="articleHeader1" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 建立数据库连接</h2> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin-right:0px; margin-bottom:1.5em; margin-left:0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative; margin-top:1.5em!important'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> sequelize = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> Sequelize(
    <span class="hljs-string" style="color:rgb(221,17,68)">'sample'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'root'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'zuki'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户密码</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'dialect'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'mysql'</span>,  <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库使用mysql</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'host'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'localhost'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器ip</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'port'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3306</span>,        <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器端口</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'define'</span>: {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段以下划线（_）来分割（默认是驼峰命名风格）</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'underscored'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);</code></pre> 
<h2 id="articleHeader2" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 定义单张表</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 默认表名（一般这里写单数），生成时会自动转换成复数形式</span>
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这个值还会作为访问模型相关的模型时的属性名，所以建议用小写形式</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段定义（主键、created_at、updated_at默认包含，不用特殊定义）</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">VARCHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 几点说明：</p> 
<ol style="margin-top:1.5em; margin-bottom:1.5em; margin-left:3em; padding-left:0px; color:rgb(51,51,51)"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">建表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>会自动执行的意思是你主动调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>的时候。类似这样：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>User.sync({force: true});</code>（加<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>force:true</code>，会先删掉表后再建表）。我们也可以先定义好表结构，再来定义<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>模型，这时可以不用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>。两者在定义阶段没有什么关系，直到我们真正开始操作模型时，才会触及到表的操作，但是我们当然还是要尽量保证模型和表的同步（可以借助一些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>migration</code>工具）。自动建表功能有风险，使用需谨慎。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">所有数据类型，请参考文档<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/api/datatypes/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">数据类型</a>。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">模型还可以定义虚拟属性、类方法、实例方法，请参考文档：<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/docs/models-definition/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">模型定义</a></p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">其他一些特殊定义如下所示：</p> </li></ol> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    },
    {
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 自定义表名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'freezeTableName'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'tableName'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'xyz_users'</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否需要增加createdAt、updatedAt、deletedAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'timestamps'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 不需要createdAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'createdAt'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将updatedAt字段改个名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'updatedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'utime'</span>

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将deletedAt字段改名</span>
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 同时需要设置paranoid为true（此种模式下，删除数据时不会进行物理删除，而是设置deletedAt为当前时间</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'deletedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'dtime'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'paranoid'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
    }
);</code></pre> 
<h2 id="articleHeader3" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 单表增删改查</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>获取的模型对象都是一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DAO</code>（Data Access Object）对象，这些对象会拥有许多操作数据库表的实例对象方法（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>save</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>update</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>等），需要获取“干净”的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>JSON</code>对象可以调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>get({'plain': true})</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过模型的类方法可以获取模型对象（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findById</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>等）。</p> 
<h3 id="articleHeader4" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 增</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：build后对象只存在于内存中，调用save后才操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = User.build({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'2'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小明'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>会为主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>设置<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DEFAULT</code>值来让数据库产生自增值，还将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>created_at</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>字段，非常方便。</p> 
<h3 id="articleHeader5" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 改</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：操作对象属性（不会操作db），调用save后操作db</span>
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接update操作db</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update({
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 15:00:04'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 更新操作时，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>将将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>，非常方便。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果想限制更新属性的白名单，可以这样写：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1</span>
user.emp_id = <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>;
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>},
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这样就只会更新<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>nick</code>字段，而<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>emp_id</code>会被忽略。这种方法在对表单提交过来的一大推数据中只更新某些属性的时候比较有用。</p> 
<h3 id="articleHeader6" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 删</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.destroy();</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有个特殊的地方是，如果我们开启了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>paranoid</code>（偏执）模式，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>的时候不会执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句，而是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UPDATE</code>语句将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>deleted_at</code>字段设置为当前时间（一开始此字段值为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>）。我们可以使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.destroy({force: true})</code>来强制删除，从而执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句进行物理删除。</p> 
<h3 id="articleHeader7" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 查</h3> 
<h4 id="articleHeader8" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查全部</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader9" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 限制字段</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader10" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 字段重命名</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'user_nick'</span>]
    ]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader11" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> where子句</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置项基本上完全支持了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>子句的功能，非常强大。我们一步步来进行介绍。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 基本条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>
    }
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k = v</code>，同时一个对象的多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>对被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>条件，即：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1: v1, k2: v2</code>转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1 = v1 AND k2 = v2</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有2个要点：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IS NULL</code>（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>= NULL</code><br> 这种语法）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是数组，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IN</code>条件（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>=[1,2,3]</code>这种语法，况且也没数组这种类型）</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 操作符</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 操作符是对某个字段的进一步约束，可以有多个（对同一个字段的多个操作符会被转化为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>）。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id = 1</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id != 2</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$gt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt; 6</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$gte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt;= 6</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt; 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,              <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt;= 10</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$between'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">6</span>, <span class="hljs-number" style="color:rgb(0,128,128)">10</span>],     <span class="hljs-comment" style="color:rgb(153,153,136)">// id BETWEEN 6 AND 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notBetween'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">11</span>, <span class="hljs-number" style="color:rgb(0,128,128)">15</span>], <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT BETWEEN 11 AND 15</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>],           <span class="hljs-comment" style="color:rgb(153,153,136)">// id IN (1, 2)</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notIn'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]         <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT IN (3, 4)</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>,          <span class="hljs-comment" style="color:rgb(153,153,136)">// nick LIKE '%a%'</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notLike'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>         <span class="hljs-comment" style="color:rgb(153,153,136)">// nick NOT LIKE '%a'</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'updated_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>,             <span class="hljs-comment" style="color:rgb(153,153,136)">// updated_at IS NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// created_at IS NOT NULL</span>
        }
    }
});
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> != <span class="hljs-number" style="color:rgb(0,128,128)">2</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt; <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt;= <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt; <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt;= <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">11</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">15</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>)
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里我们发现，其实相等条件<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>这种写法是操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$eq: v}</code>的简写。而要实现不等条件就必须使用操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$ne: v}</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 上面我们说的条件查询，都是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>查询，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>同时也支持<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>OR</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NOT</code>、甚至多种条件的联合查询。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> AND条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> OR条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> NOT条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 转换规则</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们这里做个总结。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置的转换规则的伪代码大概如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">translate</span>(<span class="hljs-params">where</span>) </span>{

    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (k, v <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> where) {

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == 表字段) {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 先统一转为操作符形式</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 基本值) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: 'xxx'</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: v};
            }
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 数组) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: [1, 2, 3]</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: v};
            }

            <span class="hljs-comment" style="color:rgb(153,153,136)">// 操作符转换</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (opk, opv <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> v) {
                <span class="hljs-comment" style="color:rgb(153,153,136)">// op将opk转换对应的SQL表示</span>
                =&gt; k + op(opk, opv) + AND; 
            }
        }

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 逻辑操作符处理</span>

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + OR;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>) {
            NOT +
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

    }

    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">op</span>(<span class="hljs-params">opk, opv</span>) </span>{
        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">switch</span> (opk) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$eq</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$ne</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'!='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NOT NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$between</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notBetween</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$in</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notIn</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$like</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'LIKE '</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notLike</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT LIKE '</span> + opv;
        }
    }

}
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们看一个复杂例子，基本上就是按上述流程来进行转换。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]
                }
            },
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
                ]
            }
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>)
)
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 排序</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'order'</span>: [
        [<span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'DESC'</span>],
        [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
    ]
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ORDER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BY</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DESC</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 分页</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> countPerPage = <span class="hljs-number" style="color:rgb(0,128,128)">20</span>, currentPage = <span class="hljs-number" style="color:rgb(0,128,128)">5</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: countPerPage,                      <span class="hljs-comment" style="color:rgb(153,153,136)">// 每页多少条</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: countPerPage * (currentPage - <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)  <span class="hljs-comment" style="color:rgb(153,153,136)">// 跳过多少条</span>
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">80</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他查询方法</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询一条数据</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findOne({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询并获取数量</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> result = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAndCountAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">20</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(result);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">count</span>(*) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`count`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个方法会执行2个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result</code>对象将包含2个字段：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.count</code>是数据总数，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.rows</code>是符合查询条件的所有数据。</p> 
<h3 id="articleHeader12" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 批量操作</h3> 
<h4 id="articleHeader13" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 插入</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.bulkCreate(
    [
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>}
    ]
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里需要注意，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>数组里面每个对象的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值会是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>。如果需要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值，可以重新取下数据。</p> 
<h4 id="articleHeader14" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 更新</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>},
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]
        }
    }
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:51:05'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>其实是一个数组，里面只有一个元素，表示更新的数据条数（看起来像是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>bug</code>）。</p> 
<h4 id="articleHeader15" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删除</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.destroy({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>是一个数字，表示删除的数据条数。</p> 
<h2 id="articleHeader16" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 关系</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系一般有三种：一对一、一对多、多对多。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>提供了清晰易用的接口来定义关系、进行表间的操作。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 当说到关系查询时，一般会需要获取多张表的数据。有建议用连表查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的，有不建议的。我的看法是，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>查询这种黑科技在数据量小的情况下可以使用，基本没有什么影响，数据量大的时候，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的性能可能会是硬伤，应该尽量避免，可以分别根据索引取单表数据然后在应用层对数据进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>merge</code>。当然，查询时一定要分页，不要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>。</p> 
<h3 id="articleHeader17" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对一</h3> 
<h4 id="articleHeader18" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Account = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'account'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * User的实例对象将拥有getAccount、setAccount、addAccount方法
 */</span>
User.hasOne(Account);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Account的实例对象将拥有getUser、setUser、addUser方法
 */</span>
Account.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，这种关系中外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account</code>上。另外，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>还给我们生成了外键约束。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 一般来说，外键约束在有些自己定制的数据库系统里面是禁止的，因为会带来一些性能问题。所以，建表的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>一般就去掉约束，同时给外键加一个索引（加速查询），数据的一致性就靠应用层来保证了。</p> 
<h4 id="articleHeader19" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = user.createAccount({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>作为外键在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>accounts</code>表里插入一条数据。</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Account.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);
anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(anotherAccount);
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">2</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据，此时外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>是空的，还没有关联user</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出当前<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>并将其<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为`NUL（为了保证一对一关系）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">设置新的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>acount</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，生成关系</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(<span class="hljs-literal" style="color:rgb(0,128,128)">null</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:11:35'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里的删除实际上只是“切断”关系，并不会真正的物理删除记录。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>设置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，完成关系的“切断”</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getAccount();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里就是调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>getAccount</code>方法，根据外键来获取对应的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 但是其实我们用面向对象的思维来思考应该是获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的时候就能通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.account</code>的方式来访问<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>对象。这可以通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>（急加载，和懒加载相反）来实现。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>的含义是说，取一个模型的时候，同时也把相关的模型数据也给我取过来（我很着急，不能按默认那种取一个模型就取一个模型的方式，我还要更多）。方法如下：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, {
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Account]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));
<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * 输出类似：
 { id: 1,
  emp_id: '1',
  created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  account:
   { id: 2,
     email: 'b',
     created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     user_id: 1 } }
 */</span></code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，我们对2个表进行了一个外联接，从而在取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的同时也获取到了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他补充说明</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果我们重复调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>方法，实际上会在数据库里面生成多条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>一样的数据，并不是真正的一对一。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 所以，在应用层保证一致性时，就需要我们遵循良好的编码约定。新增就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>，更改就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setAccount</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 也可以给<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UNIQUE</code>约束，在数据库层面保证一致性，这时就需要做好<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>try/catch</code>，发生插入异常的时候能够知道是因为插入了多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 另外，我们上面都是使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>来对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>进行操作。实际上反向操作也是可以的，这是因为我们定义了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account.belongsTo(User)</code>。在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>里面定义关系时，关系的调用方会获得相关的“关系”方法，一般为了两边都能操作，会同时定义双向关系（这里双向关系指的是模型层面，并不会在数据库表中出现两个表都加上外键的情况，请放心）。</p> 
<h3 id="articleHeader20" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对多</h3> 
<h4 id="articleHeader21" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * User的实例对象将拥有getNotes、setNotes、addNote、createNote、removeNote、hasNote方法
 */</span>
User.hasMany(Note);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Note的实例对象将拥有getUser、setUser、createUser方法
 */</span>
Note.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种关系中，外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了多的一端（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表）。同时相关的模型也自动获得了一些方法。</p> 
<h4 id="articleHeader22" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>NSERT INTO `users` 
(`id`,`emp_id`,`updated_at`,`created_at`) 
VALUES 
(DEFAULT,'1','2015-11-03 23:52:05','2015-11-03 23:52:05');

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值作为外键直接在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表里插入一条数据。</p> </li></ul> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.addNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，此时该条数据的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为空</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值再更新该条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，设置好外键，完成关系建立</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 为user增加note1、note2</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 先创建note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'d'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// user拥有的note更改为note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([note3, note4]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 省去了创建语句 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查询所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note4</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，完成关系建立</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里为啥还要查出所有的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据呢？因为我们需要根据传人<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>setNotes</code>的数组来计算出哪些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>要切断关系、哪些要新增关系，所以就需要查出来进行一个计算集合的“交集”运算。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:50:08'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 实际上，上面说到的“改”已经有“删”的操作了（去掉<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的关系）。这里的操作是删掉用户的所有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，直接执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setNotes([])</code>即可。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查出所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 还有一个真正的删除方法，就是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>removeNote</code>。如下所示：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.removeNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 01:40:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getNotes({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>很简单，直接根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值来查询满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>即可。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>属于哪个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [User],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note属于哪个user可以通过note.user访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法，因为获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况3</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，同时获取该<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Note],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});
users.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">user</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// user的notes可以通过user.notes访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:51:35'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 一点补充</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于各种join的区别，可以参考：<a target="_blank" href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/</a>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>我想再啰嗦几句。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>里面传递的是去取相关模型，默认是取全部，我们也可以再对这个模型进行一层过滤。像下面这样：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 查询创建时间在今天之前的所有user，同时获取他们note的标题中含有关键字css的所有note</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note,
            <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
                <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
                }
            }
        }
    ],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:58:31'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 注意：当我们对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>的模型加了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>过滤时，会使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>来进行查询，这样保证只有那些拥有标题含有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>css</code>关键词<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>的用户才会返回。</p> 
<h3 id="articleHeader23" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 多对多关系</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在多对多关系中，必须要额外一张关系表来将2个表进行关联，这张表可以是单纯的一个关系表，也可以是一个实际的模型（含有自己的额外属性来描述关系）。我比较喜欢用一个模型的方式，这样方便以后做扩展。</p> 
<h4 id="articleHeader24" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tag = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tagging = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tagging'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.INTEGER(),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">// Note的实例拥有getTags、setTags、addTag、addTags、createTag、removeTag、hasTag方法</span>
Note.belongsToMany(Tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});
<span class="hljs-comment" style="color:rgb(153,153,136)">// Tag的实例拥有getNotes、setNotes、addNote、addNotes、createNote、removeNote、hasNote方法</span>
Tag.belongsToMany(Note, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>, 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，多对多关系中单独生成了一张关系表，并设置了2个外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>来和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>进行关联。关于关系表的命名，我比较喜欢使用动词，因为这张表是用来表示两张表的一种联系，而且这种联系多数时候伴随着一种动作。比如：用户收藏商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>collecting</code>）、用户购买商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>buying</code>）、用户加入项目（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>joining</code>）等等。</p> 
<h4 id="articleHeader25" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 增</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.createTag({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>}, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">0</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>表中插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的值设置外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>以及关系模型本身需要的属性（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>type: 0</code>）在关系表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tagging</code>中插入记录</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系表本身需要的属性，通过传递一个额外的对象给设置方法来实现。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTag(tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法和上面的方法实际上是一样的。只是我们先手动<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>create</code>了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Tag</code>模型。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法可以进行批量添加。当执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>addTags</code>时，实际上就是设置好对应的外键及关系模型本身的属性，然后在关系表中批量的插入数据。</p> 
<h4 id="articleHeader26" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 改</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 将tag改掉</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([tag3, tag4], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 前面添加部分的sql，和上面一样*/</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 更改部分的sql */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 先删除关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 插入新关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">4</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 执行逻辑是，先将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag2</code>在关系表中的关系删除，然后再将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag4</code>对应的关系插入关系表。</p> 
<h4 id="articleHeader27" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2, tag3], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 删除一个</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.removeTag(tag1);

<span class="hljs-comment" style="color:rgb(153,153,136)">// 全部删除</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除一个 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除全部 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 删除一个很简单，直接将关系表中的数据删除。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 全部删除时，首先需要查出关系表中<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>对应的所有数据，然后一次删掉。</p> 
<h4 id="articleHeader28" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.getTags({
    <span class="hljs-comment" style="color:rgb(153,153,136)">//这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 关系模型可以通过tag.tagging来访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种查询，就是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>所在的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// tag的notes可以通过tag.notes访问，关系模型可以通过tag.notes[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询就稍微有点复杂。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggings</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Tag
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note的tags可以通过note.tags访问，关系模型通过note.tags[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询和上面的查询类似。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggins</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h2 id="articleHeader29" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 其他没有涉及东西</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章已经够长了，但是其实我们还有很多没有涉及的东西，比如：聚合函数及查询（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>having</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>group by</code>）、模型的验证（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>validate</code>）、定义钩子（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>hooks</code>）、索引等等。</p> 
<p style="margin-top:1.5em; margin-bottom:0px; color:rgb(51,51,51); font-size:14px; text-align:start"> 这些主题下次再来写写。<em>如果你觉得<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">Sequelize</a>的文档有点多、杂，不方便看，可以看看这篇。</em></p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>来关系型操作数据库时，为了方便，通常都会选择一个合适的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>（Object Relationship Model）框架。毕竟直接操作<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>比较繁琐，通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我们可以使用面向对象的方式来操作表。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NodeJS</code>社区有很多的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>ORM</code>框架，我比较喜欢<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>，它功能丰富，可以非常方便的进行连表查询。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章我们就来看看，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>是如何在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>之上进行抽象、封装，从而提高开发效率的。</p> 
<h2 id="articleHeader0" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 安装</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章主要使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>MySQL</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>来进行介绍。安装非常简单：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="bash" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>$ npm install --save co
$ npm install --save sequelize
$ npm install --save mysql</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 代码模板如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Sequelize = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'sequelize'</span>);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> co = <span class="hljs-built_in" style="color:rgb(0,134,179)">require</span>(<span class="hljs-string" style="color:rgb(221,17,68)">'co'</span>);

co(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>* (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// code here</span>
}).catch(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(e);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 基本上，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的操作都会返回一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Promise</code>，在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>co</code>的框架里面可以直接进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>yield</code>，非常方便。</p> 
<h2 id="articleHeader1" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 建立数据库连接</h2> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin-right:0px; margin-bottom:1.5em; margin-left:0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative; margin-top:1.5em!important'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> sequelize = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> Sequelize(
    <span class="hljs-string" style="color:rgb(221,17,68)">'sample'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'root'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户名</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'zuki'</span>,   <span class="hljs-comment" style="color:rgb(153,153,136)">// 用户密码</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'dialect'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'mysql'</span>,  <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库使用mysql</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'host'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'localhost'</span>, <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器ip</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'port'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3306</span>,        <span class="hljs-comment" style="color:rgb(153,153,136)">// 数据库服务器端口</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'define'</span>: {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段以下划线（_）来分割（默认是驼峰命名风格）</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'underscored'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);</code></pre> 
<h2 id="articleHeader2" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 定义单张表</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 默认表名（一般这里写单数），生成时会自动转换成复数形式</span>
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这个值还会作为访问模型相关的模型时的属性名，所以建议用小写形式</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段定义（主键、created_at、updated_at默认包含，不用特殊定义）</span>
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">VARCHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 几点说明：</p> 
<ol style="margin-top:1.5em; margin-bottom:1.5em; margin-left:3em; padding-left:0px; color:rgb(51,51,51)"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">建表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>会自动执行的意思是你主动调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>的时候。类似这样：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>User.sync({force: true});</code>（加<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>force:true</code>，会先删掉表后再建表）。我们也可以先定义好表结构，再来定义<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>模型，这时可以不用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>sync</code>。两者在定义阶段没有什么关系，直到我们真正开始操作模型时，才会触及到表的操作，但是我们当然还是要尽量保证模型和表的同步（可以借助一些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>migration</code>工具）。自动建表功能有风险，使用需谨慎。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">所有数据类型，请参考文档<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/api/datatypes/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">数据类型</a>。</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">模型还可以定义虚拟属性、类方法、实例方法，请参考文档：<a target="_blank" href="http://sequelize.readthedocs.org/en/latest/docs/models-definition/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">模型定义</a></p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">其他一些特殊定义如下所示：</p> </li></ol> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(
    <span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>), <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段类型</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,         <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否允许为NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// 字段是否UNIQUE</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.STRING(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    },
    {
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 自定义表名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'freezeTableName'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'tableName'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'xyz_users'</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 是否需要增加createdAt、updatedAt、deletedAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'timestamps'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 不需要createdAt字段</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'createdAt'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将updatedAt字段改个名</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'updatedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'utime'</span>

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 将deletedAt字段改名</span>
        <span class="hljs-comment" style="color:rgb(153,153,136)">// 同时需要设置paranoid为true（此种模式下，删除数据时不会进行物理删除，而是设置deletedAt为当前时间</span>
        <span class="hljs-string" style="color:rgb(221,17,68)">'deletedAt'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'dtime'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'paranoid'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
    }
);</code></pre> 
<h2 id="articleHeader3" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 单表增删改查</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>获取的模型对象都是一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DAO</code>（Data Access Object）对象，这些对象会拥有许多操作数据库表的实例对象方法（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>save</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>update</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>等），需要获取“干净”的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>JSON</code>对象可以调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>get({'plain': true})</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 通过模型的类方法可以获取模型对象（比如：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findById</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>等）。</p> 
<h3 id="articleHeader4" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 增</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：build后对象只存在于内存中，调用save后才操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = User.build({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接操作db</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({
    <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'2'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小明'</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'小红'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'技术部'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 14:49:54'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>会为主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>设置<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DEFAULT</code>值来让数据库产生自增值，还将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>created_at</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>字段，非常方便。</p> 
<h3 id="articleHeader5" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 改</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1：操作对象属性（不会操作db），调用save后操作db</span>
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2：直接update操作db</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update({
    <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'小白白'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-02 15:00:04'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 更新操作时，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>将将当前时间设置成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>updated_at</code>，非常方便。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果想限制更新属性的白名单，可以这样写：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 方法1</span>
user.emp_id = <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>;
user.nick = <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>;
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.save({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 方法2</span>
user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'33'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'小白'</span>},
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'fields'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这样就只会更新<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>nick</code>字段，而<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>emp_id</code>会被忽略。这种方法在对表单提交过来的一大推数据中只更新某些属性的时候比较有用。</p> 
<h3 id="articleHeader6" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 删</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.destroy();</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有个特殊的地方是，如果我们开启了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>paranoid</code>（偏执）模式，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>destroy</code>的时候不会执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句，而是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UPDATE</code>语句将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>deleted_at</code>字段设置为当前时间（一开始此字段值为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>）。我们可以使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.destroy({force: true})</code>来强制删除，从而执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>DELETE</code>语句进行物理删除。</p> 
<h3 id="articleHeader7" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 查</h3> 
<h4 id="articleHeader8" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查全部</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader9" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 限制字段</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [<span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader10" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 字段重命名</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'attributes'</span>: [
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>, [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'user_nick'</span>]
    ]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span>;</code></pre> 
<h4 id="articleHeader11" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> where子句</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置项基本上完全支持了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>子句的功能，非常强大。我们一步步来进行介绍。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 基本条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,
        <span class="hljs-string" style="color:rgb(221,17,68)">'department'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>
    }
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(users);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`department`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k = v</code>，同时一个对象的多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>对被转换成了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>条件，即：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1: v1, k2: v2</code>转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k1 = v1 AND k2 = v2</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里有2个要点：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IS NULL</code>（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>= NULL</code><br> 这种语法）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">如果v是数组，会转换为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>IN</code>条件（因为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>没有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>=[1,2,3]</code>这种语法，况且也没数组这种类型）</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 操作符</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 操作符是对某个字段的进一步约束，可以有多个（对同一个字段的多个操作符会被转化为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>）。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id = 1</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id != 2</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$gt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,                <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt; 6</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$gte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">6</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &gt;= 6</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,               <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt; 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lte'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">10</span>,              <span class="hljs-comment" style="color:rgb(153,153,136)">// id &lt;= 10</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$between'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">6</span>, <span class="hljs-number" style="color:rgb(0,128,128)">10</span>],     <span class="hljs-comment" style="color:rgb(153,153,136)">// id BETWEEN 6 AND 10</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notBetween'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">11</span>, <span class="hljs-number" style="color:rgb(0,128,128)">15</span>], <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT BETWEEN 11 AND 15</span>

            <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>],           <span class="hljs-comment" style="color:rgb(153,153,136)">// id IN (1, 2)</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notIn'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]         <span class="hljs-comment" style="color:rgb(153,153,136)">// id NOT IN (3, 4)</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>,          <span class="hljs-comment" style="color:rgb(153,153,136)">// nick LIKE '%a%'</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$notLike'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>         <span class="hljs-comment" style="color:rgb(153,153,136)">// nick NOT LIKE '%a'</span>
        },
        <span class="hljs-string" style="color:rgb(221,17,68)">'updated_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>,             <span class="hljs-comment" style="color:rgb(153,153,136)">// updated_at IS NULL</span>
            <span class="hljs-string" style="color:rgb(221,17,68)">'$ne'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>              <span class="hljs-comment" style="color:rgb(153,153,136)">// created_at IS NOT NULL</span>
        }
    }
});
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> != <span class="hljs-number" style="color:rgb(0,128,128)">2</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt; <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &gt;= <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt; <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> &lt;= <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">6</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">10</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BETWEEN</span> <span class="hljs-number" style="color:rgb(0,128,128)">11</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-number" style="color:rgb(0,128,128)">15</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>)
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a'</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里我们发现，其实相等条件<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: v</code>这种写法是操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$eq: v}</code>的简写。而要实现不等条件就必须使用操作符写法<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>k: {$ne: v}</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 条件</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 上面我们说的条件查询，都是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>AND</code>查询，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>同时也支持<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>OR</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NOT</code>、甚至多种条件的联合查询。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> AND条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> OR条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> NOT条件</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 转换规则</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们这里做个总结。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>配置的转换规则的伪代码大概如下：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">translate</span>(<span class="hljs-params">where</span>) </span>{

    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (k, v <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> where) {

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == 表字段) {
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 先统一转为操作符形式</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 基本值) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: 'xxx'</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$eq'</span>: v};
            }
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (v == 数组) { <span class="hljs-comment" style="color:rgb(153,153,136)">// k: [1, 2, 3]</span>
                v = {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: v};
            }

            <span class="hljs-comment" style="color:rgb(153,153,136)">// 操作符转换</span>
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (opk, opv <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">of</span> v) {
                <span class="hljs-comment" style="color:rgb(153,153,136)">// op将opk转换对应的SQL表示</span>
                =&gt; k + op(opk, opv) + AND; 
            }
        }

        <span class="hljs-comment" style="color:rgb(153,153,136)">// 逻辑操作符处理</span>

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + OR;
            }
        }

        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">if</span> (k == <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>) {
            NOT +
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">for</span> (item <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">in</span> v) {
                =&gt; translate(item) + AND;
            }
        }

    }

    <span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">op</span>(<span class="hljs-params">opk, opv</span>) </span>{
        <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">switch</span> (opk) {
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$eq</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$ne</span> =&gt;</span> (<span class="hljs-string" style="color:rgb(221,17,68)">'!='</span> + opv) || <span class="hljs-string" style="color:rgb(221,17,68)">'IS NOT NULL'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lt</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;'</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$gte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&gt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$lte</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'&lt;='</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$between</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notBetween</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT BETWEEN '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">0</span>] + <span class="hljs-string" style="color:rgb(221,17,68)">' AND '</span> + opv[<span class="hljs-number" style="color:rgb(0,128,128)">1</span>];
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$in</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notIn</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT IN ('</span> + opv.join(<span class="hljs-string" style="color:rgb(221,17,68)">','</span>) + <span class="hljs-string" style="color:rgb(221,17,68)">')'</span>;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$like</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'LIKE '</span> + opv;
            <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">case</span> <span class="hljs-function"><span class="hljs-params">$notLike</span> =&gt;</span> <span class="hljs-string" style="color:rgb(221,17,68)">'NOT LIKE '</span> + opv;
        }
    }

}
</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 我们看一个复杂例子，基本上就是按上述流程来进行转换。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$not'</span>: [
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$in'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]
                }
            },
            {
                <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
                    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
                ]
            }
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$and'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ],
        <span class="hljs-string" style="color:rgb(221,17,68)">'$or'</span>: [
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>]},
            {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">null</span>}
        ]
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>)
)
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OR</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IS</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>
);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 排序</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'order'</span>: [
        [<span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'DESC'</span>],
        [<span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>]
    ]
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ORDER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">BY</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DESC</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 分页</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> countPerPage = <span class="hljs-number" style="color:rgb(0,128,128)">20</span>, currentPage = <span class="hljs-number" style="color:rgb(0,128,128)">5</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: countPerPage,                      <span class="hljs-comment" style="color:rgb(153,153,136)">// 每页多少条</span>
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: countPerPage * (currentPage - <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)  <span class="hljs-comment" style="color:rgb(153,153,136)">// 跳过多少条</span>
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">80</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他查询方法</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询一条数据</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findOne({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 查询并获取数量</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> result = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAndCountAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'limit'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">20</span>,
    <span class="hljs-string" style="color:rgb(221,17,68)">'offset'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(result);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">count</span>(*) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`count`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`department`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">20</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个方法会执行2个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result</code>对象将包含2个字段：<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.count</code>是数据总数，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>result.rows</code>是符合查询条件的所有数据。</p> 
<h3 id="articleHeader12" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 批量操作</h3> 
<h4 id="articleHeader13" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 插入</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.bulkCreate(
    [
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>},
        {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>, <span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>}
    ]
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
    (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>),
    (<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:43:30'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里需要注意，返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>数组里面每个对象的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值会是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>null</code>。如果需要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值，可以重新取下数据。</p> 
<h4 id="articleHeader14" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 更新</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.update(
    {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'nick'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>},
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]
        }
    }
);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`nick`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'hhhh'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 02:51:05'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>其实是一个数组，里面只有一个元素，表示更新的数据条数（看起来像是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>bug</code>）。</p> 
<h4 id="articleHeader15" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删除</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> affectedRows = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.destroy({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'id'</span>: [<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>]}
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里返回的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>affectedRows</code>是一个数字，表示删除的数据条数。</p> 
<h2 id="articleHeader16" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 关系</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系一般有三种：一对一、一对多、多对多。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>提供了清晰易用的接口来定义关系、进行表间的操作。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 当说到关系查询时，一般会需要获取多张表的数据。有建议用连表查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的，有不建议的。我的看法是，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>查询这种黑科技在数据量小的情况下可以使用，基本没有什么影响，数据量大的时候，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>的性能可能会是硬伤，应该尽量避免，可以分别根据索引取单表数据然后在应用层对数据进行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>merge</code>。当然，查询时一定要分页，不要<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>findAll</code>。</p> 
<h3 id="articleHeader17" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对一</h3> 
<h4 id="articleHeader18" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Account = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'account'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * User的实例对象将拥有getAccount、setAccount、addAccount方法
 */</span>
User.hasOne(Account);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Account的实例对象将拥有getUser、setUser、addUser方法
 */</span>
Account.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，这种关系中外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account</code>上。另外，<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>还给我们生成了外键约束。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 一般来说，外键约束在有些自己定制的数据库系统里面是禁止的，因为会带来一些性能问题。所以，建表的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>一般就去掉约束，同时给外键加一个索引（加速查询），数据的一致性就靠应用层来保证了。</p> 
<h4 id="articleHeader19" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = user.createAccount({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:24:53'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>作为外键在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>accounts</code>表里插入一条数据。</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Account.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'email'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);
anotherAccount = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(anotherAccount);
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(anotherAccount);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 06:37:14'</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">2</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据，此时外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>是空的，还没有关联user</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出当前<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>并将其<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为`NUL（为了保证一对一关系）</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">设置新的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>acount</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，生成关系</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setAccount(<span class="hljs-literal" style="color:rgb(0,128,128)">null</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:11:35'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里的删除实际上只是“切断”关系，并不会真正的物理删除记录。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑是：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">找出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所关联的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>设置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，完成关系的“切断”</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> account = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getAccount();
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(account);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里就是调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>getAccount</code>方法，根据外键来获取对应的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 但是其实我们用面向对象的思维来思考应该是获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的时候就能通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.account</code>的方式来访问<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>对象。这可以通过<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>（急加载，和懒加载相反）来实现。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>的含义是说，取一个模型的时候，同时也把相关的模型数据也给我取过来（我很着急，不能按默认那种取一个模型就取一个模型的方式，我还要更多）。方法如下：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findById(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, {
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Account]
});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user.get({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'plain'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>}));
<span class="hljs-comment" style="color:rgb(153,153,136)">/* 
 * 输出类似：
 { id: 1,
  emp_id: '1',
  created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
  account:
   { id: 2,
     email: 'b',
     created_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     updated_at: Tue Nov 03 2015 15:25:27 GMT+0800 (CST),
     user_id: 1 } }
 */</span></code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`email`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.email`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`accounts`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`account`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIMIT</span> <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，我们对2个表进行了一个外联接，从而在取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的同时也获取到了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 其他补充说明</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 如果我们重复调用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>方法，实际上会在数据库里面生成多条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>一样的数据，并不是真正的一对一。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 所以，在应用层保证一致性时，就需要我们遵循良好的编码约定。新增就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.createAccount</code>，更改就用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setAccount</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 也可以给<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>UNIQUE</code>约束，在数据库层面保证一致性，这时就需要做好<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>try/catch</code>，发生插入异常的时候能够知道是因为插入了多个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 另外，我们上面都是使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>来对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>account</code>进行操作。实际上反向操作也是可以的，这是因为我们定义了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Account.belongsTo(User)</code>。在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>里面定义关系时，关系的调用方会获得相关的“关系”方法，一般为了两边都能操作，会同时定义双向关系（这里双向关系指的是模型层面，并不会在数据库表中出现两个表都加上外键的情况，请放心）。</p> 
<h3 id="articleHeader20" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 一对多</h3> 
<h4 id="articleHeader21" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> User = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'user'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * User的实例对象将拥有getNotes、setNotes、addNote、createNote、removeNote、hasNote方法
 */</span>
User.hasMany(Note);
<span class="hljs-comment" style="color:rgb(153,153,136)">/*
 * Note的实例对象将拥有getUser、setUser、createUser方法
 */</span>
Note.belongsTo(User);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种关系中，外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>加在了多的一端（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表）。同时相关的模型也自动获得了一些方法。</p> 
<h4 id="articleHeader22" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 关系操作</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 增</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'>NSERT INTO `users` 
(`id`,`emp_id`,`updated_at`,`created_at`) 
VALUES 
(DEFAULT,'1','2015-11-03 23:52:05','2015-11-03 23:52:05');

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-03 23:52:05'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的主键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值作为外键直接在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表里插入一条数据。</p> </li></ul> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 方法2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.addNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 00:02:56'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">插入一条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，此时该条数据的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>为空</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值再更新该条<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，设置好外键，完成关系建立</p> </li></ul> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 改</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 为user增加note1、note2</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 先创建note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'c'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'d'</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// user拥有的note更改为note3、note4</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([note3, note4]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 省去了创建语句 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:45:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">4</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查询所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note4</code>的外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>，完成关系建立</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这里为啥还要查出所有的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据呢？因为我们需要根据传人<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>setNotes</code>的数组来计算出哪些<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>要切断关系、哪些要新增关系，所以就需要查出来进行一个计算集合的“交集”运算。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 删</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> user = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'emp_id'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'a'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.createNote({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'b'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.setNotes([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-04 12:50:08'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 实际上，上面说到的“改”已经有“删”的操作了（去掉<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note2</code>的关系）。这里的操作是删掉用户的所有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据，直接执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user.setNotes([])</code>即可。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的属性<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>查出所有相关的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">将其外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user_id</code>置为<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>NULL</code>，切断关系</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 还有一个真正的删除方法，就是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>removeNote</code>。如下所示：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:initial; word-break:break-word'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.removeNote(note);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SET</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>=<span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>=<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 01:40:12'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);</code></pre> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 查</h5> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况1</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>数据。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> user.getNotes({
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%a%'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>很简单，直接根据<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>id</code>值来查询满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>即可。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况2</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>属于哪个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [User],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
        }
    }
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note属于哪个user可以通过note.user访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user.updated_at`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法，因为获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 情况3</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，同时获取该<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [Note],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});
users.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">user</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// user的notes可以通过user.notes访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(user); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:51:35'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法获取的主体是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>user</code>，所以将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>users</code>去<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>。</p> 
<h6 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1em"> 一点补充</h6> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于各种join的区别，可以参考：<a target="_blank" href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/" rel="nofollow noopener noreferrer" style="background:transparent; color:rgb(0,154,97); outline:0px; padding-bottom:1px">http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/</a>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关于<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>eager loading</code>我想再啰嗦几句。<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>里面传递的是去取相关模型，默认是取全部，我们也可以再对这个模型进行一层过滤。像下面这样：</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 查询创建时间在今天之前的所有user，同时获取他们note的标题中含有关键字css的所有note</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> users = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> User.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note,
            <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
                <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
                    <span class="hljs-string" style="color:rgb(221,17,68)">'$like'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span>
                }
            }
        }
    ],
    <span class="hljs-string" style="color:rgb(221,17,68)">'where'</span>: {
        <span class="hljs-string" style="color:rgb(221,17,68)">'created_at'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'$lt'</span>: <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">new</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">Date</span>()
        }
    }
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`emp_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.user_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`users`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`user_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LIKE</span> <span class="hljs-string" style="color:rgb(221,17,68)">'%css%'</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`user`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> &lt; <span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-05 01:58:31'</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 注意：当我们对<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>include</code>的模型加了<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>where</code>过滤时，会使用<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>来进行查询，这样保证只有那些拥有标题含有<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>css</code>关键词<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>的用户才会返回。</p> 
<h3 id="articleHeader23" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.75em; border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 多对多关系</h3> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 在多对多关系中，必须要额外一张关系表来将2个表进行关联，这张表可以是单纯的一个关系表，也可以是一个实际的模型（含有自己的额外属性来描述关系）。我比较喜欢用一个模型的方式，这样方便以后做扩展。</p> 
<h4 id="articleHeader24" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 模型定义</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Note = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tag = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.CHAR(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>,
            <span class="hljs-string" style="color:rgb(221,17,68)">'unique'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">true</span>
        }
    }
);
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> Tagging = sequelize.define(<span class="hljs-string" style="color:rgb(221,17,68)">'tagging'</span>,
    {
        <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: {
            <span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: Sequelize.INTEGER(),
            <span class="hljs-string" style="color:rgb(221,17,68)">'allowNull'</span>: <span class="hljs-literal" style="color:rgb(0,128,128)">false</span>
        }
    }
);

<span class="hljs-comment" style="color:rgb(153,153,136)">// Note的实例拥有getTags、setTags、addTag、addTags、createTag、removeTag、hasTag方法</span>
Note.belongsToMany(Tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});
<span class="hljs-comment" style="color:rgb(153,153,136)">// Tag的实例拥有getNotes、setNotes、addNote、addNotes、createNote、removeNote、hasNote方法</span>
Tag.belongsToMany(Note, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'through'</span>: Tagging});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> auto_increment , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">CHAR</span>(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UNIQUE</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>)
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CREATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">TABLE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IF</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">EXISTS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (
    <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> DATETIME <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">NOT</span> <span class="hljs-literal" style="color:rgb(0,128,128)">NULL</span>, 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-built_in" style="color:rgb(0,134,179)">INTEGER</span> , 
    PRIMARY <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>), 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>, 
    FOREIGN <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">KEY</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">REFERENCES</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">UPDATE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">CASCADE</span>
) <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ENGINE</span>=<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">InnoDB</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到，多对多关系中单独生成了一张关系表，并设置了2个外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>来和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>进行关联。关于关系表的命名，我比较喜欢使用动词，因为这张表是用来表示两张表的一种联系，而且这种联系多数时候伴随着一种动作。比如：用户收藏商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>collecting</code>）、用户购买商品（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>buying</code>）、用户加入项目（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>joining</code>）等等。</p> 
<h4 id="articleHeader25" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 增</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.createTag({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>}, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">0</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">0</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:14:38'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>执行逻辑：</p> 
<ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-size:14px"><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>表插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">在<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>表中插入记录</p> </li><li style="margin:0.3em 0px"> <p style="margin-bottom:0px">使用对应的值设置外键<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag_id</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>以及关系模型本身需要的属性（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>type: 0</code>）在关系表<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tagging</code>中插入记录</p> </li></ul> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 关系表本身需要的属性，通过传递一个额外的对象给设置方法来实现。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTag(tag, {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">1</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:20:52'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法和上面的方法实际上是一样的。只是我们先手动<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>create</code>了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Tag</code>模型。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 方法3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> (<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这种方法可以进行批量添加。当执行<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>addTags</code>时，实际上就是设置好对应的外键及关系模型本身的属性，然后在关系表中批量的插入数据。</p> 
<h4 id="articleHeader26" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 改</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});
<span class="hljs-comment" style="color:rgb(153,153,136)">// 将tag改掉</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag4 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([tag3, tag4], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">3</span>});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 前面添加部分的sql，和上面一样*/</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">2</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:25:18'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 更改部分的sql */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag3'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DEFAULT</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'tag4'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 先删除关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 插入新关系 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INSERT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INTO</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> 
(<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>,<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">VALUES</span> 
(<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>),
(<span class="hljs-number" style="color:rgb(0,128,128)">4</span>,<span class="hljs-number" style="color:rgb(0,128,128)">1</span>,<span class="hljs-number" style="color:rgb(0,128,128)">3</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>,<span class="hljs-string" style="color:rgb(221,17,68)">'2015-11-06 02:29:55'</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 执行逻辑是，先将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag1</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag2</code>在关系表中的关系删除，然后再将<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag3</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag4</code>对应的关系插入关系表。</p> 
<h4 id="articleHeader27" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 删</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">// 先添加几个tag</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> note = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'title'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'note'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag1 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag1'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag2 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tag3 = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.create({<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'name'</span>: <span class="hljs-string" style="color:rgb(221,17,68)">'tag2'</span>});
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.addTags([tag1, tag2, tag3], {<!-- --><span class="hljs-string" style="color:rgb(221,17,68)">'type'</span>: <span class="hljs-number" style="color:rgb(0,128,128)">2</span>});

<span class="hljs-comment" style="color:rgb(153,153,136)">// 删除一个</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.removeTag(tag1);

<span class="hljs-comment" style="color:rgb(153,153,136)">// 全部删除</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.setTags([]);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除一个 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">1</span>);

<span class="hljs-comment" style="color:rgb(153,153,136)">/* 删除全部 */</span>
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;

<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">DELETE</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">WHERE</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">IN</span> (<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>);</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 删除一个很简单，直接将关系表中的数据删除。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 全部删除时，首先需要查出关系表中<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note_id</code>对应的所有数据，然后一次删掉。</p> 
<h4 id="articleHeader28" style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:0px; font-size:1.5em"> 查</h4> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况1</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> note.getTags({
    <span class="hljs-comment" style="color:rgb(153,153,136)">//这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 关系模型可以通过tag.tagging来访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AND</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> = <span class="hljs-number" style="color:rgb(0,128,128)">1</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 可以看到这种查询，就是执行一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况2</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>所在的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> tags = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Tag.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Note
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
});
tags.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">tag</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// tag的notes可以通过tag.notes访问，关系模型可以通过tag.notes[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(tag); 
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tag`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`notes.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询就稍微有点复杂。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggings</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h5 style="font-weight:500; line-height:1.2; color:rgb(51,51,51); margin-top:1.5em; margin-bottom:1.5em; font-size:1.25em"> 情况3</h5> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 查询所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>，同时获取每个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>note</code>所有满足条件的<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tag</code>。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>Sequelize</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="javascript" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">var</span> notes = <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">yield</span> Note.findAll({
    <span class="hljs-string" style="color:rgb(221,17,68)">'include'</span>: [
        {
            <span class="hljs-string" style="color:rgb(221,17,68)">'model'</span>: Tag
            <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对tags进行where</span>
        }
    ]
    <span class="hljs-comment" style="color:rgb(153,153,136)">// 这里可以对notes进行where</span>
});
notes.forEach(<span class="hljs-function"><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">function</span>(<span class="hljs-params">note</span>) </span>{
    <span class="hljs-comment" style="color:rgb(153,153,136)">// note的tags可以通过note.tags访问，关系模型通过note.tags[0].tagging访问</span>
    <span class="hljs-built_in" style="color:rgb(0,134,179)">console</span>.log(note);
});</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> <code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>SQL</code>：</p> 
<pre style='overflow:auto; font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; padding:1em; margin:1.5em 0px; line-height:1.45; word-break:break-all; color:rgb(51,51,51); border-width:initial; border-style:none; max-height:35em; position:relative'><code class="sql" style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:1em; padding:0px; color:inherit; background:none; white-space:inherit'><span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">SELECT</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`title`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`name`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.name`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.updated_at`</span>, 
<span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`type`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.type`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`created_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.created_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`updated_at`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.updated_at`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.tag_id`</span>, <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging.note_id`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">FROM</span> <span class="hljs-string" style="color:rgb(221,17,68)">`notes`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`note`</span> 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">LEFT</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">OUTER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> 
(
    <span class="hljs-string" style="color:rgb(221,17,68)">`taggings`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">INNER</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">JOIN</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">AS</span> <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span> 
    <span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
    <span class="hljs-string" style="color:rgb(221,17,68)">`tags`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`tag_id`</span>
) 
<span class="hljs-keyword" style="color:rgb(51,51,51); font-weight:bold">ON</span> 
<span class="hljs-string" style="color:rgb(221,17,68)">`note`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`id`</span> = <span class="hljs-string" style="color:rgb(221,17,68)">`tags.tagging`</span>.<span class="hljs-string" style="color:rgb(221,17,68)">`note_id`</span>;</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这个查询和上面的查询类似。首先是<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>和<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>taggins</code>进行了一个<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>inner join</code>，选出<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>tags</code>；然后<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>notes</code>和刚<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>join</code>出的集合再做一次<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>left join</code>，得到结果。</p> 
<h2 id="articleHeader29" style="font-size:2.25em; margin-top:1.5em; margin-bottom:0px; font-weight:500; line-height:1.2; color:rgb(51,51,51); border-bottom:1px solid rgb(238,238,238); padding-bottom:10px"> 其他没有涉及东西</h2> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-size:14px; text-align:start"> 这篇文章已经够长了，但是其实我们还有很多没有涉及的东西，比如：聚合函数及查询（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>having</code>、<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>group by</code>）、模型的验证（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>validate</code>）、定义钩子（<code style='font-family:"Source Code Pro",Consolas,Menlo,Monaco,"Courier New",monospace; font-size:0.93em; color:rgb(199,37,78); background-color:rgb(249,242,244)'>hooks</code>）、索引等等。</p> 
<p style="margin-top:1.5em; margin-bottom:0px; color:rgb(51,51,51); font-size:14px; text-align:start"> 这些主题下次再来写写。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/323ac412fe8612c7ca5f979edd08acec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">今日头条(java后台开发)——实习生面试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9379d54e1742939f780c3f7de0bac51a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql 存储引擎</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>