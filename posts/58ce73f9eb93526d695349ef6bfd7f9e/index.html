<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ceph参数配置--正式使用 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ceph参数配置--正式使用" />
<meta property="og:description" content="ceph参数配置 ceph中的可配置参数（日志级别，缓存设置等等）都定义在legacy_config_opts.h中，可以通过ceph daemon命令来查看或者修改这些参数配置。参数配置方式有两种：永久和临时。永久方式，就是在配置文件(如ceph.conf)中添加该参数的配置，重启进程后，参数就生效了。临时方式，就是通过ceph daemon命令设置内存中的参数。
# xxx为 admin_socket = $rundir/$cluster-$id.asok (/run/ceph/ceph-osd.0.asok) ceph daemon xxx config show 例如：&#34;log_file&#34;参数可以配置日志文件的路径
Option(&#34;log_file&#34;, Option::TYPE_STR, Option::LEVEL_BASIC) .set_default(&#34;&#34;) .set_daemon_default(&#34;/var/log/ceph/$cluster-$name.log&#34;) .set_description(&#34;path to log file&#34;) .add_see_also({&#34;log_to_stderr&#34;, &#34;err_to_stderr&#34;, &#34;log_to_syslog&#34;, &#34;err_to_syslog&#34;}), /* 所有选项的头文件包含在src/common/options/legacy_config_opts.h中 xx.cc xx.h文件由对应的xx.yaml配置文件使用src/common/options/y2c.py脚本自动生成 */ #include &#34;global_legacy_options.h&#34; #include &#34;cephfs-mirror_legacy_options.h&#34; #include &#34;mds_legacy_options.h&#34; #include &#34;mds-client_legacy_options.h&#34; #include &#34;mgr_legacy_options.h&#34; #include &#34;mon_legacy_options.h&#34; #include &#34;osd_legacy_options.h&#34; #include &#34;rbd_legacy_options.h&#34; #include &#34;rbd-mirror_legacy_options.h&#34; #include &#34;immutable-object-cache_legacy_options.h&#34; #include &#34;rgw_legacy_options.h&#34; .h文件.cc文件.yamlglobal_legacy_options.hglobal_options.ccglobal.yamlcephfs-mirror_legacy_options.hcephfs-mirror_options.cccephfs-mirror.yamlmds_legacy_options.hmds_options.ccmds.yamlmds-client_legacy_options.hmds-client_options.ccmds-client.yamlmgr_legacy_options.hmgr_options.ccmgr.yamlmon_legacy_options.hmon_options.ccmon.yamlosd_legacy_options.hosd_options.ccosd.yamlrbd_legacy_options.hrbd_options.ccrbd.yamlrbd-mirror_legacy_options.h.hrbd-mirror_options.ccrbd-mirror.yamlimmutable-object-cache_legacy_options.himmutable-object-cache_options.ccimmutable-object-cache.yamlrgw_legacy_options.hrgw_options.ccrgw.yaml 参数是以Option结构体存在(src/common/options.h)，Option结构体的定义如下
struct Option { enum type_t { // 参数值的类型 TYPE_UINT = 0, TYPE_INT = 1, TYPE_STR = 2, TYPE_FLOAT = 3, TYPE_BOOL = 4, TYPE_ADDR = 5, TYPE_ADDRVEC = 6, TYPE_UUID = 7, TYPE_SIZE = 8, TYPE_SECS = 9, TYPE_MILLISECS = 10, }; enum level_t { LEVEL_BASIC = 0, LEVEL_ADVANCED = 1, LEVEL_DEV = 2, LEVEL_UNKNOWN = 3, }; using value_t = std::variant&lt; std::monostate, std::string, uint64_t, int64_t, double, bool, entity_addr_t, entity_addrvec_t, std::chrono::seconds, std::chrono::milliseconds, size_t, uuid_d&gt;; const std::string name; // 参数名 const type_t type; // 参数类型 const level_t level; // 参数级别 std::string desc; // 该参数的含义 std::string long_desc; value_t value; // 参数值 value_t daemon_value; // 有daemon的参数值 std::vector&lt;const char*&gt; services; // services即服务类型，比如&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/58ce73f9eb93526d695349ef6bfd7f9e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-27T17:32:16+08:00" />
<meta property="article:modified_time" content="2023-04-27T17:32:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ceph参数配置--正式使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="ceph_0"></a>ceph参数配置</h3> 
<p>ceph中的可配置参数（日志级别，缓存设置等等）都定义在legacy_config_opts.h中，可以通过ceph daemon命令来查看或者修改这些参数配置。参数配置方式有两种：永久和临时。永久方式，就是在配置文件(如ceph.conf)中添加该参数的配置，重启进程后，参数就生效了。临时方式，就是通过ceph daemon命令设置内存中的参数。</p> 
<pre><code class="prism language-shell"><span class="token comment"># xxx为 admin_socket = $rundir/$cluster-$id.asok (/run/ceph/ceph-osd.0.asok)</span>
ceph daemon xxx config show 
</code></pre> 
<p>例如："log_file"参数可以配置日志文件的路径</p> 
<pre><code class="prism language-cpp"><span class="token function">Option</span><span class="token punctuation">(</span><span class="token string">"log_file"</span><span class="token punctuation">,</span> Option<span class="token double-colon punctuation">::</span>TYPE_STR<span class="token punctuation">,</span> Option<span class="token double-colon punctuation">::</span>LEVEL_BASIC<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set_default</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set_daemon_default</span><span class="token punctuation">(</span><span class="token string">"/var/log/ceph/$cluster-$name.log"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set_description</span><span class="token punctuation">(</span><span class="token string">"path to log file"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add_see_also</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"log_to_stderr"</span><span class="token punctuation">,</span> <span class="token string">"err_to_stderr"</span><span class="token punctuation">,</span> <span class="token string">"log_to_syslog"</span><span class="token punctuation">,</span> <span class="token string">"err_to_syslog"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> 
<pre><code class="prism language-c++">/*
所有选项的头文件包含在src/common/options/legacy_config_opts.h中
xx.cc xx.h文件由对应的xx.yaml配置文件使用src/common/options/y2c.py脚本自动生成
*/
#include "global_legacy_options.h"
#include "cephfs-mirror_legacy_options.h"
#include "mds_legacy_options.h"
#include "mds-client_legacy_options.h"
#include "mgr_legacy_options.h"
#include "mon_legacy_options.h"
#include "osd_legacy_options.h"
#include "rbd_legacy_options.h"
#include "rbd-mirror_legacy_options.h"
#include "immutable-object-cache_legacy_options.h"
#include "rgw_legacy_options.h"
</code></pre> 
<table><thead><tr><th>.h文件</th><th>.cc文件</th><th>.yaml</th></tr></thead><tbody><tr><td>global_legacy_options.h</td><td>global_options.cc</td><td>global.yaml</td></tr><tr><td>cephfs-mirror_legacy_options.h</td><td>cephfs-mirror_options.cc</td><td>cephfs-mirror.yaml</td></tr><tr><td>mds_legacy_options.h</td><td>mds_options.cc</td><td>mds.yaml</td></tr><tr><td>mds-client_legacy_options.h</td><td>mds-client_options.cc</td><td>mds-client.yaml</td></tr><tr><td>mgr_legacy_options.h</td><td>mgr_options.cc</td><td>mgr.yaml</td></tr><tr><td>mon_legacy_options.h</td><td>mon_options.cc</td><td>mon.yaml</td></tr><tr><td>osd_legacy_options.h</td><td>osd_options.cc</td><td>osd.yaml</td></tr><tr><td>rbd_legacy_options.h</td><td>rbd_options.cc</td><td>rbd.yaml</td></tr><tr><td>rbd-mirror_legacy_options.h.h</td><td>rbd-mirror_options.cc</td><td>rbd-mirror.yaml</td></tr><tr><td>immutable-object-cache_legacy_options.h</td><td>immutable-object-cache_options.cc</td><td>immutable-object-cache.yaml</td></tr><tr><td>rgw_legacy_options.h</td><td>rgw_options.cc</td><td>rgw.yaml</td></tr></tbody></table> 
<p>参数是以Option结构体存在(src/common/options.h)，Option结构体的定义如下</p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Option</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">enum</span> <span class="token class-name">type_t</span> <span class="token punctuation">{<!-- --></span>                  <span class="token comment">// 参数值的类型         </span>
    TYPE_UINT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    TYPE_INT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    TYPE_STR <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    TYPE_FLOAT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    TYPE_BOOL <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
    TYPE_ADDR <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
    TYPE_ADDRVEC <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
    TYPE_UUID <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>
    TYPE_SIZE <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>
    TYPE_SECS <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span>
    TYPE_MILLISECS <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">enum</span> <span class="token class-name">level_t</span> <span class="token punctuation">{<!-- --></span>
    LEVEL_BASIC <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    LEVEL_ADVANCED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    LEVEL_DEV <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    LEVEL_UNKNOWN <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">using</span> value_t <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span>
    std<span class="token double-colon punctuation">::</span>monostate<span class="token punctuation">,</span>
    std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span>
    <span class="token keyword">uint64_t</span><span class="token punctuation">,</span>
    <span class="token keyword">int64_t</span><span class="token punctuation">,</span>
    <span class="token keyword">double</span><span class="token punctuation">,</span>
    <span class="token keyword">bool</span><span class="token punctuation">,</span>
    entity_addr_t<span class="token punctuation">,</span>
    entity_addrvec_t<span class="token punctuation">,</span>
    std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>seconds<span class="token punctuation">,</span>
    std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>milliseconds<span class="token punctuation">,</span>
    size_t<span class="token punctuation">,</span>
    uuid_d<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>                   <span class="token comment">// 参数名</span>
  <span class="token keyword">const</span> type_t type<span class="token punctuation">;</span>                        <span class="token comment">// 参数类型</span>
  <span class="token keyword">const</span> level_t level<span class="token punctuation">;</span>                      <span class="token comment">// 参数级别</span>
  std<span class="token double-colon punctuation">::</span>string desc<span class="token punctuation">;</span>                         <span class="token comment">// 该参数的含义</span>
  std<span class="token double-colon punctuation">::</span>string long_desc<span class="token punctuation">;</span>
  value_t value<span class="token punctuation">;</span>                            <span class="token comment">// 参数值</span>
  value_t daemon_value<span class="token punctuation">;</span>                     <span class="token comment">// 有daemon的参数值</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">&gt;</span> services<span class="token punctuation">;</span>        <span class="token comment">// services即服务类型，比如"mds"</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">&gt;</span> see_also<span class="token punctuation">;</span>        <span class="token comment">// 该参数对应的类似的参数</span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">&gt;</span> enum_allowed<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>在src/common/options/build_options.cc中，定义的参数分为几类</p> 
<pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_global_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_mgr_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_mon_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_crimson_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_osd_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_rgw_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_rbd_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_rbd_mirror_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_immutable_object_cache_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_mds_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_mds_client_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_cephfs_mirror_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">get_ceph_exporter_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>从函数名可以看出来：get_global_options函数中的参数是global类型的，即基本所有的模块都可以使用这些参数。get_rgw_options函数中的参数是给rgw模块使用。get_rbd_options函数和get_rbd_mirror_options函数中的参数是给rbd相关模块使用。get_mds_options函数中的参数是给mds模块使用。get_mds_client_options函数中的参数是给mds client模块使用。</p> 
<h3><a id="ceph_options_120"></a>全局变量ceph_options</h3> 
<p>ceph_options包含了所有的参数，ceph_options = { Option{“log_file”}, Option(“***”)}</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> ceph_options <span class="token operator">=</span> <span class="token function">build_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在build_options中将所有的Option类放入ceph_options这个vector里面。</p> 
<pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> <span class="token function">build_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span> result <span class="token operator">=</span> <span class="token function">get_global_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">auto</span> ingest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>result<span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Option<span class="token operator">&gt;</span><span class="token operator">&amp;&amp;</span> options<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> svc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>o <span class="token operator">:</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">none_of</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>services<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span>services<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                       <span class="token punctuation">[</span>svc<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> known_svc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                         <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">strcmp</span><span class="token punctuation">(</span>known_svc<span class="token punctuation">,</span> svc<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
                       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        o<span class="token punctuation">.</span><span class="token function">add_service</span><span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_crimson_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"osd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_mgr_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"mgr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_mon_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"mon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_osd_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"osd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_rgw_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rgw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_rbd_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rbd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_rbd_mirror_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rbd-mirror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_immutable_object_cache_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"immutable-object-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_mds_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"mds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_mds_client_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"mds_client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_cephfs_mirror_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"cephfs-mirror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ingest</span><span class="token punctuation">(</span><span class="token function">get_ceph_exporter_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ceph-exporter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="md_config_t____ConfigValues_164"></a>md_config_t 和 ConfigValues</h3> 
<p>md_config_t结构体表示当前的Ceph配置，ceph_options中的参数都会存在这里。在ConfigValues中有特殊的成员变量定义。</p> 
<pre><code class="prism language-c++">class ConfigValues {
  using values_t = std::map&lt;std::string_view, std::map&lt;int32_t,Option::value_t&gt;&gt;;
  values_t values;
  // for populating md_config_impl::legacy_values in ctor
  friend struct md_config_t;

public:
  EntityName name;
  /// cluster name
  std::string cluster;
  
  //subsys用来存日志项
  ceph::logging::SubsystemMap subsys;
  bool no_mon_config = false;
  // Set of configuration options that have changed since the last
  // apply_changes
  using changed_set_t = std::set&lt;std::string&gt;;
  changed_set_t changed;

// This macro block defines C members of the md_config_t struct
// corresponding to the definitions in legacy_config_opts.h.
// These C members are consumed by code that was written before
// the new options.cc infrastructure: all newer code should
// be consume options via explicit get() rather than C members.
#define OPTION_OPT_INT(name) int64_t name;
#define OPTION_OPT_LONGLONG(name) int64_t name;
#define OPTION_OPT_STR(name) std::string name;
#define OPTION_OPT_DOUBLE(name) double name;
#define OPTION_OPT_FLOAT(name) double name;
#define OPTION_OPT_BOOL(name) bool name;
#define OPTION_OPT_ADDR(name) entity_addr_t name;
#define OPTION_OPT_ADDRVEC(name) entity_addrvec_t name;
#define OPTION_OPT_U32(name) uint64_t name;
#define OPTION_OPT_U64(name) uint64_t name;
#define OPTION_OPT_UUID(name) uuid_d name;
#define OPTION_OPT_SIZE(name) uint64_t name;
#define OPTION(name, ty)       \
  public:                      \
    OPTION_##ty(name)          
#define SAFE_OPTION(name, ty)       \
  protected:                        \
    OPTION_##ty(name)               
#include "common/options/legacy_config_opts.h"
#undef OPTION_OPT_INT
#undef OPTION_OPT_LONGLONG
#undef OPTION_OPT_STR
#undef OPTION_OPT_DOUBLE
#undef OPTION_OPT_FLOAT
#undef OPTION_OPT_BOOL
#undef OPTION_OPT_ADDR
#undef OPTION_OPT_ADDRVEC
#undef OPTION_OPT_U32
#undef OPTION_OPT_U64
#undef OPTION_OPT_UUID
#undef OPTION
#undef SAFE_OPTION
}
</code></pre> 
<p>最终md_config_t结构体定义如下</p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">md_config_t</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span><span class="token keyword">int64_t</span> ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       <span class="token keyword">uint64_t</span> ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       std<span class="token double-colon punctuation">::</span>string ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       <span class="token keyword">double</span> ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       <span class="token keyword">bool</span> ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       entity_addr_t ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       entity_addrvec_t ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token punctuation">,</span>
                       uuid_d ConfigValues<span class="token double-colon punctuation">::</span><span class="token operator">*</span><span class="token operator">&gt;</span> member_ptr_t<span class="token punctuation">;</span>

  <span class="token comment">// For use when intercepting configuration updates</span>
  <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">(</span>
      <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>k<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token operator">&gt;</span> config_callback<span class="token punctuation">;</span>

  <span class="token comment">/// true if we are a daemon (as per CephContext::code_env)</span>
  <span class="token keyword">const</span> <span class="token keyword">bool</span> is_daemon<span class="token punctuation">;</span>

  <span class="token comment">/*
   * Mapping from legacy config option names to class members
   * 将ceph_options中的Option的name与对应的md_config_t中的成员指针作为key-value保存
   */</span>
  std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string_view<span class="token punctuation">,</span> member_ptr_t<span class="token operator">&gt;</span> legacy_values<span class="token punctuation">;</span>

  <span class="token comment">/**
   * The configuration schema, in the form of Option objects describing
   * possible settings.
   * schema保存ceph_options中的所有Option参数
   */</span>
  std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string_view<span class="token punctuation">,</span> <span class="token keyword">const</span> Option<span class="token operator">&amp;</span><span class="token operator">&gt;</span> schema<span class="token punctuation">;</span>  
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c++">  // Populate list of legacy_values according to the OPTION() definitions
  // Note that this is just setting up our map of name-&gt;member ptr.  The
  // default values etc will get loaded in along with new-style data,
  // as all loads write to both the values map, and the legacy
  // members if present.
  legacy_values = {
#define OPTION(name, type) \
    {STRINGIFY(name), &amp;ConfigValues::name},
#define SAFE_OPTION(name, type) OPTION(name, type)
#include "options/legacy_config_opts.h"
#undef OPTION
#undef SAFE_OPTION
  };
</code></pre> 
<p>其中schema保存ceph_options中的所有Option参数，即</p> 
<p>schema = { &lt;“host”, Options(“host”)&gt;, …, &lt;“log_file”, Option(“log_file”)&gt;, …}</p> 
<p>legacy_values将ceph_options中的Option的name与对应的md_config_t中的成员指针作为key-value保存，即</p> 
<p>legacy_values = {&lt;“host”, &amp;md_config_t::host&gt;, … , &lt;“log_file”, &amp;md_config_t::log_file&gt;, …}</p> 
<p>subsys用来存日志项，即</p> 
<p>subsys = ceph::logging::SubsystemMap( m_subsys[ceph_subsys_ == 0] = Subsystem&lt;name = “none”, log_level = 0, gather_level = 5&gt;, … , m_subsys[ceph_subsys_crush == 3] = Subsystem&lt;name = “crush”, log_level = 1, gather_level = 1&gt;, m_subsys[ceph_subsys_mds == 4] = Subsystem&lt;name = “mds”, log_level = 1, gather_level = 5&gt;, … }。</p> 
<h3><a id="g_ceph_contextg_conf_294"></a>g_ceph_context和g_conf全局变量</h3> 
<p>一个模块的进程会有多个线程，比如ceph-mds，进程中有些内容需要整个进程中的所有线程都可以访问，比如参数配置和以及上下文内容，所以就有两个全局变量g_conf和g_ceph_context，在src/global/global_context.cc中定义如下</p> 
<pre><code class="prism language-cpp">CephContext <span class="token operator">*</span>g_ceph_context <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
ConfigProxy<span class="token operator">&amp;</span> <span class="token function">g_conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>WITH_SEASTAR<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>WITH_ALIEN<span class="token punctuation">)</span></span></span>
  <span class="token keyword">return</span> crimson<span class="token double-colon punctuation">::</span>common<span class="token double-colon punctuation">::</span><span class="token function">local_conf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token keyword">return</span> g_ceph_context<span class="token operator">-&gt;</span>_conf<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>md_config_t 实例对象作为ConfigProxy的成员，</p> 
<p>配置的代理类ConfigProxy，实际是封装了:<br> a) ConfigValues values;<br> b) ObserverMgr&lt;md_config_obs_t&gt; obs_mgr;<br> c) md_config_t config;</p> 
<blockquote> 
 <p>1、如果是set类接口：先通过md_config_t获取option，通过option获取name、类型、默认值、校验等信息，解析value，最后设置到ConfigValues中。</p> 
 <p>2、如果是get类接口：</p> 
 <p>​ 2.1、流程也是从md_config_t到ConfigValues, 如果从ConfigValues不能获取到，则获取Option的默认值<br> ​ 2.2、md_config_t::expand_meta 解析${var}到实际的值</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">CephContext</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span><span class="token operator">:</span>
  ConfigProxy _conf<span class="token punctuation">;</span>
  ceph<span class="token double-colon punctuation">::</span>logging<span class="token double-colon punctuation">::</span>Log <span class="token operator">*</span>_log<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ConfigProxy</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/**
   * The current values of all settings described by the schema
   */</span>
  ConfigValues values<span class="token punctuation">;</span>
  <span class="token keyword">using</span> md_config_obs_t <span class="token operator">=</span> ceph<span class="token double-colon punctuation">::</span>md_config_obs_impl<span class="token operator">&lt;</span>ConfigProxy<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  ObserverMgr<span class="token operator">&lt;</span>md_config_obs_t<span class="token operator">&gt;</span> obs_mgr<span class="token punctuation">;</span>
  
  <span class="token comment">// 配置对象</span>
  md_config_t config<span class="token punctuation">;</span>
    
  <span class="token comment">/** A lock that protects the md_config_t internals. It is
   * recursive, for simplicity.
   * It is best if this lock comes first in the lock hierarchy. We will
   * hold this lock when calling configuration observers.  */</span>
  <span class="token keyword">mutable</span> ceph<span class="token double-colon punctuation">::</span>recursive_mutex lock <span class="token operator">=</span>
    ceph<span class="token double-colon punctuation">::</span><span class="token function">make_recursive_mutex</span><span class="token punctuation">(</span><span class="token string">"ConfigProxy::lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>每个模块启动时，都需要实例化CephContext，就不需要单独去实例化md_config_t。</p> 
<p>在md_config_t的构造函数的入参为is_daemon，它是用来判断该模块是单独起一个守护线程，或者由别的线程去调用对外接口，不单独起线程。构造函数如下</p> 
<pre><code class="prism language-text">CephContext::CephContext(uint32_t module_type_,
                         enum code_environment_t code_env,
                         int init_flags_)
  : nref(1),
    _conf{code_env == CODE_ENVIRONMENT_DAEMON}
{...}

md_config_t::md_config_t(ConfigValues&amp; values,
			 const ConfigTracker&amp; tracker,
			 bool is_daemon){ ... }
</code></pre> 
<p>即判断code_env == CODE_ENVIRONMENT_DAEMON，在各个模块的main函数中有code_env的入参。即ceph_mds.cc, ceph_fuse.cc和ceph_mon.cc等中的md_config_t中is_daemon都是true，libcephfs的md_config_t中is_daemon是false。</p> 
<h3><a id="_373"></a>参数配置其它源码分析</h3> 
<h4><a id="global_init_375"></a>global_init分析</h4> 
<p>直接看代码，从ceph_mon.cc中开始看</p> 
<pre><code class="prism language-cpp"><span class="token keyword">auto</span> cct <span class="token operator">=</span> <span class="token function">global_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>defaults<span class="token punctuation">,</span> args<span class="token punctuation">,</span>
		     CEPH_ENTITY_TYPE_MON<span class="token punctuation">,</span> CODE_ENVIRONMENT_DAEMON<span class="token punctuation">,</span>
			 flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp">boost<span class="token double-colon punctuation">::</span>intrusive_ptr<span class="token operator">&lt;</span>CephContext<span class="token operator">&gt;</span>
<span class="token function">global_init</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> <span class="token operator">*</span>defaults<span class="token punctuation">,</span>
	    std<span class="token double-colon punctuation">::</span>vector <span class="token operator">&lt;</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">,</span>
	    <span class="token keyword">uint32_t</span> module_type<span class="token punctuation">,</span> code_environment_t code_env<span class="token punctuation">,</span>
	    <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">bool</span> run_pre_init<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> <span class="token comment">// module_type = CEPH_ENTITY_TYPE_MON, code_env = CODE_ENVIRONMENT_DAEMON, flags = 0</span>
  <span class="token comment">// run_pre_init = true  </span>
  <span class="token comment">// Ensure we're not calling the global init functions multiple times.</span>
  <span class="token keyword">static</span> <span class="token keyword">bool</span> first_run <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>run_pre_init<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// We will run pre_init from here (default).</span>
    <span class="token function">ceph_assert</span><span class="token punctuation">(</span><span class="token operator">!</span>g_ceph_context <span class="token operator">&amp;&amp;</span> first_run<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">global_pre_init</span><span class="token punctuation">(</span>defaults<span class="token punctuation">,</span> args<span class="token punctuation">,</span> module_type<span class="token punctuation">,</span> code_env<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Caller should have invoked pre_init manually.</span>
    <span class="token function">ceph_assert</span><span class="token punctuation">(</span>g_ceph_context <span class="token operator">&amp;&amp;</span> first_run<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  first_run <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>global_pre_init是关键函数：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">global_pre_init</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> <span class="token operator">*</span>defaults<span class="token punctuation">,</span>
  std<span class="token double-colon punctuation">::</span>vector <span class="token operator">&lt;</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">,</span>
  <span class="token keyword">uint32_t</span> module_type<span class="token punctuation">,</span> code_environment_t code_env<span class="token punctuation">,</span>
  <span class="token keyword">int</span> flags<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> <span class="token comment">// module_type = CEPH_ENTITY_TYPE_MON, code_env = CODE_ENVIRONMENT_DAEMON, flags = 0</span>
  std<span class="token double-colon punctuation">::</span>string conf_file_list<span class="token punctuation">;</span>
  std<span class="token double-colon punctuation">::</span>string cluster <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

  <span class="token comment">// ensure environment arguments are included in early processing</span>
  <span class="token comment">// 环境变里CEPH_ARGS中的选项加入到args中</span>
  <span class="token function">env_to_vec</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
  解析options来获取对应的值, 预解释命令行参数，对于只是显示版本号的命令，只把
  版本号打出来程序就直接可以exit(0)了；对于其他的参数，解释好后放到
  CephInitParameters里供后面使用。
  */</span>
  CephInitParameters iparams <span class="token operator">=</span> <span class="token function">ceph_argparse_early_args</span><span class="token punctuation">(</span>
    args<span class="token punctuation">,</span> module_type<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>cluster<span class="token punctuation">,</span> <span class="token operator">&amp;</span>conf_file_list<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 主要是实例化new CephContext(iparams.module_type, flags); </span>
  CephContext <span class="token operator">*</span>cct <span class="token operator">=</span> <span class="token function">common_preinit</span><span class="token punctuation">(</span>iparams<span class="token punctuation">,</span> code_env<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// cct-&gt;_conf-&gt;cluster = "ceph"</span>
  cct<span class="token operator">-&gt;</span>_conf<span class="token operator">-&gt;</span>cluster <span class="token operator">=</span> cluster<span class="token punctuation">;</span>
  <span class="token function">global_init_set_globals</span><span class="token punctuation">(</span>cct<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">auto</span><span class="token operator">&amp;</span> conf <span class="token operator">=</span> cct<span class="token operator">-&gt;</span>_conf<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> <span class="token punctuation">(</span>CINIT_FLAG_NO_DEFAULT_CONFIG_FILE<span class="token operator">|</span>
	       CINIT_FLAG_NO_MON_CONFIG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    conf<span class="token operator">-&gt;</span>no_mon_config <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// alternate defaults</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>defaults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> i <span class="token operator">:</span> <span class="token operator">*</span>defaults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      conf<span class="token punctuation">.</span><span class="token function">set_val_default</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>first<span class="token punctuation">,</span> i<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>conf<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get_val</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"no_config_file"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    flags <span class="token operator">|=</span> CINIT_FLAG_NO_DEFAULT_CONFIG_FILE<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//读取配置文件内容，命令里不指明的话，默认使用/etc/ceph/ceph.conf。</span>
  <span class="token keyword">int</span> ret <span class="token operator">=</span> conf<span class="token punctuation">.</span><span class="token function">parse_config_files</span><span class="token punctuation">(</span><span class="token function">c_str_or_null</span><span class="token punctuation">(</span>conf_file_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
				    <span class="token operator">&amp;</span>cerr<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="env_to_vec_463"></a>env_to_vec分析</h4> 
<p>split_dashdash把args根据"–“拆分成两段（注意：–不同于–param），前段为类型为vector的options， 后段为类型为vector的arguments。<br> get_str_vec。把环境变量值取出来：默认的环境变量是"CEPH_ARGS”，可以通过参数来指定名字。以空格“ ” 为间隔，把环境变量拆分为一个个字符串到g_str_vec中。<br> g_str_vec腾挪到env 的vector&lt;const char*&gt;中，同args一样以“–”进行拆分。<br> 分别聚合env和args的options和arguments到args中， 还是以“–”来间隔，无论是options还是arguments，env的参数都在前。</p> 
<pre><code class="prism language-c++">void env_to_vec(std::vector&lt;const char*&gt;&amp; args, const char *name)
{
  if (!name)
    name = "CEPH_ARGS";
  //把args根据"--"拆分成两段，前段为options，后段为arguments
  auto [options, arguments] = split_dashdash(args);

  /*
   * We can only populate str_vec once. Other threads could hold pointers into
   * it, so clearing it out and replacing it is not currently safe.
   */
  g_str_vec_lock.lock();
  if (g_str_vec.empty()) {
    char *p = getenv(name);
    if (!p) {
      g_str_vec_lock.unlock();
      return;
    }
    //以空格“ ” 为间隔，把环境变量拆分为一个个字符串到g_str_vec中
    get_str_vec(p, " ", g_str_vec);
  }
  g_str_vec_lock.unlock();

  std::vector&lt;const char*&gt; env;
  for (const auto&amp; s : g_str_vec) {
    env.push_back(s.c_str());
  }
  //同args一样以“--”进行拆分
  auto [env_options, env_arguments] = split_dashdash(env);

  //聚合env和args的options和arguments到args中， 还是以“--”来间隔，无论是options还是arguments，env的参数都在前。
  args.clear();
  args.insert(args.end(), env_options.begin(), env_options.end());
  args.insert(args.end(), options.begin(), options.end());
  if (arguments.empty() &amp;&amp; env_arguments.empty()) {
    return;
  }
  args.push_back("--");
  args.insert(args.end(), env_arguments.begin(), env_arguments.end());
  args.insert(args.end(), arguments.begin(), arguments.end());
}
</code></pre> 
<p>调用ceph_argparse_early_args来解析进程启动时设置的参数，比如ceph-mon启动时设置的参数如下</p> 
<pre><code class="prism language-bash">/usr/bin/ceph-osd -f --cluster ceph --id <span class="token number">0</span> --setuser ceph --setgroup ceph
</code></pre> 
<p>common_preinit</p> 
<pre><code class="prism language-cpp">CephContext <span class="token operator">*</span><span class="token function">common_preinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> CephInitParameters <span class="token operator">&amp;</span>iparams<span class="token punctuation">,</span>
			    <span class="token keyword">enum</span> <span class="token class-name">code_environment_t</span> code_env<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">// set code environment</span>
  <span class="token function">ANNOTATE_BENIGN_RACE_SIZED</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g_code_env<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>g_code_env<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"g_code_env"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  g_code_env <span class="token operator">=</span> code_env<span class="token punctuation">;</span>

  <span class="token comment">// Create a configuration object</span>
  <span class="token comment">/*
  CephContext初始化时最重要的就是实例化md_config_t，md_config_t保存了osd的所有
  默认配置信息，主要是使用OPTION_OPT_INT，OPTION_OPT_LONGLONG等一系列的宏加上
  common/config_opts.h灵活实现配置字段的定义。同时CephContext实例化时还初始化
  了adminsocket，log等模块。
  */</span>
  CephContext <span class="token operator">*</span>cct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CephContext</span><span class="token punctuation">(</span>iparams<span class="token punctuation">.</span>module_type<span class="token punctuation">,</span> code_env<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">auto</span><span class="token operator">&amp;</span> conf <span class="token operator">=</span> cct<span class="token operator">-&gt;</span>_conf<span class="token punctuation">;</span>
  <span class="token comment">// add config observers here</span>

  <span class="token comment">// Set up our entity name.</span>
  conf<span class="token operator">-&gt;</span>name <span class="token operator">=</span> iparams<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">return</span> cct<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最重要的就是parse_config_files</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> md_config_t<span class="token double-colon punctuation">::</span><span class="token function">parse_config_files</span><span class="token punctuation">(</span>ConfigValues<span class="token operator">&amp;</span> values<span class="token punctuation">,</span>
				    <span class="token keyword">const</span> ConfigTracker<span class="token operator">&amp;</span> tracker<span class="token punctuation">,</span>
				    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>conf_files_str<span class="token punctuation">,</span>
				    std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">*</span>warnings<span class="token punctuation">,</span>
				    <span class="token keyword">int</span> flags<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>safe_to_start_threads<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">-</span>ENOSYS<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>conf_files_str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    values<span class="token punctuation">.</span>cluster <span class="token operator">=</span> <span class="token function">get_cluster_name</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// open new conf</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> fn <span class="token operator">:</span> <span class="token function">get_conffile_paths</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> conf_files_str<span class="token punctuation">,</span> warnings<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    bufferlist bl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string error<span class="token punctuation">;</span>
    <span class="token comment">// 将ceph.conf(如/etc/ceph/ceph.conf)中的内容读上来保存在bl中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bl<span class="token punctuation">.</span><span class="token function">read_file</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      parse_error <span class="token operator">=</span> error<span class="token punctuation">;</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ostringstream oss<span class="token punctuation">;</span>
    <span class="token comment">//解释配置文件</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">parse_buffer</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> bl<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bl<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>oss<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      parse_error<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      conf_path <span class="token operator">=</span> fn<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    parse_error <span class="token operator">=</span> oss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token operator">-</span>ENOENT<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// it must have been all ENOENTs, that's the only way we got here</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>conf_path<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token operator">-</span>ENOENT<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    values<span class="token punctuation">.</span>cluster <span class="token operator">=</span> <span class="token function">get_cluster_name</span><span class="token punctuation">(</span>conf_path<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update_legacy_vals</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>md_config_t::_expand_meta函数用来替换"$"后面的字符串，比如admin_socket = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         r 
        
       
         u 
        
       
         n 
        
       
         d 
        
       
         i 
        
       
         r 
        
       
         / 
        
       
      
        rundir/ 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord">/</span></span></span></span></span>cluster-$id.asok，调用expand_meta函数后admin_socket = /var/run/ceph/ceph-mon.node1.asok</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3fec99d261c8a3dfbfdc5a00090152c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 创建Excel并写入内容</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c2f2b5c858659b390c380037fcb0871a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">批量修改Mysql数据库中的索引名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>