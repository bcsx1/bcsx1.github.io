<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringCloud OpenFeign å…¨åŠŸèƒ½é…ç½®è¯¦è§£ï¼ˆä¸€æ–‡åƒé€OpenFeignï¼‰ - ç¼–ç¨‹éšæƒ³</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringCloud OpenFeign å…¨åŠŸèƒ½é…ç½®è¯¦è§£ï¼ˆä¸€æ–‡åƒé€OpenFeignï¼‰" />
<meta property="og:description" content="ç›®å½• ä¸€ã€ç®€ä»‹äºŒã€feignå’ŒOpenFeignçš„åŒºåˆ«ä¸‰ã€SpringCloudé›†æˆOpenFeign1ã€å¼•å…¥starter2ã€åœ¨å¯åŠ¨ç±»æˆ–è€…é…ç½®ç±»ä¸ŠåŠ @EnableFeignClientsæ³¨è§£3ã€å£°æ˜Feignæ¥å£4ã€@FeignClient å±æ€§ä»‹ç»5ã€@EnableFeignClients å±æ€§ä»‹ç» å››ã€é»˜è®¤é…ç½®1ã€æ›¿æ¢é»˜è®¤é…ç½®å‰ç½®è¯´æ˜ï¼ˆè¿™é‡Œä»¥Feignè¯·æ±‚æ—¥å¿—ä¸ºä¾‹ï¼‰2ã€ä½¿ç”¨é…ç½®æ–‡ä»¶æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆæ¨èä½¿ç”¨ä¼˜å…ˆçº§æœ€é«˜ï¼‰2.1ã€å…¨å±€è¯·æ±‚æ—¥å¿—é…ç½®2.2ã€ç‹¬ç«‹è¯·æ±‚æ—¥å¿—é…ç½®ï¼ˆç‹¬ç«‹é…ç½®ä¼˜å…ˆï¼‰2.3ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ä¼˜å…ˆçº§æœ€é«˜ 3ã€åœ¨@EnableFeignClientsä¸­ä½¿ç”¨ç¼ºçœï¼ˆé»˜è®¤ï¼‰é…ç½®ç±»æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆå¦‚æœä¸åšç‰¹æ®Šå¤„ç†è¿™ä¸ªé…ç½®ç±»ä¼˜å…ˆçº§å¾ˆé«˜ä¼šæ¯”ç‹¬ç«‹é…ç½®è¿˜é«˜ï¼‰3.1ã€é…ç½®å®ç°3.2ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨ç¼ºçœé…ç½®ç±»ä¼˜å…ˆçº§ä¼šé‚£ä¹ˆé«˜ 4ã€ä½¿ç”¨ç‹¬ç«‹é…ç½®æ›¿æ¢é»˜è®¤é…ç½® äº”ã€è§£å†³allow-bean-definition-overridingé—®é¢˜1ã€é”™è¯¯åŸå› 2ã€è§£å†³æ–¹æ³•ä¸€ï¼ˆåˆ«ç”¨ï¼‰3ã€è§£å†³æ–¹æ³•äºŒï¼ˆæ¨èï¼‰ å…­ã€è§£å†³GETè¯·æ±‚æ— æ³•ä¼ é€’å¯¹è±¡å‚æ•°é—®é¢˜ï¼ˆä½¿ç”¨@SpringQueryMapï¼‰ä¸ƒã€OpenFeignè¶…æ—¶é…ç½®1ã€ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰2ã€ä½¿ç”¨@FeignClienté…ç½®è¶…æ—¶æ—¶é—´3ã€ä¸ºå•ç‹¬æ¥å£è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆè¿™ç§æ–¹å¼ä¼˜å…ˆçº§æ¯”ä½¿ç”¨é…ç½®æ–‡ä»¶æ›´é«˜ï¼‰4ã€é€šè¿‡Ribboné…ç½®æ–‡ä»¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆä¸ä¸»åŠ¨è®¾ç½®Feignçš„è¶…æ—¶æ—¶é—´æ‰æœ‰æ•ˆï¼Œä¸æ¨èä½¿ç”¨ï¼‰ å…«ã€OpenFeigné‡è¯•é…ç½®1ã€OpenFeigné»˜è®¤é‡è¯•æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰2ã€é€šè¿‡Ribboné…ç½®é‡è¯•ï¼ˆé…ç½®äº†Feignçš„é…ç½®æˆ–è€…spring-retryåˆ™Ribboné‡è¯•é…ç½®ä¼šå¤±æ•ˆï¼‰3ã€é€šè¿‡Feignçš„Retryeræ¥å£é…ç½®é‡è¯•ï¼ˆå¦‚æœåœ¨é…ç½®æ–‡ä»¶è®¾ç½®äº†Feignçš„Retryeré‚£ä¹ˆRibbonå’Œspring-retryçš„é‡è¯•æœºåˆ¶éƒ½ä¼šå¤±æ•ˆï¼‰4ã€é€šè¿‡spring-retryä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½®é‡è¯•ï¼ˆå¦‚æœFeigné…ç½®è‡ªå·±çš„Retryeré‚£ä¹ˆspring-retryä¸ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯ä¼šæ¯”Ribbonä¼˜å…ˆçº§é«˜ï¼‰ ä¹ã€OpenFeignè¯·æ±‚æ—¥å¿—çº§åˆ«é…ç½®1ã€é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰2ã€ä½¿ç”¨@FeignClienté…ç½® åã€OpenFeignæ‹¦æˆªå™¨1ã€é€šè¿‡OpenFeignè¯·æ±‚æ‹¦æˆªå™¨è®¾ç½®ç»Ÿä¸€è¯·æ±‚å¤´ åä¸€ã€æ›¿æ¢OpenFeigné»˜è®¤HTTPè¯·æ±‚æ¡†æ¶HttpURLConnection1ã€æ›¿æ¢æˆHttpClient2ã€æ›¿æ¢æˆOkHttp3ã€æºç æ–­ç‚¹æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ åäºŒã€OpenFeigné…ç½®hystrix1ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackè¿›è¡Œå›è°ƒï¼ˆä¸èƒ½æ§åˆ¶ä¸åŒå¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰2ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackFactoryè¿›è¡Œå›è°ƒï¼ˆå¯ä»¥æ§åˆ¶å¯¹åº”å¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰ åä¸‰ã€é…ç½®Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•1ã€å•ç‹¬é…ç½®æŸä¸ªæœåŠ¡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆä½¿ç”¨å…¨å±€é…ç½®æ— æ•ˆï¼‰2ã€ä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®Ribbonçš„å…¨å±€è´Ÿè½½å‡è¡¡ç®—æ³•ä¼šæ— æ•ˆï¼Ÿ ä¸€ã€ç®€ä»‹ OpenFeignå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªwebå£°æ˜å¼httpè¿œç¨‹è°ƒç”¨å·¥å…·ï¼Œç›´æ¥å¯ä»¥æ ¹æ®æœåŠ¡åç§°å»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°æŒ‡å®šçš„æœåŠ¡IPé›†åˆï¼Œæä¾›äº†æ¥å£å’Œæ³¨è§£æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œå†…åµŒé›†æˆäº†Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ã€‚
äºŒã€feignå’ŒOpenFeignçš„åŒºåˆ« 1ã€åº•å±‚éƒ½æ˜¯å†…ç½®äº†Ribbonï¼Œå»è°ƒç”¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚
2ã€Feignæ˜¯Netflixå…¬å¸å†™çš„ï¼Œæ˜¯SpringCloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ï¼Œæ˜¯SpringCloudä¸­çš„ç¬¬ä¸€ä»£è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚
3ã€OpenFeignæ˜¯SpringCloudè‡ªå·±ç ”å‘çš„ï¼Œåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†Spring MVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚æ˜¯SpringCloudä¸­çš„ç¬¬äºŒä»£è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚
4ã€Feignæœ¬èº«ä¸æ”¯æŒSpring MVCçš„æ³¨è§£ï¼Œä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡
5ã€OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚
ä¸‰ã€SpringCloudé›†æˆOpenFeign ç‰ˆæœ¬è¯´æ˜ï¼š
Spring Cloud Versionï¼šHoxton.SR12
Spring Boot Versionï¼š2.3.12.RELEASE
ä¸åŒç‰ˆæœ¬æºç å¯èƒ½ä¼šæœ‰å·®å¼‚
1ã€å¼•å…¥starter &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€åœ¨å¯åŠ¨ç±»æˆ–è€…é…ç½®ç±»ä¸ŠåŠ @EnableFeignClientsæ³¨è§£ @SpringBootApplication @EnableFeignClients public class Application { public static void main(String[] args) { SpringApplication.run(Application.class, args); } } 3ã€å£°æ˜Feignæ¥å£ @FeignClient(value = &#34;kerwin-user&#34;,contextId = &#34;userInfoClient&#34;) public interface UserInfoClient { /** è·å–ç”¨æˆ·ä¿¡æ¯ */ @GetMapping(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/eef4dea26c68de83dd18149afdee1759/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-06T20:46:24+08:00" />
<meta property="article:modified_time" content="2023-09-06T20:46:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹éšæƒ³" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹éšæƒ³</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringCloud OpenFeign å…¨åŠŸèƒ½é…ç½®è¯¦è§£ï¼ˆä¸€æ–‡åƒé€OpenFeignï¼‰</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">ä¸€ã€ç®€ä»‹</a></li><li><a href="#feignOpenFeign_3" rel="nofollow">äºŒã€feignå’ŒOpenFeignçš„åŒºåˆ«</a></li><li><a href="#SpringCloudOpenFeign_10" rel="nofollow">ä¸‰ã€SpringCloudé›†æˆOpenFeign</a></li><li><ul><li><a href="#1starter_16" rel="nofollow">1ã€å¼•å…¥starter</a></li><li><a href="#2EnableFeignClients_25" rel="nofollow">2ã€åœ¨å¯åŠ¨ç±»æˆ–è€…é…ç½®ç±»ä¸ŠåŠ @EnableFeignClientsæ³¨è§£</a></li><li><a href="#3Feign_35" rel="nofollow">3ã€å£°æ˜Feignæ¥å£</a></li><li><a href="#4FeignClient__46" rel="nofollow">4ã€@FeignClient å±æ€§ä»‹ç»</a></li><li><a href="#5EnableFeignClients__96" rel="nofollow">5ã€@EnableFeignClients å±æ€§ä»‹ç»</a></li></ul> 
   </li><li><a href="#_122" rel="nofollow">å››ã€é»˜è®¤é…ç½®</a></li><li><ul><li><a href="#1Feign_126" rel="nofollow">1ã€æ›¿æ¢é»˜è®¤é…ç½®å‰ç½®è¯´æ˜ï¼ˆè¿™é‡Œä»¥Feignè¯·æ±‚æ—¥å¿—ä¸ºä¾‹ï¼‰</a></li><li><a href="#2font_color__redfont_144" rel="nofollow">2ã€<font color="red">ä½¿ç”¨é…ç½®æ–‡ä»¶æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆæ¨èä½¿ç”¨ä¼˜å…ˆçº§æœ€é«˜ï¼‰</font></a></li><li><ul><li><a href="#21_145" rel="nofollow">2.1ã€å…¨å±€è¯·æ±‚æ—¥å¿—é…ç½®</a></li><li><a href="#22_154" rel="nofollow">2.2ã€ç‹¬ç«‹è¯·æ±‚æ—¥å¿—é…ç½®ï¼ˆç‹¬ç«‹é…ç½®ä¼˜å…ˆï¼‰</a></li><li><a href="#23_165" rel="nofollow">2.3ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ä¼˜å…ˆçº§æœ€é«˜</a></li></ul> 
    </li><li><a href="#3EnableFeignClients_169" rel="nofollow">3ã€åœ¨@EnableFeignClientsä¸­ä½¿ç”¨ç¼ºçœï¼ˆé»˜è®¤ï¼‰é…ç½®ç±»æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆå¦‚æœä¸åšç‰¹æ®Šå¤„ç†è¿™ä¸ªé…ç½®ç±»ä¼˜å…ˆçº§å¾ˆé«˜ä¼šæ¯”ç‹¬ç«‹é…ç½®è¿˜é«˜ï¼‰</a></li><li><ul><li><a href="#31_170" rel="nofollow">3.1ã€é…ç½®å®ç°</a></li><li><a href="#32_186" rel="nofollow">3.2ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨ç¼ºçœé…ç½®ç±»ä¼˜å…ˆçº§ä¼šé‚£ä¹ˆé«˜</a></li></ul> 
    </li><li><a href="#4_190" rel="nofollow">4ã€ä½¿ç”¨ç‹¬ç«‹é…ç½®æ›¿æ¢é»˜è®¤é…ç½®</a></li></ul> 
   </li><li><a href="#allowbeandefinitionoverriding_206" rel="nofollow">äº”ã€è§£å†³allow-bean-definition-overridingé—®é¢˜</a></li><li><ul><li><a href="#1_213" rel="nofollow">1ã€é”™è¯¯åŸå› </a></li><li><a href="#2_215" rel="nofollow">2ã€è§£å†³æ–¹æ³•ä¸€ï¼ˆåˆ«ç”¨ï¼‰</a></li><li><a href="#3_222" rel="nofollow">3ã€è§£å†³æ–¹æ³•äºŒï¼ˆæ¨èï¼‰</a></li></ul> 
   </li><li><a href="#GETSpringQueryMap_230" rel="nofollow">å…­ã€è§£å†³GETè¯·æ±‚æ— æ³•ä¼ é€’å¯¹è±¡å‚æ•°é—®é¢˜ï¼ˆä½¿ç”¨@SpringQueryMapï¼‰</a></li><li><a href="#OpenFeign_241" rel="nofollow">ä¸ƒã€OpenFeignè¶…æ—¶é…ç½®</a></li><li><ul><li><a href="#1_243" rel="nofollow">1ã€ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰</a></li><li><a href="#2FeignClient_260" rel="nofollow">2ã€ä½¿ç”¨@FeignClienté…ç½®è¶…æ—¶æ—¶é—´</a></li><li><a href="#3_278" rel="nofollow">3ã€ä¸ºå•ç‹¬æ¥å£è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆè¿™ç§æ–¹å¼ä¼˜å…ˆçº§æ¯”ä½¿ç”¨é…ç½®æ–‡ä»¶æ›´é«˜ï¼‰</a></li><li><a href="#4RibbonFeign_291" rel="nofollow">4ã€é€šè¿‡Ribboné…ç½®æ–‡ä»¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆä¸ä¸»åŠ¨è®¾ç½®Feignçš„è¶…æ—¶æ—¶é—´æ‰æœ‰æ•ˆï¼Œä¸æ¨èä½¿ç”¨ï¼‰</a></li></ul> 
   </li><li><a href="#OpenFeign_300" rel="nofollow">å…«ã€OpenFeigné‡è¯•é…ç½®</a></li><li><ul><li><a href="#1OpenFeign_301" rel="nofollow">1ã€OpenFeigné»˜è®¤é‡è¯•æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰</a></li><li><a href="#2RibbonFeignspringretryRibbon_315" rel="nofollow">2ã€é€šè¿‡Ribboné…ç½®é‡è¯•ï¼ˆé…ç½®äº†Feignçš„é…ç½®æˆ–è€…spring-retryåˆ™Ribboné‡è¯•é…ç½®ä¼šå¤±æ•ˆï¼‰</a></li><li><a href="#3font_colorredFeignRetryerfontFeignRetryerRibbonspringretry_325" rel="nofollow">3ã€<font color="red">é€šè¿‡Feignçš„Retryeræ¥å£é…ç½®é‡è¯•</font>ï¼ˆå¦‚æœåœ¨é…ç½®æ–‡ä»¶è®¾ç½®äº†Feignçš„Retryeré‚£ä¹ˆRibbonå’Œspring-retryçš„é‡è¯•æœºåˆ¶éƒ½ä¼šå¤±æ•ˆï¼‰</a></li><li><a href="#4springretryFeignRetryerspringretryRibbon_380" rel="nofollow">4ã€é€šè¿‡spring-retryä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½®é‡è¯•ï¼ˆå¦‚æœFeigné…ç½®è‡ªå·±çš„Retryeré‚£ä¹ˆspring-retryä¸ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯ä¼šæ¯”Ribbonä¼˜å…ˆçº§é«˜ï¼‰</a></li></ul> 
   </li><li><a href="#OpenFeign_406" rel="nofollow">ä¹ã€OpenFeignè¯·æ±‚æ—¥å¿—çº§åˆ«é…ç½®</a></li><li><ul><li><a href="#1_423" rel="nofollow">1ã€é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰</a></li><li><a href="#2FeignClient_438" rel="nofollow">2ã€ä½¿ç”¨@FeignClienté…ç½®</a></li></ul> 
   </li><li><a href="#OpenFeign_452" rel="nofollow">åã€OpenFeignæ‹¦æˆªå™¨</a></li><li><ul><li><a href="#1OpenFeign_454" rel="nofollow">1ã€é€šè¿‡OpenFeignè¯·æ±‚æ‹¦æˆªå™¨è®¾ç½®ç»Ÿä¸€è¯·æ±‚å¤´</a></li></ul> 
   </li><li><a href="#OpenFeignHTTPHttpURLConnection_492" rel="nofollow">åä¸€ã€æ›¿æ¢OpenFeigné»˜è®¤HTTPè¯·æ±‚æ¡†æ¶HttpURLConnection</a></li><li><ul><li><a href="#1HttpClient_493" rel="nofollow">1ã€æ›¿æ¢æˆHttpClient</a></li><li><a href="#2OkHttp_510" rel="nofollow">2ã€æ›¿æ¢æˆOkHttp</a></li><li><a href="#3_527" rel="nofollow">3ã€æºç æ–­ç‚¹æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</a></li></ul> 
   </li><li><a href="#OpenFeignhystrix_531" rel="nofollow">åäºŒã€OpenFeigné…ç½®hystrix</a></li><li><ul><li><a href="#1FeignClientfallback_539" rel="nofollow">1ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackè¿›è¡Œå›è°ƒï¼ˆä¸èƒ½æ§åˆ¶ä¸åŒå¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰</a></li><li><a href="#2FeignClientfallbackFactory_564" rel="nofollow">2ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackFactoryè¿›è¡Œå›è°ƒï¼ˆå¯ä»¥æ§åˆ¶å¯¹åº”å¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰</a></li></ul> 
   </li><li><a href="#Ribbon_597" rel="nofollow">åä¸‰ã€é…ç½®Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</a></li><li><ul><li><a href="#1_598" rel="nofollow">1ã€å•ç‹¬é…ç½®æŸä¸ªæœåŠ¡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆä½¿ç”¨å…¨å±€é…ç½®æ— æ•ˆï¼‰</a></li><li><a href="#2Ribbon_618" rel="nofollow">2ã€ä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®Ribbonçš„å…¨å±€è´Ÿè½½å‡è¡¡ç®—æ³•ä¼šæ— æ•ˆï¼Ÿ</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>ä¸€ã€ç®€ä»‹</h3> 
<p>OpenFeignå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªwebå£°æ˜å¼httpè¿œç¨‹è°ƒç”¨å·¥å…·ï¼Œç›´æ¥å¯ä»¥æ ¹æ®æœåŠ¡åç§°å»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°æŒ‡å®šçš„æœåŠ¡IPé›†åˆï¼Œæä¾›äº†æ¥å£å’Œæ³¨è§£æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œå†…åµŒé›†æˆäº†Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ã€‚</p> 
<h3><a id="feignOpenFeign_3"></a>äºŒã€feignå’ŒOpenFeignçš„åŒºåˆ«</h3> 
<blockquote> 
 <p>1ã€åº•å±‚éƒ½æ˜¯å†…ç½®äº†Ribbonï¼Œå»è°ƒç”¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚<br> 2ã€Feignæ˜¯Netflixå…¬å¸å†™çš„ï¼Œæ˜¯SpringCloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ï¼Œæ˜¯SpringCloudä¸­çš„ç¬¬ä¸€ä»£è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚<br> 3ã€OpenFeignæ˜¯SpringCloudè‡ªå·±ç ”å‘çš„ï¼Œåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†Spring MVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚æ˜¯SpringCloudä¸­çš„ç¬¬äºŒä»£è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚<br> 4ã€Feignæœ¬èº«ä¸æ”¯æŒSpring MVCçš„æ³¨è§£ï¼Œä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡<br> 5ã€OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</p> 
</blockquote> 
<h3><a id="SpringCloudOpenFeign_10"></a>ä¸‰ã€SpringCloudé›†æˆOpenFeign</h3> 
<p><font color="red"><strong>ç‰ˆæœ¬è¯´æ˜ï¼š<br> Spring Cloud Versionï¼šHoxton.SR12<br> Spring Boot Versionï¼š2.3.12.RELEASE<br> ä¸åŒç‰ˆæœ¬æºç å¯èƒ½ä¼šæœ‰å·®å¼‚</strong><br> </font></p> 
<h4><a id="1starter_16"></a>1ã€å¼•å…¥starter</h4> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>openfeign<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="2EnableFeignClients_25"></a>2ã€åœ¨å¯åŠ¨ç±»æˆ–è€…é…ç½®ç±»ä¸ŠåŠ @EnableFeignClientsæ³¨è§£</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3Feign_35"></a>3ã€å£°æ˜Feignæ¥å£</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/** è·å–ç”¨æˆ·ä¿¡æ¯ */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user-info/info/{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4FeignClient__46"></a>4ã€@FeignClient å±æ€§ä»‹ç»</h4> 
<p>@FeignClientç”¨äºæ ‡è®°ä¸€ä¸ªæ¥å£ä¸ºFeignå®¢æˆ·ç«¯ï¼Œ@FeignClientä¸­çš„å±æ€§å¯ä»¥ä½¿ç”¨ <mark>${feign.name}</mark> è¿™ç§æ–¹å¼å–å€¼</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">FeignClient</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// nameå’Œvalueå±æ€§ç”¨äºæ ‡æ³¨å®¢æˆ·ç«¯åç§°ï¼Œä¹Ÿå¯ä»¥ç”¨${propertyKey}è·å–é…ç½®å±æ€§</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
	<span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// è¯¥ç±»çš„Beanåç§° PS: è¿™ä¸ªé…ç½®å¾ˆé‡è¦åç»­ä¼šè¯¦ç»†ä»‹ç»</span>
	<span class="token class-name">String</span> <span class="token function">contextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// nameå’Œvalueå±æ€§ç”¨äºæ ‡æ³¨å®¢æˆ·ç«¯åç§°ï¼Œä¹Ÿå¯ä»¥ç”¨${propertyKey}è·å–é…ç½®å±æ€§</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span>
	<span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// å¼ƒç”¨ è¢«qualifiers()æ›¿ä»£ã€‚</span>
	<span class="token annotation punctuation">@Deprecated</span>
	<span class="token class-name">String</span> <span class="token function">qualifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// æ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„@Qualifierså€¼ã€‚å¦‚æœqualifier()å’Œqualifiers()éƒ½å­˜åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åè€…ï¼Œé™¤équalifier()è¿”å›çš„æ•°ç»„ä¸ºç©ºæˆ–åªåŒ…å«ç©ºå€¼æˆ–ç©ºç™½å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†é¦–å…ˆé€€å›åˆ°qualifier()ï¼Œå¦‚æœä¹Ÿä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨default = contextId + "FeignClient"ã€‚</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">qualifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// ç»å¯¹URLæˆ–å¯è§£æä¸»æœºå PS: ä½¿ç”¨è¿™ä¸ªé…ç½®ååªèƒ½å®šå‹å‘é€ï¼Œæ²¡æœ‰è´Ÿè½½å‡è¡¡èƒ½åŠ›</span>
	<span class="token class-name">String</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// æ˜¯å¦åº”è¯¥è§£ç 404è€Œä¸æ˜¯æŠ›å‡ºFeignExceptions</span>
	<span class="token keyword">boolean</span> <span class="token function">decode404</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token comment">// ç”¨äºæ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„è‡ªå®šä¹‰é…ç½®ç±»ã€‚å¯ä»¥åŒ…å«ç»„æˆå®¢æˆ·ç«¯éƒ¨åˆ†çš„è¦†ç›–@Beanå®šä¹‰ï¼Œé»˜è®¤é…ç½®éƒ½åœ¨FeignClientsConfigurationç±»ä¸­ï¼Œå¯ä»¥æŒ‡å®šFeignClientsConfigurationç±»ä¸­æ‰€æœ‰çš„é…ç½®</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// æŒ‡å®šå¤±è´¥å›è°ƒç±»</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

	<span class="token comment">// ä¸ºæŒ‡å®šçš„å‡å®¢æˆ·ç«¯æ¥å£å®šä¹‰ä¸€ä¸ªfallbackå·¥å‚ã€‚fallbackå·¥å‚å¿…é¡»ç”Ÿæˆfallbackç±»çš„å®ä¾‹ï¼Œè¿™äº›å®ä¾‹å®ç°äº†ç”±FeignClientæ³¨é‡Šçš„æ¥å£ã€‚</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallbackFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

	<span class="token comment">// æ‰€æœ‰æ–¹æ³•çº§æ˜ å°„ä½¿ç”¨çš„è·¯å¾„å‰ç¼€</span>
	<span class="token class-name">String</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

	<span class="token comment">// æ˜¯å¦å°†è™šæ‹Ÿä»£ç†æ ‡è®°ä¸ºä¸»beanã€‚é»˜è®¤ä¸ºtrueã€‚</span>
	<span class="token keyword">boolean</span> <span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="5EnableFeignClients__96"></a>5ã€@EnableFeignClients å±æ€§ä»‹ç»</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">FeignClientsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableFeignClients</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// æ‰«æ@FeignClientåŒ…åœ°å€</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// ç”¨æˆ·æ‰«æFeignå®¢æˆ·ç«¯çš„åŒ…ï¼Œä¹Ÿå°±æ˜¯@FeignClientæ ‡æ³¨çš„ç±»ï¼Œä¸valueåŒä¹‰ï¼Œå¹¶ä¸”äº’æ–¥</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">basePackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// basePackages()çš„ç±»å‹å®‰å…¨æ›¿ä»£æ–¹æ¡ˆï¼Œç”¨äºæŒ‡å®šè¦æ‰«æå¸¦æ³¨é‡Šçš„ç»„ä»¶çš„åŒ…ã€‚æ¯ä¸ªæŒ‡å®šç±»åˆ«çš„åŒ…å°†è¢«æ‰«æã€‚ è€ƒè™‘åœ¨æ¯ä¸ªåŒ…ä¸­åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„æ— æ“ä½œæ ‡è®°ç±»æˆ–æ¥å£ï¼Œé™¤äº†è¢«è¯¥å±æ€§å¼•ç”¨ä¹‹å¤–æ²¡æœ‰å…¶ä»–ç”¨é€”ã€‚</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">basePackageClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// ä¸ºæ‰€æœ‰å‡å®¢æˆ·ç«¯å®šåˆ¶@Configurationï¼Œé»˜è®¤é…ç½®éƒ½åœ¨FeignClientsConfigurationä¸­ï¼Œå¯ä»¥è‡ªå·±å®šåˆ¶</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">defaultConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// å¯ä»¥æŒ‡å®š@FeignClientæ ‡æ³¨çš„ç±»ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œå°±ä¼šç¦ç”¨ç±»è·¯å¾„æ‰«æ</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">clients</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_122"></a>å››ã€é»˜è®¤é…ç½®</h3> 
<ul><li> <p>æˆ‘ä»¬ä½¿ç”¨çš„å¾ˆå¤šæ¡†æ¶éƒ½ä¼šæœ‰è‡ªå·±çš„é»˜è®¤é…ç½®ï¼Œå°¤å…¶æ˜¯å’ŒSpringBooté›†æˆçš„starteråŒ…ï¼ŒOpenFeigné›†æˆSpringBootçš„starteråŒ…åŒæ ·çš„ä¹Ÿä¼šç»™æˆ‘ä»¬åšå¾ˆå¤šé»˜è®¤é…ç½®ã€‚</p> </li><li> <p>åœ¨ <mark>FeignClientsConfiguration</mark> ç±»ä¸­ï¼ŒOpenFeignä¸ºæˆ‘ä»¬åšäº†å¾ˆå¤šé»˜è®¤é…ç½®ï¼Œè¿™ä¸ªé»˜è®¤é…ç½®æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå®šä¹‰å¹¶ä¸”è¦†ç›–ã€‚</p> </li></ul> 
<h4><a id="1Feign_126"></a>1ã€æ›¿æ¢é»˜è®¤é…ç½®å‰ç½®è¯´æ˜ï¼ˆè¿™é‡Œä»¥Feignè¯·æ±‚æ—¥å¿—ä¸ºä¾‹ï¼‰</h4> 
<ul><li> <p>è‡ªå®šä¹‰å¹¶ä¸”è¦†ç›–é»˜è®¤é…ç½®æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨å…¨å±€é…ç½®å¦ä¸€ä¸ªæ˜¯æ¯ä¸ªFeignClientä½¿ç”¨ç‹¬ç«‹é…ç½®ï¼Œè¿™é‡Œä»¥OpenFeignè¯·æ±‚æ—¥å¿—é…ç½®åšä»‹ç»ã€‚</p> </li><li> <p>Feignè¿œç¨‹è°ƒç”¨æ—¶æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œè¾“å‡ºçš„æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œå…ˆè¦æŠŠé¡¹ç›®çš„è¾“å‡ºæ—¥å¿—è®¾ç½®ä¸ºdebugã€‚</p> <pre><code class="prism language-java"><span class="token comment">// è®¾ç½®æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ä¸ºdebugï¼Œæˆ‘è¿™é‡Œå°†æˆ‘è‡ªå·±com.kerwinåŒ…æ‰€æœ‰æ—¥å¿—è¾“å‡ºçº§åˆ«è®¾ç½®æˆäº†debugï¼Œæ ¹æ®è‡ªå·±éœ€è¦æ¥å³å¯</span>
logging<span class="token operator">:</span>
  level<span class="token operator">:</span>
    com<span class="token operator">:</span>
      kerwin<span class="token operator">:</span> debug
</code></pre> </li><li> <p>ä¸ºäº†æ›´åŠ ç²¾ç»†åŒ–æ§åˆ¶æ—¥å¿—è¾“å‡ºï¼ŒFeignè¿˜æä¾›äº†æ—¥å¿—å†…å®¹è¾“å‡ºçš„å‡ ä¸ªçº§åˆ«ã€‚<br> NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ã€‚<br> BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•å’ŒURLä»¥åŠå“åº”çŠ¶æ€ä»£ç å’Œæ‰§è¡Œæ—¶é—´ã€‚<br> HEADERSï¼šé™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”å¤´çš„ä¿¡æ¯ã€‚<br> FULLï¼šé™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</p> </li></ul> 
<h4><a id="2font_color__redfont_144"></a>2ã€<font color="red">ä½¿ç”¨é…ç½®æ–‡ä»¶æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆæ¨èä½¿ç”¨ä¼˜å…ˆçº§æœ€é«˜ï¼‰</font></h4> 
<h5><a id="21_145"></a>2.1ã€å…¨å±€è¯·æ±‚æ—¥å¿—é…ç½®</h5> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é»˜è®¤é…ç½® å¦‚æœä¸å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ä¼šèµ°é»˜è®¤é…ç½®
      <span class="token keyword">default</span><span class="token operator">:</span>
        loggerLevel<span class="token operator">:</span> <span class="token constant">FULL</span> # æ—¥å¿—çº§åˆ« <span class="token constant">NONE</span>ï¼šä¸æ‰“å°  <span class="token constant">BASIC</span>ï¼šæ‰“å°ç®€å•ä¿¡æ¯ <span class="token constant">HEADERS</span>ï¼šæ‰“å°å¤´ä¿¡æ¯ <span class="token constant">FULL</span>ï¼šæ‰“å°å…¨éƒ¨ä¿¡æ¯ ï¼ˆé»˜è®¤ <span class="token constant">NONE</span>ï¼‰
</code></pre> 
<h5><a id="22_154"></a>2.2ã€ç‹¬ç«‹è¯·æ±‚æ—¥å¿—é…ç½®ï¼ˆç‹¬ç«‹é…ç½®ä¼˜å…ˆï¼‰</h5> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é…ç½®å•ç‹¬<span class="token class-name">FeignClient</span>
      # <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
      # å¦‚æœ<span class="token class-name">FeignClient</span>æ³¨è§£è®¾ç½®äº†contextIdè¿™é‡Œå°±ä½¿ç”¨userInfoClientå¦‚æœæ²¡æœ‰è®¾ç½®contextIdå°±ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°kerwin<span class="token operator">-</span>user
      userInfoClient<span class="token operator">:</span>
        loggerLevel<span class="token operator">:</span> <span class="token constant">FULL</span> # æ—¥å¿—çº§åˆ« <span class="token constant">NONE</span>ï¼šé»˜è®¤ä¸æ‰“å°  <span class="token constant">BASIC</span>ï¼šæ‰“å°ç®€å•ä¿¡æ¯ <span class="token constant">HEADERS</span>ï¼šæ‰“å°å¤´ä¿¡æ¯ <span class="token constant">FULL</span>ï¼šæ‰“å°å…¨éƒ¨ä¿¡æ¯ï¼ˆé»˜è®¤ <span class="token constant">NONE</span>ï¼‰
</code></pre> 
<h5><a id="23_165"></a>2.3ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ä¼˜å…ˆçº§æœ€é«˜</h5> 
<p>é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®å…¶å®æ˜¯æœ€åæ‰åŠ è½½çš„ï¼Œä¼šå°†å…¶å®ƒåœ°æ–¹é…ç½®çš„ä¿¡æ¯å…¨éƒ¨é¡¶æ‰æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æºç  <font color="red">FeignClientFactoryBean.configureFeign </font> è¿™ä¸ªæ–¹æ³•ä¼šæ¯”å…¶å®ƒé…ç½®åŠ è½½åæ‰§è¡Œï¼Œä¼šåœ¨è¿™é‡Œå®ç°æ›¿æ¢ï¼Œ æ›¿æ¢é¡ºåºæ˜¯<font color="red">Springå®¹å™¨ä¸­çš„é…ç½®Bean -&gt; é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤é…ç½® -&gt; é…ç½®æ–‡ä»¶ä¸­çš„ç‹¬ç«‹é…ç½® </font>ã€‚<br> <img src="https://images2.imgbox.com/c5/21/WnOgIn9L_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="3EnableFeignClients_169"></a>3ã€åœ¨@EnableFeignClientsä¸­ä½¿ç”¨ç¼ºçœï¼ˆé»˜è®¤ï¼‰é…ç½®ç±»æ›¿æ¢é»˜è®¤é…ç½®ï¼ˆå¦‚æœä¸åšç‰¹æ®Šå¤„ç†è¿™ä¸ªé…ç½®ç±»ä¼˜å…ˆçº§å¾ˆé«˜ä¼šæ¯”ç‹¬ç«‹é…ç½®è¿˜é«˜ï¼‰</h4> 
<h5><a id="31_170"></a>3.1ã€é…ç½®å®ç°</h5> 
<ul><li>å…ˆå†™ä¸€ä¸ªç±»æä¾›ä¸€ä¸ªæ—¥å¿—æ–¹æ³•feignLoggerLevelè®¾ç½®ä¸€ä¸ªæ—¥å¿—ç­‰çº§ï¼Œå¹¶ä¸”ä½¿ç”¨<font color="red">@Beanå’Œ@ConditionalOnMissingBean </font>æ ‡è®°ã€‚<br> <font color="red"><strong>PSï¼šéœ€è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªç±»ä¸Šä¸èƒ½åŠ @Configurationè¿™ç±»æ³¨è§£ï¼Œå¦‚æœè¢«Springæ‰«æåˆ°äº†é‚£ä¹ˆå…¨å±€éƒ½ä¼šä½¿ç”¨è¿™ä¸€ä¸ªé…ç½®</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignCommonSpecification</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span> <span class="token comment">//è¿™é‡Œå¦‚æœä¸åŠ @ConditionalOnMissingBeané‚£ä¹ˆç‹¬ç«‹é…ç½®æ˜¯æ— æ³•ç”Ÿæ•ˆçš„ï¼ŒåŸç†åœ¨åé¢è¡¥å……</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>åœ¨@EnableFeignClientsä¸­æ·»åŠ defaultConfiguration</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> <span class="token class-name">FeignCommonSpecification</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="32_186"></a>3.2ã€æºç åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨ç¼ºçœé…ç½®ç±»ä¼˜å…ˆçº§ä¼šé‚£ä¹ˆé«˜</h5> 
<p>è¦åˆ†æè¿™ä¸ªé—®é¢˜é¦–å…ˆè¦çŸ¥é“Springçš„<font color="red"> allowBeanDefinitionOverriding </font>å‚æ•°æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œç®€å•è§£é‡Šä¸€ä¸‹ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æ§åˆ¶æ³¨å†Œ<font color="red"> BeanDefinition </font>æ˜¯å¦å¯ä»¥è¦†ç›–åŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è¿™ä¸ªå‚æ•°ä¸ºtrueæ—¶Beançš„åç§°ç›¸åŒæ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œåœ¨Springçš„<font color="red"> DefaultListableBeanFactory </font>ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‚æ•°é»˜è®¤ä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´è°ååŠ è½½é‚£ä¹ˆåœ¨<font color="red"> BeanDefinitionMap </font>ä¸­å°±æ³¨å†Œçš„å°±æ˜¯è°ï¼Œåœ¨<font color="red"> NamedContextFactory çš„ createContext </font>æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯å…ˆæ³¨å†Œçš„ç‹¬ç«‹é…ç½®ç„¶ååœ¨æ³¨å†Œçš„ç¼ºçœé…ç½®ï¼Œåˆ°è¿™é‡Œå°±å¾ˆæ˜æ˜¾äº†ç¼ºçœé…ç½®æŠŠç‹¬ç«‹é…ç½®é¡¶æ›¿äº†ï¼Œåœ¨ç¼ºçœé…ç½®çš„æ–¹æ³•ä¸­åŠ ä¸Š<font color="red"> @ConditionalOnMissingBean </font>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç‚¹è¦æä¸€ä¸‹åœ¨SpringBootä¸­ä¼šå°†<font color="red"> allowBeanDefinitionOverriding </font>è®¾ç½®ä¸ºfalseï¼Œä½†æ˜¯æ¯ä¸ª<font color="red"> FeignClient </font>éƒ½ä¼šé€šè¿‡åˆ›å»º<font color="red"> NamedContextFactory çš„ createContext </font>æ–¹æ³•åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„<font color="red"> AnnotationConfigApplicationContext </font>å­å®¹å™¨ï¼Œè¿™ä¸ªå­å®¹å™¨ä¸­<font color="red"> allowBeanDefinitionOverriding </font>é»˜è®¤è¿˜æ˜¯trueã€‚<br> <img src="https://images2.imgbox.com/9a/4d/ychKkwNk_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="4_190"></a>4ã€ä½¿ç”¨ç‹¬ç«‹é…ç½®æ›¿æ¢é»˜è®¤é…ç½®</h4> 
<ul><li>å…ˆå†™ä¸€ä¸ªç±»æä¾›ä¸€ä¸ªæ—¥å¿—æ–¹æ³•feignLoggerLevelè®¾ç½®ä¸€ä¸ªæ—¥å¿—ç­‰çº§ï¼Œå¹¶ä¸”ä½¿ç”¨@Beanæ ‡è®°ã€‚<br> <font color="red"><strong>PSï¼šéœ€è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸ªç±»ä¸Šä¸èƒ½åŠ @Configurationè¿™ç±»æ³¨è§£ï¼Œå¦‚æœè¢«Springæ‰«æåˆ°äº†é‚£ä¹ˆå…¨å±€éƒ½ä¼šä½¿ç”¨è¿™ä¸€ä¸ªé…ç½®</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoClientSpecification</span>  <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>åœ¨@FeignClientä¸­æ·»åŠ configuration</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">UserInfoClientSpecification</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="allowbeandefinitionoverriding_206"></a>äº”ã€è§£å†³allow-bean-definition-overridingé—®é¢˜</h3> 
<p>å¯åŠ¨é¡¹ç›®æ—¶å‡ºç°è¿™ä¸ªé”™è¯¯ä¿¡æ¯</p> 
<blockquote> 
 <p>Description:<br> The bean â€˜kerwin-user.FeignClientSpecificationâ€™ could not be registered. A bean with that name has already been defined and overriding is disabled.<br> Action:<br> Consider renaming one of the beans or enabling overriding by setting spring.main.allow-bean-definition-overriding=true</p> 
</blockquote> 
<h4><a id="1_213"></a>1ã€é”™è¯¯åŸå› </h4> 
<p>è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºå‡ºç°äº†é‡åçš„Beanåç§°ï¼Œåœ¨<strong>FeignClientsRegistrar</strong> ä¸­æ³¨å†Œ<strong>Feign</strong> é…ç½®ä¿¡æ¯åˆ°<strong>Spring</strong> ä¸­æ—¶ä¼šç»„è£…ä¸€ä¸ª<strong>Bean</strong> çš„åç§°ï¼Œå¦‚æœåœ¨**@FeignClient** ä¸­æ²¡æœ‰è®¾ç½®<strong>contextId</strong> é‚£ä¹ˆä¼šä½¿ç”¨<strong>value</strong> ä½œä¸ºç»„è£…åç§°çš„å‰ç¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰å¤šä¸ª**@FeignClient** è®¾ç½®çš„<strong>value</strong> æœåŠ¡åç§°ä¸º<strong>user</strong> å¹¶ä¸”æ²¡æœ‰è®¾ç½®<strong>contextId</strong> ï¼Œé‚£ä¹ˆåœ¨æ³¨å†Œ<strong>Bean</strong> ä¿¡æ¯çš„æ—¶å€™<strong>BeanName</strong> å°±ä¼šé‡å¤ï¼Œ<strong>Spring</strong> åŸç”Ÿæ˜¯æ”¯æŒè¦†ç›–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ<strong>BeanName</strong> ç›¸åŒé‚£ä¹ˆåæ³¨å†Œçš„å°±ä¼šå°†å…ˆæ³¨å†Œçš„æ›¿æ¢ï¼Œä½†æ˜¯åœ¨<strong>SpringBoot</strong> ä¸­ä¼šå°†è¿™ä¸ªè¦†ç›–é…ç½®å…³é—­ï¼Œå¦‚æœå‡ºç°ä¸€æ ·çš„<strong>BeanName</strong> é‚£ä¹ˆå°±ä¼šæŠ›å‡ºä¸Šé¢é‚£ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œè§£å†³æ–¹æ³•å¸¸ç”¨æœ‰ä¸¤ç§å¼€å¯ç¬¬ä¸€ç§<strong>SpringBoot</strong> è¦†ç›–é…ç½®ã€ç¬¬äºŒç§åœ¨**@FeignClient** ä¸­è®¾ç½®<strong>contextId</strong> ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§æ–¹æ³•åˆ«ç”¨å¾ˆå‘ï¼Œç½‘ä¸Šå¾ˆå¤šäººéƒ½æ˜¯ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•è§£å†³æˆ‘ä»¬å…¬å¸ä¹Ÿæ˜¯ä½¿ç”¨çš„ç¬¬ä¸€ç§ğŸ˜€ã€‚</p> 
<h4><a id="2_215"></a>2ã€è§£å†³æ–¹æ³•ä¸€ï¼ˆåˆ«ç”¨ï¼‰</h4> 
<p>å¼€å¯Springè¦†ç›–åŠ è½½é…ç½®ï¼ŒSpringé»˜è®¤æ˜¯å¼€å¯çš„ï¼ŒSpringBooté»˜è®¤å…³é—­äº†æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹SpringApplicationä¸­çš„allowBeanDefinitionOverridingå±æ€§ã€‚</p> 
<pre><code class="prism language-java">spring<span class="token operator">:</span>
  main<span class="token operator">:</span>
    allow<span class="token operator">-</span>bean<span class="token operator">-</span>definition<span class="token operator">-</span>overriding<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> 
<h4><a id="3_222"></a>3ã€è§£å†³æ–¹æ³•äºŒï¼ˆæ¨èï¼‰</h4> 
<p>ç»™æ¯ä¸ª@FeignClientéƒ½è®¾ç½®è‡ªå·±å”¯ä¸€çš„contextId</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="GETSpringQueryMap_230"></a>å…­ã€è§£å†³GETè¯·æ±‚æ— æ³•ä¼ é€’å¯¹è±¡å‚æ•°é—®é¢˜ï¼ˆä½¿ç”¨@SpringQueryMapï¼‰</h3> 
<p>Spring Cloud OpenFeignæä¾›äº†ä¸€ä¸ªç­‰ä»·çš„@SpringQueryMapæ³¨é‡Šï¼Œç”¨äºå°†POJOæˆ–Mapå‚æ•°æ³¨é‡Šä¸ºæŸ¥è¯¢å‚æ•°Mapï¼Œåœ¨å‚æ•°å‰åŠ ä¸Š@SpringQueryMapå³å¯ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"demo"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"demoClient"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DemoClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/demo1"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@SpringQueryMap</span> <span class="token class-name">DemoDTO</span> dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="OpenFeign_241"></a>ä¸ƒã€OpenFeignè¶…æ—¶é…ç½®</h3> 
<p>OpenFeignè¶…æ—¶æœ‰å¤šç§é…ç½®æ–¹å¼ï¼Œè¿™é‡Œä»‹ç»å‡ ç§ä¸ªäººè§‰å¾—æœ€å®ç”¨çš„</p> 
<h4><a id="1_243"></a>1ã€ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰</h4> 
<p>ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®æ˜¯æœ€æ¨èçš„ï¼Œä¹Ÿæ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æœ€å¤šçš„ã€‚</p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é»˜è®¤é…ç½® å¦‚æœä¸å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ä¼šèµ°é»˜è®¤é…ç½®
      <span class="token keyword">default</span><span class="token operator">:</span>
        connectTimeout<span class="token operator">:</span> <span class="token number">2000</span> # è¿æ¥è¶…æ—¶æ—¶é—´ é»˜è®¤å€¼ï¼š<span class="token number">10000</span>æ¯«ç§’
        readTimeout<span class="token operator">:</span> <span class="token number">5000</span> # è¯»å–è¶…æ—¶æ—¶é—´ é»˜è®¤å€¼ï¼š<span class="token number">60000</span>æ¯«ç§’
      # é…ç½®å•ç‹¬<span class="token class-name">FeignClient</span>
      # <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
      # å¦‚æœ<span class="token class-name">FeignClient</span>æ³¨è§£è®¾ç½®äº†contextIdè¿™é‡Œå°±ä½¿ç”¨contextId<span class="token operator">=</span>userInfoClientå¦‚æœæ²¡æœ‰è®¾ç½®contextIdå°±ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°kerwin<span class="token operator">-</span>user
      userInfoClient<span class="token operator">:</span>
        connectTimeout<span class="token operator">:</span> <span class="token number">2000</span> # è¿æ¥è¶…æ—¶æ—¶é—´ é»˜è®¤å€¼ï¼š<span class="token number">10000</span>æ¯«ç§’
        readTimeout<span class="token operator">:</span> <span class="token number">5000</span> # è¯»å–è¶…æ—¶æ—¶é—´ é»˜è®¤å€¼ï¼š<span class="token number">60000</span>æ¯«ç§’
</code></pre> 
<h4><a id="2FeignClient_260"></a>2ã€ä½¿ç”¨@FeignClienté…ç½®è¶…æ—¶æ—¶é—´</h4> 
<p>ä½¿ç”¨@FeignClientæ³¨è§£çš„configurationå±æ€§æ¥æŒ‡å®šé…ç½®ç±»ã€‚</p> 
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œç»§æ‰¿è‡ªfeign.Request.Optionsç±»</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoClientSpecification</span> <span class="token keyword">extends</span> <span class="token class-name">Request<span class="token punctuation">.</span>Options</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfoClientSpecification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º2ç§’ï¼Œè®¾ç½®è¯»å–è¶…æ—¶æ—¶é—´ä¸º5ç§’</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ç„¶åï¼Œåœ¨ä½¿ç”¨@FeignClientæ³¨è§£è¿›è¡Œå£°æ˜æ—¶ï¼Œä½¿ç”¨configurationå±æ€§æŒ‡å®šè¯¥é…ç½®ç±»ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">UserInfoClientSpecification</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span><span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_278"></a>3ã€ä¸ºå•ç‹¬æ¥å£è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆè¿™ç§æ–¹å¼ä¼˜å…ˆçº§æ¯”ä½¿ç”¨é…ç½®æ–‡ä»¶æ›´é«˜ï¼‰</h4> 
<p>åœ¨feignæ¥å£é‡ŒåŠ å…¥Request.Optionsè¿™ä¸ªå‚æ•°å°±å¯ä»¥å•ç‹¬ä¸ºæ¥å£å•ç‹¬è®¾ç½®è¶…æ—¶æ—¶é—´äº†</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user-info/info/{id}"</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token class-name">Request<span class="token punctuation">.</span>Options</span> options<span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>è°ƒç”¨çš„æ—¶å€™new ä¸€ä¸‹Optionså¯¹è±¡</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> resp <span class="token operator">=</span> userInfoClient<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Request<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">666L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4RibbonFeign_291"></a>4ã€é€šè¿‡Ribboné…ç½®æ–‡ä»¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆä¸ä¸»åŠ¨è®¾ç½®Feignçš„è¶…æ—¶æ—¶é—´æ‰æœ‰æ•ˆï¼Œä¸æ¨èä½¿ç”¨ï¼‰</h4> 
<pre><code class="prism language-java">ribbon<span class="token operator">:</span>
  <span class="token class-name">ConnectTimeout</span><span class="token operator">:</span> <span class="token number">2000</span>  #é»˜è®¤ <span class="token number">1000</span>æ¯«ç§’
  <span class="token class-name">ReadTimeout</span><span class="token operator">:</span> <span class="token number">5000</span>  #é»˜è®¤ <span class="token number">1000</span>æ¯«ç§’
</code></pre> 
<p>é€šè¿‡Ribboné…ç½®æ–‡ä»¶è®¾ç½®è¶…æ—¶æ—¶é—´åªæœ‰åœ¨ä¸åšä»»ä½•Feignçš„è¶…æ—¶æ—¶é—´æ‰æœ‰æ•ˆï¼Œåœ¨LoadBalancerFeignClient.getClientConfig()æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå½“Feignçš„ Request.Options = é»˜è®¤çš„Request.Optionsæ—¶ä¼šä½¿ç”¨Ribbonçš„è¶…æ—¶é…ç½®ã€‚<br> <img src="https://images2.imgbox.com/38/06/9pM3ZHd6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="OpenFeign_300"></a>å…«ã€OpenFeigné‡è¯•é…ç½®</h3> 
<h4><a id="1OpenFeign_301"></a>1ã€OpenFeigné»˜è®¤é‡è¯•æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰</h4> 
<p>å½“ä¸åšä»»ä½•é…ç½®æ—¶OpenFeigné»˜è®¤æ˜¯ä¼šåœ¨<font color="red"> <strong>FeignLoadBalancer.getRequestSpecificRetryHandler()</strong> </font>æ–¹æ³•ä¸­è·å–è¯·æ±‚é‡è¯•å¤„ç†å™¨ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªåˆ¤æ–­å°±æ˜¯è·å–Ribbonä¸­æ˜¯å¦æœ‰å¼€å¯<font color="red"> <strong>OkToRetryOnAllOperations</strong> </font>é…ç½®ï¼Œå¦‚æœRibboné…ç½®ä¸­å¼€å¯äº†é‚£ä¹ˆè¿æ¥è¶…æ—¶å’Œå’Œå…¶å®ƒå¼‚å¸¸å¯¼è‡´å‡ºé—®é¢˜éƒ½ä¼šè¿›è¡Œé‡è¯•ï¼Œé‡è¯•çš„æ¬¡æ•°ä¹Ÿä¼šä½¿ç”¨Ribbonä¸­é…ç½®çš„é‡è¯•æ¬¡æ•°å‚æ•°ã€‚<br> <img src="https://images2.imgbox.com/53/66/GKkb9B64_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å¦‚æœRibbonæ²¡æœ‰å¼€å¯<font color="red"> <strong>OkToRetryOnAllOperations</strong> </font> é…ç½®å°±ä¼šè¿›è¡Œä¸‹é¢çš„åˆ¤æ–­ï¼Œå½“è¯·æ±‚ä¸ä¸º<font color="red"> <strong>GET</strong> </font>è¯·æ±‚æ—¶åªä¼šå¯¹è¿æ¥è¶…æ—¶å¼‚å¸¸è¿›è¡Œé‡è¯•ï¼Œå¯¹å…¶å®ƒå¼‚å¸¸ä¸ä¼šé‡è¯•ï¼Œå› ä¸ºå¢åˆ æ”¹è¯·æ±‚åšé‡è¯•çš„è¯å¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªæ•°æ®è¢«æ’å…¥ä¸¤æ¬¡ï¼Œå¯¹æŸ¥è¯¢è¯·æ±‚åšé‡è¯•ä¸ä¼šå½±å“æ­£å¸¸ä¸šåŠ¡ã€‚</p> 
<p>æˆ‘è¿™é‡Œè°ƒè¯•ä½¿ç”¨çš„æ˜¯<font color="red"> <strong>GET</strong> </font>è¯·æ±‚ï¼Œä¼šè¿›æœ€ä¸‹é¢ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€æœ‰å¼‚å¸¸éƒ½ä¼šé‡è¯•ï¼Œè¿™é‡Œé‡ç‚¹çœ‹ä¸€ä¸‹<font color="red"> **RequestSpecificRetryHandler ** </font>è¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»æ˜¯Ribbonå¤„ç†é‡è¯•æœºåˆ¶çš„æ ¸å¿ƒç±»ï¼Œè°ƒè¯•è¿›å…¥è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•å¯ä»¥çœ‹åˆ°å°è£…äº†é‡è¯•æ‰€éœ€è¦çš„ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯æ‹¿çš„Ribboné»˜è®¤çš„å‚æ•°åœ¨åé¢ä¼šå…·ä½“è¯´å¦‚ä½•é…ç½®ã€‚<br> <img src="https://images2.imgbox.com/82/a0/AwpBKInU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„å¦‚æœé…ç½®OpenFeignçš„å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†Feignçš„defaulté…ç½®é‚£ä¹ˆè¿™é‡Œè¯»å–åˆ°çš„IClientConfigä¸­çš„é…ç½®ä¿¡æ¯å°±ä¸ä¼šæ˜¯Ribbonçš„è€Œæ˜¯OpenFeignè‡ªå·±çš„é…ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ²¡æœ‰Ribbonè¿™ä¸¤ä¸ªé‡è¯•æ¬¡æ•°çš„é…ç½®ï¼Œç»“åˆä¸Šé¢å‡ ç‚¹å…¶å®ä¸å»ºè®®ä½¿ç”¨Ribbonçš„é‡è¯•é…ç½®ã€‚<br> <img src="https://images2.imgbox.com/d0/0c/cFzP8RIo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><font color="red"> <strong>æ€»ç»“ï¼šä¹Ÿå°±æ˜¯è¯´OpenFeignä¸åšä»»ä½•é…ç½®ï¼Œé»˜è®¤ä¼šå¯¹ä¸åŒæœåŠ¡å®ä¾‹åˆ‡æ¢é‡è¯•ä¸€æ¬¡ï¼Œå¦‚æœä¸æ˜¯GETè¯·æ±‚é‚£ä¹ˆåªä¼šå¯¹è¿æ¥è¶…æ—¶è¿›è¡Œé‡è¯•ï¼Œå¦‚è¯·æ±‚è¶…æ—¶åˆ™ä¸ä¼šé‡è¯•ï¼Œå¦‚æœå¯¹Feignåšäº†å“ªæ€•ä¸€ä¸ªé…ç½®æ¯”å¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†Feignçš„defaultè¯·æ±‚è¶…æ—¶é…ç½®é‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨Ribbonçš„ä¸¤ä¸ªé‡è¯•æ¬¡æ•°çš„é…ç½®å‚æ•°é»˜è®¤å°±æ˜¯ä¸ä¼šè¿›è¡Œé‡è¯•ã€‚</strong> </font></p> 
<h4><a id="2RibbonFeignspringretryRibbon_315"></a>2ã€é€šè¿‡Ribboné…ç½®é‡è¯•ï¼ˆé…ç½®äº†Feignçš„é…ç½®æˆ–è€…spring-retryåˆ™Ribboné‡è¯•é…ç½®ä¼šå¤±æ•ˆï¼‰</h4> 
<p>ä¸€å®šéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœå¯¹Feignåšäº†å“ªæ€•ä¸€ä¸ªé…ç½®æ¯”å¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†Feignçš„defaultè¯·æ±‚è¶…æ—¶é…ç½®é‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨Ribbonçš„ä¸¤ä¸ªé‡è¯•æ¬¡æ•°çš„é…ç½®å‚æ•°ï¼Œé»˜è®¤å°±æ˜¯ä¸ä¼šè¿›è¡Œé‡è¯•</p> 
<pre><code class="prism language-bash">ribbon:
  MaxAutoRetries: <span class="token number">1</span> <span class="token comment">#åŒä¸€å°å®ä¾‹æœ€å¤§é‡è¯•æ¬¡æ•°,ä¸åŒ…æ‹¬é¦–æ¬¡è°ƒç”¨  é»˜è®¤0</span>
  MaxAutoRetriesNextServer: <span class="token number">1</span> <span class="token comment">#æœåŠ¡å®ä¾‹åˆ‡æ¢é‡è¯•æ¬¡æ•° é»˜è®¤1</span>
  OkToRetryOnAllOperations: <span class="token boolean">true</span> <span class="token comment">#æ˜¯å¦å¼€å¯é‡è¯•æœºåˆ¶ é»˜è®¤å…³é—­</span>
</code></pre> 
<p>åœ¨<font color="red"> <strong>FeignLoadBalancer.getRequestSpecificRetryHandler()</strong> </font>æ–¹æ³•çš„å…¥å‚IClientConfigä¸­å¯ä»¥çœ‹åˆ°propertiesä¸­çš„ä¸¤ä¸ªé‡è¯•æ¬¡æ•°é…ç½®è¿˜æœ‰æ˜¯å¦å¼€å¯é‡è¯•æœºåˆ¶å¼€å…³<br> <img src="https://images2.imgbox.com/da/f9/yBE2EYX6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="3font_colorredFeignRetryerfontFeignRetryerRibbonspringretry_325"></a>3ã€<font color="red">é€šè¿‡Feignçš„Retryeræ¥å£é…ç½®é‡è¯•</font>ï¼ˆå¦‚æœåœ¨é…ç½®æ–‡ä»¶è®¾ç½®äº†Feignçš„Retryeré‚£ä¹ˆRibbonå’Œspring-retryçš„é‡è¯•æœºåˆ¶éƒ½ä¼šå¤±æ•ˆï¼‰</h4> 
<p><strong>å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿Retryer.Default</strong></p> 
<pre><code class="prism language-bash">/**
 * é‡è¯•ç­–ç•¥  é»˜è®¤ é‡è¯•é—´éš”100æ¯«ç§’  æœ€å¤§é—´éš”æ—¶é—´1ç§’  é‡è¯•5æ¬¡
 */
@Slf4j
public  class CommonFeignRetry extends Retryer.Default <span class="token punctuation">{<!-- --></span>
    public <span class="token function-name function">CommonFeignRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        // é‡è¯•é—´éš”æ˜¯æ¯æ¬¡å¤±è´¥ä¹‹åä¼šç­‰å¾…100æ¯«ç§’å†æ¬¡å‘èµ·é‡è¯•è¯·æ±‚çš„é—´éš”æ—¶é—´
        // æœ€å¤§é—´éš”æ—¶é—´æ˜¯æ¯æ¬¡é‡è¯•çš„é—´éš”æ—¶é—´ç´¯åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡è¿™ä¸ªæœ€å¤§é—´éš”æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº†å°±ä¸ä¼šåœ¨é‡è¯•ï¼Œå“ªæ€•è¿˜æ²¡æœ‰è¾¾åˆ°é…ç½®çš„é‡è¯•æ¬¡æ•°
        // é‡è¯•æ¬¡æ•°ä¼šå—æœ€å¤§é—´éš”æ—¶é—´å’Œé‡è¯•é—´éš”æ—¶é—´å½±å“ï¼Œå¦‚æœç´¯è®¡é—´éš”æ—¶é—´è¶…è¿‡è¿™ä¸ªæœ€å¤§é—´éš”æ—¶é—´å°±ä¸ä¼šåœ¨é‡è¯•
        // é‡è¯•é—´éš”100æ¯«ç§’  æœ€å¤§é—´éš”æ—¶é—´1ç§’  é‡è¯•5æ¬¡
        this<span class="token punctuation">(</span><span class="token number">100</span>, <span class="token environment constant">SECONDS</span>.toMillis<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public CommonFeignRetry<span class="token punctuation">(</span>long period, long maxPeriod, int maxAttempts<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        super<span class="token punctuation">(</span>period, maxPeriod, maxAttempts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    @Override
    public void continueOrPropagate<span class="token punctuation">(</span>RetryableException e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log.warn<span class="token punctuation">(</span><span class="token string">"ã€FeignRetryAbleã€‘Messageã€{}ã€‘"</span>, e.getMessage<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        super.continueOrPropagate<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public Retryer <span class="token function-name function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> new CommonFeignRetry<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>é€šè¿‡é…ç½®æ–‡ä»¶åŠ è½½é‡è¯•é…ç½®ç±»</strong><br> å¯ä»¥åšå…¨å±€é»˜è®¤é…ç½®ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ç»™æŸä¸ªFeignClienté…ç½®</p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é»˜è®¤é…ç½® å¦‚æœä¸å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ä¼šèµ°é»˜è®¤é…ç½®
      <span class="token keyword">default</span><span class="token operator">:</span>
        retryer<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>kerwin<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>CommonFeignRetry</span>
      # é…ç½®å•ç‹¬<span class="token class-name">FeignClient</span>
      # <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
      # å¦‚æœ<span class="token class-name">FeignClient</span>æ³¨è§£è®¾ç½®äº†contextIdè¿™é‡Œå°±ä½¿ç”¨contextId<span class="token operator">=</span>userInfoClientå¦‚æœæ²¡æœ‰è®¾ç½®contextIdå°±ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°kerwin<span class="token operator">-</span>user
      userInfoClient<span class="token operator">:</span>
        retryer<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>kerwin<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>CommonFeignRetry</span>
</code></pre> 
<p><strong>é»˜è®¤çš„Retryeræ˜¯åœ¨<mark>FeignClientsConfiguration</mark> é…ç½®ç±»çš„<mark>feignRetryer()</mark> æ–¹æ³•ä¸­åŠ è½½çš„ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ä¼šç›´æ¥æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ä¸ä¼šè¿›è¡Œé‡è¯•å¤„ç†ï¼Œåœ¨<mark>SynchronousMethodHandler</mark> çš„<mark>invoke()</mark> æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°è°ƒç”¨çš„æ˜¯é‚£ä¸ªRetryerï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æºç </strong><br> <img src="https://images2.imgbox.com/bb/78/752lDNak_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>PSï¼šé™¤äº†å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ç±»é…ç½®ï¼Œæ–¹æ³•å’Œæ—¥å¿—é…ç½®å·®ä¸å¤šã€‚</strong></p> 
<h4><a id="4springretryFeignRetryerspringretryRibbon_380"></a>4ã€é€šè¿‡spring-retryä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½®é‡è¯•ï¼ˆå¦‚æœFeigné…ç½®è‡ªå·±çš„Retryeré‚£ä¹ˆspring-retryä¸ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯ä¼šæ¯”Ribbonä¼˜å…ˆçº§é«˜ï¼‰</h4> 
<p><strong>é¦–å…ˆè¦å¼•å…¥spring-retryåŒ…ï¼Œå¯ä»¥ä¸ç”¨å†™ç‰ˆæœ¬ä¼šä½¿ç”¨SpringBootå¤«åŒ…æŒ‡å®šçš„ç‰ˆæœ¬</strong></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>retry<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>retry<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>å¦‚æœæˆ‘ä»¬éœ€è¦ä¸ºç‰¹å®šçš„è¯·æ±‚è®¾ç½®ä¸åŒçš„é‡è¯•ç­–ç•¥ï¼Œåˆ™å¯ä»¥åœ¨å¯¹åº”çš„æ–¹æ³•ä¸ŠåŠ ä¸Š @Retryable æ³¨è§£ï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„ Retryer ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user-info/get-user-name/{id}"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retryable</span><span class="token punctuation">(</span>maxAttempts <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä½¿ç”¨ä¸Šè¿°æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚è®¾ç½®ä¸åŒçš„é‡è¯•ç­–ç•¥ï¼Œä»è€Œæ›´åŠ çµæ´»åœ°å¤„ç†é‡è¯•é—®é¢˜ã€‚</p> 
<p><font color="red">PSï¼š<br> è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé¡¹ç›®å¼•å…¥äº†spring-retryåŒ…å°±ç®—ä¸é…ç½®é‡è¯•GETè¯·æ±‚ä¹Ÿä¼šé»˜è®¤æœåŠ¡å®ä¾‹åˆ‡æ¢é‡è¯•1æ•°ä½¿ç”¨çš„æ˜¯Ribbonçš„é…ç½®ï¼Œ<br> spring-retryåŒ…è¿™é‡Œä½¿ç”¨çš„æ˜¯RetryableFeignLoadBalanceræ¥è¿›è¡Œçš„è¯·æ±‚è°ƒç”¨å’Œé‡è¯•å¤„ç†ï¼Œåœ¨RetryableFeignLoadBalancer.execute(ï¼‰æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ä¼šå»å°è£…ä¸€ä¸ªRetryTemplateï¼Œè¿™ä¸ªRetryTemplateä¸­ä¼šè®¾ç½®ä¸€ä¸ªRetryPolicyï¼Œå¦‚æœæ²¡æœ‰å•ç‹¬é…ç½®é‡è¯•å°±ä¼šä½¿ç”¨Ribbonçš„RibbonLoadBalancedRetryPolicyï¼Œåœ¨RibbonLoadBalancedRetryPolicyä¸­çš„å˜é‡RibbonLoadBalancerContexté‡Œå°±èƒ½çœ‹è§æ˜¯å¦‚æœä½¿ç”¨Ribboné…ç½®æ¥è¿›è¡Œçš„é‡è¯•æ¬¡æ•°åˆ¤æ–­</font></p> 
<h3><a id="OpenFeign_406"></a>ä¹ã€OpenFeignè¯·æ±‚æ—¥å¿—çº§åˆ«é…ç½®</h3> 
<ul><li> <p>Feignè¿œç¨‹è°ƒç”¨æ—¶æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œè¾“å‡ºçš„æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œå…ˆè¦æŠŠé¡¹ç›®çš„è¾“å‡ºæ—¥å¿—è®¾ç½®ä¸ºdebugã€‚</p> <pre><code class="prism language-java"><span class="token comment">// è®¾ç½®æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ä¸ºdebugï¼Œæˆ‘è¿™é‡Œå°†æˆ‘è‡ªå·±com.kerwinåŒ…æ‰€æœ‰æ—¥å¿—è¾“å‡ºçº§åˆ«è®¾ç½®æˆäº†debugï¼Œæ ¹æ®è‡ªå·±éœ€è¦æ¥å³å¯</span>
logging<span class="token operator">:</span>
  level<span class="token operator">:</span>
    com<span class="token operator">:</span>
      kerwin<span class="token operator">:</span> debug
</code></pre> </li><li> <p>ä¸ºäº†æ›´åŠ ç²¾ç»†åŒ–æ§åˆ¶æ—¥å¿—è¾“å‡ºï¼ŒFeignè¿˜æä¾›äº†æ—¥å¿—å†…å®¹è¾“å‡ºçš„å‡ ä¸ªçº§åˆ«ã€‚<br> NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ã€‚<br> BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•å’ŒURLä»¥åŠå“åº”çŠ¶æ€ä»£ç å’Œæ‰§è¡Œæ—¶é—´ã€‚<br> HEADERSï¼šé™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”å¤´çš„ä¿¡æ¯ã€‚<br> FULLï¼šé™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</p> </li></ul> 
<h4><a id="1_423"></a>1ã€é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæ¨èï¼‰</h4> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é»˜è®¤é…ç½® å¦‚æœä¸å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ä¼šèµ°é»˜è®¤é…ç½®
      <span class="token keyword">default</span><span class="token operator">:</span>
        loggerLevel<span class="token operator">:</span> <span class="token constant">FULL</span> # æ—¥å¿—çº§åˆ« <span class="token constant">NONE</span>ï¼šä¸æ‰“å°  <span class="token constant">BASIC</span>ï¼šæ‰“å°ç®€å•ä¿¡æ¯ <span class="token constant">HEADERS</span>ï¼šæ‰“å°å¤´ä¿¡æ¯ <span class="token constant">FULL</span>ï¼šæ‰“å°å…¨éƒ¨ä¿¡æ¯ ï¼ˆé»˜è®¤ <span class="token constant">NONE</span>ï¼‰
      # é…ç½®å•ç‹¬<span class="token class-name">FeignClient</span> 
      # <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
      # å¦‚æœ<span class="token class-name">FeignClient</span>æ³¨è§£è®¾ç½®äº†contextIdè¿™é‡Œå°±ä½¿ç”¨userInfoClientå¦‚æœæ²¡æœ‰è®¾ç½®contextIdå°±ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°kerwin<span class="token operator">-</span>user
      userInfoClient<span class="token operator">:</span>
        loggerLevel<span class="token operator">:</span> <span class="token constant">FULL</span> # æ—¥å¿—çº§åˆ« <span class="token constant">NONE</span>ï¼šé»˜è®¤ä¸æ‰“å°  <span class="token constant">BASIC</span>ï¼šæ‰“å°ç®€å•ä¿¡æ¯ <span class="token constant">HEADERS</span>ï¼šæ‰“å°å¤´ä¿¡æ¯ <span class="token constant">FULL</span>ï¼šæ‰“å°å…¨éƒ¨ä¿¡æ¯ï¼ˆé»˜è®¤ <span class="token constant">NONE</span>ï¼‰
</code></pre> 
<h4><a id="2FeignClient_438"></a>2ã€ä½¿ç”¨@FeignClienté…ç½®</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoClientSpecification</span>  <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>åœ¨@FeignClientä¸­æ·»åŠ configuration</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">UserInfoClientSpecification</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="OpenFeign_452"></a>åã€OpenFeignæ‹¦æˆªå™¨</h3> 
<p>æ‹¦æˆªå™¨æ˜¯OpenFeignå¯ç”¨çš„ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥åœ¨è¯·æ±‚å’Œå“åº”å‰åè¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†</p> 
<h4><a id="1OpenFeign_454"></a>1ã€é€šè¿‡OpenFeignè¯·æ±‚æ‹¦æˆªå™¨è®¾ç½®ç»Ÿä¸€è¯·æ±‚å¤´</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHeaderInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">RequestInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> headerName <span class="token operator">=</span> <span class="token string">"token"</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">RequestTemplate</span> requestTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// åœ¨è¿™é‡Œæ·»åŠ é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œæ·»åŠ è¯·æ±‚å¤´</span>
        <span class="token class-name">RequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestAttributes <span class="token keyword">instanceof</span> <span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ServletRequestAttributes</span> attributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> requestAttributes<span class="token punctuation">;</span>
            <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>headerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            requestTemplate<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span>headerName<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ‹¦æˆªå™¨é…ç½®</p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      # é»˜è®¤é…ç½® å¦‚æœä¸å•ç‹¬é…ç½®æ¯ä¸ªæœåŠ¡ä¼šèµ°é»˜è®¤é…ç½®
      <span class="token keyword">default</span><span class="token operator">:</span>
        request<span class="token operator">-</span>interceptors<span class="token operator">:</span>
          <span class="token operator">-</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>kerwin<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>MyHeaderInterceptor</span> 
      # é…ç½®å•ç‹¬<span class="token class-name">FeignClient</span> 
      # <span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">)</span>
      # å¦‚æœ<span class="token class-name">FeignClient</span>æ³¨è§£è®¾ç½®äº†contextIdè¿™é‡Œå°±ä½¿ç”¨userInfoClientå¦‚æœæ²¡æœ‰è®¾ç½®contextIdå°±ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°kerwin<span class="token operator">-</span>user
      userInfoClient<span class="token operator">:</span>
        request<span class="token operator">-</span>interceptors<span class="token operator">:</span>
          <span class="token operator">-</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>kerwin<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>MyHeaderInterceptor</span> 
</code></pre> 
<p>é™¤äº†åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®åŒæ—¶ä¹Ÿèƒ½åœ¨é…ç½®ç±»ä¸­é…ç½®ï¼Œä¸è¿‡è¦æ³¨æ„åŠ è½½ä¼˜å…ˆçº§é—®é¢˜ï¼Œæ¨èä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚</p> 
<h3><a id="OpenFeignHTTPHttpURLConnection_492"></a>åä¸€ã€æ›¿æ¢OpenFeigné»˜è®¤HTTPè¯·æ±‚æ¡†æ¶HttpURLConnection</h3> 
<h4><a id="1HttpClient_493"></a>1ã€æ›¿æ¢æˆHttpClient</h4> 
<p><strong>æ·»åŠ POM</strong></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
	<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>feign<span class="token operator">-</span>httpclient<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>æ·»åŠ é…ç½®</strong></p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  httpclient<span class="token operator">:</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span> # <span class="token class-name">HttpClient</span>çš„å¼€å…³
    max<span class="token operator">-</span>connections<span class="token operator">:</span> <span class="token number">200</span>  # çº¿ç¨‹æ± æœ€å¤§è¿æ¥æ•°
    max<span class="token operator">-</span>connections<span class="token operator">-</span>per<span class="token operator">-</span>route<span class="token operator">:</span> <span class="token number">50</span>   # å•ä¸ªè¯·æ±‚è·¯å¾„çš„æœ€å¤§è¿æ¥æ•°
</code></pre> 
<h4><a id="2OkHttp_510"></a>2ã€æ›¿æ¢æˆOkHttp</h4> 
<p><strong>æ·»åŠ POM</strong></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>feign<span class="token operator">-</span>okhttp<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>æ·»åŠ é…ç½®</strong></p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  httpclient<span class="token operator">:</span>
    max<span class="token operator">-</span>connections<span class="token operator">:</span> <span class="token number">200</span> # çº¿ç¨‹æ± æœ€å¤§è¿æ¥æ•°
  okhttp<span class="token operator">:</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> 
<h4><a id="3_527"></a>3ã€æºç æ–­ç‚¹æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</h4> 
<p>è°ƒç”¨çš„æ˜¯åœ¨ <mark>FeignLoadBalancer.execute()</mark> æ–¹æ³•ä¸­ï¼Œæ–­ç‚¹å¯ä»¥çœ‹åˆ°requestçš„clientä¸ºOkHttpClientï¼Œå¦‚æœä¸æ›¿æ¢å°±æ˜¯HttpURLConnection<br> <img src="https://images2.imgbox.com/30/27/FgMvvo2g_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="OpenFeignhystrix_531"></a>åäºŒã€OpenFeigné…ç½®hystrix</h3> 
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯hystrixé»˜è®¤æ˜¯å…³é—­çš„</p> 
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  # æ˜¯å¦å¼€å¯hystrix é»˜è®¤<span class="token boolean">false</span>
  hystrix<span class="token operator">:</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> 
<h4><a id="1FeignClientfallback_539"></a>1ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackè¿›è¡Œå›è°ƒï¼ˆä¸èƒ½æ§åˆ¶ä¸åŒå¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰</h4> 
<p>å®ç°è‡ªå·±å¯¹åº”çš„FeignClientæ¥å£ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œè¯¥ç±»ä¸€å®šè¦èƒ½è¢«Springæ‰«æåˆ°ï¼Œä¸ç„¶æ— æ³•åŠ è½½</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoClientFallback</span> <span class="token keyword">implements</span> <span class="token class-name">UserInfoClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"æœåŠ¡ç¹å¿™"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å°†fallbacké…ç½®åˆ°@FeignClientä¸­</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">UserInfoClientFallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * è·å–ç”¨æˆ·ä¿¡æ¯
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user-info/info/{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å½“è°ƒç”¨å¯¹åº”æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶åˆ™ä¼šè‡ªåŠ¨å›è°ƒ<mark>UserInfoClientFallback</mark> ä¸­é‡å†™çš„æ–¹æ³•ã€‚</p> 
<h4><a id="2FeignClientfallbackFactory_564"></a>2ã€ä½¿ç”¨@FeignClientä¸­çš„fallbackFactoryè¿›è¡Œå›è°ƒï¼ˆå¯ä»¥æ§åˆ¶å¯¹åº”å¼‚å¸¸çš„å¤„ç†é€»è¾‘ï¼‰</h4> 
<p>ä½¿ç”¨@FeignClientä¸­çš„fallbackFactoryéœ€è¦è‡ªå·±å»å®ç°FallbackFactoryæ¥å£ï¼Œæ³›å‹ä½¿ç”¨è‡ªå·±å¯¹åº”UserInfoClientï¼Œæˆ‘ä»¬å®ç°FallbackFactoryæ¥å£çš„createæ–¹æ³•å¯ä»¥çœ‹åˆ°å…¥å‚æ˜¯ä¸€ä¸ªThrowableï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¼‚å¸¸ç±»å‹å’Œå¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œè¯¥ç±»ä¹Ÿä¸€å®šè¦èƒ½è¢«Springæ‰«æåˆ°ï¼Œä¸ç„¶æ— æ³•åŠ è½½ã€‚</p> 
<p><font color="red">PSï¼šè¦å®ç°çš„æ˜¯feign.hystrix.FallbackFactoryåˆ«å®ç°äº†org.springframework.cloud.openfeign.FallbackFactor </font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoClientFallbackFactory</span>  <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoClient</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfoClient</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">UserInfoClient</span> userInfoClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token string">"å¼‚å¸¸msg="</span> <span class="token operator">+</span> cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userInfoClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å°†æˆ‘ä»¬å®ç°çš„FallbackFactoryé…ç½®åˆ°@FeignClientä¸­</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"kerwin-user"</span><span class="token punctuation">,</span>contextId <span class="token operator">=</span> <span class="token string">"userInfoClient"</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">UserInfoClientFallbackFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * è·å–ç”¨æˆ·ä¿¡æ¯
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user-info/info/{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Ribbon_597"></a>åä¸‰ã€é…ç½®Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</h3> 
<h4><a id="1_598"></a>1ã€å•ç‹¬é…ç½®æŸä¸ªæœåŠ¡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆä½¿ç”¨å…¨å±€é…ç½®æ— æ•ˆï¼‰</h4> 
<p>é€šè¿‡é…ç½®æ–‡ä»¶ç»™Ribboné…ç½®è´Ÿè½½å‡è¡¡ç®—æ³•åªèƒ½å•ç‹¬ç»™æŸä¸ªæœåŠ¡é…ç½®ï¼Œå’ŒSpringBooté›†æˆé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç®—æ³•ä¸º<font color="red">ZoneAvoidanceRule</font>ï¼Œä½¿ç”¨Ribbonçš„å…¨å±€é…ç½®æ˜¯æ— æ•ˆçš„ï¼Œä¸‹é¢ä¼šè§£é‡Šä¸ºä»€ä¹ˆã€‚</p> 
<pre><code class="prism language-java"># ç»™kerwin<span class="token operator">-</span>useræœåŠ¡å•ç‹¬é…ç½®éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•
kerwin<span class="token operator">-</span>user<span class="token operator">:</span>
  ribbon<span class="token operator">:</span>
    <span class="token class-name">NFLoadBalancerRuleClassName</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span>RandomRule</span> # éšæœºç®—æ³•
</code></pre> 
<ul><li>Ribbonå·²ç»å®ç°çš„ä¸»è¦æœ‰7ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ 
  <ul><li><font color="red">RoundRobinRuleï¼š è½®è¯¢çš„æ–¹å¼ ï¼ˆåœ¨å•ç‹¬ä½¿ç”¨Ribbonæ—¶é»˜è®¤ä½¿ç”¨è¯¥ç®—æ³•ï¼‰</font>ã€‚</li><li>RandomRuleï¼š éšæœºæ–¹å¼ã€‚</li><li>WeightedResponseTimeRuleï¼š æ ¹æ®å“åº”æ—¶é—´æ¥åˆ†é…æƒé‡çš„æ–¹å¼ï¼Œå“åº”çš„è¶Šå¿«ï¼Œåˆ†é…çš„å€¼è¶Šå¤§ã€‚</li><li>BestAvailableRuleï¼š é€‰æ‹©å¹¶å‘é‡æœ€å°çš„æ–¹å¼ã€‚</li><li>RetryRuleï¼š åœ¨ä¸€ä¸ªé…ç½®æ—¶é—´æ®µå†…å½“é€‰æ‹©serverä¸æˆåŠŸï¼Œåˆ™ä¸€ç›´å°è¯•ä½¿ç”¨subRuleçš„æ–¹å¼é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„serverã€‚</li><li><font color="red">ZoneAvoidanceRuleï¼š æ ¹æ®æ€§èƒ½å’Œå¯ç”¨æ€§æ¥é€‰æ‹© ï¼ˆåœ¨ä¸SpringBooté›†æˆæ—¶Ribboné»˜è®¤ä½¿ç”¨è¯¥ç®—æ³•ï¼‰</font>ã€‚</li><li>AvailabilityFilteringRuleï¼š è¿‡æ»¤æ‰é‚£äº›å› ä¸ºä¸€ç›´è¿æ¥å¤±è´¥çš„è¢«æ ‡è®°ä¸ºcircuit trippedçš„åç«¯serverï¼Œå¹¶è¿‡æ»¤æ‰é‚£äº›é«˜å¹¶å‘çš„çš„åç«¯serverï¼ˆactive connections è¶…è¿‡é…ç½®çš„é˜ˆå€¼ï¼‰ã€‚</li></ul> </li></ul> 
<h4><a id="2Ribbon_618"></a>2ã€ä¸ºä»€ä¹ˆä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®Ribbonçš„å…¨å±€è´Ÿè½½å‡è¡¡ç®—æ³•ä¼šæ— æ•ˆï¼Ÿ</h4> 
<p>è¦æ¢ç©¶è¿™ä¸ªé—®é¢˜éœ€è¦çœ‹ä¸€ä¸‹Ribbonå’ŒSpringBootæ˜¯å¦‚ä½•é›†æˆçš„ï¼Œå’ŒOpenFeignå…¶å®ä¹Ÿç±»ä¼¼ï¼ŒRibbonä¼šç»™æ¯ä¸ªæœåŠ¡åç§°éƒ½ç”Ÿæˆä¸€ä¸ªè‡ªå·±çš„Springä¸Šä¸‹æ–‡æ¥ç®¡ç†è‡ªå·±éœ€è¦çš„Ribbonçš„ä¸€äº›ç»„ä»¶Beanï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡ç®—æ³•ç»„ä»¶ï¼ŒRibbonè¿™é‡Œä¹Ÿä¼šæä¾›ä¸€ä¸ªç±»ä¼¼<font color="red">FeignClientsConfiguration </font>çš„ç¼ºçœé…ç½®ç±»<font color="red">RibbonClientConfiguration </font>ï¼Œåœ¨<font color="red">RibbonClientConfigurationä¸­çš„ribbonRule() </font>æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä½•åŠ è½½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ç»„ä»¶ã€‚</p> 
<p><img src="https://images2.imgbox.com/d6/ae/MX8XJTsU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è·Ÿè¿›å»<font color="red">propertiesFactory.isSet() </font>æ–¹æ³•ä¸€ç›´åˆ°<font color="red">PropertiesFactory.getClassName() </font>æ–¹æ³•å°±èƒ½çœ‹åˆ°æ˜¯å¦‚ä½•è·å–çš„æˆ‘ä»¬çš„é…ç½®ï¼Œè¿™é‡Œä¼šç»„è£…ä¸€ä¸ªkeyå€¼å»ç¯å¢ƒå˜é‡ä¸­è·å–å¯¹åº”çš„é…ç½®å€¼ï¼Œå¦‚æœæœ‰é…ç½®åˆ™è¿”å›å¯¹åº”çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰é…ç½®åˆ™è¿”å›ç©ºï¼Œè¿™ä¸ªkeyæ‹¼æ¥åä¸º<font color="red">kerwin-user.ribbon.NFLoadBalancerRuleClassName </font>ï¼Œæ­£å¥½å¯ä»¥å’Œæˆ‘ä»¬çš„å•ç‹¬é…ç½®å¯¹åº”ä¸Šï¼Œå¦‚æœæ˜¯ä½¿ç”¨å…¨å±€é…ç½®è¿™é‡Œæ˜¯è¯»å–ä¸åˆ°çš„ã€‚</p> 
<p><img src="https://images2.imgbox.com/84/15/AIJZJCVR_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d60af8baa160fce690f14f1136839a86/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">python ThreadPoolExecutorçš„å¼‚å¸¸æ•è·</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6953493c86f13a24be81de4b2cd88672/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">linuxåµŒå…¥å¼å¸¸è§é¢è¯•é—®é¢˜ï¼ˆæŒç»­æ›´æ–°ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 ç¼–ç¨‹éšæƒ³.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>