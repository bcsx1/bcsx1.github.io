<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;中使用std::sort自定义排序规则时要注意的崩溃问题 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;中使用std::sort自定义排序规则时要注意的崩溃问题" />
<meta property="og:description" content="文章目录 前言sort的使用自定义比较函数sort源码崩溃分析为什么使用无保护的插入排序C&#43;&#43;标准要求构造一个崩溃的示例平台差异总结 前言 看到这个标题应该会有很多人一下子就懂了，也会有些人感到迷惑，简简单单排序怎么会奔溃呢？我第一次接触这个问题还是很久以前刚刚参加工作的时候，当时也是写出了导致程序崩溃的代码，通过上网查询解决了问题，至此以后就对这个 sort 函数警惕了一些，一直记得就是在sort的自定义函数中判断条件不要加等号，至于本质的原因一直没有去探究，正好最近又改了一个相关的问题，所以决定从源码和定义的角度来看看为什么会出现这个问题。
sort的使用 sort函数真的挺好用，比如像下面这样：
#include &lt;iostream&gt; #include &lt;vector&gt; #include &lt;algorithm&gt; int main() { std::vector&lt;int&gt; values{3, 5, 4, 4, 5, 1}; std::sort(values.begin(), values.end()); for (auto v : values) std::cout &lt;&lt; v &lt;&lt; std::endl; return 0; } 只是 std::sort(values.begin(), values.end()); 这样简简单单的一句就完成了vector数据从小到达的排序，运行结果如下：
albert@home-pc:/data/cpp$ g&#43;&#43; testsort.cpp --std=c&#43;&#43;11 albert@home-pc:/data/cpp$ ./a.out 1 3 4 4 5 5 自定义比较函数 上面举的例子是从小到大排序，这是 sort 函数的默认行为，所以不需要额外的参数，如果是想从大到小排序，那么就需要定义一个比较函数了，方法也比较简单，写一个lambda表达式就可以了，比如像下面这样：
int main() { std::vector&lt;int&gt; values{3, 5, 4, 4, 5, 1}; std::sort(values." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b87d690e946701157916e44d8b7ef2aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-09T00:03:45+08:00" />
<meta property="article:modified_time" content="2021-08-09T00:03:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;中使用std::sort自定义排序规则时要注意的崩溃问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#sort_8" rel="nofollow">sort的使用</a></li><li><a href="#_41" rel="nofollow">自定义比较函数</a></li><li><a href="#sort_189" rel="nofollow">sort源码崩溃分析</a></li><li><a href="#_317" rel="nofollow">为什么使用无保护的插入排序</a></li><li><a href="#C_323" rel="nofollow">C++标准要求</a></li><li><a href="#_343" rel="nofollow">构造一个崩溃的示例</a></li><li><a href="#_442" rel="nofollow">平台差异</a></li><li><a href="#_447" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<p>看到这个标题应该会有很多人一下子就懂了，也会有些人感到迷惑，简简单单排序怎么会奔溃呢？我第一次接触这个问题还是很久以前刚刚参加工作的时候，当时也是写出了导致程序崩溃的代码，通过上网查询解决了问题，至此以后就对这个 <code>sort</code> 函数警惕了一些，一直记得就是在sort的自定义函数中判断条件不要加等号，至于本质的原因一直没有去探究，正好最近又改了一个相关的问题，所以决定从源码和定义的角度来看看为什么会出现这个问题。</p> 
 
<h2><a id="sort_8"></a>sort的使用</h2> 
<p>sort函数真的挺好用，比如像下面这样：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> values<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">sort</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> values<span class="token punctuation">)</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>只是 <code>std::sort(values.begin(), values.end());</code> 这样简简单单的一句就完成了vector数据从小到达的排序，运行结果如下：</p> 
<pre><code class="prism language-bash">albert@home-pc:/data/cpp$ g++ testsort.cpp --std<span class="token operator">=</span>c++11
albert@home-pc:/data/cpp$ ./a.out
<span class="token number">1</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token number">5</span>
</code></pre> 
<h2><a id="_41"></a>自定义比较函数</h2> 
<p>上面举的例子是从小到大排序，这是 sort 函数的默认行为，所以不需要额外的参数，如果是想从大到小排序，那么就需要定义一个比较函数了，方法也比较简单，写一个lambda表达式就可以了，比如像下面这样：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> values<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">sort</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> v1<span class="token punctuation">,</span> <span class="token keyword">int</span> v2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> v1 <span class="token operator">&gt;=</span> v2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> values<span class="token punctuation">)</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>按照比较函数定义，我们把数据按照前面大于等于后面的方式排序就完成了从大到小的排序的要求，看看这样写有没有什么问题？如果这里的等号 <code>=</code> 已经引起了你的不适，说明你可能踩过这里的坑，是的，这样写容易造成崩溃，我们来运行一下。</p> 
<pre><code class="prism language-bash">albert@home-pc:/data/cpp$ g++ testsort.cpp --std<span class="token operator">=</span>c++11
albert@home-pc:/data/cpp$ ./a.out
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">3</span>
<span class="token number">1</span>
</code></pre> 
<p>咦？怎么没事，我之前用MSVC测试还会崩溃的，难道和编译器有关？</p> 
<p>当我们增大数据量</p> 
<pre><code class="prism language-cpp">std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> values<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 运行结果如下</span>


albert@home<span class="token operator">-</span>pc<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>cpp$ g<span class="token operator">++</span> testsort<span class="token punctuation">.</span>cpp <span class="token operator">--</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">11</span> <span class="token operator">-</span>g
albert@home<span class="token operator">-</span>pc<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>cpp$ <span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">0</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">5</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">4</span>
<span class="token number">3</span>
<span class="token number">1</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Error in `<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token number">'</span><span class="token operator">:</span> <span class="token keyword">double</span> free <span class="token operator">or</span> <span class="token function">corruption</span> <span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">0x0000000002016c20</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Backtrace<span class="token operator">:</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0x777f5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7ff5ffef77f5</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0x8038a</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7ff5fff0038a</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span>cfree<span class="token operator">+</span><span class="token number">0x4c</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7ff5fff0458c</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x4024e2</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x4023ab</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x402226</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x4020a1</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x401edb</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x400c67</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span>__libc_start_main<span class="token operator">+</span><span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7ff5ffea0840</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x400a39</span><span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Memory map<span class="token operator">:</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">00400000</span><span class="token operator">-</span><span class="token number">00403000</span> r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">212044</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00403000</span><span class="token operator">-</span><span class="token number">00404000</span> r<span class="token operator">-</span>xp <span class="token number">00003000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">212044</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00603000</span><span class="token operator">-</span><span class="token number">00604000</span> r<span class="token operator">--</span>p <span class="token number">00003000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">212044</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00604000</span><span class="token operator">-</span><span class="token number">00605000</span> rw<span class="token operator">-</span>p <span class="token number">00004000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">212044</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">02005000</span><span class="token operator">-</span><span class="token number">02037000</span> rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                          <span class="token punctuation">[</span>heap<span class="token punctuation">]</span>
<span class="token number">7ff</span>5f8000000<span class="token operator">-</span><span class="token number">7ff</span>5f8021000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>5f8021000<span class="token operator">-</span><span class="token number">7ff</span>5fc000000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>5ffb70000<span class="token operator">-</span><span class="token number">7ff</span>5ffc78000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>5ffc78000<span class="token operator">-</span><span class="token number">7ff</span>5ffc7a000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00108000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>5ffc7a000<span class="token operator">-</span><span class="token number">7ff</span>5ffe77000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">0010</span>a000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>5ffe77000<span class="token operator">-</span><span class="token number">7ff</span>5ffe78000 r<span class="token operator">--</span>p <span class="token number">00107000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>5ffe78000<span class="token operator">-</span><span class="token number">7ff</span>5ffe79000 rw<span class="token operator">-</span>p <span class="token number">00108000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>5ffe80000<span class="token operator">-</span><span class="token number">7ff</span>600040000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600040000<span class="token operator">-</span><span class="token number">7ff</span>600049000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">001</span>c0000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600049000<span class="token operator">-</span><span class="token number">7ff</span>600240000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">001</span>c9000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600240000<span class="token operator">-</span><span class="token number">7ff</span>600244000 r<span class="token operator">--</span>p <span class="token number">001</span>c0000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600244000<span class="token operator">-</span><span class="token number">7ff</span>600246000 rw<span class="token operator">-</span>p <span class="token number">001</span>c4000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600246000<span class="token operator">-</span><span class="token number">7ff</span>60024a000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600250000<span class="token operator">-</span><span class="token number">7ff</span>600266000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7ff</span>600266000<span class="token operator">-</span><span class="token number">7ff</span>600465000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00016000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7ff</span>600465000<span class="token operator">-</span><span class="token number">7ff</span>600466000 rw<span class="token operator">-</span>p <span class="token number">00015000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7ff</span>600470000<span class="token operator">-</span><span class="token number">7ff</span>6005e2000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7ff</span>6005e2000<span class="token operator">-</span><span class="token number">7ff</span>6005ef000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00172000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7ff</span>6005ef000<span class="token operator">-</span><span class="token number">7ff</span>6007e2000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">0017f</span>000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7ff</span>6007e2000<span class="token operator">-</span><span class="token number">7ff</span>6007ec000 r<span class="token operator">--</span>p <span class="token number">00172000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7ff</span>6007ec000<span class="token operator">-</span><span class="token number">7ff</span>6007ee000 rw<span class="token operator">-</span>p <span class="token number">0017</span>c000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7ff</span>6007ee000<span class="token operator">-</span><span class="token number">7ff</span>6007f2000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600800000<span class="token operator">-</span><span class="token number">7ff</span>600825000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600825000<span class="token operator">-</span><span class="token number">7ff</span>600826000 r<span class="token operator">-</span>xp <span class="token number">00025000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600a25000<span class="token operator">-</span><span class="token number">7ff</span>600a26000 r<span class="token operator">--</span>p <span class="token number">00025000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600a26000<span class="token operator">-</span><span class="token number">7ff</span>600a27000 rw<span class="token operator">-</span>p <span class="token number">00026000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7ff</span>600a27000<span class="token operator">-</span><span class="token number">7ff</span>600a28000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600b70000<span class="token operator">-</span><span class="token number">7ff</span>600b71000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600b80000<span class="token operator">-</span><span class="token number">7ff</span>600b82000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600b90000<span class="token operator">-</span><span class="token number">7ff</span>600b91000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600ba0000<span class="token operator">-</span><span class="token number">7ff</span>600ba1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600bb0000<span class="token operator">-</span><span class="token number">7ff</span>600bb1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ff</span>600bc0000<span class="token operator">-</span><span class="token number">7ff</span>600bc1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7fff</span>c026e000<span class="token operator">-</span><span class="token number">7fff</span>c0a6e000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                  <span class="token punctuation">[</span>stack<span class="token punctuation">]</span>
<span class="token number">7fff</span>c10b8000<span class="token operator">-</span><span class="token number">7fff</span>c10b9000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                  <span class="token punctuation">[</span>vdso<span class="token punctuation">]</span>
<span class="token function">Aborted</span> <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span>
</code></pre> 
<p>这次终于崩溃了，但显示确实内存越界问题，并且排序后第一个元素是0，这不是我们vector中的元素啊，看来肯定是出问题了</p> 
<p>反复尝试几次又找到一个测试用例：</p> 
<pre><code class="prism language-cpp">std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>values<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行之后直接得到了 <code>Segmentation fault (core dumped)</code> 错误，没错，这就是我想要的，来从 <code>sort</code> 源码中看看为什么加了 <code>=</code> 就会出现崩溃</p> 
<h2><a id="sort_189"></a>sort源码崩溃分析</h2> 
<p>sort 函数的源码还不算太长，我就一点点来看了</p> 
<pre><code class="prism language-cpp">  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>
     _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// concept requirements</span>
      <span class="token function">__glibcxx_function_requires</span><span class="token punctuation">(</span>_Mutable_RandomAccessIteratorConcept<span class="token operator">&lt;</span>
        _RandomAccessIterator<span class="token operator">&gt;</span><span class="token punctuation">)</span>
      <span class="token function">__glibcxx_function_requires</span><span class="token punctuation">(</span>_BinaryPredicateConcept<span class="token operator">&lt;</span>_Compare<span class="token punctuation">,</span>
        <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">&gt;</span><span class="token operator">::</span>value_type<span class="token punctuation">,</span>
        <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">&gt;</span><span class="token operator">::</span>value_type<span class="token operator">&gt;</span><span class="token punctuation">)</span>
      <span class="token function">__glibcxx_requires_valid_range</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>

      std<span class="token operator">::</span><span class="token function">__sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __gnu_cxx<span class="token operator">::</span>__ops<span class="token operator">::</span><span class="token function">__iter_comp_iter</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这算是个入口函数，做了一些类型检查，然后就调用了内部的 <code>std::__sort</code> 函数</p> 
<pre><code class="prism language-cpp">  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span>
    <span class="token function">__sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>
       _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> __last<span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        std<span class="token operator">::</span><span class="token function">__introsort_loop</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span>
                std<span class="token operator">::</span><span class="token function">__lg</span><span class="token punctuation">(</span>__last <span class="token operator">-</span> __first<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
                __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token operator">::</span><span class="token function">__final_insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>当排序范围不为空时，函数会对传入的范围进行排序，为了最大程度的提高效率，结合了快排、堆排和插入排序等多种排序方法，分为 <code>std::__introsort_loop</code> 和 <code>std::__final_insertion_sort</code> 两个阶段。</p> 
<p>第一阶段使用“快排+堆排”的方法，当元素个数小于等于 <code>_S_threshold</code>（<code>enum { _S_threshold = 16 }</code>）时，不做处理，交给第二阶段来做，对于元素个数大于_S_threshold的序列，执行快排，当快排的递归深入到一定深度 <code>__depth_limit</code>（通过元素个数计算出来的）时，不再递归深入，对待排序元素执行堆排序，代码如下：</p> 
<pre><code class="prism language-cpp">  <span class="token comment">/// This is a helper function for the sort routine.</span>
  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Size</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">void</span>
    <span class="token function">__introsort_loop</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>
             _RandomAccessIterator __last<span class="token punctuation">,</span>
             _Size __depth_limit<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>__depth_limit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
          std<span class="token operator">::</span><span class="token function">__partial_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">--</span>__depth_limit<span class="token punctuation">;</span>
        _RandomAccessIterator __cut <span class="token operator">=</span>
          std<span class="token operator">::</span><span class="token function">__unguarded_partition_pivot</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token operator">::</span><span class="token function">__introsort_loop</span><span class="token punctuation">(</span>__cut<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __depth_limit<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        __last <span class="token operator">=</span> __cut<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>第二阶段使用“插入排序”，当元素个数小于等于 <code>_S_threshold</code>（<code>enum { _S_threshold = 16 }</code>）时，执行普通的插入排序，当大于 <code>_S_threshold</code> 时，执行两次的“插入”排序操作，首先使用普通的插入排序来排 <code>[first, _S_threshold)</code> 这个范围的元素，然后使用无保护的插入排序，完成 <code>[_S_threshold, last)</code> 这个范围的排序。</p> 
<pre><code class="prism language-cpp">  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">void</span>
    <span class="token function">__final_insertion_sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>
               _RandomAccessIterator __last<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        std<span class="token operator">::</span><span class="token function">__insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __first <span class="token operator">+</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token operator">::</span><span class="token function">__unguarded_insertion_sort</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span> __last<span class="token punctuation">,</span>
                        __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
        std<span class="token operator">::</span><span class="token function">__insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>其中的普通插入排序没有什么特别的地方，就是遍历前边小于等于<code>_S_threshold</code>个元素进行普通的插入排序，而后面这个无保护的插入排序 <code>std::__unguarded_insertion_sort</code> 往往就是出现问题的地方，代码如下：</p> 
<pre><code class="prism language-cpp">  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">inline</span> <span class="token keyword">void</span>
    <span class="token function">__unguarded_insertion_sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>
                   _RandomAccessIterator __last<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>_RandomAccessIterator __i <span class="token operator">=</span> __first<span class="token punctuation">;</span> __i <span class="token operator">!=</span> __last<span class="token punctuation">;</span> <span class="token operator">++</span>__i<span class="token punctuation">)</span>
    std<span class="token operator">::</span><span class="token function">__unguarded_linear_insert</span><span class="token punctuation">(</span>__i<span class="token punctuation">,</span>
                __gnu_cxx<span class="token operator">::</span>__ops<span class="token operator">::</span><span class="token function">__val_comp_iter</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>
    <span class="token keyword">void</span>
    <span class="token function">__unguarded_linear_insert</span><span class="token punctuation">(</span>_RandomAccessIterator __last<span class="token punctuation">,</span>
                  _Compare __comp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">&gt;</span><span class="token operator">::</span>value_type
      __val <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span>__last<span class="token punctuation">)</span><span class="token punctuation">;</span>
      _RandomAccessIterator __next <span class="token operator">=</span> __last<span class="token punctuation">;</span>
      <span class="token operator">--</span>__next<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__val<span class="token punctuation">,</span> __next<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token operator">*</span>__last <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        __last <span class="token operator">=</span> __next<span class="token punctuation">;</span>
        <span class="token operator">--</span>__next<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">*</span>__last <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这段代码看 <code>__unguarded_insertion_sort</code> 还没有什么问题，但是 <code>__unguarded_linear_insert</code> 中的逻辑就比较迷幻了，只有当 <code>__comp(__val, __next)</code> 的值为false时才会停止。</p> 
<p>其中 <code>__comp</code> 就是我们之前自定义的lambda表达式，我们当时写的是 <code>return v1 &gt;= v2;</code>，翻译过来也就是当<code>!(val &gt;= __next)</code> 时，即后一个元素小于前一个元素的时候停止，那么为什么会出问题呢？</p> 
<p>我们知道前<code>_S_threshold</code>个元素我们之前已经按照从大到小排好序了，那么按道理遍历到这个区域就会找到后一个元素小于前一个元素的情况，也就是插入排序遍历到这就会停止，等等！好像有什么不对劲，如果这里的元素都相等就找不到停止的情况了，这就会造成访问的越界，这就是程序崩溃的本质原因了。</p> 
<p>那么去掉等号会是个什么情况呢？运行到这里就是要找到满足条件的 <code>!(val &gt; __next)</code>元素时停止，也就是找到后一个元素<strong>小于等于</strong>前一个元素的时候停止，因为前<code>_S_threshold</code>个元素已经排好序，这个条件是肯定满足的，所以不会出现越界情况，这就是为什么自定义比较函数中，两个元素相等时一定要返回false了。</p> 
<h2><a id="_317"></a>为什么使用无保护的插入排序</h2> 
<p>既然这里这么容易越界，为什么不判断一下边界条件来防止越界，而是用这种无保护的插入排序呢？</p> 
<p>这里使用无保护的插入排序原因很简单，就是为了提升效率，因为省略掉越界的检查，少了很多次的比较操作，效率肯定有了提升，它的前提是左边必须有已经排好序的元素，所以在函数 <code>__unguarded_insertion_sort</code> 函数之前先调用 <code>__insertion_sort</code> 来完成了<code>[0, _S_threshold)</code> 这个范围的元素排序，便是为了后面这个无保护插入排序的使用。</p> 
<h2><a id="C_323"></a>C++标准要求</h2> 
<p>说到这里sort函数的自定义比较函数还是太容易出错了，有没有什么实现标准呢？其实标准中对这个比较函数的要求写的很详细，具体可以参考 <a href="https://en.cppreference.com/w/cpp/named_req/Compare" rel="nofollow">Compare的实现要求</a>。</p> 
<p><strong>Compare</strong> 是一些标准库函数针对用户提供的函数对象类型所期待的一组要求，其实就是要满足严格若排序关系，翻译成人话就是自定义的比较函数 <code>comp</code> 需要下面三条要求：</p> 
<ol><li>对于任意元素a，需满足 <code>comp(a, a) == false</code></li><li>对于任意两个元素a和b，若 <code>comp(a, b)==true</code> 则要满足 <code>comp(b, a)==false</code></li><li>对于任意三个元素a、b和c，<code>若 comp(a, b)==true</code> 且 <code>comp(b, c)==true</code> 则需要满足 <code>comp(a, c)==true</code></li></ol> 
<p>从这条规则也能看出我们之前定义的问题：</p> 
<pre><code class="prism language-cpp">    std<span class="token operator">::</span><span class="token function">sort</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> v1<span class="token punctuation">,</span> <span class="token keyword">int</span> v2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> v1 <span class="token operator">&gt;=</span> v2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个自定义的比较函数，当 v1 和 v2 相等时，<code>comp(v1, v2)==true</code>， 但是 <code>comp(v2, v1)</code>的值也是 <code>true</code>，当我们把代码中的等号 <code>=</code> 去掉以后，也就满足了条件2，另外在复杂的比价逻辑中，条件3的传递性问题也是需要注意的问题。</p> 
<h2><a id="_343"></a>构造一个崩溃的示例</h2> 
<p>理解了前面崩溃的原因，我们就不需要猜了，可以直接构造一个百分之百奔溃的测试用例，因为前16（<code>_S_threshold</code>）个元素会使用正常的插入排序，后面的元素才会使用无保护的插入排序，我们其实构造一个17个相同元素的vector就可以了，下面我们来试一下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> values<span class="token punctuation">{<!-- --></span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">sort</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> v1<span class="token punctuation">,</span> <span class="token keyword">int</span> v2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> v1 <span class="token operator">&gt;=</span> v2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> values<span class="token punctuation">)</span> std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> v <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果如下：</p> 
<pre><code class="prism language-cpp">albert@home<span class="token operator">-</span>pc<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>cpp$ g<span class="token operator">++</span> testsort<span class="token punctuation">.</span>cpp <span class="token operator">--</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">11</span> <span class="token operator">-</span>g
albert@home<span class="token operator">-</span>pc<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>cpp$ <span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">0</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token number">6</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> Error in `<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token number">'</span><span class="token operator">:</span> <span class="token keyword">double</span> free <span class="token operator">or</span> <span class="token function">corruption</span> <span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">0x0000000001fd9c20</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Backtrace<span class="token operator">:</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0x777f5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7feaf8ef77f5</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0x8038a</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7feaf8f0038a</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span>cfree<span class="token operator">+</span><span class="token number">0x4c</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7feaf8f0458c</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x402446</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x40230f</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x40218a</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x402005</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x401e65</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x400bf1</span><span class="token punctuation">]</span>
<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">(</span>__libc_start_main<span class="token operator">+</span><span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0x7feaf8ea0840</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>out<span class="token punctuation">[</span><span class="token number">0x4009e9</span><span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Memory map<span class="token operator">:</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">00400000</span><span class="token operator">-</span><span class="token number">00403000</span> r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">211636</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00403000</span><span class="token operator">-</span><span class="token number">00404000</span> r<span class="token operator">-</span>xp <span class="token number">00003000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">211636</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00603000</span><span class="token operator">-</span><span class="token number">00604000</span> r<span class="token operator">--</span>p <span class="token number">00003000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">211636</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">00604000</span><span class="token operator">-</span><span class="token number">00605000</span> rw<span class="token operator">-</span>p <span class="token number">00004000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">211636</span>                     <span class="token operator">/</span>mnt<span class="token operator">/</span>d<span class="token operator">/</span>data<span class="token operator">/</span>cpp<span class="token operator">/</span>testsort<span class="token operator">/</span>a<span class="token punctuation">.</span>out
<span class="token number">01f</span>c8000<span class="token operator">-</span><span class="token number">01ff</span>a000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                          <span class="token punctuation">[</span>heap<span class="token punctuation">]</span>
<span class="token number">7f</span>eaf4000000<span class="token operator">-</span><span class="token number">7f</span>eaf4021000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf4021000<span class="token operator">-</span><span class="token number">7f</span>eaf8000000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf8b70000<span class="token operator">-</span><span class="token number">7f</span>eaf8c78000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf8c78000<span class="token operator">-</span><span class="token number">7f</span>eaf8c7a000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00108000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf8c7a000<span class="token operator">-</span><span class="token number">7f</span>eaf8e77000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">0010</span>a000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf8e77000<span class="token operator">-</span><span class="token number">7f</span>eaf8e78000 r<span class="token operator">--</span>p <span class="token number">00107000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf8e78000<span class="token operator">-</span><span class="token number">7f</span>eaf8e79000 rw<span class="token operator">-</span>p <span class="token number">00108000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243923</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libm<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf8e80000<span class="token operator">-</span><span class="token number">7f</span>eaf9040000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9040000<span class="token operator">-</span><span class="token number">7f</span>eaf9049000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">001</span>c0000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9049000<span class="token operator">-</span><span class="token number">7f</span>eaf9240000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">001</span>c9000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9240000<span class="token operator">-</span><span class="token number">7f</span>eaf9244000 r<span class="token operator">--</span>p <span class="token number">001</span>c0000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9244000<span class="token operator">-</span><span class="token number">7f</span>eaf9246000 rw<span class="token operator">-</span>p <span class="token number">001</span>c4000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243912</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9246000<span class="token operator">-</span><span class="token number">7f</span>eaf924a000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9250000<span class="token operator">-</span><span class="token number">7f</span>eaf9266000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7f</span>eaf9266000<span class="token operator">-</span><span class="token number">7f</span>eaf9465000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00016000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7f</span>eaf9465000<span class="token operator">-</span><span class="token number">7f</span>eaf9466000 rw<span class="token operator">-</span>p <span class="token number">00015000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">180347</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libgcc_s<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span>
<span class="token number">7f</span>eaf9470000<span class="token operator">-</span><span class="token number">7f</span>eaf95e2000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7f</span>eaf95e2000<span class="token operator">-</span><span class="token number">7f</span>eaf95ef000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">00172000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7f</span>eaf95ef000<span class="token operator">-</span><span class="token number">7f</span>eaf97e2000 <span class="token operator">--</span><span class="token operator">-</span>p <span class="token number">0017f</span>000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7f</span>eaf97e2000<span class="token operator">-</span><span class="token number">7f</span>eaf97ec000 r<span class="token operator">--</span>p <span class="token number">00172000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7f</span>eaf97ec000<span class="token operator">-</span><span class="token number">7f</span>eaf97ee000 rw<span class="token operator">-</span>p <span class="token number">0017</span>c000 <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">189413</span>             <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libstdc<span class="token operator">++</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.0</span><span class="token punctuation">.</span><span class="token number">21</span>
<span class="token number">7f</span>eaf97ee000<span class="token operator">-</span><span class="token number">7f</span>eaf97f2000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9800000<span class="token operator">-</span><span class="token number">7f</span>eaf9825000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9825000<span class="token operator">-</span><span class="token number">7f</span>eaf9826000 r<span class="token operator">-</span>xp <span class="token number">00025000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9a25000<span class="token operator">-</span><span class="token number">7f</span>eaf9a26000 r<span class="token operator">--</span>p <span class="token number">00025000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9a26000<span class="token operator">-</span><span class="token number">7f</span>eaf9a27000 rw<span class="token operator">-</span>p <span class="token number">00026000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">243945</span>             <span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>ld<span class="token operator">-</span><span class="token number">2.23</span><span class="token punctuation">.</span>so
<span class="token number">7f</span>eaf9a27000<span class="token operator">-</span><span class="token number">7f</span>eaf9a28000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9bc0000<span class="token operator">-</span><span class="token number">7f</span>eaf9bc1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9bd0000<span class="token operator">-</span><span class="token number">7f</span>eaf9bd2000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9be0000<span class="token operator">-</span><span class="token number">7f</span>eaf9be1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9bf0000<span class="token operator">-</span><span class="token number">7f</span>eaf9bf1000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9c00000<span class="token operator">-</span><span class="token number">7f</span>eaf9c01000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7f</span>eaf9c10000<span class="token operator">-</span><span class="token number">7f</span>eaf9c11000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>
<span class="token number">7ffff</span>b85e000<span class="token operator">-</span><span class="token number">7ffff</span>c05e000 rw<span class="token operator">-</span>p <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                  <span class="token punctuation">[</span>stack<span class="token punctuation">]</span>
<span class="token number">7ffff</span>c61d000<span class="token operator">-</span><span class="token number">7ffff</span>c61e000 r<span class="token operator">-</span>xp <span class="token number">00000000</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">0</span>                  <span class="token punctuation">[</span>vdso<span class="token punctuation">]</span>
<span class="token function">Aborted</span> <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span>
</code></pre> 
<p>完全符合预期，如果再删除vector中的一个元素就不会崩溃了。</p> 
<h2><a id="_442"></a>平台差异</h2> 
<p>这篇文章的代码编译和运行都是在Linux下完成的，但是我之前在Windows上测试时，可不需要最少17个元素的前提，这是为什么呢？因为在微软这一套编译环境下，直接检测了Compare中的条件2，并且是以断言的方式给出提示的，所以与Linux上的运行表现还有一些差异。</p> 
<h2><a id="_447"></a>总结</h2> 
<ul><li>使用 <code>std::sort</code> 函数自定义比较函数时，需要满足严格弱排序性，若 <code>comp(a, b)==true</code> 则 <code>comp(b, a)==false</code>，那么在比较函数中两个元素相等的情况要返回false</li><li>使用 <code>std::sort</code> 函数出现崩溃是往往是不满足严格若排序性，但是在复杂的比较函数中也可能不满足传递性</li><li><code>std::sort</code> 为了把排序效率提高到极致，综合使用了快排、堆排、插入排序等多种排序方法</li><li><code>std::sort</code> 在不同的平台实现不同，当比较函数不满足严格若排序时，gcc环境下至少有17个元素才会崩溃，而 <code>MSVC</code> 则在Debug时没有元素个数限制，会通过断言直接判断这个条件是否满足</li></ul> 
<hr> 
<center> 
 <a href="https://blog.csdn.net/albertsh/article/details/119090991"> ==&gt;&gt; 反爬链接，请勿点击，原地爆炸，概不负责！&lt;&lt;== </a> 
</center> 
<hr> 
<blockquote> 
 <p>可是啊 总有那风吹不散的认真 总有大雨也不能抹去的泪痕~</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7a0380617741b4fb0d0cd6c3cd7524fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue 插槽＜slot＞＜/slot＞ - 笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65e47705deb8f7f2eef0a36cd36361ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">饥荒联机版好友服务器未响应,饥荒联机版机器人wx-78使用心得</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>