<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>5 FFmpeg从入门到精通-FFmpeg流媒体 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="5 FFmpeg从入门到精通-FFmpeg流媒体" />
<meta property="og:description" content="1 FFmpeg从入门到精通-FFmpeg简介
2 FFmpeg从入门到精通-FFmpeg工具使用基础
3 FFmpeg从入门到精通-FFmpeg转封装
4 FFmpeg从入门到精通-FFmpeg转码
5 FFmpeg从入门到精通-FFmpeg流媒体
6 FFmpeg从入门到精通-FFmpeg滤镜使用
7 FFmpeg从入门到精通-FFmpeg中Linux设备操作
8 FFmpeg从入门到精通-FFmpeg接口libavformat的使用
9 FFmpeg从入门到精通-FFmpeg接口libavcodec的使用
10 FFmpeg从入门到精通-FFmpeg接口libavfilter的使用
文章目录 5.FFmpeg流媒体 5.1 FFmpeg发布与录制RTMP流 5.1.1 RTMP参数说明 5.1.2 RTMP参数举例 1.rtmp_app参数 2.rtmp_playpath参数 3.rtmp_pageurl、rtmp_swfurl、rtmp_tcurl参数 5.2 FFmpeg录制RTSP流 5.2.1 RTSP参数说明 5.2.2 RTSP参数使用举例 1.TCP方式录制RTSP直播流 2.User-Agent设置参数 5.3 FFmpeg录制HTTP流 5.3.1 HTTP参数说明 5.3.2 HTTP参数使用举例 1.seekable参数举例 2.headers参数举例 3.user_agent参数设置 5.3.3 HTTP拉流录制 5.3.4 拉取HTTP中的流录制FLV 5.4 FFmpeg录制和发布UDP/TCP流 5.4.1 TCP与UDP参数说明 5.4.2 TCP参数使用举例 1.TCP监听接收流 2.TCP请求发布流 3.监听端口超时listen_timeout 4.TCP拉流超时参数timeout 5.TCP传输buffer大小设置send_buffer_size/recv_buffer_size 6.绑定本地UDP端口localport 5.4.3 TCP/UDP使用小结 5.5 FFmpeg推多路流 5.5.1 管道方式输出多路流 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/6815bcc03aa5212ad56d274628b2116e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T14:57:50+08:00" />
<meta property="article:modified_time" content="2023-03-28T14:57:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">5 FFmpeg从入门到精通-FFmpeg流媒体</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://blog.csdn.net/migu123/article/details/129300701">1 FFmpeg从入门到精通-FFmpeg简介</a><br> <a href="https://blog.csdn.net/migu123/article/details/129300983">2 FFmpeg从入门到精通-FFmpeg工具使用基础</a><br> <a href="https://blog.csdn.net/migu123/article/details/129301229">3 FFmpeg从入门到精通-FFmpeg转封装</a><br> <a href="https://blog.csdn.net/migu123/article/details/129313337">4 FFmpeg从入门到精通-FFmpeg转码</a><br> <a href="https://blog.csdn.net/migu123/article/details/129313756">5 FFmpeg从入门到精通-FFmpeg流媒体</a><br> <a href="https://blog.csdn.net/migu123/article/details/129314333">6 FFmpeg从入门到精通-FFmpeg滤镜使用</a><br> <a href="https://blog.csdn.net/migu123/article/details/129314910">7 FFmpeg从入门到精通-FFmpeg中Linux设备操作</a><br> <a href="https://blog.csdn.net/migu123/article/details/129317309">8 FFmpeg从入门到精通-FFmpeg接口libavformat的使用</a><br> <a href="https://blog.csdn.net/migu123/article/details/129324534">9 FFmpeg从入门到精通-FFmpeg接口libavcodec的使用</a><br> <a href="https://blog.csdn.net/migu123/article/details/129324632">10 FFmpeg从入门到精通-FFmpeg接口libavfilter的使用</a></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#font_face_size45FFmpegfont_12" rel="nofollow"><font face="黑体" size="4">5.FFmpeg流媒体</font></a></li><li><ul><li><a href="#nbspnbspfont_face_size351_FFmpegRTMPfont_13" rel="nofollow">  <font face="黑体" size="3">5.1 FFmpeg发布与录制RTMP流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp511_RTMPfont_15" rel="nofollow"><font face="黑体" size="3">  5.1.1 RTMP参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp512_RTMPfont_18" rel="nofollow"><font face="黑体" size="3">  5.1.2 RTMP参数举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1rtmp_appfont_20" rel="nofollow"><font face="楷体" size="2">    1.rtmp_app参数</font></a></li><li><a href="#font_face_size2_nbspnbsp_2rtmp_playpathfont_48" rel="nofollow"><font face="楷体" size="2">    2.rtmp_playpath参数</font></a></li><li><a href="#font_face_size2_nbspnbsp_3rtmp_pageurlrtmp_swfurlrtmp_tcurlfont_137" rel="nofollow"><font face="楷体" size="2">    3.rtmp_pageurl、rtmp_swfurl、rtmp_tcurl参数</font></a></li></ul> 
   </li></ul> 
   </li><li><a href="#nbspnbspfont_face_size352_FFmpegRTSPfont_145" rel="nofollow">  <font face="黑体" size="3">5.2 FFmpeg录制RTSP流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp521_RTSPfont_147" rel="nofollow"><font face="黑体" size="3">  5.2.1 RTSP参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp522_RTSPfont_151" rel="nofollow"><font face="黑体" size="3">  5.2.2 RTSP参数使用举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1TCPRTSPfont_153" rel="nofollow"><font face="楷体" size="2">    1.TCP方式录制RTSP直播流</font></a></li><li><a href="#font_face_size2_nbspnbsp_2UserAgentfont_246" rel="nofollow"><font face="楷体" size="2">    2.User-Agent设置参数</font></a></li></ul> 
   </li></ul> 
   </li><li><a href="#nbspnbspfont_face_size353_FFmpegHTTPfont_252" rel="nofollow">  <font face="黑体" size="3">5.3 FFmpeg录制HTTP流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp531_HTTPfont_254" rel="nofollow"><font face="黑体" size="3">  5.3.1 HTTP参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp532_HTTPfont_258" rel="nofollow"><font face="黑体" size="3">  5.3.2 HTTP参数使用举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1seekablefont_260" rel="nofollow"><font face="楷体" size="2">    1.seekable参数举例</font></a></li><li><a href="#font_face_size2_nbspnbsp_2headersfont_292" rel="nofollow"><font face="楷体" size="2">    2.headers参数举例</font></a></li><li><a href="#font_face_size2_nbspnbsp_3user_agentfont_311" rel="nofollow"><font face="楷体" size="2">    3.user_agent参数设置</font></a></li></ul> 
    </li><li><a href="#font_face_size3nbspnbsp533_HTTPfont_331" rel="nofollow"><font face="黑体" size="3">  5.3.3 HTTP拉流录制</font></a></li><li><a href="#font_face_size3nbspnbsp534_HTTPFLVfont_333" rel="nofollow"><font face="黑体" size="3">  5.3.4 拉取HTTP中的流录制FLV</font></a></li></ul> 
   </li><li><a href="#nbspnbspfont_face_size354_FFmpegUDPTCPfont_347" rel="nofollow">  <font face="黑体" size="3">5.4 FFmpeg录制和发布UDP/TCP流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp541_TCPUDPfont_349" rel="nofollow"><font face="黑体" size="3">  5.4.1 TCP与UDP参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp542_TCPfont_353" rel="nofollow"><font face="黑体" size="3">  5.4.2 TCP参数使用举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1TCPfont_355" rel="nofollow"><font face="楷体" size="2">    1.TCP监听接收流</font></a></li><li><a href="#font_face_size2_nbspnbsp_2TCPfont_361" rel="nofollow"><font face="楷体" size="2">    2.TCP请求发布流</font></a></li><li><a href="#font_face_size2_nbspnbsp_3listen_timeoutfont_430" rel="nofollow"><font face="楷体" size="2">    3.监听端口超时listen_timeout</font></a></li><li><a href="#font_face_size2_nbspnbsp_4TCPtimeoutfont_442" rel="nofollow"><font face="楷体" size="2">    4.TCP拉流超时参数timeout</font></a></li><li><a href="#font_face_size2_nbspnbsp_5TCPbuffersend_buffer_sizerecv_buffer_sizefont_454" rel="nofollow"><font face="楷体" size="2">    5.TCP传输buffer大小设置send_buffer_size/recv_buffer_size</font></a></li><li><a href="#font_face_size2_nbspnbsp_6UDPlocalportfont_497" rel="nofollow"><font face="楷体" size="2">    6.绑定本地UDP端口localport</font></a></li></ul> 
    </li><li><a href="#font_face_size3nbspnbsp543_TCPUDPfont_540" rel="nofollow"><font face="黑体" size="3">  5.4.3 TCP/UDP使用小结</font></a></li></ul> 
   </li><li><a href="#nbspnbspfont_face_size355_FFmpegfont_542" rel="nofollow">  <font face="黑体" size="3">5.5 FFmpeg推多路流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp551_font_544" rel="nofollow"><font face="黑体" size="3">  5.5.1 管道方式输出多路流</font></a></li><li><a href="#font_face_size3nbspnbsp552_teefont_558" rel="nofollow"><font face="黑体" size="3">  5.5.2 tee封装格式输出多路流</font></a></li><li><a href="#font_face_size3nbspnbsp553_teefont_614" rel="nofollow"><font face="黑体" size="3">  5.5.3 tee协议输出多路流</font></a></li></ul> 
   </li><li><a href="#nbspnbspfont_face_size356_FFmpegHDSfont_661" rel="nofollow">  <font face="黑体" size="3">5.6 FFmpeg生成HDS流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp561_HDSfont_663" rel="nofollow"><font face="黑体" size="3">  5.6.1 HDS参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp562_HDSfont_667" rel="nofollow"><font face="黑体" size="3">  5.6.2 HDS使用举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1window_sizefont_669" rel="nofollow"><font face="楷体" size="2">    1.window_size参数控制文件列表大小</font></a></li><li><a href="#font_face_size2_nbspnbsp_2extra_window_sizefont_681" rel="nofollow"><font face="楷体" size="2">    ;2.extra_window_size参数控制文件个数</font></a></li><li><a href="#font_face_size2_nbspnbsp_3font_689" rel="nofollow"><font face="楷体" size="2">    3.其他参数</font></a></li></ul> 
   </li></ul> 
   </li><li><a href="#nbspnbspfont_face_size357_FFmpegDASHfont_691" rel="nofollow">  <font face="黑体" size="3">5.7 FFmpeg生成DASH流</font></a></li><li><ul><li><a href="#font_face_size3nbspnbsp571_DASHfont_693" rel="nofollow"><font face="黑体" size="3">  5.7.1 DASH参数说明</font></a></li><li><a href="#font_face_size3nbspnbsp572_DASHfont_697" rel="nofollow"><font face="黑体" size="3">  5.7.2 DASH参数使用举例</font></a></li><li><ul><li><a href="#font_face_size2_nbspnbsp_1window_sizeextra_window_sizefont_698" rel="nofollow"><font face="楷体" size="2">    1.window_size与extra_window_size参数举例</font></a></li><li><a href="#font_face_size2_nbspnbsp_2single_filefont_705" rel="nofollow"><font face="楷体" size="2">    2.single_file参数举例</font></a></li></ul> 
   </li></ul> 
   </li><li><a href="#nbspnbspfont_face_size358_font_712" rel="nofollow">  <font face="黑体" size="3">5.8 小结</font></a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="font_face_size45FFmpegfont_12"></a><font face="黑体" size="4">5.FFmpeg流媒体</font></h2> 
<h3><a id="nbspnbspfont_face_size351_FFmpegRTMPfont_13"></a>  <font face="黑体" size="3">5.1 FFmpeg发布与录制RTMP流</font></h3> 
<p><font face="Courier New">    在流媒体中，RTMP直播是最为常见的一种实时直播，同时考虑将RTMP实时直播的流录制下来。</font></p> 
<h4><a id="font_face_size3nbspnbsp511_RTMPfont_15"></a><font face="黑体" size="3">  5.1.1 RTMP参数说明</font></h4> 
<p><font face="Courier New">    下面就来介绍FFmpeg拉取RTMP直播流可以使用的主要参数，如表所示。</font><br> <img src="https://images2.imgbox.com/3b/19/2vhLSpjn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_face_size3nbspnbsp512_RTMPfont_18"></a><font face="黑体" size="3">  5.1.2 RTMP参数举例</font></h4> 
<p><font face="Courier New">    开始之前<mark>需要先搭建Nginx+RTMP服务</mark>，接下来将根据例子进行设置项的作用分析。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_1rtmp_appfont_20"></a><font face="楷体" size="2">    1.rtmp_app参数</font></h5> 
<p><font face="Courier New">    通过使用rtmp_app参数可以设置RTMP的推流发布点，录制命令行如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -rtmp_app live -i rtmp://192.168.100.12:1935 -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    <mark>或者发布流命令行如下</mark>：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -f flv -rtmp_app live rtmp://192.168.100.12:1935
</code></pre> 
<p><font face="Courier New">    执行这条命令行时，FFmpeg将会给出错误提示，具体如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
    Metadata:
        major_brand     <span class="token builtin class-name">:</span> isom
        minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
        compatible_brands: isomiso2avc1mp41
        encoder         <span class="token builtin class-name">:</span> Lavf57.66.102
    Duration: 00:00:10.01, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2309</span> kb/s
        Stream <span class="token comment">#0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 1280x714 [SAR 1:1 DAR 640:357], 2183 kb/s, 25 fps, 25 tbr, 25k tbn, 50 tbc (default)</span>
    Metadata:
        handler_name    <span class="token builtin class-name">:</span> VideoHandler
        Stream <span class="token comment">#0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 120 kb/s (default)</span>
    Metadata:
        handler_name    <span class="token builtin class-name">:</span> SoundHandler
<span class="token punctuation">[</span>rtmp @ 0x7fd0816016e0<span class="token punctuation">]</span> Server error: identify stream failed.
rtmp://192.168.100.12: Unknown error occurred
</code></pre> 
<p><font face="Courier New">    <mark>出现该错误是因为我们尚未设置stream项所致</mark>。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_2rtmp_playpathfont_48"></a><font face="楷体" size="2">    2.rtmp_playpath参数</font></h5> 
<p><font face="Courier New">    设置rtmp_app时可以看到提示了identify stream failed错误，<mark>可以通过使用rtmp_playpath参数</mark>来解决该错误，下面先列举一个<code>推流的例子</code>：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -f flv -rtmp_app myapp -rtmp_playpath hls rtmp://192.168.100.12:1935
</code></pre> 
<p><font face="Courier New">    <code>执行完这条命令行之后，推流将会成功</code>，因为其设置了rtmp_app与rtmp_playpath两个参数，分别发布点live与流名称class。执行后的输出结果如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Duration: 00:00:35.07, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2661</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2493 kb/s, 30 fps, 30 tbr, 15360 tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Output <span class="token comment">#0, flv, to 'rtmp://192.168.100.12:1935':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0(und): Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 2493 kb/s, 30 fps, 30 tbr, 1k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) ([10][0][0][0] / 0x000A), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token assign-left variable">frame</span><span class="token operator">=</span>  <span class="token number">202</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">30</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>-1.0 <span class="token assign-left variable">size</span><span class="token operator">=</span>    2160kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:06.63 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span><span class="token number">2667</span>.2kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span>   1x
</code></pre> 
<p><font face="Courier New">    输出信息为链接成功，表示推流（发布流）成功。<br>     流发布成功后，可以用同样的方式测试播放RTMP流：</font></p> 
<pre><code class="prism language-bash">ffmpeg -rtmp_app myapp -rtmp_playpath hls -i rtmp://192.168.100.12:1935 -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    执行完这条命令之后，将会成功地从RTMP服务器中拉取直播流，保存为output.flv，<code>因为设置了rtmp_app与rtmp_playpath参数</code>，执行效果如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, flv, from 'rtmp://192.168.100.12:1935':</span>
  Metadata:
    <span class="token operator">|</span>RtmpSampleAccess: <span class="token boolean">true</span>
    Server          <span class="token builtin class-name">:</span> NGINX RTMP <span class="token punctuation">(</span>github.com/arut/nginx-rtmp-module<span class="token punctuation">)</span>
    displayWidth    <span class="token builtin class-name">:</span> <span class="token number">1920</span>
    displayHeight   <span class="token builtin class-name">:</span> <span class="token number">1080</span>
    fps             <span class="token builtin class-name">:</span> <span class="token number">30</span>
    profile         <span class="token builtin class-name">:</span>
    level           <span class="token builtin class-name">:</span>
  Duration: 00:00:00.00, start: <span class="token number">0.067000</span>, bitrate: N/A
  Stream <span class="token comment">#0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2492 kb/s, 30 fps, 30 tbr, 1k tbn</span>
  Stream <span class="token comment">#0:1: Audio: aac (LC), 48000 Hz, stereo, fltp, 159 kb/s</span>
File <span class="token string">'output.flv'</span> already exists. Overwrite? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> y
Output <span class="token comment">#0, flv, to 'output.flv':</span>
  Metadata:
    <span class="token operator">|</span>RtmpSampleAccess: <span class="token boolean">true</span>
    Server          <span class="token builtin class-name">:</span> NGINX RTMP <span class="token punctuation">(</span>github.com/arut/nginx-rtmp-module<span class="token punctuation">)</span>
    displayWidth    <span class="token builtin class-name">:</span> <span class="token number">1920</span>
    displayHeight   <span class="token builtin class-name">:</span> <span class="token number">1080</span>
    fps             <span class="token builtin class-name">:</span> <span class="token number">30</span>
    profile         <span class="token builtin class-name">:</span>
    level           <span class="token builtin class-name">:</span>
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0: Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 2492 kb/s, 30 fps, 30 tbr, 1k tbn</span>
  Stream <span class="token comment">#0:1: Audio: aac (LC) ([10][0][0][0] / 0x000A), 48000 Hz, stereo, fltp, 159 kb/s</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token assign-left variable">frame</span><span class="token operator">=</span>  <span class="token number">246</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">10</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>-1.0 <span class="token assign-left variable">size</span><span class="token operator">=</span>    2816kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:27.56 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span> <span class="token number">836</span>.9kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">1</span>.16x
</code></pre> 
<p><font face="Courier New">    之所以能够成功地推流与拉流，是因为设置rtmp_app与rtmp_playpath起到了作用。如果认为设置rtmp_app与rtmp_playpath太麻烦，那么可以省略这两个参数，直接将参数设置在RTMP的连接中即可：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i input.mp4 -c copy -f flv rtmp://192.168.100.12:1935/myapp/hls
</code></pre> 
<p><font face="Courier New">    发布流可以通过这种方式直接进行发布，<code>其中myapp为发布点，hls为流名称，推流成功</code>，并且推流的信息与使用rtmp_app和rtmp_playpath组合起来的效果相同，可以通过抓包工具分析出来。</font></p> 
<pre><code class="prism language-bash">ffmpeg -i rtmp://192.168.100.12:1935/myapp/hls -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    <code>与推流的链接相同，将发布点与流名称同时放在URL中进行拉流录制</code>，至此，rtmp_app与rtmp_playpath参数介绍完毕。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_3rtmp_pageurlrtmp_swfurlrtmp_tcurlfont_137"></a><font face="楷体" size="2">    3.rtmp_pageurl、rtmp_swfurl、rtmp_tcurl参数</font></h5> 
<p><font face="Courier New">    在RTMP的Connect命令中包含了很多Object，这些Object中有一个pageUrl，例如通过页面的Flashplayer进行播放，RTMP的Connect命令中包含的pageUrl如。在使用FFmpeg发起播放时，不会在Connect命令中携带pageUrl字段，如图所示。</font><br> <img src="https://images2.imgbox.com/03/89/tNHKr5r7_o.png" alt="在这里插入图片描述"><br> <font face="Courier New">    FFmpeg可以使用rtmp_pageurl来设置这个字段，以做标识，这个标识与HTTP请求中的referer防盗链基本可以认为是起相同作用的，在RTMP服务器中可以根据这个信息进行referer防盗链操作。使用FFmpeg的rtmp_pageurl参数可以设置pageUrl，例如设置一个192.168.100.10:1935：</font></p> 
<pre><code class="prism language-bash">ffmpeg -rtmp_pageurl <span class="token string">"192.168.100.10:1935"</span> -i rtmp://192.168.100.10:1935/myapp/hls
</code></pre> 
<p><font face="Courier New">    执行完这条命令行之后，使用抓包工具抓包可以看到Connect命令中包含了pageUrl一项，值为myapp，这个值可通过<code>ffmpeg -rtmp_pageurl</code>设置生效。</font></p> 
<h3><a id="nbspnbspfont_face_size352_FFmpegRTSPfont_145"></a>  <font face="黑体" size="3">5.2 FFmpeg录制RTSP流</font></h3> 
<p><font face="Courier New">    提到直播流媒体，RTSP曾经是最常见的直播方式。如今在安防领域中其依然常见，互联网中虽然已经大多数转向<mark>RTMP、HTTP+FLV、HLS、DASH</mark>等方式，但依然还是有很多场景在使用RTSP，所以这里先来介绍一下RTSP。众所周知，实时直播的优点为实时性，<mark>如果直播过后再想回溯之前发生的实时情况时，则需要录制与存储的技术来做支撑</mark>，FFmpeg可以满足这个技术，下面就来介绍一下FFmpeg的RTSP支持的参数。</font></p> 
<h4><a id="font_face_size3nbspnbsp521_RTSPfont_147"></a><font face="黑体" size="3">  5.2.1 RTSP参数说明</font></h4> 
<p><font face="Courier New">    在使用FFmpeg处理RTSP之前，首先需要了解RTSP都有哪些参数，执行<code>ffmpeg -h demuxer=RTSP</code>命令行将会输出RTSP相关的协议读取操作参数。</font><br> <img src="https://images2.imgbox.com/5e/df/dHYzbm6P_o.png" alt="在这里插入图片描述"><br> <font face="Courier New">    从表中所列的参数可以看出，RTSP传输协议可以有多种方式，不仅可以通过UDP，还可以通过TCP、HTTP隧道等，下面就来根据上述参数进行举例说明。</font></p> 
<h4><a id="font_face_size3nbspnbsp522_RTSPfont_151"></a><font face="黑体" size="3">  5.2.2 RTSP参数使用举例</font></h4> 
<p><font face="Courier New">    使用RTSP拉流时，时常会遇到因为采用UDP方式而导致拉流丢包出现异常，所以在实时性与可靠性适中时，可以考虑采用TCP的方式进行拉流。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_1TCPRTSPfont_153"></a><font face="楷体" size="2">    1.TCP方式录制RTSP直播流</font></h5> 
<p><font face="Courier New">    FFmpeg默认使用的RTSP拉流的方式为UDP传输方式，为了避免丢包导致的花屏、绿屏、灰屏、马赛克等问题，还可以考虑将UDP传输方式改为TCP传输方式：</font></p> 
<pre><code class="prism language-bash">ffmpeg -rtsp_transport tcp -i rtsp://admin:bnc123456@192.168.100.17:554/h264/ch33/sub/av_stream -ar <span class="token number">22050</span> -c:v libx264 -f mp4 output.mp4
Input <span class="token comment">#0, rtsp, from 'rtsp://admin:bnc123456@192.168.100.17:554/h264/ch33/sub/av_stream':</span>
  Metadata:
    title           <span class="token builtin class-name">:</span> Media Presentation
  Duration: N/A, start: <span class="token number">0.000000</span>, bitrate: N/A
  Stream <span class="token comment">#0:0: Video: h264 (Main), yuvj420p(pc, bt709, progressive), 704x576, 25 fps, 25 tbr, 90k tbn</span>
  Stream <span class="token comment">#0:1: Audio: pcm_alaw, 8000 Hz, mono, s16, 64 kb/s</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (h264 (native) -&gt; h264 (libx264))</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (pcm_alaw (native) -&gt; aac (native))</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token punctuation">[</span>libx264 @ 00000236e7d0a700<span class="token punctuation">]</span> using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2
<span class="token punctuation">[</span>libx264 @ 00000236e7d0a700<span class="token punctuation">]</span> profile High, level <span class="token number">3.0</span>, <span class="token number">4</span>:2:0, <span class="token number">8</span>-bit
<span class="token punctuation">[</span>libx264 @ 00000236e7d0a700<span class="token punctuation">]</span> <span class="token number">264</span> - core <span class="token number">164</span> r3101 b093bbe - H.264/MPEG-4 AVC codec - Copyleft <span class="token number">2003</span>-2022 - http://www.videolan.org/x264.html - options: <span class="token assign-left variable">cabac</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ref</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">deblock</span><span class="token operator">=</span><span class="token number">1</span>:0:0 <span class="token assign-left variable">analyse</span><span class="token operator">=</span>0x3:0x113 <span class="token assign-left variable">me</span><span class="token operator">=</span>hex <span class="token assign-left variable">subme</span><span class="token operator">=</span><span class="token number">7</span> <span class="token assign-left variable">psy</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">psy_rd</span><span class="token operator">=</span><span class="token number">1.00</span>:0.00 <span class="token assign-left variable">mixed_ref</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">me_range</span><span class="token operator">=</span><span class="token number">16</span> <span class="token assign-left variable">chroma_me</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">trellis</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">8x8dct</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">cqm</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">deadzone</span><span class="token operator">=</span><span class="token number">21,11</span> <span class="token assign-left variable">fast_pskip</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">chroma_qp_offset</span><span class="token operator">=</span>-2 <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token number">9</span> <span class="token assign-left variable">lookahead_threads</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">sliced_threads</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">nr</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">decimate</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">interlaced</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">bluray_compat</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">constrained_intra</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">bframes</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">b_pyramid</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">b_adapt</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">b_bias</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">direct</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">weightb</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">open_gop</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">weightp</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">keyint</span><span class="token operator">=</span><span class="token number">250</span> <span class="token assign-left variable">keyint_min</span><span class="token operator">=</span><span class="token number">25</span> <span class="token assign-left variable">scenecut</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">intra_refresh</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">rc_lookahead</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span>crf <span class="token assign-left variable">mbtree</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">crf</span><span class="token operator">=</span><span class="token number">23.0</span> <span class="token assign-left variable">qcomp</span><span class="token operator">=</span><span class="token number">0.60</span> <span class="token assign-left variable">qpmin</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">qpmax</span><span class="token operator">=</span><span class="token number">69</span> <span class="token assign-left variable">qpstep</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ip_ratio</span><span class="token operator">=</span><span class="token number">1.40</span> <span class="token assign-left variable">aq</span><span class="token operator">=</span><span class="token number">1</span>:1.00
Output <span class="token comment">#0, mp4, to 'output.mp4':</span>
  Metadata:
    title           <span class="token builtin class-name">:</span> Media Presentation
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0: Video: h264 (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 704x576, q=2-31, 25 fps, 12800 tbn</span>
    Metadata:
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 libx264
    Side data:
      cpb: bitrate max/min/avg: <span class="token number">0</span>/0/0 buffer size: <span class="token number">0</span> vbv_delay: N/A
  Stream <span class="token comment">#0:1: Audio: aac (LC) (mp4a / 0x6134706D), 22050 Hz, mono, fltp, 69 kb/s</span>
    Metadata:
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 aac
<span class="token assign-left variable">frame</span><span class="token operator">=</span>   <span class="token number">35</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">13</span> <span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">28.0</span> <span class="token assign-left variable">size</span><span class="token operator">=</span>       0kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:03.66 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span>   <span class="token number">0</span>.1kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span> <span class="token number">1</span>.4x
</code></pre> 
<p><font face="Courier New">    从输出的内容可以看出，FFmpeg已经从，将海康相机RTSP流，并且将其录制到本地存储为output.mp4。<br>     RTSP录制流建连接时，可以通过抓网络传输的包看到交互内容，内容如下：</font></p> 
<pre><code class="prism language-bash">Request: OPTIONS rtsp://192.168.100.17:554/h264/ch33/sub/av_stream RTSP/1.0<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
CSeq: <span class="token number">1</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
User-Agent: Lavf59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Response: RTSP/1.0 <span class="token number">200</span> OK<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
CSeq: <span class="token number">1</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Public: OPTIONS, DESCRIBE, PLAY, PAUSE, SETUP, TEARDOWN, SET_PARAMETER, GET_PARAMETER<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
</code></pre> 
<p><font face="Courier New">    以上内容为RTSP标准中查询RTSP服务器所支持的方法所包含的内容。从输出的列表中可以看到该RTSP支持：<code>DESCRIBE、SETUP、TEARDOWN、PLAY、PAUSE、OPTIONS、GET_PARAMETER、SET_PARAMETER</code>；查询完成之后，继续进入下一步。</font></p> 
<pre><code class="prism language-bash">Request: DESCRIBE rtsp://192.168.100.17:554/h264/ch33/sub/av_stream RTSP/1.0<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Accept: application/sdp<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
CSeq: <span class="token number">2</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
User-Agent: Lavf59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n

Response: RTSP/1.0 <span class="token number">200</span> OK<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
 CSeq: <span class="token number">3</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
 Content-type: application/sdp
 Content-Base: rtsp://192.168.100.17:554/h264/ch33/sub/av_stream/<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
 Content-length: <span class="token number">758</span>
Session Description Protocol
    Session Description Protocol Version <span class="token punctuation">(</span>v<span class="token punctuation">)</span>: <span class="token number">0</span>
    Owner/Creator, Session Id <span class="token punctuation">(</span>o<span class="token punctuation">)</span>: - <span class="token number">1679930691333247</span> <span class="token number">1679930691333247</span> IN IP4 <span class="token number">192.168</span>.100.17
    Session Name <span class="token punctuation">(</span>s<span class="token punctuation">)</span>: Media Presentation
    E-mail Address <span class="token punctuation">(</span>e<span class="token punctuation">)</span>: NONE
    Bandwidth Information <span class="token punctuation">(</span>b<span class="token punctuation">)</span>: AS:5100
    Time Description, active <span class="token function">time</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span>: <span class="token number">0</span> <span class="token number">0</span>
    Session Attribute <span class="token punctuation">(</span>a<span class="token punctuation">)</span>: control:rtsp://192.168.100.17:554/h264/ch33/sub/av_stream/
    Media Description, name and address <span class="token punctuation">(</span>m<span class="token punctuation">)</span>: video <span class="token number">0</span> RTP/AVP <span class="token number">96</span>
    Connection Information <span class="token punctuation">(</span>c<span class="token punctuation">)</span>: IN IP4 <span class="token number">0.0</span>.0.0
    Bandwidth Information <span class="token punctuation">(</span>b<span class="token punctuation">)</span>: AS:5000
</code></pre> 
<p><font face="Courier New">    根据协议中的内容可以看到，FFmpeg与服务器之间又<code>发起了DESCRIBE操作，RTSP服务器返回了流数据的描述，数据为视频数据，编码为H.264格式，通过RTP进行传输</code>；接下来进入下一步：</font></p> 
<pre><code class="prism language-bash">Request: SETUP rtsp://192.168.100.17:554/h264/ch33/sub/av_stream/trackID<span class="token operator">=</span><span class="token number">1</span> RTSP/1.0<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Transport: RTP/AVP/TCP<span class="token punctuation">;</span>unicast<span class="token punctuation">;</span><span class="token assign-left variable">interleaved</span><span class="token operator">=</span><span class="token number">0</span>-1
CSeq: <span class="token number">4</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
User-Agent: Lavf59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n

Response: RTSP/1.0 <span class="token number">200</span> OK<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
CSeq: <span class="token number">4</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Session: <span class="token number">1518403376</span><span class="token punctuation">;</span><span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">60</span>
Transport: RTP/AVP/TCP<span class="token punctuation">;</span>unicast<span class="token punctuation">;</span><span class="token assign-left variable">interleaved</span><span class="token operator">=</span><span class="token number">0</span>-1<span class="token punctuation">;</span><span class="token assign-left variable">ssrc</span><span class="token operator">=</span>05eaf54b<span class="token punctuation">;</span><span class="token assign-left variable">mode</span><span class="token operator">=</span><span class="token string">"play"</span>
</code></pre> 
<p><font face="Courier New">    从输出的协议内容中可以看到，这一步为<code>设置SETUP操作，建立会话</code>，以后的交互都将通过该会话Session进行标识，得到Session之后再继续进入下一步。</font></p> 
<pre><code class="prism language-bash">   Request: PLAY rtsp://192.168.100.17:554/h264/ch33/sub/av_stream/ RTSP/1.0<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
   Range: <span class="token assign-left variable">npt</span><span class="token operator">=</span><span class="token number">0.000</span>-<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
   CSeq: <span class="token number">6</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
   User-Agent: Lavf59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
   Session: <span class="token number">1518403376</span>
</code></pre> 
<p><font face="Courier New">    从SETUP得到Session之后，带着这个Session发起<code>PLAY操作，得到RTSP服务器的OK状态之后，即可进入接收视频数据的操作，也就是播放操作或录制操作等</code>，如果希望退出播放，或者停止录制，则可以通过TEARDOWN来操作。</font></p> 
<pre><code class="prism language-bash">Request: TEARDOWN rtsp://192.168.100.17:554/h264/ch33/sub/av_stream/ RTSP/1.0<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
CSeq: <span class="token number">7</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
User-Agent: Lavf59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
Session: <span class="token number">1518403376</span>
</code></pre> 
<p><font face="Courier New">    从上述协议内容中可以看到，接收数据的时候发起了<code>TEARDOWN，服务器关闭了Session，整个会话结束</code>。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_2UserAgentfont_246"></a><font face="楷体" size="2">    2.User-Agent设置参数</font></h5> 
<p><font face="Courier New">    为了在访问的时候区分是不是自己访问的流，可以通过设置User-Agent进行区别，设置一个比较有特点的User-Agent做标识即可，下面就来举例说明如何设置User-Agent进行访问。</font></p> 
<pre><code class="prism language-bash">ffmpeg -user-agent <span class="token string">"ChinaFFmpeg-Player"</span> -i rtsp://admin:bnc123456@192.168.100.17:554/h264/ch33/sub/av_stream -ar <span class="token number">22050</span> -c:v libx264 -f mp4 -y output.mp4
</code></pre> 
<p><font face="Courier New">    执行这条命令行之后，即设置了User-Agent，进行抓包后分析过程时可以看到包中的User-Agent已经设置生效。</font></p> 
<h3><a id="nbspnbspfont_face_size353_FFmpegHTTPfont_252"></a>  <font face="黑体" size="3">5.3 FFmpeg录制HTTP流</font></h3> 
<p><font face="Courier New">    在流媒体服务当中，HTTP服务最为常见，尤其是点播。当然，直播也支持HTTP服务，例如使用HTTP传输FLV直播流、使用HTTP传输TS直播流，或者使用HTTP传输M3U8以及TS文件等。</font></p> 
<h4><a id="font_face_size3nbspnbsp531_HTTPfont_254"></a><font face="黑体" size="3">  5.3.1 HTTP参数说明</font></h4> 
<p><font face="Courier New">    在FFmpeg中支持HTTP进行流媒体的传输，无论是直播还是点播，均可以采用HTTP，而FFmpeg既可以作为播放器，也可以作为服务器进行使用，使用时针对HTTP，FFmpeg有很多参数都可以使用，下面就来看一下FFmpeg中的HTTP都可以支持哪些参数，具体见表。</font><br> <img src="https://images2.imgbox.com/cd/3e/lh3DHiL5_o.png" alt="在这里插入图片描述"><br> 关于FFmpeg的HTTP参数均已在表中列举出，例如设置HTTP请求时的HTTP头、设置User-Agent信息等；上述参数均是FFmpeg作为播放器或服务器的常用参数。</p> 
<h4><a id="font_face_size3nbspnbsp532_HTTPfont_258"></a><font face="黑体" size="3">  5.3.2 HTTP参数使用举例</font></h4> 
<p><font face="Courier New">    从表所示的参数列表中可以看到，FFmpeg的HTTP既可以作为客户端使用，又可以作为服务器端使用，FFmpeg作为客户端使用的场景更多，所以本节专门针对客户端使用进行举例。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_1seekablefont_260"></a><font face="楷体" size="2">    1.seekable参数举例</font></h5> 
<p><font face="Courier New">    在使用FFmpeg打开直播或者点播文件时，可以通过seek操作进行播放进度移动、定位等操作：</font></p> 
<pre><code class="prism language-bash">ffmpeg -ss <span class="token number">300</span> -seekable <span class="token number">0</span> -i http://192.168.100.10/test.ts -c copy output.mp4
</code></pre> 
<p><font face="Courier New">    命令执行时，若seekable设置为0，则FFmpeg的参数ss指定seek的时间位置。因为seekable参数是0，所以会一直处于阻塞状态。而下面这条命令则会出现另外一种情况：</font></p> 
<pre><code class="prism language-bash">ffmpeg -ss <span class="token number">30</span> -seekable <span class="token number">1</span> -i http://bbs.chinaffmpeg.com/test.ts -c copy -y output.mp4
</code></pre> 
<p><font face="Courier New">    若seekable设置为1，则命令行执行后输出如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mpegts, from 'http://120.24.33.118/input.ts':</span>
  Duration: 00:00:08.38, start: <span class="token number">9.756522</span>, bitrate: <span class="token number">2615</span> kb/s
  Program <span class="token number">1</span>
    Metadata:
      service_name    <span class="token builtin class-name">:</span> Service01
      service_provider: FFmpeg
  Stream <span class="token comment">#0:0[0x100]: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(progressive), 1280x720, 30 fps, 30 tbr, 90k tbn</span>
  Stream <span class="token comment">#0:1[0x101](und): Audio: aac (LC) ([15][0][0][0] / 0x000F), 44100 Hz, stereo, fltp, 4 kb/s</span>
Output <span class="token comment">#0, mp4, to 'output.mp4':</span>
  Metadata:
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0: Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 1280x720, q=2-31, 30 fps, 30 tbr, 90k tbn</span>
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 4 kb/s</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token assign-left variable">frame</span><span class="token operator">=</span>  <span class="token number">250</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">17</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>-1.0 <span class="token assign-left variable">Lsize</span><span class="token operator">=</span>    2596kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:08.28 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span><span class="token number">2565</span>.6kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">0</span>.561x
video:2582kB audio:5kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: <span class="token number">0.355639</span>%
</code></pre> 
<p><font face="Courier New">    因为seekable设置为1，因此FFmpeg可以对HTTP服务进行seek操作，自然不会再有任何异常。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_2headersfont_292"></a><font face="楷体" size="2">    2.headers参数举例</font></h5> 
<p><font face="Courier New">    在使用FFmpeg拉取HTTP数据时，很多时候会遇到需要自己设置HTTP的header的情况，例如使用HTTP传输时在header中设置referer字段等操作，下面就来列举一个设置Referer参数的例子：</font></p> 
<pre><code class="prism language-bash">ffmpeg -headers <span class="token string">"referer: http://192.168.100.10/index.html"</span> -i http://192.168.100.10/input.ts -c copy -f flv -y output.flv
</code></pre> 
<p><font face="Courier New">    执行完这条命令行之后，即可以在HTTP传输时在header中增加referer字段，使用Wireshark抓包可以看到详细信息：</font></p> 
<pre><code class="prism language-bash">    GET /input.ts HTTP/1.1<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    User-Agent: Lavf/59.34.102<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    Accept: */*<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    Range: <span class="token assign-left variable">bytes</span><span class="token operator">=</span><span class="token number">0</span>-<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    Connection: close<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    Host: <span class="token number">120.24</span>.33.118<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    Icy-MetaData: <span class="token number">1</span><span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    <span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    <span class="token punctuation">[</span>Full request URI: http://192.168.100.10/input.ts<span class="token punctuation">]</span>
    <span class="token punctuation">[</span>HTTP request <span class="token number">1</span>/1<span class="token punctuation">]</span>
</code></pre> 
<p><font face="Courier New">    如上述抓包信息所示，在HTTP的header中增加了referer字段，referer的值为http://192.168.100.10/index.html。可见HTTP的headers信息已经设置成功。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_3user_agentfont_311"></a><font face="楷体" size="2">    3.user_agent参数设置</font></h5> 
<p><font face="Courier New">    在使用FFmpeg进行HTTP连接时，所使用的User-Agent也有自己的特殊标识，FFmpeg连接HTTP时采用的默认User-Agent如下所示：</font></p> 
<pre><code class="prism language-bash">GET /live/class.flv HTTP/1.1
User-Agent: Lavf/57.71.100
Accept: */*
Range: <span class="token assign-left variable">bytes</span><span class="token operator">=</span><span class="token number">0</span>-
Connection: close
Host: play.chinaffmpeg.com
Icy-MetaData: <span class="token number">1</span>
</code></pre> 
<p><font face="Courier New">    从协议包中可以看到，FFmpeg使用的默认User-Agent为Lavf。在使用FFmpeg连接HTTP时，为了区分FFmpeg是自己的，可以通过参数user_agent进行设置：</font></p> 
<pre><code class="prism language-bash">ffmpeg -user_agent <span class="token string">"LiuQi's Player"</span> -i http://192.168.100.10/1.flv
</code></pre> 
<p><font face="Courier New">    命令行执行后，User-Agent即被设置为LiuQi’s Player，下面看一下执行后的效果：</font></p> 
<pre><code class="prism language-bash">ffmpeg -user_agent <span class="token string">"LiuQi's Player"</span> -i http://192.168.100.10/1.flv
</code></pre> 
<p><font face="Courier New">    从上述协议包中可以看到，执行效果与预期相同User-Agent设置成功。</font></p> 
<h4><a id="font_face_size3nbspnbsp533_HTTPfont_331"></a><font face="黑体" size="3">  5.3.3 HTTP拉流录制</font></h4> 
<p><font face="Courier New">    粗略地了解了HTTP参数之后，接下来即可对HTTP服务器中的流媒体流进行录制，其不仅可以录制，还可以进行转封装，例如从HTTP传输的FLV直播流录制为HLS（M3U8）、MP4、FLV等，只要录制的封装格式支持流媒体中包含的音视频编码，就可以进行拉流录制。</font></p> 
<h4><a id="font_face_size3nbspnbsp534_HTTPFLVfont_333"></a><font face="黑体" size="3">  5.3.4 拉取HTTP中的流录制FLV</font></h4> 
<p>    <code>1）拉取FLV直播流录制为FLV：</code></p> 
<pre><code class="prism language-bash">ffmpeg -i http://121.23.34.118/123.flv -c copy -f flv output.flv
</code></pre> 
<p>    <code>2）拉取TS直播流录制为FLV：</code></p> 
<pre><code class="prism language-bash">ffmpeg -i http://121.23.34.118/live.ts -c copy -f flv output.flv
</code></pre> 
<p>    <code>3）拉取HLS直播流录制为FLV：</code></p> 
<pre><code class="prism language-bash">ffmpeg -i http://121.23.34.118/live.m3u8 -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    通过以上三个例子可以看到，转封装录制的输出相同，输入略有差别，但均为HTTP传输协议的直播流。</font></p> 
<h3><a id="nbspnbspfont_face_size354_FFmpegUDPTCPfont_347"></a>  <font face="黑体" size="3">5.4 FFmpeg录制和发布UDP/TCP流</font></h3> 
<p><font face="Courier New">    FFmpeg支持流媒体时不仅仅支持RTMP、HTTP这类高层协议，同样也支持UDP、TCP这类底层协议，而且还可以支持UDP、TCP流媒体的录制与发布，下面就来参考一下TCP与UDP支持的相关参数。</font></p> 
<h4><a id="font_face_size3nbspnbsp541_TCPUDPfont_349"></a><font face="黑体" size="3">  5.4.1 TCP与UDP参数说明</font></h4> 
<p><font face="Courier New">    FFmpeg对于TCP与UDP操作也支持很多参数进行组合，可以通过ffmpeg–help full查看FFmpeg支持的UDP与TCP的参数，分别见表。</font><br> <img src="https://images2.imgbox.com/cd/15/OYhS4wSc_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ef/89/yugBmD1t_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_face_size3nbspnbsp542_TCPfont_353"></a><font face="黑体" size="3">  5.4.2 TCP参数使用举例</font></h4> 
<p><font face="Courier New">    使用FFmpeg既可以进行TCP的监听，也可以使用FFmpeg进行TCP的链接请求，使用TCP监听与请求可以是对称方式，下面举几个例子。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_1TCPfont_355"></a><font face="楷体" size="2">    1.TCP监听接收流</font></h5> 
<p><font face="Courier New">    表中介绍了TCP端口监听模式，使用方式如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -listen <span class="token number">1</span> -f flv -i tcp://127.0.0.1:1234/live/stream -c copy -f flv output.flv
</code></pre> 
<p>    <code>执行完命令行之后，FFmpeg会进入端口监听模式，等待客户端连接到本地的1234端口。</code></p> 
<h5><a id="font_face_size2_nbspnbsp_2TCPfont_361"></a><font face="楷体" size="2">    2.TCP请求发布流</font></h5> 
<p><font face="Courier New">    上文介绍了TCP端口监听模式接收流，这里介绍一下FFmpeg请求TCP并发布流，使用方式如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -f flv tcp://127.0.0.1:1234/live/stream
</code></pre> 
<p><font face="Courier New">    前文介绍过TCP监听端口为1234，这里请求的端口即为1234，并且指定输出的格式为FLV格式，因为TCP监听接收流时指定了接收FLV格式的流，下面就来看一下这条命令行执行之后的输出：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Duration: 00:00:35.07, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2661</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2493 kb/s, 30 fps, 30 tbr, 15360 tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Output <span class="token comment">#0, flv, to 'tcp://127.0.0.1:1234/live/stream':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0(und): Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 2493 kb/s, 30 fps, 30 tbr, 1k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) ([10][0][0][0] / 0x000A), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token punctuation">[</span>flv @ 000002998004ffc0<span class="token punctuation">]</span> Failed to update header with correct duration.7.8kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span>   1x
</code></pre> 
<p><font face="Courier New">    输出成功，推流成功，推流格式为FLV，推流地址为tcp://127.0.0.1：1234/live/stream。<br>     当这里发布流成功后，在端口监听一端同样也会有数据的输出，因为在前面介绍端口监听时，输入为FLV格式，输出为output.flv的FLV格式，所以可以在监听一端看到输出信息：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, flv, from 'tcp://127.0.0.1:1234/live/stream':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Duration: 00:00:00.00, start: <span class="token number">0.067000</span>, bitrate: N/A
  Stream <span class="token comment">#0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2493 kb/s, 30 fps, 30 tbr, 1k tbn</span>
  Stream <span class="token comment">#0:1: Audio: aac (LC), 48000 Hz, stereo, fltp, 159 kb/s</span>
Output <span class="token comment">#0, flv, to 'output.flv':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0: Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 2493 kb/s, 30 fps, 30 tbr, 1k tbn</span>
  Stream <span class="token comment">#0:1: Audio: aac (LC) ([10][0][0][0] / 0x000A), 48000 Hz, stereo, fltp, 159 kb/s</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token assign-left variable">frame</span><span class="token operator">=</span> <span class="token number">1052</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">31</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>-1.0 <span class="token assign-left variable">Lsize</span><span class="token operator">=</span>   11404kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:34.98 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span><span class="token number">2670</span>.2kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">1</span>.04x
</code></pre> 
<p><font face="Courier New">    <mark>当监听TCP时指定格式与TCP客户端连接所发布的格式相同时均正常，如果TCP监听的输入格式与TCP客户端连接时所发布的格式不同时，将会出现解析格式异常</mark>，例如将请求发布流时的格式改为MPEGTS格式，监听端将无法正常解析格式而处于“无动于衷”的状态。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_3listen_timeoutfont_430"></a><font face="楷体" size="2">    3.监听端口超时listen_timeout</font></h5> 
<p><font face="Courier New">    监听端口时，默认处于持续监听状态，<code>通过使用listen_timeout可以设置指定时间长度监听超时</code>，例如设置5秒钟超时时间，到达超时时间则退出监听：</font></p> 
<pre><code class="prism language-bash"><span class="token function">time</span> ffmpeg -listen_timeout <span class="token number">5000</span> -listen <span class="token number">1</span> -f flv -i tcp://127.0.0.1:1234/live/stream -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    命令行执行后输出信息如下：</font></p> 
<pre><code class="prism language-bash">real	0m5.110s
user	0m0.001s
sys	0m0.003s
</code></pre> 
<p><font face="Courier New">    从输出的内容中可以看到，超时时间为5秒，5秒钟若未收到任何请求则自动退出监听。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_4TCPtimeoutfont_442"></a><font face="楷体" size="2">    4.TCP拉流超时参数timeout</font></h5> 
<p><font face="Courier New">    使用TCP拉取直播流时，常常会遇到TCP服务器端没有数据却不主动断开连接的情况，导致客户端持续处于连接状态不断开，通过设置timeout参数可以解决这个问题。例如拉取一个TCP服务器中的流数据，若超过20秒没有数据则退出，实现方式如下：</font></p> 
<pre><code class="prism language-bash"><span class="token function">time</span> ./ffmpeg -timeout <span class="token number">20000000</span> -i tcp://127.0.0.1:1935/live/stream -c copy -f flv output.flv
</code></pre> 
<p><font face="Courier New">    这条命令行设置超时时间为20秒，连接TCP拉取端口1935的数据，如果超过20秒没有收到数据则自动退出，命令行执行后的效果如下：</font></p> 
<pre><code class="prism language-bash">real	0m20.139s
user	0m0.004s
sys	0m0.004s
</code></pre> 
<p><font face="Courier New">    <code>从以上输出的内容中可以看到，命令行执行耗时时长为20秒，设置超时时间生效</code>。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_5TCPbuffersend_buffer_sizerecv_buffer_sizefont_454"></a><font face="楷体" size="2">    5.TCP传输buffer大小设置send_buffer_size/recv_buffer_size</font></h5> 
<p><font face="Courier New">    <code>在TCP参数列表中可以看到send_buffer_size与recv_buffer_size参数，这两个参数的作用是设置TCP传输时buffer的大小，buffer设置得越小，传输就会越频繁，网络开销就会越大</code>：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -send_buffer_size <span class="token number">265</span> -f flv tcp://127.0.0.1:1234/live/stream
</code></pre> 
<p><font face="Courier New">    执行完这条命令行之后输出速度将会变慢，因为数据发送的buffer大小变成了265，数据发送的频率变大，并且次数变多，网络的开销也变大，所以输出速度会变慢，命令行执行后相关的输出信息如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Duration: 00:01:10.47, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2507</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 1280x720, 2496 kb/s, 30 fps, 30 tbr, 16k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 2 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Output <span class="token comment">#0, flv, to 'tcp://127.0.0.1:1234/live/stream':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Stream <span class="token comment">#0:0(und): Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(progressive), 1280x720, q=2-31, 2496 kb/s, 30 fps, 30 tbr, 1k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) ([10][0][0][0] / 0x000A), 44100 Hz, stereo, fltp, 2 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token punctuation">[</span>flv @ 0x35f5dc0<span class="token punctuation">]</span> Failed to update header with correct duration.ate<span class="token operator">=</span><span class="token number">2511</span>.3kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span>   1x   
</code></pre> 
<p><font face="Courier New">    从FFmpeg执行过程的内容中可以看到速度降低了，不仅仅是输出速度降低了，输出帧率也降低了。Data的大小为265字节，参数send_buffer_size设置成功。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_6UDPlocalportfont_497"></a><font face="楷体" size="2">    6.绑定本地UDP端口localport</font></h5> 
<p><font face="Courier New">    <code>使用FFmpeg的UDP传输数据时，默认会由系统分配本地端口，使用localport参数时可以设置监听本地端口</code>：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -localport <span class="token number">23456</span> -f flv udp://192.168.100.179:1234/live/stream
</code></pre> 
<p><font face="Courier New">    命令行执行后可以看到相关输出如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Duration: 00:01:10.47, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2507</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 1280x720, 2496 kb/s, 30 fps, 30 tbr, 16k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 2 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Output <span class="token comment">#0, flv, to 'udp://127.0.0.1:1234/live/stream':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Stream <span class="token comment">#0:0(und): Video: h264 (High) ([7][0][0][0] / 0x0007), yuv420p(progressive), 1280x720, q=2-31, 2496 kb/s, 30 fps, 30 tbr, 1k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) ([10][0][0][0] / 0x000A), 44100 Hz, stereo, fltp, 2 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (copy)</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (copy)</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
<span class="token punctuation">[</span>flv @ 0x2b3fdc0<span class="token punctuation">]</span> Failed to update header with correct duration.ate<span class="token operator">=</span><span class="token number">2511</span>.6kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span>   1x
</code></pre> 
<p><font face="Courier New">    输出的时候可以使用netstat查看，也可以使用Wireshark抓取UDP包进行确认，UDP的Source Port已经成功设置为23456，可见localport参数设置生效。</font></p> 
<h4><a id="font_face_size3nbspnbsp543_TCPUDPfont_540"></a><font face="黑体" size="3">  5.4.3 TCP/UDP使用小结</font></h4> 
<p><font face="Courier New">    <code>FFmpeg的TCP与UDP传输常见于TCP或者UDP的网络裸传输场景。</code></font></p> 
<h3><a id="nbspnbspfont_face_size355_FFmpegfont_542"></a>  <font face="黑体" size="3">5.5 FFmpeg推多路流</font></h3> 
<p><font face="Courier New">    早期FFmpeg在转码后输出直播流时并不支持编码一次之后同时输出多路直播流，需要使用管道方式进行输出，而在新版本的FFmpeg中已经<code>支持tee文件封装及协议输出</code>，可以使用tee进行多路流输出，本节将主要讲解<code>管道方式输出多路流</code>与<code>tee协议输出方式输出多路流</code>。</font></p> 
<h4><a id="font_face_size3nbspnbsp551_font_544"></a><font face="黑体" size="3">  5.5.1 管道方式输出多路流</font></h4> 
<p><font face="Courier New">    使用FFmpeg进行编码与转封装，编码消耗的资源比较多，转封装则相对较少，很多时候只需要转一次编码并且输出多个封装，早期FFmpeg本身并不支持这么做，尤其是一次转码多次输出RTMP流等操作，而是通过使用系统管道的方式进行操作，方式如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i input -acodec aac -vcodec libx264 -f flv - <span class="token operator">|</span> ffmpeg -f mpegts -i - -c copy output1 -c copy output2 -c copy output3
</code></pre> 
<p><font face="Courier New">    从命令行格式中可以看到，<code>音频编码为AAC，视频编码为libx264，输出格式为FLV</code>，然后输出之后通过管道传给另一条ffmpeg命令，另一条ffmpeg命令直接执行对codec的copy即可实现一次编码多路输出：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i input.mp4 -vcodec libx264 -acodec aac -f flv - <span class="token operator">|</span> ffmpeg -f flv -i - -c copy -f flv rtmp://127.0.0.1:1935/myapp/stream1 -c copy -f flv rtmp://127.0.0.1:1935/myapp/stream2
</code></pre> 
<p><font face="Courier New">    执行完这条命令之后，将会在RTMP服务器127.0.0.1中包含两路直播流，一路为stream1，另外一路为stream2，两路直播流的信息相同，下面用FFmpeg验证一下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i rtmp://127.0.0.1:1935/myapp/stream1  -i rtmp://127.0.0.1:1935/myapp/stream2
</code></pre> 
<p><font face="Courier New">    如上述输出内容所示，两路直播流信息几乎一样，因为在编码推流时采用的是一次编码，多次输出支持所得到的流。</font></p> 
<h4><a id="font_face_size3nbspnbsp552_teefont_558"></a><font face="黑体" size="3">  5.5.2 tee封装格式输出多路流</font></h4> 
<p><font face="Courier New">    FFmpeg输出时支持tee封装格式输出，使用<code>-f tee</code>方式制定输出格式即可，下面就来看一下tee封装格式一次编码多路输出的方式：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i input.flv -acodec aac -vcodec h264 -f <span class="token function">tee</span> -map <span class="token number">0</span>:v -map <span class="token number">0</span>:a <span class="token string">"tee1.mp4|tee2.flv"</span>
<span class="token comment"># 1. 单路输入，输出一路mp4本地，一路TS over UDP (其中TS over UDP需要指定格式)</span>
ffmpeg -re -i input.mp4 -acodec aac -vcodec h264 -f <span class="token function">tee</span> -map <span class="token number">0</span>:v -map <span class="token number">0</span>:a <span class="token string">"tee1.mp4|[f=mpegts]udp://121.24.33.118:1514"</span>
<span class="token comment"># 2. 使用ffmpeg进行编码，实现单路输入，四路输出（一路rtmp,一路ts，一路mp4,一路aac）。</span>
ffmpeg -re -i input.mp4 -acodec aac -vcodec h264 -flags +global_header -strict experimental -f <span class="token function">tee</span> -map <span class="token number">0</span>:v -map <span class="token number">0</span>:a <span class="token string">"[f=flv]rtmp://121.24.33.118:1935/myapp/hls|[bsfs/v=dump_extra]out.ts|[movflags=+faststart]out.mp4|[select=a]out.aac"</span>
ffmpeg -re -i input.mp4 -vcodec libx264 -acodec aac -map <span class="token number">0</span> -flags +global_header -strict experimental -f <span class="token function">tee</span> <span class="token string">"[f=flv]rtmp://121.24.33.118:1935/myapp/stream1 | [f=flv]rtmp://121.24.33.118:1935/myapp/stream2"</span>
</code></pre> 
<p><font face="Courier New">    执行完命令行之后，ffmpeg编码一次，输出tee封装格式，格式中包含两个FLV格式的RTMP流，一路为stream1，另一路为stream2。执行后的输出信息如下：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Duration: 00:00:35.07, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2661</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2493 kb/s, 30 fps, 30 tbr, 15360 tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (h264 (native) -&gt; h264 (libx264))</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (aac (native) -&gt; aac (native))</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
Output <span class="token comment">#0, tee, to '[f=flv]rtmp://121.24.33.118:1935/myapp/stream1 | [f=flv]rtmp://121.24.33.118:1935/myapp/stream2':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0(und): Video: h264, yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 30 fps, 30 tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 libx264
    Side data:
      cpb: bitrate max/min/avg: <span class="token number">0</span>/0/0 buffer size: <span class="token number">0</span> vbv_delay: N/A
  Stream <span class="token comment">#0:1(und): Audio: aac (LC), 48000 Hz, stereo, fltp, 128 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 aac
<span class="token assign-left variable">frame</span><span class="token operator">=</span> <span class="token number">1052</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">30</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>-1.0 <span class="token assign-left variable">Lsize</span><span class="token operator">=</span>N/A <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:34.98 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span>N/A <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">0</span>.981x
</code></pre> 
<p><font face="Courier New">    从上述输出内容中可以看到，使用<code>tee封装格式推多路RTMP流成功</code>，接下来可以验证服务器端是否存在两路相同的直播RTMP流：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i rtmp://121.24.33.118:1935/myapp/stream1  -i rtmp://121.24.33.118:1935/myapp/stream2
</code></pre> 
<p><font face="Courier New">    经过验证，确认使用tee推流成功，现在流媒体服务器中存在两路相同的直播流。</font></p> 
<h4><a id="font_face_size3nbspnbsp553_teefont_614"></a><font face="黑体" size="3">  5.5.3 tee协议输出多路流</font></h4> 
<p><font face="Courier New">    FFmpeg在3.1.3版本之后支持tee协议输出多路流，使用方式比前文介绍的FFmpeg配合管道与tee封装格式更简单，下面详细举例说明：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -vcodec libx264 -acodec aac -f flv <span class="token string">"tee:rtmp://publish.chinaffmpeg.com/live/stream1|rtmp://publish.chinaffmpeg.com/live/stream2"</span>
</code></pre> 
<p><font face="Courier New">    执行命令行之后，<code>FFmpeg执行了一次编码，然后输出为tee协议格式，tee中包含了两个子链接，协议全部为RTMP，输出两路RTMP流，一路为stream1，另一路为stream2</code>：</font></p> 
<pre><code class="prism language-bash">Input <span class="token comment">#0, mov,mp4,m4a,3gp,3g2,mj2, from 'input.mp4':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.27.100
  Duration: 00:00:35.07, start: <span class="token number">0.000000</span>, bitrate: <span class="token number">2661</span> kb/s
  Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 2493 kb/s, 30 fps, 30 tbr, 15360 tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 159 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Stream mapping:
  Stream <span class="token comment">#0:0 -&gt; #0:0 (h264 (native) -&gt; h264 (libx264))</span>
  Stream <span class="token comment">#0:1 -&gt; #0:1 (aac (native) -&gt; aac (native))</span>
Press <span class="token punctuation">[</span>q<span class="token punctuation">]</span> to stop, <span class="token punctuation">[</span>?<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span>
Output <span class="token comment">#0, flv, to 'tee:rtmp://120.24.33.118:1935/myapp/stream1|rtmp://120.24.33.118:1935/myapp/hls':</span>
  Metadata:
    major_brand     <span class="token builtin class-name">:</span> isom
    minor_version   <span class="token builtin class-name">:</span> <span class="token number">512</span>
    compatible_brands: isomiso2avc1mp41
    encoder         <span class="token builtin class-name">:</span> Lavf59.34.102
  Stream <span class="token comment">#0:0(und): Video: h264 ([7][0][0][0] / 0x0007), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 30 fps, 1k tbn (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> VideoHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 libx264
    Side data:
      cpb: bitrate max/min/avg: <span class="token number">0</span>/0/0 buffer size: <span class="token number">0</span> vbv_delay: N/A
  Stream <span class="token comment">#0:1(und): Audio: aac (LC) ([10][0][0][0] / 0x000A), 48000 Hz, stereo, fltp, 128 kb/s (default)</span>
    Metadata:
      handler_name    <span class="token builtin class-name">:</span> SoundHandler
      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      encoder         <span class="token builtin class-name">:</span> Lavc59.54.100 aac
<span class="token punctuation">[</span>flv @ 000001d3122202c0<span class="token punctuation">]</span> Failed to update header with correct duration.9.6kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">0</span>.998x
</code></pre> 
<p><font face="Courier New">    如上述输出内容所示，推流成功，两路直播流相同与否，可以通过验证<code>FFmpeg配合管道的方式或验证tee封装支持的方式进行检测</code>，结果将会是相同的。</font></p> 
<h3><a id="nbspnbspfont_face_size356_FFmpegHDSfont_661"></a>  <font face="黑体" size="3">5.6 FFmpeg生成HDS流</font></h3> 
<p><font face="Courier New">    FFmpeg支持文件列表方式的切片直播、点播流，除了HLS之外，还支持HDS流切片格式，使用FFmpeg可以生成HDS切片。</font></p> 
<h4><a id="font_face_size3nbspnbsp561_HDSfont_663"></a><font face="黑体" size="3">  5.6.1 HDS参数说明</font></h4> 
<p><font face="Courier New">    使用<code>ffmpeg -h muxer=hds</code>可以得到HDS的参数列表，下面就来看一下HDS相关的操作参数都有哪些。</font><br> <img src="https://images2.imgbox.com/4d/6e/mEaxUPmh_o.png" alt="在这里插入图片描述"><br> <font face="Courier New">    如表所示，FFmpeg中做HDS格式封装主要包含四个参数，分别为<mark>HDS切片信息窗口大小、HDS切片信息窗口之外保留的切片文件个数、最小切片时间、在HDS封装结束时删除所有文件</mark>。下面就来对这些参数进行举例说明。</font></p> 
<h4><a id="font_face_size3nbspnbsp562_HDSfont_667"></a><font face="黑体" size="3">  5.6.2 HDS使用举例</font></h4> 
<p><font face="Courier New">    由于FFmpeg生成HDS文件与HLS类似，既可以生成点播文件列表，也可以生成直播文件列表；既可以保留历史文件，也可以刷新历史文件窗口大小，以上这些操作均可以通过参数进行控制。</font></p> 
<h5><a id="font_face_size2_nbspnbsp_1window_sizefont_669"></a><font face="楷体" size="2">    1.window_size参数控制文件列表大小</font></h5> 
<p><font face="Courier New">    设置HDS为直播模式时，需要实时更新列表，可以通过<code>window_size</code>参数控制文件列表窗口大小，例如HDS文件列表中只保存4个文件，通过设置window_size即可实现，下面举例说明：</font></p> 
<pre><code class="prism language-bash">ffmpeg -i input -c copy -f hds -window_size <span class="token number">4</span> output
</code></pre> 
<p><font face="Courier New">    执行完以上命令行之后，会生成output目录，目录下面包含三种文件，具体如下。<br>     <code>·index.f4m：索引文件</code>，主要为F4M参考标准中mainfest相关、Metadata信息等<br>     <code>·stream0.abst：文件流相关描述信息</code><br>     <code>·stream0Seg1-Frag：相似规则文件切片</code>，文件切片中均为mdat信息<br>     生成output目录信息如下：</font><br> <img src="https://images2.imgbox.com/cd/da/YzpC9JvB_o.png" alt=""><br>     <code>使用window_size控制列表大小生效，默认不控制生成列表的大小。</code></p> 
<h5><a id="font_face_size2_nbspnbsp_2extra_window_sizefont_681"></a><font face="楷体" size="2">    ;2.extra_window_size参数控制文件个数</font></h5> 
<p><font face="Courier New">    在控制window_size之后，HLS切片的情况与之类似，列表之外的文件会有一些残留，通过使用<code>extra_window_size</code>可以控制残留文件个数：<br>     将extra_window_size设置为1，则会在window_size之外多留一个历史文件，下面就来执行命令行测试一下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c copy -f hds -window_size <span class="token number">4</span> -extra_window_size <span class="token number">1</span> output
</code></pre> 
<p><font face="Courier New">    命令行执行之后，将会在output目录生成HDS文件，这要比window_size规定的窗口大小之外多出来1个文件，下面就来看一下效果：</font><br> <img src="https://images2.imgbox.com/38/a9/HjJ0fElL_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="font_face_size2_nbspnbsp_3font_689"></a><font face="楷体" size="2">    3.其他参数</font></h5> 
<p><font face="Courier New">    <code>remove_at_exit</code>参数在FFmpeg退出时会删除所有生成的文件，如果min_frag_duration参数的值设置得比较小并且设置在使用codec copy时不会有效果，则需要在重新编码时将GOP间隔设置得比min_frag_duration时间短即可。</font></p> 
<h3><a id="nbspnbspfont_face_size357_FFmpegDASHfont_691"></a>  <font face="黑体" size="3">5.7 FFmpeg生成DASH流</font></h3> 
<p><font face="Courier New">    列表类型直播除了HLS与HDS之外，还有一种比较流行的列表方式是<code>DASH方式直播</code>，下面就来介绍一下FFmpeg的DASH参数。</font></p> 
<h4><a id="font_face_size3nbspnbsp571_DASHfont_693"></a><font face="黑体" size="3">  5.7.1 DASH参数说明</font></h4> 
<p><font face="Courier New">    使用<code>ffmpeg -h muxer=dash</code>可以得到DASH的参数列表，下面就来看一下DASH都有哪些相关操作的参数，具体见表。</font><br> <img src="https://images2.imgbox.com/4a/9f/E9iWrs2D_o.png" alt="在这里插入图片描述"><br> <font face="Courier New">    从表中可以看出，对于DASH的封装操作FFmpeg所支持的参数稍微多一些，例如除了与HDS相似的参数之外，还可以<code>支持单文件模式</code>，<code>是否使用timeline模式</code>，<code>设置切片名等操作</code>，下面就来举例说明对DASH封装操作的常见参数。</font></p> 
<h4><a id="font_face_size3nbspnbsp572_DASHfont_697"></a><font face="黑体" size="3">  5.7.2 DASH参数使用举例</font></h4> 
<h5><a id="font_face_size2_nbspnbsp_1window_sizeextra_window_sizefont_698"></a><font face="楷体" size="2">    1.window_size与extra_window_size参数举例</font></h5> 
<p><font face="Courier New">    与HDS设置类似，DASH参数设置同样可以支持window_size与extra_window_size参数设置列表中的切片个数与列表外切片的保留个数，设置方式如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c:v copy -acodec copy -f dash -window_size <span class="token number">4</span> -extra_window_size <span class="token number">5</span> index.mpd
</code></pre> 
<p><font face="Courier New">    执行完命令行之后会生成文件索引列表index.mpd，文件列表长度为4个切片长度，切片之外会保留5个切片，在DASH直播格式中，音视频是分开切片的，也就是说视频是一路切片，音频是一路切片，即音频切片文件会有9个，视频切片文件会有9个，其中包含了2个初始化信息切片，1个索引文件，可以参考如下信息：</font><br> <img src="https://images2.imgbox.com/fd/c1/FfNnrCGr_o.png" alt=""></p> 
<h5><a id="font_face_size2_nbspnbsp_2single_filefont_705"></a><font face="楷体" size="2">    2.single_file参数举例</font></h5> 
<p><font face="Courier New">    FFmpeg支持生成DASH时将切片列表中的文件写入到一个文件，使用single_file参数即可，参考命令行如下：</font></p> 
<pre><code class="prism language-bash">ffmpeg -re -i input.mp4 -c:v copy -acodec copy -f dash -window_size <span class="token number">4</span> -extra_window_size <span class="token number">5</span> -single_file <span class="token number">1</span> index.mpd
</code></pre> 
<p><font face="Courier New">    执行命令行之后，目录中将会生成3个文件：1个索引文件、1个音频文件、1个视频文件，可参考的信息如下：</font><br> <img src="https://images2.imgbox.com/cb/05/G7SgZJY1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="nbspnbspfont_face_size358_font_712"></a>  <font face="黑体" size="3">5.8 小结</font></h3> 
<p><font face="Courier New">    FFmpeg对流媒体的支持非常广泛，本章重点介绍<code>RTMP、RTSP、TCP、UDP、HLS、HDS、DASH</code>相关的支持情况，主要以推流、生成为主，以及对FFmpeg支持的HTTP传输参数做简略的分析，阅读完本章之后，将会对流媒体协议有一个基本的了解，并能够使用工具进行常规的媒体信息分析。</font></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aaa2abd794b2622aa48643588dd9a53d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">visual studio native c&#43;&#43;单元测试及输出</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f62ff2bbb76d118859ace793460e981/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio报错：Error:Could not find com.android.tools.build:gradle:4.1 记一次不长记性的坑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>