<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gitlab与Jenkins构建CICD环境 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Gitlab与Jenkins构建CICD环境" />
<meta property="og:description" content="一、概述 1、CI 持续集成 持续集成：持续集成(continuous integration)是指开发者在代码开发过程中，可以频繁将代码部署集成到主干，并进行自动化测试
持续交付：是指在持续集成的基础之上，将代码部署到预生产环境
持续部署：在持续交付的基础之上，把部署到生产环境的过程自动化
2、持续集成流程 1、开发者将新版本 push 到 Gitlab
2、Gitlab 随后触发 jenkins master 节点进行一次 build。(或者通过 web hook 定时检测)
3、jenkins master 节点将这个 build 任务分配给若干个注册的 slave 结点中的一个，这个 slave 结 点根据一个事先设置好的脚本进行 build。这个脚本可以做的事情很多，比如编译，测试，生成测试报告等等。这些原本需要手动完成的任务都可以交给 jenkins 来做
4、我们在 build 中要进行编译，这里使用了分布式编译器 distcc 来加快编译速度
3、CICD流程 gitlab 创建代码项目 &gt;&gt;&gt; gitlab 部署公钥 &gt;&gt;&gt; jenkins 安装插件 &gt;&gt;&gt; 创建新项目 &gt;&gt;&gt; 绑定私钥 &gt;&gt;&gt; 添加触发器 &gt;&gt;&gt; 测试部署 &gt;&gt;&gt; 增加 Build Pipeline 插件以流程图的形式展示各个 Job 的顺序
4、Jenkins Jenkins 概述：是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能
官方地址：Jenkins
5、GitLab和GitHub的区别 相同点:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/753eb30a1d01c55ebde7e9cba4dbd9a7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-04T16:38:21+08:00" />
<meta property="article:modified_time" content="2022-03-04T16:38:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Gitlab与Jenkins构建CICD环境</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2> 一、概述</h2> 
<h4>1、CI 持续集成</h4> 
<blockquote> 
 <p><strong>持续集成：</strong>持续集成(<strong>continuous integration</strong>)是指开发者在代码开发过程中，可以频繁将代码部署集成到主干，并进行自动化测试<br><strong>持续交付：</strong>是指在持续集成的基础之上，将代码部署到预生产环境<br><strong>持续部署：</strong>在持续交付的基础之上，把部署到生产环境的过程自动化</p> 
</blockquote> 
<h4 id="持续集成流程：">2、持续集成流程</h4> 
<blockquote> 
 <p><strong>1、</strong>开发者将新版本 <strong>push </strong>到 <strong>Gitlab</strong><br><strong>2、Gitlab</strong> 随后触发 jenkins master 节点进行一次 <strong>build</strong>。(或者通过 <strong>web</strong> <strong>hook </strong>定时检测)<br><strong>3、jenkins master </strong>节点将这个 <strong>build</strong> 任务分配给若干个注册的 <strong>slave </strong>结点中的一个，这个 <strong>slave </strong>结 点根据一个事先设置好的脚本进行 <strong>build</strong>。这个脚本可以做的事情很多，比如编译，测试，生成测试报告等等。这些原本需要手动完成的任务都可以交给 <strong>jenkins </strong>来做<br><strong>4、</strong>我们在 <strong>build </strong>中要进行编译，这里使用了分布式编译器 <strong>distcc </strong>来加快编译速度</p> 
</blockquote> 
<h4>3、CICD流程</h4> 
<blockquote> 
 <p><strong><code>gitlab</code></strong> 创建代码项目  &gt;&gt;&gt;  <strong><code>gitlab</code> </strong>部署公钥  &gt;&gt;&gt;  <strong><code>jenkins</code> </strong>安装插件  &gt;&gt;&gt;  创建新项目   &gt;&gt;&gt;  绑定私钥  &gt;&gt;&gt;  添加触发器  &gt;&gt;&gt;  测试部署  &gt;&gt;&gt;  增加 <strong>Build Pipeline </strong>插件以流程图的形式展示各个 <strong>Job </strong>的顺序</p> 
</blockquote> 
<h4 id="jenkins">4、Jenkins</h4> 
<blockquote> 
 <p><strong><code>Jenkins</code> 概述：</strong>是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能</p> 
</blockquote> 
<p>官方地址：<a href="https://www.jenkins.io/" rel="nofollow" title="Jenkins">Jenkins</a></p> 
<h4>5、GitLab和GitHub的区别</h4> 
<blockquote> 
 <p><strong>相同点:</strong><br> 二者都是基于<strong>web</strong>的<strong>Git</strong>仓库，在很大程度上 <strong>GitLab </strong>是仿照 <strong>GitHub</strong> 来做的，它们都提供了分享开源项目的平台，为开发团队提供了存储、分享、发布和合作开发项目的中心化于存储的场所。</p> 
</blockquote> 
<blockquote> 
 <p><strong>不同点：<br> 1、GitHub</strong> 如果要使用私有仓库，是需要付费的。<strong>GitLab</strong>可以在上面创建私人的免费仓库。<br><strong>2、GitLab </strong>让开发团队对他们的代码仓库拥有更多的控制，相比于 <strong>GitHub</strong>，它有不少的特色：允许 免费设置仓库权限；允许用户选择分享一个 <strong>project </strong>的部分代码；允许用户设置 <strong>project</strong> 的获取权限，进一步的提升安全性；可以设置获取到团队整体的改进进度通过 <strong>innersourcing</strong>让不在权限范围内的人访问不到该资源。</p> 
</blockquote> 
<blockquote> 
 <p><strong>总结：</strong>从代码私有性（<strong>安全性</strong>）方面来看，有时公司并不希望员工获取到全部的代码，这个时候 <strong>GitLab</strong>无疑是更好的选择。但对于开源项目而言，<strong>GitHub </strong>依然是代码托管的首选</p> 
</blockquote> 
<h4>6、对比</h4> 
<blockquote> 
 <p><strong><code>git</code> ：</strong>是一种版本控制系统，是一个命令，是一种工具<br><strong><code>gitlib</code> ：</strong>是用于实现 <strong>git </strong>功能的开发库<br><strong><code>github</code> ：</strong>是一个基于 <strong>git </strong>实现的在线代码托管仓库，包含一个网站界面，向互联网开放<br><strong><code>gitlab</code> ：</strong>是一个基于 <strong>git</strong> 实现的在线代码仓库托管软件，一般用于在企业内部网络搭 git私服</p> 
</blockquote> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>注意：</strong></span> <strong><code>gitlab-ce</code></strong> 社区版 ； <strong><code>gitlab-ee</code> </strong>是企业版，收费</p> 
</blockquote> 
<h2>二、部署Gitlab</h2> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><thead><tr><th style="text-align:center;">系统</th><th style="text-align:center;">IP</th><th style="text-align:center;">主机名</th><th style="text-align:center;">角色</th></tr></thead><tbody><tr><td style="text-align:center;">CentOS 7.4</td><td style="text-align:center;">192.168.2.14</td><td style="text-align:center;">Gitlab</td><td style="text-align:center;">Gitlab</td></tr><tr><td style="text-align:center;">CentOS 7.4</td><td style="text-align:center;">192.168.2.15</td><td style="text-align:center;">jenkins</td><td style="text-align:center;">jenkins</td></tr><tr><td style="text-align:center;">CentOS 7.4</td><td style="text-align:center;">192.168.2.16</td><td style="text-align:center;">Apache</td><td style="text-align:center;">Apache（web）</td></tr><tr><td style="text-align:center;">windows 7</td><td style="text-align:center;">192.168.2.50</td><td style="text-align:center;">wind</td><td style="text-align:center;">客户端</td></tr></tbody></table> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>注意：</strong></span><strong>Gitlab</strong>主机内存  <strong>≥ 4G</strong> ，不然后面会报错（内存5G，CPU 6）</p> 
</blockquote> 
<p> 清华大学镜像站：<a class="link-info" href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/" rel="nofollow" title="https://mirrors.tuna.tsinghua.edu,cn/gitlab-ce/yum/el7/">https://mirrors.tuna.tsinghua.edu,cn/gitlab-ce/yum/el7/</a></p> 
<pre><code>GitLab包含软件：

alertmanager
gitaly
gitlab-exporter
gitlab-workhorse
grafana
logrotate
nginx
node-exporter
postgres-exporter
postgresql
prometheus
redis
redis-exporter
sidekiq
unicorn</code></pre> 
<blockquote> 
 <p><strong> 安装前需要设置好网卡可以上网</strong></p> 
</blockquote> 
<p><strong>配置</strong><strong>防火墙</strong></p> 
<pre><code>
[root@Gitlab ~]# iptables -F                      #清空规则             
[root@Gitlab ~]# systemctl stop firewalld         
[root@Gitlab ~]# systemctl disable firewalld        

禁止防火墙，就不用执行下面两条命令：
[root@Gitlab ~]# firewall-cmd --permanent --add-service=http              
[root@Gitlab ~]# systemctl reload firewalld               </code></pre> 
<p><strong>时间同步服务器</strong></p> 
<pre><code>
[root@Gitlab ~]# yum -y install ntp              
......
[root@Gitlab ~]# sed -i '/^server/s/^/#/g' /etc/ntp.conf               
[root@Gitlab ~]# cat &lt;&lt;END &gt;&gt;/etc/ntp.conf        
server 127.127.1.0
fudge 127.127.1.0 stratum 8
END           

[root@Gitlab ~]# ntpdate time.nist.gov               
11 Feb 17:27:25 ntpdate[73029]: adjust time server 128.138.141.172 offset 0.004230 sec

[root@Gitlab ~]# systemctl restart ntpd         
[root@Gitlab ~]# systemctl enable ntpd              
Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</code></pre> 
<h3>（一）、安装Gitlab</h3> 
<pre><code>
[root@Gitlab ~]# yum install -y policycoreutils-python                     #安装依赖               
.........
[root@Gitlab ~]# rpm -ivh gitlab-ce-14.7.2-ce.0.el7.x86_64.rpm             #上传rpm包
.......
[root@Gitlab ~]# vim /etc/gitlab/gitlab.rb                                 #修改 gitlab 外部访问地址；可以修改为IP地址，也可以修改为自定义的gitlab域名
.........
  32 external_url 'http://192.168.2.14
...
保存
[root@Gitlab ~]# gitlab-ctl reconfigure                                    #初始化gitlab，会重置为最原始的配置
...........
.....
gitlab Reconfigured!

[root@Gitlab ~]# gitlab-ctl status                                         #查看状态
........
..
[root@Gitlab ~]# netstat -anptu| grep 80                                   #默认使用nginx做为web界面
tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      10439/puma 5.5.2 (u 
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      10757/nginx: master 




</code></pre> 
<blockquote> 
 <p>访问测试：192.168.2.14</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="751" src="https://images2.imgbox.com/89/0c/lbIMAWOg_o.png" width="1200"></p> 
<blockquote> 
 <p> 访问成功后发现需要用户和密码在 <strong>Gitlab </strong>中 默认有 <strong>root </strong>用户但是密码是自动生成的接下来进行重置密码</p> 
</blockquote> 
<h3>（二）、重置密码</h3> 
<h4>1、进入控制台</h4> 
<pre><code>
[root@Gitlab ~]# gitlab-rails console              </code></pre> 
<h4>2、查询root用户账号信息并赋值给u</h4> 
<pre><code>
irb(main):001:0&gt; u=User.where(id:1).first               
=&gt; #&lt;User id:1 @root&gt;</code></pre> 
<h4>3、设置密码</h4> 
<pre><code>
irb(main):002:0&gt; u.password=12345678           #root用户密码设置为12345678
=&gt; 12345678
</code></pre> 
<h4>4、确认密码</h4> 
<pre><code>
irb(main):003:0&gt; u.password_confirmation=12345678                   
=&gt; 12345678
</code></pre> 
<h4>5、保存设置</h4> 
<pre><code>
irb(main):004:0&gt; u.save!               
=&gt; true
</code></pre> 
<h4> 6、退出控制台</h4> 
<pre><code>exit</code></pre> 
<h4>7、重启GitLab</h4> 
<pre><code>
[root@Gitlab ~]# gitlab-ctl restart              
</code></pre> 
<blockquote> 
 <p>访问<strong>GitLab</strong>页面输入用户名<strong>root</strong>和你新设置的密码，登录成功则可进入到<strong>GitLab</strong>主页。</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="773" src="https://images2.imgbox.com/93/5f/JvLCVbla_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="629" src="https://images2.imgbox.com/7d/13/JrXnMOAJ_o.png" width="1200"></p> 
<h3> （三）、Gitlab的命令</h3> 
<pre><code>
gitlab-ctl stop                           #关闭 gitlab

gitlab-ctl start                          #启动 gitlab 

gitlab-ctl restart                        #重启 gitlab

systemctl restart gitlab-runsvdir         #gitlab启动报warning: redis: unable to open supervise/ok: file does not exist

GitLab的配置文件：/etc/gitlab/gitlab.rb 	       #可以自定义一些邮件服务等
日志地址：/var/log/gitlab/                      #对应各服务
服务地址：/var/opt/gitlab/                      #对应各服务的主目录 
仓库地址：/var/opt/gitlab/git-data              #记录项目仓库等提交信息

sudo gitlab-ctl tail                           #查看所有的logs; 按 Ctrl-C 退出         

sudo gitlab-ctl tail gitlab-rails              #拉取/var/log/gitlab下子目录的日志

sudo gitlab-ctl tail nginx/gitlab_error.log    #拉取某个指定的日志文件

gitlab-rake gitlab:check SANITIZE=true --trace #检查gitlab</code></pre> 
<h3>（四）、关闭 gitlab的注册功能</h3> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">默认情冴下可以直接注册账号，我们不需要注册功能，可以关闭</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="805" src="https://images2.imgbox.com/54/34/LmD6YokK_o.png" width="1200"></p> 
<p><img alt="" height="816" src="https://images2.imgbox.com/50/1b/Zj4HBXKy_o.png" width="1200"></p> 
<blockquote> 
 <p> <strong>最后保存更改；退出登录后再次查看已经没有注册提示了</strong></p> 
</blockquote> 
<p><img alt="" height="848" src="https://images2.imgbox.com/bb/1e/Jw9l6tQI_o.png" width="1200"></p> 
<h3> （五）、配置邮箱报警</h3> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>linux</strong>运维最注重的一点就是告警邮件，所以<strong>Gitlab</strong>一样提供了邮件发送的功能。使用默认设置可能收不到邮件，这里使用第三方<strong>SMTP</strong>服务器</p> 
</blockquote> 
<p>在官方有各种邮箱配置实例：<a href="https://docs.gitlab.com/omnibus/settings/smtp.html" rel="nofollow" title="SMTP settings | GitLab">SMTP settings | GitLab</a></p> 
<h4>1、修改配置文件</h4> 
<blockquote> 
 <p>这里我使用的是QQ邮箱</p> 
</blockquote> 
<pre><code>
[root@Gitlab ~]# vim /etc/gitlab/gitlab.rb            #在112行后面插入以下内容
...............
 113 gitlab_rails['smtp_enable'] = true
 114 gitlab_rails['smtp_address'] = "smtp.qq.com"
 115 gitlab_rails['smtp_port'] = 465
 116 gitlab_rails['smtp_user_name'] = "1234567890@qq.com"
 117 gitlab_rails['smtp_password'] = "邮箱授权码  不是邮箱密码"
 118 gitlab_rails['smtp_authentication'] = "login"
 119 gitlab_rails['smtp_enable_starttls_auto'] = true
 120 gitlab_rails['smtp_tls'] = true
 121 gitlab_rails['gitlab_email_from'] = '1234567890@qq.com'
.........
....
保存</code></pre> 
<pre><code>
[root@Gitlab ~]# gitlab-ctl reconfigure                #初始化gitlab
...........
....
[root@Gitlab ~]# gitlab-rails console                  #登陆控制台
--------------------------------------------------------------------------------
 Ruby:         ruby 2.7.5p203 (2021-11-24 revision f69aeb8314) [x86_64-linux]
 GitLab:       14.7.2 (89599212ee6) FOSS
 GitLab Shell: 13.22.2
 PostgreSQL:   12.7
--------------------------------------------------------------------------------
Loading production environment (Rails 6.1.4.4)
irb(main):001:0&gt; Notify.test_email('1234567890@qq.com', '测试一', '测试').deliver_now            #给1234567890发送一个测试邮件 
Delivered mail 6205d85720795_16bb5adc2973c@Gitlab.mail (1179.0ms)
=&gt; #&lt;Mail::Message:279200, Multipart: false, Headers: &lt;Date: Fri, 11 Feb 2022 11:30:31 +0800&gt;, &lt;From: GitLab &lt;1228413999@qq.com&gt;&gt;, &lt;Reply-To: GitLab &lt;noreply@gitlab.example.com&gt;&gt;, &lt;To: 1228413999@qq.com&gt;, &lt;Message-ID: &lt;6205d85720795_16bb5adc2973c@Gitlab.mail&gt;&gt;, &lt;Subject: 测试一&gt;, &lt;Mime-Version: 1.0&gt;, &lt;Content-Type: text/html; charset=UTF-8&gt;, &lt;Content-Transfer-Encoding: 7bit&gt;, &lt;Auto-Submitted: auto-generated&gt;, &lt;X-Auto-Response-Suppress: All&gt;&gt;
</code></pre> 
<blockquote> 
 <p> 在QQ邮箱进行查看邮件</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="313" src="https://images2.imgbox.com/df/1c/NuoW4K1c_o.png" width="884"></p> 
<blockquote> 
 <p>修改用户root的邮箱，默认是 admin@example.com，修改之后创建组会发送邮件警告</p> 
</blockquote> 
<p><img alt="" height="777" src="https://images2.imgbox.com/5a/06/RVVdv6uI_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="366" src="https://images2.imgbox.com/2b/34/8QL9JvsE_o.png" width="868"></p> 
<blockquote> 
 <p> 修改完成后  保存更改</p> 
</blockquote> 
<h4>2.、创建群组</h4> 
<p><img alt="" height="687" src="https://images2.imgbox.com/34/15/Gj4pInkF_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="554" src="https://images2.imgbox.com/29/c7/18NBqPT8_o.png" width="1200"></p> 
<blockquote> 
 <p> 可见度<br> Private（私人的）：只有组成员才能看到<br> Internal（内部）：只要登录的用户就能看到<br> Public（上市）：所有人都能看到</p> 
</blockquote> 
<p>填写完成后  &gt;&gt; 点 &gt;&gt; 创建组</p> 
<p style="text-align:center;"><img alt="" height="768" src="https://images2.imgbox.com/ad/3b/g3d5xYRb_o.png" width="816"></p> 
<h4> 3、创建用户</h4> 
<p style="text-align:center;"><img alt="" height="488" src="https://images2.imgbox.com/eb/46/1X6ltkWl_o.png" width="1200"></p> 
<p><img alt="" height="590" src="https://images2.imgbox.com/ea/8f/UEFPlTQD_o.png" width="1155"></p> 
<p>填写完后  &gt;&gt;  创建用户</p> 
<blockquote> 
 <p> 把刚刚创建的用户加入到组 web中</p> 
</blockquote> 
<p><img alt="" height="632" src="https://images2.imgbox.com/d5/84/0J4mQ8aP_o.png" width="1200"></p> 
<p><img alt="" height="611" src="https://images2.imgbox.com/4c/b0/0RLzseas_o.png" width="1200"></p> 
<p><img alt="" height="789" src="https://images2.imgbox.com/b6/b2/azW5WgI6_o.png" width="1200"></p> 
<blockquote> 
 <p><strong>Gitlab</strong>用户在组中有五种权限：<br><strong>Guest：</strong>可以创建issue、发表评论，不能读写版本库<br><strong>Reporter：</strong>可以克隆代码，不能提交，QA(测试人员)、PM(主管或者产品经理)可以赋予这个权限<br><strong>Developer：</strong>可以克隆代码、开发、提交、push，RD(研发人员)可以赋予这个权限<br><strong>Master：</strong>可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心RD负责人可以赋予这个权限<br><strong>Owner：</strong>可以设置项目访问权限 - Visibility Level、删除项目、迁移项目、管理组成员，开发组leader可以赋予这个权限</p> 
</blockquote> 
<p><img alt="" height="430" src="https://images2.imgbox.com/7c/0e/aF6WkF0h_o.png" width="1047"></p> 
<blockquote> 
 <p> 到邮箱进行设置密码</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="629" src="https://images2.imgbox.com/af/62/RRUBCKfK_o.png" width="1018"></p> 
<p style="text-align:center;"><img alt="" height="631" src="https://images2.imgbox.com/39/af/k8zIWiN9_o.png" width="1194"></p> 
<p style="text-align:center;"><img alt="" height="652" src="https://images2.imgbox.com/f3/2a/qdXxV2jD_o.png" width="1200"></p> 
<p><img alt="" height="808" src="https://images2.imgbox.com/98/bb/89KSjm3n_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="796" src="https://images2.imgbox.com/91/89/WD8vTrqz_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="258" src="https://images2.imgbox.com/85/18/IELVLATv_o.png" width="1200"></p> 
<blockquote> 
 <p>可以看到我们加入的web组</p> 
</blockquote> 
<h4>4、在 zs 用户上 创建一个项目</h4> 
<blockquote> 
 <p> 可以在群组里创建项目，也可以创建私有的项目，然后使用，使用方法跟github一样</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="609" src="https://images2.imgbox.com/da/48/s6IeSK0K_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="657" src="https://images2.imgbox.com/1f/75/IvHshSOL_o.png" width="1200"></p> 
<p><img alt="" height="805" src="https://images2.imgbox.com/5c/3f/uDppjwNz_o.png" width="1023"></p> 
<h4>5、 在新建的仓库创建一个文件</h4> 
<blockquote> 
 <p><strong>仓库使用：</strong>跟使用<strong>github</strong>方法一样。<strong><span style="color:#ff0000;">注意：没有</span></strong><strong><span style="color:#ff0000;">在账号中新建SSH公钥之前将无法通过 SSH 拉取或推送代码</span></strong></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="692" src="https://images2.imgbox.com/8d/48/uY4ai1G3_o.png" width="664"></p> 
<p><img alt="" height="538" src="https://images2.imgbox.com/74/d4/RxotR8WD_o.png" width="1142"></p> 
<h4>6、在windows 7 上创建秘钥</h4> 
<blockquote> 
 <p><strong>TortoiseGit </strong>使用扩展名为<strong>ppk</strong>的密钥，而不是<strong>ssh-keygen</strong>生成的<strong>rsa</strong>密钥。使用命令<strong>ssh-keygen -C "邮箱地址" -t rsa </strong>产生的密钥在 <strong>TortoiseGit  </strong>中不能用<br> 而基于 <strong>git</strong> 的开发必须要用到 <strong>rsa </strong>密钥，因此需要用到 <strong>TortoiseGit </strong>的 <strong>putty key generator </strong>工具来生成既适用于 <strong>git </strong>的 <strong>rsa </strong>密钥也适用于 <strong>TortoiseGit </strong>的 <strong>ppk </strong>密钥</p> 
</blockquote> 
<p><strong>6.1、运行TortoiseGit开始菜单中的puttygen程序</strong></p> 
<p style="text-align:center;"><img alt="" height="621" src="https://images2.imgbox.com/d1/44/cRXNClOg_o.png" width="320"></p> 
<p></p> 
<p><strong>6.2、点击“Generate”按钮，鼠标在上图的空白地方来回移动直到进度条完毕，就会自动生一个随机的key</strong></p> 
<blockquote> 
 <p> 公钥，需要复制到<strong>gitlab</strong>上</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="586" src="https://images2.imgbox.com/b3/7e/4rOO4V5Z_o.png" width="649"></p> 
<p><strong> 6.3、保存公钥私钥</strong></p> 
<blockquote> 
 <p>保存私钥</p> 
</blockquote> 
<p> 将生成的<strong>key</strong>保存为适用于 <strong>TortoiseGit </strong>的私钥（扩展名为<strong>.ppk</strong>）</p> 
<p style="text-align:center;"><img alt="" height="596" src="https://images2.imgbox.com/eb/c4/3wt1VLKw_o.png" width="1200"></p> 
<blockquote> 
 <p>保存公钥</p> 
</blockquote> 
<p> <strong>复制公钥后面要用</strong></p> 
<p><img alt="" height="581" src="https://images2.imgbox.com/34/4d/MVbGXdPy_o.png" width="1200"></p> 
<p><strong>6.4、 把私钥加入TortoiseGit</strong></p> 
<p style="text-align:center;"><img alt="" height="365" src="https://images2.imgbox.com/30/14/ADpuNxC8_o.png" width="1200"></p> 
<p><img alt="" height="807" src="https://images2.imgbox.com/20/c0/6aJLQ8g4_o.png" width="1200"></p> 
<p><strong>6.5、把公钥导入gitlab</strong></p> 
<p style="text-align:center;"><img alt="" height="730" src="https://images2.imgbox.com/ba/25/BjTWUGLP_o.png" width="1200"></p> 
<p><strong> 6.6、windows 7 上免密测试</strong></p> 
<blockquote> 
 <p> 克隆的URL路径</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="669" src="https://images2.imgbox.com/53/d6/I3E4MrNi_o.png" width="1200"></p> 
<p><img alt="" height="527" src="https://images2.imgbox.com/91/c5/ZuiOV1oT_o.png" width="734"></p> 
<p><img alt="" height="622" src="https://images2.imgbox.com/86/06/jCailvhE_o.png" width="1049"></p> 
<p><strong>6.7、 查看结果</strong></p> 
<p><img alt="" height="412" src="https://images2.imgbox.com/16/6d/byz0VEZV_o.png" width="777"></p> 
<h2> 三、部署 jenkins</h2> 
<p><strong> 同步时间</strong></p> 
<pre><code>
[root@jenkins ~]# yum -y install ntpdate
.......
[root@jenkins ~]# ntpdate 192.168.2.14           
11 Feb 17:33:27 ntpdate[15420]: step time server 192.168.2.14 offset -28797.200506 sec
</code></pre> 
<h3>1、部署java环境</h3> 
<blockquote> 
 <p><strong>Jenkins</strong>是Java 编写的，所以需要先安装 JDK</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# tar zxvf jdk-8u202-linux-x64.tar.gz            
[root@jenkins ~]# mv jdk1.8.0_202 /usr/local/java/                

     配置 jdk 环境变量

[root@jenkins ~]# vim /etc/profile
.........
.....         最后添加
JAVA_HOME=/usr/local/java            
PATH=$JAVA_HOME/bin:$PATH         
CLASSPATH=$JAVA_HOME/jre/lib/ext:$JAVA_HOME/lib/tools.jar         
export PATH JAVA_HOME CLASSPATH              

保存

[root@jenkins ~]# source /etc/profile               

[root@jenkins ~]# java -version           #java环境部署完成
java version "1.8.0_202"
Java(TM) SE Runtime Environment (build 1.8.0_202-b08)
Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)
</code></pre> 
<h3>2、部署 Jenkins</h3> 
<p><strong> Jenkins下载地址：</strong><a href="http://mirror.gruenehoelle.nl/jenkins/redhat-stable/" rel="nofollow" title="Index of /jenkins/redhat-stable/">Index of /jenkins/redhat-stable/</a></p> 
<h4> 2.1、安装 Jenkins</h4> 
<blockquote> 
 <p>这里使用旧版本后面会进行升级操作</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# rpm -ivh jenkins-2.222.4-1.1.noarch.rpm              
警告：jenkins-2.222.4-1.1.noarch.rpm: 头V4 DSA/SHA1 Signature, 密钥 ID d50582e6: NOKEY
准备中...                          ################################# [100%]
正在升级/安装...
   1:jenkins-2.222.4-1.1              ################################# [100%]

</code></pre> 
<h4>2.2、修改配置文件</h4> 
<pre><code>
[root@jenkins ~]# vim /etc/sysconfig/jenkins            
......
..
 29 JENKINS_USER="root"                #修改默认运行账号
.....
..
保存</code></pre> 
<h4>2.3、添加java软连接</h4> 
<pre><code>
   如果不做java软连接，启动会报错
[root@jenkins ~]# ln -s /usr/local/java/bin/java /usr/bin/              </code></pre> 
<h4>2.4、启动Jenkins</h4> 
<pre><code>
[root@jenkins ~]# /etc/init.d/jenkins start              
Starting jenkins (via systemctl):                          [  确定  ]

[root@jenkins ~]# netstat -anput|grep 8080
tcp6       0      0 :::8080                 :::*                    LISTEN      41820/java   

——————  添加到开机自启

[root@jenkins ~]# chkconfig jenkins on            
[root@jenkins ~]# chkconfig --list jenkins                 

注：该输出结果只显示 SysV 服务，并不包含
原生 systemd 服务。SysV 配置数据
可能被原生 systemd 配置覆盖。 

      要列出 systemd 服务，请执行 'systemctl list-unit-files'。
      查看在具体 target 启用的服务请执行
      'systemctl list-dependencies [target]'。

jenkins         0:关    1:关    2:开    3:开    4:开    5:开    6:关
</code></pre> 
<h3>3、访问并安装插件</h3> 
<h4>3.1、访问Jenkins</h4> 
<p><strong> 访问：192.168.2.15:8080</strong></p> 
<blockquote> 
 <p> 出现解锁页面，并且提供了密码保存路径，打开文件把密码输入就可以了</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="778" src="https://images2.imgbox.com/ff/cb/EYr8SURU_o.png" width="1200"></p> 
<blockquote> 
 <p> 查看密码</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# cat /var/lib/jenkins/secrets/initialAdminPassword           
7630e24287944f3298cf3744ed633efb
</code></pre> 
<p style="text-align:center;"><img alt="" height="570" src="https://images2.imgbox.com/d9/b9/ej40iaI9_o.png" width="913"></p> 
<p> 由于jenkins需要联网下载插件，默认插件的网址是jenkins的官网(速度特别慢)（<strong>暂时没有联网</strong>）</p> 
<p style="text-align:center;"><img alt="" height="492" src="https://images2.imgbox.com/8f/f5/IXXStZnj_o.png" width="806"></p> 
<h4>3.2、 添加一个系统账户</h4> 
<p style="text-align:center;"><img alt="" height="499" src="https://images2.imgbox.com/c3/21/S0jz8ZD7_o.png" width="827"></p> 
<p style="text-align:center;"><img alt="" height="494" src="https://images2.imgbox.com/01/21/O64K8AXK_o.png" width="814"></p> 
<h4> 3.3、手动安装Jenkins插件</h4> 
<p> 这里使用手动安装</p> 
<p><strong>方法一：上传插件</strong></p> 
<blockquote> 
 <p> 上传插件需要提前下载，下载完成后在上传到服务器</p> 
</blockquote> 
<p> 下载地址：<a href="http://updates.jenkins-ci.org/download/plugins/" rel="nofollow" title="Index of /download/plugins">Index of /download/plugins</a></p> 
<p><img alt="" height="432" src="https://images2.imgbox.com/0f/7d/HmqdKwqJ_o.png" width="770"></p> 
<p><img alt="" height="642" src="https://images2.imgbox.com/40/a5/vdlQzDij_o.png" width="969"></p> 
<p><strong> 方法二（本次使用<span style="color:#fe2c24;">方法二</span>）：</strong>把一台安装好 <strong>jenkins </strong>插件服务器的 <strong>/var/lib/jenkins/plugins</strong> 目录下的文件复制到新的 <strong>jenkins </strong>中。然后重启新的 <strong>jenkins </strong>使插件生效</p> 
<p> 下载插件：<a href="https://download.csdn.net/download/KW__jiaoq/80144092" title="Jenkins插件，解压即可用-网络安全文档类资源-CSDN下载">Jenkins插件，解压即可用-网络安全文档类资源-CSDN下载</a></p> 
<pre><code>
[root@jenkins ~]# mv /var/lib/jenkins/plugins /var/lib/jenkins/plugins.bf       
[root@jenkins ~]# tar -zxvf plugins.tar.gz -C /var/lib/jenkins/             
[root@jenkins ~]# systemctl restart jenkins                     #让插件生效
                   注意： 不重启，插件不会生效</code></pre> 
<blockquote> 
 <p><strong>查看安装的插件</strong></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="607" src="https://images2.imgbox.com/74/d9/jdmHNsqL_o.png" width="1200"></p> 
<h4>3.4、Jenkins升级</h4> 
<p> 目前版本2.222.4</p> 
<p><img alt="" height="286" src="https://images2.imgbox.com/cf/f6/5JtUG3hF_o.png" width="972"></p> 
<p>官方下载最新稳定版的 war包： <a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/2.319.3/jenkins.war" rel="nofollow" title="https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/2.319.3/jenkins.war">https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/2.319.3/jenkins.war</a></p> 
<p>清华大学镜像站下载：<a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/war/latest/jenkins.war" rel="nofollow" title="https://mirrors.tuna.tsinghua.edu.cn/jenkins/war/latest/jenkins.war">https://mirrors.tuna.tsinghua.edu.cn/jenkins/war/latest/jenkins.war</a></p> 
<p> 两个网站都可以下载</p> 
<pre><code>
   查看war包所在的目录
——————————————————————————
[root@jenkins ~]# rpm -ql jenkins | grep .war                
/usr/lib/jenkins/jenkins.war


  备份原来的war包，拷贝最新版本war包
——————————————————————————————————————————————

[root@jenkins ~]# cd /usr/lib/jenkins/
[root@jenkins jenkins]# mv jenkins.war jenkins.war.bak              
[root@jenkins jenkins]# ls
jenkins.war  jenkins.war.bak


[root@linux-node2 jenkins]# service jenkins start        

—————————————————如上命令执行完发现版本还是原来的，执行以下命令或者重启服务器使用命令： init 6 
[root@jenkins ~]# netstat -anptu |grep java                   
tcp6       0      0 :::8080                 :::*                    LISTEN      5952/java      

[root@jenkins ~]# kill -9 5952                                       
[root@jenkins ~]# /etc/init.d/jenkins start                              
</code></pre> 
<blockquote> 
 <p>查看版本已经成功升级到2.319.3版本</p> 
</blockquote> 
<p><img alt="" height="392" src="https://images2.imgbox.com/0e/a4/ap26EBvd_o.png" width="646"></p> 
<h3>4、配置 Jenkins 使用 gitlab 更新代码</h3> 
<h4>4.1、配置jenkins免密拉取gatlab代码</h4> 
<pre><code>           在Jenkins上生成密钥对
[root@jenkins ~]# ssh-keygen                   
..........
.....


     查询公钥，复制到 gitlab 上
————————————————————————————
[root@jenkins ~]# cat .ssh/id_rsa.pub                   
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDNGUs0sCd3XhWSK4JuIrLhxrrO2jzdeWmNAieMbkKj0PECa5djZetCuDouiUuKT7g7x3wWSqjwpOurBh5YlLcbeHnlT+kT6rVoR/O08rl4HduwN640nj8YU8hqOTV2BFz2EXplJMb57rV88UmMN/46QZTrcRYCOttYN9Akmv2TYSOsMlYB0bJqQRW5OGqaWSxF9SO78TDlMttHoFpP2ZUoMtGfV8r8O3WkQaVGwkWxsvAfLG2EjdLcgYMHYavmXRwDLDCnmXevyS+mnBd4ao+UJXtr6XIzlMyTuNUll+xoT2Qg3Uf12pXTXHdrXV4Jat3bU8Yh6B/yhG5UfVDHMMi5 root@jenkins
</code></pre> 
<p style="text-align:center;"><img alt="" height="698" src="https://images2.imgbox.com/2e/ef/ORJzohdq_o.png" width="1200"></p> 
<p><strong>测试 key</strong></p> 
<pre><code>
[root@jenkins ~]# yum install -y git                     
[root@jenkins ~]# git clone git@192.168.2.14:zs/web.git                           
正克隆到 'web'...
The authenticity of host '192.168.2.14 (192.168.2.14)' can't be established.
ECDSA key fingerprint is SHA256:S7MFrLTUcEUCDUIZePIXhSGFSvtI7n4F9Tkou5MMhzI.
ECDSA key fingerprint is MD5:9c:49:dc:85:0c:bd:6c:aa:81:01:67:38:30:c5:3b:9c.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.2.14' (ECDSA) to the list of known hosts.
remote: Enumerating objects: 6, done.
remote: Counting objects: 100% (6/6), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
接收对象中: 100% (6/6), done.


[root@jenkins ~]# ls web/                
index.html  README.md

</code></pre> 
<blockquote> 
 <p>测试发现不需要密码就可以直接<strong>clone</strong>项目，免密<strong>clone OK</strong>!</p> 
</blockquote> 
<h4>4.2、把 Jenkins 服务器刚刚生成的私钥配置到  <strong>jenkins</strong> 上</h4> 
<pre><code>
       查看私钥
————————————————————————
[root@jenkins ~]# cat .ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAzRlLNLAnd14VkiuCbiKy4ca6zto83XlpjQInjG5Co9DxAmuX
Y2XrQrg6LolLik+4O8d8Fkqo8KTrqwYeWJS3G3h55U/pE+q1aEfztPK5eB3bsDeu
NJ4/GFPIajk1dgRc9hF6ZSTG+e61fPFJjDf+OkGU63EWAjrbWDfQJJr9k2EjrDJW
AdGyakEVuThqmlksRfUju/Ew5TLbR6BaT9mVKDLRn1fK/Dt1pEGlRsJFsbLwHyxt
hI3S3IGDB2Gr5l0cAywwp5l3r8kvppwXeGqPlCV7a+lyM5TMk7jVJZfsaE9kIN1H
9dqV01x3a11eCWrd21PGIegf8oRuVH1QxzDIuQIDAQABAoIBADToU3gyANxQDux4
ANt8Y/zOER6POahAS7QuXBlj0BkGK0Xej1z6y6eYcpnSnQP+8J2rJh1yAQai5JBn
sahUJLAXcgpvhMa4gzd1aC7Ddoi/2w4oLu4v7ELQSiDsxRe+pGRtuc8hn5qVs4eZ
jsl3IEPS6yGZOH42xKKLM0xeFw/PRt5tL/3zKzwLqWePLDnRW9pFWYcoJcr/sBIx
vVaMvAduDQufj2I1j6M2EePswgqY2135vID/qiGbzJ6LexwgdCvJOfPHGAQA/sL1
ZKiCpFNdYm5kDX2BsTfuu1uzuAZ20QJnbCggj0oEy6hgUPlZP9JdpjIBldKpe95+
y6UZwYkCgYEA7mGuwvU+MDXj1bC/dzZ4wqJhr183GXLRCBPVfNdN+fyryV+17TQQ
4qVWd97NT2I5MmfJ8yI9hZq7diAwl6Ln1PWv7tLW3DiEgeh5R21XngUxodvP8NJ0
hRCaV+1Ag7hrNsqRTJ9YwSHBaM5Aial7zdO+0QNDSVZP7hA7CSVlwa8CgYEA3EHh
wTd4/b/YCMZKb6KK8/yoFO0Z1rXN/LmYS8uOQzB2dYWsLaWwA0A/gTR+H7hPGaY6
Aojk9EpQqXEMSbkAT9ysxyGEX+DjLej078DTVQt9Qaf8vICqTtELHg7GIqpGnJYK
WHDvaUOEnueNxchK/Y/AcDvfUkpyH4lMg5kcPhcCgYEA3yQbNi3hB7n6SpbHs20O
/4qHDGWBq1W56+i9B753JJHrsHXiU2dQgwgn989cunmEdvWGqgwcMMtVvU6GjfsV
LljJVjKQo9ZX207k8AKfaLEN86hSbuhh4AlZoQLaSDLCUaiu+F2U9DyH0nZ3HSXE
WThjvz1hp+2epocU7AvQw8sCgYAsRnoREwuZRpUwvlt8MVppTWKkQj0tcgJkSRKa
OeLxEq7dVO+VhXbqUGHzoQ+xZKVR7J5AoDAWA1JPnU/xCeVMKHn61Xv8ogJI2klS
YJqav+J/7jrZ0atqiI8JjcK6eSwUkfymZp1ZtZ7VKorPNUIN0nXGmeJ8ckaanEjr
Mz4AJQKBgCFot3uIzFMGED+JLVx+LZcZY3rspHL72WIccbTsjXFBH7NO22rRKUa+
fKR9i2K8HVir4WZbPqEWH+q9Z6nmaQFYvivmXrmoJgO8+Vb4gYhiYGVkj8phI8/y
A8pzK3P1s+zJol4t9X1bNcSAkHID55/TdlRkl2xv5oUskE/cMfPL
-----END RSA PRIVATE KEY-----
</code></pre> 
<blockquote> 
 <p><strong>在jenkins中添加私钥</strong></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="385" src="https://images2.imgbox.com/91/0f/swPB8100_o.png" width="1027"></p> 
<p style="text-align:center;"><img alt="" height="808" src="https://images2.imgbox.com/71/f0/GowpNAMG_o.png" width="1189"></p> 
<p style="text-align:center;"><img alt="" height="516" src="https://images2.imgbox.com/d2/74/LKokpkC7_o.png" width="1172"></p> 
<p style="text-align:center;"><img alt="" height="514" src="https://images2.imgbox.com/a0/ac/PdnQBrxP_o.png" width="687"></p> 
<blockquote> 
 <p><strong>Jenkins</strong> 服务器 的公钥在<strong>gitlab</strong>，<strong>Jenkins</strong> 服务器的私钥在 <strong>jenkins</strong>，这样 <strong>jenkins </strong>就可以直接拉取 <strong>gitlab </strong>上的代码。全局凭证（不受限制）</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="497" src="https://images2.imgbox.com/83/d4/0L2IRHrZ_o.png" width="1200"></p> 
<h4>4.3、Jenkins创建项目</h4> 
<p> 以下选项二选一，都可以新建任务</p> 
<p style="text-align:center;"><img alt="" height="472" src="https://images2.imgbox.com/93/ef/JExYolpO_o.png" width="1200"></p> 
<p> 选择  &gt;&gt;&gt;  自由式项目</p> 
<p style="text-align:center;"><img alt="" height="584" src="https://images2.imgbox.com/3f/6c/PqDt29kW_o.png" width="1164"></p> 
<blockquote> 
 <p> 点击 web-job <span style="color:#fe2c24;"><strong>右边的倒三角形</strong></span></p> 
</blockquote> 
<p><img alt="" height="799" src="https://images2.imgbox.com/2a/a6/4lYuitwC_o.png" width="1200"></p> 
<blockquote> 
 <p> 自定义  描述</p> 
</blockquote> 
<p><img alt="" height="272" src="https://images2.imgbox.com/a6/e5/PhI2eeVE_o.png" width="1031"></p> 
<p style="text-align:center;"><img alt="" height="663" src="https://images2.imgbox.com/6d/95/F2tanMCO_o.png" width="953"></p> 
<blockquote> 
 <p>上图的 Repository URL 路径在 gitlab下进行复制如下图</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="739" src="https://images2.imgbox.com/f0/67/84RKiyXD_o.png" width="1138"></p> 
<blockquote> 
 <p> 添加凭据</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="553" src="https://images2.imgbox.com/b9/43/sWpnVD7u_o.png" width="966"></p> 
<blockquote> 
 <p> 以下的私钥是   4.2、Jenkins的私钥  &gt;&gt;  复制到以下即可</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="521" src="https://images2.imgbox.com/b2/5a/nWM8Uc04_o.png" width="962"></p> 
<p><img alt="" height="330" src="https://images2.imgbox.com/dc/8d/75T4kJF4_o.png" width="926"></p> 
<p><img alt="" height="495" src="https://images2.imgbox.com/25/3c/tVEbD8wI_o.png" width="994"></p> 
<p><img alt="" height="409" src="https://images2.imgbox.com/45/81/SGbLcPMK_o.png" width="1009"></p> 
<blockquote> 
 <p> 上图的<strong>URL</strong>是下图的<strong>http</strong>路径；<strong>velrslon</strong>（版本号）是<strong>Gitlab</strong> 的版本号 我这里是 <strong>14.7 </strong>版本</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="842" src="https://images2.imgbox.com/46/65/kPJZRFhp_o.png" width="1088"></p> 
<blockquote> 
 <p> 修改完后就可以  &gt;&gt;  应用   &gt;&gt;   保存了</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="336" src="https://images2.imgbox.com/b5/3b/cOT4USM6_o.png" width="600"></p> 
<h4> 4.4、测试下载代码</h4> 
<blockquote> 
 <p><strong> 在构建时报错问题如下</strong></p> 
</blockquote> 
<pre><code>
ERROR: Couldn't find any revision to build. Verify the repository and branch configuration for this job.
Finished: FAILURE</code></pre> 
<p><img alt="" height="603" src="https://images2.imgbox.com/49/70/Gu2QqRZf_o.png" width="1165"></p> 
<p><strong><span style="color:#fe2c24;">原因分析</span>：</strong></p> 
<blockquote> 
 <p>是<strong>jenkins</strong>找不到分支来拉指定的<strong>git</strong>代码，是因为<strong>github</strong>上<strong>master</strong>节点名称变更为<strong>main</strong></p> 
</blockquote> 
<p><strong><span style="color:#fe2c24;">解决办法</span>：</strong></p> 
<p style="text-align:center;"><img alt="" height="510" src="https://images2.imgbox.com/2c/ee/nxJAu6Xn_o.png" width="1200"></p> 
<blockquote> 
 <p> <strong>保存后在进行测试</strong></p> 
</blockquote> 
<p><img alt="" height="565" src="https://images2.imgbox.com/0b/74/h6j09vFU_o.png" width="1041"></p> 
<blockquote> 
 <p> 刷新页面之后就可以看到之前构建的项目执行成功了，<strong>jenkins</strong>可以从<strong>gitlab</strong>上下载代码</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="661" src="https://images2.imgbox.com/36/47/vVQCYqQF_o.png" width="1185"></p> 
<blockquote> 
 <p> 可以在控制台查看输出结果</p> 
</blockquote> 
<p><img alt="" height="747" src="https://images2.imgbox.com/bc/2e/ny8IQeH8_o.png" width="1200"></p> 
<blockquote> 
 <p> 拉取下来的代码会保存到：/var/lib/jenkins/workspace/web-job 路径下</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="186" src="https://images2.imgbox.com/49/e8/GdFwMwJ9_o.png" width="565"></p> 
<blockquote> 
 <p> 查看下载的代码</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# cat /var/lib/jenkins/workspace/web-job/index.html                
&lt;h1&gt; GItlab !!!!!!!!&lt;/h1&gt;
</code></pre> 
<h3>5、<strong>将代码发布到 web 服务器</strong></h3> 
<blockquote> 
 <p>可以通过执行<strong>命令</strong>或<strong>脚本</strong>的方式进行代码发布，这里使用 <strong>root </strong>用户在 <strong>web</strong> 服务器上发布代码。也可以建立一些普通用户如果 <strong>Gitlab </strong>或 <strong>apache </strong>来发布。如果使用普通用户发布代码，要保持所有服务器上的用户<strong>id</strong>一致，这样就没有权限的问题了</p> 
</blockquote> 
<p><strong>拓扑图如下：</strong></p> 
<p style="text-align:center;"><img alt="" height="165" src="https://images2.imgbox.com/eb/f0/vBkpLVip_o.png" width="724"></p> 
<h4> 5.1、部署Apache服务器</h4> 
<p><strong> 同步时间</strong></p> 
<pre><code>
[root@Apache ~]# yum -y install ntpdate                    
.........
[root@Apache ~]# ntpdate 192.168.2.14                     
12 Feb 15:38:40 ntpdate[3130]: step time server 192.168.2.14 offset -28798.840450 sec
</code></pre> 
<p><strong>安装apache</strong></p> 
<pre><code>
[root@Apache ~]# yum -y install httpd               
.......
[root@Apache ~]# systemctl start httpd              
</code></pre> 
<p><strong> 访问测试：192.168.2.16</strong></p> 
<p><img alt="" height="709" src="https://images2.imgbox.com/df/e8/zweVKjnY_o.png" width="1200"></p> 
<h4> 5.2、配置ssh免密认证</h4> 
<blockquote> 
 <p>配置<strong>Jenkins</strong>服务器登录到<strong>web</strong>服务器免密认证</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# ssh-copy-id root@192.168.2.16                
</code></pre> 
<h4>5.3、创建自动上传web代码的脚本</h4> 
<pre><code>
[root@jenkins ~]# vim web-jod.sh                
#!/bin/bash
scp /var/lib/jenkins/workspace/web-job/* root@192.168.2.16:/var/www/html
cp /var/lib/jenkins/workspace/web-job/*  /var/www/html/            

保存

[root@jenkins ~]# mkdir -p /var/www/html                     
[root@jenkins ~]# chmod -x web-jod.sh                 </code></pre> 
<h4>5.4、把脚本添加到Jenkins</h4> 
<p style="text-align:center;"><img alt="" height="786" src="https://images2.imgbox.com/22/a0/YmxBT72N_o.png" width="1190"></p> 
<p style="text-align:center;"><img alt="" height="664" src="https://images2.imgbox.com/5c/95/XWc2NiE7_o.png" width="1158"></p> 
<p style="text-align:center;"><img alt="" height="651" src="https://images2.imgbox.com/9b/69/yGZX3q7O_o.png" width="840"></p> 
<p style="text-align:center;"><img alt="" height="424" src="https://images2.imgbox.com/4a/cb/5aA1XIT5_o.png" width="680"></p> 
<h4> 5.5、测试</h4> 
<blockquote> 
 <p>修改之前的web项目中的index.html文件</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="648" src="https://images2.imgbox.com/cd/92/sQ07G17b_o.png" width="1200"></p> 
<blockquote> 
 <p> 构建项目在<strong>Jenkins</strong>上构建</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="383" src="https://images2.imgbox.com/3f/03/BYjjZtOV_o.png" width="963"></p> 
<p><img alt="" height="673" src="https://images2.imgbox.com/18/35/MsCSdrGX_o.png" width="963"></p> 
<blockquote> 
 <p> 查看测试结果</p> 
</blockquote> 
<pre><code>
[root@Apache ~]# cat /var/www/html/index.html                  
&lt;h1&gt; GItlab !!!!!!!!&lt;/h1&gt;
                                           测试web页面
</code></pre> 
<p><img alt="" height="591" src="https://images2.imgbox.com/6d/5b/mtzV2AnL_o.png" width="1013"></p> 
<h4>5.6、更新 Gatlab 代码触发Jenkins自动部署</h4> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">在公司的测试环境当中，当开发人员向 gitlab 仓库提交代码后，gitlab 自动通知 jenkins进行构建项目、代码质量测试然后部署至测试环境，这里先暂时部署到测试环境。对于生产环境，后期使用手动部署代码</p> 
</blockquote> 
<p><strong>生成身份令牌：</strong> 在<strong>jenkins</strong>服务器上生成 <strong>Token</strong>，<strong>openssl rand </strong>生成随机密码</p> 
<pre><code>    说明：-hex：输出结果为16进制数据; 数字12是指定生成的随机字符为12字节，即24个 16 进制个数
[root@jenkins ~]# openssl rand -hex 12           
54bd93946b7c0efb3caa49ef
</code></pre> 
<blockquote> 
 <p><strong>jenkins</strong>上配置触发器</p> 
</blockquote> 
<p><img alt="" height="593" src="https://images2.imgbox.com/7d/66/XG1QfBp5_o.png" width="831"></p> 
<p style="text-align:center;"><img alt="" height="785" src="https://images2.imgbox.com/d7/e9/6ndUKv3e_o.png" width="1199"></p> 
<blockquote> 
 <p>在<strong>git</strong>项目配置界面设置链接和<strong>token</strong></p> 
</blockquote> 
<p> 在配置<strong>token</strong>前先设置 <span style="color:#fe2c24;"><strong>web 钩子</strong></span></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">因为 <strong>gitlab 10.6</strong> 版本以后为了安全，不允许向本地网络发送<strong>webhook</strong>请求，如果想向本地网络发送<strong>webhook</strong>请求，则需要使用管理员帐号登录，去修改配置</p> 
</blockquote> 
<p><strong><span style="color:#fe2c24;"> 注意：登录root用户进行修改修改完成后切换zs用户</span></strong></p> 
<p style="text-align:center;"><img alt="" height="411" src="https://images2.imgbox.com/5e/68/Lut5HSBS_o.png" width="766"></p> 
<p><img alt="" height="863" src="https://images2.imgbox.com/e1/76/PIgrZlPv_o.png" width="1200"></p> 
<blockquote> 
 <p> 切换到zs用户进行配置</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="714" src="https://images2.imgbox.com/71/28/JNF7YeI2_o.png" width="1036"></p> 
<blockquote> 
 <p>添加<strong>jenkins</strong>地址和<strong>token</strong></p> 
</blockquote> 
<pre><code>
链接使用如下地址：http://192.168.2.15:8080/buildByToken/build?job=web-job&amp;token=54bd93946b7c0efb3caa49ef                         
格式：http://jenkins地址/buildByToken/build?job=jenkins项目名&amp;token=token值                      
</code></pre> 
<p><img alt="" height="670" src="https://images2.imgbox.com/cd/a2/MNhPnDdv_o.png" width="1200"></p> 
<p><img alt="" height="713" src="https://images2.imgbox.com/92/44/5vDJAM84_o.png" width="1200"></p> 
<blockquote> 
 <p> 测试web钩子 ：<strong>往下划</strong></p> 
</blockquote> 
<p><img alt="" height="587" src="https://images2.imgbox.com/62/bd/ThssXW7B_o.png" width="1004"></p> 
<p style="text-align:center;"><img alt="" height="164" src="https://images2.imgbox.com/b8/df/9R57I32F_o.png" width="899"></p> 
<h4> 5.7、进行测试</h4> 
<blockquote> 
 <p>更新<strong>gitlab</strong>中 web 项目代码</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="379" src="https://images2.imgbox.com/b5/66/PuQqFApk_o.png" width="897"></p> 
<blockquote> 
 <p> 然后提交进行访问查看   <strong>192.168.2.16</strong></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="540" src="https://images2.imgbox.com/3d/30/7CH5mmGX_o.png" width="1057"></p> 
<h3>6、使用Build Pipeline插件显示流程图</h3> 
<blockquote> 
 <p> 给 <strong>web-job</strong> 项目添加一个视图</p> 
</blockquote> 
<p><img alt="" height="587" src="https://images2.imgbox.com/14/6a/EagfpeoX_o.png" width="1200"></p> 
<blockquote> 
 <p> 视图名称自定义</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="352" src="https://images2.imgbox.com/00/a3/1vzQuv69_o.png" width="877"></p> 
<blockquote> 
 <p> 显示最近5次没有显示的构建</p> 
</blockquote> 
<p><img alt="" height="840" src="https://images2.imgbox.com/f9/27/404TLaWa_o.png" width="1200"></p> 
<blockquote> 
 <p> 查看结果</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="868" src="https://images2.imgbox.com/9a/e1/GaAmtcXN_o.png" width="1200"></p> 
<h3> 7、使用分支进行网站版本回滚</h3> 
<h4>7.1、分支类型和概念</h4> 
<blockquote> 
 <p><strong><span style="color:#fe2c24;"><span style="background-color:#fef2f0;">master</span></span>：</strong>用于发布生产环境的分支，该分支上的代码必须是测试通过的代码，只接受来自于<strong>feature</strong>和<strong>hotfix</strong>的分支合并每次发布需要进行tag标记以便于出错时进行回滚<br><strong><span style="color:#fe2c24;"><span style="background-color:#fef2f0;">develop</span></span>：</strong>测试分支，所有<strong>feature</strong>分支开发完毕的功能需要合并到<strong>develop</strong>进行测试后才能合并到<strong>master</strong>。<strong>develop</strong>可能会存在多个。<strong>develop</strong>不能合并到<strong>master</strong><br><strong><span style="color:#fe2c24;"><span style="background-color:#fef2f0;">feature</span></span>：</strong>开发分支<br><strong><span style="color:#fe2c24;"><span style="background-color:#fef2f0;">hotfix</span></span>：</strong>紧急修复分支，在<strong>master</strong>分支出现<strong>BUG</strong>需要进行紧急修复时使用</p> 
</blockquote> 
<h4 id="流程规范">7.2、流程规范</h4> 
<p><img alt="" height="439" src="https://images2.imgbox.com/38/ea/o00Xukvr_o.png" width="797"></p> 
<p><strong> 当前4种分支类型的工作流程</strong></p> 
<p><strong><span style="color:#fe2c24;"><span style="background-color:#fef2f0;">master</span></span>和<span style="color:#fe2c24;"><span style="background-color:#fef2f0;">develop</span></span></strong></p> 
<blockquote> 
 <p><strong>master</strong>是用于发布的分支，因此需要与生产环境保持绝对一致，不能出现直接提交的情况。在每次<strong>master</strong>发布上线时，我们需要继续<strong>tag</strong>标记，万一生产环境出现紧急问题可以迅速通过<strong>tag</strong>进行版本回滚<br><strong>develop</strong>是用于测试的分支，可能在一个<strong>develop</strong>分支种存在多个来自于<strong>feature</strong>的开发功能，因此不能直接从<strong>develop</strong>合并到<strong>master</strong>上，避免出现将未测试通过的功能偷跑上线的情况发生。一般一个<strong>develop</strong>分支对应一个测试环境，根据团队进行可以部署多个测试环境和多个<strong>develop</strong>分支<br><strong>master</strong>和<strong>develop</strong>分支通常不允许出现直接在进行<strong>commit</strong>和<strong>push</strong>操作，也就是直接这些分支上提交代码，这些分支只能通过<strong>merge</strong>进行修改。这些限定在大部分<strong>git</strong>平台上均有实现，通过设定为保护分支可以防止被删除，通过权限设置可以只允许部分人员进行<strong>push</strong>操作</p> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong><span style="background-color:#fef2f0;">feature</span></strong></span></p> 
<blockquote> 
 <p>这个分支是开发者最常用到的分支之一，在接到新的功能需求时，<strong>feature</strong>需要从当前最新的<strong>master</strong>切出分支来进行开发。多个<strong>feature</strong>之间是互相独立的，因此也会存在代码冲突的情况，这就需要各位开发人员互相的协调合作了。这里说明以下<strong>feature</strong>的操作流程</p> 
</blockquote> 
<blockquote> 
 <p><strong>1、</strong>有新需求，从最新的<strong>master</strong>上切出分支，进行功能开发<br><strong>2、</strong>在<strong>feature</strong>上开发完毕功能后，需要先<strong>merge</strong>到<strong>develop</strong>分支进行测试。在合并之前，需要将最新的<strong>master</strong>合并到当前分支来，确保不会有生产环境的功能遗漏而导致测试不通过的情况<br><strong>3、</strong>测试人员在<strong>develop</strong>上出现问题，由开发人员在<strong>feature</strong>上进行修复后，重新操作步骤<strong>2</strong>发布到测试<br><strong>4、</strong>测试通过，<strong>merge</strong>到<strong>master</strong>进行上线<br><strong>5、</strong>上线完毕，删除<strong>feature</strong>分支<br> 这便是<strong>feature</strong>的整个生命周期，这里有人可能有疑惑，如果上线后出现<strong>BUG</strong>要怎么办呢？别着急，马上我们就来讲讲<strong>hotfix</strong></p> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong><span style="background-color:#fef2f0;">hotfix</span></strong></span></p> 
<blockquote> 
 <p>一旦<strong>feature</strong>发布到生产环境后出现<strong>BUG</strong>需要紧急修复，但是<strong>feature</strong>的职责其实在<strong>merge</strong>到<strong>master</strong>时就已经终结了，现在我们需要的一个补救分支<strong>hotfix</strong><br><strong>hotfix</strong>就如同名字一样，用于生产环境的快速修复，一旦生产环境出现问题<br><strong>1、</strong>首先我们要将版本进行回滚<br><strong>2、</strong>然后立刻切出<strong>hotfix</strong>，进行问题排查和修复<br><strong>3、</strong>在修复完毕后同样需要进入到<strong>develop</strong>进行测试，千万不要盲目的自信上线<br><strong>4、</strong>在测试通过之后，<strong>merge</strong>到<strong>master</strong>进行上线<br><strong>5、</strong>上线完毕，删除<strong>hotfix</strong>分支<br> 不过要是这次上线完了还有问题，那就再来一个<strong>hotfix</strong>！</p> 
</blockquote> 
<h4>7.3、新建分支</h4> 
<blockquote> 
 <p>这里使用图形化新建分支（也可以使用命令进行新建）</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="657" src="https://images2.imgbox.com/4e/f1/TXEHQcbV_o.png" width="1200"></p> 
<p><img alt="" height="630" src="https://images2.imgbox.com/88/32/vJuYDYMZ_o.png" width="1200"></p> 
<blockquote> 
 <p>修改fz分支上的<strong>index.html</strong>文件</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="665" src="https://images2.imgbox.com/39/90/ll7YZCGw_o.png" width="1004"></p> 
<h4>7.4、 根据 fz 分支进行回滚；回滚我们采取手动回滚的方式，编写<strong>shell</strong>脚本来执行</h4> 
<pre><code>
[root@jenkins ~]# vim hg.sh                     
#!/bin/bash         
cd /root             
git clone -b fz git@192.168.2.14:zs/web.git             
scp /root/web/index.html root@192.168.2.16:/var/www/html/index.html            

保存</code></pre> 
<p><img alt="" height="604" src="https://images2.imgbox.com/e4/06/WcVRcQb0_o.png" width="843"></p> 
<pre><code>
[root@jenkins ~]# rm -rf web                  
[root@jenkins ~]# bash hg.sh               
正克隆到 'web'...
remote: Enumerating objects: 31, done.
remote: Counting objects: 100% (31/31), done.
remote: Compressing objects: 100% (19/19), done.
remote: Total 31 (delta 8), reused 25 (delta 6), pack-reused 0
接收对象中: 100% (31/31), done.
处理 delta 中: 100% (8/8), done.
index.html                                                                               100%   36    48.7KB/s   00:00    

</code></pre> 
<p style="text-align:center;"><img alt="" height="619" src="https://images2.imgbox.com/66/fd/aJkY4qpd_o.png" width="940"></p> 
<h3>8、 jenkins发布tomcat项目</h3> 
<h4>8.1、在Jenkins上安装Maven（需要java环境）</h4> 
<blockquote> 
 <p><strong>maven:</strong>  就是将开发写的<strong>Java</strong>代码，打包成<strong>war</strong>包，然后在将打包成的<strong>war</strong>包，部署到<strong>tomcat</strong>上，供客户端访问</p> 
</blockquote> 
<blockquote> 
 <p><strong>Project Object</strong> <strong>Model</strong>，项目对象模型。通过<strong>xml</strong>格式保存的<strong>pom.xml</strong>文件。该文件用于管理：源代码、配置文件、开发者的信息和角色、问题追踪系统、组织信息、项目授权、项目的<strong>url</strong>、项目的依赖关系等等。该文件是由开发维护，我们运维人员可以不用去关心</p> 
</blockquote> 
<p>官网下载Maven：<a href="https://maven.apache.org/download.cgi" rel="nofollow" title="Maven – Download Apache Maven">Maven – Download Apache Maven</a></p> 
<pre><code>
[root@jenkins ~]# tar xf apache-maven-3.8.4-bin.tar.gz                    
[root@jenkins ~]# mv apache-maven-3.8.4 maven                   
[root@jenkins ~]# ln -s /root/maven/bin/mvn /usr/bin/mvn                  

  ————————添加maven的环境变量

[root@jenkins ~]# vim /etc/profile                    
.....  最后加入内容
export MAVEN_HOME=/root/maven
export PATH=$PATH:$MAVEN_HOME/bin                

保存

[root@jenkins ~]# source /etc/profile                  
</code></pre> 
<h4>8.2、创建Maven私服nexus</h4> 
<blockquote> 
 <p>默认Maven下载jar包去官网太慢，因此搭建nexus能够加快jar包的下载</p> 
</blockquote> 
<blockquote> 
 <p>配置仓库两个选项<br> 项目下的<strong>pom.xml</strong>配置、只生效当前的项目<br> 在<strong>maven</strong>配置全局所有项目生效</p> 
</blockquote> 
<pre><code>上传 nexus 安装包

[root@jenkins ~]# tar xf nexus-3.13.0-01-unix.tar.gz                   
[root@jenkins ~]# mv nexus-3.13.0-01 /usr/local/nexus                 
[root@jenkins ~]# /usr/local/nexus/bin/nexus start                  
WARNING: ************************************************************
WARNING: Detected execution as "root" user.  This is NOT recommended!
WARNING: ************************************************************
Starting nexus

[root@jenkins ~]# netstat -anptu | grep 8081            #启动比较慢
tcp        0      0 0.0.0.0:8081            0.0.0.0:*               LISTEN      61384/java         </code></pre> 
<blockquote> 
 <p><strong>访问：</strong>192.168.2.15:8081</p> 
</blockquote> 
<p><img alt="" height="694" src="https://images2.imgbox.com/f2/8e/OFOAeC39_o.png" width="1200"></p> 
<p><img alt="" height="528" src="https://images2.imgbox.com/ba/5e/laHwVFXV_o.png" width="1015"></p> 
<p>修改私服拉取编译的包去阿里云：http://maven.aliyun.com/nexus/content/groups/public</p> 
<p><img alt="" height="676" src="https://images2.imgbox.com/64/f9/Sg4h8HTS_o.png" width="1200"></p> 
<p> 修改完成后  保存  应用</p> 
<h4>8.3、 配置私服</h4> 
<pre><code>
[root@jenkins ~]# vim /root/maven/conf/settings.xml               
...........
.....          #添加到servers区域  忽略:--&gt;
    --&gt;
    &lt;server&gt;
      &lt;id&gt;my-nexus-releases&lt;/id&gt;
      &lt;username&gt;admin&lt;/username&gt;
      &lt;password&gt;admin123&lt;/password&gt;
    &lt;/server&gt;
    &lt;server&gt;
      &lt;id&gt;my-nexus-snapshot&lt;/id&gt;
      &lt;username&gt;admin&lt;/username&gt;
      &lt;password&gt;admin123&lt;/password&gt;
    &lt;/server&gt;
  &lt;/servers&gt;

......            #在mirrors区域添加
    &lt;mirror&gt;
        &lt;id&gt;nexus-aliyun&lt;/id&gt;
        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
        &lt;name&gt;Nexus aliyun&lt;/name&gt;
        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;
    &lt;/mirror&gt;
    &lt;mirror&gt;
        &lt;id&gt;nexus&lt;/id&gt;
        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
        &lt;url&gt;http://192.168.2.15:8081/repository/maven-central/&lt;/url&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;            
......   
..                #添加到properties区域
      &lt;profile&gt;
        &lt;id&gt;nexus&lt;/id&gt;
           &lt;repositories&gt;
             &lt;repository&gt;
                &lt;id&gt;central&lt;/id&gt;
                   &lt;url&gt;http://192.168.2.15:8081/repository/maven-central/&lt;/url&gt;
                   &lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;
                   &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;
            &lt;/repository&gt;
          &lt;/repositories&gt;
       &lt;pluginRepositories&gt;
       &lt;pluginRepository&gt;
         &lt;id&gt;central&lt;/id&gt;
         &lt;url&gt;http://192.168.2.15:8081/repository/maven-central/&lt;/url&gt;
         &lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;
         &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;
      &lt;/pluginRepository&gt;
      &lt;/pluginRepositories&gt;
 &lt;/profile&gt;
       &lt;properties&gt;
......
...         #在settings区域添加
  &lt;activeProfiles&gt;
    &lt;activeProfile&gt;nexus&lt;/activeProfile&gt;
  &lt;/activeProfiles&gt;
&lt;/settings&gt;


保存

</code></pre> 
<h4>8.4、配置Jenkins</h4> 
<p style="text-align:center;"><img alt="" height="910" src="https://images2.imgbox.com/4f/fc/30ql9htm_o.png" width="1200"></p> 
<blockquote> 
 <p> 以下图中有一个 <strong>√</strong> 选项，需要取消即可</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="473" src="https://images2.imgbox.com/34/9a/QzmN13SZ_o.png" width="1200"></p> 
<p style="text-align:center;"><img alt="" height="351" src="https://images2.imgbox.com/44/de/aRMyAwy5_o.png" width="1145"></p> 
<p style="text-align:center;"><img alt="" height="343" src="https://images2.imgbox.com/f4/2f/O7F0tzhP_o.png" width="1079"></p> 
<blockquote> 
 <h4>8.5、新建一个jenkins任务</h4> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="558" src="https://images2.imgbox.com/31/7d/NMFN3N89_o.png" width="1119"></p> 
<blockquote> 
 <p>这里是一些通用的设置,  丢弃旧的构建  多次构建又不手动清除  会生成很多文件 ,占用磁盘空间  这里的丢弃旧的构建的配置大家按需配置即可</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="554" src="https://images2.imgbox.com/41/4e/K1Cl1BsW_o.png" width="961"></p> 
<blockquote> 
 <p><strong>源码管理：</strong> URL从Gitlab中进行复制</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="373" src="https://images2.imgbox.com/f6/9d/iLVWpEyj_o.png" width="937"></p> 
<p style="text-align:center;"><img alt="" height="514" src="https://images2.imgbox.com/3a/ca/WrM2pW3q_o.png" width="1017"></p> 
<blockquote> 
 <p> 定时构建  “日程表”格式为和cron表达式一样（相当于任务计划）</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="402" src="https://images2.imgbox.com/ca/50/1zZnvoMk_o.png" width="809"></p> 
<p> 这里不进行配置</p> 
<p><img alt="" height="546" src="https://images2.imgbox.com/0d/27/zLe8y8KR_o.png" width="891"></p> 
<pre><code>
[root@jenkins ]# vim tomcat.sh               

#!/bin/bash            

source /etc/profile
scp /var/lib/jenkins/workspace/test/test1/target/test1.war              root@192.168.2.16:/usr/local/tomcat/webapps/             
ssh root@192.168.2.16 "/usr/local/tomcat/bin/shutdown.sh"            
sleep 3           
ssh root@192.168.2.16 "/usr/local/tomcat/bin/startup.sh"                    

保存

</code></pre> 
<p><img alt="" height="733" src="https://images2.imgbox.com/7b/3d/gF3M8aWy_o.png" width="909"></p> 
<blockquote> 
 <p> 上传项目文件</p> 
</blockquote> 
<pre><code>
[root@jenkins ~]# mkdir aaa                
[root@jenkins ~]# cd aaa               
[root@jenkins aaa]# pwd             
/root/aaa
[root@jenkins aaa]# ls
test1  time.java

[root@jenkins aaa]# git config --global user.email "jenkins@example.com"                   
[root@jenkins aaa]# git config --global user.name "jenkins"               
[root@jenkins aaa]# ssh-copy-id root@192.168.2.14              
[root@jenkins aaa]# git clone git@192.168.2.14:zs/web.git                
正克隆到 'web'...
remote: Enumerating objects: 38, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 38 (delta 1), reused 1 (delta 0), pack-reused 35
接收对象中: 100% (38/38), 4.02 KiB | 0 bytes/s, done.
处理 delta 中: 100% (13/13), done.

[root@jenkins aaa]# mv  time.java test1 web               
[root@jenkins web]# git rm -rf index.html
rm 'index.html'
[root@jenkins web]# ls
README.md  test1  time.java

[root@jenkins aaa]# git add .                     
[root@jenkins aaa]# git commit -m "ceshi jenkins"                  
........
[root@jenkins web]# git push -u origin main                 
Counting objects: 38, done.
Compressing objects: 100% (26/26), done.
Writing objects: 100% (37/37), 5.26 KiB | 0 bytes/s, done.
Total 37 (delta 1), reused 0 (delta 0)
To git@192.168.2.14:zs/web.git
   f64ebcc..906cc87  main -&gt; main
分支 main 设置为跟踪来自 origin 的远程分支 main。
</code></pre> 
<p><img alt="" height="653" src="https://images2.imgbox.com/04/5d/ll1GEmBn_o.png" width="1200"></p> 
<blockquote> 
 <p>在<strong>Apache</strong> 服务器上安装 <strong>tomcat</strong></p> 
</blockquote> 
<pre><code>
[root@Apache ~]# tar zxvf jdk-8u202-linux-x64.tar.gz                 
.....
[root@Apache ~]# mv jdk1.8.0_202/ /usr/local/java              
[root@Apache ~]# cat &lt;&lt;END&gt;&gt;/etc/profile           
export JAVA_HOME=/usr/local/java
export PATH=\$PATH:/usr/local/java/bin       
END                 

[root@Apache ~]# source /etc/profile              
[root@Apache ~]# tar zxvf apache-tomcat-10.0.13.tar.gz               
.......
[root@Apache ~]# mv apache-tomcat-10.0.13 /usr/local/tomcat        
[root@Apache ~]# /usr/local/tomcat/bin/startup.sh              
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/temp
Using JRE_HOME:        /usr/local/java
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
Using CATALINA_OPTS:   
Tomcat started.
————————————————————————————————赋权
[root@Apache ~]# chmod a+x /usr/local/tomcat/bin/shutdown.sh               
[root@Apache ~]# chmod a+x /usr/local/tomcat/bin/startup.sh                
[root@Apache ~]# chmod -R o=rx /usr/local/tomcat/bin/                
[root@Apache ~]# chmod -R o=rwx  /usr/local/tomcat/logs/                 

</code></pre> 
<blockquote> 
 <p>进行测试</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="722" src="https://images2.imgbox.com/a1/ff/WipS1rzY_o.png" width="1200"></p> 
<p>这时候出现报错：查看原因</p> 
<p><img alt="" height="784" src="https://images2.imgbox.com/3e/aa/9yOrqBhj_o.png" width="1177"></p> 
<h3><img alt="" height="503" src="https://images2.imgbox.com/41/4e/wuvNvMB2_o.png" width="1200"></h3> 
<blockquote> 
 <p>错误提示倒是非常的清晰，“没有定义<strong>JAVA_HOME</strong>和<strong>JRE_HOME</strong>环境变量 至少需要这些环境变量之一才能运行此程序”，就是说找不到<strong>JAVA_HOME</strong>这个变量，但是我确定在目标机器上是有这个环境变量的，<strong>echo $JAVA_HOME</strong>也可以打印出来，而且更诡异的是，我在目标机器上手动执行这个脚本的时候，是没有任何问题的。</p> 
</blockquote> 
<blockquote> 
 <p>脚本很简单，跟<strong>jenkins</strong>在本机自动部署一样，最后一步也就是启动<strong>tomcat</strong>，并没有什么特殊的操作，仔细检查了一下，也没啥特殊字符，真实见鬼了，百度了一下，发现已经有前辈高人碰见过这个问题了，解决思路也比较真实，<span style="color:#fe2c24;">既然你没有，既然你要，那就给你一个。。。</span></p> 
</blockquote> 
<blockquote> 
 <p><strong>解决方案：</strong>在<strong>tomcat</strong>的<strong>catalina.sh</strong>文件里加入<strong>JAVA_HOME</strong>环境变量的配置，就写在文件开头处就行</p> 
</blockquote> 
<pre><code>
[root@Apache ~]# vim /usr/local/tomcat/bin/catalina.sh                 
#!/bin/sh
export JAVA_HOME="/usr/local/java"          
export JRE_HOME="/usr/local/java/jre"           
.....
..

保存</code></pre> 
<blockquote> 
 <p>在次测试</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" height="481" src="https://images2.imgbox.com/87/c6/OAGlZOa3_o.png" width="1200"></p> 
<blockquote> 
 <p> 访问测试</p> 
</blockquote> 
<p><img alt="" height="836" src="https://images2.imgbox.com/ce/85/olDxi1gL_o.png" width="1200"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a2b4cdad0aa4ac627ca7faf47b0ee65/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最多能创建TCP连接个数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5feac6f6b0502fcf2aecc60ef16b9efb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">开发中常见的架构模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>