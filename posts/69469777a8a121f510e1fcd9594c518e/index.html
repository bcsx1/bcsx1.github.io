<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch 7.6 - APi基础操作篇 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch 7.6 - APi基础操作篇" />
<meta property="og:description" content="ES7.6-APi基础操作篇 前言相关知识索引相关创建索引查询索引查询所有索引删除索引关闭与打开索引关闭索引打开索引 冻结与解冻索引冻结索引解冻索引 映射相关创建映射查看映射新增字段映射 文档相关(CURD)新增文档根据ID查询修改文档全量覆盖根据ID选择性修改根据条件批量更新 删除文档根据ID删除根据条件删除 批量操作批量插入批量更新批量删除混合操作 文档查询查询所有文档精准条件查询分词查询查询字段过滤范围查询组合查询高亮查询排序/分页聚合/分组查询 场景查询实操查询2023年中男、女的数量并找出对应的最大/最小年龄查询在地址中包含 &#34;泸州&#34; 或者 备注中包含 &#34;积极&#34; 的 男性青年(18-30岁),要求关键词高亮 搜索框：要求根据关键字找出匹配项目标，高亮实时预览分别找出男、女性别中年龄最小的三个人(TOP N)查询tag中带有某些标签的或者出身地在某某地的人，按照年龄降序，并且分页 总结索引相关API：映射相关API：文档相关API： 前言 很久之前就写过ES相关的，但现在看起来好像都不太全面，这里在重新整理一版，还是接着之前的ES版本来，使用ES7.6， 环境还没搭建可以参考之前的liunx下安装elasticsearch7.6、ik分词器以及kibana可视化工具
相关知识 Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。为了方便大家理解，这里将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比
概念类比Mysql表表结构行数据列ESindex（索引）mapping文档字段 因为ES中type的概念已经被废弃，所以可以简单认为index就是表（之前认为是库）
ES字段类型（很多建议看官网，这里只列举一部分常用）：
String 类型，又分两种：
text：可分词
keyword：不可分词，数据会作为完整字段进行匹配
Numerical：数值类型，分两类
基本数据类型：long、integer、short、byte、double、float、half_float
浮点数的高精度类型：scaled_float
Date：日期类型
Array：数组类型 ：这个注意不需要显示的设置array类型，数据是[]就行了
Object：对象
boolean：布尔
地理数据类型：
Geo-point： geo_point （纬度/经度积分）Geo-shape: geo_shape (用于多边形等复杂形状) 大家应该对Msyql比较熟，Mysql都知道有建库、建表、CURD这种基础操作对吧，没错本文也就是教大家针对ES的CURD的API
测试数据实体类准备(接下来我们用来学习测试的数据类，结构都是基于此创建的)：
@Data public class EsTest { private Long id; private String name; // 姓名 private String sex; // 性别 private Integer age; // 年龄 private String remark;// 备注 private String[] tag; // 标签 private String addressLocation; // 地址 private String birthAddress; // 出生地 private Date createTime; // 时间 private Boolean hasGirlFriend; // 有女朋友？ } ES API都等于是http接口，所以接下来一切操作都是http请求，所以我们用Postman来测试，主要是Postman可以用来整理收集API方便测试，当然你们也可以使用kibana来学习！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/69469777a8a121f510e1fcd9594c518e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-31T15:02:10+08:00" />
<meta property="article:modified_time" content="2023-08-31T15:02:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch 7.6 - APi基础操作篇</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ES7.6-APi基础操作篇</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_3" rel="nofollow">相关知识</a></li><li><a href="#_60" rel="nofollow">索引相关</a></li><li><ul><li><a href="#_62" rel="nofollow">创建索引</a></li><li><a href="#_81" rel="nofollow">查询索引</a></li><li><a href="#_95" rel="nofollow">查询所有索引</a></li><li><a href="#_122" rel="nofollow">删除索引</a></li><li><a href="#_131" rel="nofollow">关闭与打开索引</a></li><li><ul><li><a href="#_133" rel="nofollow">关闭索引</a></li><li><a href="#_155" rel="nofollow">打开索引</a></li></ul> 
    </li><li><a href="#_172" rel="nofollow">冻结与解冻索引</a></li><li><ul><li><a href="#_174" rel="nofollow">冻结索引</a></li><li><a href="#_191" rel="nofollow">解冻索引</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_206" rel="nofollow">映射相关</a></li><li><ul><li><a href="#_212" rel="nofollow">创建映射</a></li><li><a href="#_271" rel="nofollow">查看映射</a></li><li><a href="#_281" rel="nofollow">新增字段映射</a></li></ul> 
   </li><li><a href="#CURD_300" rel="nofollow">文档相关(CURD)</a></li><li><ul><li><a href="#_302" rel="nofollow">新增文档</a></li><li><a href="#ID_355" rel="nofollow">根据ID查询</a></li><li><a href="#_366" rel="nofollow">修改文档</a></li><li><ul><li><a href="#_368" rel="nofollow">全量覆盖</a></li><li><a href="#ID_375" rel="nofollow">根据ID选择性修改</a></li><li><a href="#_395" rel="nofollow">根据条件批量更新</a></li></ul> 
    </li><li><a href="#_420" rel="nofollow">删除文档</a></li><li><ul><li><a href="#ID_422" rel="nofollow">根据ID删除</a></li><li><a href="#_432" rel="nofollow">根据条件删除</a></li></ul> 
    </li><li><a href="#_454" rel="nofollow">批量操作</a></li><li><ul><li><a href="#_476" rel="nofollow">批量插入</a></li><li><a href="#_498" rel="nofollow">批量更新</a></li><li><a href="#_513" rel="nofollow">批量删除</a></li><li><a href="#_525" rel="nofollow">混合操作</a></li></ul> 
    </li><li><a href="#_541" rel="nofollow">文档查询</a></li><li><ul><li><a href="#_595" rel="nofollow">查询所有文档</a></li><li><a href="#_635" rel="nofollow">精准条件查询</a></li><li><a href="#_664" rel="nofollow">分词查询</a></li><li><a href="#_703" rel="nofollow">查询字段过滤</a></li><li><a href="#_739" rel="nofollow">范围查询</a></li><li><a href="#_776" rel="nofollow">组合查询</a></li><li><a href="#_818" rel="nofollow">高亮查询</a></li><li><a href="#_844" rel="nofollow">排序/分页</a></li><li><a href="#_874" rel="nofollow">聚合/分组查询</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_965" rel="nofollow">场景查询实操</a></li><li><ul><li><ul><li><a href="#2023_969" rel="nofollow">查询2023年中男、女的数量并找出对应的最大/最小年龄</a></li><li><a href="#______1830_1015" rel="nofollow">查询在地址中包含 "泸州" 或者 备注中包含 "积极" 的 男性青年(18-30岁),要求关键词高亮</a></li></ul> 
    </li><li><a href="#_1075" rel="nofollow">搜索框：要求根据关键字找出匹配项目标，高亮实时预览</a></li><li><a href="#TOP_N_1112" rel="nofollow">分别找出男、女性别中年龄最小的三个人(TOP N)</a></li><li><a href="#tag_1156" rel="nofollow">查询tag中带有某些标签的或者出身地在某某地的人，按照年龄降序，并且分页</a></li></ul> 
   </li><li><a href="#_1201" rel="nofollow">总结</a></li><li><ul><li><a href="#API_1205" rel="nofollow">索引相关API：</a></li><li><a href="#API_1238" rel="nofollow">映射相关API：</a></li><li><a href="#API_1270" rel="nofollow">文档相关API：</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>前言</h3> 
<p>很久之前就写过ES相关的，但现在看起来好像都不太全面，这里在重新整理一版，还是接着之前的ES版本来，使用ES7.6， 环境还没搭建可以参考之前的<a href="https://blog.csdn.net/weixin_44102992/article/details/107954129?spm=1001.2014.3001.5501">liunx下安装elasticsearch7.6、ik分词器以及kibana可视化工具</a></p> 
<h3><a id="_3"></a>相关知识</h3> 
<p>Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。为了方便大家理解，这里将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比</p> 
<table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>概念类比</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>Mysql</td><td>表</td><td>表结构</td><td>行数据</td><td>列</td></tr><tr><td>ES</td><td>index（索引）</td><td>mapping</td><td>文档</td><td>字段</td></tr></tbody></table> 
<p><strong>因为ES中type的概念已经被废弃，所以可以简单认为index就是表</strong>（之前认为是库）</p> 
<p><strong>ES字段类型</strong>（很多建议看官网，这里只列举一部分常用）：</p> 
<ol><li> <p>String 类型，又分两种：</p> <p>text：可分词</p> <p>keyword：不可分词，数据会作为完整字段进行匹配</p> </li><li> <p>Numerical：数值类型，分两类</p> <p>基本数据类型：long、integer、short、byte、double、float、half_float</p> <p>浮点数的高精度类型：scaled_float</p> </li><li> <p>Date：日期类型</p> </li><li> <p>Array：数组类型 ：这个注意不需要显示的设置array类型，数据是[]就行了</p> </li><li> <p>Object：对象</p> </li><li> <p>boolean：布尔</p> </li><li> <p>地理数据类型：</p> 
  <ol><li>Geo-point： geo_point （纬度/经度积分）</li><li>Geo-shape: geo_shape (用于多边形等复杂形状)</li></ol> </li></ol> 
<blockquote> 
 <p><strong>大家应该对Msyql比较熟，Mysql都知道有建库、建表、CURD这种基础操作对吧，没错本文也就是教大家针对ES的CURD的API</strong></p> 
</blockquote> 
<p>测试数据实体类准备(接下来我们用来学习测试的数据类，结构都是基于此创建的)：</p> 
<pre><code class="prism language-Java">@Data
public class EsTest {
    private Long id;
    private String name;  // 姓名
    private String sex;   // 性别
    private Integer age;  // 年龄
    private String remark;// 备注
    private String[] tag; // 标签
    private String addressLocation; // 地址
    private String birthAddress; // 出生地
    private Date createTime; // 时间
    private Boolean hasGirlFriend; // 有女朋友？
}
</code></pre> 
<blockquote> 
 <p>ES API都等于是http接口，所以接下来一切操作都是http请求，所以我们用Postman来测试，主要是Postman可以用来整理收集API方便测试，当然你们也可以使用kibana来学习！</p> 
</blockquote> 
<blockquote> 
 <p><strong>注意：</strong> 以下测试索引名称都是es_test，截图中的esTest名称是因为当时测试用的es版本不是7.6，后面切成7.6后发现不支持大写索引</p> 
</blockquote> 
<h3><a id="_60"></a>索引相关</h3> 
<h4><a id="_62"></a>创建索引</h4> 
<pre><code class="prism language-Java">PUT http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)
</code></pre> 
<p>在这里插入图片描述</p> 
<p>结果：</p> 
<pre><code class="prism language-Java">{
 "acknowledged"【响应结果】: true, # true 操作成功
 "shards_acknowledged"【分片结果】: true, # 分片操作成功
 "index"【索引名称】: "shopping"
}

</code></pre> 
<h4><a id="_81"></a>查询索引</h4> 
<pre><code class="prism language-Java">GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)
</code></pre> 
<p><img src="https://images2.imgbox.com/1f/49/pjtDjeog_o.png" alt="在这里插入图片描述"></p> 
<p>结果(信息很多，后面有了全局观后相信你基本都能懂)：</p> 
<p><img src="https://images2.imgbox.com/39/e2/imAHeCU9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_95"></a>查询所有索引</h4> 
<pre><code class="prism language-Java">GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/_cat/indices?v
</code></pre> 
<p><strong>结果：</strong></p> 
<p><img src="https://images2.imgbox.com/44/12/hg6KTDVH_o.png" alt="在这里插入图片描述"></p> 
<p><strong>字段解释说明：</strong></p> 
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>health</td><td>当前服务器健康状态： green(集群完整) yellow(单点正常、集群不完整) red(单点不正常)</td></tr><tr><td>status</td><td>索引打开、关闭状态</td></tr><tr><td>index</td><td>索引名</td></tr><tr><td>uuid</td><td>索引统一编号</td></tr><tr><td>pri</td><td>主分片数量</td></tr><tr><td>rep</td><td>副本数量</td></tr><tr><td>docs.count</td><td>可用文档数量</td></tr><tr><td>docs.deleted</td><td>文档删除状态（逻辑删除）</td></tr><tr><td>store.size</td><td>主分片和副分片整体占空间大小</td></tr><tr><td>pri.store.size</td><td>主分片占空间大小</td></tr></tbody></table> 
<h4><a id="_122"></a>删除索引</h4> 
<p><img src="https://images2.imgbox.com/83/a6/P0YbZ0ev_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java">DELETE http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)
</code></pre> 
<h4><a id="_131"></a>关闭与打开索引</h4> 
<h5><a id="_133"></a>关闭索引</h5> 
<p><strong>注意：关闭索引后，该索引既不能读也不能写</strong></p> 
<pre><code class="prism language-Java">POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_close（关闭命令）
</code></pre> 
<p>返回：</p> 
<pre><code class="prism language-Java">{
    "acknowledged": true,
    "shards_acknowledged": true,
    "indices": {
        "esTest": {
            "closed": true
        }
    }
}
</code></pre> 
<h5><a id="_155"></a>打开索引</h5> 
<p>既然有关闭，就有打开</p> 
<pre><code class="prism language-Java">http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_open（开启命令）
</code></pre> 
<p>返回：</p> 
<pre><code class="prism language-Java">{
    "acknowledged": true,
    "shards_acknowledged": true
}
</code></pre> 
<h4><a id="_172"></a>冻结与解冻索引</h4> 
<h5><a id="_174"></a>冻结索引</h5> 
<p>与关闭不同的是：冻结后可读不可写</p> 
<pre><code class="prism language-Java">http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_freeze（冻结命令）
</code></pre> 
<p>返回：</p> 
<pre><code class="prism language-Java">{
    "acknowledged": true,
    "shards_acknowledged": true
}
</code></pre> 
<h5><a id="_191"></a>解冻索引</h5> 
<pre><code class="prism language-Java">http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/esTest(索引名称)/_unfreeze（解冻命令）
</code></pre> 
<p>返回：</p> 
<pre><code class="prism language-Java">{
    "acknowledged": true,
    "shards_acknowledged": true
}
</code></pre> 
<h3><a id="_206"></a>映射相关</h3> 
<p>上面索引创建好了，这里就要为索引映射对应的结构，也就是有哪些字段，字段类型啥的</p> 
<blockquote> 
 <p><strong>注意</strong>：事实上是可以一步创建索引到位的，这里拆开了</p> 
</blockquote> 
<h4><a id="_212"></a>创建映射</h4> 
<p><img src="https://images2.imgbox.com/e6/99/8RUqfXvy_o.png" alt="在这里插入图片描述"></p> 
<p>以最上面的实体类为例哈，注意对应</p> 
<pre><code class="prism language-Java">PUT http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_mapping（映射命令）
</code></pre> 
<p>JSON参数：</p> 
<pre><code class="prism language-Java">{
    "properties": {
        "name":{                       // 字段的名称
            "type":"text",             // 字段的类型，最上面有说明
            "analyzer":"ik_max_word"   // 分词器用ik
        },
        "remark":{
            "type":"text",
            "analyzer":"ik_max_word"
        },
        "tag":{
            "type":"keyword"          // 数组但不需要显示设置,传参用[]就好
        },
        "addressLocation": {
            "type": "text",
            "analyzer":"ik_max_word"
        },
        "age": {
            "type": "integer"
        },
        "sex": {
            "type": "keyword"
        },
        "birthAddress": {
            "type": "keyword"
        },
        "createTime": {
            "type": "date",
            "format": "yyyy-MM-dd HH:mm:ss"
        },
        "hasGirlFriend":{
            "type":"boolean"
        }
    }
}
</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-Java">{
    "acknowledged": true
}
</code></pre> 
<h4><a id="_271"></a>查看映射</h4> 
<pre><code class="prism language-Java">GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_mapping（映射命令）
</code></pre> 
<p>结果：<br> <img src="https://images2.imgbox.com/fe/6e/POvyGbPf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_281"></a>新增字段映射</h4> 
<p><img src="https://images2.imgbox.com/ac/7e/thyp0jL6_o.png" alt="在这里插入图片描述"></p> 
<p>和创建映射一样，只需新增新的字段映射就行了</p> 
<p>再次查看映射：</p> 
<p><img src="https://images2.imgbox.com/93/49/HbV3llRu_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>**注意：**ES和Mysql不同，字段一旦创建就不能在修改类型或者删除了，只能新增字段</p> 
</blockquote> 
<p>比如：我尝试修改newField字段类型，就会报错</p> 
<p><img src="https://images2.imgbox.com/50/ac/wXr4tpnC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="CURD_300"></a>文档相关(CURD)</h3> 
<h4><a id="_302"></a>新增文档</h4> 
<p>这个其实就是插入一条数据</p> 
<p><img src="https://images2.imgbox.com/18/0f/FBb0JEo7_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java"># 不指定id插入
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_doc（文档命令）

# 指定ID插入 
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_doc（文档命令）/1（ID）

</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-Java"># 不指定id插入结果
{
    "_index": "esTest",
    "_type": "_doc",
    "_id": "7yAE8okBKIfCcGUeHKBr", // 没有指定id，就会随机生成
    "_version": 1,
    "result": "created", // 这里的 create 表示创建成功
    "_shards": {
        "total": 2,
        "successful": 2,
        "failed": 0
    },
    "_seq_no": 0,
    "_primary_term": 7
}

# 指定ID插入结果
{
    "_index": "esTest",
    "_type": "_doc",
    "_id": "1",    // 指定id
    "_version": 1,
    "result": "created",
    "_shards": {
        "total": 2,
        "successful": 2,
        "failed": 0
    },
    "_seq_no": 1,
    "_primary_term": 7
}

</code></pre> 
<h4><a id="ID_355"></a>根据ID查询</h4> 
<pre><code class="prism language-Java">GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_doc（文档命令）/1（ID）
</code></pre> 
<p>结果：</p> 
<p><img src="https://images2.imgbox.com/93/fe/VBYiEE1n_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_366"></a>修改文档</h4> 
<h5><a id="_368"></a>全量覆盖</h5> 
<p>这个覆盖就等于是根据ID再次插入一次，就会把之前的给覆盖了</p> 
<p><img src="https://images2.imgbox.com/3c/74/VgsTEpMT_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="ID_375"></a>根据ID选择性修改</h5> 
<p>会根据ID修改文档中的部分字段<br> <img src="https://images2.imgbox.com/2c/ce/GB2wM6KI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java">POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_update(更新)/1(ID)
</code></pre> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java">{ 
 "doc": {
   "age":200
 } 
}
</code></pre> 
<h5><a id="_395"></a>根据条件批量更新</h5> 
<p>根据条件更新所有匹配的文档，如Mysql中 set xxx where xxxx<br> <img src="https://images2.imgbox.com/6c/be/GRlIxoFh_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java">POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_update_by_query(命令)
</code></pre> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java">{ 
 "query": {   // 查询
     "term":{
         "age":200
     }
 },
 "script": {  // 脚本
    "source": "ctx._source['age']='300';ctx._source['remark']='根据条件批量更新';"
  }
}
</code></pre> 
<h4><a id="_420"></a>删除文档</h4> 
<h5><a id="ID_422"></a>根据ID删除</h5> 
<p>这里将上面ID自动生成的数据删掉<br> <img src="https://images2.imgbox.com/23/91/YwpYAdSr_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java">DELETE http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/esTest(索引名称)/_doc(命令)/7yAE8okBKIfCcGUeHKBr(ID)
</code></pre> 
<h5><a id="_432"></a>根据条件删除</h5> 
<p><img src="https://images2.imgbox.com/b9/41/ryrPlyJf_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-Java">POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_delete_by_query(命令)

</code></pre> 
<p>JSON传参(查询条件):</p> 
<pre><code class="prism language-Java">{ 
 "query": {
     "term":{
         "age":300
     }
 }
}
</code></pre> 
<h4><a id="_454"></a>批量操作</h4> 
<pre><code class="prism language-Java">POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_bulk(命令)
</code></pre> 
<p>语法：</p> 
<pre><code class="prism language-Java">{ action: { metadata }}  // 命令类型
{ request body        }  // 请求体   

action 类型如下：
  create 如果文档不存在就创建，但如果文档存在就返回错误
  index 如果文档不存在就创建，如果文档存在就更新
  update 更新一个文档，如果文档不存在就返回错误
  delete 删除一个文档，如果要删除的文档id不存在，就返回错误

</code></pre> 
<p>有点懵？看看下面示例</p> 
<h5><a id="_476"></a>批量插入</h5> 
<p><img src="https://images2.imgbox.com/5e/ed/VaLWPhTF_o.png" alt="在这里插入图片描述"></p> 
<p>JSON传参如下：</p> 
<pre><code class="prism language-Java">{"index": {"_id": 1}} 
{"addressLocation":"Suite 379 崔侬833号, 成都, 赣 142109","age":15,"birthAddress":"银川","createTime":"2023-04-19 01:09:02","hasGirlFriend":true,"id":1,"name":"萧烨霖","remark":"待种性证且认证织不格次断性作性对责上责向负于升一人朗活多上度度好上组积有负喜提喜好习于心本间不心间高极证难广欢人认人身进","sex":"男","tag":["动提活","些负本","学身些"]}
{"index": {"_id": 2}}
{"addressLocation":"Apt. 749 李桥2006号, 克拉玛依, 晋 298276","age":16,"birthAddress":"东营","createTime":"2023-07-09 20:18:58","hasGirlFriend":true,"id":2,"name":"龚乐驹","remark":"且参广在活学人自本能身期认战学心向工责不向动向在作广加工期于进开且学极度织提广难自活度爱于爱上证好认提爱证战工加进能期织","sex":"男","tag":["参开积","种提工","多升人"]}
{"index": {"_id": 3}}
{"addressLocation":"邹桥1915号, 金华, 粤 608459","age":7,"birthAddress":"寿光","createTime":"2023-03-24 05:02:23","hasGirlFriend":true,"id":3,"name":"萧雨泽","remark":"参积对学积向断些活认参欢极动园积些升次习活断进于度朗对活积活校欢性步活广对有校极心种负极学喜自积学校自对不人格进对难积加","sex":"男","tag":["活人进","校织且","本泛工"]}
// 注意最后需要有一个空行
</code></pre> 
<p>返回：</p> 
<p><img src="https://images2.imgbox.com/65/fa/Ny1C9wTy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_498"></a>批量更新</h5> 
<p>JSON传参:</p> 
<pre><code class="prism language-Java">{"update": {"_id": 1}} 
{"doc":{"age":35}}
{"update": {"_id": 2}}
{"doc":{"age":45}}
{"update": {"_id": 3}}
{"doc":{"age":55}}


</code></pre> 
<h5><a id="_513"></a>批量删除</h5> 
<p>JSON传参（删除不在需要数据请求体了）:</p> 
<pre><code class="prism language-Java">{"delete": {"_id": 1}}
{"delete": {"_id": 2}}
{"delete": {"_id": 3}}


</code></pre> 
<h5><a id="_525"></a>混合操作</h5> 
<p>从上面可以看出一个批次只要符合语法即可，并没有规定一个批次必须全部是插入或者更新，所以可以混着来</p> 
<p>JSON传参（插入、更新、删除）:</p> 
<pre><code class="prism language-Java">{"index": {"_id": 1}} 
{"addressLocation":"Suite 379 崔侬833号, 成都, 赣 142109","age":15,"birthAddress":"银川","createTime":"2023-04-19 01:09:02","hasGirlFriend":true,"id":1,"name":"萧烨霖","remark":"待种性证且认证织不格次断性作性对责上责向负于升一人朗活多上度度好上组积有负喜提喜好习于心本间不心间高极证难广欢人认人身进","sex":"男","tag":["动提活","些负本","学身些"]}
{"update": {"_id": 1}} 
{"doc":{"age":35}}
{"delete": {"_id": 1}}


</code></pre> 
<h4><a id="_541"></a>文档查询</h4> 
<p>下面介绍关于文档查询的一些常规操作，首先咱们准备一批数据，就用批量插入插入20条数据：</p> 
<pre><code class="prism language-Java">{"index": {"_id": 1}} 
{"addressLocation":"袁路4号, 兰州, 渝 257456","age":14,"birthAddress":"本溪","createTime":"2023-01-26 02:36:38","hasGirlFriend":true,"id":1,"name":"唐聪健","remark":"爱学本积战校能动进校学校校织期有高加断于高人心证爱不极责极参工认一学极活广多活向园极开责校泛欢期难对习向不待格加身责难爱","sex":"男","tag":["不朗开","负待责","断性活"]}
{"index": {"_id": 2}} 
{"addressLocation":"Apt. 324 严侬745号, 长春, 京 130625","age":13,"birthAddress":"马鞍山","createTime":"2023-09-02 22:03:28","hasGirlFriend":false,"id":2,"name":"黎鑫磊","remark":"待向战期格格次格对进勤有身难园种对证织动学好活向校活上一本习各战性且参于校认组种有进间习开自好对积且对有织格勤一挑间人种","sex":"女","tag":["待动作","断能能","难身且"]}
{"index": {"_id": 3}} 
{"addressLocation":"刘桥4792号, 常德, 黑 072905","age":8,"birthAddress":"聊城","createTime":"2023-07-02 04:28:28","hasGirlFriend":false,"id":3,"name":"廖峻熙","remark":"待间园习活且活习习喜且多不在作多一负开好习加于进性学多步期有责在织一积园断动自且度次参习欢高极度高难进爱活期作格极活断待","sex":"男","tag":["些次好","提有且","一不加"]}
{"index": {"_id": 4}} 
{"addressLocation":"魏街66126号, 大连, 桂 915784","age":26,"birthAddress":"大庆","createTime":"2023-02-25 02:23:12","hasGirlFriend":true,"id":4,"name":"林弘文","remark":"在积动加极提一学身园高开本难自多工性泛提习好上能极习证向且步组自间间待进一上学证能习泛参活校进在积极有人不间心一作升身好","sex":"女","tag":["高于动","自极度","一作习"]}
{"index": {"_id": 5}} 
{"addressLocation":"郝巷2049号, 福州, 辽 501436","age":10,"birthAddress":"常州","createTime":"2023-06-28 15:40:22","hasGirlFriend":false,"id":5,"name":"何靖琪","remark":"对极欢各不积心动不挑间本织种度极好责种织认间广格且喜泛且积园步习责于工些待组待步动不朗进好开待泛战难在动向爱参认组各性本","sex":"男","tag":["次活挑","本学动","格作战"]}
{"index": {"_id": 6}} 
{"addressLocation":"顾路43号, 清远, 澳 044930","age":25,"birthAddress":"库尔勒","createTime":"2023-11-11 07:24:33","hasGirlFriend":false,"id":6,"name":"林瑾瑜","remark":"习好加上难挑喜欢上能作上升勤学好欢上爱勤校勤向有身爱不组积有极性对勤各间难动爱高证升一各上多勤爱升活上织积能难责不作本身","sex":"女","tag":["高欢在","性于身","向泛动"]}
{"index": {"_id": 7}} 
{"addressLocation":"Suite 856 尹中心17号, 桂林, 沪 796643","age":10,"birthAddress":"兰州","createTime":"2023-08-25 01:35:06","hasGirlFriend":true,"id":7,"name":"马金鑫","remark":"校责有极些有度喜待难间织种欢开间些朗开积难泛习期向向自勤工身挑作习各上各爱动进格朗断活有喜提升负园度喜步断间间加积学欢极","sex":"男","tag":["高习上","上多极","心多园"]}
{"index": {"_id": 8}} 
{"addressLocation":"Apt. 197 顾侬389号, 鞍山, 琼 662755","age":16,"birthAddress":"银川","createTime":"2023-10-15 20:54:05","hasGirlFriend":false,"id":8,"name":"卢建辉","remark":"欢本广待习间断本在度活于欢学向上待喜动一广心泛活极不习自极习对升广升参好待责不心喜待园织爱活学负极作升对泛且习提各认本加","sex":"女","tag":["身勤能","进好积","向本于"]}
{"index": {"_id": 9}} 
{"addressLocation":"Suite 609 邹栋3139号, 义乌, 辽 064191","age":17,"birthAddress":"锦州","createTime":"2023-12-20 06:27:03","hasGirlFriend":false,"id":9,"name":"顾伟宸","remark":"工活一工高次广于本多一自极组习战间高泛极次断些有待待动极广各人证勤难加喜有责学一提人极断组于爱间难断自于于欢身于于次园好","sex":"男","tag":["能断向","格期向","广活断"]}
{"index": {"_id": 10}} 
{"addressLocation":"洪中心1257号, 延安, 蒙 239652","age":28,"birthAddress":"阳泉","createTime":"2023-07-10 09:17:22","hasGirlFriend":true,"id":10,"name":"邵航","remark":"活参升人提活对能爱待习参步种格不广积认积心织些人步挑喜待身一学升广活积负进爱加度园学多负上待一上极作本度活积断积上自广不","sex":"女","tag":["朗参欢","加战好","提开动"]}
{"index": {"_id": 11}} 
{"addressLocation":"Apt. 566 朱中心15596号, 苏州, 蒙 414237","age":15,"birthAddress":"章丘","createTime":"2023-11-30 03:56:59","hasGirlFriend":false,"id":11,"name":"任文博","remark":"好身责间高于工欢上战喜在性作开些极积朗开上勤负度步习断广活泛提作难格种难欢进间心各上广各高人心难认战在向加一进升上园好责","sex":"男","tag":["欢活心","向加习","且作积"]}
{"index": {"_id": 12}} 
{"addressLocation":"Suite 412 毛路583号, 阳泉, 川 784567","age":11,"birthAddress":"深圳","createTime":"2023-06-26 14:34:34","hasGirlFriend":false,"id":12,"name":"张睿渊","remark":"证组进于学习格活好活责责加一勤能各断步好些参喜开喜织织待上且参人喜对积高提积欢难在好工上工度战种进待人极在织习且步活泛进","sex":"女","tag":["性向种","升作有","证对在"]}
{"index": {"_id": 13}} 
{"addressLocation":"秦栋922号, 天津, 黑 473977","age":13,"birthAddress":"玉溪","createTime":"2023-04-15 08:55:13","hasGirlFriend":true,"id":13,"name":"梁雨泽","remark":"参性泛泛证挑工极学性待喜待种向格各不学园织积开加勤进校本学提认证开学向勤爱泛学待动人校活待一喜向不战喜负能爱欢广些心校在","sex":"男","tag":["自习上","上格心","挑广喜"]}
{"index": {"_id": 14}} 
{"addressLocation":"Suite 763 余侬7165号, 宜兴, 澳 593952","age":27,"birthAddress":"泸州","createTime":"2023-11-02 06:59:52","hasGirlFriend":false,"id":14,"name":"孔文轩","remark":"期极证欢且园各不间证间对校且喜广作证证动认有活能战学身喜组学且心朗负习且勤喜战学极种积动待各习有不对动进习度动挑好学各校","sex":"女","tag":["高一难","有上一","极步习"]}
{"index": {"_id": 15}} 
{"addressLocation":"谢侬83号, 本溪, 琼 302813","age":29,"birthAddress":"马鞍山","createTime":"2023-11-03 09:37:34","hasGirlFriend":false,"id":15,"name":"雷凯瑞","remark":"些积极习一好高织极挑动证组证种间性待开活有于向多升期认校期期活织自责多上欢次不进进习学度战作向欢提学战有学积极织习组学能","sex":"男","tag":["多待步","极升自","责证动"]}
{"index": {"_id": 16}} 
{"addressLocation":"Suite 522 尹旁9483号, 招远, 陕 577762","age":15,"birthAddress":"银川","createTime":"2023-03-17 10:06:36","hasGirlFriend":true,"id":16,"name":"郝博涛","remark":"一向在习些工进参种不进断上于组难向断自作进泛作次向断格加进织上高参动对上升人间断步负朗责勤习升组工认些间挑组高心极织积自","sex":"女","tag":["工挑本","间向一","对朗步"]}
{"index": {"_id": 17}} 
{"addressLocation":"Apt. 687 彭侬07号, 丹东, 京 474506","age":22,"birthAddress":"茂名","createTime":"2023-01-15 13:35:04","hasGirlFriend":false,"id":17,"name":"徐博文","remark":"本学格格些难难认多工责参提勤对广且期证步种各多挑格各本高升步织责向难难多种积不自期好断有学能本于有积责次上本极习积性断积","sex":"男","tag":["进待难","活作欢","种活升"]}
{"index": {"_id": 18}} 
{"addressLocation":"Apt. 419 姜侬85号, 珠海, 蒙 453475","age":22,"birthAddress":"唐山","createTime":"2023-11-04 14:31:00","hasGirlFriend":false,"id":18,"name":"罗晓博","remark":"待加在习度进喜参种活断人活极欢组上动习积活各种待不多人本欢能认进高性活朗提身织工爱性期期对步勤广次不步战勤步动格作学勤进","sex":"女","tag":["待参且","活组习","参习极"]}
{"index": {"_id": 19}} 
{"addressLocation":"蔡巷06117号, 泸州, 浙 333047","age":25,"birthAddress":"肇庆","createTime":"2023-04-25 20:05:49","hasGirlFriend":true,"id":19,"name":"吴哲瀚","remark":"织泛断些积间欢格间勤步参次于加对喜在积人负间性广开一次习些些学积爱向极广人进次向断自上认开活积有习证一上参学间在本进挑性","sex":"男","tag":["学上能","各待上","喜加泛"]}
{"index": {"_id": 20}} 
{"addressLocation":"唐栋321号, 梅州, 黑 358103","age":10,"birthAddress":"无锡","createTime":"2023-10-26 15:00:19","hasGirlFriend":false,"id":20,"name":"龚晓啸","remark":"组步间广积活间勤于加些不在提积进负在高格战次积各期于开度极责朗对且于动战喜上证泛作动期园步向期间积朗种勤种挑提升学上一习","sex":"女","tag":["园作进","有在断","进积身"]}

</code></pre> 
<p>请求路径如下：</p> 
<pre><code class="prism language-Java">GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/es_test(索引名称)/_search(命令)
</code></pre> 
<h5><a id="_595"></a>查询所有文档</h5> 
<p><img src="https://images2.imgbox.com/25/56/Mp1XCtAk_o.png" alt="在这里插入图片描述"></p> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java">{
 "query": {
 "match_all": {}
 }
}
</code></pre> 
<p>结果(数据默认返回10条)：</p> 
<pre><code class="prism language-Java">{
    "took": 1,                   // 查询花费时间，单位毫秒
    "timed_out": false,          // 是否超时
    "_shards": {                 // 分片信息
        "total": 1,
        "successful": 1,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": {
            "value": 20,          // 总命中计数的值
            "relation": "eq"      // eq 表示计数准确， gte 表示计数不准确
        },
        "max_score": 1.0,
        "hits": [                 // 命中结果集合
         
        ]
    }
}
</code></pre> 
<h5><a id="_635"></a>精准条件查询</h5> 
<p>等于不分词搜索，类似Mysql中 xxx=xxx</p> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java"># 单关键词匹配，关键命令：term  类似 Mysql：field=xxxx
{
    "query": {
        "term": {                     // 命令
            "tag": {                  // 匹配字段名称
                "value": "高于动"      // 匹配值
            }
        }
    }
}

# 多关键词匹配，关键命令：terms 类似 Mysql：field in ( xxxx,yyyy)
{
    "query": {
        "terms": {    // 多关键词精准匹配
            "tag":["断能能","高于动"]
        }
    }
}

</code></pre> 
<h5><a id="_664"></a>分词查询</h5> 
<p>命令有（至于效果就自己尝试feel一下吧）：</p> 
<ul><li>match：查询条件也会分词，然后查询分词字段</li><li>match_phrase：查询条件不分词，然后整体作为关键词查询分词字段</li><li>multi_match：查询条件分词，查询多个分词字段</li></ul> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java"># 查询条件也会分词，然后查询分词字段
{
    "query": {
        "match": {
            "name": "林瑾"
        }
    }
}
# 查询条件不分词，然后整体作为关键词查询分词字段
{
    "query": {
        "match_phrase": {
            "name": "林瑾"
        }
    }
}
# 查询条件分词，查询多个分词字段
{
    "query": {
        "multi_match": {
            "query": "林弘文",
            "fields": ["name","remark"]  
        }
    }
}

</code></pre> 
<h5><a id="_703"></a>查询字段过滤</h5> 
<p>不想查询返回所有字段，所以通过这个可以控制想返回的字段、不想返回的字段</p> 
<p>语法：</p> 
<pre><code class="prism language-Java">"_source": {
        "includes": ["ddddd","aaaaaa"], // 想返回的字段名称
        "excludes": ["xxxx","yyyyyy"], // 不想返回的字段名称
    }
</code></pre> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java">{
    "_source": {
        "includes": [
            "name",
            "remark"
        ]
    },
    "query": {
        "multi_match": {
            "query": "林弘文",
            "fields": ["name","remark"]  
        }
    }
}
</code></pre> 
<p>结果:<br> <img src="https://images2.imgbox.com/1b/ff/0lYG3Sqz_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_739"></a>范围查询</h5> 
<p>首先看看4个运算符</p> 
<ol><li>gt : 大于&gt;</li><li>gte : 大于等于&gt;=</li><li>lt : 小于&lt;</li><li>lte : 小于等于&lt;=</li></ol> 
<p>JSON传参示例：</p> 
<pre><code class="prism language-Java"># 查询创建时间 &gt;="2023-07-10 00:00:00" and &lt;="2023-12-10 23:59:59"
{
    "query": {
        "range": {
            "createTime": {
                "gte": "2023-07-10 00:00:00",
                "lte": "2023-12-10 23:59:59"
            }
        }
    }
}
# 查询年龄 &gt;25 and &lt;28
{
    "query": {
        "range": {
            "age": {
                "gt": 25,
                "lt": 28
            }
        }
    }
}

</code></pre> 
<h5><a id="_776"></a>组合查询</h5> 
<ul><li>must查询：表示必须满足的查询条件，相当于逻辑运算中的“与”。如果某条文档满足所有的must查询条件，才会被返回。</li><li>should查询：表示可选的查询条件，相当于逻辑运算中的“或”。如果某条文档满足其中任意一个should查询条件，则会被返回。</li><li>must_not查询：表示必须不满足的查询条件，相当于逻辑运算中的“非”。如果某条文档满足任意一个must_not查询条件，则不会被返回。</li></ul> 
<p><strong>查询 age≥26 and sex≠男</strong> （可以观察一下<strong>or</strong> <strong>birthAddress=深圳</strong> 是否生效）</p> 
<p><strong>注意：must和should一起用，should是不生效的</strong></p> 
<pre><code class="prism language-Java">{
    "query": {
        "bool": {
            "must": [
                {
                    "range": {
                        "age": {
                            "gte":26
                        }
                    }
                }
            ],
            "must_not": [
                {
                    "term": {
                        "sex": "男"
                    }
                }
            ],
            "should": [
                {
                    "term": {
                        "birthAddress": "深圳"
                    }
                }
            ]
        }
    }
}
</code></pre> 
<h5><a id="_818"></a>高亮查询</h5> 
<p>就是匹配中的关键词可以高亮显示</p> 
<pre><code class="prism language-Java">{
    "query": {
        "match": {
            "remark": "喜欢"
        }
    },
    "highlight": {
        "pre_tags": "&lt;font color='red'&gt;",       // 前置标签
        "post_tags": "&lt;/font&gt;",                 // 后置标签
        "fields": {                             // 需要高亮的字段，一般和搜索字段对应
            "remark": {}
        }
    }
}
</code></pre> 
<p>结果：</p> 
<p><img src="https://images2.imgbox.com/e3/f3/baGUQ7xJ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_844"></a>排序/分页</h5> 
<p>JSON传参：</p> 
<pre><code class="prism language-Java">{
    "query": {
        "range": {
            "age": {
                "gt": 20,
                "lt": 28
            }
        }
    },
    "sort": [
        {
            "age": {
                "order": "desc"   // 按年龄降序
            }
        },{
            "_score":{
                "order": "desc"   // 年龄相同则按照相关性得分降序
            }
        }
    ],
    "from":0,        // 当前页的起始索引，默认从 0 开始。 from = (pageNum - 1) * size
    "size":5         // 每页条数
}
</code></pre> 
<h5><a id="_874"></a>聚合/分组查询</h5> 
<p><strong>求一年内 年龄的最大值、最小值、总和、平均值、去重后总数量</strong></p> 
<pre><code class="prism language-Java"> {
     "query": {
        "range": {
            "createTime": {
                "gte": "2023-07-10 00:00:00",
                "lte": "2023-12-10 23:59:59"
            }
        }
    },
    "aggs": {                        // 聚合操作
        "max_age": {                 // 最大值聚合后字段
            "max": {                 // 最大值聚合
                "field": "age"       // 字段名称
            }
        },
        "min_age": {                 // 最小值聚合后字段
            "min": {                 // 最小值聚合
                "field": "age"       // 字段名称
            }
        },
        "sum_age": {                 // 总和聚合后字段
            "sum": {                 // 总和聚合
                "field": "age"       // 字段名称
            }
        },
        "avg_age": {                 // 平均值聚合后字段
            "avg": {                 // 平均值聚合
                "field": "age"       // 字段名称
            }
        },
        "distinct_age": {            // 重复值去重聚合后字段
            "cardinality": {         // 去重聚合
                "field": "age"       // 字段名称
            }
        }
    },
    "size": 0 // 参数表示不用返回文档列表，只返回汇总的数据即可
}

</code></pre> 
<p><strong>一次性算出age的总数量（没去重）、最小值、最大值、平均值、总和</strong></p> 
<pre><code class="prism language-Java">{
     "query": {
        "range": {
            "createTime": {
                "gte": "2023-07-10 00:00:00",
                "lte": "2023-12-10 23:59:59"
            }
        }
    },
    "aggs": {
        "stats_age": {
            "stats": {
                "field": "age"
            }
        }
    },
    "size": 0
}
</code></pre> 
<p><strong>根据年龄分组，查询每组最大id（分组就是groupBy）</strong></p> 
<pre><code class="prism language-Java">{
    "aggs": {
        "age_groupby": {  // 分组后返回字段
            "terms": {
                "field": "age"
            },
            "aggs": {
                "max_age": {
                    "max": {
                        "field": "id"
                    }
                }
            }
        }
    },
    "size": 0
}
</code></pre> 
<h3><a id="_965"></a>场景查询实操</h3> 
<p>查询有非常多的语法，上面也介绍的也只是常规查询的一部分，下面用一些SQL场景来对标ES中的查询,不妨也自己试试看看能否对照的写出来？</p> 
<h5><a id="2023_969"></a>查询2023年中男、女的数量并找出对应的最大/最小年龄</h5> 
<pre><code class="prism language-Java">## SQL： 
  select sex,count(*),max(age),min(age)  
  from es_test 
  where create_time between "xxxx" and "xxx" 
  group by sex

## ES:
{
    "query":{
        "range": {
            "createTime": {
                "gte": "2023-01-01 00:00:00",
                "lte": "2023-12-31 23:59:59"
            }
        }
    },
    "aggs": {
        "age_groupby": {
            "terms": {
                "field": "sex"
            },
            "aggs": {
                "max_age": {
                    "max": {
                        "field": "age"
                    }
                },
                "min_age": {
                    "min": {
                        "field": "age"
                    }
                }
            }
        }
    },
    "size": 0
}

</code></pre> 
<p><img src="https://images2.imgbox.com/a7/53/qeW2Y8Zf_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="______1830_1015"></a>查询在地址中包含 “泸州” 或者 备注中包含 “积极” 的 男性青年(18-30岁),要求关键词高亮</h5> 
<pre><code class="prism language-Java">## SQL： 
  select xxxx,xxxx,xxx
  from es_test 
  where sex="男" and age between 18 and 30
    and (addressLocation like "%阳泉%" or remark like "%积极%" )
    
## ES:
{
    "query": {
        "bool": {
            "must": [
                {
                    "term": {
                        "sex": {
                            "value": "男"
                        }
                    }
                },
                {
                    "range": {
                        "age": {
                            "gte": 18,
                            "lte": 30
                        }
                    }
                },
                {
                    "bool": {
                        "should": [
                            {
                                "match": {
                                    "addressLocation": "泸州"
                                }
                            },
                            {
                                "match": {
                                    "remark": "积极"
                                }
                            }
                        ]
                    }
                }
            ]
        }
    },
    "highlight": {
        "pre_tags": "&lt;font color='red'&gt;",
        "post_tags": "&lt;/font&gt;",
        "fields": {
            "addressLocation": {},
            "remark": {}
        }
    }
}

</code></pre> 
<h4><a id="_1075"></a>搜索框：要求根据关键字找出匹配项目标，高亮实时预览</h4> 
<p>（搜地址、名称，返回名称+id + 地址）</p> 
<pre><code class="prism language-Java">## SQL： 
  select id,name,addressLocation 
  from es_test 
  where addressLocation like "%xx%" or name like "%xx%"

## ES:
{
    "_source": {
        "includes": [
            "name",
            "id",
            "addressLocation"
        ]
    },
    "query": {
        "multi_match": {
            "query": "林弘文",
            "fields": ["name","remark","addressLocation"]  
        }
    },
    "highlight": {
        "pre_tags": "&lt;font color='red'&gt;",
        "post_tags": "&lt;/font&gt;",
        "fields": {
            "addressLocation": {},
            "name": {}
        }
    }
}

</code></pre> 
<h4><a id="TOP_N_1112"></a>分别找出男、女性别中年龄最小的三个人(TOP N)</h4> 
<pre><code class="prism language-Java"># SQL:
  select *
  from es_test a
  left join (
      SELECT sex,SUBSTRING_INDEX(GROUP_CONCAT(DISTINCT age),",",3) as age
      FROM es_test 
      GROUP BY sex
      ORDER BY age DESC
  )b on a.sex=b.sex
  where FIND_IN_SET(a.age,b.age)
 
 # ES:
 {
   "aggs":{
    "top_tags":{
      "terms":{
        "field":"sex"
      },
      "aggs":{
        "top_sales_hits":{
          "top_hits":{
            "sort":[
              {
                "age":{
                  "order":"asc"
                }
              }
            ],
            "_source":{
              "includes":["name","sex","age"]
            },
            "size":3
          }
        }
      }
    }
  }
}

</code></pre> 
<h4><a id="tag_1156"></a>查询tag中带有某些标签的或者出身地在某某地的人，按照年龄降序，并且分页</h4> 
<pre><code class="prism language-Java"># SQL:
  select *
  from es_test
  where tag in (xxxx,xxxxx) or birthAddress in (xxxx,xxx)
  order by age
  limit 0,5
  
# ES:
{
   "query": {
       "bool":{
           
           "should":[
               {
                    "terms" : { 
                        "tag":["断能能","高于动","上格心","对朗步"]
                    }
                },
               {
                    "terms" : { 
                        "birthAddress":["深圳","章丘"]
                    }
                }
           ]
       }
    },
    "sort": [
        {
            "age": {
                "order": "desc"
            }
        },{
            "_score":{
                "order": "desc"
            }
        }
    ],
    "from":0,
    "size":2
}
</code></pre> 
<h3><a id="_1201"></a>总结</h3> 
<p><strong>这里的使用肯定是不全的，只是带大家入门，哪里看全的？</strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/elasticsearch-intro.html" rel="nofollow"><strong>官方文档</strong></a></p> 
<h4><a id="API_1205"></a>索引相关API：</h4> 
<pre><code class="prism language-Java"># 创建索引
PUT http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)

# 查询索引
GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)

# 查询所有索引
GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/_cat/indices?v

# 删除索引
DELETE http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)

# 关闭索引
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_close

# 打开索引
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_open

# 冻结索引
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_freeze

# 解冻索引
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_unfreeze

# 判断索引是否存在
HEAD http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)


</code></pre> 
<h4><a id="API_1238"></a>映射相关API：</h4> 
<pre><code class="prism language-Java"># 给索引创建映射
PUT http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_mapping
JSON 传参：
{
    "properties": {
        "字段名称":{
            "type":"xxxx",
        },
       .......
    }
}

# 查看索引映射
GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_mapping

# 新增字段的映射
PUT http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_mapping
JSON 传参：
{
    "properties": {
        "new字段":{
            "type":"xxxx",
        },
       .......
    }
}

</code></pre> 
<h4><a id="API_1270"></a>文档相关API：</h4> 
<pre><code class="prism language-Java"># 不指定id插入
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_doc（文档命令）
JSON 传参：{}

# 指定ID插入 
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_doc（文档命令）/xx（ID）
JSON 传参：{}

# 根据ID查询
GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_doc/1

# 根据添加查询更新
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_update_by_query
JSON 传参：{}

# 根据ID删除
DELETE http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_doc/1

# 根据添加删除
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_delete_by_query
JSON 传参：{}

# 批量操作
POST http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_bulk
JSON 传参：
{ action: { metadata }}  // 命令类型
{ request body        }  // 请求体   

# 条件查询（不同传参）
GET http://{<!-- -->{es_ip}}:{<!-- -->{es_port}}/xxxx(索引名称)/_search
JSON 传参：{}

</code></pre> 
<p>下章教大家怎么用java应用来实现上述的操作！！<br> 干货提前学习：<a href="https://returnac.cn/" rel="nofollow">个人博客</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c06341706663fa46b8ec0f6fa40af1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2024届飞书校招正式批</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1f8fcc9e416baa3992ea5f659d18634/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Android】使用 adb 命令行工具结合 pm列出 Android 设备上已安装应用的应用名称和包名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>