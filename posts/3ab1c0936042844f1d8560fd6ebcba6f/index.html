<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>redis 集群配置 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="redis 集群配置" />
<meta property="og:description" content="1 . 存在的问题 单台redis容量限制，如何进行扩容？继续加内存、加硬件么？单台redis并发写量太大有性能瓶颈，如何解决？redis3.0中提供了集群可以解决这些问题。 2 . 什么是集群 redis集群是对redis的水平扩容，即启动N个redis节点，将整个数据分布存储在这个N个节点中，每个节 点存储总数据的1/N。
如下图：由3台master和3台slave组成的redis集群，每台master承接客户端三分之一请求和写入的数
据，当master挂掉后，slave会自动替代master，做到高可用。
3 . 集群如何配置？ 3.1 需求： 配置3主3从集群 下面我们来配置一个3主3从的集群，每个主下面挂一个slave，master挂掉后，slave会被提升为 master。
为了方便，我们在一台机器上进行模拟，我的机器ip是：192.168.200.129，通过端口来区分6个不同的 节点，配置信息如下
3.2 创建案例工作目录：cluster 执行下面命令创建 /opt/cluster 目录，本次所有操作，均在 cluster 目录进行。
# 方便演示，停止所有的redis ps -ef | grep redis | awk -F&#34; &#34; &#39;{print $2;}&#39; | xargs kill -9 mkdir /opt/cluster cd /opt/cluster/ 3.3 将redis.conf复制到cluster目录 redis.conf 是redis默认配置文件
cp /opt/redis-6.2.1/redis.conf /opt/cluster/ 3.4 创建master1的配置文件：redis-6379.conf 在/opt/cluster目录创建 redis-6379.conf 文件，内容如下，注192.168.200.129 是这个测试机器的 ip，大家需要替换为自己的
include /opt/cluster/redis.conf daemonize yes bind 192.168.200.129 dir /opt/cluster/ port 6379 dbfilename dump_6379." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/3ab1c0936042844f1d8560fd6ebcba6f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-01T11:22:57+08:00" />
<meta property="article:modified_time" content="2023-11-01T11:22:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">redis 集群配置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1___0"></a>1 . 存在的问题</h3> 
<ol><li>单台redis容量限制，如何进行扩容？继续加内存、加硬件么？</li><li>单台redis并发写量太大有性能瓶颈，如何解决？</li><li>redis3.0中提供了集群可以解决这些问题。</li></ol> 
<h3><a id="2___6"></a>2 . 什么是集群</h3> 
<blockquote> 
 <p>redis集群是对redis的水平扩容，即启动N个redis节点，将整个数据分布存储在这个N个节点中，每个节 点存储总数据的1/N。</p> 
</blockquote> 
<blockquote> 
 <p>如下图：由3台master和3台slave组成的redis集群，每台master承接客户端三分之一请求和写入的数<br> 据，当master挂掉后，slave会自动替代master，做到高可用。<br> <img src="https://images2.imgbox.com/54/96/M2xw6brq_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h3><a id="3___13"></a>3 . 集群如何配置？</h3> 
<h6><a id="31__14"></a>3.1 需求：</h6> 
<blockquote> 
 <p>配置3主3从集群 下面我们来配置一个3主3从的集群，每个主下面挂一个slave，master挂掉后，slave会被提升为 master。</p> 
</blockquote> 
<blockquote> 
 <p>为了方便，我们在一台机器上进行模拟，我的机器ip是：192.168.200.129，通过端口来区分6个不同的 节点，配置信息如下<br> <img src="https://images2.imgbox.com/af/d4/Ey5Gnhh7_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h6><a id="32_cluster_19"></a>3.2 创建案例工作目录：cluster</h6> 
<blockquote> 
 <p>执行下面命令创建 /opt/cluster 目录，本次所有操作，均在 cluster 目录进行。</p> 
</blockquote> 
<pre><code class="prism language-javascript"># 方便演示，停止所有的redis
ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep redis <span class="token operator">|</span> awk <span class="token operator">-</span><span class="token constant">F</span><span class="token string">" "</span> <span class="token string">'{print $2;}'</span> <span class="token operator">|</span> xargs kill <span class="token operator">-</span><span class="token number">9</span>
mkdir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster
cd <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
</code></pre> 
<h6><a id="33_redisconfcluster_28"></a>3.3 将redis.conf复制到cluster目录</h6> 
<p>redis.conf 是redis默认配置文件</p> 
<pre><code class="prism language-javascript">cp <span class="token operator">/</span>opt<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6.2</span><span class="token number">.1</span><span class="token operator">/</span>redis<span class="token punctuation">.</span>conf <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
</code></pre> 
<h6><a id="34_master1redis6379conf_34"></a>3.4 创建master1的配置文件：redis-6379.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6379.conf 文件，内容如下，注192.168.200.129 是这个测试机器的 ip，大家需要替换为自己的</p> 
</blockquote> 
<pre><code class="prism language-javascript">include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6379</span>
dbfilename dump_6379<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6379<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6379.log"</span>
#开启集群设置
cluster<span class="token operator">-</span>enabled yes
#设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6379</span><span class="token punctuation">.</span>conf
<span class="token function">#设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
<span class="token comment">// An highlighted block</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="35_master2redis6380conf_57"></a>3.5 创建master2的配置文件：redis-6380.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6380.conf 文件，内容如下，和上面master的类似，只是将6379换成 6380了</p> 
</blockquote> 
<pre><code class="prism language-javascript">include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6380</span>
dbfilename dump_6380<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6380<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6380.log"</span>
# 开启集群设置
cluster<span class="token operator">-</span>enabled yes
# 设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6380</span><span class="token punctuation">.</span>conf
# <span class="token function">设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
</code></pre> 
<h6><a id="36_master3redis6381conf_76"></a>3.6 创建master3的配置文件：redis-6381.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6381.conf 文件，内容如下</p> 
</blockquote> 
<pre><code class="prism language-javascript">include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6381</span>
dbfilename dump_6381<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6381<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6381.log"</span>
# 开启集群设置
cluster<span class="token operator">-</span>enabled yes
# 设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6381</span><span class="token punctuation">.</span>conf
# <span class="token function">设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
</code></pre> 
<h6><a id="37_slave1redis6389conf_94"></a>3.7 创建slave1的配置文件：redis-6389.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6389.conf 文件，内容如下</p> 
</blockquote> 
<pre><code class="prism language-javascript">include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6389</span>
dbfilename dump_6389<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6389<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6389.log"</span>
# 开启集群设置
cluster<span class="token operator">-</span>enabled yes
# 设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6389</span><span class="token punctuation">.</span>conf
# <span class="token function">设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
</code></pre> 
<h6><a id="38_slave2redis6390conf_113"></a>3.8 创建slave2的配置文件：redis-6390.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6390.conf 文件，内容如下</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token comment">// An highlighted block</span>
include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6390</span>
dbfilename dump_6390<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6390<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6390.log"</span>
# 开启集群设置
cluster<span class="token operator">-</span>enabled yes
# 设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6390</span><span class="token punctuation">.</span>conf
# <span class="token function">设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
</code></pre> 
<h6><a id="39_slave3redis6391conf_133"></a>3.9 创建slave3的配置文件：redis-6391.conf</h6> 
<blockquote> 
 <p>在/opt/cluster目录创建 redis-6391.conf 文件，内容如下</p> 
</blockquote> 
<pre><code class="prism language-javascript">include <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token punctuation">.</span>conf
daemonize yes
bind <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span>
dir <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>
port <span class="token number">6391</span>
dbfilename dump_6391<span class="token punctuation">.</span>rdb
pidfile <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>redis_6391<span class="token punctuation">.</span>pid
logfile <span class="token string">"./6391.log"</span>
# 开启集群设置
cluster<span class="token operator">-</span>enabled yes
# 设置节点配置文件
cluster<span class="token operator">-</span>config<span class="token operator">-</span>file node<span class="token operator">-</span><span class="token number">6391</span><span class="token punctuation">.</span>conf
# <span class="token function">设置节点失联时间，超过该时间</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span>，集群自动进行主从切换
cluster<span class="token operator">-</span>node<span class="token operator">-</span>timeout <span class="token number">15000</span>
</code></pre> 
<h3><a id="4__masterslave1slave2_152"></a>4 . 启动master、slave1、slave2</h3> 
<pre><code class="prism language-javascript"># 方便演示，停止所有的redis
ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep redis <span class="token operator">|</span> awk <span class="token operator">-</span><span class="token constant">F</span><span class="token string">" "</span> <span class="token string">'{print $2;}'</span> <span class="token operator">|</span> xargs kill <span class="token operator">-</span><span class="token number">9</span>
# 下面启动<span class="token number">6</span>个redis
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6379</span><span class="token punctuation">.</span>conf
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6380</span><span class="token punctuation">.</span>conf
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6381</span><span class="token punctuation">.</span>conf
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6389</span><span class="token punctuation">.</span>conf
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6390</span><span class="token punctuation">.</span>conf
redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6391</span><span class="token punctuation">.</span>conf
</code></pre> 
<h3><a id="5__6redis_164"></a>5 . 查看6个redis的启动情况</h3> 
<pre><code class="prism language-javascript">ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep redis
</code></pre> 
<p><img src="https://images2.imgbox.com/77/40/tUotopyp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6__nodexxxxconf_169"></a>6 . 确保node-xxxx.conf文件已正常生成</h3> 
<blockquote> 
 <p>稍后我们会将6个实例合并到一个集群，在组合之前，我们要确保6个redis实例启动后，nodesxxxx.conf文件都生成正常，如下，<br> /opt/cluster 目录中确实都生成成功了<br> <img src="https://images2.imgbox.com/36/4d/gbGbPl5C_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h3><a id="7__6_174"></a>7 . 将6个节点合成一个集群</h3> 
<p>执行下面命令，将6个redis合体</p> 
<pre><code class="prism language-javascript"><span class="token operator">/</span>opt<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6.2</span><span class="token number">.1</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">--</span>cluster create <span class="token operator">--</span>cluster<span class="token operator">-</span>replicas <span class="token number">1</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span>
</code></pre> 
<blockquote> 
 <ol><li>合体的命令后面会跟上所有节点的ip:port列表，多个之间用空格隔开，注意ip不要写<br> 127.0.0.1，要写真实ip</li><li>–cluster-replicas 1：表示采用最简单的方式配置集群，即每个master配1个slave，6个节点 就形成了3主3从</li></ol> 
</blockquote> 
<p>执行过程如下，期间会让我们确定是否同样这样的分配方式，输入：yes，然后等几秒，集群合体成功</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 src<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">--</span>cluster create <span class="token operator">--</span>cluster<span class="token operator">-</span>replicas <span class="token number">1</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span>
<span class="token operator">&gt;&gt;&gt;</span> Performing hash slots allocation on <span class="token number">6</span> nodes<span class="token operator">...</span>
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Slots <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Slots <span class="token number">5461</span> <span class="token operator">-</span> <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Slots <span class="token number">10923</span> <span class="token operator">-</span> <span class="token number">16383</span>
Adding replica <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span> to <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span>
Adding replica <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span> to <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span>
Adding replica <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span> to <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token operator">&gt;&gt;&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti<span class="token operator">-</span>affinity
<span class="token punctuation">[</span><span class="token constant">WARNING</span><span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same host <span class="token keyword">as</span> their master
<span class="token constant">M</span><span class="token operator">:</span> ccf3abb791e026380ad3ad2a166aa788df738437 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">5460</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
<span class="token constant">M</span><span class="token operator">:</span> 3c372392d5a91dad64a6febadfe9524ea2cbd8c0 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">5461</span><span class="token operator">-</span><span class="token number">10922</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
<span class="token constant">M</span><span class="token operator">:</span> 2c905be9c975be367bd66c962167beca1ef66af3 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10923</span><span class="token operator">-</span><span class="token number">16383</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
<span class="token constant">S</span><span class="token operator">:</span> 4a0f860081b969162767aac26801994de54d80a5 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span>
replicates ccf3abb791e026380ad3ad2a166aa788df738437
<span class="token constant">S</span><span class="token operator">:</span> 62c9f37a362459c212e8af6dd744b6562f5fe6a7 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span>
replicates 3c372392d5a91dad64a6febadfe9524ea2cbd8c0
<span class="token constant">S</span><span class="token operator">:</span> a2f89efc09681520f9d9502707b18e1f46a40b90 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span>
replicates 2c905be9c975be367bd66c962167beca1ef66af3
Can <span class="token constant">I</span> <span class="token keyword">set</span> the above configuration<span class="token operator">?</span> <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span><span class="token operator">:</span> yes
<span class="token operator">&gt;&gt;&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;&gt;</span> Assign a different config epoch to each node
<span class="token operator">&gt;&gt;&gt;</span> Sending <span class="token constant">CLUSTER</span> <span class="token constant">MEET</span> messages to join the cluster
Waiting <span class="token keyword">for</span> the cluster to join
<span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;&gt;</span> Performing Cluster <span class="token function">Check</span> <span class="token punctuation">(</span>using node <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token punctuation">)</span>
<span class="token constant">M</span><span class="token operator">:</span> ccf3abb791e026380ad3ad2a166aa788df738437 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">5460</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
<span class="token number">1</span> additional <span class="token function">replica</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token constant">M</span><span class="token operator">:</span> 2c905be9c975be367bd66c962167beca1ef66af3 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10923</span><span class="token operator">-</span><span class="token number">16383</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
<span class="token number">1</span> additional <span class="token function">replica</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token constant">S</span><span class="token operator">:</span> 62c9f37a362459c212e8af6dd744b6562f5fe6a7 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
replicates 3c372392d5a91dad64a6febadfe9524ea2cbd8c0
<span class="token constant">M</span><span class="token operator">:</span> 3c372392d5a91dad64a6febadfe9524ea2cbd8c0 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">5461</span><span class="token operator">-</span><span class="token number">10922</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
<span class="token number">1</span> additional <span class="token function">replica</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token constant">S</span><span class="token operator">:</span> 4a0f860081b969162767aac26801994de54d80a5 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
replicates ccf3abb791e026380ad3ad2a166aa788df738437
<span class="token constant">S</span><span class="token operator">:</span> a2f89efc09681520f9d9502707b18e1f46a40b90 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span>
<span class="token literal-property property">slots</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
replicates 2c905be9c975be367bd66c962167beca1ef66af3
<span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span> All nodes agree about slots configuration<span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;&gt;</span> Check <span class="token keyword">for</span> open slots<span class="token operator">...</span>
<span class="token operator">&gt;&gt;&gt;</span> Check slots coverage<span class="token operator">...</span>
<span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered<span class="token punctuation">.</span>
</code></pre> 
<h3><a id="8__cluster_nodes_245"></a>8 . 连接集群节点，查看集群信息：cluster nodes</h3> 
<blockquote> 
 <p>需要使用 redis-cli -c 命令连接集群中6个节点中任何一个节点都可以，注意和之前的连接参数有点不 同 redis-cli<br> 命令后面多了一个 -c 参数，表示采用集群的方式连接，连上以后，然后使用 cluster nodes 可以查看集群节点信息，如下</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> cluster nodes
2c905be9c975be367bd66c962167beca1ef66af3 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>@<span class="token number">16381</span> master <span class="token operator">-</span> <span class="token number">0</span>
<span class="token number">1650194157604</span> <span class="token number">3</span> connected <span class="token number">10923</span><span class="token operator">-</span><span class="token number">16383</span>
62c9f37a362459c212e8af6dd744b6562f5fe6a7 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6390</span>@<span class="token number">16390</span> slave
3c372392d5a91dad64a6febadfe9524ea2cbd8c0 <span class="token number">0</span> <span class="token number">1650194158611</span> <span class="token number">2</span> connected
3c372392d5a91dad64a6febadfe9524ea2cbd8c0 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span>@<span class="token number">16380</span> master <span class="token operator">-</span> <span class="token number">0</span>
<span class="token number">1650194158000</span> <span class="token number">2</span> connected <span class="token number">5461</span><span class="token operator">-</span><span class="token number">10922</span>
4a0f860081b969162767aac26801994de54d80a5 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6389</span>@<span class="token number">16389</span> slave
ccf3abb791e026380ad3ad2a166aa788df738437 <span class="token number">0</span> <span class="token number">1650194156000</span> <span class="token number">1</span> connected
ccf3abb791e026380ad3ad2a166aa788df738437 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span>@<span class="token number">16379</span>
myself<span class="token punctuation">,</span>master <span class="token operator">-</span> <span class="token number">0</span> <span class="token number">1650194157000</span> <span class="token number">1</span> connected <span class="token number">0</span><span class="token operator">-</span><span class="token number">5460</span>
a2f89efc09681520f9d9502707b18e1f46a40b90 <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6391</span>@<span class="token number">16391</span> slave
2c905be9c975be367bd66c962167beca1ef66af3 <span class="token number">0</span> <span class="token number">1650194159617</span> <span class="token number">3</span> connected
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>如下图，对 cluster nodes 的结果做下解释，先看下红字的注释，集群中的每个节点都会生成一个ID，<br> 这个ID信息会被写到node-xxxx.conf文件中，为什么要生成id呢？<br> 因为节点的ip和端口可能会发生变化，但是节点的ID是不会变的，其他节点可以通过其他节点的ID来认 识各个节点</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/55/43/6lmlQ6FN_o.png" alt="。"></p> 
<h3><a id="9___270"></a>9 . 验证集群数据的读写操作</h3> 
<blockquote> 
 <p>如下，我们连接 6379 这个节点，然后执行一个set操作，效果如下，写入成功</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> name ready
<span class="token operator">-</span><span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">5798</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span>
<span class="token constant">OK</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6380</span><span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>大家可能注意到了，我们明明在 6379 上操作的，但是请求被转发到了6380这个节点去处理了，这里就<br> 是我们后面要说的slot的知识了，先向后看。</p> 
</blockquote> 
<h4><a id="10__redis6_283"></a>10 . redis集群如何分配这6个节点？</h4> 
<blockquote> 
 <ol><li>一个集群至少有3个主节点，因为新master的选举需要大于半数的集群master节点同意才能选举成功，</li><li>如果只有两个master节点，当其中一个挂了，是达不到选举新master的条件的。</li><li>选项–cluster-replicas 1表示我们希望为集群中的每个主节点创建一个从节点。</li><li>分配原则尽量保证每个主库运行在不同的ip，每个主库和从库不在一个ip上，这样才能做到高可用。</li></ol> 
</blockquote> 
<h4><a id="11__slots_291"></a>11 . 什么是slots（槽）</h4> 
<p>如下图，咱们再来看看集群合并的过程中输出的一些信息<br> <img src="https://images2.imgbox.com/92/5a/MVALPcQc_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>Redis集群内部划分了16384个slots（插槽），合并的时候，会将每个slots映射到一个master上面，比<br> 如上面3个master和slots的关系如下：<br> <img src="https://images2.imgbox.com/27/94/LJIKcwji_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p>而数据库中的每个key都属于16384个slots中的其中1个，当通过key读写数据的时候，redis需要先根据<br> key计算出key对应的slots，然后根据slots和master的映射关系找到对应的redis节点，key对应的数据 就在这个节点上面。<br> 集群中使用公式 CRC16(key)%16384 计算key属于哪个槽</p> 
</blockquote> 
<h4><a id="12___303"></a>12 . 在集群中录入值</h4> 
<blockquote> 
 <p>在 redis-cli 每次录入、查询键值，redis都会计算key对应的插槽，如果不是当前redis节点的插槽，<br> redis会报错，并告知应前往的redis实例地址和端口，效果如下，我们连接了6379这个实例来操作k1，<br> 这个节点发现k1的槽位在6381上面，返回了错误信息，怎么办呢？</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 <span class="token function">v1</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token constant">MOVED</span> <span class="token number">12706</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
</code></pre> 
<blockquote> 
 <p>使用redis-cli客户端提供了-c参数可以解决这个问题，表示以集群方式执行，执行命令的时候当前节点处<br> 理不了的时候，会自动将请求重定向到目标节点，效果如下，被重定向到6381了</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 v1
<span class="token operator">-</span><span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token constant">OK</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>同样，执行get会被重定向，效果如下</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">get</span> k1
<span class="token operator">-</span><span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span>
<span class="token string">"v1"</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>不在一个slot下面，不能使用mget、mset等多键操作，效果如</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> mset k1 v1 k2 <span class="token function">v2</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token constant">CROSSSLOT</span> Keys <span class="token keyword">in</span> request don't hash to the same slot
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> mget k1 <span class="token function">k2</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token constant">CROSSSLOT</span> Keys <span class="token keyword">in</span> request don't hash to the same slot
</code></pre> 
<p>可以通过{}来定义组的概念，从而使key中{}内相同的键值放到一个slot中去，效果如下</p> 
<pre><code class="prism language-javascript"><span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> mset k1<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span> v1 k2<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span> v2 k3<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span> v3
<span class="token constant">OK</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> mget k1<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span> k2<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span> k3<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"v1"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"v3"</span>
</code></pre> 
<h4><a id="13__slot_347"></a>13 . slot相关的一些命令</h4> 
<p>cluster keyslot ：计算key对应的slot<br> cluster coutkeysinslot ：获取slot槽位中key的个数<br> cluster getkeysinslot 返回count个slot槽中的键</p> 
<pre><code class="prism language-javascript"><span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> cluster keyslot k1<span class="token punctuation">{<!-- --></span>g1<span class="token punctuation">}</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">13519</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> cluster countkeysinslot <span class="token number">13519</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6381</span><span class="token operator">&gt;</span> cluster getkeysinslot <span class="token number">13519</span> <span class="token number">3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1{g1}"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k2{g1}"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"k3{g1}"</span>
</code></pre> 
<h4><a id="14___362"></a>14 . 故障恢复</h4> 
<p>如果主节点下线，从节点是否能够提升为主节点？注意：要等15秒<br> 下面我们来试试，如下，连接master1，然后将master1停掉</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> shutdown
not connected<span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>执行下面命令，连接master1，看下集群节点的信息</p> 
</blockquote> 
<pre><code class="prism language-javascript">redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6380</span>
cluster nodes
</code></pre> 
<blockquote> 
 <p>输出如下，可以看到slave1（6389）确实变成master了，而它原来的master：master1（6379）下线 了</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ed/b8/dLNZ1Ed6_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>下面我们再来启动6379，然后再看看集群变成什么样了，命令如下</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>server <span class="token operator">/</span>opt<span class="token operator">/</span>cluster<span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">6379</span><span class="token punctuation">.</span>conf
<span class="token punctuation">[</span>root@hspEdu01 cluster<span class="token punctuation">]</span># redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span> <span class="token operator">-</span>p <span class="token number">6379</span>
<span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.129</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> cluster nodes
</code></pre> 
<p>执行结果如下，6379变成slave了，挂在了6389下面了</p> 
<p><img src="https://images2.imgbox.com/c9/d6/JaEY9FR2_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>如果某一段插槽的主从都宕机了，redis服务是否还能继续？<br> 这个时候要看 cluster-require-full-coverage 参数的值了</p> 
</blockquote> 
<p>yes(默认值)：整个集群都都无法提供服务了<br> no：宕机的这部分槽位数据全部不能使用，其他槽位正常</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c88e3bb3ebbc39d760d345f6d6c188f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">redis知识点整理（自用）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e9947c737fe1dd3357986709dee436e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华为手机屏幕坏了无法使用怎么备份资料</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>