<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Windows UAC权限详解以及因为权限不对等引发的若干问题分享 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Windows UAC权限详解以及因为权限不对等引发的若干问题分享" />
<meta property="og:description" content="目录
1、什么是UAC？
2、微软为什么要设计UAC？
3、标准用户权限与管理员权限
4、程序到底以哪种权限运行？与哪些因素有关？
4.1、给程序设置以管理员权限运行的属性
4.2、当前登录用户的类型
5、案例1 - 无法在企业微信聊天框中启动安装包程序
6、案例2 - 使用Windbg时可能会遇到的权限不对等导致操作失败的问题
6.1、Windbg附加到目标进程失败
6.2、dump文件拖到以管理员权限运行的Windbg中没反应
7、案例3 - 双击桌面快捷方式启动程序时并没有自动将已经启动起来的程序窗口弹出来
8、与管理员权限相关的其他问题
8.1、如何以管理员权限启动一个程序？
8.2、开机自启动程序不能设置管理员权限
VC&#43;&#43;常用功能开发汇总（专栏文章列表，欢迎订阅，持续更新...）https://blog.csdn.net/chenlycly/article/details/124272585C&#43;&#43;软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）https://blog.csdn.net/chenlycly/article/details/125529931C&#43;&#43;软件分析工具从入门到精通案例集锦（专栏文章，持续更新中...）https://blog.csdn.net/chenlycly/article/details/131405795C/C&#43;&#43;基础与进阶（专栏文章，持续更新中...）https://blog.csdn.net/chenlycly/category_11931267.html开源组件及数据库技术（专栏文章，持续更新中...）https://blog.csdn.net/chenlycly/category_12458859.html网络编程与网络问题分享（专栏文章，持续更新中...）https://blog.csdn.net/chenlycly/category_2276111.html 在Windows系统中，我们使用软件时时常会遇到因管理员权限与标准用户权限不对等导致操作失败的问题，很多人搞不清楚是怎么回事，今天我们就来详细讲讲与之相关的UAC权限控制，并给出具体的问题实例，供大家借鉴或参考。
在这里，给大家重点推荐一下我的两个热门畅销专栏：
专栏1：（该专栏订阅量接近350个，有很强的实战参考价值，广受好评！）
C&#43;&#43;软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）https://blog.csdn.net/chenlycly/article/details/125529931
本专栏根据近几年C&#43;&#43;软件异常排查的项目实践，系统地总结了引发C&#43;&#43;软件异常的常见原因以及排查C&#43;&#43;软件异常的常用思路与方法，详细讲述了C&#43;&#43;软件的调试方法与手段，以图文并茂的方式给出具体的实战问题分析实例，带领大家逐步掌握C&#43;&#43;软件调试与异常排查的相关技术，适合基础进阶和想做技术提升的相关C&#43;&#43;开发人员！
专栏中的文章都是通过项目实战总结出来的（通过项目实战积累了大量的异常排查素材和案例），有很强的实战参考价值！专栏文章还在持续更新中，预计文章篇数能更新到200篇以上！
专栏2： VC&#43;&#43;常用功能开发汇总https://blog.csdn.net/chenlycly/article/details/124272585
专栏将10多年C&#43;&#43;开发实践中常用的功能，以高质量的代码展现出来，并对相关功能的实现细节进行了详细的说明。这些常用的代码，其质量与稳定性是有保证的，可以直接拿过去使用，可以有效地解决C&#43;&#43;软件开发过程中遇到的问题。
专栏3：
C/C&#43;&#43;基础与进阶https://blog.csdn.net/chenlycly/category_11931267.html
以多年的开发实战为基础，总结并讲解一些的C/C&#43;&#43;基础与进阶内容，以图文并茂的方式对相关知识点进行详细地展开与阐述！专栏涉及了C/C&#43;&#43;领域的多个方面的内容，同时给出C/C&#43;&#43;及网络方面的常见笔试面试题，并详细讲述Visual Studio常用调试手段与技巧！
1、什么是UAC？ UAC（User Account Control），用户帐户控制，是微软从Windows Vista开始引入的一种新的控制机制，其原理是通知用户是否对应用程序使用硬盘驱动器和系统文件授权，以达到阻止恶意程序（有时也称为“恶意软件”）损坏系统的目的。
UAC用户账户控制机制主要是权限隔离，防止低权限、低安全的应用获取系统高等级权限。系统弹出UAC提示框，让用户确认是否信任、是否以管理员权限运行未知、未签名应用。
当运行一些会影响系统安全的程序时，会自动触发UAC，用户确认后程序才能运行。比如当你运行一个安装程序（一般以管理员权限运行）或者打开一个未经验证的程序时，就会弹出类似如下的UAC提示框：（以在Win10系统中双击需要以管理员权限运行的QQ安装包程序为例）
用户确认后程序才能继续运行。
这个弹框是提示用户程序可能会对当前计算机进行修改，但这个提示对对绝大部分用户来说，好像并没有什么用。对普通用户而言，不但没什么用，反而会带来困扰（到底是该允许呢？还是不允许呢？）。并且老是时不时地弹框，用户也很厌烦！
稍微专业的用户，可能会将UAC通知关闭掉。具体方法是，打开控制面板，然后点击“用户账户”，进入用户账户设置页面：
然后点击“更改用户账户控制设置”，到如下的页面中：
将滚动条拉到底，就可以将UAC通知关闭掉。关闭后，就不会再弹UAC提示框了。
既然大家都不喜欢UAC提示框，微软为什么还要设计出这样一个别脚的东西来呢？
2、微软为什么要设计UAC？ 很多人都用过Windows XP，大多数人在用Windows XP时，使用的应该是管理员权限的账户。而在微软的设想中，普通用户都应该都使用标准账户。为什么大家不用标准账户？Windows XP里的标准账户，可能连程序都没法正常安装！没有人愿意为了装个程序，切换到管理员账户，装完了再切换回标准用户。
当然，微软也注意到了这一点，于是就设计了UAC系统。UAC与Windows XP的用户账户权限管理，最大的不同在于，UAC对权限的控制很有弹性。它默认所有程序都是以标准权限运行的（无论你使用的是管理员账户还是标准账户），而当你运行一个需要管理员权限运行的程序时，UAC就会跑出来问你，这个程序需要管理员权限，要不要继续，如下：
如果你允许，UAC就会提升权限，用管理员权限运行这个程序。
其实从UAC的设计的本意上来看，它即避免了直接使用管理员账户导致权限控制形同虚设，又解决了标准用户需要频繁切换到管理员账户的问题（可能是模仿Linux系统中的su权限提升）。
但Windows下的UAC一点也不智能，连复制文件之类的操作，甚至都会跑过来问你一下，很多用户不厌其烦，直接把UAC一关了事。尽管Windows对UAC做了一些改变和优化，但UAC还是很烦。比如，你第一次打开一个需要管理员权限的程序，UAC会尽忠职守地问你是否要提升权限；你第二次打开，UAC还会尽忠职守地问你是否要提升权限；你第三次打开，UAC还会尽忠职守地问你是否要提升权限……于是大家不愿意了，把UAC一关了之。
甚至有些人直接使用Administrator这个超级管理员用户，在这个用户登录下，所有程序默认以管理员权限运行，基本所有的操作都不会弹UAC提示框了。
用过Android手机的用户都知道，Android里有个信任程序列表，一旦加入这个列表，再次运行的时候，系统就不会做多余的询问了。而Windows UAC中没有这个东西，因为微软的人认为，如果要创建一个信任列表，那这个列表必然会被储存在注册表或者硬盘的某个地方，这样hacker就可以想办法破解并修改这个列表了（就像XP的密码一样）。
3、标准用户权限与管理员权限 Windows从Vista系统开始就引入了UAC权限控制机制，强化了管理员权限的概念，做了更严格的权限限制与安全控制。比如对一些权限敏感的路径，比如C:\Program Files、C:\Windows\system32，如果要在这些路径下创建文件、向文件中写数据，都是需要管理员权限的。再比如，在Windows系统的注册表中，如果要向HKEY_LOCAL_MACHINE路劲下写入或修改内容时，也需要管理员权限的。
程序运行权限主要有标准用户权限和管理员权限两种。有很多操作，都需要管理员权限，比如：
1）管理员权限的程序才能向系统安全敏感路径执行写操作，比如在C:\Program Files、C:\Windows\system32等系统路径中创建文件、拷贝文件，向这些路径下的文件执行写操作。
2）只有管理员权限的程序，才能向系统注册表路径HKEY_LOCAL_MACHINE下执行创建或写操作。没有管理员权限的程序，只能对HKEY_CURRENT_USER路径下执行写操作。
3）只有管理员权限的程序，才能向系统注册控件（要向HKEY_LOCAL_MACHINE路径下的注册表写入信息）。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a7ddfe908dbf71393be23ba57d7e6f9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-19T19:04:34+08:00" />
<meta property="article:modified_time" content="2023-11-19T19:04:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Windows UAC权限详解以及因为权限不对等引发的若干问题分享</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFUAC%EF%BC%9F-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFUAC%EF%BC%9F" rel="nofollow">1、什么是UAC？</a></p> 
<p id="2%E3%80%81%E5%BE%AE%E8%BD%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E8%AE%A1UAC%EF%BC%9F-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%BE%AE%E8%BD%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E8%AE%A1UAC%EF%BC%9F" rel="nofollow">2、微软为什么要设计UAC？</a></p> 
<p id="3%E3%80%81%E6%A0%87%E5%87%86%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E6%A0%87%E5%87%86%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90" rel="nofollow">3、标准用户权限与管理员权限</a></p> 
<p id="4%E3%80%81%E7%A8%8B%E5%BA%8F%E5%88%B0%E5%BA%95%E4%BB%A5%E5%93%AA%E7%A7%8D%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%EF%BC%9F%E4%B8%8E%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E6%9C%89%E5%85%B3%EF%BC%9F-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E7%A8%8B%E5%BA%8F%E5%88%B0%E5%BA%95%E4%BB%A5%E5%93%AA%E7%A7%8D%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%EF%BC%9F%E4%B8%8E%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E6%9C%89%E5%85%B3%EF%BC%9F" rel="nofollow">4、程序到底以哪种权限运行？与哪些因素有关？</a></p> 
<p id="4.1%E3%80%81%E7%BB%99%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AE%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84%E5%B1%9E%E6%80%A7-toc" style="margin-left:80px;"><a href="#4.1%E3%80%81%E7%BB%99%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AE%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84%E5%B1%9E%E6%80%A7" rel="nofollow">4.1、给程序设置以管理员权限运行的属性</a></p> 
<p id="4.2%E3%80%81%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E7%9A%84%E7%B1%BB%E5%9E%8B-toc" style="margin-left:80px;"><a href="#4.2%E3%80%81%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E7%9A%84%E7%B1%BB%E5%9E%8B" rel="nofollow">4.2、当前登录用户的类型</a></p> 
<p id="5%E3%80%81%E6%A1%88%E4%BE%8B1%20-%20%E6%97%A0%E6%B3%95%E5%9C%A8%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E6%A1%86%E4%B8%AD%E5%90%AF%E5%8A%A8%E5%AE%89%E8%A3%85%E5%8C%85%E7%A8%8B%E5%BA%8F-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E6%A1%88%E4%BE%8B1%20-%20%E6%97%A0%E6%B3%95%E5%9C%A8%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E6%A1%86%E4%B8%AD%E5%90%AF%E5%8A%A8%E5%AE%89%E8%A3%85%E5%8C%85%E7%A8%8B%E5%BA%8F" rel="nofollow">5、案例1 - 无法在企业微信聊天框中启动安装包程序</a></p> 
<p id="6%E3%80%81%E6%A1%88%E4%BE%8B2%20-%20%E4%BD%BF%E7%94%A8Windbg%E6%97%B6%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%81%87%E5%88%B0%E7%9A%84%E6%9D%83%E9%99%90%E4%B8%8D%E5%AF%B9%E7%AD%89%E5%AF%BC%E8%87%B4%E6%93%8D%E4%BD%9C%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#6%E3%80%81%E6%A1%88%E4%BE%8B2%20-%20%E4%BD%BF%E7%94%A8Windbg%E6%97%B6%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%81%87%E5%88%B0%E7%9A%84%E6%9D%83%E9%99%90%E4%B8%8D%E5%AF%B9%E7%AD%89%E5%AF%BC%E8%87%B4%E6%93%8D%E4%BD%9C%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98" rel="nofollow">6、案例2 - 使用Windbg时可能会遇到的权限不对等导致操作失败的问题</a></p> 
<p id="6.1%E3%80%81Windbg%E9%99%84%E5%8A%A0%E5%88%B0%E7%9B%AE%E6%A0%87%E8%BF%9B%E7%A8%8B%E5%A4%B1%E8%B4%A5-toc" style="margin-left:80px;"><a href="#6.1%E3%80%81Windbg%E9%99%84%E5%8A%A0%E5%88%B0%E7%9B%AE%E6%A0%87%E8%BF%9B%E7%A8%8B%E5%A4%B1%E8%B4%A5" rel="nofollow">6.1、Windbg附加到目标进程失败</a></p> 
<p id="6.2%E3%80%81dump%E6%96%87%E4%BB%B6%E6%8B%96%E5%88%B0%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84Windbg%E4%B8%AD%E6%B2%A1%E5%8F%8D%E5%BA%94-toc" style="margin-left:80px;"><a href="#6.2%E3%80%81dump%E6%96%87%E4%BB%B6%E6%8B%96%E5%88%B0%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84Windbg%E4%B8%AD%E6%B2%A1%E5%8F%8D%E5%BA%94" rel="nofollow">6.2、dump文件拖到以管理员权限运行的Windbg中没反应</a></p> 
<p id="7%E3%80%81%E6%A1%88%E4%BE%8B3%20-%20%E5%8F%8C%E5%87%BB%E6%A1%8C%E9%9D%A2%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%97%B6%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E5%B0%86%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%E8%B5%B7%E6%9D%A5%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%AA%97%E5%8F%A3%E5%BC%B9%E5%87%BA%E6%9D%A5-toc" style="margin-left:40px;"><a href="#7%E3%80%81%E6%A1%88%E4%BE%8B3%20-%20%E5%8F%8C%E5%87%BB%E6%A1%8C%E9%9D%A2%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%97%B6%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E5%B0%86%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%E8%B5%B7%E6%9D%A5%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%AA%97%E5%8F%A3%E5%BC%B9%E5%87%BA%E6%9D%A5" rel="nofollow">7、案例3 - 双击桌面快捷方式启动程序时并没有自动将已经启动起来的程序窗口弹出来</a></p> 
<p id="8%E3%80%81%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E7%9A%84%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#8%E3%80%81%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E7%9A%84%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" rel="nofollow">8、与管理员权限相关的其他问题</a></p> 
<p id="8.1%E3%80%81%E5%A6%82%E4%BD%95%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%EF%BC%9F-toc" style="margin-left:80px;"><a href="#8.1%E3%80%81%E5%A6%82%E4%BD%95%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%EF%BC%9F" rel="nofollow">8.1、如何以管理员权限启动一个程序？</a></p> 
<p id="8.2%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E4%B8%8D%E8%83%BD%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90-toc" style="margin-left:80px;"><a href="#8.2%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E4%B8%8D%E8%83%BD%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90" rel="nofollow">8.2、开机自启动程序不能设置管理员权限</a></p> 
<hr id="hr-toc"> 
<p><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/article/details/124272585" title="VC++常用功能开发汇总（专栏文章列表，欢迎订阅，持续更新...）"><span class="link-card-box"><span class="link-title">VC++常用功能开发汇总（专栏文章列表，欢迎订阅，持续更新...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/02/df/Aj7pmAza_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/124272585</span></span></a><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/article/details/125529931" title="C++软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）"><span class="link-card-box"><span class="link-title">C++软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/15/3e/gk020ZzW_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/125529931</span></span></a><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/article/details/131405795" title="C++软件分析工具从入门到精通案例集锦（专栏文章，持续更新中...）"><span class="link-card-box"><span class="link-title">C++软件分析工具从入门到精通案例集锦（专栏文章，持续更新中...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/10/56/5gpxXdzO_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/131405795</span></span></a><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/category_11931267.html" title="C/C++基础与进阶（专栏文章，持续更新中...）"><span class="link-card-box"><span class="link-title">C/C++基础与进阶（专栏文章，持续更新中...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/40/a5/f3dyNnpv_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/category_11931267.html</span></span></a><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/category_12458859.html" title="开源组件及数据库技术（专栏文章，持续更新中...）"><span class="link-card-box"><span class="link-title">开源组件及数据库技术（专栏文章，持续更新中...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/62/5e/QLPMyKJp_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/category_12458859.html</span></span></a><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/category_2276111.html" title="网络编程与网络问题分享（专栏文章，持续更新中...）"><span class="link-card-box"><span class="link-title">网络编程与网络问题分享（专栏文章，持续更新中...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/e1/97/79efEr6p_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/category_2276111.html</span></span></a>       在Windows系统中，我们使用软件时时常会遇到因管理员权限与标准用户权限不对等导致操作失败的问题，很多人搞不清楚是怎么回事，今天我们就来详细讲讲与之相关的UAC权限控制，并给出具体的问题实例，供大家借鉴或参考。</p> 
<p class="img-center"><img alt="" height="133" src="https://images2.imgbox.com/9a/ec/0u72vMfe_o.png" width="413"></p> 
<hr> 
<p>       在这里，给大家<span style="color:#be191c;"><strong>重点推荐一下我的两个热门畅销专栏：</strong></span></p> 
<p><span style="color:#be191c;"><strong>专栏1：</strong>（该专栏订阅量接近350个，有很强的实战参考价值，广受好评！）</span></p> 
<p><strong><strong><strong><strong><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/article/details/125529931" title="C++软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）"><span class="link-card-box"><span class="link-title">C++软件异常排查从入门到精通系列教程（专栏文章列表，欢迎订阅，持续更新...）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ac/77/r13hnuZ7_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/125529931</span></span></a></strong></strong></strong></strong></p> 
<blockquote> 
 <p><span style="color:#0d0016;">本专栏根据近几年C++软件异常排查的项目实践，系统地总结了引发C++软件异常的常见原因以及排查C++软件异常的常用思路与方法，详细讲述了C++软件的调试方法与手段，<strong>以图文并茂的方式给出具体的实战问题分析实例</strong>，带领大家逐步掌握C++软件调试与异常排查的相关技术，适合基础进阶和想做技术提升的相关C++开发人员！</span></p> 
 <p><span style="color:#0d0016;"><strong>专栏中的文章都是通过项目实战总结出来的（通过项目实战积累了大量的异常排查素材和案例），有很强的实战参考价值！</strong>专栏文章还在持续更新中，预计文章篇数能更新到200篇以上！</span></p> 
</blockquote> 
<p><strong><span style="color:#be191c;">专栏2</span>： </strong></p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/article/details/124272585" title="VC++常用功能开发汇总"><span class="link-card-box"><span class="link-title">VC++常用功能开发汇总</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/97/12/SyOUFnfQ_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/124272585</span></span></a></p> 
<blockquote> 
 <p><span style="color:#0d0016;">专栏将10多年C++开发实践中常用的功能，以高质量的代码展现出来，并对相关功能的实现细节进行了详细的说明。这些常用的代码，其质量与稳定性是有保证的，可以直接拿过去使用，可以有效地解决C++软件开发过程中遇到的问题。</span></p> 
</blockquote> 
<p><strong><span style="color:#be191c;">专栏3</span></strong>：</p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/chenlycly/category_11931267.html" title="C/C++基础与进阶"><span class="link-card-box"><span class="link-title">C/C++基础与进阶</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/de/72/MUNBzJDp_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/category_11931267.html</span></span></a></p> 
<blockquote> 
 <p><span style="color:#0d0016;">以多年的开发实战为基础，总结并讲解一些的C/C++基础与进阶内容，以图文并茂的方式对相关知识点进行详细地展开与阐述！专栏涉及了C/C++领域的多个方面的内容，同时给出C/C++及网络方面的常见笔试面试题，并详细讲述Visual Studio常用调试手段与技巧！</span></p> 
</blockquote> 
<hr> 
<h3>1、什么是UAC？</h3> 
<p>      <span style="color:#1a439c;"><strong> UAC（User Account Control），用户帐户控制，是微软从Windows Vista开始引入的一种新的控制机制</strong></span>，其原理是通知用户是否对应用程序使用硬盘驱动器和系统文件授权，以达到阻止恶意程序（有时也称为“恶意软件”）损坏系统的目的。</p> 
<blockquote> 
 <p><span style="color:#0d0016;">UAC用户账户控制机制主要是权限隔离，防止低权限、低安全的应用获取系统高等级权限。系统弹出UAC提示框，让用户确认是否信任、是否以管理员权限运行未知、未签名应用。</span></p> 
</blockquote> 
<p>       当运行一些会影响系统安全的程序时，会自动触发UAC，用户确认后程序才能运行。比如当你运行一个安装程序（一般以管理员权限运行）或者打开一个未经验证的程序时，就会弹出类似如下的UAC提示框：（以在Win10系统中双击需要以管理员权限运行的QQ安装包程序为例）</p> 
<p class="img-center"><img alt="" height="325" src="https://images2.imgbox.com/88/90/VXzykkxG_o.png" width="456"></p> 
<p>用户确认后程序才能继续运行。</p> 
<p>       这个弹框是提示用户程序可能会对当前计算机进行修改，但这个提示对对绝大部分用户来说，好像并没有什么用。对普通用户而言，不但没什么用，反而会带来困扰（到底是该允许呢？还是不允许呢？）。并且老是时不时地弹框，用户也很厌烦！</p> 
<p>       稍微专业的用户，可能会将UAC通知关闭掉。具体方法是，打开控制面板，然后点击“用户账户”，进入用户账户设置页面：</p> 
<p class="img-center"><img alt="" height="544" src="https://images2.imgbox.com/a0/d7/9x9JSLMx_o.png" width="663"></p> 
<p>然后点击“更改用户账户控制设置”，到如下的页面中：</p> 
<p class="img-center"><img alt="" height="559" src="https://images2.imgbox.com/13/27/yYWlhU2o_o.png" width="663"></p> 
<p>将滚动条拉到底，就可以将UAC通知关闭掉。关闭后，就不会再弹UAC提示框了。</p> 
<p>       既然大家都不喜欢UAC提示框，微软为什么还要设计出这样一个别脚的东西来呢？</p> 
<h3 id="2%E3%80%81%E5%BE%AE%E8%BD%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E8%AE%A1UAC%EF%BC%9F">2、微软为什么要设计UAC？</h3> 
<p>        很多人都用过Windows XP，大多数人在用Windows XP时，使用的应该是管理员权限的账户。而在微软的设想中，普通用户都应该都使用标准账户。为什么大家不用标准账户？Windows XP里的标准账户，可能连程序都没法正常安装！没有人愿意为了装个程序，切换到管理员账户，装完了再切换回标准用户。</p> 
<p class="img-center"><img alt="" height="133" src="https://images2.imgbox.com/3e/fa/ThftQrov_o.png" width="413"></p> 
<p>       当然，微软也注意到了这一点，于是就设计了UAC系统。UAC与Windows XP的用户账户权限管理，最大的不同在于，UAC对权限的控制很有弹性。它默认所有程序都是以标准权限运行的（无论你使用的是管理员账户还是标准账户），而当你运行一个需要管理员权限运行的程序时，UAC就会跑出来问你，这个程序需要管理员权限，要不要继续，如下：</p> 
<p class="img-center"><img alt="" height="325" src="https://images2.imgbox.com/09/77/ncNvjZTY_o.png" width="456"></p> 
<p>如果你允许，UAC就会提升权限，用管理员权限运行这个程序。</p> 
<p>       其实从UAC的设计的本意上来看，它即避免了直接使用管理员账户导致权限控制形同虚设，又解决了标准用户需要频繁切换到管理员账户的问题（可能是模仿Linux系统中的su权限提升）。</p> 
<p>       但Windows下的UAC一点也不智能，连复制文件之类的操作，甚至都会跑过来问你一下，很多用户不厌其烦，直接把UAC一关了事。尽管Windows对UAC做了一些改变和优化，但UAC还是很烦。比如，你第一次打开一个需要管理员权限的程序，UAC会尽忠职守地问你是否要提升权限；你第二次打开，UAC还会尽忠职守地问你是否要提升权限；你第三次打开，UAC还会尽忠职守地问你是否要提升权限……于是大家不愿意了，把UAC一关了之。</p> 
<blockquote> 
 <p>甚至有些人直接使用Administrator这个超级管理员用户，在这个用户登录下，所有程序默认以管理员权限运行，基本所有的操作都不会弹UAC提示框了。</p> 
</blockquote> 
<p>       用过Android手机的用户都知道，Android里有个信任程序列表，一旦加入这个列表，再次运行的时候，系统就不会做多余的询问了。而Windows UAC中没有这个东西，因为微软的人认为，如果要创建一个信任列表，那这个列表必然会被储存在注册表或者硬盘的某个地方，这样hacker就可以想办法破解并修改这个列表了（就像XP的密码一样）。</p> 
<h3 id="3%E3%80%81%E6%A0%87%E5%87%86%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90">3、标准用户权限与管理员权限</h3> 
<p>       Windows从Vista系统开始就引入了UAC权限控制机制，强化了管理员权限的概念，做了更严格的权限限制与安全控制。比如对一些权限敏感的路径，比如C:\Program Files、C:\Windows\system32，如果要在这些路径下创建文件、向文件中写数据，都是需要管理员权限的。再比如，在Windows系统的注册表中，如果要向HKEY_LOCAL_MACHINE路劲下写入或修改内容时，也需要管理员权限的。</p> 
<p>       程序运行权限主要有标准用户权限和管理员权限两种。有很多操作，都需要管理员权限，比如：</p> 
<blockquote> 
 <p>1）管理员权限的程序才能向系统安全敏感路径执行写操作，比如在C:\Program Files、C:\Windows\system32等系统路径中创建文件、拷贝文件，向这些路径下的文件执行写操作。<br> 2）只有管理员权限的程序，才能向系统注册表路径HKEY_LOCAL_MACHINE下执行创建或写操作。没有管理员权限的程序，只能对HKEY_CURRENT_USER路径下执行写操作。<br> 3）只有管理员权限的程序，才能向系统注册控件（要向HKEY_LOCAL_MACHINE路径下的注册表写入信息）。</p> 
</blockquote> 
<p>       安装包程序一般默认是将程序默认安装到C:\Program Files路径中，需要向系统注册控件，这些操作都需要管理员权限才能执行，所以安装包程序一般都要设置以管理员权限运行。如果程序设置了以管理员权限运行的属性，则程序图标的右下角会显示小盾牌的图标，如下所示：</p> 
<p class="img-center"><img alt="" height="160" src="https://images2.imgbox.com/1a/09/T9CRqfjl_o.png" width="269"></p> 
<blockquote> 
 <p>注意，如果在超级管理员Administrator登录的场景下，是看不到小盾牌的，因为在超级管理员登录的情况下，所有程序默认以管理员权限运行，不管程序有没有设置以管理员权限运行。</p> 
</blockquote> 
<p>       此外，<strong>对于以标准用户权限运行的程序，如果要执行需要管理员权限才能正常执行的操作</strong>，会涉及到一个<strong>系统重定向</strong>的问题，详细说明可以参见我之前写的文章：<a class="has-card" href="https://blog.csdn.net/chenlycly/article/details/124096307" title="VC++ Windows7及以上系统中管理员权限与UAC虚拟化详解（附源码）"><span class="link-card-box"><span class="link-title">VC++ Windows7及以上系统中管理员权限与UAC虚拟化详解（附源码）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/12/82/DxGQ4nyx_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/124096307</span></span></a></p> 
<h3 id="4%E3%80%81%E7%A8%8B%E5%BA%8F%E5%88%B0%E5%BA%95%E4%BB%A5%E5%93%AA%E7%A7%8D%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%EF%BC%9F%E4%B8%8E%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E6%9C%89%E5%85%B3%EF%BC%9F">4、程序到底以哪种权限运行？与哪些因素有关？</h3> 
<p>        程序有没有以管理员权限运行，主要和两个因素有关，一个是当前系统登录的用户类型（标准用户、管理员用户以及超级管理员用户），一个是程序有没有设置以管理员权限运行的属性。下面以win10系统来说明，win10系统和win7系统有一些不同的，不过大体上是一样的。</p> 
<h4 id="4.1%E3%80%81%E7%BB%99%E7%A8%8B%E5%BA%8F%E8%AE%BE%E7%BD%AE%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84%E5%B1%9E%E6%80%A7">4.1、给程序设置以管理员权限运行的属性</h4> 
<p>       如何给程序设置以管理员权限运行的属性呢？对于Visual Studio编译的程序，设置以管理员权限运行比较简单。只要在exe主程序的<strong>工程属性中，链接器 -&gt; 清单文件 -&gt; UAC执行级别</strong>，如下所示：</p> 
<p class="img-center"><img alt="" height="555" src="https://images2.imgbox.com/0b/20/djc59tV4_o.png" width="767"></p> 
<p>我们选择reguireAdministrator选项就可以了。<strong>设置这个属性后，程序在启动时会自动向系统申请以管理员权限运行。</strong></p> 
<blockquote> 
 <p>如果当前登录的管理员用户，则程序启动时直接以管理员权限运行。如果当前登录的是标准用户，则启动时会弹出提权的提示框，需要输入一个管理员账户和密码才能将程序启动起来。</p> 
</blockquote> 
<p>       这里还有个细节问题，需要注意一下。之前在帮兄弟项目组排查过一个<strong>程序设置以管理员权限运行无效的问题</strong>，可以参见我之前写的文章：</p> 
<p><a class="has-card" href="https://blog.csdn.net/chenlycly/article/details/128158192" title="设置程序以管理员权限运行无效问题的排查过程分享"><span class="link-card-box"><span class="link-title">设置程序以管理员权限运行无效问题的排查过程分享</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/90/9e/6Wx9OrzD_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/128158192</span></span></a></p> 
<h4 id="4.2%E3%80%81%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E7%9A%84%E7%B1%BB%E5%9E%8B">4.2、当前登录用户的类型</h4> 
<p>       程序到底以哪种权限运行，除了设置以管理员权限运行的属性外，还和当前登录的用户有关。</p> 
<p><strong>4.2.1、超级管理员Administrator登录</strong></p> 
<p>        如果使用Administrator超级管理员登录，不管程序有没有设置以管理员权限运行，都会以管理员权限运行。超级管理员Administrator的权限是最高的。</p> 
<p>       在Windows系统中，默认情况下，超级管理员Administrator是禁用的，可以通过这样的途径来开启：右键计算机 -&gt;管理 -&gt;系统工具 -&gt;本地用户和组 -&gt;用户 -&gt;右键Administrator -&gt;属性 -&gt;取消账户禁用：</p> 
<p class="img-center"><img alt="" height="602" src="https://images2.imgbox.com/3c/cd/jgfDhUp5_o.png" width="829"></p> 
<blockquote> 
 <p>超级管理员在用户管理中是可以重命名的。</p> 
</blockquote> 
<p><strong>4.2.2、管理员用户登录</strong></p> 
<p>       这里讲的管理员是普通管理员，不是超级管理员。可以右键点击程序，在弹出的右键菜单中点击“以管理员身份运行”：</p> 
<p class="img-center"><img alt="" height="272" src="https://images2.imgbox.com/de/da/DetUQmEP_o.png" width="290"></p> 
<p>这样启动起来的程序有管理员权限。</p> 
<p>       如果是直接双击启动的或者通过桌面快捷方式或开始菜单快捷方式运行，到底是以何种权限运行，就要看程序有没有设置以管理员权限运行的属性。如果设置了，就以管理员权限运行；如果没设置，就以标准用户权限运行。</p> 
<p><strong>4.2.3、标准用户登录</strong></p> 
<p>       如果当前登录的是标准用户，那要看程序有没有设置以管理员权限运行的属性。如果没有配置，则以标准用户权限运行；如果配置了以管理员权限运行，则会弹出如下的提示框：（<em>在标准用户登录下双击需要管理员运行权限的QQ安装包时弹出的提示框</em>）</p> 
<p class="img-center"><img alt="" height="481" src="https://images2.imgbox.com/45/d8/tfySKKVY_o.png" width="461"></p> 
<p>需要输入管理员账户和密码，要提权到管理员账户，然后才能以管理员权限运行。如果取消管理员账户的登录，则程序启动失败。</p> 
<p>       <strong>如何通过代码去判断程序是否以管理员权限运行</strong>，可以参见我之前的文章：</p> 
<p><a class="has-card" href="https://blog.csdn.net/chenlycly/article/details/45419259" title="VC++判断进程是否以管理员权限运行（附源码）"><span class="link-card-box"><span class="link-title">VC++判断进程是否以管理员权限运行（附源码）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ca/02/zIWrBirq_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/chenlycly/article/details/45419259</span></span></a>       <strong><span style="color:#1a439c;">如果两个程序（进程）权限不对等，相互之间操作时可能会出现失败的现象，因为系统不允许两个权限不同的进程相互操作。</span></strong>下面讲几个实际工作中可能遇到的问题实例，以供大家借鉴或参考。<span style="color:#1a439c;"><strong>以下案例都是管理员用户（非超级管理员Administrator）登录下的场景。</strong></span></p> 
<h3 id="5%E3%80%81%E6%A1%88%E4%BE%8B1%20-%20%E6%97%A0%E6%B3%95%E5%9C%A8%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E6%A1%86%E4%B8%AD%E5%90%AF%E5%8A%A8%E5%AE%89%E8%A3%85%E5%8C%85%E7%A8%8B%E5%BA%8F">5、案例1 - 无法在企业微信聊天框中启动安装包程序</h3> 
<p>       企业微信默认是以标准用户运行的，比如双击桌面快捷方式或者从开始菜单中点击运行起来的，都是以标准用户权限运行的。某天我将软件最新的安装包发到企业微信的群中，同事在群中收到该文件后，<span style="color:#fe2c24;"><em>直接在企业微信聊天框中双击该安装包文件，但弹出了如下的报错提示框</em></span>：</p> 
<p class="img-center"><img alt="" height="131" src="https://images2.imgbox.com/98/5a/mkkhdckO_o.png" width="507"></p> 
<p>大家平时在企业微信中收到文件后，常习惯于直接双击去查看文件或者启动程序，但此次双击却报错了。同事怀疑是我们的软件安装包有问题，询问我们是怎么回事。从这个截图看，截图的标题是个企业微信的路径，然后提示文字是：Windows 无法访问指定设备、路径或文件。你可能没有适当的权限访问该项目。</p> 
<p>       作为开发人员，我们这类程序运行权限的问题比较熟悉了，一看就大概知道怎么回事了。<span style="color:#fe2c24;"><em>当前的企业微信是以标准用户权限运行的，而我们的软件安装包是设置以管理员权限运行的，两个程序进程的权限不对等，所以操作失败了。</em><em>低权限（标准用户权限）进程不能启动高权限（管理员权限）进程。</em></span></p> 
<h3 id="6%E3%80%81%E6%A1%88%E4%BE%8B2%20-%20%E4%BD%BF%E7%94%A8Windbg%E6%97%B6%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%81%87%E5%88%B0%E7%9A%84%E6%9D%83%E9%99%90%E4%B8%8D%E5%AF%B9%E7%AD%89%E5%AF%BC%E8%87%B4%E6%93%8D%E4%BD%9C%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98">6、案例2 - 使用Windbg时可能会遇到的权限不对等导致操作失败的问题</h3> 
<p>       我们在使用Windbg静态分析dump文件和附加到目标进程上动态调试时，也遇到过权限不对等导致操作失败的问题。</p> 
<h4 id="6.1%E3%80%81Windbg%E9%99%84%E5%8A%A0%E5%88%B0%E7%9B%AE%E6%A0%87%E8%BF%9B%E7%A8%8B%E5%A4%B1%E8%B4%A5">6.1、Windbg附加到目标进程失败</h4> 
<p>       当前要被附加调试的目标程序正以管理员权限运行，至于为什么以管理员权限运行，可能是右键以管理员权限运行的，也有可能程序是安装包安装后自动启动的（安装包是以管理员权限运行的，其启动的程序也继承了管理员权限）。而当前启动起来的Windbg是以标准用户权限运行（双击桌面快捷方式启动起来的），<em><span style="color:#fe2c24;">当将Windbg附加到以管理员权限运行的目标程序进程上时，附加失败</span></em>，如下所示：</p> 
<p class="img-center"><img alt="" height="475" src="https://images2.imgbox.com/b7/5b/ZKHXCrcV_o.png" width="786"></p> 
<p><span style="color:#fe2c24;"><em>低权限（标准用户权限）Windbg是不能附加到高权限（管理员权限）的目标程序进程上的。</em></span></p> 
<p>       如果Windbg是以管理员权限运行的，是可以成功附加到标准用户权限运行的进程上的，这个系统是允许的。 </p> 
<h4 id="6.2%E3%80%81dump%E6%96%87%E4%BB%B6%E6%8B%96%E5%88%B0%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84Windbg%E4%B8%AD%E6%B2%A1%E5%8F%8D%E5%BA%94">6.2、dump文件拖到以管理员权限运行的Windbg中没反应</h4> 
<p>       某天，同事反馈，无法用Windbg打开某个dump文件，具体现象是，<span style="color:#fe2c24;"><em>将磁盘上的dump文件拖入到已经打开的Windbg中没反应</em></span>：</p> 
<p class="img-center"><img alt="" height="528" src="https://images2.imgbox.com/de/a5/5mRC0hjM_o.png" width="734"></p> 
<p>        正常打开dump文件时的效果如下：</p> 
<p class="img-center"><img alt="" height="529" src="https://images2.imgbox.com/e5/cf/EaBlXlqe_o.png" width="734"></p> 
<p>同事怀疑是不是dump文件比较特殊，比如文件损坏了，所以打不开。按讲不应该的，dump文件的大小是非0的，估计是程序运行权限引起的。经确认，<span style="color:#fe2c24;"><em>Windbg是右键以管理员权限运行的，而dump文件是从磁盘上拖过来的，运行在explorer文件资源管理器进程中的，而文件资源管理器是以标准用户权限运行的，因为Windbg进程（管理员权限运行）与explorer.exe文件资源管理器进程（标准用户权限运行）权限不对等，所以系统禁止了文件拖放行为</em></span>，所以拖到Windbg中没反应。</p> 
<h3 id="7%E3%80%81%E6%A1%88%E4%BE%8B3%20-%20%E5%8F%8C%E5%87%BB%E6%A1%8C%E9%9D%A2%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%97%B6%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E5%B0%86%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%E8%B5%B7%E6%9D%A5%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%AA%97%E5%8F%A3%E5%BC%B9%E5%87%BA%E6%9D%A5">7、案例3 - 双击桌面快捷方式启动程序时并没有自动将已经启动起来的程序窗口弹出来</h3> 
<p>       很多程序只允许启动一个程序实例（只能运行一个进程），不像浏览器程序，可以启动多个程序（窗口）。只允许程序运行一个实例，大体是这么实现的，<span style="color:#1a439c;"><strong>当程序启动时会去检测是否有程序进程已经启动，如果已经有程序进程运行且不是当前的进程，则自动将当前新启动的进程退出，这样就能保证程序只运行一个实例了。</strong></span></p> 
<p><strong>       </strong>假定当前程序已经运行且只允许运行一个程序实例，但我们没有看到程序窗口（可能程序被最小化了，或者被最小化到托盘区域了），不确定程序有没有运行起来，我们会去双击桌面快捷方式。此时，因为程序之前已经启动起来，<span style="color:#1a439c;"><strong>按理我们要将已经运行的程序窗口自动弹出来</strong></span>。我们的软件代码也确实这么实现了，但在某个场合下还是没有将已经运行的程序窗口弹出来。</p> 
<p>       <span style="color:#1a439c;"><strong>场景是这样的</strong></span>：已经运行的程序，是使用安装包安装软件后自动启动起来的，因为安装包是以管理员权限运行的，所以被启动起来的程序默认是继承了管理员权限。而我们通过双击桌面快捷方式启动的新的进程是以标准权限运行的，程序初始化运行时会去检测程序是否已经运行，确实检测到程序已经运行，并找到了已经运行的程序主窗口，<span style="color:#fe2c24;"><em>但在调用API函数ShowWindow将该窗口Show出来时却失败了</em></span>。</p> 
<p>       于是想到MSDN上查看API函数ShowWindow的说明，看看能不能将相关值打印出来，分析一下该函数为什么会调用失败。ShowWindow函数在MSDN上的说明如下：</p> 
<p class="img-center"><img alt="" height="766" src="https://images2.imgbox.com/e9/f8/G6bv3LXc_o.png" width="695"></p> 
<p>该函数的返回值是BOOL型的，但<em>这个返回值只是标识窗口之前的状态，并不是标识ShowWindow函数是否执行成功的</em>，<span style="color:#1a439c;"><strong>只能借助GetLastError函数，通过获取LastError值找到ShowWindow执行失败的原因</strong></span></p> 
<blockquote> 
 <p>有些Windows API需要借助GetLastError获取的LastError值去判断有没有执行成功：</p> 
 <p>1）如果LastError值为0，则表示执行成功；</p> 
 <p>2）如果LastError值不为0，则表示执行失败，LastError值对应的就是执行失败的原因。</p> 
</blockquote> 
<p>于是添加如下的打印：</p> 
<pre><code class="language-cpp">BOOL bShowTargetWndSuccess = FALSE;
SetLastError(0);
::ShowWindow(hPrevWnd, SW_RESTORE);
dwLastError = GetLastError();
if ( dwLastError == 0 )
{
    // 窗口Show成功了
    bShowTargetWndSuccess = TRUE;
}
else
{
    // 窗口Show失败了，将API函数ShowWindow设置完后设置的LastError值打印出来
    char szLog[256] = { 0 };
    sprintf(szLog, "[CheckShowExsitingWnd] show target window failed, LastError = %d.", dwLastError);
    WriteLog(szLog);
}</code></pre> 
<p>后来复现了这个问题，查看到调用ShowWindow窗口Show失败时设置的LastError值为5，到VS自带的错误查看工具中查看该值的含义如下：</p> 
<p class="img-center"><img alt="" height="179" src="https://images2.imgbox.com/85/ff/vsL4KpJD_o.png" width="298"></p> 
<p>拒绝访问，应该就是权限问题导致ShowWindow执行失败了。已经运行的程序进程因为是安装包安装完成后自动启动的，所以有管理员权限，而新启动的进程是双击桌面快捷方式启动的，所以是以标准用户权限运行的。<span style="color:#fe2c24;"><em>新启动的进程检测到程序已经运行，低权限（标准用户权限）的新进程想要其Show高权限（管理员权限）的已启动进程中的窗口，系统是不允许的，所以导致ShowWindow执行失败。</em></span></p> 
<p>      <span style="color:#1a439c;"><strong> 目前规避的办法</strong></span>是，当我们发现ShowWindow执行失败（判断LastError值）时，直接弹出一个提示框，但还是没有将已启动的程序窗口弹出来，这只是个规避问题的方法，用户体验不好。</p> 
<p>      <span style="color:#1a439c;"><strong> 最好的解决办法</strong></span>是，<span style="color:#1a439c;"><strong>安装包在安装完成后自动启动进程时，直接以标准用户权限启动程序</strong></span>，这样就没有权限不对等的问题了，这样就能自动弹出已经运行的程序窗口了。</p> 
<p>       和企业微信对比了一下，在同样的场景下企业微信是没问题的，企业微信能自动将已经运行的程序窗口弹出来。我们编写了监测程序进程是否以管理员权限运行的代码（<em>本文后面会给出判断程序进程是否已管理员权限运行的代码</em>），发现企业微信安装包执行完后自动启动起来的企业微信进程是标准用户权限运行的。企业微信安装包肯定是以管理员权限运行的（<em>安装包要可能要向系统敏感路径写入内容，要写注册表，要注册控件，所以一般安装包需要以管理员权限运行</em>），从企业微信的安装包程序的图标就能看出来，图标的右下角有个小盾牌：</p> 
<p class="img-center"><img alt="" height="135" src="https://images2.imgbox.com/20/65/OzcYzkPp_o.png" width="130"></p> 
<p>以管理员权限运行的安装包进程，以标准用户权限去启动企业微信的主程序，即启动起来的企业微信主程序是以标准用户权限运行的。</p> 
<p>       <span style="color:#1a439c;"><strong>那如何启动一个标准用户权限运行的进程呢？</strong></span>还记得我之前讲过的<span style="color:#1a439c;"><strong>开源工具Process Hacker</strong></span>吗？我们在日常排查问题时，会使用到Process Hacker，之前在菜单中看到以标准用户权限创建进程的功能。在该工具的菜单栏中，<em>hacker -&gt; Run as limited user...</em>：</p> 
<p class="img-center"><img alt="" height="549" src="https://images2.imgbox.com/c6/04/iCoJ05BL_o.png" width="770"></p> 
<p>因为Process Hacker的源码是开源的，大家需要这个功能的话，可以到源码中去找该菜单项对应的源码实现。<span style="color:#1a439c;"><strong>此处给出Process Hacker开源代码中以标准用户权限创建一个进程的部分代码</strong></span>：</p> 
<pre><code class="language-cpp">NTSTATUS status;
HANDLE tokenHandle;
HANDLE newTokenHandle;

if (NT_SUCCESS(status = PhOpenProcessToken(
    NtCurrentProcess(),
    TOKEN_ASSIGN_PRIMARY | TOKEN_DUPLICATE | TOKEN_QUERY | TOKEN_ADJUST_GROUPS |
    TOKEN_ADJUST_DEFAULT | READ_CONTROL | WRITE_DAC,
    &amp;tokenHandle
    )))
{
    if (NT_SUCCESS(status = PhFilterTokenForLimitedUser(
        tokenHandle,
        &amp;newTokenHandle
        )))
    {
        status = PhCreateProcessWin32(
			NULL,
			(PWSTR)runFileDlg-&gt;lpszFile,
			NULL,
			NULL,
			0,
			newTokenHandle,
			NULL,
			NULL
			);

        NtClose(newTokenHandle);
    }

    NtClose(tokenHandle);
}</code></pre> 
<p>如果要实现这个功能，则需要到Process Hacker开源代码中拷贝完整的源码。</p> 
<blockquote> 
 <p>我们之前还讲过一个类似的工具叫<span style="color:#1a439c;"><strong>Process Explorer</strong></span>，这个工具我们日常用的比较多，它也有类似的功能，但该工具不是开源的，我们看不到他的源码实现。</p> 
</blockquote> 
<h3 id="8%E3%80%81%E4%B8%8E%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E7%9A%84%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98">8、与管理员权限相关的其他问题</h3> 
<p>        还有一些与管理员权限相关的其他问题，比如如何通过代码去以管理员权限启动一个程序，开机自启动程序不能时设置以管理员权限运行的程序。下面我们就来详细看看这两个典型的问题。</p> 
<h4 id="8.1%E3%80%81%E5%A6%82%E4%BD%95%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%EF%BC%9F">8.1、如何以管理员权限启动一个程序？</h4> 
<p>       一个有管理员权限的程序，其启动起来的其他程序默认也是有管理员权限的，即子进程默认是继承父进程的管理员运行权限的。同理，一个没有管理员权限的程序，其启动起来的其他程序，默认是没有管理员权限的。</p> 
<p>       那一个没有管理员权限的程序是否能够启动一个有管理员权限的程序呢？答案是肯定的，是可以做到的。一个没有管理员权限的程序，可以<span style="color:#1a439c;"><strong>调用API函数ShellExecuteEx，传入runas参数</strong></span>去启动另一个程序，这样这个被启动起来的程序就是以管理员权限启动的，即启动起来的程序是以管理员权限运行的。以runas方式将启动程序的代码如下：</p> 
<pre><code class="language-cpp">SHELLEXECUTEINFO si;
RtlZeroMemory( &amp;si, sizeof( SHELLEXECUTEINFO ) );
si.cbSize = sizeof(SHELLEXECUTEINFO);
si.lpFile = _T("D:\\test.exe");
//si.lpParameters = lpCmdParam;
si.nShow = SW_SHOWNORMAL;
si.lpVerb = _T("runas");
BOOL bRet = ShellExecuteEx( &amp;si );
if ( !bRet ) // TL启动失败
{
    TCHAR achLog[256] = { 0 };
 
    // 先取lasterror值
    DWORD dwLastErr = GetLastError();
    _stprintf( achLog, _T("ShellExecuteEx failed, GetLastError: %d."), dwLastErr );
    WriteLog( achLog );
 
    // 再取hInstApp错误代码
    int nHInsVal = (int)si.hInstApp;
    if ( nHInsVal &lt;= 32 )
    {
        _stprintf( achLog, _T("ShellExecuteEx failure, errcode: %d."), nHInsVal );
        WriteLog( achLog );
    }
}</code></pre> 
<p>       注意，在调用ShellExecuteEx启动程序失败时，可通过SHELLEXECUTEINFO结构体中的hInstApp字段值来获取错误码，代码如上所示，错误码主要有以下几种：</p> 
<table><tbody><tr><th>错误</th><th>说明</th></tr><tr><td>ERROR_FILE_NOT_FOUND</td><td>找不到指定的文件。</td></tr><tr><td>ERROR_PATH_NOT_FOUND</td><td>未找到指定路径。</td></tr><tr><td>ERROR_DDE_FAIL</td><td>动态数据交换 (DDE) 事务失败。</td></tr><tr><td>ERROR_NO_ASSOCIATION</td><td>没有与指定的文件扩展名关联的应用程序。</td></tr><tr><td>ERROR_ACCESS_DENIED</td><td>拒绝访问指定文件。</td></tr><tr><td>ERROR_DLL_NOT_FOUND</td><td>找不到运行应用程序所需的库文件之一。</td></tr><tr><td>ERROR_CANCELLED</td><td>函数提示用户输入其他信息，但用户取消了请求。</td></tr><tr><td>ERROR_NOT_ENOUGH_MEMORY</td><td>没有足够的内存来执行指定的操作。</td></tr><tr><td>ERROR_SHARING_VIOLATION</td><td>发生共享冲突。</td></tr></tbody></table> 
<h4 id="8.2%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E4%B8%8D%E8%83%BD%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90">8.2、开机自启动程序不能设置管理员权限</h4> 
<p>       所谓开机自启动，是跟随Windows系统一起启动，即在Windows系统启动起来进入桌面后，程序自动启动起来。对于设置开机自启动的程序不能设置以管理员权限启动，否则会开机自启动失败。出于安全考虑，Windows系统禁止以管理员权限启动的程序在开机时自启动，因为管理员权限启动起来的程序，可以修改系统关键目录中的文件。</p> 
<p>       如果主程序确实需要管理员权限启动（可能是程序中执行的很多操作都需要管理员权限，比如向系统路径写入内容、向系统注册控件等），则可以<span style="color:#1a439c;"><strong>单独写一个exe启动程序，比如XXXLauncher.exe，该启动程序不设置以管理员权限启动，可以完成开机自启动，然后在该程序启动起来后再将调用ShellExecuteEx将主程序以runas方式启动起来</strong></span>，这样主程序就以管理员权限运行了。关于以runas启动目标程序的代码，上面已经说了，直接拿过来使用就可以了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98a3ded40d4e1dc85cd3ee0e4cd17d1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Zookeeper实战案例（1）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e426a393102dd41e39a0b080751ce652/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Otter改造 增加Springboot模块和外部调用接口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>