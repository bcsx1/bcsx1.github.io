<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用DreamBooth实现对于文生图扩散模型的微调 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用DreamBooth实现对于文生图扩散模型的微调" />
<meta property="og:description" content="利用DreamBooth实现对于文生图扩散模型的微调 文章目录 利用DreamBooth实现对于文生图扩散模型的微调1.背景2.DreamBooth3.基本效果(1).一般效果(2).和Textual Inversion对比 3.摘要一个小问题 4.Personalization of Text-to-Image Models(1).目标与思路(2).为什么要选小样本？(3).那么问题来了(4).模式坍塌是啥？(5).那咋办？ 5.Designing Prompts for Few-Shot Personalization(1).构造提示词的方法(2).为什么要选择稀有词而不是随机词？ 6.Class-specific Prior Preservation Loss(1).新的问题！(2).Language Drift是什么？#1.*Countering Language Drift with Seeded Iterated Learning*#2.*Countering Language Drift via Visual Grounding* (3).所以，我们选择PPL(4).这里说的过拟合又是什么？ 7.实验(1).数据集(2).训练消耗(3).消融实验(4).Prior Preservation Loss Ablation#1.先看看图#2.再看看数据 (5).Class-Prior Ablation(6).效果 8.自行训练(1).利用Diffusers库进行DreamBooth训练 总结 Google Research在2022年8月提出的一种 全新的对于文生图扩散模型(Text-to-Image Diffusion Model)的微调方式，在之后也成功入选 CVPR 2023，论文链接： DreamBooth: Fine Tuning Text-to-Image Diffusion Models for Subject-Driven Generation DreamBooth的效果是相当卓越的，我们能够让模型“记住”某个物体长什么样，然后像照相馆一样，给你拍出各种各样的照片来。
所以接下来我们先来介绍一下微调技术出现的一些背景。
1.背景 目前出现的很多文生图大模型已经具备了相当卓越的生成能力，例如Stable-Diffusion、Imagen等等。如果我们在Prompt中输入一个 [Van Gogh Style]，或许它能很快给你画出梵高风格的一幅画，但我作为一个不知名的人，我也不能奢求Stable Diffusion在训练的时候把我的画也加进去是吧？所以如果我们能自己个性化调整一下这个模型就好了。也正是因为上面说的，结合扩散模型本身生成内容的多样性我们可以知道：同一个提示词生成几十几百次得到的图片可能都不一样，现在的模型不能保证生成相同物体的一致性。而如果依照我们的自然想法，那肯定是把整个模型重新训练调整一下，但是这样一来首先我们肯定需要比较大的数据样本，二来对于整个大模型进行重新训练的成本非常高，训练整个Stable-Diffusion-1.4大概要15万GPU小时，如果是这样对于我们来说就变得很不可及了。 2.DreamBooth 于是，Google Research团队提出了一种名为DreamBooth的全新微调方法。
原本的Text-to-Image模型(左侧红色的部分)能够根据&#34;A dog&#34;这条Prompt生成不同的狗的照片，经过DreamBooth微调后的模型能够在接收&#34;A [V] dog&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7e1bdb861bea1503e60eec9c84182efe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-23T12:36:52+08:00" />
<meta property="article:modified_time" content="2023-09-23T12:36:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用DreamBooth实现对于文生图扩散模型的微调</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DreamBooth_0"></a>利用DreamBooth实现对于文生图扩散模型的微调</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#DreamBooth_0" rel="nofollow">利用DreamBooth实现对于文生图扩散模型的微调</a></li><li><ul><li><a href="#1_8" rel="nofollow">1.背景</a></li><li><a href="#2DreamBooth_14" rel="nofollow">2.DreamBooth</a></li><li><a href="#3_25" rel="nofollow">3.基本效果</a></li><li><ul><li><a href="#1_26" rel="nofollow">(1).一般效果</a></li><li><a href="#2Textual_Inversion_36" rel="nofollow">(2).和Textual Inversion对比</a></li></ul> 
   </li><li><a href="#3_43" rel="nofollow">3.摘要</a></li><li><ul><li><a href="#_48" rel="nofollow">一个小问题</a></li></ul> 
   </li><li><a href="#4Personalization_of_TexttoImage_Models_53" rel="nofollow">4.Personalization of Text-to-Image Models</a></li><li><ul><li><a href="#1_54" rel="nofollow">(1).目标与思路</a></li><li><a href="#2_58" rel="nofollow">(2).为什么要选小样本？</a></li><li><a href="#3_65" rel="nofollow">(3).那么问题来了</a></li><li><a href="#4_68" rel="nofollow">(4).模式坍塌是啥？</a></li><li><a href="#5_80" rel="nofollow">(5).那咋办？</a></li></ul> 
   </li><li><a href="#5Designing_Prompts_for_FewShot_Personalization_85" rel="nofollow">5.Designing Prompts for Few-Shot Personalization</a></li><li><ul><li><a href="#1_86" rel="nofollow">(1).构造提示词的方法</a></li><li><a href="#2_91" rel="nofollow">(2).为什么要选择稀有词而不是随机词？</a></li></ul> 
   </li><li><a href="#6Classspecific_Prior_Preservation_Loss_104" rel="nofollow">6.Class-specific Prior Preservation Loss</a></li><li><ul><li><a href="#1_105" rel="nofollow">(1).新的问题！</a></li><li><a href="#2Language_Drift_111" rel="nofollow">(2).Language Drift是什么？</a></li><li><ul><li><a href="#1Countering_Language_Drift_with_Seeded_Iterated_Learning_112" rel="nofollow">#1.*Countering Language Drift with Seeded Iterated Learning*</a></li><li><a href="#2Countering_Language_Drift_via_Visual_Grounding_119" rel="nofollow">#2.*Countering Language Drift via Visual Grounding*</a></li></ul> 
    </li><li><a href="#3PPL_142" rel="nofollow">(3).所以，我们选择PPL</a></li><li><a href="#4_152" rel="nofollow">(4).这里说的过拟合又是什么？</a></li></ul> 
   </li><li><a href="#7_157" rel="nofollow">7.实验</a></li><li><ul><li><a href="#1_159" rel="nofollow">(1).数据集</a></li><li><a href="#2_162" rel="nofollow">(2).训练消耗</a></li><li><a href="#3_168" rel="nofollow">(3).消融实验</a></li><li><a href="#4Prior_Preservation_Loss_Ablation_172" rel="nofollow">(4).Prior Preservation Loss Ablation</a></li><li><ul><li><a href="#1_173" rel="nofollow">#1.先看看图</a></li><li><a href="#2_182" rel="nofollow">#2.再看看数据</a></li></ul> 
    </li><li><a href="#5ClassPrior_Ablation_189" rel="nofollow">(5).Class-Prior Ablation</a></li><li><a href="#6_195" rel="nofollow">(6).效果</a></li></ul> 
   </li><li><a href="#8_205" rel="nofollow">8.自行训练</a></li><li><ul><li><a href="#1DiffusersDreamBooth_208" rel="nofollow">(1).利用Diffusers库进行DreamBooth训练</a></li></ul> 
   </li><li><a href="#_219" rel="nofollow">总结</a></li></ul> 
 </li></ul> 
</div> 
<br>   Google Research在2022年8月提出的一种 
<strong>全新</strong>的对于文生图扩散模型(Text-to-Image Diffusion Model)的微调方式，在之后也成功入选 
<strong>CVPR 2023</strong>，论文链接： 
<a href="https://arxiv.org/abs/2208.12242" rel="nofollow">DreamBooth: Fine Tuning Text-to-Image Diffusion Models for Subject-Driven Generation</a> 
<p></p> 
<p>  DreamBooth的效果是相当卓越的，我们能够让模型“记住”某个物体长什么样，然后像照相馆一样，给你拍出各种各样的照片来。</p> 
<p>  所以接下来我们先来介绍一下微调技术出现的一些背景。</p> 
<h3><a id="1_8"></a>1.背景</h3> 
<ul><li>目前出现的很多文生图大模型已经具备了<strong>相当卓越</strong>的生成能力，例如Stable-Diffusion、Imagen等等。</li><li>如果我们在Prompt中输入一个 <strong>[Van Gogh Style]</strong>，或许它能很快给你画出<strong>梵高风格</strong>的一幅画，但我作为一个不知名的人，我也不能奢求Stable Diffusion在训练的时候把我的画也加进去是吧？所以如果我们能自己<strong>个性化调整</strong>一下这个模型就好了。</li><li>也正是因为上面说的，结合扩散模型本身生成内容的多样性我们可以知道：<strong>同一个提示词生成几十几百次得到的图片可能都不一样</strong>，<strong>现在的模型不能保证生成相同物体的一致性</strong>。</li><li>而如果依照我们的自然想法，那肯定是<strong>把整个模型重新训练调整一下</strong>，但是这样一来首先我们肯定需要比较大的数据样本，二来对于整个大模型进行重新训练的成本非常高，训练整个Stable-Diffusion-1.4大概要15万GPU小时，如果是这样对于我们来说就变得很不可及了。</li></ul> 
<h3><a id="2DreamBooth_14"></a>2.DreamBooth</h3> 
<p><img src="https://images2.imgbox.com/d1/b3/aYUKGpU7_o.png" alt="在这里插入图片描述"></p> 
<p>  于是，Google Research团队提出了一种名为DreamBooth的全新微调方法。</p> 
<p>  原本的Text-to-Image模型(<strong>左侧红色的部分</strong>)能够根据"A dog"这条Prompt生成不同的狗的照片，经过DreamBooth微调后的模型能够在接收"A [V] dog"和"A dog"的两种情况下，分别绘制出<strong>曾经记住的那条狗</strong>以及扩散模型<strong>本身能够画出的这些狗</strong>。</p> 
<p>  这也就是说，DreamBooth方法对于有或没有标识符的Prompt生成图像的情况下，采取的是相同的权重，这也就告诉我们：<strong>DreamBooth方法是对整个扩散模型进行的微调。</strong></p> 
<p>  Google Research在论文中对DreamBooth中提到：“It’s like a photo booth, but once the subject is captured, it can be synthesized wherever your dreams take you”, DreamBooth就像一个<strong>照相馆</strong>，能够让我们像拍照片一样生成各种各样的图片。</p> 
<h3><a id="3_25"></a>3.基本效果</h3> 
<h4><a id="1_26"></a>(1).一般效果</h4> 
<p><img src="https://images2.imgbox.com/5b/41/MluCG8UJ_o.png" alt="在这里插入图片描述"></p> 
<p>  这张图片中展示了<strong>经过微调后的生成模型与图片指导的DALL-E2，文本指导的Imagen在生成同一个物体上的效果</strong>。</p> 
<p>  我们输入的是三种同一个闹钟的照片，闹钟的一个重要特征是<strong>白底，且右边有一个黄色的数字3</strong>，然后我们送进各种模型里，再让它们生成图片，结果发现:OpenAI的DALL-E2在物体的<strong>保真性</strong>和<strong>新内容生成</strong>两方面的效果都很差，不仅闹钟的形状不对，连生成的三种图片的背景都是在只有在被子上的，<strong>这样就不符合我们的要求了</strong>。</p> 
<p>  然后是Google的Imagen，它比DALL-E2要好一点，至少背后有了新的场景，不过这个闹钟还是没有像以前一样。</p> 
<p>  最后就是DreamBooth微调后的模型，这个效果真的可以说是相当好了，<strong>物体保真性</strong>和<strong>新内容生成</strong>都成功兼顾到了，当然，它也是有一定瑕疵的，比如我们可以看到DreamBooth放大的那一张图片上，分钟刻度是有一些模糊的，不过这可能也正好能够说明：<strong>这图确实是AI画的，不是照片</strong>。</p> 
<h4><a id="2Textual_Inversion_36"></a>(2).和Textual Inversion对比</h4> 
<p>  DreamBooth主要的对手就是之前提出的Textual Inversion，让我们来看看效果：<br> <img src="https://images2.imgbox.com/b4/01/KcpLBtcz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/83/CYX0hPaS_o.png" alt="在这里插入图片描述"></p> 
<p>  相比之下效果还是比较明显的对吧？中间的两组图片是用DreamBooth微调过后的Imagen和Stable Diffusion模型画出来的，而最后一个是用Textual Inversion微调后画出来的图片，Textual Inversion看起来是<strong>范围太大</strong>，把学习到的花瓶的纹理<strong>迁移到整个画面上去了</strong>，这其实提示我们：<strong>Textual Inversion或许更适合用来做风格迁移方面的微调</strong>。</p> 
<h3><a id="3_43"></a>3.摘要</h3> 
<p>  在这篇文章中，我们提出了一种全新的文本到图像扩散模型 <strong>“个性化”方法</strong>。给定几个作为主体的图像作为输入，我们便可实现对于预训练的文生图模型的微调，使得其将<strong>唯一标识符(Unique Identifier)<strong>与</strong>特定主体</strong>绑定。</p> 
<p>  例如我们用sks作为<strong>标识符</strong>绑定<strong>某只特定的猫</strong>，通过DreamBooth微调后的模型，则输入prompt: a sks cat running on the lawn后，就会生成一张我们<strong>微调训练时使用的猫在草坪上奔跑的图片</strong>。</p> 
<h4><a id="_48"></a>一个小问题</h4> 
<p>  Google Research在发表这篇论文后，并<strong>没有公开</strong>团队自己用于完成论文的DreamBooth模型<strong>代码</strong>，现在能够找到的代码基本都是在其论文基础上的<strong>第三方复现</strong>，如后续会提到的Diffusers库提供的DreamBooth训练脚本。</p> 
<p>  不过其实复现出来的效果也并不差，说明这个模型的确是比较成功的，接下来就让我们来看看论文的核心部分吧。</p> 
<h3><a id="4Personalization_of_TexttoImage_Models_53"></a>4.Personalization of Text-to-Image Models</h3> 
<h4><a id="1_54"></a>(1).目标与思路</h4> 
<ul><li><strong>目标</strong>：为了能够让模型记住输入的主体，我们需要<strong>把物体植入到模型的输出域中</strong>。</li><li><strong>思路</strong>：采用<strong>小样本</strong>进行模型微调。</li></ul> 
<h4><a id="2_58"></a>(2).为什么要选小样本？</h4> 
<p>  先说说为什么是<strong>小样本</strong>，其实很好想，比如我们如果希望让这个扩散模型学会某个书法家的字体，然后给我生成一些字的图片，那我总不能说：<strong>让人家给我把常用的三四千个汉字全写一遍吧？</strong></p> 
<p>  这样就完全没有意义了，我们希望的就是模型能够在<strong>不那么大的代价</strong>下学习到这个书法家的字体，这个代价一般不是训练过程的代价，而是<strong>我们为了让模型学会付出的代价</strong>，比如你教小朋友十以内的加法，你不可能为了让ta学会，就打印几千几万道这样的题让ta算，这样效率太低了。</p> 
<p>  因此，对于这种微调的情况，我们要尽可能用小的样本来实现微调，而DreamBooth很理想，<strong>只需要3~5张图片</strong>就可以实现这个事情，不过这么小的样本，如果搭配上四五千轮的训练，感觉<strong>会非常容易过拟合</strong>，所以我们就有了以下的问题。</p> 
<h4><a id="3_65"></a>(3).那么问题来了</h4> 
<ul><li><strong>问题</strong>：在既往对于<strong>GAN模型微调</strong>的研究中，小样本量的微调会产生<strong>过拟合</strong>和<strong>模式坍塌</strong>的问题。</li></ul> 
<h4><a id="4_68"></a>(4).模式坍塌是啥？</h4> 
<p>  模式坍塌是GAN的训练问题，指生成器(G)<strong>只能生成真实数据分布中的一部分或一种模式</strong>，而忽略了其他的多样性。例如，用GAN生成手写数字图像，有时GAN可能只生成其中一种或几种数字，这就是模式坍塌。</p> 
<p>  一般来说，模式坍塌是由于生成器和判别器(D)之间的<strong>对抗关系不平衡造成</strong>的。如果<strong>D太强，G就会找到一种能骗过D的模式，并且不断重复这种模式</strong>；如果<strong>D太弱，G就会找到一种最容易生成的模式，且不再探索其他的模式</strong>。</p> 
<p>  还有点迷糊，我再换个例子解释一下：你的高中班主任是一个<strong>非常非常严格的人</strong>，ta给你们班定了一系列非常严格的班规，<strong>你觉得非常不自在</strong>，作为一个不是那么听话的孩子，你决定反其道而行之，在充分研究了班规后，你发现了一个<strong>漏洞</strong>，然后完成了你想做的事情。</p> 
<p>  另一个方面，你的高中班主任<strong>完全不管你</strong>，这时候你发现<strong>我直接当着ta的面玩手机都行</strong>，于是你也就不再去像别的办法做你想做的事情了。</p> 
<p>  这就对应了上面说的两种<strong>对抗关系不平衡</strong>的情况，当然我没有说高中班主任怎么样的意思，只是举个例子。<br>   对于模式坍塌这个问题，我的理解就是：<strong>AI模型本身其实也是一大堆数值堆起来的数据模型，它暂时还没有如此智能，因此训练的时候，我们设定的Loss函数只是指导它应该往哪个方向收敛，并没有规划路径，因此它完全有可能走一些“歪门邪道”来解决问题，这和我们后面还会提到的Language Drift是相似的问题。</strong></p> 
<h4><a id="5_80"></a>(5).那咋办？</h4> 
<p>  不咋办，DreamBooth是对扩散模型做的微调，而<strong>大的扩散模型</strong>“看样子”很擅长在<strong>不丢失原有的参数</strong>以及对小数据样本产生<strong>过拟合</strong>的情况下，将<strong>新的信息整合进入其输出域中</strong>。</p> 
<p>  其实也好理解，我之前提过，大的扩散模型是有相当强的<strong>生成多样性</strong>的，那么从这个方面上来看，整合新信息对于扩散模型来说应该并不困难。</p> 
<h3><a id="5Designing_Prompts_for_FewShot_Personalization_85"></a>5.Designing Prompts for Few-Shot Personalization</h3> 
<h4><a id="1_86"></a>(1).构造提示词的方法</h4> 
<p>  还真别小看这个部分，提示词的构造其实对于微调模型相当重要，毕竟<strong>你是在尝试让模型给你输出原本的物体</strong>，那你肯定要用比较精确的提示词才能有好的效果。</p> 
<p>  DreamBooth的提示词是这样构成的：a [identifier] [class noun]，identifier是一个<strong>标识符</strong>，一般要求使用<strong>比较稀有的、不常见的词</strong>作为标识符；而class noun是对于需要标识的物体的“<strong>类别描述词</strong>”，例如dog, cat等等。</p> 
<h4><a id="2_91"></a>(2).为什么要选择稀有词而不是随机词？</h4> 
<p>  DreamBooth特别要求，在构造提示词的时候要<strong>尽可能使用词典中存在的不常见/稀有词，而不是常见词或者随机生成的词</strong>。</p> 
<p>  构造提示词最简单的想法其实就是找个存在的词，比如我要<strong>记住一只猫</strong>，提示词就让它是<strong>a cat</strong>，你非说这样不行吧，也不至于，但是这样就会<strong>使得扩散模型在这个小样本上过拟合，然后失去通过这个词生成图片的泛化能力</strong>，毕竟你要让扩散模型准确输出这只猫，那就肯定要丢掉其他猫的记忆了，这也就是一种<strong>过拟合</strong>的问题。</p> 
<p>  那既然上面这条路走不通，那我就让你完全认不出来吧，比如文中随机构造了一个"xxy5syt00"作为标识符，这总行了吧？<strong>不行哦，这样构造的词可能效果跟上面那种一样差。</strong> 为什么？这扩散模型不可能认识啊，其实这是犯了一个主观上的错误，它确实不认识这个词，但是<strong>分词器可能也不认识啊</strong>，它在接收我们的提示词输入的时候，有可能会根据一定的分词方式，<strong>将这种随机标识符分成几个词</strong>，而可能其中某个词，扩散模型是<strong>认识</strong>的，这样一来，就回到的第一种情况中说的过拟合了。</p> 
<p>  比如我是一个没什么新意的人，我给这个标识符起一个：myspecialcat，有可能经过分词后就变成了my special cat对应的向量，这就麻烦大了，我们到最后可能得到跟a cat一样的效果了。</p> 
<p>  <strong>所以，综上所述，作者在词表中选择罕见词来作为特殊标记符，这样避免了预训练模型对特殊标记符有丰富的先验知识</strong>。</p> 
<p>  其实这里我们也理解它的做法是什么了，就是把这个新的主体<strong>绑定</strong>到这个稀有词上，从而完成注入的过程。</p> 
<h3><a id="6Classspecific_Prior_Preservation_Loss_104"></a>6.Class-specific Prior Preservation Loss</h3> 
<h4><a id="1_105"></a>(1).新的问题！</h4> 
<ul><li> <p><strong>问题1</strong>：Language Drift，对模型进行微调可能产生在<em>Countering Language Drift with Seeded Iterated Learning</em><sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup>以及<em>Countering Language Drift via Visual Grounding</em><sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup>中提到的<strong>语言漂移</strong>问题。</p> </li><li> <p><strong>问题2</strong>：<strong>过拟合</strong>，长时间训练可能导致大模型丢失<strong>生成物体的多样性</strong>。</p> </li></ul> 
<h4><a id="2Language_Drift_111"></a>(2).Language Drift是什么？</h4> 
<h5><a id="1Countering_Language_Drift_with_Seeded_Iterated_Learning_112"></a>#1.<em>Countering Language Drift with Seeded Iterated Learning</em></h5> 
<p>  Yuchen Lu等在<em>Countering Language Drift with Seeded Iterated Learning</em>中认为:</p> 
<blockquote> 
 <p><em>They slowly lose syntactic and semantic properties of language as they only focus on solving the task.<br> 他们逐渐失去语言的句法和语义属性，而仅仅关注解决任务。</em></p> 
</blockquote> 
<p>  也就是说，模型在完成任务的过程中，仅仅为了<strong>完成任务</strong>，丢失了我们希望它使用的自然语言属性，这样就出现了语言漂移的问题。</p> 
<h5><a id="2Countering_Language_Drift_via_Visual_Grounding_119"></a>#2.<em>Countering Language Drift via Visual Grounding</em></h5> 
<p>  Jason Lee等则在Countering Language Drift via Visual Grounding中提出</p> 
<blockquote> 
 <p><em>When a nonlinguistic reward is used in a goal-based task, e.g. some scalar success metric, the communication protocol may easily and radically diverge from natural language.<br> 当在基于目标的任务中使用非语言奖励时，例如一些用于度量成功的指标，通信协议可能很容易从根本上偏离自然语言。</em></p> 
</blockquote> 
<p>  这里的通信协议指的是Multi-Agent多智体的通信协议，大概也就是指对于这样一个<strong>多智体在语言方面的输入和输出时的协议</strong>。</p> 
<p>  这一段话其实比上面那个要更好理解一点，也就是说，我们使用的Loss函数<strong>总是一个数学表达式，并没有完全使用我们对于某个目标达成的评估方式</strong>。</p> 
<p>  举个例子：你在教小朋友说话的时候，ta说：“我苹果想吃”，你知道这不对，你纠正ta说：“我想吃苹果”，这就是在依靠语言的方式来评判语言本身是否正确。</p> 
<p>  但假设我今天有一个<strong>不那么智能的程序</strong>，它接收到了<strong>我</strong>、<strong>苹果</strong>、<strong>想吃</strong>三个词之后，认为理解了你说的话，没有去纠正，就认为你是对的了，这就麻烦了，<strong>它的评判标准没有完全考虑到语法本身，如果长期保持这样一种方式进行训练，就可能导致小朋友说的话变成一种我们不太能听懂的语言了。</strong></p> 
<p>  Language Drift大概也就是这样的问题了，我们在训练的过程当中，可能会因为<strong>评估方式的差异</strong>，导致这个模型最终在语言方面产生一种完全不属于自然语言范畴的语言，这样虽然它解决了自己的问题，但<strong>不符合我们的要求</strong>。</p> 
<p>  这里提到Language Drift在我看来可能有两重意思，第一重是论文团队可能希望借此来描述扩散模型的<strong>遗忘问题</strong>，也就是失去多样性的过程。</p> 
<p>  第二重是换个思路，Language Drift本身在语言学中的含义大概是：<strong>语言中的词、句或者用法等在时间推演过程中，由于受到社会文化、经济情况等各种原因的影响下，发生了意义变化的现象</strong>。</p> 
<p>  我们可以用微信的表情来举个例子：微信里有一个<strong>微笑</strong>的表情，最早我们也是照着微笑这个意思去发的，但是后来年轻人觉得这个表情很奇怪，虽然是在笑，但是<strong>眼珠向下翻，漏出很多白眼，而且眼睛也没有什么太大的变化</strong>，给人一种强行微笑的感觉，所以现在我们用这个表情来表示<strong>我对你说得对不感兴趣</strong>之类的意思，这样一来，我想你大概就明白语言漂移是什么了吧？</p> 
<p>  那么提到Language Drift，可能是说，我们在通过DreamBooth微调模型本身，把这个新的物体<strong>绑定</strong>到某个稀有词这个过程，本身也是属于<strong>语言漂移</strong>的过程，当然，这是我自己的一点理解，原文中的意思应该更加接近我说的上一种情况。</p> 
<h4><a id="3PPL_142"></a>(3).所以，我们选择PPL</h4> 
<p>  DreamBooth为解决以上问题，对Diffusion模型原有的Loss函数中加入了一个可调节的<strong>Prior Preservation Loss(PPL)</strong>，Loss函数变为以下形式：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           L 
          
         
           = 
          
          
          
            E 
           
           
           
             x 
            
           
             , 
            
           
             c 
            
           
             , 
            
           
             ϵ 
            
           
             , 
            
            
            
              ϵ 
             
            
              ′ 
             
            
           
          
         
           [ 
          
          
          
            w 
           
          
            t 
           
          
         
           ∣ 
          
         
           ∣ 
          
          
           
           
             x 
            
           
             ^ 
            
           
          
            θ 
           
          
         
           ( 
          
          
          
            α 
           
          
            t 
           
          
         
           x 
          
         
           + 
          
          
          
            σ 
           
          
            t 
           
          
         
           ϵ 
          
         
           , 
          
         
           c 
          
         
           ) 
          
         
           − 
          
         
           x 
          
         
           ∣ 
          
          
          
            ∣ 
           
          
            2 
           
          
            2 
           
          
         
           + 
          
         
           λ 
          
          
          
            w 
           
           
           
             t 
            
           
             ′ 
            
           
          
         
           ∣ 
          
         
           ∣ 
          
          
           
           
             x 
            
           
             ^ 
            
           
          
            θ 
           
          
         
           ( 
          
          
          
            α 
           
           
           
             t 
            
           
             ′ 
            
           
          
          
          
            x 
           
           
           
             p 
            
           
             r 
            
           
          
         
           + 
          
          
          
            σ 
           
           
           
             t 
            
           
             ′ 
            
           
          
          
          
            ϵ 
           
          
            ′ 
           
          
         
           , 
          
          
          
            c 
           
           
           
             p 
            
           
             r 
            
           
          
         
           ) 
          
         
           − 
          
          
          
            x 
           
           
           
             p 
            
           
             r 
            
           
          
         
           ∣ 
          
          
          
            ∣ 
           
          
            2 
           
          
            2 
           
          
         
           ] 
          
         
        
       
         \large \mathcal{L} = \mathbb{E}_{\bold{x},\bold{c},\bold{\epsilon},\bold{\epsilon'}}[w_t||\hat{\bold{x}}_\theta(\alpha_t\bold{x}+\sigma_t\bold{\epsilon},\bold{c})-\bold{x}||^2_2+\lambda w_{t'}||\hat{\bold{x}}_\theta(\alpha_{t'}\bold{x_{pr}}+\sigma_{t'}\bold{\epsilon'},\bold{c_{pr}})-\bold{x_{pr}}||^2_2] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.82em;"></span><span class="mord mathcal sizing reset-size6 size7">L</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2356em; vertical-align: -0.3356em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathbb">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3184em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span><span class="mpunct mtight">,</span><span class="mord mathbf mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">ϵ</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">ϵ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7027em;"><span class="" style="top: -2.886em; margin-right: 0.0625em;"><span class="pstrut" style="height: 2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mathbf mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796em;"><span class=""></span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">[</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2601em;"><span class="" style="top: -2.65em; margin-left: -0.0269em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord sizing reset-size6 size7">∣∣</span><span class="mord sizing reset-size6 size7"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7079em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord mathbf">x</span></span><span class="" style="top: -3.2134em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="left: -0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.313em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2601em;"><span class="" style="top: -2.65em; margin-left: -0.0037em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathbf sizing reset-size6 size7">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.2em; vertical-align: -0.3em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2601em;"><span class="" style="top: -2.65em; margin-left: -0.0359em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal sizing reset-size6 size7">ϵ</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathbf sizing reset-size6 size7">c</span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin sizing reset-size6 size7">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.3112em; vertical-align: -0.3em;"></span><span class="mord mathbf sizing reset-size6 size7">x</span><span class="mord sizing reset-size6 size7">∣</span><span class="mord sizing reset-size6 size7"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8426em;"><span class="" style="top: -2.553em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.213em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.2356em; vertical-align: -0.3356em;"></span><span class="mord mathnormal sizing reset-size6 size7">λ</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3184em;"><span class="" style="top: -2.65em; margin-left: -0.0269em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7027em;"><span class="" style="top: -2.886em; margin-right: 0.0625em;"><span class="pstrut" style="height: 2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord sizing reset-size6 size7">∣∣</span><span class="mord sizing reset-size6 size7"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7079em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord mathbf">x</span></span><span class="" style="top: -3.2134em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="left: -0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.313em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen sizing reset-size6 size7">(</span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3184em;"><span class="" style="top: -2.65em; margin-left: -0.0037em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7027em;"><span class="" style="top: -2.886em; margin-right: 0.0625em;"><span class="pstrut" style="height: 2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1463em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathbf mtight">pr</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin sizing reset-size6 size7">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.2756em; vertical-align: -0.3356em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3184em;"><span class="" style="top: -2.65em; margin-left: -0.0359em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7027em;"><span class="" style="top: -2.886em; margin-right: 0.0625em;"><span class="pstrut" style="height: 2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7834em;"><span class="" style="top: -3.213em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathbf mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct sizing reset-size6 size7">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathbf">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1463em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathbf mtight">pr</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796em;"><span class=""></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin sizing reset-size6 size7">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.3467em; vertical-align: -0.3356em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1463em;"><span class="" style="top: -2.65em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathbf mtight">pr</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2796em;"><span class=""></span></span></span></span></span></span><span class="mord sizing reset-size6 size7">∣</span><span class="mord sizing reset-size6 size7"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8426em;"><span class="" style="top: -2.553em; margin-left: 0em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.213em; margin-right: 0.0417em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mclose sizing reset-size6 size7">]</span></span></span></span></span></span>  其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           x 
          
         
           ^ 
          
         
        
          θ 
         
        
       
      
        \hat{\bold{x}}_\theta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8579em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7079em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathbf">x</span></span><span class="" style="top: -3.0134em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为模型，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
         
         
           p 
          
         
           r 
          
         
        
       
         = 
        
        
         
         
           x 
          
         
           ^ 
          
         
        
          θ 
         
        
       
         ( 
        
        
         
         
           z 
          
          
          
            t 
           
          
            1 
           
          
         
        
          , 
         
         
         
           c 
          
          
          
            p 
           
          
            r 
           
          
         
        
       
         ) 
        
       
      
        \bold{x}_{pr}=\hat{\bold{x}}_\theta({z_{t_1},\bold{c}_{pr}}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7305em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7079em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathbf">x</span></span><span class="" style="top: -3.0134em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathbf">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>为<strong>预训练模型根据包含标识符的提示词生成的向量</strong>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          z 
         
         
         
           t 
          
         
           1 
          
         
        
       
         ∼ 
        
       
         N 
        
       
         ( 
        
       
         0 
        
       
         , 
        
       
         I 
        
       
         ) 
        
       
      
        z_{t_1}\sim \bold{N}(0,I) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6807em; vertical-align: -0.2501em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2501em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathbf">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mclose">)</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          c 
         
         
         
           p 
          
         
           r 
          
         
        
       
      
        \bold{c}_{pr} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7305em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathbf">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是通过Text-Encoder得到的<strong>包含标识符的文本条件向量</strong>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         λ 
        
       
      
        \lambda 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">λ</span></span></span></span></span>是用于控制<strong>微调部分的权重</strong>。</p> 
<p>  其实这个Loss函数相较于一般的扩散模型只是加了后面这一部分，但是能够很好地保障我们<strong>在训练的时候可以保留住扩散模型的先验知识</strong>。</p> 
<p>  不过从这个新的Loss函数我们其实也很容易看出：<strong>DreamBooth真的是对扩散模型整体进行调整</strong>，其意图在于将需要模型“记住”的主体<strong>嵌入到扩散模型</strong>中，从而以最大化地保证原有主体的<strong>保真度</strong>，而由此也会带来<strong>更大的资源（时间、显存等）消耗</strong>。</p> 
<h4><a id="4_152"></a>(4).这里说的过拟合又是什么？</h4> 
<p>  等一下，在这里我们说的过拟合到底是什么？<strong>是模型对小样本学习程度过高导致模型只能在验证集上发挥比较好的效果吗？</strong> 不对吧？我们希望微调之后的模型能够很好地记住输入物体的真实样貌，好像，就是希望它<strong>过拟合</strong>啊！</p> 
<p>  这里的过拟合实际上是说：<strong>我们希望模型记住物体，但不希望只能记住这个物体的几个状态</strong>，例如输入的狗狗只有趴着一个姿势，如果这样过拟合，可能到最后输出的图片中狗狗的姿势就<strong>全部都是趴着的了</strong>，这样的过拟合是我们不希望出现的。</p> 
<h3><a id="7_157"></a>7.实验</h3> 
<p>  核心讲完了，接下来就来看看DreamBooth的实验吧！</p> 
<h4><a id="1_159"></a>(1).数据集</h4> 
<p>  Google Research在DreamBooth仓库中一行代码都没有留下，不过把论文中训练模型用的数据集都放在里面了：https://github.com/google/dreambooth</p> 
<h4><a id="2_162"></a>(2).训练消耗</h4> 
<ul><li><strong>训练参数</strong>：训练集采用3~5张图片，在Imagen下设置学习率为1e-5，Stable Diffusion下设置学习率为5e-6，均训练1000轮</li><li><strong>结果</strong>：Imagen上采取<strong>单张TPUv4训练，耗时5分钟</strong>；Stable Diffusion上<strong>采取单张A100训练，耗时5分钟</strong></li></ul> 
<p>  我靠，真要有这效果，那DreamBooth真是神了，时间短而且效果好，真的这么理想吗？我们等会儿再说。</p> 
<h4><a id="3_168"></a>(3).消融实验</h4> 
<p>  有的时候我们不能直接通过模型变化理解模型变好的原因，所以可以通过<strong>消融实验</strong>，去除这些变化因素，再与包含相应变量的模型的效果进行对比，从而验证变量在模型当中的效果。</p> 
<p>  DreamBooth尝试了两个方向的消融实验：<strong>Prior Preservation Loss</strong>和<strong>Class-Prior</strong>，第一个就是验证PPL的影响，第二个则是<strong>验证类表名称正确与否</strong>对于生成图片的影响。</p> 
<h4><a id="4Prior_Preservation_Loss_Ablation_172"></a>(4).Prior Preservation Loss Ablation</h4> 
<h5><a id="1_173"></a>#1.先看看图</h5> 
<p><img src="https://images2.imgbox.com/7f/31/x6J5I7IF_o.png" alt="在这里插入图片描述"></p> 
<ul><li>实验中输入的图片特地采用了<strong>同一姿势</strong>的狗狗的照片进行训练。</li><li>结果比较明显，在<strong>没有PPL</strong>的情况下，生成的几张图片虽然保真度较好，但是狗狗的姿势<strong>都是趴着的</strong>。</li><li>而有PPL的组中就能在保真的情况下<strong>生成不同的姿势</strong>。</li></ul> 
<p>  而在没有PPL的情况下的DreamBooth微调模型，就出现了我们前面说的，不希望模型出现的过拟合现象——<strong>毕竟我们拍照片也不可能总是只有一个姿势对吧？</strong></p> 
<h5><a id="2_182"></a>#2.再看看数据</h5> 
<p><img src="https://images2.imgbox.com/75/e8/ZuSDzRqo_o.png" alt="在这里插入图片描述"></p> 
<p>  很明显，有PPL的DreamBooth微调后的Imagen模型<strong>在PRES，DIV和CLIP-T上表现都要比没有PPL的模型更好</strong>，不过这个<strong>DINO</strong>和<strong>CLIP-I</strong>是怎么回事？怎么还<strong>没有另一组好</strong>呢？</p> 
<p>  事实上。DINO和CLIP-I指标都是用于<strong>衡量生成图像与真实图像之间平均相似性的指标</strong>。它反映了生成图像在<strong>视觉特征上与真实图像的接近程度</strong>，但不一定代表了生成图像的质量或多样性，因此具备PPL的DreamBooth在这些指标上并不占优势，也好理解，毕竟在这里我们希望具备一定的多样性，而DINO和CLIP-I更希望保证它的不变性。</p> 
<h4><a id="5ClassPrior_Ablation_189"></a>(5).Class-Prior Ablation</h4> 
<p>  Class-Prior在这里更多是针对三种情况进行评估：<strong>正确使用类别词汇，不适用类别词汇以及错误使用类别词汇</strong>，我们直接看数据：<br> <img src="https://images2.imgbox.com/57/90/x3Ro2KqF_o.png" alt="在这里插入图片描述"></p> 
<p>  我们仍然用DINO和CLIP-I进行评估，结果很直接：正确的类别标识福的效果要<strong>远远好于使用错误的或不适用对应的类别标识词</strong>，这也说明：<strong>选择正确的类别标识词对于微调是相当重要的</strong>。</p> 
<h4><a id="6_195"></a>(6).效果</h4> 
<p>  接下来从数据上看看DreamBooth和Textual Inversion的对比：<br> <img src="https://images2.imgbox.com/00/1d/30ufbfSw_o.png" alt="在这里插入图片描述"></p> 
<p>  无论是在Imagen还是在Stable Diffusion上的微调效果都要远远好于Textual Inversion(遥遥领先)，然后看看<strong>物体保真度</strong>和<strong>文本提示保真度</strong>：<br> <img src="https://images2.imgbox.com/a6/f0/w9Zo9pHo_o.png" alt="在这里插入图片描述"></p> 
<p>  DreamBooth在<strong>物体保真度</strong>和<strong>文本提示保真度</strong>也是远远领先于Textual Inversion以及没有采取任何措施的模型。<br>   文本提示保真度指的就是生成图片和输入的提示词之间的一致性。</p> 
<h3><a id="8_205"></a>8.自行训练</h3> 
<p>  在这里我们就采取Diffusers库提供的一系列DreamBooth训练脚本对Stable Diffusion模型进行微调训练。</p> 
<h4><a id="1DiffusersDreamBooth_208"></a>(1).利用Diffusers库进行DreamBooth训练</h4> 
<ul><li><strong>组合</strong>：Stable Diffusion XL + LoRA + DreamBooth</li><li><strong>训练参数</strong>：学习率1e-5，最大训练次数5000</li><li><strong>资源消耗</strong>：我也用一张A100，大约占用25GB显存，并且需要<strong>3个小时才能完成训练</strong></li></ul> 
<p>  这个资源消耗，看起来完全达不到论文当中的要求啊！可能Google Research他们团队的论文确实做到了吧，可惜他们没有公布出来。</p> 
<p>  这里我们用了Stable Diffusion XL + LoRA来优化微调的结果，在采取Stable Diffusion v1.4的原始模型直接微调的情况下，<strong>1000步的微调需要接近8个小时才能完成训练</strong>。</p> 
<p>  这里就不放图了，在Stable Diffusion XL + LoRA的组合下使用DreamBooth微调的结果相对还比较好，<strong>但如果换成原始模型不加其他优化方法微调，DreamBooth微调出来的模型绘制对应物体的能力是非常差的</strong>，这也不太能达到DreamBooth论文中提到的效果。</p> 
<h3><a id="_219"></a>总结</h3> 
<p>  Google Research提出的DreamBooth成功将我们对于扩散模型的微调带到了一个新的高度，它的效果的确是不错的，虽然我们可能在自己使用的时候和论文提供的效果有所差距，但在经过一些调整之后，效果还是能基本达到预期的。</p> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Lu Y, Singhal S, Strub F, et al. Countering language drift with seeded iterated learning[C]//International Conference on Machine Learning. PMLR, 2020: 6437-6447. <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn2" class="footnote-item"><p>Lee J, Cho K, Kiela D. Countering language drift via visual grounding[J]. arXiv preprint arXiv:1909.04499, 2019.<br> <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a></p> </li></ol> 
</section>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22c74eafe1e62f4b3b4236df2b737d02/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一文搞懂域泛化、域适应、few-shot、zero-shot、open-world、open-vocabulary</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d753ab154e0e205db8d8d99e18aecb5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【SpringBoot】7 种实现 HTTP 调用的方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>