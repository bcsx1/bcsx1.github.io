<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES 8.x 向量检索性能测试 &amp; 把向量检索性能提升100倍！ - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ES 8.x 向量检索性能测试 &amp; 把向量检索性能提升100倍！" />
<meta property="og:description" content="向量检索不仅在的跨模态检索场景中应用广泛，随着chat gpt的火热，es的向量检索，在Ai领域发挥着越来越大的作用。
本文，主要测试es的向量检索性能。我从8.x就开始关注ES的向量检索了。当前ES已经发布到 8.10 版本。以下是官方文档的链接：
https://www.elastic.co/guide/en/elasticsearch/reference/current/release-highlights.html
本文，在测试的时候使用的是8.3版本（因为测试的时候只发布到这里 ）。
在本文中，妥妥滴都是干货，因为不仅有性能测试，还有搜索性能优化。这里预告以下，在千万规模数据中做的测试，将检索性能提升了将近100倍。在本文中可以看看性能是如何被优化的。
一、背景 测试ES - KNN向量检索性能、写入性能、准确度、资源占用情况。针对该需求，搭建一个8.3.0版本的ES节点，使用ES8.3.0版本的java Client高级API来调用KNN搜索。
测试资源介绍 机器情况
ES情况
插件
数据规模
数据情况
单台机器
48核心
64G内存
磁盘为HDD盘（也测了SSD盘）
单个节点
单个索引
单个分片
不带副本
优化后的段的个数为1
ES版本 8.3.0
JVM31G
elastiknn
34W（340507）1000W 数据结构（索引结构和配置）
结构：三个字段，一个向量字段存放512维度的向量数据。一个路径字段，存放图片路径，一个文档id
二、测试结果 写入性能 批量写数据，使用es bulk提交数据，数据刷新间隔时间30s（近实时）。
数据量
总耗时
平均每张耗时
340507
170s
0.5ms
写入数34万，耗时170s。
最佳查询性能 最终的性能如下表,千万级别的检索可以在毫秒级别。经历了两轮优化。
数据规模
检索 top-N
平均耗时
最长耗时
34w
（512维度）
检索 top-1
[3] ms
[110] ms
检索 top-10
[6] ms
[150] ms
检索 top-100" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/90225355a10efc237130d2d2c64d3485/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T23:36:42+08:00" />
<meta property="article:modified_time" content="2023-10-24T23:36:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES 8.x 向量检索性能测试 &amp; 把向量检索性能提升100倍！</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p style="text-align:left;">  向量检索不仅在的跨模态检索场景中应用广泛，随着chat gpt的火热，es的向量检索，在Ai领域发挥着越来越大的作用。</p> 
 <p style="text-align:left;">  本文，主要测试es的向量检索性能。我从8.x就开始关注ES的向量检索了。当前ES已经发布到 8.10 版本。以下是官方文档的链接：</p> 
 <p style="text-align:left;">   https://www.elastic.co/guide/en/elasticsearch/reference/current/release-highlights.html</p> 
 <p style="text-align:left;">  本文，在测试的时候使用的是8.3版本（因为测试的时候只发布到这里 <img alt="" height="64" src="https://images2.imgbox.com/1e/85/WVXGOxUG_o.jpg" width="64">）。</p> 
 <p style="text-align:left;">  在本文中，妥妥滴都是干货，因为不仅有性能测试，还有搜索性能优化。这里预告以下，在千万规模数据中做的测试，将检索性能提升了将近100倍。在本文中可以看看性能是如何被优化的。</p> 
 <p style="text-align:left;"></p> 
</blockquote> 
<h2 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>一、背景</strong></span></strong></strong></span></h2> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">测试ES - KNN向量检索性能、写入性能、准确度、资源占用情况。针对该需求，搭建一个8.3.0版本的ES节点，使用ES8.3.0版本的java Client高级API来调用KNN搜索。</span></span></p> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>测试资源介绍</strong></span></strong></strong></span></h3> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:69.75pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">机器情况</span></strong></span></p> </td><td style="width:66.75pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">ES情况</span></strong></span></p> </td><td style="width:90pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">插件</span></strong></span></p> </td><td style="width:90pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据规模</span></strong></span></p> </td><td style="width:90pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据情况</span></strong></span></p> </td></tr><tr><td style="width:69.75pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">单台机器</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">48核心</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">64G内存</span><br><span style="color:#333333;">磁盘为HDD盘（也测了SSD盘）</span></span></p> <p style="text-align:left;"></p> </td><td style="width:66.75pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">单个节点</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">单个索引</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">单个分片</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">不带副本</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">优化后的段的个数为1</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">ES版本 8.3.0</span><br><span style="color:#333333;">JVM31G</span></span></p> </td><td style="width:90pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">elastiknn</span></span></p> <p style="text-align:left;"><span style="color:#333333;"> </span></p> </td><td style="width:90pt;"> 
    <ol><li style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">34W（340507）</span></span></li><li style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">1000W</span></span></li></ol></td><td style="width:90pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">数据结构（索引结构和配置）</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">结构：三个字段，一个向量字段存放</span><span style="background-color:#ffff00;"><span style="color:#333333;">512维度</span></span><span style="color:#333333;">的向量数据。一个路径字段，存放图片路径，一个文档id</span></span></p> <p style="text-align:left;"></p> </td></tr></tbody></table> 
<p style="text-align:left;"></p> 
<h2 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>二、测试结果</strong></span></strong></strong></span></h2> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>写入性能</strong></span></strong></strong></span></h3> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">批量写数据，使用es bulk提交数据，数据刷新间隔时间30s（近实时）。</span></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">数据量</span></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">总耗时</span></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">平均每张耗时</span></span></p> </td></tr><tr><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">340507</span></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">170s</span></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">0.5ms</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">写入数34万，耗时170s。</span></span></p> 
<p style="text-align:left;"><img alt="" height="171" src="https://images2.imgbox.com/b0/6c/PNbwLwqB_o.png" width="756"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>最佳查询性能</strong></span></strong></strong></span></h3> 
<p style="text-align:left;"><span style="color:#333333;"> <strong><span style="color:#333333;">最终的性能如下表,千万级别的检索可以在毫秒级别。经历了两轮优化。</span></strong></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据规模</span></strong></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">检索 top-N</span></strong></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">平均耗时</span></strong></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">最长耗时</span></strong></span></p> </td></tr><tr><td rowspan="3" style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">34w</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">（512维度）</span></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-1</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">3</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[110] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[6] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[150] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-100</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[26] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[810] ms</span></span></p> </td></tr><tr><td rowspan="3" style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">1000W</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">（512维度）</span></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-1</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[14] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[390] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[22] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[220] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-100</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[42] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[73] ms</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">~ps 最长耗时是非常重要的指标，要重点关注。这很可能是用户在第一次点击搜索的时候出现的情况。短板效应。</span></span></p> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>检索优化过程 </strong></span></strong></strong></span></h3> 
<p style="text-align:left;"><span style="color:#333333;">  <strong><span style="color:#333333;">说明</span></strong><span style="color:#333333;">：使用ES原生KNN检索，尝试做了三轮优化。第一轮是对写入的数据，进行一次合并优化；第二轮使用使用开源的插件elastiknn进行优化。第三轮是将数据放在SSD磁盘的机器上。</span><strong><span style="color:#333333;">每轮提升两倍。整体性能提升近10倍</span></strong><span style="color:#333333;">。（测试结果会受到了Linux os cache的影响，磁盘上的数据从磁盘读取到os cache中 ）如果追求检索性能，应该增加内存，来达到将更多的数据放在缓存中去做检索的目的。</span></span></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">  ps~ 以下相同颜色做对比。第一轮对比，是forceMerge的优化。第二轮是插件优化。第三轮在千万数据集下做测试，接近生产需求，并且包含了三项优化一起做的场景。把三种优化，放在一起，带来更多的提升！</span></span></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">  其中forceMerge优化，只能对不再发生变化的数据做优化。比如昨天入库的数据不再新增和修改，则优化可以生效。但是不适用于实时入库的数据！</span></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据规模</span></strong></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">优化项</span></strong></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">检索 top-N</span></strong></span></p> </td><td style="width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">调用次数</span></strong></span></p> </td><td style="width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">总耗时</span></strong></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">平均耗时</span></strong></span></p> </td><td style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">最长耗时</span></strong></span></p> </td></tr><tr><td rowspan="5" style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">30W</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">不优化</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-2</span></span></p> </td><td style="background-color:#eafaf1;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#eafaf1;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[1148351] ms</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[50] ms</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">-</span></span></p> </td></tr><tr><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">force</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">Merge</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-2</span></span></p> </td><td style="background-color:#eafaf1;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#eafaf1;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[698089] ms</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[30] ms</span></span></p> </td><td style="background-color:#eafaf1;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">-</span></span></p> </td></tr><tr><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">不优化</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#ffdcc4;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#ffdcc4;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">1962618</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">86</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[5183] ms</span></span></p> </td></tr><tr><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">插件优化</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#ffdcc4;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#ffdcc4;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">795893</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">35</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[360]</span></span></p> </td></tr><tr><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">force</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">Merge</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#ffdcc4;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#ffdcc4;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[1385920] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[60] ms</span></span></p> </td><td style="background-color:#ffdcc4;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[2016] ms</span></span></p> </td></tr><tr><td rowspan="4" style="width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">1000W</span></span></p> <p style="text-align:left;"></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">不优化（HDD）</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#e5efff;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">-</span></span></p> </td><td style="background-color:#e5efff;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">-</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">10 - 20 s</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">20s</span></span></p> </td></tr><tr><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">SSD 优化</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#e5efff;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#e5efff;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[2781526] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[122] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">5s</span></span></p> </td></tr><tr><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">SSD + 插件 优化</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#e5efff;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#e5efff;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">1046376</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">46</span><span style="color:#333333;">] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">5s</span></span></p> </td></tr><tr><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">SSD + 插件 + merge优化</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="background-color:#e5efff;width:55pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="background-color:#e5efff;width:74.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[22] ms</span></span></p> </td><td style="background-color:#e5efff;width:64.65pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[220] ms</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"></p> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>使用elastiknn插件优化检索（只看插件优化)</strong></span></strong></strong></span></h3> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据合并</span></strong></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">检索 top-N</span></strong></span></p> </td><td style="width:63.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">调用次数</span></strong></span></p> </td><td style="width:87.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">总耗时</span></strong></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">平均耗时</span></strong></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">最长耗时</span></strong></span></p> </td></tr><tr><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">优化前</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:63.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="width:87.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">1161129</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">51</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[387]</span></span></p> </td></tr><tr><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">优化后</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:63.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="width:87.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">795893</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">35</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[360]</span></span></p> </td></tr><tr><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">优化后</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-100</span></span></p> </td><td style="width:63.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">22727</span></span></p> </td><td style="width:87.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">5776099</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">254</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:75.45pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">8759</span><span style="color:#333333;">]</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>华为云es + 自研插件 性能（</strong></span></strong><strong><span style="color:#00b050;"><strong>性能比原生好10倍左右</strong></span></strong><strong><span style="color:#1a1a1a;"><strong>）</strong></span></strong></strong></span></h3> 
<h4 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>测试数据集</strong></span></strong></strong></span></h4> 
<p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">DataSet1</span><span style="color:#000000;">：</span><span style="color:#000000;">S</span><span style="color:#000000;">IFT</span><span style="color:#000000;">开源数据集，维度</span><span style="color:#000000;">1</span><span style="color:#000000;">28</span><span style="color:#000000;">，</span><span style="color:#000000;">Base</span><span style="color:#000000;">数据集</span><span style="color:#000000;">1</span><span style="color:#000000;">00</span><span style="color:#000000;">万条</span></span></p> 
<p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">Data</span><span style="color:#000000;">Set2</span><span style="color:#000000;">：</span><span style="color:#000000;">SIFT10M</span><span style="color:#000000;">开源数据集，维度</span><span style="color:#000000;">1</span><span style="color:#000000;">28</span><span style="color:#000000;">，</span><span style="color:#000000;">Base</span><span style="color:#000000;">数据集</span><span style="color:#000000;">1</span><span style="color:#000000;">100</span><span style="color:#000000;">万条</span></span></p> 
<p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">DataSet3</span><span style="color:#000000;">：</span><span style="color:#000000;">GIST</span><span style="color:#000000;">开源数据集，维度</span><span style="color:#000000;">960</span><span style="color:#000000;">，</span><span style="color:#000000;">Base</span><span style="color:#000000;">数据集</span><span style="color:#000000;">100</span><span style="color:#000000;">万条</span></span></p> 
<p style="margin-left:0pt;text-align:left;"></p> 
<h4 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>检索性能</strong></span></strong></strong></span></h4> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">数据</span></strong></span></p> </td><td style="width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">索引类型</span></strong></span></p> </td><td colspan="3" style="vertical-align:top;width:111.3pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#000000;">查询</span></strong><strong><span style="color:#000000;">T</span></strong><strong><span style="color:#000000;">op1</span></strong></span></p> </td><td colspan="3" style="vertical-align:top;width:111.3pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#000000;">查询</span></strong><strong><span style="color:#000000;">T</span></strong><strong><span style="color:#000000;">op10</span></strong></span></p> </td><td colspan="3" style="vertical-align:top;width:111.3pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#000000;">查询</span></strong><strong><span style="color:#000000;">Top</span></strong><strong><span style="color:#000000;">100</span></strong></span></p> </td></tr><tr><td style="background-color:#f1f1f1;width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"></p> </td><td style="background-color:#f1f1f1;width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">Rec</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">RT</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">QPS</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">Rec</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">RT</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">QPS</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">Rec</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">RT</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">QPS</span></span></p> </td></tr><tr><td style="vertical-align:top;width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">SIFT</span></strong></span></p> </td><td style="vertical-align:top;width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">GRAPH</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.992</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">2.63</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">6200</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.998</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">2.66</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">6000</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.992</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">3.79</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">4200</span></span></p> </td></tr><tr><td style="background-color:#f1f1f1;width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">SIFT10M</span></strong></span></p> </td><td style="background-color:#f1f1f1;width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">G</span><span style="color:#000000;">RAPH</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.998</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">3.20</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">5</span><span style="color:#000000;">000</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.998</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">3.31</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">4</span><span style="color:#000000;">800</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.985</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">4.82</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">3</span><span style="color:#000000;">400</span></span></p> </td></tr><tr><td style="vertical-align:top;width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">GIST</span></strong></span></p> </td><td style="vertical-align:top;width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">GRAPH</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.971</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#ff0000;">1</span><span style="color:#ff0000;">0.0</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">1</span><span style="color:#000000;">500</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.963</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">1</span><span style="color:#000000;">2.0</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">1</span><span style="color:#000000;">350</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.911</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">2</span><span style="color:#000000;">0.1</span></span></p> </td><td style="vertical-align:top;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">6</span><span style="color:#000000;">00</span></span></p> </td></tr><tr><td style="background-color:#f1f1f1;width:55.75pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><strong><span style="color:#000000;">GIST</span></strong></span></p> </td><td style="background-color:#f1f1f1;width:65.95pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">GRAPH_PQ</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.954</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">4.06</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">4</span><span style="color:#000000;">000</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">0</span><span style="color:#000000;">.934</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">6.54</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">2</span><span style="color:#000000;">450</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">-</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">-</span></span></p> </td><td style="background-color:#f1f1f1;width:37.1pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#000000;">-</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">说明</span></strong><span style="color:#333333;">：</span></span></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">Rec表示Topk召回率，RT表示平均查询时延（毫秒），QPS表示查询吞吐量；</span></span></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">由于GIST的维度较高，通过使用GRAPH_PQ加速能够极大地提升查询性能，以损失精准度为代价，来提升速度</span></span></p> 
<h2 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>三、索引结构</strong></span></strong></strong></span></h2> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">以下索引，30万数据规模用一个分片即可。1000万数据规模，给3个分片。</span></span></p> 
<pre><code>
  "knn_image_index": {
    "aliases": {},
    "mappings": {
      "properties": {
        "my_image_vector": {
          "type": "dense_vector",
          "dims": 512,
          "index": true,
          "similarity": "l2_norm"
        },
        "pic": {
          "type": "keyword"
        },
        "pic_path": {
          "type": "keyword"
        }
      }
    },
    "settings": {
      "index": {
        "routing": {
          "allocation": {
            "include": {
              "_tier_preference": "data_content"
            }
          }
        },
        "refresh_interval": "30s",
        "number_of_shards": "1",
        "provided_name": "knn_image_index",
        "creation_date": "1681825402139",
        "number_of_replicas": "0",
        "uuid": "KjqLhlv2SMGxlwWIjgJCMw",
        "version": {
          "created": "8030099"
        }
      }
    }
  }
}</code></pre> 
<h2 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>四、资源使用情况</strong></span></strong></strong></span></h2> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>磁盘占用量</strong></span></strong></strong></span></h3> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">30W数据，占用1.7G磁盘空间。</span></span><img alt="" height="515" src="https://images2.imgbox.com/9c/c5/ASptrlgY_o.png" width="756"></p> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>内存占用量</strong></span></strong></strong></span></h3> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">内存使用量极少。</span></span></p> 
<p style="text-align:left;"><img alt="" height="254" src="https://images2.imgbox.com/49/cb/nSyhwCOE_o.png" width="756"></p> 
<p style="text-align:left;"></p> 
<p style="text-align:left;"></p> 
<h2 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>五、测试结论</strong></span></strong></strong></span></h2> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">  ES支持ANN检索、支持删除、支持修改、数据写入性能平均每条耗时5ms。数据存储不占用内存空间，都在磁盘上。1000W图片占用磁盘空间50GB。</span></span></p> 
<p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">  检索性能以下为最佳状态</span><span style="color:#333333;">。存储使用SSD盘、使用elastiknn插件做优化、对数据做合并，merge成一个segment。能够达到最好的性能如下表。</span></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">数据规模</span></strong></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">检索 top-N</span></strong></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">平均耗时</span></strong></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><strong><span style="color:#333333;">最长耗时</span></strong></span></p> </td></tr><tr><td rowspan="3" style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">34w</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">（512维度）</span></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-1</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[</span><span style="color:#333333;">3</span><span style="color:#333333;">] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[110] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[6] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[150] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-100</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[26] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[810] ms</span></span></p> </td></tr><tr><td rowspan="3" style="width:98.3pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">1000W</span></span></p> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">（512维度）</span></span></p> </td><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-1</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[14] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[390] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-10</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[22] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[220] ms</span></span></p> </td></tr><tr><td style="width:128.85pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">检索 top-100</span></span></p> </td><td style="width:103.25pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[42] ms</span></span></p> </td><td style="width:117.05pt;"> <p style="text-align:left;"><span style="color:#333333;"><span style="color:#333333;">[73] ms</span></span></p> </td></tr></tbody></table> 
<p style="text-align:left;"></p> 
<h3 style="text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>是否能够满足使用需求</strong></span></strong></strong></span></h3> 
<h2 style="margin-left:0pt;text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>六</strong></span></strong><strong><span style="color:#1a1a1a;"><strong>、插件调研、开源测试工具调研、向量算法</strong></span></strong></strong></span></h2> 
<h3 style="margin-left:0pt;text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>KNN - plugin</strong></span></strong></strong></span></h3> 
<table border="1" cellspacing="0" style="margin-left:1.1pt;"><tbody><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>插件</strong></span></strong></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>优点</strong></span></strong></span></p> </td><td style="width:65.4pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>缺点</strong></span></strong></span></p> </td><td style="width:88.2pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>git地址</strong></span></strong></span></p> </td><td style="width:62.4pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>活跃度</strong></span></strong></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">elastiknn</span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">1、性能提升一倍</span></span></p> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">2、社区持续活跃，一直跟着最新版本的ES版本去发布的插件</span></span></p> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">3、不用改官方的检索语法</span></span></p> </td><td style="width:65.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">暂未发现待调研</span></span></p> </td><td style="width:88.2pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://github.com/alexklibisz/elastiknn" title="GitHub - alexklibisz/elastiknn: Elasticsearch plugin for nearest neighbor search. Store vectors and run similarity search using exact and approximate algorithms.">GitHub - alexklibisz/elastiknn: Elasticsearch plugin for nearest neighbor search. Store vectors and run similarity search using exact and approximate algorithms.</a></span></span></p> </td><td style="width:62.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">最后一次更新一天前。持续活跃</span></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">k-NN</span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">相对elastiknn，该插件支持把底层生成hnsw一个结构加载进内存</span></span></p> </td><td style="width:65.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">基于内存构建</span></span></p> </td><td style="width:88.2pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://github.com/opendistro-for-elasticsearch/k-NN" title="GitHub - opendistro-for-elasticsearch/k-NN: ��� A machine learning plugin which supports an approximate k-NN search algorithm for Open Distro.">GitHub - opendistro-for-elasticsearch/k-NN: ��� A machine learning plugin which supports an approximate k-NN search algorithm for Open Distro.</a></span></span></p> </td><td style="width:62.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">最后一次更新时间在2021年</span></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">GSI's Elasticsearch K-NN Plugin</span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">据说是使用GPU加速的插件</span></span></p> </td><td style="width:65.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">未开源，找不到</span></span></p> </td><td style="width:88.2pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://www.gsitechnology.com/GSI-Elasticsearch-Plugin" rel="nofollow" title="GSI's Elasticsearch k-NN Plugin | GSI Technology">GSI's Elasticsearch k-NN Plugin | GSI Technology</a></span></span></p> </td><td style="width:62.4pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">-</span></span></p> </td></tr></tbody></table> 
<h3 style="margin-left:0pt;text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>开源向量性能测试工具</strong></span></strong></strong></span></h3> 
<table border="1" cellspacing="0" style="margin-left:1.1pt;"><tbody><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>项目</strong></span></strong></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>优点</strong></span></strong></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>缺点</strong></span></strong></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>git地址</strong></span></strong></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:center;"><span style="color:#333333;"><strong><span style="color:#333333;"><strong>活跃度</strong></span></strong></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">对N个向量检索数据库做性能测试</span></span></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://github.com/erikbern/ann-benchmarks" title="GitHub - erikbern/ann-benchmarks: Benchmarks of approximate nearest neighbor libraries in Python">GitHub - erikbern/ann-benchmarks: Benchmarks of approximate nearest neighbor libraries in Python</a></span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">最近两天</span></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">对十亿规模的向量数据做测试</span></span></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://github.com/harsha-simhadri/big-ann-benchmarks" title="GitHub - harsha-simhadri/big-ann-benchmarks: Framework for evaluating ANNS algorithms on billion scale datasets.">GitHub - harsha-simhadri/big-ann-benchmarks: Framework for evaluating ANNS algorithms on billion scale datasets.</a></span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">最近两天</span></span></p> </td></tr><tr><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">GSI's Elasticsearch K-NN Plugin</span></span></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="text-align:left;"></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;"><a href="https://github.com/jobergum/dense-vector-ranking-performance" title="GitHub - jobergum/dense-vector-ranking-performance: Performance evaluation of nearest neighbor search using Vespa, Elasticsearch and Open Distro for Elasticsearch K-NN">GitHub - jobergum/dense-vector-ranking-performance: Performance evaluation of nearest neighbor search using Vespa, Elasticsearch and Open Distro for Elasticsearch K-NN</a></span></span></p> </td><td style="width:72pt;"> <p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><span style="color:#333333;">两年前（21年）</span></span></p> </td></tr></tbody></table> 
<h3 style="margin-left:0pt;text-align:left;"><span style="color:#1a1a1a;"><strong><strong><span style="color:#1a1a1a;"><strong>向量检索相关算法</strong></span></strong></strong></span></h3> 
<p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><a href="https://yongyuan.name/blog/vector-ann-search.html" rel="nofollow" title="图像检索：向量索引 ">图像检索：向量索引 </a></span></p> 
<p style="margin-left:0pt;text-align:left;"><span style="color:#333333;"><a href="https://www.sofastack.tech/blog/antfin-zsearch-vector-search/" rel="nofollow" title="蚂蚁金服 ZSearch 在向量检索上的探索 · SOFAStack">蚂蚁金服 ZSearch 在向量检索上的探索 · SOFAStack</a></span></p> 
<p style="text-align:left;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/487f3953b47134210f9ce332b400f80a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">程序员读《孙子兵法》读书笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f93b82503008955ea2f5475a1bc5c2de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">几千亿级集群管理，近百个实用优化参数，涵盖集群、索引、客户端</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>