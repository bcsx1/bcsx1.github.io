<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 蓝牙低能耗(BLE) - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 蓝牙低能耗(BLE)" />
<meta property="og:description" content="本文翻译自：http://developer.android.com/guide/topics/connectivity/bluetooth-le.html
Android4.3（APILevel 18）引入了内建平台支持蓝牙低能耗的核心作用，提供给APP相应的API能够发现设备，查询服务，和提供读/写特性。与传统的蓝牙相比，蓝牙低能耗设计提供了明显地低电量消耗。它允许Android应用与对低能耗有要求的BLE设备进行通信，例如近距离传感器，心率监测设备，健康设备等等。
主要术语和概念 以下是BLE的关键术语和概念的总结：
l 通用属性配置（GATT）-------- GATT配置是一个通用的规范，用来发送和接收被称作“属性”的短片数据通过BLE连接。所有当前的低能耗应用配置都是基于GATT。
Ø 蓝牙技术联盟定义了许多低能耗设备的配置。一个配置是一个规范用来确定一个设备在特定的应用中如何运行。注意一个设备可以实现多个配置。例如，一个设备可以包含一个心率监测配置和电量监测配置。
l 属性协议（ATT）-------GATT建立在属性协议（ATT）基础上。这也可以被成为GATT/ATT。ATT可以在BLE设备上最佳运行。为此，它使用尽可能少的字节。每个属性通过一个全球唯一标识符（UUID）定义，UUID是一个标准的128位字符串ID用来唯一标识信息。通过ATT传送的属性被格式化为特征和服务。
l 特征----------特征包含一个单一的值和0-n个描述符描述特征的值。一个特征可以被认为是一种类型，类似于类。
l 描述符-------描述符被定义为属性用来描述特征的值。例如，一个描述符可能指定一个人类刻度的描述，一个特征值的可接受范围或者一个测量单元用来指定一个特征的值。
l 服务----------一个服务是一组特征的集合。例如，你可以有一个服务叫做“心率监测”包含例如“心率测量”的特征。你可以在bluetooth.org上找到一系列存在的GATT基础配置和服务。
角色与职责 以下是当一个Android设备与一个BLE设备交互时应用的角色和职责：
l 中央与外围。这适用于BLE连接本身。处于中心角色的设备扫描，查找广告，外围角色的设备制作广告。
l GATT服务器与GATT客户端。这取决于一旦两个设备建立连接之后，两个设备之间如何进行通信。
为了理解这个区别，假设你有一个Android手机和一个是BLE设备的活动跟踪器。手机支持中心角色；活动跟踪器支持外围角色（为了建立BLE连接，你需要其中一个设备仅支持外围不能够跟对方对话，而不是两台设备仅仅支持中心角色）。
一旦手机和活动跟踪器建立了连接，他们开始传送元数据给另一方。依赖于他们之间传输的数据类型，一个或者另一个会作为服务器。例如，如果活动跟踪器想要报告传感器数据给手机，那活动跟踪器可能会作为服务器。如果活动跟踪器想要接收手机端的更新，那么手机端将会作为服务端。
在这篇文档使用的例子中，这个Android应用（运行在Android设备上）是GATT客户端。这个应用从GATT服务端获取数据，该服务端是一个支持心率配置的心率监测设备。但是你能够选择设计你的Android应用扮演GATT服务端角色。查看BluetoothGattServer（http://developer.android.com/reference/android/bluetooth/BluetoothGattServer.html） 例子获取更多地信息。
BLE权限 为了在你的应用中使用蓝牙特性，你必须声明蓝牙的权限（http://developer.android.com/reference/android/Manifest.permission.html#BLUETOOTH）。你需要这些权限来执行任意的蓝牙通信，例如请求一个连接，接受一个连接，和传输数据。
如果你想要你的应用初始化设备发现或者操作蓝牙设置，你必须也声明BLUETOOTH_ADMIN（http://developer.android.com/reference/android/Manifest.permission.html#BLUETOOTH_ADMIN）权限。注意：如果你使用BLUETOOTH_ADMIN权限，那么你也必须声明BLUETOOTH权限。
在你应用的清单文件中声明蓝牙权限。例如：
&lt;uses-permission android:name=&#34;android.permission.BLUETOOTH&#34;/&gt;
&lt;uses-permission android:name=&#34;android.permission.BLUETOOTH_ADMIN&#34;/&gt;
如果你需要你的应用仅能运行在支持BLE的设备上，请在你的应用清单上包含以下权限：
&lt;uses-feature android:name=&#34;android.hardware.bluetooth_le&#34; android:required=&#34;true&#34;/&gt;
然而，如果你想要你的应用在不支持BLE的设备上可用，你仍然需要包含以上元素，但是设置required=”false”。然后在运行时通过使用Packagemanager.hasSystemFeature，你能够决定BLE是否可用。
// Use this check to determine whether BLE is supported on the device.Then
// you can selectively disableBLE-related features.
if (!getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)) {
Toast.makeText(this, R.string.ble_not_supported, Toast.LENGTH_SHORT).show();
finish();
}
建立BLE 在你的应用能够通过BLE通信之前，你需要确保在此设备上支持BLE，同时如果是这样，确保BLE是启用的。注意仅当如果&lt;uses-feature…/&gt;设置为false时这项检查是必要的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/bad7b42697c7f369ea47189b1bc4a84b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-10-23T10:34:12+08:00" />
<meta property="article:modified_time" content="2015-10-23T10:34:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 蓝牙低能耗(BLE)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>本文翻译自：http://developer.android.com/guide/topics/connectivity/bluetooth-le.html<br> </p> 
<p>Android4.3（APILevel 18）引入了内建平台支持蓝牙低能耗的核心作用，提供给APP相应的API能够发现设备，查询服务，和提供读/写特性。与传统的蓝牙相比，蓝牙低能耗设计提供了明显地低电量消耗。它允许Android应用与对低能耗有要求的BLE设备进行通信，例如近距离传感器，心率监测设备，健康设备等等。</p> 
<h2>主要术语和概念</h2> 
<p>以下是BLE的关键术语和概念的总结：</p> 
<p>l  通用属性配置（GATT）-------- GATT配置是一个通用的规范，用来发送和接收被称作“属性”的短片数据通过BLE连接。所有当前的低能耗应用配置都是基于GATT。</p> 
<p>Ø 蓝牙技术联盟定义了许多低能耗设备的配置。一个配置是一个规范用来确定一个设备在特定的应用中如何运行。注意一个设备可以实现多个配置。例如，一个设备可以包含一个心率监测配置和电量监测配置。</p> 
<p>l  属性协议（ATT）-------GATT建立在属性协议（ATT）基础上。这也可以被成为GATT/ATT。ATT可以在BLE设备上最佳运行。为此，它使用尽可能少的字节。每个属性通过一个全球唯一标识符（UUID）定义，UUID是一个标准的128位字符串ID用来唯一标识信息。通过ATT传送的属性被格式化为特征和服务。</p> 
<p>l  特征----------特征包含一个单一的值和0-n个描述符描述特征的值。一个特征可以被认为是一种类型，类似于类。</p> 
<p>l  描述符-------描述符被定义为属性用来描述特征的值。例如，一个描述符可能指定一个人类刻度的描述，一个特征值的可接受范围或者一个测量单元用来指定一个特征的值。</p> 
<p>l  服务----------一个服务是一组特征的集合。例如，你可以有一个服务叫做“心率监测”包含例如“心率测量”的特征。你可以在<a target="_blank" href="https://www.bluetooth.org/en-us/specification/adopted-specifications" rel="nofollow noopener noreferrer"><span style="color:windowtext">bluetooth.org</span></a>上找到一系列存在的GATT基础配置和服务。</p> 
<h2>角色与职责</h2> 
<p>以下是当一个Android设备与一个BLE设备交互时应用的角色和职责：</p> 
<p>l  中央与外围。这适用于BLE连接本身。处于中心角色的设备扫描，查找广告，外围角色的设备制作广告。</p> 
<p>l  GATT服务器与GATT客户端。这取决于一旦两个设备建立连接之后，两个设备之间如何进行通信。</p> 
<p> </p> 
<p>为了理解这个区别，假设你有一个Android手机和一个是BLE设备的活动跟踪器。手机支持中心角色；活动跟踪器支持外围角色（为了建立BLE连接，你需要其中一个设备仅支持外围不能够跟对方对话，而不是两台设备仅仅支持中心角色）。</p> 
<p>一旦手机和活动跟踪器建立了连接，他们开始传送元数据给另一方。依赖于他们之间传输的数据类型，一个或者另一个会作为服务器。例如，如果活动跟踪器想要报告传感器数据给手机，那活动跟踪器可能会作为服务器。如果活动跟踪器想要接收手机端的更新，那么手机端将会作为服务端。</p> 
<p>在这篇文档使用的例子中，这个Android应用（运行在Android设备上）是GATT客户端。这个应用从GATT服务端获取数据，该服务端是一个支持心率配置的心率监测设备。但是你能够选择设计你的Android应用扮演GATT服务端角色。查看<a target="_blank" href="http://developer.android.com/reference/android/bluetooth/BluetoothGattServer.html" rel="nofollow noopener noreferrer"><span style="color:windowtext">BluetoothGattServer</span></a>（http://developer.android.com/reference/android/bluetooth/BluetoothGattServer.html） 例子获取更多地信息。</p> 
<h2>BLE权限</h2> 
<p>为了在你的应用中使用蓝牙特性，你必须声明蓝牙的权限（http://developer.android.com/reference/android/Manifest.permission.html#BLUETOOTH）。你需要这些权限来执行任意的蓝牙通信，例如请求一个连接，接受一个连接，和传输数据。</p> 
<p>如果你想要你的应用初始化设备发现或者操作蓝牙设置，你必须也声明BLUETOOTH_ADMIN（http://developer.android.com/reference/android/Manifest.permission.html#BLUETOOTH_ADMIN）权限。注意：如果你使用BLUETOOTH_ADMIN权限，那么你也必须声明BLUETOOTH权限。</p> 
<p>在你应用的清单文件中声明蓝牙权限。例如：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">&lt;uses-permission</span> <span style="color:#882288"> android:name</span><span style="color:#666600">=</span><span style="color:#880000">"android.permission.BLUETOOTH"</span><span style="color:#000088">/&gt;</span><br> <span style="color:#000088">&lt;uses-permission</span> <span style="color:#882288">android:name</span><span style="color:#666600">=</span><span style="color:#880000">"android.permission.BLUETOOTH_ADMIN"</span><span style="color:#000088">/&gt;</span></p> 
</div> 
<p>如果你需要你的应用仅能运行在支持BLE的设备上，请在你的应用清单上包含以下权限：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">&lt;uses-feature</span> <span style="color:#882288"> android:name</span><span style="color:#666600">=</span><span style="color:#880000">"android.hardware.bluetooth_le"</span> <span style="color:#882288">android:required</span><span style="color:#666600">=</span><span style="color:#880000">"true"</span><span style="color:#000088">/&gt;</span></p> 
</div> 
<p>然而，如果你想要你的应用在不支持BLE的设备上可用，你仍然需要包含以上元素，但是设置required=”false”。然后在运行时通过使用Packagemanager.hasSystemFeature，你能够决定BLE是否可用。</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006600">// Use this check to determine whether BLE is supported on the device.Then</span><br> <span style="color:#006600">// you can selectively disableBLE-related features.</span><br> <span style="color:#000088">if</span> <span style="color:#666600">(!</span>getPackageManager<span style="color:#666600">().</span>hasSystemFeature<span style="color:#666600">(</span><span style="color:#660066">PackageManager</span><span style="color:#666600">.</span>FEATURE_BLUETOOTH_LE<span style="color:#666600">))</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#660066">Toast</span><span style="color:#666600">.</span>makeText<span style="color:#666600">(</span><span style="color:#000088">this</span><span style="color:#666600">,</span> R<span style="color:#666600">.</span><span style="color:#000088">string</span><span style="color:#666600">.</span>ble_not_supported<span style="color:#666600">,</span> <span style="color:#660066">Toast</span><span style="color:#666600">.</span>LENGTH_SHORT<span style="color:#666600">).</span>show<span style="color:#666600">();</span><br>     finish<span style="color:#666600">();</span><br> <span style="color:#666600">}</span></p> 
</div> 
<h2>建立BLE</h2> 
<p>在你的应用能够通过BLE通信之前，你需要确保在此设备上支持BLE，同时如果是这样，确保BLE是启用的。注意仅当如果&lt;uses-feature…/&gt;设置为false时这项检查是必要的。</p> 
<p>如果不支持BLE，然后你应当优雅的禁用任何BLE特性。如果支持BLE，但是被禁用，然后你能够请求用户在不离开你应用的情况下启用蓝牙。使用蓝牙适配器完成建立需要两个步骤。</p> 
<p>1.       获取蓝牙适配器（BluetoothAdapter）</p> 
<p>对于任何和全部的蓝牙活动，蓝牙适配器是必要的。蓝牙适配器代表设备自身的蓝牙适配器（蓝牙无线电）。在整个系统中有一个蓝牙适配器，你的应用可以通过使用它与系统进行交互。下面这个代码片段展示如何获取适配器。注意这个方法使用getSystemService返回BluetoothManager的一个实例，然后该实例用于获取适配器。Android4.3（APILevel 18）引入BluetoothManager:</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006600">// Initializes Bluetooth adapter.</span><br> <span style="color:#000088">final</span> <span style="color:#660066">BluetoothManager</span> bluetoothManager <span style="color:#666600">=</span><br>         <span style="color:#666600">(</span><span style="color:#660066">BluetoothManager</span><span style="color:#666600">)</span> getSystemService<span style="color:#666600">(</span><span style="color:#660066">Context</span><span style="color:#666600">.</span>BLUETOOTH_SERVICE<span style="color:#666600">);</span><br> mBluetoothAdapter <span style="color:#666600">=</span> bluetoothManager<span style="color:#666600">.</span>getAdapter<span style="color:#666600">();</span></p> 
</div> 
<p>2.       启用蓝牙</p> 
<p>接下来，你需要确保蓝牙被启用。调用isEnabled()来检查蓝牙当前是否启用。如果这个方法返回false，那么蓝牙功能被禁用。下面的代码片段检查蓝牙是否启用。如果未启用，以下代码展示一个错误，提示用户去设置页面启用蓝牙：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">private</span> <span style="color:#660066"> BluetoothAdapter</span> mBluetoothAdapter<span style="color:#666600">;</span><br> <span style="color:#666600">...</span><br> <span style="color:#006600">// Ensures Bluetooth is availableon the device and it is enabled. If not,</span><br> <span style="color:#006600">// displays a dialog requestinguser permission to enable Bluetooth.</span><br> <span style="color:#000088">if</span> <span style="color:#666600">(</span>mBluetoothAdapter <span style="color:#666600">==</span> <span style="color:#000088">null</span> <span style="color:#666600"> ||</span> <span style="color:#666600">!</span>mBluetoothAdapter<span style="color:#666600">.</span>isEnabled<span style="color:#666600">())</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#660066">Intent</span> enableBtIntent <span style="color:#666600"> =</span> <span style="color:#000088">new</span> <span style="color:#660066">Intent</span><span style="color:#666600">(</span><span style="color:#660066">BluetoothAdapter</span><span style="color:#666600">.</span>ACTION_REQUEST_ENABLE<span style="color:#666600">);</span><br>     startActivityForResult<span style="color:#666600">(</span>enableBtIntent<span style="color:#666600">,</span> REQUEST_ENABLE_BT<span style="color:#666600">);</span><br> <span style="color:#666600">}</span></p> 
</div> 
<h2>发现BLE设备</h2> 
<p>使用startLeScan()发现BLE设备。这个方法需要<a target="_blank" href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.LeScanCallback.html" rel="nofollow noopener noreferrer"><span style="color:windowtext">BluetoothAdapter.LeScanCallback</span></a>作为参数。你必须实现这个回调，因为它实现扫描结果如何返回。因为扫描动作比较消耗电量，你应当遵守以下指南：</p> 
<p>l  一旦你发现所需要的设备，停止扫描。</p> 
<p>l  绝对不要在一个循环中扫描，同时对你的扫描设置时间限制。一种以前可用的设备可能已经移动了范围，继续扫描会消耗电量。</p> 
<p> </p> 
<p>以下代码片段展示如何开始和停止扫描：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006600">/**<br>  * Activity for scanning and displaying available BLE devices.<br>  */</span><br> <span style="color:#000088">public</span> <span style="color:#000088">class</span> <span style="color:#660066">DeviceScanActivity</span> <span style="color:#000088"> extends</span> <span style="color:#660066">ListActivity</span> <span style="color:#666600"> {<!-- --></span><br> <br>     <span style="color:#000088">private</span> <span style="color:#660066">BluetoothAdapter</span>mBluetoothAdapter<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">boolean</span> mScanning<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#660066">Handler</span> mHandler<span style="color:#666600">;</span><br> <br>     <span style="color:#006600">// Stopsscanning after 10 seconds.</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">static</span> <span style="color:#000088">final</span> <span style="color:#000088">long</span> SCAN_PERIOD <span style="color:#666600">=</span> <span style="color:#006666">10000</span><span style="color:#666600">;</span><br>     <span style="color:#666600">...</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">void</span> scanLeDevice<span style="color:#666600">(</span><span style="color:#000088">final</span> <span style="color:#000088">boolean</span> enable<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#000088">if</span> <span style="color:#666600">(</span>enable<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#006600">// Stops scanning after a pre-defined scan period.</span><br>             mHandler<span style="color:#666600">.</span>postDelayed<span style="color:#666600">(</span><span style="color:#000088">new</span> <span style="color:#660066">Runnable</span><span style="color:#666600">()</span> <span style="color:#666600"> {<!-- --></span><br>                 <span style="color:#006666">@Override</span><br>                 <span style="color:#000088">public</span> <span style="color:#000088"> void</span> run<span style="color:#666600">()</span> <span style="color:#666600"> {<!-- --></span><br>                     mScanning<span style="color:#666600">=</span> <span style="color:#000088"> false</span><span style="color:#666600">;</span><br>                    mBluetoothAdapter<span style="color:#666600">.</span>stopLeScan<span style="color:#666600">(</span>mLeScanCallback<span style="color:#666600">);</span><br>                 <span style="color:#666600">}</span><br>             <span style="color:#666600">},</span> SCAN_PERIOD<span style="color:#666600">);</span><br> <br>             mScanning <span style="color:#666600">=</span> <span style="color:#000088"> true</span><span style="color:#666600">;</span><br>             mBluetoothAdapter<span style="color:#666600">.</span>startLeScan<span style="color:#666600">(</span>mLeScanCallback<span style="color:#666600">);</span><br>         <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#666600">{<!-- --></span><br>             mScanning <span style="color:#666600">=</span> <span style="color:#000088"> false</span><span style="color:#666600">;</span><br>             mBluetoothAdapter<span style="color:#666600">.</span>stopLeScan<span style="color:#666600">(</span>mLeScanCallback<span style="color:#666600">);</span><br>         <span style="color:#666600">}</span><br>         <span style="color:#666600">...</span><br>     <span style="color:#666600">}</span><br> <span style="color:#666600">...</span><br> <span style="color:#666600">}</span></p> 
</div> 
<p>如果你仅要扫描特定类型的外设，你可以调用<a target="_blank" href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html#startLeScan%28android.bluetooth.BluetoothAdapter.LeScanCallback%29" rel="nofollow noopener noreferrer"><span style="color:windowtext">startLeScan(UUID[],BluetoothAdapter.LeScanCallback)</span></a>，提供你的应用支持的一组指定GATT服务的UUID对象。</p> 
<p>下面是BluetoothAdapter.LeScanCallback的一个实现，是用来提供BLE扫描结果的接口：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">private</span> <span style="color:#660066"> LeDeviceListAdapter</span> mLeDeviceListAdapter<span style="color:#666600">;</span><br> <span style="color:#666600">...</span><br> <span style="color:#006600">// Device scan callback.</span><br> <span style="color:#000088">private</span> <span style="color:#660066">BluetoothAdapter</span><span style="color:#666600">.</span><span style="color:#660066">LeScanCallback</span> mLeScanCallback <span style="color:#666600">=</span><br>         <span style="color:#000088">new</span> <span style="color:#660066">BluetoothAdapter</span><span style="color:#666600">.</span><span style="color:#660066">LeScanCallback</span><span style="color:#666600">()</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#006666">@Override</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">void</span> onLeScan<span style="color:#666600">(</span><span style="color:#000088">final</span> <span style="color:#660066">BluetoothDevice</span> device<span style="color:#666600">,</span> <span style="color:#000088">int</span> rssi<span style="color:#666600">,</span><br>             <span style="color:#000088">byte</span><span style="color:#666600">[]</span> scanRecord<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>         runOnUiThread<span style="color:#666600">(</span><span style="color:#000088">new</span> <span style="color:#660066">Runnable</span><span style="color:#666600">()</span> <span style="color:#666600"> {<!-- --></span><br>            <span style="color:#006666">@Override</span><br>            <span style="color:#000088">public</span> <span style="color:#000088"> void</span> run<span style="color:#666600">()</span> <span style="color:#666600"> {<!-- --></span><br>                mLeDeviceListAdapter<span style="color:#666600">.</span>addDevice<span style="color:#666600">(</span>device<span style="color:#666600">);</span><br>                mLeDeviceListAdapter<span style="color:#666600">.</span>notifyDataSetChanged<span style="color:#666600">();</span><br>            <span style="color:#666600">}</span><br>        <span style="color:#666600">});</span><br>    <span style="color:#666600">}</span><br> <span style="color:#666600">};</span></p> 
</div> 
<p>注意：你仅能够扫描蓝牙低能耗设备或者扫描经典蓝牙设备，在<a target="_blank" href="http://developer.android.com/guide/topics/connectivity/bluetooth.html" rel="nofollow noopener noreferrer">Bluetooth</a>章节中有描述。你不能同时扫描蓝牙低能耗设备和经典设备。</p> 
<h2>连接到一个GATT服务器</h2> 
<p>与BLE设备交互的第一步是连接到它----------更具体地说是连接到设备上的GATT服务器。你可以使用connectGatt()方法连接到一个BLE设备上的GATT服务器。这个方法有三个参数：一个Context对象，autoConnect（一个布尔值指示当BLE设备可用时是否立即连接），以及一个BluetoothCattCallback的引用：</p> 
<div style="background:#F7F7F7"> 
 <p align="left">mBluetoothGatt <span style="color:#666600">=</span> device<span style="color:#666600">.</span>connectGatt<span style="color:#666600">(</span><span style="color:#000088">this</span><span style="color:#666600">,</span> <span style="color:#000088">false</span><span style="color:#666600">,</span> mGattCallback<span style="color:#666600">);</span></p> 
</div> 
<p>它连接到BLE设备持有的GATT服务器，返回一个BluetoothGatt实例，你可以该实例执行GATT客户端的操作。调用者（安卓应用）是GATT客户端。BluetoothGattCallback用来传递结果给客户端，例如连接的状态，以及GATT客户端的进一步操作。</p> 
<p>在下面的例子中，BLE应用提供一个活动（DeviceControlActivity）用来连接，展示数据，展示设备支持的GATT服务和特征。基于用户的输入，这个活动与一个叫做BluetoothLeService的服务沟通，它通过AndroidBLE的API与BLE设备进行交互：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006600">// A service that interacts with the BLE device via the Android BLE API.</span><br> <span style="color:#000088">public</span> <span style="color:#000088">class</span> <span style="color:#660066">BluetoothLeService</span> <span style="color:#000088"> extends</span> <span style="color:#660066">Service</span> <span style="color:#666600"> {<!-- --></span><br>     <span style="color:#000088">private</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> TAG <span style="color:#666600">=</span> <span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span><span style="color:#000088">class</span><span style="color:#666600">.</span>getSimpleName<span style="color:#666600">();</span><br> <br>     <span style="color:#000088">private</span> <span style="color:#660066">BluetoothManager</span>mBluetoothManager<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#660066">BluetoothAdapter</span>mBluetoothAdapter<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#660066">String</span>mBluetoothDeviceAddress<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#660066">BluetoothGatt</span> mBluetoothGatt<span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">int</span> mConnectionState <span style="color:#666600">=</span> STATE_DISCONNECTED<span style="color:#666600">;</span><br> <br>     <span style="color:#000088">private</span> <span style="color:#000088">static</span> <span style="color:#000088">final</span> <span style="color:#000088">int</span> STATE_DISCONNECTED <span style="color:#666600">=</span> <span style="color:#006666">0</span><span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">static</span> <span style="color:#000088">final</span> <span style="color:#000088">int</span> STATE_CONNECTING <span style="color:#666600">=</span> <span style="color:#006666">1</span><span style="color:#666600">;</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">static</span> <span style="color:#000088">final</span> <span style="color:#000088">int</span> STATE_CONNECTED <span style="color:#666600">=</span> <span style="color:#006666">2</span><span style="color:#666600">;</span><br> <br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> ACTION_GATT_CONNECTED <span style="color:#666600">=</span><br>             <span style="color:#880000">"com.example.bluetooth.le.ACTION_GATT_CONNECTED"</span><span style="color:#666600">;</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> ACTION_GATT_DISCONNECTED <span style="color:#666600">=</span><br>             <span style="color:#880000">"com.example.bluetooth.le.ACTION_GATT_DISCONNECTED"</span><span style="color:#666600">;</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> ACTION_GATT_SERVICES_DISCOVERED <span style="color:#666600">=</span><br>             <span style="color:#880000">"com.example.bluetooth.le.ACTION_GATT_SERVICES_DISCOVERED"</span><span style="color:#666600">;</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> ACTION_DATA_AVAILABLE <span style="color:#666600">=</span><br>             <span style="color:#880000">"com.example.bluetooth.le.ACTION_DATA_AVAILABLE"</span><span style="color:#666600">;</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> <span style="color:#660066">String</span> EXTRA_DATA <span style="color:#666600">=</span><br>             <span style="color:#880000">"com.example.bluetooth.le.EXTRA_DATA"</span><span style="color:#666600">;</span><br> <br>     <span style="color:#000088">public</span> <span style="color:#000088">final</span> <span style="color:#000088">static</span> UUIDUUID_HEART_RATE_MEASUREMENT <span style="color:#666600"> =</span><br>             UUID<span style="color:#666600">.</span>fromString<span style="color:#666600">(</span><span style="color:#660066">SampleGattAttributes</span><span style="color:#666600">.</span>HEART_RATE_MEASUREMENT<span style="color:#666600">);</span><br> <br>     <span style="color:#006600">// Variouscallback methods defined by the BLE API.</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">final</span> <span style="color:#660066">BluetoothGattCallback</span>mGattCallback <span style="color:#666600"> =</span><br>             <span style="color:#000088">new</span> <span style="color:#660066">BluetoothGattCallback</span><span style="color:#666600">()</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#006666">@Override</span><br>         <span style="color:#000088">public</span> <span style="color:#000088">void</span> onConnectionStateChange<span style="color:#666600">(</span><span style="color:#660066">BluetoothGatt</span> gatt<span style="color:#666600">,</span> <span style="color:#000088">int</span> status<span style="color:#666600">,</span><br>                 <span style="color:#000088">int</span> newState<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#660066">String</span> intentAction<span style="color:#666600">;</span><br>             <span style="color:#000088">if</span> <span style="color:#666600">(</span>newState <span style="color:#666600">==</span> <span style="color:#660066">BluetoothProfile</span><span style="color:#666600">.</span>STATE_CONNECTED<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>                 intentAction <span style="color:#666600">=</span> ACTION_GATT_CONNECTED<span style="color:#666600">;</span><br>                 mConnectionState <span style="color:#666600">=</span> STATE_CONNECTED<span style="color:#666600">;</span><br>                 broadcastUpdate<span style="color:#666600">(</span>intentAction<span style="color:#666600">);</span><br>                 <span style="color:#660066">Log</span><span style="color:#666600">.</span>i<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"Connected to GATT server."</span><span style="color:#666600">);</span><br>                 <span style="color:#660066">Log</span><span style="color:#666600">.</span>i<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"Attempting to start servicediscovery:"</span> <span style="color:#666600"> +</span><br>                        mBluetoothGatt<span style="color:#666600">.</span>discoverServices<span style="color:#666600">());</span><br> <br>             <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#000088">if</span> <span style="color:#666600">(</span>newState <span style="color:#666600">==</span> <span style="color:#660066">BluetoothProfile</span><span style="color:#666600">.</span>STATE_DISCONNECTED<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>                 intentAction <span style="color:#666600">=</span> ACTION_GATT_DISCONNECTED<span style="color:#666600">;</span><br>                 mConnectionState <span style="color:#666600">=</span> STATE_DISCONNECTED<span style="color:#666600">;</span><br>                 <span style="color:#660066">Log</span><span style="color:#666600">.</span>i<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"Disconnected from GATT server."</span><span style="color:#666600">);</span><br>                 broadcastUpdate<span style="color:#666600">(</span>intentAction<span style="color:#666600">);</span><br>             <span style="color:#666600">}</span><br>         <span style="color:#666600">}</span><br> <br>         <span style="color:#006666">@Override</span><br>         <span style="color:#006600">//New services discovered</span><br>         <span style="color:#000088">public</span> <span style="color:#000088">void</span> onServicesDiscovered<span style="color:#666600">(</span><span style="color:#660066">BluetoothGatt</span> gatt<span style="color:#666600">,</span> <span style="color:#000088">int</span> status<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#000088">if</span> <span style="color:#666600">(</span>status <span style="color:#666600">==</span> <span style="color:#660066">BluetoothGatt</span><span style="color:#666600">.</span>GATT_SUCCESS<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>                 broadcastUpdate<span style="color:#666600">(</span>ACTION_GATT_SERVICES_DISCOVERED<span style="color:#666600">);</span><br>             <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#666600">{<!-- --></span><br>                 <span style="color:#660066">Log</span><span style="color:#666600">.</span>w<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"onServicesDiscovered received: "</span> <span style="color:#666600"> +</span> status<span style="color:#666600">);</span><br>             <span style="color:#666600">}</span><br>         <span style="color:#666600">}</span><br> <br>         <span style="color:#006666">@Override</span><br>         <span style="color:#006600">//Result of a characteristic read operation</span><br>         <span style="color:#000088">public</span> <span style="color:#000088">void</span> onCharacteristicRead<span style="color:#666600">(</span><span style="color:#660066">BluetoothGatt</span> gatt<span style="color:#666600">,</span><br>                 <span style="color:#660066">BluetoothGattCharacteristic</span> characteristic<span style="color:#666600">,</span><br>                 <span style="color:#000088">int</span> status<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#000088">if</span> <span style="color:#666600">(</span>status <span style="color:#666600">==</span> <span style="color:#660066">BluetoothGatt</span><span style="color:#666600">.</span>GATT_SUCCESS<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>                 broadcastUpdate<span style="color:#666600">(</span>ACTION_DATA_AVAILABLE<span style="color:#666600">,</span> characteristic<span style="color:#666600">);</span><br>             <span style="color:#666600">}</span><br>         <span style="color:#666600">}</span><br>      <span style="color:#666600">...</span><br>     <span style="color:#666600">};</span><br> <span style="color:#666600">...</span><br> <span style="color:#666600">}</span></p> 
</div> 
<p>当一个特别的回调被触发，它会调用适当的broadcastUpdate()帮助方法，同时传递给它一个动作（action）。请注意，本节中的数据解析是按照蓝牙心脏速率测量配置说明进行的：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">private</span> <span style="color:#000088"> void</span> broadcastUpdate<span style="color:#666600">(</span><span style="color:#000088">final</span> <span style="color:#660066">String</span> action<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#000088">final</span> <span style="color:#660066">Intent</span> intent <span style="color:#666600">=</span> <span style="color:#000088">new</span> <span style="color:#660066"> Intent</span><span style="color:#666600">(</span>action<span style="color:#666600">);</span><br>     sendBroadcast<span style="color:#666600">(</span>intent<span style="color:#666600">);</span><br> <span style="color:#666600">}</span><br> <br> <span style="color:#000088">private</span> <span style="color:#000088">void</span> broadcastUpdate<span style="color:#666600">(</span><span style="color:#000088">final</span> <span style="color:#660066">String</span> action<span style="color:#666600">,</span><br>                             <span style="color:#000088">final</span> <span style="color:#660066"> BluetoothGattCharacteristic</span> characteristic<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#000088">final</span> <span style="color:#660066">Intent</span> intent <span style="color:#666600">=</span> <span style="color:#000088">new</span> <span style="color:#660066"> Intent</span><span style="color:#666600">(</span>action<span style="color:#666600">);</span><br> <br>     <span style="color:#006600">// This isspecial handling for the Heart Rate Measurement profile. Data</span><br>     <span style="color:#006600">// parsing iscarried out as per profile specifications.</span><br>     <span style="color:#000088">if</span> <span style="color:#666600">(</span>UUID_HEART_RATE_MEASUREMENT<span style="color:#666600">.</span>equals<span style="color:#666600">(</span>characteristic<span style="color:#666600">.</span>getUuid<span style="color:#666600">()))</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#000088">int</span> flag <span style="color:#666600">=</span> characteristic<span style="color:#666600">.</span>getProperties<span style="color:#666600">();</span><br>         <span style="color:#000088">int</span> format <span style="color:#666600"> =</span> <span style="color:#666600">-</span><span style="color:#006666">1</span><span style="color:#666600">;</span><br>         <span style="color:#000088">if</span> <span style="color:#666600">((</span>flag <span style="color:#666600">&amp;</span> <span style="color:#006666">0x01</span><span style="color:#666600">)</span> <span style="color:#666600">!=</span> <span style="color:#006666">0</span><span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             format <span style="color:#666600">=</span> <span style="color:#660066"> BluetoothGattCharacteristic</span><span style="color:#666600">.</span>FORMAT_UINT16<span style="color:#666600">;</span><br>             <span style="color:#660066">Log</span><span style="color:#666600">.</span>d<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"Heart rate format UINT16."</span><span style="color:#666600">);</span><br>         <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#666600">{<!-- --></span><br>             format <span style="color:#666600">=</span> <span style="color:#660066"> BluetoothGattCharacteristic</span><span style="color:#666600">.</span>FORMAT_UINT8<span style="color:#666600">;</span><br>             <span style="color:#660066">Log</span><span style="color:#666600">.</span>d<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#880000">"Heart rate format UINT8."</span><span style="color:#666600">);</span><br>         <span style="color:#666600">}</span><br>         <span style="color:#000088">final</span> <span style="color:#000088">int</span> heartRate <span style="color:#666600">=</span> characteristic<span style="color:#666600">.</span>getIntValue<span style="color:#666600">(</span>format<span style="color:#666600">,</span> <span style="color:#006666">1</span><span style="color:#666600">);</span><br>         <span style="color:#660066">Log</span><span style="color:#666600">.</span>d<span style="color:#666600">(</span>TAG<span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">.</span>format<span style="color:#666600">(</span><span style="color:#880000">"Received heart rate: %d"</span><span style="color:#666600">,</span> heartRate<span style="color:#666600">));</span><br>         intent<span style="color:#666600">.</span>putExtra<span style="color:#666600">(</span>EXTRA_DATA<span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">.</span>valueOf<span style="color:#666600">(</span>heartRate<span style="color:#666600">));</span><br>     <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#666600"> {<!-- --></span><br>         <span style="color:#006600">//For all other profiles, writes the data formatted in HEX.</span><br>         <span style="color:#000088">final</span> <span style="color:#000088">byte</span><span style="color:#666600">[]</span> data <span style="color:#666600">=</span> characteristic<span style="color:#666600">.</span>getValue<span style="color:#666600">();</span><br>         <span style="color:#000088">if</span> <span style="color:#666600">(</span>data <span style="color:#666600">!=</span> <span style="color:#000088">null</span> <span style="color:#666600"> &amp;&amp;</span> data<span style="color:#666600">.</span>length <span style="color:#666600"> &gt;</span> <span style="color:#006666">0</span><span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#000088">final</span> <span style="color:#660066"> StringBuilder</span> stringBuilder <span style="color:#666600">=</span> <span style="color:#000088"> new</span> <span style="color:#660066">StringBuilder</span><span style="color:#666600">(</span>data<span style="color:#666600">.</span>length<span style="color:#666600">);</span><br>             <span style="color:#000088">for</span><span style="color:#666600">(</span><span style="color:#000088">byte</span>byteChar <span style="color:#666600">:</span> data<span style="color:#666600">)</span><br>                 stringBuilder<span style="color:#666600">.</span>append<span style="color:#666600">(</span><span style="color:#660066">String</span><span style="color:#666600">.</span>format<span style="color:#666600">(</span><span style="color:#880000">"%02X"</span><span style="color:#666600">,</span> byteChar<span style="color:#666600">));</span><br>             intent<span style="color:#666600">.</span>putExtra<span style="color:#666600">(</span>EXTRA_DATA<span style="color:#666600">,</span> <span style="color:#000088">new</span> <span style="color:#660066">String</span><span style="color:#666600">(</span>data<span style="color:#666600">)</span> <span style="color:#666600">+</span> <span style="color:#880000">"\n"</span> <span style="color:#666600"> +</span><br>                    stringBuilder<span style="color:#666600">.</span>toString<span style="color:#666600">());</span><br>         <span style="color:#666600">}</span><br>     <span style="color:#666600">}</span><br>     sendBroadcast<span style="color:#666600">(</span>intent<span style="color:#666600">);</span><br> <span style="color:#666600">}</span></p> 
</div> 
<p>回到DeviceControlActivity,这些事件将在一个广播接收器中处理：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006600">// Handles various events fired by the Service.</span><br> <span style="color:#006600">// ACTION_GATT_CONNECTED: connectedto a GATT server.</span><br> <span style="color:#006600">// ACTION_GATT_DISCONNECTED:disconnected from a GATT server.</span><br> <span style="color:#006600">// ACTION_GATT_SERVICES_DISCOVERED:discovered GATT services.</span><br> <span style="color:#006600">// ACTION_DATA_AVAILABLE: receiveddata from the device. This can be a</span><br> <span style="color:#006600">// result of read or notificationoperations.</span><br> <span style="color:#000088">private</span> <span style="color:#000088">final</span> <span style="color:#660066">BroadcastReceiver</span>mGattUpdateReceiver <span style="color:#666600"> =</span> <span style="color:#000088">new</span> <span style="color:#660066">BroadcastReceiver</span><span style="color:#666600">()</span> <span style="color:#666600">{<!-- --></span><br>     <span style="color:#006666">@Override</span><br>     <span style="color:#000088">public</span> <span style="color:#000088">void</span> onReceive<span style="color:#666600">(</span><span style="color:#660066">Context</span> context<span style="color:#666600">,</span> <span style="color:#660066">Intent</span> intent<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#000088">final</span> <span style="color:#660066">String</span> action <span style="color:#666600">=</span> intent<span style="color:#666600">.</span>getAction<span style="color:#666600">();</span><br>         <span style="color:#000088">if</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span>ACTION_GATT_CONNECTED<span style="color:#666600">.</span>equals<span style="color:#666600">(</span>action<span style="color:#666600">))</span> <span style="color:#666600">{<!-- --></span><br>             mConnected <span style="color:#666600">=</span> <span style="color:#000088"> true</span><span style="color:#666600">;</span><br>             updateConnectionState<span style="color:#666600">(</span>R<span style="color:#666600">.</span><span style="color:#000088">string</span><span style="color:#666600">.</span>connected<span style="color:#666600">);</span><br>             invalidateOptionsMenu<span style="color:#666600">();</span><br>         <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#000088">if</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span>ACTION_GATT_DISCONNECTED<span style="color:#666600">.</span>equals<span style="color:#666600">(</span>action<span style="color:#666600">))</span> <span style="color:#666600">{<!-- --></span><br>             mConnected <span style="color:#666600">=</span> <span style="color:#000088"> false</span><span style="color:#666600">;</span><br>             updateConnectionState<span style="color:#666600">(</span>R<span style="color:#666600">.</span><span style="color:#000088">string</span><span style="color:#666600">.</span>disconnected<span style="color:#666600">);</span><br>             invalidateOptionsMenu<span style="color:#666600">();</span><br>             clearUI<span style="color:#666600">();</span><br>         <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#000088">if</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span><br>                ACTION_GATT_SERVICES_DISCOVERED<span style="color:#666600">.</span>equals<span style="color:#666600">(</span>action<span style="color:#666600">))</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#006600">// Show all the supported services and characteristics on the</span><br>             <span style="color:#006600">// user interface.</span><br>             displayGattServices<span style="color:#666600">(</span>mBluetoothLeService<span style="color:#666600">.</span>getSupportedGattServices<span style="color:#666600">());</span><br>         <span style="color:#666600">}</span> <span style="color:#000088">else</span> <span style="color:#000088">if</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span>ACTION_DATA_AVAILABLE<span style="color:#666600">.</span>equals<span style="color:#666600">(</span>action<span style="color:#666600">))</span> <span style="color:#666600">{<!-- --></span><br>             displayData<span style="color:#666600">(</span>intent<span style="color:#666600">.</span>getStringExtra<span style="color:#666600">(</span><span style="color:#660066">BluetoothLeService</span><span style="color:#666600">.</span>EXTRA_DATA<span style="color:#666600">));</span><br>         <span style="color:#666600">}</span><br>     <span style="color:#666600">}</span><br> <span style="color:#666600">};</span></p> 
</div> 
<h2>读取BLE属性</h2> 
<p>一旦你的Android应用已经连接到一个GATT服务器并且发现服务，它就可以读写它支持的属性。例如，这段代码循环访问服务器的服务和特征，在UI中显示：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">public</span> <span style="color:#000088"> class</span> <span style="color:#660066">DeviceControlActivity</span> <span style="color:#000088"> extends</span> <span style="color:#660066">Activity</span> <span style="color:#666600"> {<!-- --></span><br>     <span style="color:#666600">...</span><br>     <span style="color:#006600">//Demonstrates how to iterate through the supported GATT</span><br>     <span style="color:#006600">// Services/Characteristics.</span><br>     <span style="color:#006600">// In thissample, we populate the data structure that is bound to the</span><br>     <span style="color:#006600">//ExpandableListView on the UI.</span><br>     <span style="color:#000088">private</span> <span style="color:#000088">void</span> displayGattServices<span style="color:#666600">(</span><span style="color:#660066">List</span><span style="color:#666600">&lt;</span><span style="color:#660066">BluetoothGattService</span><span style="color:#666600">&gt;</span> gattServices<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#000088">if</span> <span style="color:#666600">(</span>gattServices <span style="color:#666600">==</span> <span style="color:#000088">null</span><span style="color:#666600">)</span> <span style="color:#000088">return</span><span style="color:#666600">;</span><br>         <span style="color:#660066">String</span> uuid <span style="color:#666600"> =</span> <span style="color:#000088">null</span><span style="color:#666600">;</span><br>         <span style="color:#660066">String</span> unknownServiceString <span style="color:#666600"> =</span> getResources<span style="color:#666600">().</span><br>                 getString<span style="color:#666600">(</span>R<span style="color:#666600">.</span><span style="color:#000088">string</span><span style="color:#666600">.</span>unknown_service<span style="color:#666600">);</span><br>         <span style="color:#660066">String</span> unknownCharaString <span style="color:#666600"> =</span> getResources<span style="color:#666600">().</span><br>                 getString<span style="color:#666600">(</span>R<span style="color:#666600">.</span><span style="color:#000088">string</span><span style="color:#666600">.</span>unknown_characteristic<span style="color:#666600">);</span><br>         <span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;</span> gattServiceData <span style="color:#666600">=</span><br>                 <span style="color:#000088">new</span> <span style="color:#660066"> ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;();</span><br>         <span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;&gt;</span> gattCharacteristicData<br>                 <span style="color:#666600">=</span> <span style="color:#000088"> new</span> <span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;&gt;();</span><br>         mGattCharacteristics <span style="color:#666600">=</span><br>                 <span style="color:#000088">new</span> <span style="color:#660066"> ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">BluetoothGattCharacteristic</span><span style="color:#666600">&gt;&gt;();</span><br> <br>         <span style="color:#006600">//Loops through available GATT Services.</span><br>         <span style="color:#000088">for</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothGattService</span> gattService <span style="color:#666600">:</span> gattServices<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>             <span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;</span> currentServiceData <span style="color:#666600">=</span><br>                     <span style="color:#000088">new</span> <span style="color:#660066"> HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;();</span><br>             uuid <span style="color:#666600">=</span> gattService<span style="color:#666600">.</span>getUuid<span style="color:#666600">().</span>toString<span style="color:#666600">();</span><br>             currentServiceData<span style="color:#666600">.</span>put<span style="color:#666600">(</span><br>                     LIST_NAME<span style="color:#666600">,</span> <span style="color:#660066"> SampleGattAttributes</span><span style="color:#666600">.</span><br>                            lookup<span style="color:#666600">(</span>uuid<span style="color:#666600">,</span> unknownServiceString<span style="color:#666600">));</span><br>             currentServiceData<span style="color:#666600">.</span>put<span style="color:#666600">(</span>LIST_UUID<span style="color:#666600">,</span> uuid<span style="color:#666600">);</span><br>             gattServiceData<span style="color:#666600">.</span>add<span style="color:#666600">(</span>currentServiceData<span style="color:#666600">);</span><br> <br>             <span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;</span> gattCharacteristicGroupData <span style="color:#666600">=</span><br>                     <span style="color:#000088">new</span> <span style="color:#660066"> ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;&gt;();</span><br>             <span style="color:#660066">List</span><span style="color:#666600">&lt;</span><span style="color:#660066">BluetoothGattCharacteristic</span><span style="color:#666600">&gt;</span>gattCharacteristics <span style="color:#666600">=</span><br>                    gattService<span style="color:#666600">.</span>getCharacteristics<span style="color:#666600">();</span><br>             <span style="color:#660066">ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">BluetoothGattCharacteristic</span><span style="color:#666600">&gt;</span> charas <span style="color:#666600">=</span><br>                     <span style="color:#000088">new</span> <span style="color:#660066"> ArrayList</span><span style="color:#666600">&lt;</span><span style="color:#660066">BluetoothGattCharacteristic</span><span style="color:#666600">&gt;();</span><br>            <span style="color:#006600">// Loops through available Characteristics.</span><br>             <span style="color:#000088">for</span> <span style="color:#666600">(</span><span style="color:#660066">BluetoothGattCharacteristic</span> gattCharacteristic <span style="color:#666600">:</span><br>                    gattCharacteristics<span style="color:#666600">)</span> <span style="color:#666600"> {<!-- --></span><br>                 charas<span style="color:#666600">.</span>add<span style="color:#666600">(</span>gattCharacteristic<span style="color:#666600">);</span><br>                 <span style="color:#660066">HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;</span> currentCharaData <span style="color:#666600">=</span><br>                        <span style="color:#000088">new</span> <span style="color:#660066"> HashMap</span><span style="color:#666600">&lt;</span><span style="color:#660066">String</span><span style="color:#666600">,</span> <span style="color:#660066">String</span><span style="color:#666600">&gt;();</span><br>                 uuid <span style="color:#666600">=</span> gattCharacteristic<span style="color:#666600">.</span>getUuid<span style="color:#666600">().</span>toString<span style="color:#666600">();</span><br>                 currentCharaData<span style="color:#666600">.</span>put<span style="color:#666600">(</span><br>                        LIST_NAME<span style="color:#666600">,</span> <span style="color:#660066"> SampleGattAttributes</span><span style="color:#666600">.</span>lookup<span style="color:#666600">(</span>uuid<span style="color:#666600">,</span><br>                                unknownCharaString<span style="color:#666600">));</span><br>                 currentCharaData<span style="color:#666600">.</span>put<span style="color:#666600">(</span>LIST_UUID<span style="color:#666600">,</span> uuid<span style="color:#666600">);</span><br>                gattCharacteristicGroupData<span style="color:#666600">.</span>add<span style="color:#666600">(</span>currentCharaData<span style="color:#666600">);</span><br>             <span style="color:#666600">}</span><br>             mGattCharacteristics<span style="color:#666600">.</span>add<span style="color:#666600">(</span>charas<span style="color:#666600">);</span><br>             gattCharacteristicData<span style="color:#666600">.</span>add<span style="color:#666600">(</span>gattCharacteristicGroupData<span style="color:#666600">);</span><br>          <span style="color:#666600">}</span><br>     <span style="color:#666600">...</span><br>     <span style="color:#666600">}</span><br> <span style="color:#666600">...</span><br> <span style="color:#666600">}</span></p> 
</div> 
<h2>接收GATT通知</h2> 
<p>当设备上特定的特征改变时，BLE应用要求被通知是很常见的。以下代码片段展示了如何使用setCharacteristicNotification()方法为一个特征设置通知。</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">private</span> <span style="color:#660066"> BluetoothGatt</span> mBluetoothGatt<span style="color:#666600">;</span><br> <span style="color:#660066">BluetoothGattCharacteristic</span> characteristic<span style="color:#666600">;</span><br> <span style="color:#000088">boolean</span> enabled<span style="color:#666600">;</span><br> <span style="color:#666600">...</span><br> mBluetoothGatt<span style="color:#666600">.</span>setCharacteristicNotification<span style="color:#666600">(</span>characteristic<span style="color:#666600">,</span> enabled<span style="color:#666600">);</span><br> <span style="color:#666600">...</span><br> <span style="color:#660066">BluetoothGattDescriptor</span> descriptor <span style="color:#666600"> =</span> characteristic<span style="color:#666600">.</span>getDescriptor<span style="color:#666600">(</span><br>         UUID<span style="color:#666600">.</span>fromString<span style="color:#666600">(</span><span style="color:#660066">SampleGattAttributes</span><span style="color:#666600">.</span>CLIENT_CHARACTERISTIC_CONFIG<span style="color:#666600">));</span><br> descriptor<span style="color:#666600">.</span>setValue<span style="color:#666600">(</span><span style="color:#660066">BluetoothGattDescriptor</span><span style="color:#666600">.</span>ENABLE_NOTIFICATION_VALUE<span style="color:#666600">);</span><br> mBluetoothGatt<span style="color:#666600">.</span>writeDescriptor<span style="color:#666600">(</span>descriptor<span style="color:#666600">);</span></p> 
</div> 
<p>一旦一个特征的通知被启用，如果在远程设备上的特征改变时，一个onCharacteristicChaned()回调将会被触发：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#006666">@Override</span><br> <span style="color:#006600">// Characteristic notification</span><br> <span style="color:#000088">public</span> <span style="color:#000088">void</span> onCharacteristicChanged<span style="color:#666600">(</span><span style="color:#660066">BluetoothGatt</span> gatt<span style="color:#666600">,</span><br>         <span style="color:#660066">BluetoothGattCharacteristic</span> characteristic<span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>     broadcastUpdate<span style="color:#666600">(</span>ACTION_DATA_AVAILABLE<span style="color:#666600">,</span> characteristic<span style="color:#666600">);</span><br> <span style="color:#666600">}</span></p> 
</div> 
<h2>关闭客户端应用</h2> 
<p>一旦你的应用已经完成使用一个BLE设备，它应当调用close()，使得系统能够正常地释放资源：</p> 
<div style="background:#F7F7F7"> 
 <p align="left"><span style="color:#000088">public</span> <span style="color:#000088"> void</span> close<span style="color:#666600">()</span> <span style="color:#666600"> {<!-- --></span><br>     <span style="color:#000088">if</span> <span style="color:#666600">(</span>mBluetoothGatt <span style="color:#666600">==</span> <span style="color:#000088">null</span><span style="color:#666600">)</span> <span style="color:#666600">{<!-- --></span><br>         <span style="color:#000088">return</span><span style="color:#666600">;</span><br>     <span style="color:#666600">}</span><br>     mBluetoothGatt<span style="color:#666600">.</span>close<span style="color:#666600">();</span><br>     mBluetoothGatt <span style="color:#666600">=</span> <span style="color:#000088"> null</span><span style="color:#666600">;</span><br> <span style="color:#666600">}</span></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a7a9639b5c0adaa062aed05c2f158dc3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vm manager failed to contact configuration server</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3087eee74812d0851e5ea78c8c57a770/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据库性能的优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>