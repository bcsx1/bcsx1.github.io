<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s集群通过helm部署skywalking - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s集群通过helm部署skywalking" />
<meta property="og:description" content="1、安装helm
下载脚本安装
~# curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 ~# chmod 700 get_helm.sh ~# ./get_helm.sh 或者下载包进行安装
~# wget https://get.helm.sh/helm-canary-linux-amd64.tar.gz ~# mv helm /usr/local/bin ~# chmod &#43;x /usr/local/bin/helm 2、安装nfs
### 这里就将 nfs-server 安装在 master 节点 # 安装 nfs-utils、rpcbind 软件包（===所有节点===） yum -y install nfs-utils rpcbind # 创建目录 sudo mkdir -p /data/nfs # 添加权限 sudo chmod 777 -R /data/nfs # 编辑文件，添加以下内容 sudo vim /etc/exports /data/nfs 172.16.10.0/24(rw,no_root_squash,sync) # 重启服务 systemctl start rpcbind &amp;&amp; systemctl enable rpcbind systemctl start nfs &amp;&amp; systemctl enable nfs（所有节点） # 配置生效 exportfs -rv # 查看共享目录 sudo showmount -e 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c394be6c87860cf9619564301a944b01/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-25T21:00:38+08:00" />
<meta property="article:modified_time" content="2023-12-25T21:00:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s集群通过helm部署skywalking</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1、安装helm<br> 下载脚本安装</p> 
<pre><code class="prism language-bash">~<span class="token comment"># curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span>
~<span class="token comment"># chmod 700 get_helm.sh</span>
~<span class="token comment"># ./get_helm.sh</span>
</code></pre> 
<p>或者下载包进行安装</p> 
<pre><code class="prism language-bash">~<span class="token comment"># wget https://get.helm.sh/helm-canary-linux-amd64.tar.gz</span>
~<span class="token comment"># mv helm /usr/local/bin</span>
~<span class="token comment"># chmod +x /usr/local/bin/helm</span>
</code></pre> 
<p>2、安装nfs</p> 
<pre><code class="prism language-bash"><span class="token comment">### 这里就将 nfs-server 安装在 master 节点</span>

<span class="token comment"># 安装 nfs-utils、rpcbind 软件包（===所有节点===）</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> nfs-utils rpcbind

<span class="token comment"># 创建目录</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/nfs
 
<span class="token comment"># 添加权限</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /data/nfs
 
<span class="token comment"># 编辑文件，添加以下内容</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/exports
/data/nfs <span class="token number">172.16</span>.10.0/24<span class="token punctuation">(</span>rw,no_root_squash,sync<span class="token punctuation">)</span>

<span class="token comment"># 重启服务</span>
systemctl start rpcbind <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> rpcbind
systemctl start nfs <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> nfs（所有节点）

<span class="token comment"># 配置生效</span>
exportfs <span class="token parameter variable">-rv</span>

<span class="token comment"># 查看共享目录</span>
<span class="token function">sudo</span> showmount <span class="token parameter variable">-e</span> <span class="token number">192.168</span>.10.100
<span class="token comment"># 返回值如下，表示创建成功</span>
Export list <span class="token keyword">for</span> <span class="token number">192.168</span>.10.100:
/data/nfs	<span class="token number">172.16</span>.10.*
</code></pre> 
<p>3、安装skypwalk服务<br> <a href="https://github.com/apache/skywalking-helm.git">参考链接</a><br> 1）设置环境变量</p> 
<pre><code class="prism language-bash"><span class="token comment"># change the release version according to your need</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SKYWALKING_RELEASE_VERSION</span><span class="token operator">=</span><span class="token number">4.5</span>.0 
<span class="token comment"># change the release name according to your scenario </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SKYWALKING_RELEASE_NAME</span><span class="token operator">=</span>skywalking
<span class="token comment"># change the namespace to where you want to install SkyWalking  </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SKYWALKING_RELEASE_NAMESPACE</span><span class="token operator">=</span>default  
</code></pre> 
<p>2）通过Docker Helm repository安装skywalking<br> 编辑配置文件</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /root/skywalking-kubernetes/chart
<span class="token function">cat</span>  skywalking/values-my-es.yaml 
<span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the "License"); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token comment"># Default values for skywalking.</span>
<span class="token comment"># This is a YAML-formatted file.</span>
<span class="token comment"># Declare variables to be passed into your templates.</span>

oap:
  image:
    tag: <span class="token number">9.6</span>.0
  storageType: elasticsearch

ui:
  image:
    tag: <span class="token number">9.6</span>.0

elasticsearch:
  enabled: <span class="token boolean">false</span>
  config:               <span class="token comment"># For users of an existing elasticsearch cluster,takes effect when `elasticsearch.enabled` is false</span>
    host: elasticsearch-es-http
    port:
      http: <span class="token number">9200</span>
    user: <span class="token string">"xxx"</span>         <span class="token comment"># [optional]</span>
    password: <span class="token string">"xxx"</span>     <span class="token comment"># [optional]</span>
</code></pre> 
<pre><code class="prism language-bash">
kubectl create namespace skywalking
helm <span class="token function">install</span> <span class="token string">"<span class="token variable">${SKYWALKING_RELEASE_NAME}</span>"</span> <span class="token punctuation">\</span>
  oci://registry-1.docker.io/apache/skywalking-helm <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token string">"<span class="token variable">${SKYWALKING_RELEASE_VERSION}</span>"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${SKYWALKING_RELEASE_NAMESPACE}</span>"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">oap.image.tag</span><span class="token operator">=</span><span class="token number">9.6</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">oap.storageType</span><span class="token operator">=</span>elasticsearch <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">ui.image.tag</span><span class="token operator">=</span><span class="token number">9.6</span>.0
</code></pre> 
<p>结果输出如下</p> 
<pre><code class="prism language-bash">NAME: skywalking
LAST DEPLOYED: Sun Dec <span class="token number">24</span> 03:18:33 <span class="token number">2023</span>
NAMESPACE: skywalking
STATUS: deployed
REVISION: <span class="token number">1</span>
NOTES:
************************************************************************
*                                                                      *
*                 SkyWalking Helm Chart by SkyWalking Team             *
*                                                                      *
************************************************************************

Thank you <span class="token keyword">for</span> installing skywalking-helm.

Your release is named skywalking.

Learn more, please visit https://skywalking.apache.org/

Get the UI URL by running these commands:
  <span class="token builtin class-name">echo</span> <span class="token string">"Visit http://127.0.0.1:8080 to use your application"</span>
  kubectl port-forward svc/skywalking-skywalking-helm-ui <span class="token number">8080</span>:80 <span class="token parameter variable">--namespace</span> skywalking
<span class="token comment">#################################################################################</span>
<span class="token comment">######   WARNING: Persistence is disabled!!! You will lose your data when   #####</span>
<span class="token comment">######            the SkyWalking's storage ES pod is terminated.            #####</span>
<span class="token comment">#################################################################################</span>
</code></pre> 
<p>查看对应pods</p> 
<pre><code class="prism language-bash">kubectl get pods <span class="token parameter variable">-n</span> skywalking
NAME                                              READY   STATUS      RESTARTS   AGE
elasticsearch-master-0                            <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
elasticsearch-master-1                            <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
elasticsearch-master-2                            <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
skywalking-skywalking-helm-oap-5c7bc85f97-48rbt   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
skywalking-skywalking-helm-oap-5c7bc85f97-v74ls   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
skywalking-skywalking-helm-oap-init-ftc8m         <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          34h
skywalking-skywalking-helm-ui-b9f69c6fc-wgjvr     <span class="token number">1</span>/1     Running     <span class="token number">0</span>          34h
</code></pre> 
<p>3）查看配置文件<br> A、查看skywalking-skywalking-helm-ui的相关文件内容<br> depoyment文本内容</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit deployment skywalking-skywalking-helm-ui -n skywalking</span>

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: <span class="token string">"1"</span>
    meta.helm.sh/release-name: skywalking
    meta.helm.sh/release-namespace: skywalking
  creationTimestamp: <span class="token string">"2023-12-23T19:18:33Z"</span>
  generation: <span class="token number">1</span>
  labels:
    app: skywalking
    app.kubernetes.io/managed-by: Helm
    chart: skywalking-helm-4.5.0
    component: ui
    heritage: Helm
    release: skywalking
  name: skywalking-skywalking-helm-ui
  namespace: skywalking
  resourceVersion: <span class="token string">"46556645"</span>
  uid: c0e3217e-4456-4252-b28c-cb53c26e5bf1
spec:
  progressDeadlineSeconds: <span class="token number">600</span>
  replicas: <span class="token number">1</span>
  revisionHistoryLimit: <span class="token number">10</span>
  selector:
    matchLabels:
      app: skywalking
      component: ui
      release: skywalking
  strategy:
    rollingUpdate:
      maxSurge: <span class="token number">25</span>%
      maxUnavailable: <span class="token number">25</span>%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: skywalking
        component: ui
        release: skywalking
    spec:
      containers:
      - env:
        - name: SW_OAP_ADDRESS
          value: http://skywalking-skywalking-helm-oap:12800
        image: skywalking.docker.scarf.sh/apache/skywalking-ui:9.6.0
        imagePullPolicy: IfNotPresent
        name: ui
        ports:
        - containerPort: <span class="token number">8080</span>
          name: page
          protocol: TCP
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds: <span class="token number">30</span>        
</code></pre> 
<p>services</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit svc skywalking-skywalking-helm-ui -n skywalking</span>

apiVersion: v1
kind: Service
metadata:
  annotations:
    meta.helm.sh/release-name: skywalking
    meta.helm.sh/release-namespace: skywalking
  creationTimestamp: <span class="token string">"2023-12-23T19:18:33Z"</span>
  labels:
    app: skywalking
    app.kubernetes.io/managed-by: Helm
    chart: skywalking-helm-4.5.0
    component: ui
    heritage: Helm
    release: skywalking
  name: skywalking-skywalking-helm-ui
  namespace: skywalking
  resourceVersion: <span class="token string">"46556519"</span>
  uid: b4e3da64-da1a-4dcb-9324-537773ce251a
spec:
  clusterIP: <span class="token number">10.68</span>.222.100
  clusterIPs:
  - <span class="token number">10.68</span>.222.100
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - port: <span class="token number">80</span>
    protocol: TCP
    targetPort: <span class="token number">8080</span>
  selector:
    app: skywalking
    component: ui
    release: skywalking
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>A、查看skywalking-skywalking-helm-oap的相关文件内容<br> deployment</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit deployment skywalking-skywalking-helm-oap -n skywalking</span>

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: <span class="token string">"1"</span>
    meta.helm.sh/release-name: skywalking
    meta.helm.sh/release-namespace: skywalking
  creationTimestamp: <span class="token string">"2023-12-23T19:18:33Z"</span>
  generation: <span class="token number">1</span>
  labels:
    app: skywalking
    app.kubernetes.io/managed-by: Helm
    chart: skywalking-helm-4.5.0
    component: oap
    heritage: Helm
    release: skywalking
  name: skywalking-skywalking-helm-oap
  namespace: skywalking
  resourceVersion: <span class="token string">"46557028"</span>
  uid: <span class="token number">83562701</span>-0540-479d-b45c-72445e0d5bcf
spec:
  progressDeadlineSeconds: <span class="token number">600</span>
  replicas: <span class="token number">2</span>
  revisionHistoryLimit: <span class="token number">10</span>
  selector:
    matchLabels:
      app: skywalking
      component: oap
      release: skywalking
  strategy:
    rollingUpdate:
      maxSurge: <span class="token number">25</span>%
      maxUnavailable: <span class="token number">25</span>%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      creationTimestamp: null
      labels:
        app: skywalking
        component: oap
        release: skywalking
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app: skywalking
                  component: oap
                  release: skywalking
              topologyKey: kubernetes.io/hostname
            weight: <span class="token number">1</span>
      containers:
      - env:
        - name: JAVA_OPTS
          value: <span class="token parameter variable">-Dmode</span><span class="token operator">=</span>no-init <span class="token parameter variable">-Xmx2g</span> <span class="token parameter variable">-Xms2g</span>
        - name: SW_CLUSTER
          value: kubernetes
        - name: SW_CLUSTER_K8S_NAMESPACE
          value: skywalking
        - name: SW_CLUSTER_K8S_LABEL
          value: <span class="token assign-left variable">app</span><span class="token operator">=</span>skywalking,release<span class="token operator">=</span>skywalking,component<span class="token operator">=</span>oap
        - name: SKYWALKING_COLLECTOR_UID
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.uid
        - name: SW_STORAGE
          value: elasticsearch
        - name: SW_STORAGE_ES_CLUSTER_NODES
          value: elasticsearch-master:9200
        image: skywalking.docker.scarf.sh/apache/skywalking-oap-server:9.6.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: <span class="token number">3</span>
          initialDelaySeconds: <span class="token number">5</span>
          periodSeconds: <span class="token number">10</span>
          successThreshold: <span class="token number">1</span>
          tcpSocket:
            port: <span class="token number">12800</span>
          timeoutSeconds: <span class="token number">1</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      initContainers:
      - command:
        - <span class="token function">sh</span>
        - <span class="token parameter variable">-c</span>
        - <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">60</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">nc</span> <span class="token parameter variable">-z</span> <span class="token parameter variable">-w3</span> elasticsearch-master <span class="token number">9200</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span> <span class="token operator">||</span>
          <span class="token function">sleep</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        image: busybox:1.30
        imagePullPolicy: IfNotPresent
        name: wait-for-elasticsearch
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      serviceAccount: skywalking-skywalking-helm-oap
      serviceAccountName: skywalking-skywalking-helm-oap
      terminationGracePeriodSeconds: <span class="token number">30</span> 
</code></pre> 
<p>service</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit svc skywalking-skywalking-helm-oap -n skywalking</span>

apiVersion: v1
kind: Service
metadata:
  annotations:
    meta.helm.sh/release-name: skywalking
    meta.helm.sh/release-namespace: skywalking
  creationTimestamp: <span class="token string">"2023-12-23T19:18:33Z"</span>
  labels:
    app: skywalking
    app.kubernetes.io/managed-by: Helm
    chart: skywalking-helm-4.5.0
    component: oap
    heritage: Helm
    release: skywalking
  name: skywalking-skywalking-helm-oap
  namespace: skywalking
  resourceVersion: <span class="token string">"46556523"</span>
  uid: 386c9503-7003-447a-94a0-4f9dcd2fa06d
spec:
  clusterIP: <span class="token number">10.68</span>.169.25
  clusterIPs:
  - <span class="token number">10.68</span>.169.25
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: grpc
    port: <span class="token number">11800</span>
    protocol: TCP
    targetPort: <span class="token number">11800</span>
  - name: rest
    port: <span class="token number">12800</span>
    protocol: TCP
    targetPort: <span class="token number">12800</span>
  selector:
    app: skywalking
    component: oap
    release: skywalking
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  
</code></pre> 
<p>C、ingress的配置文件内容<br> secret</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit secret abc.com-ssl -n skywalking</span>

apiVersion: v1
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUdMakNDQlJhZ0F3SUJBZ0lRQzAzRDZSSTlvbnBXZmhYTkJvNUZmakFOQmdrcWhraUc5dzBCQVFzRkFEQmcKTVFzd0NRWURWUVFHRXdKVlV6RVZNQk1HQTFVRUNoTU1SR2xuYVVObGNuUWdTVzVqTVJrd0Z3WURWUVFMRXhCMwpkM2N1WkdsbmFXTmxjblF1WTI5dE1SOHdIUVlEVlFRREV4WkhaVzlVY25WemRDQlVURk1nVWxOQklFTkJJRWN4Ck1CNFhEVEl6TURVd016QXdNREF3TUZvWERUSTBNRFV3TWpJek5UazFPVm93R3pFWk1CY0dBMVVFQXd3UUtpNWoKZFdsM2FuSndZM1pwTG1OdmJUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUw1cQpCZzlGcWt6dmgzV1pBTmtBVHdlYmlzcStyYVV1R2hPUUM3Q1dEN3VFVE5MSU9lMFRJelZkYXhNZ1pCeDRDaHBDClk4MmY5VzhHaVlTTFBvLzkvVWNqNklKaXdsRDFGZmVrY2NyN1duWXpXUk1GSldQMFQ3c3luVTUrRDhGTHNSVTMKL0ZLVC9EVHIzY3NrQ2RJcS9XcWU5RFAzNitjSlZJbURXYTZ2QjR4T1BYT2FlT1FHTjl5cTNLZ3FWVUU2MnZDWQpRSWhyL3lDSmQ5RjRadEM5MS95dWFlUEJqckdCMzV5N25TZjVVOFhxRGkyNTZqaU5ubFpBQ2NZZHgzYjhNOFNpClFOaHpha0xhbmNPajlNZ005djNrcHFNY253OXZQT3lEVUNpZ1lxWFdHNk5Xdzh2azVWV2ZtZmFNdmFjRERPYWwKdVFCc1MxbzdKZmRzNnNIK1U0VUNBd0VBQWFPQ0F5Y3dnZ01qTUI4R0ExVWRJd1FZTUJhQUZKUlAxRjJMNUtUaQpwb0QrL2RqNUFPK2p2Z0pYTUIwR0ExVWREZ1FXQkJTdGsvaUNFV3B3aTJBWDRmMCtjLy9sc3RrQkZUQXJCZ05WCkhSRUVKREFpZ2hBcUxtTjFhWGRxY25CamRta3VZMjl0Z2c1amRXbDNhbkp3WTNacExtTnZiVEFPQmdOVkhROEIKQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01EOEdBMVVkSHdRNApNRFl3TktBeW9EQ0dMbWgwZEhBNkx5OWpaSEF1WjJWdmRISjFjM1F1WTI5dEwwZGxiMVJ5ZFhOMFZFeFRVbE5CClEwRkhNUzVqY213d1BnWURWUjBnQkRjd05UQXpCZ1puZ1F3QkFnRXdLVEFuQmdnckJnRUZCUWNDQVJZYmFIUjAKY0RvdkwzZDNkeTVrYVdkcFkyVnlkQzVqYjIwdlExQlRNSFlHQ0NzR0FRVUZCd0VCQkdvd2FEQW1CZ2dyQmdFRgpCUWN3QVlZYWFIUjBjRG92TDNOMFlYUjFjeTVuWlc5MGNuVnpkQzVqYjIwd1BnWUlLd1lCQlFVSE1BS0dNbWgwCmRIQTZMeTlqWVdObGNuUnpMbWRsYjNSeWRYTjBMbU52YlM5SFpXOVVjblZ6ZEZSTVUxSlRRVU5CUnpFdVkzSjAKTUFrR0ExVWRFd1FDTUFBd2dnRi9CZ29yQmdFRUFkWjVBZ1FDQklJQmJ3U0NBV3NCYVFCMkFPN04wR1RWMnhyTwp4VnkzbmJUTkU2SXloMFo4dk96ZXcxRklXVVp4SDdXYkFBQUJoK01JQU1VQUFBUURBRWN3UlFJaEFON1BuOEhGClBJT0VwenV4Ky9wUS9YYW1CS1VKWHhIbER2bll1eU9FTVd6bkFpQTZHUzdDRjNWcGVzeWFwVzR1RDEzQjcrbTgKVVN3R3lBcXNGak9ORkRkNWlBQjNBSFBabm9rYlRKWjRvQ0I5UjUzbXNzWWMwRkZlY1JrcWpHdUFFSHJCZDNLMQpBQUFCaCtNSUFQOEFBQVFEQUVnd1JnSWhBTXROa3ZEams1U0E5MWtlWVVsS090ZzUvRkJZTjFNbG9KTUdSYmdNCmY2R1NBaUVBMWpETnhZa0ZXZTFQVXp3QmtBaG92M3ptaXdEZ1hPSmxVSElISXRhN3Jic0FkZ0JJc09OcjJxWkgKTkEvbGFnTDZuVERySEZJQnkxYmRMSUhadTcrck9kaUVjd0FBQVlmakNBRFNBQUFFQXdCSE1FVUNJQkxkUXRNegowdkE4SEt3bTJQamgxNmNxT2M5MmlWOFFreHRzSUVWZDdEQlpBaUVBNWdJWnlEWEs3MjV3dXFBZFhLZFA0N0JmCllrTE9hRFI4UlpCeUkvTjljY0V3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUhHK2FYTnJHL0lpRkdYbGsrczQKa3FJL1JUV1FsOXVwdnA3ejk5U3ZNamFFSEJETUJ5Z21LS1p1K0l2bjlkOWhVdnZDUTFpM2xFOE1OZkpocGh1awo2MFgwcm5pSU1ucmdETExMYURSc3pSeXVhazZvcGV4QkF6ejAzNGhBVnM3UnMzTlYzVGVpZGV6RlJmZEd2ZEVNCjk5NG1BUDV6a3A0V1BTVFpFbldBS0FBR2o4Wk4ydk9ZSENLaCtrYTFGb29oRzNGMVV0d3hWSG9Gc042L3EvKzgKa2FweXRCTGFSamxvSnZxcFRtbyt4TzRTMU9oNHJkRmdOa3JOYmVoTTU2VDJOSkF5c0p0c25WancyanRnVFhrbApaQzdyUy85RlFUT0RKbTlKYzIyN0xMTjBFbnp6SG03RERDaHBGaTI4akVYM2NiVDNaWDNxb1drSmw4VjdKWlVTCkZKRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRWpUQ0NBM1dnQXdJQkFnSVFEUWQ0S2hNL3h2bWxjcGJoTWYvUmVUQU5CZ2txaGtpRzl3MEJBUXNGQURCaApNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ2hNTVJHbG5hVU5sY25RZ1NXNWpNUmt3RndZRFZRUUxFeEIzCmQzY3VaR2xuYVdObGNuUXVZMjl0TVNBd0hnWURWUVFERXhkRWFXZHBRMlZ5ZENCSGJHOWlZV3dnVW05dmRDQkgKTWpBZUZ3MHhOekV4TURJeE1qSXpNemRhRncweU56RXhNREl4TWpJek16ZGFNR0F4Q3pBSkJnTlZCQVlUQWxWVApNUlV3RXdZRFZRUUtFd3hFYVdkcFEyVnlkQ0JKYm1NeEdUQVhCZ05WQkFzVEVIZDNkeTVrYVdkcFkyVnlkQzVqCmIyMHhIekFkQmdOVkJBTVRGa2RsYjFSeWRYTjBJRlJNVXlCU1UwRWdRMEVnUnpFd2dnRWlNQTBHQ1NxR1NJYjMKRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDK0YranN2aWtLeS82NUxXRXgvVE1rQ0RJdVdlZ2gxTmd3dm00UQp5SVNnUDdvVTVkNzllb3lTRzN2T2hDM3cvM2pFTXVpcG9IMWZCdHA3bTB0VHBzWWJBaGNoNFhBN3JmdUQ2d2hVCmdhamVFckxWeG9pV01Qa0MvRG5VdmJnaTc0QkptZEJpdUdIUVNkN0x3c3VYcFRFR0c5ZllYY2JUVk41U0FUWXEKRGZiZXhiWXhUTXdWSldvVmI2bHJCRWdNM2dCQnFpaUFpeTgwMHh1MU5xMDdKZENJUWtCc05wRnRaYklaaHNEUwpmemxHV1A0d0VtQlEzTzY3YytaWGtGcjJEY3JYQkV0SGFtODBHcDJTTmhvdTJVNVU3VWVzREwveGdMSzYvMGQ3CjZUbkVWTVNVVkprWjhWZVpyK0lVSWx2b0xydGpMYnF1Z2IwVDNPWVhXK0NRVTBrQkFnTUJBQUdqZ2dGQU1JSUIKUERBZEJnTlZIUTRFRmdRVWxFL1VYWXZrcE9LbWdQNzkyUGtBNzZPK0FsY3dId1lEVlIwakJCZ3dGb0FVVGlKVQpJQmlWNXVOdTVnLzYrcmtTN1FZWGp6a3dEZ1lEVlIwUEFRSC9CQVFEQWdHR01CMEdBMVVkSlFRV01CUUdDQ3NHCkFRVUZCd01CQmdnckJnRUZCUWNEQWpBU0JnTlZIUk1CQWY4RUNEQUdBUUgvQWdFQU1EUUdDQ3NHQVFVRkJ3RUIKQkNnd0pqQWtCZ2dyQmdFRkJRY3dBWVlZYUhSMGNEb3ZMMjlqYzNBdVpHbG5hV05sY25RdVkyOXRNRUlHQTFVZApId1E3TURrd042QTFvRE9HTVdoMGRIQTZMeTlqY213ekxtUnBaMmxqWlhKMExtTnZiUzlFYVdkcFEyVnlkRWRzCmIySmhiRkp2YjNSSE1pNWpjbXd3UFFZRFZSMGdCRFl3TkRBeUJnUlZIU0FBTUNvd0tBWUlLd1lCQlFVSEFnRVcKSEdoMGRIQnpPaTh2ZDNkM0xtUnBaMmxqWlhKMExtTnZiUzlEVUZNd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQgpBSUljQkRxQzZjV3B5R1VTWEFqakFjWXdzSzRpaUdGN0t3ZUc5N2kxUkp6MWt3WmhSb282b3JVMUp0QlluanpCCmM0Ky9zWG1uSEprM21sUHlMMXh1SUF0OXNNZUM3K3ZyZVJJRjV3RkJDME1DTjVzYkh3aE5OMUp6S2JpZk5lUDUKb3pwWmRRRm1rQ28rbmVCaUtSNkhxSUErTE1UTUNNTXV2MmtoR0d1UEhtdER6ZTRHbUVHWnRZTHlGOEVRcGE1WQpqUHVWNmsyQ3IvTjNYeEZwVDNoUnB0LzN1c1UvWmI5d2ZLUHRXcG96blo0LzQ0YzFwOXJ6RmNaWXJXa2ozQSs3ClROQkpFMEdtUDJmaFhoUDFEL1hWZklXL2gweUNKR0VpVjlHbG0vdUdPYTNEWEhsbWJBY3hTeUNScmFHK1pCa0EKN2g0U2VNNlk4bC83TUJScFBDejZsOFk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tAED
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdm1vR0QwV3FUTytIZFprQTJRQlBCNXVLeXI2dHBTNGFFNUFMc0pZUHU0Uk0wc2c1CjdSTWpOVjFyRXlCa0hIZ0tHa0pqelovMWJ3YUpoSXMrai8zOVJ5UG9nbUxDVVBVVjk2Unh5dnRhZGpOWkV3VWwKWS9SUHV6S2RUbjRQd1V1eEZUZjhVcFA4Tk92ZHl5UUowaXI5YXA3ME0vZnI1d2xVaVlOWnJxOEhqRTQ5YzVwNAo1QVkzM0tyY3FDcFZRVHJhOEpoQWlHdi9JSWwzMFhobTBMM1gvSzVwNDhHT3NZSGZuTHVkSi9sVHhlb09MYm5xCk9JMmVWa0FKeGgzSGR2d3p4S0pBMkhOcVF0cWR3NlAweUF6Mi9lU21veHlmRDI4ODdJTlFLS0JpcGRZYm8xYkQKeStUbFZaK1o5b3k5cHdNTTVxVzVBR3hMV2pzbDkyenF3ZjVUaFFJREFRQUJBb0lCQUJkb0FRYXZrWmVUZWh0QwppNUFoTVpYRjBQSExMcDAzWlkweUQ3M05OSEhnZVhFUG04OUFvdnRVV0cwcGRpVHB2SlF0eFFicHVzbkRDL1IzCkNXRzUzd0Izc1lVVmpyMVU0elpseUhjakhxT1kvRUlTUjk1WmtkTjVEVTB3d2M4STl1T2MxaTl3Y1hndjVqdXEKV21xelRpTmxGcStzc2hyY1VyLzBuWG1UbW1Ic3BYRW1meDF6TVc3YVA5TDJNT01xazRVamJDblNVZ1c4QnJ6SAo2dlMyLzFpWG5rdEJWK0pvV2ZhYUpmNFljM21RT3J0SFB1R3hCbEhCMk5ISkcxQitQeWN2ckVyLzFhOE10RzlUCjFINlg2aGxmY0hpUUZCRmdpa25mWTJ6Zk5HcElORGpaejFPK2VSRjRpdlphb0ozR3ZtY2RVUldjbHpibmlSQXcKcFJyb2pnRUNnWUVBKzlGK0FqcXVaWnp5T1o5ZWNZYlJwVXd5TWNiNXYwZ2hhdjNoQWdYOXhaclA4dUtCejFqTApBdUcrQVRlL3BDVE1sTVlzL3Rabk1pMVR3Z2Rld2dEM3VqR2plRmZ3TFdINnVWb0kzR3JxbFhscjVGSWYwVjlRCjJYRG5LdXdVOWh6eFpycG52K2xOS01QVWMwdGh1ZjlJVU9LL2Q4LzA3V0lhTDg3OE4yRmUyOUVDZ1lFQXdaTisKMXFHa29hQzNhR1huZWk3ODlBLzNyMEdmSDgvVE1HUkpHaWgrM01FOERhcVNSUEtDbTY3cFlUU28vQlh3VnpvOApoR1R6RWRLOHFMM3NIRW85OEtHRjZ2MjJVSDBrN2ZIY0RkMGZEZGFKT1l1eDZsNWVGTm9nYlF1bWxhdlVPdG0rCk12NWZacVVRS0h1MGxJeExRTWxQZnQ4d2lsakZzb3RIR0RDbVRYVUNnWUVBa1BzWU5XaGJxQjBvU0l5ODcxZlQKcy91ZW1wSVlrRXlURU9xQ2RZdkZnOU9TRGlEaTQrSVhYOTFnYTRzUlJ3djR6VjhiNE16SU5WZHJkYmFRazluQwp4dXgxVllBcnc3VTVpU1dSSEhaaUFSVWJUU1VMTkp4UURDQzR0em1kQitXNkJvOGoxSllaMm5LRkNxeEg0N0phCmpGZEFMVmNKaVBLR2FTZ2VoalFGVFVFQ2dZQktYam9LaDB0U2RRWkJhM1VFc2V5b2IwSCs2TDBUWWFxSEd1QWkKMW8vMmk1NWd1Yms4RjljcHJJY291eXg0dkl6N1ZmcE4rdUtQWkdEcWl4eWN1Y0VXSTFmcHNkTkxGT2tOS1RBYgplMm9rek5rbmJJM0x0cmw2VlZyRHlnZ1QxRkhTMGppS0tzUElFWDRscjNEdTZQODRRcDd4NVJrbTdYZjJZaC9NCklWU2l5UUtCZ0JiK0plU0lFRmM1czRyRklaYnN0eENCK1dqdk1PczR0RW5NNkp3WXh4TkJmYUdQQUtMWmNCNDMKWTVQblNoT2w0T21RYnZ5RWdHK1o4RFcrN0J2cVVjVE92SGlhb2YzTzZPUjBQdmV4Y3Z0Sldha3RHRVlPT0g2bQpGTWZmZ3QvUkEraUFQay91QllCZVNLWHNGNDhCY3Nsck15TU9rUThpaU02OTQ1WEIxaE5RCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tAVse
immutable: <span class="token boolean">false</span>
kind: Secret
metadata:
  creationTimestamp: <span class="token string">"2023-12-21T14:30:06Z"</span>
  name: abc.com-ssl
  namespace: skywalking
  resourceVersion: <span class="token string">"46095322"</span>
</code></pre> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit ingress skywalking-ui -n skywalking</span>

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  creationTimestamp: <span class="token string">"2023-12-22T11:51:21Z"</span>
  generation: <span class="token number">3</span>
  labels:
    app: skywalking
    app.kubernetes.io/managed-by: Helm
    chart: skywalking-4.3.0
    component: ui
    heritage: Helm
    k8s.kuboard.cn/name: skywalking-ui
    release: skywalking
  name: skywalking-ui
  namespace: skywalking
  resourceVersion: <span class="token string">"46541768"</span>
  uid: 9331ed1a-40e0-4fb2-b6a5-370207fb196b
spec:
  ingressClassName: biking-ingress
  rules:
  - host: skywalking-oap-test.abc.com
    http:
      paths:
      - backend:
          service:
            name: skywalking-skywalking-helm-ui
            port:
              number: <span class="token number">80</span>
        path: /
        pathType: Prefix
  tls:
  - hosts:
    - skywalking-oap-test.abc.com
    secretName: abc.com-ssl
status:
  loadBalancer:
    ingress:
    - ip: <span class="token number">172.16</span>.10.202
    - ip: <span class="token number">172.16</span>.10.203
</code></pre> 
<p>D、查看elasticsearch的配置内容<br> StatefulSet</p> 
<pre><code class="prism language-yaml">~<span class="token comment"># kubectl edit StatefulSet elasticsearch-master -n skywalking</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">esMajorVersion</span><span class="token punctuation">:</span> <span class="token string">"7"</span>
    <span class="token key atrule">meta.helm.sh/release-name</span><span class="token punctuation">:</span> skywalking
    <span class="token key atrule">meta.helm.sh/release-namespace</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">"2023-12-23T19:18:33Z"</span>
  <span class="token key atrule">generation</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
    <span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation">:</span> Helm
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> elasticsearch
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> Helm
    <span class="token key atrule">release</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">"46556881"</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 6181350e<span class="token punctuation">-</span>d165<span class="token punctuation">-</span>43b6<span class="token punctuation">-</span>b1df<span class="token punctuation">-</span>e2473b928f47
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">persistentVolumeClaimRetentionPolicy</span><span class="token punctuation">:</span>
    <span class="token key atrule">whenDeleted</span><span class="token punctuation">:</span> Retain
    <span class="token key atrule">whenScaled</span><span class="token punctuation">:</span> Retain
  <span class="token key atrule">podManagementPolicy</span><span class="token punctuation">:</span> Parallel
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master<span class="token punctuation">-</span>headless
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
        <span class="token key atrule">chart</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">release</span><span class="token punctuation">:</span> skywalking
      <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
        <span class="token key atrule">podAntiAffinity</span><span class="token punctuation">:</span>
          <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">labelSelector</span><span class="token punctuation">:</span>
              <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> app
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> elasticsearch<span class="token punctuation">-</span>master
            <span class="token key atrule">topologyKey</span><span class="token punctuation">:</span> kubernetes.io/hostname
      <span class="token key atrule">automountServiceAccountToken</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.name
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster.initial_master_nodes
          <span class="token key atrule">value</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">,</span>elasticsearch<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span>elasticsearch<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> discovery.seed_hosts
          <span class="token key atrule">value</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master<span class="token punctuation">-</span>headless
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster.name
          <span class="token key atrule">value</span><span class="token punctuation">:</span> elasticsearch
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> network.host
          <span class="token key atrule">value</span><span class="token punctuation">:</span> 0.0.0.0
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster.deprecation_indexing.enabled
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"false"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ES_JAVA_OPTS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>Xmx1g <span class="token punctuation">-</span>Xms1g
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.data
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.ingest
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.master
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.ml
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> node.remote_cluster_client
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>7.17.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9200</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> http 
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9300</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> transport
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">exec</span><span class="token punctuation">:</span>
            <span class="token key atrule">command</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> bash
            <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
            <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">
              set -e
              # If the node is starting up wait for the cluster to be ready (request params: "wait_for_status=green&amp;timeout=1s" )
              # Once it has started only check that the node itself is responding
              START_FILE=/tmp/.es_start_file</span>

              <span class="token comment"># Disable nss cache to avoid filling dentry cache when calling curl</span>
              <span class="token comment"># This is required with Elasticsearch Docker using nss &lt; 3.52</span>
              export NSS_SDB_USE_CACHE=no

              http () <span class="token punctuation">{<!-- --></span>
                local path="$<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span>"
                local args="$<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span>"
                set <span class="token punctuation">-</span><span class="token punctuation">-</span> <span class="token punctuation">-</span>XGET <span class="token punctuation">-</span>s

                if <span class="token punctuation">[</span> "$args" <span class="token tag">!=</span> "" <span class="token punctuation">]</span>; then
                  set <span class="token punctuation">-</span><span class="token punctuation">-</span> "$@" $args
                fi

                if <span class="token punctuation">[</span> <span class="token punctuation">-</span>n "$<span class="token punctuation">{<!-- --></span>ELASTIC_PASSWORD<span class="token punctuation">}</span>" <span class="token punctuation">]</span>; then
                  set <span class="token punctuation">-</span><span class="token punctuation">-</span> "$@" <span class="token punctuation">-</span>u "elastic<span class="token punctuation">:</span>$<span class="token punctuation">{<!-- --></span>ELASTIC_PASSWORD<span class="token punctuation">}</span>"
                fi

                curl <span class="token punctuation">-</span><span class="token punctuation">-</span>output /dev/null <span class="token punctuation">-</span>k "$@" "http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>9200$<span class="token punctuation">{<!-- --></span>path<span class="token punctuation">}</span>"
              <span class="token punctuation">}</span>

              if <span class="token punctuation">[</span> <span class="token punctuation">-</span>f "$<span class="token punctuation">{<!-- --></span>START_FILE<span class="token punctuation">}</span>" <span class="token punctuation">]</span>; then
                echo 'Elasticsearch is already running<span class="token punctuation">,</span> lets check the node is healthy'
                HTTP_CODE=$(http "/" "<span class="token punctuation">-</span>w %<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span>")
                RC=$<span class="token punctuation">?</span>
                if <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token punctuation">{<!-- --></span>RC<span class="token punctuation">}</span> <span class="token punctuation">-</span>ne 0 <span class="token punctuation">]</span><span class="token punctuation">]</span>; then
                  echo "curl <span class="token punctuation">-</span><span class="token punctuation">-</span>output /dev/null <span class="token punctuation">-</span>k <span class="token punctuation">-</span>XGET <span class="token punctuation">-</span>s <span class="token punctuation">-</span>w '%<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span>' \$<span class="token punctuation">{<!-- --></span>BASIC_AUTH<span class="token punctuation">}</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>9200/ failed with RC $<span class="token punctuation">{<!-- --></span>RC<span class="token punctuation">}</span>"
                  exit $<span class="token punctuation">{<!-- --></span>RC<span class="token punctuation">}</span>
                fi
                <span class="token comment"># ready if HTTP code 200, 503 is tolerable if ES version is 6.x</span>
                if <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token punctuation">{<!-- --></span>HTTP_CODE<span class="token punctuation">}</span> == "200" <span class="token punctuation">]</span><span class="token punctuation">]</span>; then
                  exit 0
                elif <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token punctuation">{<!-- --></span>HTTP_CODE<span class="token punctuation">}</span> == "503" <span class="token important">&amp;&amp;</span> "7" == "6" <span class="token punctuation">]</span><span class="token punctuation">]</span>; then
                  exit 0
                else
                  echo "curl <span class="token punctuation">-</span><span class="token punctuation">-</span>output /dev/null <span class="token punctuation">-</span>k <span class="token punctuation">-</span>XGET <span class="token punctuation">-</span>s <span class="token punctuation">-</span>w '%<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span>' \$<span class="token punctuation">{<!-- --></span>BASIC_AUTH<span class="token punctuation">}</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>9200/ failed with HTTP code $<span class="token punctuation">{<!-- --></span>HTTP_CODE<span class="token punctuation">}</span>"
                  exit 1
                fi

              else
                <span class="token key atrule">echo 'Waiting for elasticsearch cluster to become ready (request params</span><span class="token punctuation">:</span> "wait_for_status=green<span class="token important">&amp;timeout=1s"</span> )'
                if http "/_cluster/health<span class="token punctuation">?</span>wait_for_status=green<span class="token important">&amp;timeout=1s"</span> "<span class="token punctuation">-</span><span class="token punctuation">-</span>fail" ; then
                  touch $<span class="token punctuation">{<!-- --></span>START_FILE<span class="token punctuation">}</span>
                  exit 0
                else
                  <span class="token key atrule">echo 'Cluster is not yet ready (request params</span><span class="token punctuation">:</span> "wait_for_status=green<span class="token important">&amp;timeout=1s"</span> )'
                  exit 1
                fi
              fi
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 2Gi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 2Gi
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">drop</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ALL
          <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
        <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
      <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
      <span class="token key atrule">enableServiceLinks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> sysctl
        <span class="token punctuation">-</span> <span class="token punctuation">-</span>w    
        <span class="token punctuation">-</span> vm.max_map_count=262144
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>7.17.3
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">name</span><span class="token punctuation">:</span> configure<span class="token punctuation">-</span>sysctl
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
        <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">120</span>
  <span class="token key atrule">updateStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate   
</code></pre> 
<p>service</p> 
<pre><code class="prism language-yaml">~<span class="token comment"># kubectl edit service elasticsearch-master -n skywalking</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">meta.helm.sh/release-name</span><span class="token punctuation">:</span> skywalking
    <span class="token key atrule">meta.helm.sh/release-namespace</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">"2023-12-23T19:18:33Z"</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
    <span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation">:</span> Helm
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> elasticsearch
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> Helm
    <span class="token key atrule">release</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">"46556527"</span>
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 7e6f70f2<span class="token punctuation">-</span>de8f<span class="token punctuation">-</span>46e6<span class="token punctuation">-</span>8b2d<span class="token punctuation">-</span>0421e32ec4f7
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> 10.68.47.138
  <span class="token key atrule">clusterIPs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 10.68.47.138
  <span class="token key atrule">internalTrafficPolicy</span><span class="token punctuation">:</span> Cluster
  <span class="token key atrule">ipFamilies</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> IPv4
  <span class="token key atrule">ipFamilyPolicy</span><span class="token punctuation">:</span> SingleStack
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9200</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> transport
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9300</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9300</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>master
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> elasticsearch
    <span class="token key atrule">release</span><span class="token punctuation">:</span> skywalking
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">loadBalancer</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  
</code></pre> 
<p>检测脚本：</p> 
<pre><code class="prism language-bash"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">'set -e
# If the node is starting up wait for the cluster to be ready (request params: "wait_for_status=green&amp;timeout=1s" )
# Once it has started only check that the node itself is responding
START_FILE=/tmp/.es_start_file

# Disable nss cache to avoid filling dentry cache when calling curl
# This is required with Elasticsearch Docker using nss &lt; 3.52
export NSS_SDB_USE_CACHE=no

http () {
  local path="${1}"
  local args="${2}"
  set -- -XGET -s

  if [ "$args" != "" ]; then
    set -- "$@" $args
  fi

  if [ -n "${ELASTIC_PASSWORD}" ]; then
    set -- "$@" -u "elastic:${ELASTIC_PASSWORD}"
  fi

  curl --output /dev/null -k "$@" "http://127.0.0.1:9200${path}"
}

if [ -f "${START_FILE}" ]; then
  echo '</span>Elasticsearch is already running, lets check the <span class="token function">node</span> is healthy<span class="token string">'
  HTTP_CODE=$(http "/" "-w %{http_code}")
  RC=$?
  if [[ ${RC} -ne 0 ]]; then
    echo "curl --output /dev/null -k -XGET -s -w '</span>%<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span><span class="token string">' \${BASIC_AUTH} http://127.0.0.1:9200/ failed with RC ${RC}"
    exit ${RC}
  fi
  # ready if HTTP code 200, 503 is tolerable if ES version is 6.x
  if [[ ${HTTP_CODE} == "200" ]]; then
    exit 0
  elif [[ ${HTTP_CODE} == "503" &amp;&amp; "7" == "6" ]]; then
    exit 0
  else
    echo "curl --output /dev/null -k -XGET -s -w '</span>%<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span><span class="token string">' \${BASIC_AUTH} http://127.0.0.1:9200/ failed with HTTP code ${HTTP_CODE}"
    exit 1
  fi

else
  echo '</span>Waiting <span class="token keyword">for</span> elasticsearch cluster to become ready <span class="token punctuation">(</span>request params: <span class="token string">"wait_for_status=green&amp;timeout=1s"</span> <span class="token punctuation">)</span><span class="token string">'
  if http "/_cluster/health?wait_for_status=green&amp;timeout=1s" "--fail" ; then
    touch ${START_FILE}
    exit 0
  else
    echo '</span>Cluster is not yet ready <span class="token punctuation">(</span>request params: <span class="token string">"wait_for_status=green&amp;timeout=1s"</span> <span class="token punctuation">)</span><span class="token string">'
    exit 1
  fi
fi
'</span>
</code></pre> 
<p>4、添加客户端agent<br> 下载apache-skywalking-apm-es7后，解压文件，将解压目录下的agent目录，存放到nfs下，然后挂载到java对应的pod服务,并将对应的文件加目录挂载到pods的/usr/skywalking/agent/下<br> 8.7.0版本</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> https://archive.apache.org/dist/skywalking/8.7.0/apache-skywalking-apm-es7-8.7.0.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-xf</span> apache-skywalking-apm-es7-8.7.0.tar.gz
<span class="token function">mv</span> apache-skywalking-apm-es7-8.70/agent/* /data/nfs/skywalking-agent/
</code></pre> 
<p>9.1.0版本</p> 
<pre><code class="prism language-yaml">wget https<span class="token punctuation">:</span>//archive.apache.org/dist/skywalking/java<span class="token punctuation">-</span>agent/9.1.0/apache<span class="token punctuation">-</span>skywalking<span class="token punctuation">-</span>java<span class="token punctuation">-</span>agent<span class="token punctuation">-</span>9.1.0.tgz
tar <span class="token punctuation">-</span>xf apache<span class="token punctuation">-</span>skywalking<span class="token punctuation">-</span>java<span class="token punctuation">-</span>agent<span class="token punctuation">-</span>9.1.0.tgz
mv skywalking<span class="token punctuation">-</span>agent/* /data/nfs/
</code></pre> 
<p>启动一个pods<br> deployment文本内容</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit deployment financial-management -n test</span>

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: <span class="token string">"9"</span>
    k8s.kuboard.cn/displayName: financial-management
    kubectl.kubernetes.io/last-applied-configuration: <span class="token operator">|</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Deployment"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"annotations"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"k8s.kuboard.cn/displayName"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span>,<span class="token string">"labels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"k8s.kuboard.cn/layer"</span><span class="token builtin class-name">:</span><span class="token string">"platform"</span>,<span class="token string">"k8s.kuboard.cn/name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"biking"</span><span class="token punctuation">}</span>,<span class="token string">"spec"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"progressDeadlineSeconds"</span>:600,<span class="token string">"replicas"</span>:1,<span class="token string">"revisionHistoryLimit"</span>:10,<span class="token string">"selector"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"matchLabels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"k8s.kuboard.cn/name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token string">"strategy"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"rollingUpdate"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"maxSurge"</span><span class="token builtin class-name">:</span><span class="token string">"25%"</span>,<span class="token string">"maxUnavailable"</span><span class="token builtin class-name">:</span><span class="token string">"25%"</span><span class="token punctuation">}</span>,<span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"RollingUpdate"</span><span class="token punctuation">}</span>,<span class="token string">"template"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"labels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"k8s.kuboard.cn/name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token string">"spec"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"env"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"TZ"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">}</span>,<span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"NACOS"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token string">"172.16.10.20"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"harbor.cuiwjrpcvi.com/bktest/financial-management:test"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span>,<span class="token string">"ports"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"containerPort"</span>:8081,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"msag7"</span>,<span class="token string">"protocol"</span><span class="token builtin class-name">:</span><span class="token string">"TCP"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"resources"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/test/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"hostAliases"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"hostnames"</span>:<span class="token punctuation">[</span><span class="token string">"rocketmq"</span>,<span class="token string">"kafka"</span>,<span class="token string">"redis"</span><span class="token punctuation">]</span>,<span class="token string">"ip"</span><span class="token builtin class-name">:</span><span class="token string">"172.16.10.20"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"imagePullSecrets"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"harbor-secret"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  creationTimestamp: <span class="token string">"2023-06-27T08:19:05Z"</span>
  generation: <span class="token number">11</span>
  labels:
    k8s.kuboard.cn/layer: platform
    k8s.kuboard.cn/name: financial-management
  name: financial-management
  namespace: <span class="token builtin class-name">test</span>
  resourceVersion: <span class="token string">"46557189"</span>
  uid: 89bc052f-e343-489d-bef9-caa7585c8d1e
spec:
  progressDeadlineSeconds: <span class="token number">600</span>
  replicas: <span class="token number">1</span>
  revisionHistoryLimit: <span class="token number">10</span>
  selector:
    matchLabels:
      k8s.kuboard.cn/name: financial-management
  strategy:
    rollingUpdate:
      maxSurge: <span class="token number">25</span>%
      maxUnavailable: <span class="token number">25</span>%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: <span class="token string">"2023-12-23T23:21:18+04:00"</span>
      creationTimestamp: null
      labels:
        k8s.kuboard.cn/name: financial-management
    spec:
      containers:
      - env:
        - name: TZ
          value: Asia/Shanghai
        - name: NACOS
          value: <span class="token number">172.16</span>.10.20
        - name: BUILD_TAG
          value: <span class="token variable">${BUILD_TAG}</span>
        - name: NAMESPACE
          value: <span class="token builtin class-name">test</span>
        - name: JAVA_TOOL_OPTIONS
          value: -javaagent:/usr/skywalking/agent/skywalking-agent.jar
        - name: SW_AGENT_NAME
          value: financial-management
        - name: SW_AGENT_COLLECTOR_BACKEND_SERVICES
          value: skywalking-skywalking-helm-oap.skywalking.svc.cluster.local:11800
        - name: SW_AGENT_FORCE_TLS
          value: <span class="token string">"true"</span>
        image: harbor.cuiwjrpcvi.com/bktest/financial-management:test
        imagePullPolicy: Always
        name: financial-management
        ports:
        - containerPort: <span class="token number">8081</span>
          name: msag7
          protocol: TCP
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        terminationMessagePath: /test/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /usr/skywalking/agent/
          name: volume-2bhb2
          subPath: skywalking-agent
      dnsPolicy: ClusterFirst
      hostAliases:
      - hostnames:
        - rocketmq
        - kafka
        - redis
        ip: <span class="token number">172.16</span>.10.20
      imagePullSecrets:
      - name: harbor-secret
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds: <span class="token number">30</span>
      volumes:
      - name: volume-2bhb2
        nfs:
          path: /data/nfs
          server: <span class="token number">172.16</span>.10.20       
</code></pre> 
<p>service文本内容</p> 
<pre><code class="prism language-bash">~<span class="token comment"># kubectl edit svc financial-management -n test</span>

apiVersion: v1
kind: Service
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: <span class="token operator">|</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Service"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"annotations"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"labels"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"app.kubernetes.io/instance"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span>,<span class="token string">"k8s.kuboard.cn/name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"biking"</span><span class="token punctuation">}</span>,<span class="token string">"spec"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"ports"</span>:<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kjmfca"</span>,<span class="token string">"port"</span>:8081,<span class="token string">"protocol"</span><span class="token builtin class-name">:</span><span class="token string">"TCP"</span>,<span class="token string">"targetPort"</span>:8081<span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">"selector"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"k8s.kuboard.cn/name"</span><span class="token builtin class-name">:</span><span class="token string">"financial-management"</span><span class="token punctuation">}</span>,<span class="token string">"sessionAffinity"</span><span class="token builtin class-name">:</span><span class="token string">"None"</span>,<span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterIP"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  creationTimestamp: <span class="token string">"2023-06-27T08:19:05Z"</span>
  labels:
    app.kubernetes.io/instance: financial-management
    k8s.kuboard.cn/name: financial-management
  name: financial-management
  namespace: <span class="token builtin class-name">test</span>
  resourceVersion: <span class="token string">"5855"</span>
  uid: 4620bbc0-f8bd-48d9-8ad6-41a69939c31d
spec:
  clusterIP: <span class="token number">10.68</span>.140.221
  clusterIPs:
  - <span class="token number">10.68</span>.140.221
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: kjmfca
    port: <span class="token number">8081</span>
    protocol: TCP
    targetPort: <span class="token number">8081</span>
  selector:
    k8s.kuboard.cn/name: financial-management
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>依次类推部署其他的pod</p> 
<p>5、登录ui控制台<br> https://skywalking-oap-test.abc.com/General-Service/Services<br> service图形入下<br> <img src="https://images2.imgbox.com/30/fa/Qa7WUaLY_o.png" alt="在这里插入图片描述"><br> Topology图形如下<br> <img src="https://images2.imgbox.com/e8/fb/mNlXRqA3_o.png" alt="在这里插入图片描述"><br> 查看实例的图形<br> <img src="https://images2.imgbox.com/a4/54/mbM6jfg1_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9e43060d2ed406a85234b0cb5934b4da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matlab编程技巧：导入MDF文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95e3a5723bcab23af23bb7648f6dfbd0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity 如何获取当前日期的中文星期几</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>