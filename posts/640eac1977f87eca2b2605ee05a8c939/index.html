<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>opencv图像对齐与图像相减python - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="opencv图像对齐与图像相减python" />
<meta property="og:description" content="1.问题背景： 给一张图片和模板图片（如下图），需要用传统机器视觉的方法来提取他们不一样的特征（也就是划痕部分），并把划痕转为二值化
1.1 才开始使用基于灰度的方法：
因为划痕和旁边背景颜色比较接近，绘制出的灰度直方图变化不大，调了很久阈值也不能分出划痕部分，效果如下：
1.2 后来直接使用图像相减，RGB和Gray分别图像相减结果得到如下：
解决方案： 应该是没有配准而相减有边框的，最终决定配准后，图像相减
查阅资料文献后，大致思路如下：
1. RGB—&gt; 灰度图
2. 去噪滤波，图像增强等一系列预处理操作
3. 提特征点（ORB）并进行图像配准
4. 配准后进行二值化
5. 图像相减操作（ImageChops.difference）
1. RGB-----&gt; Gray # 1. 转为灰度图 target = cv2.imread(&#34;2368_data.png&#34;) gray_target=cv2.cvtColor(target, cv2.COLOR_BGR2GRAY) template = cv2.imread(&#34;2368_model.png&#34;) gray_template=cv2.cvtColor(template, cv2.COLOR_BGR2GRAY) 2. 去噪滤波 预处理操作 # 去噪滤波 预处理 target_gauss = cv2.GaussianBlur(gray_target,(3, 3),1,1) template_gauss = cv2.GaussianBlur(gray_template,(3, 3),1,1) # plt转为cv target_gauss =Image.fromarray(target_gauss) # np array template_gauss =Image.fromarray(template_gauss) # np array # 亮度增强 bright= 0.9 bright_target=ImageEnhance.Brightness(target_gauss).enhance(bright) bright_template=ImageEnhance.Brightness(template_gauss).enhance(bright) #色度增强 color = 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/640eac1977f87eca2b2605ee05a8c939/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-24T09:32:16+08:00" />
<meta property="article:modified_time" content="2022-06-24T09:32:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">opencv图像对齐与图像相减python</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.问题背景：</h3> 
<p>给一张图片和模板图片（如下图），需要用传统机器视觉的方法来提取他们不一样的特征（也就是划痕部分），并把划痕转为二值化<br> <img src="https://images2.imgbox.com/ff/0d/wdmT9BDA_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>1.1</strong> 才开始使用基于灰度的方法：<br> <img src="https://images2.imgbox.com/da/b1/rKqximER_o.png" alt="在这里插入图片描述"><br> 因为划痕和旁边背景颜色比较接近，绘制出的灰度直方图变化不大，调了很久阈值也不能分出划痕部分，效果如下：<br> <img src="https://images2.imgbox.com/36/7c/EEFyPCMz_o.png" alt="th1是"></p> 
<hr> 
<p><strong>1.2</strong> 后来直接使用图像相减，RGB和Gray分别图像相减结果得到如下：</p> 
<p><img src="https://images2.imgbox.com/67/8d/bqspP0qX_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/64/83/NVR5OmTR_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="_21"></a>解决方案：</h3> 
<p>应该是没有配准而相减有边框的，最终决定配准后，图像相减<br> 查阅资料文献后，大致思路如下：<br> <strong>1. RGB—&gt; 灰度图<br> 2. 去噪滤波，图像增强等一系列预处理操作<br> 3. 提特征点（ORB）并进行图像配准<br> 4. 配准后进行二值化<br> 5. 图像相减操作（ImageChops.difference）</strong></p> 
<h3><a id="1_RGB_Gray_30"></a>1. RGB-----&gt; Gray</h3> 
<pre><code class="prism language-python"><span class="token comment">#  1. 转为灰度图</span>
target <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"2368_data.png"</span><span class="token punctuation">)</span>
gray_target<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>target<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
template <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"2368_model.png"</span><span class="token punctuation">)</span>
gray_template<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>template<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/37/Bl4Ucriv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2___43"></a>2. 去噪滤波 预处理操作</h3> 
<pre><code class="prism language-python"><span class="token comment"># 去噪滤波 预处理</span>
target_gauss <span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>gray_target<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
template_gauss <span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>gray_template<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># plt转为cv</span>
target_gauss <span class="token operator">=</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>target_gauss<span class="token punctuation">)</span> <span class="token comment"># np array</span>
template_gauss <span class="token operator">=</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>template_gauss<span class="token punctuation">)</span> <span class="token comment"># np array</span>

<span class="token comment"># 亮度增强</span>
bright<span class="token operator">=</span>  <span class="token number">0.9</span>
bright_target<span class="token operator">=</span>ImageEnhance<span class="token punctuation">.</span>Brightness<span class="token punctuation">(</span>target_gauss<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>bright<span class="token punctuation">)</span>
bright_template<span class="token operator">=</span>ImageEnhance<span class="token punctuation">.</span>Brightness<span class="token punctuation">(</span>template_gauss<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>bright<span class="token punctuation">)</span>

<span class="token comment">#色度增强</span>
color <span class="token operator">=</span> <span class="token number">1.2</span>
colored_target <span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Color<span class="token punctuation">(</span>bright_target<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>color<span class="token punctuation">)</span>
colored_template <span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Color<span class="token punctuation">(</span>bright_template<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>color<span class="token punctuation">)</span>

<span class="token comment"># 对比度增强</span>
contrast <span class="token operator">=</span><span class="token number">1.1</span>
contrasted_target <span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Contrast<span class="token punctuation">(</span>colored_target<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>contrast<span class="token punctuation">)</span>
contrasted_template <span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Contrast<span class="token punctuation">(</span>colored_template<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>contrast<span class="token punctuation">)</span>

<span class="token comment"># 锐度增强</span>
sharpness <span class="token operator">=</span> <span class="token number">18.0</span>
shaped_target<span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Sharpness<span class="token punctuation">(</span>contrasted_target<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>sharpness<span class="token punctuation">)</span>
shaped_template<span class="token operator">=</span> ImageEnhance<span class="token punctuation">.</span>Sharpness<span class="token punctuation">(</span>contrasted_template<span class="token punctuation">)</span><span class="token punctuation">.</span>enhance<span class="token punctuation">(</span>sharpness<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>shaped_target<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'shaped_target'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>shaped_template<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'shaped_template'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>1.只做高斯去噪，不做亮度，锐化等预处理后的图片：</strong><br> <img src="https://images2.imgbox.com/1a/e0/6c9605jT_o.png" alt="在这里插入图片描述"><br> <strong>2.不进行高斯去噪，只进行预处理的图：</strong><br> 灰度后的图片会产生很多噪点，因此进行去噪滤波还是有一定效果的。<br> 去噪<br> <img src="https://images2.imgbox.com/19/27/t1D1YE14_o.png" alt="在这里插入图片描述"></p> 
<p><strong>3.做完高斯去噪以及一系列亮度，锐化预处理后的图片：<br> （具体参数还没有详细调，只是先按这个值先设置）</strong></p> 
<p><img src="https://images2.imgbox.com/b2/c6/AqXDoMMZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_ORBSURF_95"></a>3. 提特征点（ORB或SURF）并进行图像配准</h3> 
<h4><a id="31__96"></a>3.1 理论部分</h4> 
<p>参考资料《mage Alignment (Feature Based) using OpenCV (C++/Python)》</p> 
<p><img src="https://images2.imgbox.com/41/64/R0PAp1qt_o.png" alt="在这里插入图片描述"></p> 
<p><strong>核心思想：</strong><br> 在一个图像中检测到一组特征点，并与另一张图像中的特征点相匹配。然后根据这些匹配的特征点计算出一个转换规则，从而将一个图像映射到另一个图像上。<br> 主要应用就是扫描软件，合成全景图片等。</p> 
<p><font color="red"><strong>图像对齐技术的核心是一种维数3X3的单应性矩阵（Homography ）</strong></font></p> 
<p><strong>图像配准步骤：</strong></p> 
<ol><li><strong>读取图片</strong></li><li><strong>检测特征点</strong>：为两张图检测ORB特征点。为了计算单应性矩阵4个就够了，但是一般会检测到成百上千的特征点。可以使用参数MAX_FEATURES来控制检测的特征点的数量。检测特征点并计算描述子的函数是detectAndCompute。</li><li><strong>特征匹配</strong>：找到两图中匹配的特征点，并按照匹配度排列，保留最匹配的一小部分。然后把匹配的特征点画出来并保存图片到磁盘。我们使用<strong>Hamming</strong>来度量两个特征点描述子的相似度。下图中把匹配的特征点用线连起来了。注意，有很多错误匹配的特征点，所以下一步要用一个健壮的算法来计算单应性矩阵。</li><li><strong>计算单应性矩阵</strong>：上一步产生的匹配的特征点不是100%正确的，就算只有20~30%的匹配是正确的也不罕见。findHomography函数使用一种被称为随机抽样一致算法(Random Sample Consensus )的技术在大量匹配错误的情况下计算单应性矩阵。</li><li><strong>扭转图片(Warping image)</strong>：有了精确的单应性矩阵，就可以把一张图片的所有像素映射到另一个图片。warpPerspective函数用来完成这个功能。<br> <img src="https://images2.imgbox.com/91/a8/kUrO08b4_o.png" alt="在这里插入图片描述"></li></ol> 
<p><strong>如何把两张图像中的特征点匹配起来呢？</strong><br> SIFT一般的可以使用K近邻（KNN）算法。K近邻算法求取在空间中距离最近的K个数据点，并将这些数据点归为一类。在进行特征点匹配时，一般使用KNN算法找到最近邻的两个数据点，如果最接近和次接近的比值大于一个既定的值，那么我们保留这个最接近的值，认为它和其匹配的点为good match（有Lowe在SIFT论文中提出）</p> 
<hr> 
<h4><a id="Homography_Matrix_120"></a>单应性矩阵Homography Matrix</h4> 
<p><strong>找到特征点并匹配起来后，如何让两张图片对齐呢？</strong><br> 这就用到了单应性矩阵了。Homography这个词由Homo和graphy，Homo意为同一，graphy意为图像，也就是同一个东西产生的图像。不同视角的图像上的点具有如下关系：<br> <img src="https://images2.imgbox.com/90/73/Lu08TAgd_o.png" alt="在这里插入图片描述"><br> 其中[x1 y1 1]和[x2 y2 1]分别表示对应像素的齐次坐标。单应性矩阵就是下面这个矩阵：<br> <img src="https://images2.imgbox.com/e8/aa/B21kiIxq_o.png" alt="在这里插入图片描述"><br> 可以看到，单应性矩阵有八个参数，如果要解这八个参数的话，需要八个方程，由于每一个对应的像素点可以产生2个方程(x一个，y一个)，那么总共只需要四个像素点就能解出这个单应性矩阵。</p> 
<p><strong>那么应该选择哪四个点来计算Homography matrix呢？</strong><br> RANSAC算法巧妙的解决了这一问题。</p> 
<h4><a id="Random_sample_consensusRANSAC_131"></a>随机抽样一致算法（Random sample consensus:RANSAC）</h4> 
<p>说道估算模型的算法，很容易想到最小二乘法。最小二乘法在数据误差比较小的情况下是可以的，但是针对噪声很大的数据集的时候，容易出问题，我们可以通过下面的例子来说明<br> <img src="https://images2.imgbox.com/98/c0/mR6wsI6O_o.png" alt="在这里插入图片描述"><br> 很明显，我们的数据应该是一条由左下到右上的一条线，但是由于离群数据太多（左上和右下区域），如果用最小二乘法的话，就无法准确的找到我们期望的模型（因为最小二乘法无法剔除误差很大的点，一视同仁的将所有的点都用于模型的计算）。RANSAC（Random Sample Consensus）算法的不同之处就在于，它能够有效的去除误差很大的点，并且这些点不计入模型的计算之中。</p> 
<p><strong>所以,在得到了众多的匹配点以后，使用RANSAC算法，每次从中筛选四个随机的点，然后求得H矩阵，不断的迭代，直到求得最优的H矩阵为止。所以在前面使用cv2.findHomography方法时，参数cv2.RANSAC表明使用RANSAC算法来筛选关键点</strong></p> 
<h4><a id="32__139"></a>3.2 代码部分</h4> 
<ol><li><strong>读取图片并创建ORB</strong></li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
image1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">)</span>
image2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'2.png'</span><span class="token punctuation">)</span>
<span class="token comment"># 初始化ORB</span>
orb <span class="token operator">=</span> cv<span class="token punctuation">.</span>ORB_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li><strong>寻找关键点和描述子</strong></li></ol> 
<pre><code class="prism language-python"> <span class="token comment"># 寻找关键点</span>
 kp1 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>img1<span class="token punctuation">)</span>
 kp2 <span class="token operator">=</span> orb<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>img2<span class="token punctuation">)</span>

 <span class="token comment"># 计算描述符</span>
kp1<span class="token punctuation">,</span>des1<span class="token operator">=</span>orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 计算哪张图片的用哪张图片的关键点。</span>
kp2<span class="token punctuation">,</span>des2<span class="token operator">=</span>orb<span class="token punctuation">.</span>detectAndCompute<span class="token punctuation">(</span>img2<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span> 

</code></pre> 
<p>找到了关键点可以画出关键点看一看：</p> 
<pre><code class="prism language-python"><span class="token comment"># 画出关键点</span>
outimg1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>drawKeypoints<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> keypoints<span class="token operator">=</span>kp1<span class="token punctuation">,</span> outImage<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
outimg2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>drawKeypoints<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> keypoints<span class="token operator">=</span>kp2<span class="token punctuation">,</span> outImage<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># 这里是把两张图片在同一个窗口中显示。</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
outimg3 <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>outimg1<span class="token punctuation">,</span> outimg2<span class="token punctuation">]</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Key Points"</span><span class="token punctuation">,</span> outimg3<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/d6/b3/izapC8Dd_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>关键点匹配<br> 有了关键点和描述子，我们就要对这些点进行匹配。这里我们用的是Brute-Force匹配器，它获取第一组中一个特征的描述符，并通过一些距离计算与第二组中的所有其他特征匹配，最接近的一个被返回。</li></ol> 
<pre><code class="prism language-python"> <span class="token comment"># 初始化 BFMatcher</span>
 bf <span class="token operator">=</span> cv<span class="token punctuation">.</span>BFMatcher<span class="token punctuation">(</span>cv<span class="token punctuation">.</span>NORM_HAMMING<span class="token punctuation">)</span>

 <span class="token comment"># 对描述子进行匹配</span>
 matches <span class="token operator">=</span> bf<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>des1<span class="token punctuation">,</span> des2<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>对匹配点进行筛选并画出匹配图</li></ol> 
<pre><code class="prism language-python">good_match<span class="token operator">=</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>mathces<span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>distance<span class="token punctuation">)</span> <span class="token comment">#据距离来排序</span>
result<span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawMatches<span class="token punctuation">(</span>gray_target<span class="token punctuation">,</span>kp1<span class="token punctuation">,</span> gray_template<span class="token punctuation">,</span>kp2<span class="token punctuation">,</span>good_match<span class="token punctuation">,</span>outImg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment">#画出匹配关系</span>
cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'Match Result'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Match Result"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/42/8d/UAKIIRuL_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>计算单应性矩阵 （findHomography函数）</li></ol> 
<p>首先找出target和template中的特征点，然后找到较好的匹配点对good_match(判断good_match是否大于4，至少4个匹配点才能构建矩阵)，最后通过warpPerspective方法对图像target进行投影映射。</p> 
<pre><code class="prism language-python"> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>goodMatch<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">:</span>
       ptsA<span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span>kp1<span class="token punctuation">[</span>m<span class="token punctuation">.</span>queryIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>pt <span class="token keyword">for</span> m <span class="token keyword">in</span> goodMatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
       ptsB <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span>kp2<span class="token punctuation">[</span>m<span class="token punctuation">.</span>trainIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>pt <span class="token keyword">for</span> m <span class="token keyword">in</span> goodMatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
       ransacReprojThreshold <span class="token operator">=</span> <span class="token number">4</span>
       H<span class="token punctuation">,</span> status <span class="token operator">=</span>cv2<span class="token punctuation">.</span>findHomography<span class="token punctuation">(</span>ptsA<span class="token punctuation">,</span>ptsB<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RANSAC<span class="token punctuation">,</span>ransacReprojThreshold<span class="token punctuation">)</span><span class="token punctuation">;</span>
       imgOut <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> H<span class="token punctuation">,</span> <span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_LINEAR <span class="token operator">+</span> cv2<span class="token punctuation">.</span>WARP_INVERSE_MAP<span class="token punctuation">)</span>
</code></pre> 
<p><strong>cv2.warpPerspective（img，H，（img1.shape[1],img1.shape[0])，cv2.INTER_LINEAR + cv2.WARP_INVERSE_MAP）</strong></p> 
<p>第一个参数为需要投影的图像（img2）<br> 第二个参数为单应性矩阵（H）<br> 第三个参数为所得图像的矩阵大小（（img1.shape[1],img1.shape[0]) ）<br> 最后的参数cv2.INTER_LINEAR + cv2.WARP_INVERSE_MAP，为插值时使用的插值方法INTER_LINEAR，cv2.WARP_INVERSE_MAP则将M设置为dst—&gt;src的方向变换。</p> 
<hr> 
<p><font color="red">遇到的问题：<br> kp1求出来的特征点只有两个，构建单应性矩阵最少需要4个，故一直报错</font><br> <img src="https://images2.imgbox.com/23/9a/i6auzqtu_o.png" alt="在这里插入图片描述"><br> 后来查询到ORB产生的特征点在点特征提取算法中最少（详细特征提取算法比对参考Related-8），因此换成了KAZE检测器，产生的特征点很明显增多，匹配显示结果如下：<br> <img src="https://images2.imgbox.com/53/4d/3rEoalpp_o.png" alt="在这里插入图片描述"><br> 最终的透视变换结果如下：<br> <img src="https://images2.imgbox.com/1c/b4/Me4R33z6_o.png" alt="在这里插入图片描述"><br> emmmm…后来发现自己可能不需要透视变换，只需要简单的平移对齐就好，于是改成仿射变换的矩阵</p> 
<hr> 
<h3><a id="Tips_240"></a>Tips</h3> 
<h4><a id="1_plt_opencv_241"></a>1. plt 与opencv相互转换</h4> 
<p><strong>plt转为opencv</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
img<span class="token operator">=</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
<span class="token comment">#PIL转ndarray</span>
img<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
img<span class="token operator">=</span>img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">#show</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#write</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>path<span class="token punctuation">,</span>img<span class="token punctuation">)</span>
</code></pre> 
<p><strong>opencv 转为 plt</strong></p> 
<pre><code class="prism language-python">img<span class="token operator">=</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#img=Image.fromarray(img)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token comment">#show</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#save、dpi为分辨率</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>path<span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2_271"></a>2.仿射变换和透视变换</h4> 
<p>简单写一下：<br> <strong>仿射变换</strong>：线性变换+平移，二维图像----&gt;二维图像</p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/7c/a9/R6P1POBY_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p><strong>透射变换</strong>：线性变换+平移，二维图像----&gt;投影到三维平面-----&gt;转为二维坐标，因此它是空间上的调整，比如图片弯曲</p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/9c/aa/3bcCZCjY_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>区别是：仿射变换是（2x3）的变换矩阵，透射变换是（3x3）的变换矩阵</p> 
<h3><a id="Related_282"></a>Related</h3> 
<p>1.<a href="https://learnopencv.com/image-alignment-ecc-in-opencv-c-python/" rel="nofollow">Image Alignment (ECC) in OpenCV ( C++ / Python )</a><br> 2.<a href="https://blog.csdn.net/qq_61707205/article/details/124620209?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4-124620209-blog-115113180.pc_relevant_antiscanv2&amp;spm=1001.2101.3001.4242.3&amp;utm_relevant_index=7">OpenCV快速入门——图像预处理（必看）</a><br> 3.<a href="https://blog.csdn.net/zhuisui_woxin/article/details/84400439">opencv+python实现图像匹配----模板匹配、特征点匹配</a><br> 4.Nice！！！<a href="https://www.jianshu.com/p/f1b97dacc501" rel="nofollow">Python进行SIFT图像对准</a><br> 5.<a href="https://blog.csdn.net/zengNLP/article/details/106456978?spm=1001.2101.3001.6650.11&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-11-106456978-blog-81000174.pc_relevant_aa&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-11-106456978-blog-81000174.pc_relevant_aa&amp;utm_relevant_index=16">图像对齐（图像配准）方法记录</a><br> 6.<a href="https://blog.csdn.net/amusi1994/article/details/79591205">OpenCV-Python Feature2D 特征点检测(含SIFT/SURF/ORB/KAZE/FAST/BRISK/AKAZE)</a><br> 7.<a href="https://blog.csdn.net/weixin_43852752/article/details/106132738">OpenCV-Python ORB特征匹配（实践篇）</a><br> 8.报错等问题：<br> <a href="https://blog.csdn.net/qq_34122861/article/details/100005575">第6章 特征检测、匹配与搜索 个人笔记</a><br> 9.<a href="https://www.docin.com/p-2627891510.html" rel="nofollow">基于机器视觉的PCB缺陷检测与分类识别</a><br> 10.<a href="https://www.likecs.com/show-202462.html" rel="nofollow">OPENCV特征点提取算法对比</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2d0bbc80a968753d63e0672c6cc02f90/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">git合并分支或者push时，报错：“Please enter a commit message to explain why this merge is necessary,especi”的解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6c71d81edd1c895f35d37a8a03480e2b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SuperMap iDesktop 桌面端扩展开发自定义浮动面板（DockPanel） - 调整浮动面板标签位置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>