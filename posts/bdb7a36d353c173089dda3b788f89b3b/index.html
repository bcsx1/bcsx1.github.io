<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Activiti7工作流 二【Activiti7入门、Activiti7进阶】 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Activiti7工作流 二【Activiti7入门、Activiti7进阶】" />
<meta property="og:description" content="文章目录 六、Activiti7入门6.1 业务流程建模6.1.1 绘制流程图6.1.2 指定任务负责人6.1.3 生成png格式流程图 6.2 部署流程定义6.3 启动流程实例6.4 任务查询6.5 任务处理6.6 添加审批意见6.6 查看历史审批 七、Activiti7进阶7.1 流程定义相关7.1.1 流程定义查询7.1.2 流程资源下载7.1.3 流程定义删除 7.2 流程实例相关7.2.1 什么是流程实例7.2.2 BusinessKey（业务标识）7.2.3 流程定义/实例挂起/激活 7.3 任务分配负责人7.3.1 固定分配7.3.2 UEL表达式分配7.3.3 监听器分配 7.4 流程变量7.4.1 什么是流程变量？7.4.2 流程变量类型7.4.3 流程变量的作用域7.4.4 流程变量的使用方法7.4.5 使用global变量控制流程 7.5 任务候选人7.5.1 设置任务候选人7.5.2 部署&amp;启动流程7.5.3 查询候选人任务7.5.4 领取候选人任务7.5.4 完成任务 7.6 网关7.6.1 排他网关7.6.2 并行网关7.6.3 包含网关 六、Activiti7入门 6.1 业务流程建模 6.1.1 绘制流程图 在resource目录下新建bpmn目录用于存放所有的流程文件 ,在bpmn目录下新建leave.bpmn,内容如下:
6.1.2 指定任务负责人 为每个任务结点指定负责人，如部门经理的审核人是李四。 6.1.3 生成png格式流程图 bpmn文件本质上是xml格式,我们打开看到的是图片格式是因为我们在IDEA中安装了actiBPM的插件.
如果我们把bpmn文件部署到Web环境,那么就只能看到xml信息,无法看到类似上面的图形了.
我们可以再部署之前，根据bpmn文件生成png文件，然后把bpmn和png文件同时部署到Web环境中.如果我们想查看流程图的话，我们就可以通过Activiti把这个png文件读取出来. 接下来我们把bpmn导出为png文件
将leave.bpmn文件重命名为leave.xml文件 右键点击leave.xml文件 --&gt; Diagrams --&gt; Show BPMN Designer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/bdb7a36d353c173089dda3b788f89b3b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-23T14:28:38+08:00" />
<meta property="article:modified_time" content="2023-09-23T14:28:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Activiti7工作流 二【Activiti7入门、Activiti7进阶】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote></blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Activiti7_7" rel="nofollow">六、Activiti7入门</a></li><li><ul><li><a href="#61__9" rel="nofollow">6.1 业务流程建模</a></li><li><ul><li><a href="#611__11" rel="nofollow">6.1.1 绘制流程图</a></li><li><a href="#612__18" rel="nofollow">6.1.2 指定任务负责人</a></li><li><a href="#613_png_24" rel="nofollow">6.1.3 生成png格式流程图</a></li></ul> 
   </li><li><a href="#62__54" rel="nofollow">6.2 部署流程定义</a></li><li><a href="#63__126" rel="nofollow">6.3 启动流程实例</a></li><li><a href="#64__208" rel="nofollow">6.4 任务查询</a></li><li><a href="#65__249" rel="nofollow">6.5 任务处理</a></li><li><a href="#66__356" rel="nofollow">6.6 添加审批意见</a></li><li><a href="#66__393" rel="nofollow">6.6 查看历史审批</a></li></ul> 
  </li><li><a href="#Activiti7_434" rel="nofollow">七、Activiti7进阶</a></li><li><ul><li><a href="#71__436" rel="nofollow">7.1 流程定义相关</a></li><li><ul><li><a href="#711__438" rel="nofollow">7.1.1 流程定义查询</a></li><li><a href="#712__468" rel="nofollow">7.1.2 流程资源下载</a></li><li><a href="#713__509" rel="nofollow">7.1.3 流程定义删除</a></li></ul> 
   </li><li><a href="#72__539" rel="nofollow">7.2 流程实例相关</a></li><li><ul><li><a href="#721__541" rel="nofollow">7.2.1 什么是流程实例</a></li><li><a href="#722_BusinessKey_552" rel="nofollow">7.2.2 BusinessKey（业务标识）</a></li><li><a href="#723__628" rel="nofollow">7.2.3 流程定义/实例挂起/激活</a></li></ul> 
   </li><li><a href="#73__769" rel="nofollow">7.3 任务分配负责人</a></li><li><ul><li><a href="#731__771" rel="nofollow">7.3.1 固定分配</a></li><li><a href="#732_UEL_778" rel="nofollow">7.3.2 UEL表达式分配</a></li><li><a href="#733__819" rel="nofollow">7.3.3 监听器分配</a></li></ul> 
   </li><li><a href="#74__860" rel="nofollow">7.4 流程变量</a></li><li><ul><li><a href="#741__862" rel="nofollow">7.4.1 什么是流程变量？</a></li><li><a href="#742__871" rel="nofollow">7.4.2 流程变量类型</a></li><li><a href="#743__881" rel="nofollow">7.4.3 流程变量的作用域</a></li><li><a href="#744__892" rel="nofollow">7.4.4 流程变量的使用方法</a></li><li><a href="#745_global_908" rel="nofollow">7.4.5 使用global变量控制流程</a></li></ul> 
   </li><li><a href="#75__1027" rel="nofollow">7.5 任务候选人</a></li><li><ul><li><a href="#751__1033" rel="nofollow">7.5.1 设置任务候选人</a></li><li><a href="#752__1046" rel="nofollow">7.5.2 部署&amp;启动流程</a></li><li><a href="#753__1099" rel="nofollow">7.5.3 查询候选人任务</a></li><li><a href="#754__1126" rel="nofollow">7.5.4 领取候选人任务</a></li><li><a href="#754__1143" rel="nofollow">7.5.4 完成任务</a></li></ul> 
   </li><li><a href="#76__1165" rel="nofollow">7.6 网关</a></li><li><ul><li><a href="#761__1167" rel="nofollow">7.6.1 排他网关</a></li><li><a href="#762__1258" rel="nofollow">7.6.2 并行网关</a></li><li><a href="#763__1344" rel="nofollow">7.6.3 包含网关</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="Activiti7_7"></a>六、Activiti7入门</h2> 
<h3><a id="61__9"></a>6.1 业务流程建模</h3> 
<h4><a id="611__11"></a>6.1.1 绘制流程图</h4> 
<p>在<code>resource</code>目录下新建<code>bpmn</code>目录用于存放所有的流程文件 ,在<code>bpmn</code>目录下新建<code>leave.bpmn</code>,内容如下:</p> 
<p><img src="https://images2.imgbox.com/c6/41/4rPug8ef_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="612__18"></a>6.1.2 指定任务负责人</h4> 
<ul><li>为每个任务结点指定负责人，如部门经理的审核人是李四。</li></ul> 
<p><img src="https://images2.imgbox.com/ff/98/ObytbaaT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="613_png_24"></a>6.1.3 生成png格式流程图</h4> 
<p><code>bpmn</code>文件本质上是xml格式,我们打开看到的是图片格式是因为我们在IDEA中安装了actiBPM的插件.</p> 
<p>如果我们把<code>bpmn</code>文件部署到Web环境,那么就只能看到xml信息,无法看到类似上面的图形了.</p> 
<p>我们可以再部署之前，根据<code>bpmn</code>文件生成<code>png</code>文件，然后把<code>bpmn</code>和<code>png</code>文件同时部署到Web环境中.如果我们想查看流程图的话，我们就可以通过Activiti把这个<code>png</code>文件读取出来. 接下来我们把<code>bpmn</code>导出为<code>png</code>文件</p> 
<ul><li>将<code>leave.bpmn</code>文件重命名为<code>leave.xml</code>文件</li></ul> 
<p><img src="https://images2.imgbox.com/5f/cf/AioncREX_o.png" alt="在这里插入图片描述"></p> 
<ul><li>右键点击<code>leave.xml</code>文件 --&gt; <code>Diagrams</code> --&gt; <code>Show BPMN Designer...</code></li></ul> 
<p><img src="https://images2.imgbox.com/69/3f/DIKikskg_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>点击导出按钮,保存在<code>resource/bpmn</code>同级目录下</p> <p><img src="https://images2.imgbox.com/61/04/UwOb2EWC_o.png" alt="在这里插入图片描述"></p> </li><li> <p>导出<code>png</code>之后,把<code>leave.xml</code>更名为<code>leave.bpmn</code></p> </li></ul> 
<p><img src="https://images2.imgbox.com/ea/62/etiT9RqE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="62__54"></a>6.2 部署流程定义</h3> 
<ul><li>使用RepositoryService部署流程定义</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">ProcessEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">ProcessEngines</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">RepositoryService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave.png"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志发现，进行部署会操作如下表.</p> 
<ul><li>ACT_GE_PROPERTY 引擎属性表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">update</span> ACT_GE_PROPERTY <span class="token keyword">SET</span> REV_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> VALUE_ <span class="token operator">=</span> ? <span class="token keyword">where</span> NAME_ <span class="token operator">=</span> ? <span class="token operator">and</span> REV_ <span class="token operator">=</span> ? 

Parameters: <span class="token number">2</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">next</span><span class="token punctuation">.</span>dbid<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_RE_PROCDEF 流程定义表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RE_PROCDEF<span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> KEY_<span class="token punctuation">,</span> VERSION_<span class="token punctuation">,</span> DEPLOYMENT_ID_<span class="token punctuation">,</span> RESOURCE_NAME_<span class="token punctuation">,</span> DGRM_RESOURCE_NAME_<span class="token punctuation">,</span> DESCRIPTION_<span class="token punctuation">,</span> HAS_START_FORM_KEY_<span class="token punctuation">,</span> HAS_GRAPHICAL_NOTATION_ <span class="token punctuation">,</span> SUSPENSION_STATE_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> ENGINE_VERSION_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> http:<span class="token comment">//www.activiti.org/test(String), 请假流程(String), leaveProcess(String), 1(Integer), 1(String), bpmn/leave.bpmn(String), bpmn/leave.png(String), null, false(Boolean), true(Boolean), 1(Integer), (String), null</span>
</code></pre> 
<ul><li>ACT_RE_DEPLOYMENT 流程部署表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RE_DEPLOYMENT<span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> KEY_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> DEPLOY_TIME_<span class="token punctuation">,</span> ENGINE_VERSION_<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">1</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 请假流程<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">11</span>:<span class="token number">01</span>:<span class="token number">44.838</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<ul><li>ACT_GE_BYTEARRAY 二进制资源表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACT_GE_BYTEARRAY<span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> BYTES_<span class="token punctuation">,</span> DEPLOYMENT_ID_<span class="token punctuation">,</span> GENERATED_<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">2</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> bpmn<span class="token operator">/</span><span class="token keyword">leave</span><span class="token punctuation">.</span>png<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ByteArrayInputStream<span class="token variable">@7fe7c640</span><span class="token punctuation">(</span>ByteArrayInputStream<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> bpmn<span class="token operator">/</span><span class="token keyword">leave</span><span class="token punctuation">.</span>bpmn<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ByteArrayInputStream<span class="token variable">@4c4748bf</span><span class="token punctuation">(</span>ByteArrayInputStream<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="63__126"></a>6.3 启动流程实例</h3> 
<ul><li>流程定义部署在Activiti中之后就可以通过工作流管理业务流程了。</li><li>针对该流程，启动一个流程表示发起一个新的请假申请单，这就相当于Java类和Java对象的关系，类定义好之后需要new创建一个对象使用，当然，也可以new多个对象。</li><li>对于请假申请流程，张三发起一个请假申请单需要启动一个流程实例，李四发起一个请求申请单也需要启动一个流程实例。</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//创建ProcessEngine对象</span>
	<span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//获取RuntimeService对象</span>
	<span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
	<span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span>
								<span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//获取流程实例的相关信息</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志发现，启动流程会操作如下表.</p> 
<ul><li>ACT_HI_TASKINST 历史任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_TASKINST <span class="token punctuation">(</span> ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> PARENT_TASK_ID_<span class="token punctuation">,</span> DESCRIPTION_<span class="token punctuation">,</span> OWNER_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> CLAIM_TIME_<span class="token punctuation">,</span> END_TIME_<span class="token punctuation">,</span> DURATION_<span class="token punctuation">,</span> DELETE_REASON_<span class="token punctuation">,</span> TASK_DEF_KEY_<span class="token punctuation">,</span> FORM_KEY_<span class="token punctuation">,</span> PRIORITY_<span class="token punctuation">,</span> DUE_DATE_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> TENANT_ID_ <span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">2505</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 部门经理审批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.827</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> _4<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_PROCINST 历史流程实例表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_PROCINST <span class="token punctuation">(</span> ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> BUSINESS_KEY_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> END_TIME_<span class="token punctuation">,</span> DURATION_<span class="token punctuation">,</span> START_USER_ID_<span class="token punctuation">,</span> START_ACT_ID_<span class="token punctuation">,</span> END_ACT_ID_<span class="token punctuation">,</span> SUPER_PROCESS_INSTANCE_ID_<span class="token punctuation">,</span> DELETE_REASON_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> NAME_ <span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.798</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> _2<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<ul><li>ACT_HI_ACTINST 历史活动信息表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_ACTINST <span class="token punctuation">(</span> ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> ACT_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> CALL_PROC_INST_ID_<span class="token punctuation">,</span> ACT_NAME_<span class="token punctuation">,</span> ACT_TYPE_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> END_TIME_<span class="token punctuation">,</span> DURATION_<span class="token punctuation">,</span> DELETE_REASON_<span class="token punctuation">,</span> TENANT_ID_ <span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">2503</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _2<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> StartEvent<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> startEvent<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.815</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.816</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span>Long<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2504</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _4<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2505</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 部门经理审批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> userTask<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.817</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_IDENTITYLINK 历史身份连接表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_IDENTITYLINK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> TYPE_<span class="token punctuation">,</span> USER_ID_<span class="token punctuation">,</span> GROUP_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">2506</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> participant<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_RU_EXECUTION 运行时执行实例表</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RU_EXECUTION <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> BUSINESS_KEY_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> ACT_ID_<span class="token punctuation">,</span> IS_ACTIVE_<span class="token punctuation">,</span> IS_CONCURRENT_<span class="token punctuation">,</span> IS_SCOPE_<span class="token punctuation">,</span>IS_EVENT_SCOPE_<span class="token punctuation">,</span> IS_MI_ROOT_<span class="token punctuation">,</span> PARENT_ID_<span class="token punctuation">,</span> SUPER_EXEC_<span class="token punctuation">,</span> ROOT_PROC_INST_ID_<span class="token punctuation">,</span> SUSPENSION_STATE_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> START_USER_ID_<span class="token punctuation">,</span> IS_COUNT_ENABLED_<span class="token punctuation">,</span> EVT_SUBSCR_COUNT_<span class="token punctuation">,</span> TASK_COUNT_<span class="token punctuation">,</span> JOB_COUNT_<span class="token punctuation">,</span> TIMER_JOB_COUNT_<span class="token punctuation">,</span> SUSP_JOB_COUNT_<span class="token punctuation">,</span> DEADLETTER_JOB_COUNT_<span class="token punctuation">,</span> VAR_COUNT_<span class="token punctuation">,</span> ID_LINK_COUNT_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.798</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _4<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.813</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_RU_TASK 运行时任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RU_TASK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> PARENT_TASK_ID_<span class="token punctuation">,</span> DESCRIPTION_<span class="token punctuation">,</span> PRIORITY_<span class="token punctuation">,</span> CREATE_TIME_<span class="token punctuation">,</span> OWNER_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> DELEGATION_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> TASK_DEF_KEY_<span class="token punctuation">,</span> DUE_DATE_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> SUSPENSION_STATE_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> FORM_KEY_<span class="token punctuation">,</span> CLAIM_TIME_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">2505</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 部门经理审批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">34</span>:<span class="token number">52.817</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _4<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<ul><li>ACT_RU_IDENTITYLINK 运行时身份连接表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RU_IDENTITYLINK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> TYPE_<span class="token punctuation">,</span> USER_ID_<span class="token punctuation">,</span> GROUP_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">2506</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> participant<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<h3><a id="64__208"></a>6.4 任务查询</h3> 
<ul><li>流程启动后，各个任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectTodoTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务名称 = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志发现，查询任务会操作如下表.</p> 
<ul><li>ACT_RU_TASK 运行时任务表</li><li>ACT_RE_PROCDEF 流程定义表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">select</span> <span class="token keyword">distinct</span> RES<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> ACT_RU_TASK RES <span class="token keyword">inner</span> <span class="token keyword">join</span> ACT_RE_PROCDEF D <span class="token keyword">on</span> RES<span class="token punctuation">.</span>PROC_DEF_ID_ <span class="token operator">=</span> D<span class="token punctuation">.</span>ID_ <span class="token keyword">WHERE</span> RES<span class="token punctuation">.</span>ASSIGNEE_ <span class="token operator">=</span> ? <span class="token operator">and</span> D<span class="token punctuation">.</span>KEY_ <span class="token operator">=</span> ? <span class="token keyword">order</span> <span class="token keyword">by</span> RES<span class="token punctuation">.</span>ID_ <span class="token keyword">asc</span> <span class="token keyword">LIMIT</span> ? <span class="token keyword">OFFSET</span> ? 

Parameters: 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2147483647</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="65__249"></a>6.5 任务处理</h3> 
<ul><li>任务负责人查询待办任务，选择任务进行处理，完成任务。</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志发现，查询任务会操作如下表.</p> 
<ul><li>ACT_GE_PROPERTY 引擎属性表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">update</span> ACT_GE_PROPERTY <span class="token keyword">SET</span> REV_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> VALUE_ <span class="token operator">=</span> ? <span class="token keyword">where</span> NAME_ <span class="token operator">=</span> ? <span class="token operator">and</span> REV_ <span class="token operator">=</span> ? 

Parameters: <span class="token number">4</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">next</span><span class="token punctuation">.</span>dbid<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_TASKINST 历史任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_TASKINST <span class="token punctuation">(</span> ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> PARENT_TASK_ID_<span class="token punctuation">,</span> DESCRIPTION_<span class="token punctuation">,</span> OWNER_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> CLAIM_TIME_<span class="token punctuation">,</span> END_TIME_<span class="token punctuation">,</span> DURATION_<span class="token punctuation">,</span> DELETE_REASON_<span class="token punctuation">,</span> TASK_DEF_KEY_<span class="token punctuation">,</span> FORM_KEY_<span class="token punctuation">,</span> PRIORITY_<span class="token punctuation">,</span> DUE_DATE_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> TENANT_ID_ <span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">5002</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 人事复批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 王五<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">39</span>:<span class="token number">19.036</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> _5<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_ACTINST 历史活动信息表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_ACTINST <span class="token punctuation">(</span> ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> ACT_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> CALL_PROC_INST_ID_<span class="token punctuation">,</span> ACT_NAME_<span class="token punctuation">,</span> ACT_TYPE_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> START_TIME_<span class="token punctuation">,</span> END_TIME_<span class="token punctuation">,</span> DURATION_<span class="token punctuation">,</span> DELETE_REASON_<span class="token punctuation">,</span> TENANT_ID_ <span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">5001</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _5<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5002</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 人事复批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> userTask<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 王五<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">39</span>:<span class="token number">19.025</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_IDENTITYLINK 历史身份连接表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_IDENTITYLINK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> TYPE_<span class="token punctuation">,</span> USER_ID_<span class="token punctuation">,</span> GROUP_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">5003</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> participant<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 王五<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_RU_TASK 运行时任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RU_TASK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> NAME_<span class="token punctuation">,</span> PARENT_TASK_ID_<span class="token punctuation">,</span> DESCRIPTION_<span class="token punctuation">,</span> PRIORITY_<span class="token punctuation">,</span> CREATE_TIME_<span class="token punctuation">,</span> OWNER_<span class="token punctuation">,</span> ASSIGNEE_<span class="token punctuation">,</span> DELEGATION_<span class="token punctuation">,</span> EXECUTION_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">,</span> TASK_DEF_KEY_<span class="token punctuation">,</span> DUE_DATE_<span class="token punctuation">,</span> CATEGORY_<span class="token punctuation">,</span> SUSPENSION_STATE_<span class="token punctuation">,</span> TENANT_ID_<span class="token punctuation">,</span> FORM_KEY_<span class="token punctuation">,</span> CLAIM_TIME_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ? <span class="token punctuation">)</span> 

Parameters: <span class="token number">5002</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 人事复批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">39</span>:<span class="token number">19.025</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 王五<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _5<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<ul><li>ACT_RU_IDENTITYLINK 运行时身份连接表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_RU_IDENTITYLINK <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> REV_<span class="token punctuation">,</span> TYPE_<span class="token punctuation">,</span> USER_ID_<span class="token punctuation">,</span> GROUP_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> PROC_DEF_ID_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">5003</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> participant<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 王五<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span>
</code></pre> 
<ul><li>ACT_RU_EXECUTION 运行时执行实例表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">update</span> ACT_RU_EXECUTION <span class="token keyword">set</span> REV_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> BUSINESS_KEY_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> PROC_DEF_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> ACT_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_ACTIVE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_CONCURRENT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_SCOPE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_EVENT_SCOPE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_MI_ROOT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> PARENT_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> SUPER_EXEC_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> ROOT_PROC_INST_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> SUSPENSION_STATE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> NAME_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> IS_COUNT_ENABLED_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> EVT_SUBSCR_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> TASK_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> JOB_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> TIMER_JOB_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> SUSP_JOB_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DEADLETTER_JOB_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> VAR_COUNT_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> ID_LINK_COUNT_ <span class="token operator">=</span> ? <span class="token keyword">where</span> ID_ <span class="token operator">=</span> ? <span class="token operator">and</span> REV_ <span class="token operator">=</span> ? 

Parameters: <span class="token number">2</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> _5<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">(</span><span class="token keyword">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_TASKINST 历史任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">update</span> ACT_HI_TASKINST <span class="token keyword">set</span> PROC_DEF_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> EXECUTION_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> NAME_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> PARENT_TASK_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DESCRIPTION_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> OWNER_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> ASSIGNEE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> CLAIM_TIME_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> END_TIME_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DURATION_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DELETE_REASON_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> TASK_DEF_KEY_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> FORM_KEY_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> PRIORITY_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DUE_DATE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> CATEGORY_ <span class="token operator">=</span> ? <span class="token keyword">where</span> ID_ <span class="token operator">=</span> ? 

Parameters: leaveProcess:<span class="token number">1</span>:<span class="token number">4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 部门经理审批<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">39</span>:<span class="token number">18.995</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">266168</span><span class="token punctuation">(</span>Long<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> _4<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2505</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_HI_TASKINST 历史任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">update</span> ACT_HI_ACTINST <span class="token keyword">set</span> EXECUTION_ID_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> ASSIGNEE_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> END_TIME_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DURATION_ <span class="token operator">=</span> ?<span class="token punctuation">,</span> DELETE_REASON_ <span class="token operator">=</span> ? <span class="token keyword">where</span> ID_ <span class="token operator">=</span> ? 

Parameters: <span class="token number">2502</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 李四<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">39</span>:<span class="token number">19.009</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">266192</span><span class="token punctuation">(</span>Long<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2504</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
</code></pre> 
<ul><li>ACT_RU_TASK 运行时任务表</li></ul> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">delete</span> <span class="token keyword">from</span> ACT_RU_TASK <span class="token keyword">where</span> ID_ <span class="token operator">=</span> ? <span class="token operator">and</span> REV_ <span class="token operator">=</span> ? 

Parameters: <span class="token number">2505</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="66__356"></a>6.6 添加审批意见</h3> 
<ul><li>在执行任务之前可以给该任务添加审批意见,会存储在历史表中,我们后续可以审批历史中查看到该意见</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"王五"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//在任务执行之前任务添加批注信息</span>
        taskService<span class="token punctuation">.</span><span class="token function">addComment</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"审批通过"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志发现，其余操作和任务处理的表是一致的，但是添加批注会往如下表中插入记录:</p> 
<pre><code class="prism language-sql">Preparing: <span class="token keyword">insert</span> <span class="token keyword">into</span> ACT_HI_COMMENT <span class="token punctuation">(</span>ID_<span class="token punctuation">,</span> TYPE_<span class="token punctuation">,</span> TIME_<span class="token punctuation">,</span> USER_ID_<span class="token punctuation">,</span> TASK_ID_<span class="token punctuation">,</span> PROC_INST_ID_<span class="token punctuation">,</span> ACTION_<span class="token punctuation">,</span> MESSAGE_<span class="token punctuation">,</span> FULL_MSG_<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span> 

Parameters: <span class="token number">7501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">comment</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">16</span>:<span class="token number">43</span>:<span class="token number">09.13</span><span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">5002</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2501</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> AddComment<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> 人事复批审批通过<span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ByteArrayInputStream<span class="token variable">@1b765a2c</span><span class="token punctuation">(</span>ByteArrayInputStream<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="66__393"></a>6.6 查看历史审批</h3> 
<ul><li>用户可以查看历史审批记录</li></ul> 
<pre><code class="prism language-JAVA">@Test
public void testSelectHistoryTask(){
    //流程实例ID
    String processInstanceId = "2501";
    //任务审核人
    String taskAssignee = "王五";
    //创建ProcessEngine对象
    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();
    //获取historyService
    HistoryService historyService = processEngine.getHistoryService();
    //获取taskService
    TaskService taskService = processEngine.getTaskService();
    //获取历史审核信息
    List&lt;HistoricActivityInstance&gt; list = historyService
            .createHistoricActivityInstanceQuery()
            .activityType("userTask")//只获取用户任务
            .processInstanceId(processInstanceId)
            .taskAssignee(taskAssignee)
            .finished()
            .list();
    for(HistoricActivityInstance instance:list){
        System.out.println("任务名称:"+instance.getActivityName());
        System.out.println("任务开始时间:"+instance.getStartTime());
        System.out.println("任务结束时间:"+instance.getEndTime());
        System.out.println("任务耗时:"+instance.getDurationInMillis());
        //获取审核批注信息
        List&lt;Comment&gt; taskComments = taskService.getTaskComments(instance.getTaskId());
        if(taskComments.size()&gt;0){
            System.out.println("审批批注:"+taskComments.get(0).getFullMessage());
        }
    }
}
</code></pre> 
<h2><a id="Activiti7_434"></a>七、Activiti7进阶</h2> 
<h3><a id="71__436"></a>7.1 流程定义相关</h3> 
<h4><a id="711__438"></a>7.1.1 流程定义查询</h4> 
<ul><li>查询流程相关信息，包含流程定义，流程部署，流程定义版本</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取仓库服务</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取流程定义集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> processDefinitionList <span class="token operator">=</span> repositoryService
            <span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历集合</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> definition<span class="token operator">:</span>processDefinitionList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义ID:"</span><span class="token operator">+</span>definition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义名称:"</span><span class="token operator">+</span>definition<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义key:"</span><span class="token operator">+</span>definition<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义版本:"</span><span class="token operator">+</span>definition<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>definition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="712__468"></a>7.1.2 流程资源下载</h4> 
<ul><li> <p>现在我们的流程资源文件已经上传到数据库了，如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载到本地。</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDownloadResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取仓库服务</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取流程定义集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService
            <span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//按照版本排序</span>
            <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//降序</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取最新那个</span>
    <span class="token class-name">ProcessDefinition</span> definition <span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取部署ID</span>
    <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> definition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取bpmn的输入流</span>
    <span class="token class-name">InputStream</span> bpmnInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>
                                        deploymentId<span class="token punctuation">,</span>
                                        definition<span class="token punctuation">.</span><span class="token function">getResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取png的输入流</span>
    <span class="token class-name">InputStream</span> pngInput <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>
                                        deploymentId<span class="token punctuation">,</span>
                                        definition<span class="token punctuation">.</span><span class="token function">getDiagramResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置bpmn输入</span>
    <span class="token class-name">FileOutputStream</span> bpmnOutPut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"D:/leave.bpmn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置png输入</span>
    <span class="token class-name">FileOutputStream</span> pngOutPut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"D:/leave.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bpmnInput<span class="token punctuation">,</span>bpmnOutPut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>pngInput<span class="token punctuation">,</span>pngOutPut<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h4><a id="713__509"></a>7.1.3 流程定义删除</h4> 
<ul><li>根据部署Id删除对应的流程定义</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//流程部署Id</span>
    <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> <span class="token string">"10001"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取仓库服务</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span>
    repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span>
    <span class="token comment">//repositoryService.deleteDeployment(deploymentId,true);</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>说明：</p> 
<ol><li> <p>如果该流程定义下没有正在运行的流程，则可以用普通删除。</p> </li><li> <p>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。</p> </li><li> <p>项目开发中级联删除操作一般只开放给超级管理员使用.</p> </li></ol> 
<h3><a id="72__539"></a>7.2 流程实例相关</h3> 
<h4><a id="721__541"></a>7.2.1 什么是流程实例</h4> 
<p>用户或程序按照流程定义内容发起一个流程，这就是一个流程实例。</p> 
<p>流程定义和流程实例的图解：</p> 
<p><img src="https://images2.imgbox.com/6d/23/C4017HcZ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="722_BusinessKey_552"></a>7.2.2 BusinessKey（业务标识）</h4> 
<ol><li>小张要在5.1~5.10这段时间请假,请假理由为:回家相亲.</li><li>小陈要在5.5~5.15这段时间请假,请假理由为:家里拆迁,回家办手续.</li></ol> 
<p>请问会创建几个流程实例?</p> 
<p>流程发起之后，目前设定的部门审批人都是李四，李四在审批之前需要看到申请人申请的时间和申请的理由，才能决定是否同意.</p> 
<p>那么申请人的请假信息【请假时间、请假理由】是如何绑定到流程中的呢?</p> 
<p>此时就需要使用到<code>BusinessKey</code></p> 
<ul><li>启动流程实例时，指定的businessKey，就会在act_run_execution表中存储businessKey。</li><li>BusinessKey：业务标识，通常为业务表的主键，业务标识和流程实例一一对应。业务标识来源于业务系统。存储业务标识就是根据业务标识来关联查询业务系统的数据。比如：请假流程启动一个流程实例，就可以将请假单的id作为业务标识存储到Activiti中，将来查询Activiti的流程实例信息就可以获取请假单的id从而关联查询业务系统数据库得到请假单信息。</li></ul> 
<p><img src="https://images2.imgbox.com/04/92/tKhd2O0H_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> businessKey <span class="token operator">=</span> <span class="token string">"8001"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RuntimeService对象</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
    <span class="token comment">//在启动流程的时候将业务key加入进去</span>
    <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService
            <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">,</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取流程实例的相关信息</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察数据库可以发现，在activiti的act_ru_execution表，字段BUSINESS_KEY就是存放业务KEY的。</p> 
<p><img src="https://images2.imgbox.com/43/17/lntO9HyH_o.png" alt="在这里插入图片描述"></p> 
<ul><li>在用户执行任务的时候如何获取<code>BusinessKey</code>并关联对应的业务信息呢?</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RuntimeService</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务名称 = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据任务上的流程实例Id查询出对应的流程实例对象，从流程实例对象中获取BusinessKey</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"业务key:"</span><span class="token operator">+</span>instance<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="723__628"></a>7.2.3 流程定义/实例挂起/激活</h4> 
<p><strong>全部流程实例挂起场景</strong>:</p> 
<ol><li> <p>例如公司制度改变过程中的流程, 总经理更换过程中的流程，有100个人的流程, 70个人已经完成,30个人流程正好在总经理更换中,就需要挂起.</p> </li><li> <p>比如我们的业务流程为:</p> </li></ol> 
<p>【开始节点】–&gt;【A节点】–&gt;【B节点】–&gt;【C节点】–&gt;【结束节点】</p> 
<p>【C节点】的业务逻辑需要和外部接口交互，刚好外部接口出问题了,如果剩下的流程都走到【C节点】，执行【C节点】的业务逻辑，那都会报错，我们就可以把流程挂起，等待外部接口可用之后再重新激活流程.</p> 
<ol start="3"><li>业务流程发生改变,已经发起的流程实例继续按照旧的流程走,如果新发起的流程就按照新的业务流程走.这时候我们就需要挂起流程定义,但是不挂起流程实例.</li></ol> 
<ul><li>操作流程定义为挂起状态，该操作定义下面的所有的流程实例将全部暂停。</li><li>流程定义为挂起状态，该流程定义下将不允许启动新的流程实例，同时该流程定义下的所有流程实例将全部挂起暂停执行</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSuspendAllProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RepositoryService</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取流程定义对象</span>
    <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService
            <span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> suspended <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出流程定义状态</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义状态:"</span><span class="token operator">+</span><span class="token punctuation">(</span>suspended <span class="token operator">?</span><span class="token string">"已挂起"</span><span class="token operator">:</span><span class="token string">"已激活"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> processDefinitionId <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>suspended<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//如果是挂起，可以执行激活操作 ,参数1 ：流程定义id ，参数2：是否激活流程实例，参数3：激活时间</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>processDefinitionId<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程ID:"</span><span class="token operator">+</span>processDefinitionId<span class="token operator">+</span><span class="token string">",已激活"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//如果是激活，可以执行挂起操作 ,参数1 ：流程定义id ，参数2：是否暂停流程实例，参数3：激活时间</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span>processDefinitionId<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程ID:"</span><span class="token operator">+</span>processDefinitionId<span class="token operator">+</span><span class="token string">",已挂起"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>查询待办任务的状态,如果是【已挂起】,前台则不允许点击【任务处理】按钮</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSuspendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务名称 = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务状态:"</span><span class="token operator">+</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">"已挂起"</span><span class="token operator">:</span><span class="token string">"已激活"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>利用之前的测试用例，测试在流程挂起的情况是否能发起新的流程实例</p> <pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span>ActivitiException</span><span class="token operator">:</span> <span class="token class-name">Cannot</span> start process <span class="token class-name"><span class="token namespace">instance<span class="token punctuation">.</span></span> Process</span> definition 请假流程 <span class="token punctuation">(</span>id <span class="token operator">=</span> leaveProcess<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span> is suspended
</code></pre> </li><li> <p>利用之前的测试用例，测试在流程挂起的情况是否可以处理任务</p> <pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span>ActivitiException</span><span class="token operator">:</span> <span class="token class-name">Cannot</span> complete a suspended task
</code></pre> </li></ul> 
<p><strong>单个流程实例挂起场景</strong></p> 
<p>评分流程：可设置多级评分，评分流程会按照从上往下的顺序，依次评分；评分人必须在评分截至时间内完成评分，否则不允许继续评分，流程将会挂起，停止流转；</p> 
<ul><li>操作流程实例对象，针对单个流程执行挂起操作，某个流程实例挂起则此流程不再执行，完成该流程实例的当前任务将报异常。</li></ul> 
<p>查询所有的流程实例</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RepositoryService</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessInstance</span><span class="token punctuation">&gt;</span></span> processInstanceList <span class="token operator">=</span> runtimeService
            <span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessInstance</span> processInstance<span class="token operator">:</span>processInstanceList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例Id:"</span><span class="token operator">+</span>processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">",状态:"</span><span class="token operator">+</span><span class="token punctuation">(</span>processInstance<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">"已挂起"</span><span class="token operator">:</span><span class="token string">"已激活"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>挂起某个流程实例</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSuspendSingleProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//流程实例Id</span>
    <span class="token class-name">String</span> processInstanceId <span class="token operator">=</span> <span class="token string">"2501"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RepositoryService</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据流程实例Id获取流程实例对象</span>
    <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
            <span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//状态</span>
    <span class="token keyword">boolean</span> suspended <span class="token operator">=</span> processInstance<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例ID:"</span><span class="token operator">+</span>processInstanceId<span class="token operator">+</span><span class="token string">",状态:"</span><span class="token operator">+</span> <span class="token punctuation">(</span>suspended<span class="token operator">?</span><span class="token string">"已挂起"</span><span class="token operator">:</span><span class="token string">"已激活"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>suspended<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        runtimeService<span class="token punctuation">.</span><span class="token function">activateProcessInstanceById</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例ID:"</span><span class="token operator">+</span>processInstanceId<span class="token operator">+</span><span class="token string">",状态修改为已激活"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        runtimeService<span class="token punctuation">.</span><span class="token function">suspendProcessInstanceById</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例ID:"</span><span class="token operator">+</span>processInstanceId<span class="token operator">+</span><span class="token string">",状态修改为已挂起"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="73__769"></a>7.3 任务分配负责人</h3> 
<h4><a id="731__771"></a>7.3.1 固定分配</h4> 
<ul><li> <p>在进行业务流程建模的时候指定固定的任务负责人。</p> <p><img src="https://images2.imgbox.com/bf/68/8YdyYkqc_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h4><a id="732_UEL_778"></a>7.3.2 UEL表达式分配</h4> 
<p>Activiti 使用 UEL 表达式， UEL 是 java EE6 规范的一部分， UEL（Unified Expression Language）即 统一表达式语言。</p> 
<p><img src="https://images2.imgbox.com/a2/6e/73H6R3Wq_o.png" alt="在这里插入图片描述"></p> 
<p>IDEA中的actiBPM插件在修改Assignee存在bug,在界面上修改了,但是实际文件并没有修改.所以我们需要借助编辑工具在xml文件中修改一下Assignee</p> 
<p><img src="https://images2.imgbox.com/f3/f6/tz1iuOJ4_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>修改流程定义之后重新进行部署</p> </li><li> <p>编写代码配置负责人</p> </li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取RuntimeService对象</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee0"</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee1"</span><span class="token punctuation">,</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
    <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService
            <span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveProcess"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取流程实例的相关信息</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行成功后，可以在act_ru_variable表中看到刚才map中的数据</p> 
<p><img src="https://images2.imgbox.com/4a/0b/hvS2Wfor_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="733__819"></a>7.3.3 监听器分配</h4> 
<ul><li>任务监听器是发生对应的任务相关事件时执行自定义的Java逻辑或表达式。</li><li>任务相关事件包括： 
  <ul><li>Event： 
    <ul><li>Create：任务创建后触发。</li><li>Assignment：任务分配后触发。</li><li>Delete：任务完成后触发。</li><li>All：所有事件发生都触发。</li></ul> </li></ul> </li></ul> 
<ol><li> <p>自定义一个任务监听器类，然后此类必须实现org.activiti.engine.delegate.TaskListener接口</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>delegate<span class="token punctuation">.</span></span><span class="token class-name">DelegateTask</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>delegate<span class="token punctuation">.</span></span><span class="token class-name">TaskListener</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AssigneeTaskListener</span> <span class="token keyword">implements</span> <span class="token class-name">TaskListener</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">DelegateTask</span> delegateTask<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>delegateTask<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"部门经理审批"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            delegateTask<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span><span class="token string">"赵六"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>delegateTask<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"部门经理审批"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            delegateTask<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span><span class="token string">"孙七"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>在bpmn文件中配置监听器</p> <p><img src="https://images2.imgbox.com/df/8e/BrYfCa7R_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<ul><li>在实际开发中，一般也不使用监听器分配方式，太麻烦了。</li></ul> 
<h3><a id="74__860"></a>7.4 流程变量</h3> 
<h4><a id="741__862"></a>7.4.1 什么是流程变量？</h4> 
<ul><li>流程变量在Activiti中是一个非常重要的角色，流程运转有时需要靠流程变量，业务系统和Activiti结合时少不了流程变量，流程变量就是Activiti在管理工作流时根据管理需要而设置的变量。</li><li>比如在请假流程流转时如果请假天数&gt;3天则有总经理审批，否则由人事直接审批，请假天数就可以设置流程变量，在流程流转时使用。</li></ul> 
<pre><code>注意：虽然流程变量中可以存储业务数据，可以通过Activiti的API查询流程变量从而实现查询业务数据，但是不建议这么使用，因为业务数据查询由业务系统负责，Activiti设置流程变量是为了流程执行需要而创建的。
</code></pre> 
<h4><a id="742__871"></a>7.4.2 流程变量类型</h4> 
<p><img src="https://images2.imgbox.com/d7/66/p5sO57mw_o.png" alt="在这里插入图片描述"></p> 
<pre><code>注意：
如果将POJO存储到流程变量中，必须实现序列化接口Serializable，为了防止由于新增字段无法反序列化。
</code></pre> 
<h4><a id="743__881"></a>7.4.3 流程变量的作用域</h4> 
<p>流程变量的作用域范围可以是一个流程实例（ProcessInstance）、一个任务（Task）或一个执行实例（Execution）。</p> 
<ul><li>global变量: 流程变量的作用域范围的默认值是流程实例，作用域范围最大。</li><li>local变量 : 流程变量的作用域范围如果仅仅针对一个任务或一个执行实例，那么作用域范围没有流程实例大</li></ul> 
<pre><code>实际开发中一般不用local变量，了解即可.
</code></pre> 
<h4><a id="744__892"></a>7.4.4 流程变量的使用方法</h4> 
<ul><li> <p>在属性上使用UEL表达式</p> <p>可以在 assignee 处设置 UEL 表达式，表达式的值为任务的负责人，比如： ${assignee}， assignee 就是一个流程变量名称。</p> <p>Activiti获取UEL表达式的值，即流程变量assignee的值 ，将assignee的值作为任务的负责人进行任务分配</p> </li><li> <p>在连线上使用UEL表达式</p> <p>可以在连线上设置UEL表达式，决定流程走向。</p> <p>比如：${price&lt;10000} 。price就是一个流程变量名称，uel表达式结果类型为布尔类型。</p> <p>如果UEL表达式是true，要决定 流程执行走向。</p> </li></ul> 
<h4><a id="745_global_908"></a>7.4.5 使用global变量控制流程</h4> 
<p>需求:员工创建请假流程申请单，由部门经理审批，部门经理审批通过后请假3天以下(含3天)的由人事经理直接审批，3天以上的由总经理审批，总经理审批通过再通过人事经理审批。</p> 
<p><img src="https://images2.imgbox.com/86/72/QHonvw8V_o.png" alt="在这里插入图片描述"></p> 
<ul><li>在连线处添加判断条件</li></ul> 
<p><img src="https://images2.imgbox.com/76/67/HpzF0cra_o.png" alt="在这里插入图片描述"></p> 
<pre><code>本次画BPMN文件的时候将部门经理的assignee设置为李四，总经理审批的assignee设置为王五，总经理审批的assignee设置为王五，人事复批存档设置为赵六。
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VariablesTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 部署
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave-variables.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RuntimeService对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"day"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveVariablesProcess"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程实例的相关信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectTodoTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取任务集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveVariablesProcess"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历任务列表</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务名称 = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取任务集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveVariablesProcess"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历任务列表</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>注意事项</strong>:</p> 
<pre><code>1.如果UEL表达式中流程变量名不存在则报错。
2.如果如果UEL表达式都不符合条件,流程报错。
3.如果连接不设置条件/条件都满足,每个连线都会走.
</code></pre> 
<h3><a id="75__1027"></a>7.5 任务候选人</h3> 
<p>在流程定义中在任务结点的 assignee 固定设置任务负责人，在流程定义时将参与者固定设置在.bpmn 文件中，如果临时任务负责人变更则需要修改流程定义，系统可扩展性差。</p> 
<p>针对这种情况可以给任务设置多个候选人，可以从候选人中选择参与者来完成任务。</p> 
<h4><a id="751__1033"></a>7.5.1 设置任务候选人</h4> 
<ul><li> <p>在流程图中任务节点的配置中设置 candidate-users(候选人)，多个候选人之间用逗号分开。<br> <img src="https://images2.imgbox.com/e7/0c/VREVtcdo_o.png" alt="在这里插入图片描述"></p> </li><li> <p>查看bpmn文件</p> <p><img src="https://images2.imgbox.com/fa/04/pEzYTwEM_o.png" alt="在这里插入图片描述"></p> </li><li> <p>我们可以看到部门经理的审核人已经设置为 lisi,wangwu 这样的一组候选人，可以使用activiti:candiateUsers=”用户 1,用户 2,用户 3”的这种方式来实现设置一组候选人</p> </li></ul> 
<h4><a id="752__1046"></a>7.5.2 部署&amp;启动流程</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CandidateTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 部署
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave-candidate.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程-候选人"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//启动流程</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RuntimeService对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveCandidateProcess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程实例的相关信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="753__1099"></a>7.5.3 查询候选人任务</h4> 
<pre><code class="prism language-java"><span class="token comment">//查询候选任务</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectCandidateTaskList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务负责人</span>
    <span class="token class-name">String</span> candidateUser <span class="token operator">=</span> <span class="token string">"李四"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取任务集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveCandidateProcess"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskCandidateUser</span><span class="token punctuation">(</span>candidateUser<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历任务列表</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务id = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"任务名称 = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="754__1126"></a>7.5.4 领取候选人任务</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testClaimTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务ID</span>
    <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">"2505"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//领取任务</span>
    taskService<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span>assignee<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="754__1143"></a>7.5.4 完成任务</h4> 
<p>如果候选任务没有进行领取就直接完成的话，那么在历史记录中就不会记录是哪个用户执行了这个任务.</p> 
<p>所以对于这种候选人的任务，我们需要先领取再完成.</p> 
<pre><code class="prism language-java"><span class="token comment">//执行任务</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//任务ID</span>
    <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">"2505"</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ProcessEngine对象</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取TaskService</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="76__1165"></a>7.6 网关</h3> 
<h4><a id="761__1167"></a>7.6.1 排他网关</h4> 
<p>排他网关(ExclusiveGateway)（异或网关或基于数据的排他网关），用来在流程中实现决策。当流程执行到这个网关的时候，所有分支都会判断条件是否为true，如果为true则执行该分支。</p> 
<pre><code>注意：
排他网关只会选择一个为true的分支执行（即使有两个分支条件都为true，排他网关也只会选择一条分支去执行,选择序号小的路径执行）。
</code></pre> 
<p><img src="https://images2.imgbox.com/41/0b/nT8TxIhm_o.png" alt="在这里插入图片描述"></p> 
<pre><code>本次画BPMN文件的时候将部门经理的assignee设置为李四，总经理审批的assignee设置为王五，总经理审批的assignee设置为王五，人事复批存档设置为赵六。
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EGatewayTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 部署
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave-EGateway.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程-排他网关"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RuntimeService对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"day"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveEGatewayProcess"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程实例的相关信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取任务集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveEGatewayProcess"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历任务列表</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="762__1258"></a>7.6.2 并行网关</h4> 
<p>并行网关(InclusiveGateway)允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出的顺序流的。</p> 
<pre><code>并行网关不会解析条件。即使顺序流中定义了条件，也会被忽略
</code></pre> 
<p><img src="https://images2.imgbox.com/53/2b/WZcXsXyJ_o.png" alt="在这里插入图片描述"></p> 
<pre><code>本次画BPMN文件的时候将技术经理的assignee设置为李四，项目经理审批的assignee设置为王五，人事复批的assignee设置为王五
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PGatewayTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 部署
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave-PGateway.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程-并行网关"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RuntimeService对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leavePGatewayProcess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程实例的相关信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//完成任务</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取任务集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leavePGatewayProcess"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历任务列表</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="763__1344"></a>7.6.3 包含网关</h4> 
<p>包含网关可以看做是排他网关和并行网关的结合体。</p> 
<p>需求:出差申请大于3天需要由项目经理审批，小于3等于天由技术经理审批，出差申请必须经过人事助理审批。</p> 
<p><img src="https://images2.imgbox.com/c9/c7/BrpOADci_o.png" alt="在这里插入图片描述"></p> 
<pre><code>本次画BPMN文件的时候将技术经理的assignee设置为张三，项目经理的assignee设置为李四，人事助理的assignee设置为王五，人事复批存档设置为赵六。
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>wolfcode<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>task<span class="token punctuation">.</span></span><span class="token class-name">Task</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Created by wolfcode
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IGatewayTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 部署
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RepositoryService对象</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//进行部署</span>
        <span class="token class-name">Deployment</span> deployment <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"bpmn/leave-IGateway.bpmn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"请假流程-包含网关"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出部署的一些信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署ID:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程部署名称:"</span><span class="token operator">+</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取RuntimeService对象</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"day"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//根据流程定义的key启动流程实例,这个key是在定义bpmn的时候设置的</span>
        <span class="token class-name">ProcessInstance</span> instance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">"leaveIGatewayProcess"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程实例的相关信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程定义的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"流程实例的id = "</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//完成任务</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCompleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//任务负责人</span>
        <span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">"王五"</span><span class="token punctuation">;</span>
        <span class="token comment">//创建ProcessEngine对象</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取TaskService</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取任务集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">"leaveIGatewayProcess"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历任务列表</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskList<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/595d71c17b5219c688bc81514487121d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Activiti7工作流 一【工作流介绍、什么是Activiti7？、Activiti7环境、集成Activiti7、流程引擎API】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/700119a545129376ac193e34c9c930ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">webrtc代码下载编译</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>