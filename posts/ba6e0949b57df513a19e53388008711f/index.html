<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python-OpenCV 处理视频（三）（四）（五）： 标记运动轨迹 运动检测 运动方向判断 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python-OpenCV 处理视频（三）（四）（五）： 标记运动轨迹 运动检测 运动方向判断" />
<meta property="og:description" content="0x00. 光流 光流是进行视频中运动对象轨迹标记的一种很常用的方法，在OpenCV中实现光流也很容易。
CalcOpticalFlowPyrLK 函数计算一个稀疏特征集的光流，使用金字塔中的迭代 Lucas-Kanade 方法。
简单的实现流程：
加载一段视频。
调用GoodFeaturesToTrack函数寻找兴趣点。
调用CalcOpticalFlowPyrLK函数计算出两帧图像中兴趣点的移动情况。
删除未移动的兴趣点。
在两次移动的点之间绘制一条线段。
代码示例：
import cv2.cv as cv capture = cv.CaptureFromFile(&#39;img/myvideo.avi&#39;) nbFrames = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_COUNT)) fps = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FPS) wait = int(1/fps * 1000/1) width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH)) height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT)) prev_gray = cv.CreateImage((width,height), 8, 1) #Will hold the frame at t-1 gray = cv.CreateImage((width,height), 8, 1) # Will hold the current frame prevPyr = cv.CreateImage((height / 3, width &#43; 8), 8, cv." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ba6e0949b57df513a19e53388008711f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-04T19:04:46+08:00" />
<meta property="article:modified_time" content="2016-05-04T19:04:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python-OpenCV 处理视频（三）（四）（五）： 标记运动轨迹 运动检测 运动方向判断</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 id="articleHeader0" style="font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-weight:500; line-height:1.2; color:rgb(51,51,51); margin:0px; font-size:1.5em"> 0x00. 光流</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 光流是进行视频中运动对象轨迹标记的一种很常用的方法，在OpenCV中实现光流也很容易。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> <code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">CalcOpticalFlowPyrLK</code> 函数计算一个稀疏特征集的光流，使用金字塔中的迭代 Lucas-Kanade 方法。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 简单的实现流程：</p> 
<ol style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"><li style="margin:0.3em 0px"> <p style="margin-top:0px; margin-bottom:0px">加载一段视频。</p> </li><li style="margin:0.3em 0px"> <p style="margin-top:0px; margin-bottom:0px">调用<code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">GoodFeaturesToTrack</code>函数寻找兴趣点。</p> </li><li style="margin:0.3em 0px"> <p style="margin-top:0px; margin-bottom:0px">调用<code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">CalcOpticalFlowPyrLK</code>函数计算出两帧图像中兴趣点的移动情况。</p> </li><li style="margin:0.3em 0px"> <p style="margin-top:0px; margin-bottom:0px">删除未移动的兴趣点。</p> </li><li style="margin:0.3em 0px"> <p style="margin-top:0px; margin-bottom:0px">在两次移动的点之间绘制一条线段。</p> </li></ol> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 代码示例：</p> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture = cv.CaptureFromFile(<span class="hljs-string" style="color:rgb(42,161,152)">'img/myvideo.avi'</span>)

nbFrames = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_COUNT))
fps = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FPS)
wait = int(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>/fps * <span class="hljs-number" style="color:rgb(42,161,152)">1000</span>/<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH))
height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT))

prev_gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)">#Will hold the frame at t-1</span>
gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)"># Will hold the current frame</span>

prevPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1) <span class="hljs-comment" style="color:rgb(147,161,161)">#Will hold the pyr frame at t-1</span>
currPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1) <span class="hljs-comment" style="color:rgb(147,161,161)"># idem at t</span>

max_count = <span class="hljs-number" style="color:rgb(42,161,152)">500</span>
qLevel= <span class="hljs-number" style="color:rgb(42,161,152)">0.01</span>
minDist = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>
prev_points = [] <span class="hljs-comment" style="color:rgb(147,161,161)">#Points at t-1</span>
curr_points = [] <span class="hljs-comment" style="color:rgb(147,161,161)">#Points at t</span>
lines=[] <span class="hljs-comment" style="color:rgb(147,161,161)">#To keep all the lines overtime</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> f <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> xrange( nbFrames ):

    frame = cv.QueryFrame(capture) <span class="hljs-comment" style="color:rgb(147,161,161)">#Take a frame of the video</span>

    cv.CvtColor(frame, gray, cv.CV_BGR2GRAY) <span class="hljs-comment" style="color:rgb(147,161,161)">#Convert to gray</span>
    output = cv.CloneImage(frame)

    prev_points = cv.GoodFeaturesToTrack(gray, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, max_count, qLevel, minDist) <span class="hljs-comment" style="color:rgb(147,161,161)">#Find points on the image</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Calculate the movement using the previous and the current frame using the previous points</span>
    curr_points, status, err = cv.CalcOpticalFlowPyrLK(prev_gray, gray, prevPyr, currPyr, prev_points, (<span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (cv.CV_TERMCRIT_ITER|cv.CV_TERMCRIT_EPS,<span class="hljs-number" style="color:rgb(42,161,152)">20</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.03</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)


    <span class="hljs-comment" style="color:rgb(147,161,161)">#If points status are ok and distance not negligible keep the point</span>
    k = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        nb =  abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]) ) + abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]) )
        <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> status[i] <span class="hljs-keyword" style="color:rgb(133,153,0)">and</span>  nb &gt; <span class="hljs-number" style="color:rgb(42,161,152)">2</span> :
            prev_points[k] = prev_points[i]
            curr_points[k] = curr_points[i]
            k += <span class="hljs-number" style="color:rgb(42,161,152)">1</span>

    prev_points = prev_points[:k]
    curr_points = curr_points[:k]
    <span class="hljs-comment" style="color:rgb(147,161,161)">#At the end only interesting points are kept</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Draw all the previously kept lines otherwise they would be lost the next frame</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> (pt1, pt2) <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> lines:
        cv.Line(frame, pt1, pt2, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Draw the lines between each points at t-1 and t</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> prevpoint, point <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> zip(prev_points,curr_points):
        prevpoint = (int(prevpoint[<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(prevpoint[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]))
        cv.Circle(frame, prevpoint, <span class="hljs-number" style="color:rgb(42,161,152)">15</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)
        point = (int(point[<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(point[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]))
        cv.Circle(frame, point, <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>)
        cv.Line(frame, prevpoint, point, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))
        lines.append((prevpoint,point)) <span class="hljs-comment" style="color:rgb(147,161,161)">#Append current lines to the lines list</span>


    cv.Copy(gray, prev_gray) <span class="hljs-comment" style="color:rgb(147,161,161)">#Put the current frame prev_gray</span>
    prev_points = curr_points

    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"The Video"</span>, frame)
    <span class="hljs-comment" style="color:rgb(147,161,161)">#cv.WriteFrame(writer, frame)</span>
    cv.WaitKey(wait)</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 直接调用摄像头使用该方法：</p> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture = cv.CaptureFromCAM(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH))
height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT))

prev_gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)

prevPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1) <span class="hljs-comment" style="color:rgb(147,161,161)">#Will hold the pyr frame at t-1</span>
currPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1) <span class="hljs-comment" style="color:rgb(147,161,161)"># idem at t</span>

max_count = <span class="hljs-number" style="color:rgb(42,161,152)">500</span>
qLevel= <span class="hljs-number" style="color:rgb(42,161,152)">0.01</span>
minDist = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>
prev_points = [] <span class="hljs-comment" style="color:rgb(147,161,161)">#Points at t-1</span>
curr_points = [] <span class="hljs-comment" style="color:rgb(147,161,161)">#Points at t</span>
lines=[] <span class="hljs-comment" style="color:rgb(147,161,161)">#To keep all the lines overtime</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:
    frame = cv.QueryFrame(capture)
    cv.CvtColor(frame, gray, cv.CV_BGR2GRAY) <span class="hljs-comment" style="color:rgb(147,161,161)">#Convert to gray</span>
    output = cv.CloneImage(frame)

    prev_points = cv.GoodFeaturesToTrack(gray, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, max_count, qLevel, minDist)
    curr_points, status, err = cv.CalcOpticalFlowPyrLK(prev_gray, gray, prevPyr, currPyr, prev_points, (<span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (cv.CV_TERMCRIT_ITER|cv.CV_TERMCRIT_EPS,<span class="hljs-number" style="color:rgb(42,161,152)">20</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.03</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

    <span class="hljs-comment" style="color:rgb(147,161,161)">#If points status are ok and distance not negligible keep the point</span>
    k = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        nb =  abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]) ) + abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]) )
        <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> status[i] <span class="hljs-keyword" style="color:rgb(133,153,0)">and</span>  nb &gt; <span class="hljs-number" style="color:rgb(42,161,152)">2</span> :
            prev_points[k] = prev_points[i]
            curr_points[k] = curr_points[i]
            k += <span class="hljs-number" style="color:rgb(42,161,152)">1</span>

    prev_points = prev_points[:k]
    curr_points = curr_points[:k]
    <span class="hljs-comment" style="color:rgb(147,161,161)">#At the end only interesting points are kept</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Draw all the previously kept lines otherwise they would be lost the next frame</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> (pt1, pt2) <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> lines:
        cv.Line(frame, pt1, pt2, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Draw the lines between each points at t-1 and t</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> prevpoint, point <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> zip(prev_points,curr_points):
        prevpoint = (int(prevpoint[<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(prevpoint[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]))
        cv.Circle(frame, prevpoint, <span class="hljs-number" style="color:rgb(42,161,152)">15</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)
        point = (int(point[<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(point[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]))
        cv.Circle(frame, point, <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>)
        cv.Line(frame, prevpoint, point, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))
        lines.append((prevpoint,point)) <span class="hljs-comment" style="color:rgb(147,161,161)">#Append current lines to the lines list</span>


    cv.Copy(gray, prev_gray) <span class="hljs-comment" style="color:rgb(147,161,161)">#Put the current frame prev_gray</span>
    prev_points = curr_points

    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"The Video"</span>, frame)
    <span class="hljs-comment" style="color:rgb(147,161,161)">#cv.WriteFrame(writer, frame)</span>
    c = cv.WaitKey(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> c == <span class="hljs-number" style="color:rgb(42,161,152)">27</span>: <span class="hljs-comment" style="color:rgb(147,161,161)">#Esc on Windows</span>
        <span class="hljs-keyword" style="color:rgb(133,153,0)">break</span></code></pre> 
<h4 id="articleHeader1" style="font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-weight:500; line-height:1.2; color:rgb(51,51,51); margin:1.5em 0px 0px; font-size:1.5em"> 0x01. 寻找最大特征值的角点</h4> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> cv.GoodFeaturesToTrack 函数可以检测出图像中最大特征值的角点，使用这个函数可以对图像中的特征点进行跟踪，从而绘制出运动轨迹。</p> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 直接加载视频：</p> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture = cv.CaptureFromFile(<span class="hljs-string" style="color:rgb(42,161,152)">'img/myvideo.avi'</span>)

<span class="hljs-comment" style="color:rgb(147,161,161)">#-- Informations about the video --</span>
nbFrames = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_COUNT))
fps = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FPS)
wait = int(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>/fps * <span class="hljs-number" style="color:rgb(42,161,152)">1000</span>/<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH))
height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT))
<span class="hljs-comment" style="color:rgb(147,161,161)">#For recording</span>
<span class="hljs-comment" style="color:rgb(147,161,161)">#codec = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FOURCC)</span>
<span class="hljs-comment" style="color:rgb(147,161,161)">#writer=cv.CreateVideoWriter("img/output.avi", int(codec), int(fps), (width,height), 1) #Create writer with same parameters</span>
<span class="hljs-comment" style="color:rgb(147,161,161)">#----------------------------------</span>

prev_gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)">#Will hold the frame at t-1</span>
gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)"># Will hold the current frame</span>

output = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">3</span>)

prevPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1)
currPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1)

max_count = <span class="hljs-number" style="color:rgb(42,161,152)">500</span>
qLevel= <span class="hljs-number" style="color:rgb(42,161,152)">0.01</span>
minDist = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>

begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>

initial = []
features = []
prev_points = []
curr_points = []

<span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> f <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> xrange( nbFrames ):

    frame = cv.QueryFrame(capture)

    cv.CvtColor(frame, gray, cv.CV_BGR2GRAY) <span class="hljs-comment" style="color:rgb(147,161,161)">#Convert to gray</span>
    cv.Copy(frame, output)


    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> (len(prev_points) &lt;= <span class="hljs-number" style="color:rgb(42,161,152)">10</span>): <span class="hljs-comment" style="color:rgb(147,161,161)">#Try to get more points</span>
        <span class="hljs-comment" style="color:rgb(147,161,161)">#Detect points on the image</span>
        features = cv.GoodFeaturesToTrack(gray, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, max_count, qLevel, minDist)
        prev_points.extend(features) <span class="hljs-comment" style="color:rgb(147,161,161)">#Add the new points to list</span>
        initial.extend(features) <span class="hljs-comment" style="color:rgb(147,161,161)">#Idem</span>

    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> begin:
        cv.Copy(gray, prev_gray) <span class="hljs-comment" style="color:rgb(147,161,161)">#Now we have two frames to compare</span>
        begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">False</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Compute movement</span>
    curr_points, status, err = cv.CalcOpticalFlowPyrLK(prev_gray, gray, prevPyr, currPyr, prev_points, (<span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (cv.CV_TERMCRIT_ITER|cv.CV_TERMCRIT_EPS,<span class="hljs-number" style="color:rgb(42,161,152)">20</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.03</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

    <span class="hljs-comment" style="color:rgb(147,161,161)">#If points status are ok and distance not negligible keep the point</span>
    k = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        nb =  abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]) ) + abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]) )
        <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> status[i] <span class="hljs-keyword" style="color:rgb(133,153,0)">and</span>  nb &gt; <span class="hljs-number" style="color:rgb(42,161,152)">2</span> :
            initial[k] = initial[i]
            curr_points[k] = curr_points[i]
            k += <span class="hljs-number" style="color:rgb(42,161,152)">1</span>

    curr_points = curr_points[:k]
    initial = initial[:k]
    <span class="hljs-comment" style="color:rgb(147,161,161)">#At the end only interesting points are kept</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Draw the line between the first position of a point and the</span>
    <span class="hljs-comment" style="color:rgb(147,161,161)">#last recorded position of the same point</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        cv.Line(output, (int(initial[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(initial[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), (int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))
        cv.Circle(output, (int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))


    cv.Copy(gray, prev_gray)
    prev_points = curr_points


    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"The Video"</span>,  output)
    cv.WriteFrame(writer, output)
    cv.WaitKey(wait)</code></pre> 
<p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"> 调用摄像头绘制：</p> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture = cv.CaptureFromCAM(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH))
height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT))

prev_gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)">#Will hold the frame at t-1</span>
gray = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>) <span class="hljs-comment" style="color:rgb(147,161,161)"># Will hold the current frame</span>

output = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">3</span>)

prevPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1)
currPyr = cv.CreateImage((height / <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, width + <span class="hljs-number" style="color:rgb(42,161,152)">8</span>), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, cv.CV_8UC1)

max_count = <span class="hljs-number" style="color:rgb(42,161,152)">500</span>
qLevel= <span class="hljs-number" style="color:rgb(42,161,152)">0.01</span>
minDist = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>

begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>

initial = []
features = []
prev_points = []
curr_points = []

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:

    frame = cv.QueryFrame(capture)

    cv.CvtColor(frame, gray, cv.CV_BGR2GRAY) <span class="hljs-comment" style="color:rgb(147,161,161)">#Convert to gray</span>
    cv.Copy(frame, output)


    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> (len(prev_points) &lt;= <span class="hljs-number" style="color:rgb(42,161,152)">10</span>): <span class="hljs-comment" style="color:rgb(147,161,161)">#Try to get more points</span>
        <span class="hljs-comment" style="color:rgb(147,161,161)">#Detect points on the image</span>
        features = cv.GoodFeaturesToTrack(gray, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, max_count, qLevel, minDist)
        prev_points.extend(features) <span class="hljs-comment" style="color:rgb(147,161,161)">#Add the new points to list</span>
        initial.extend(features) <span class="hljs-comment" style="color:rgb(147,161,161)">#Idem</span>

    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> begin:
        cv.Copy(gray, prev_gray) <span class="hljs-comment" style="color:rgb(147,161,161)">#Now we have two frames to compare</span>
        begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">False</span>

    <span class="hljs-comment" style="color:rgb(147,161,161)">#Compute movement</span>
    curr_points, status, err = cv.CalcOpticalFlowPyrLK(prev_gray, gray, prevPyr, currPyr, prev_points, (<span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (cv.CV_TERMCRIT_ITER|cv.CV_TERMCRIT_EPS,<span class="hljs-number" style="color:rgb(42,161,152)">20</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.03</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

    <span class="hljs-comment" style="color:rgb(147,161,161)">#If points status are ok and distance not negligible keep the point</span>
    k = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        nb =  abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]) ) + abs( int(prev_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])-int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]) )
        <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> status[i] <span class="hljs-keyword" style="color:rgb(133,153,0)">and</span>  nb &gt; <span class="hljs-number" style="color:rgb(42,161,152)">2</span> :
            initial[k] = initial[i]
            curr_points[k] = curr_points[i]
            k += <span class="hljs-number" style="color:rgb(42,161,152)">1</span>

    curr_points = curr_points[:k]
    initial = initial[:k]
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(len(curr_points)):
        cv.Line(output, (int(initial[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(initial[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), (int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))
        cv.Circle(output, (int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">0</span>]),int(curr_points[i][<span class="hljs-number" style="color:rgb(42,161,152)">1</span>])), <span class="hljs-number" style="color:rgb(42,161,152)">3</span>, (<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>))


    cv.Copy(gray, prev_gray)
    prev_points = curr_points

    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"The Video"</span>, output)
    c = cv.WaitKey(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> c == <span class="hljs-number" style="color:rgb(42,161,152)">27</span>: <span class="hljs-comment" style="color:rgb(147,161,161)">#Esc on Windows</span>
        <span class="hljs-keyword" style="color:rgb(133,153,0)">break</span></code></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">
</span></code></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">
</span></code></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">
</span></code></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">————————————————————————————————————分割线来了</span></code><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">————————————————————————————————————</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial"></span><h4 id="articleHeader0" style="font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-weight:500; line-height:1.2; color:rgb(51,51,51); margin:0px; font-size:1.5em">0x00. 平均值法</h4><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">通过计算两帧图像之间变化了的像素点占的百分比，来确定图像中是否有动作产生。</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">这里主要用到 Absdiff 函数，比较两帧图像之间有差异的点，当然需要将图像进行一些处理，例如平滑处理，灰度化处理，二值化处理，经过处理之后的二值图像上的点将更有效。</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">代码示例：</p><pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture=cv.CaptureFromCAM(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

frame1 = cv.QueryFrame(capture)
frame1gray = cv.CreateMat(frame1.height, frame1.width, cv.CV_8U)
cv.CvtColor(frame1, frame1gray, cv.CV_RGB2GRAY)

res = cv.CreateMat(frame1.height, frame1.width, cv.CV_8U)

frame2gray = cv.CreateMat(frame1.height, frame1.width, cv.CV_8U)

w= frame2gray.width
h= frame2gray.height
nb_pixels = frame2gray.width * frame2gray.height

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:
    frame2 = cv.QueryFrame(capture)
    cv.CvtColor(frame2, frame2gray, cv.CV_RGB2GRAY)

    cv.AbsDiff(frame1gray, frame2gray, res)
    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"After AbsDiff"</span>, res)

    cv.Smooth(res, res, cv.CV_BLUR, <span class="hljs-number" style="color:rgb(42,161,152)">5</span>,<span class="hljs-number" style="color:rgb(42,161,152)">5</span>)
    element = cv.CreateStructuringElementEx(<span class="hljs-number" style="color:rgb(42,161,152)">5</span>*<span class="hljs-number" style="color:rgb(42,161,152)">2</span>+<span class="hljs-number" style="color:rgb(42,161,152)">1</span>, <span class="hljs-number" style="color:rgb(42,161,152)">5</span>*<span class="hljs-number" style="color:rgb(42,161,152)">2</span>+<span class="hljs-number" style="color:rgb(42,161,152)">1</span>, <span class="hljs-number" style="color:rgb(42,161,152)">5</span>, <span class="hljs-number" style="color:rgb(42,161,152)">5</span>,  cv.CV_SHAPE_RECT)
    cv.MorphologyEx(res, res, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, cv.CV_MOP_OPEN)
    cv.MorphologyEx(res, res, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, cv.CV_MOP_CLOSE)
    cv.Threshold(res, res, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>, cv.CV_THRESH_BINARY_INV)

    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"Image"</span>, frame2)
    cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"Res"</span>, res)

    <span class="hljs-comment" style="color:rgb(147,161,161)">#-----------</span>
    nb=<span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> y <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(h):
        <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> x <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> range(w):
            <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> res[y,x] == <span class="hljs-number" style="color:rgb(42,161,152)">0.0</span>:
                nb += <span class="hljs-number" style="color:rgb(42,161,152)">1</span>
    avg = (nb*<span class="hljs-number" style="color:rgb(42,161,152)">100.0</span>)/nb_pixels
    <span class="hljs-comment" style="color:rgb(147,161,161)">#print "Average: ",avg, "%\r",</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> avg &gt;= <span class="hljs-number" style="color:rgb(42,161,152)">5</span>:
        <span class="hljs-keyword" style="color:rgb(133,153,0)">print</span> <span class="hljs-string" style="color:rgb(42,161,152)">"Something is moving !"</span>
    <span class="hljs-comment" style="color:rgb(147,161,161)">#-----------</span>


    cv.Copy(frame2gray, frame1gray)
    c=cv.WaitKey(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> c==<span class="hljs-number" style="color:rgb(42,161,152)">27</span>: <span class="hljs-comment" style="color:rgb(147,161,161)">#Break if user enters 'Esc'.</span>
        <span class="hljs-keyword" style="color:rgb(133,153,0)">break</span></code></pre><h4 id="articleHeader1" style="font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-weight:500; line-height:1.2; color:rgb(51,51,51); margin:1.5em 0px 0px; font-size:1.5em">0x01. 背景建模与前景检测</h4><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">背景建模也是检测运动物体的一种办法，下面是代码示例：</p><pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2.cv <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> cv

capture = cv.CaptureFromCAM(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)
width = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH))
height = int(cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT))

gray = cv.CreateImage((width,height), cv.IPL_DEPTH_8U, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)

background = cv.CreateMat(height, width, cv.CV_32F)
backImage = cv.CreateImage((width,height), cv.IPL_DEPTH_8U, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
foreground = cv.CreateImage((width,height), cv.IPL_DEPTH_8U, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
output = cv.CreateImage((width,height), <span class="hljs-number" style="color:rgb(42,161,152)">8</span>, <span class="hljs-number" style="color:rgb(42,161,152)">1</span>)

begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>
threshold = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:
  frame = cv.QueryFrame( capture )

  cv.CvtColor(frame, gray, cv.CV_BGR2GRAY)

  <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> begin:
      cv.Convert(gray, background) <span class="hljs-comment" style="color:rgb(147,161,161)">#Convert gray into background format</span>
      begin = <span class="hljs-keyword" style="color:rgb(133,153,0)">False</span>

  cv.Convert(background, backImage) <span class="hljs-comment" style="color:rgb(147,161,161)">#convert existing background to backImage</span>

  cv.AbsDiff(backImage, gray, foreground) <span class="hljs-comment" style="color:rgb(147,161,161)">#Absdiff to get differences</span>

  cv.Threshold(foreground, output, threshold, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>, cv.CV_THRESH_BINARY_INV)

  cv.Acc(foreground, background,output) <span class="hljs-comment" style="color:rgb(147,161,161)">#Accumulate to background</span>

  cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"Output"</span>, output)
  cv.ShowImage(<span class="hljs-string" style="color:rgb(42,161,152)">"Gray"</span>, gray)
  c=cv.WaitKey(<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
  <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> c==<span class="hljs-number" style="color:rgb(42,161,152)">27</span>: <span class="hljs-comment" style="color:rgb(147,161,161)">#Break if user enters 'Esc'.</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">break</span></code></pre><h4 id="articleHeader2" style="font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-weight:500; line-height:1.2; color:rgb(51,51,51); margin:1.5em 0px 0px; font-size:1.5em">0x02. 我的方法</h4><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">上面的几种办法我都试了下，基本上能识别出运动的物体，但是发现总是有点瑕疵，所以又比对了几种别人的方案，然后合成了一个自己的方案：</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">具体处理思路：</p>
 
 </pre><ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">对两帧图像做一个absdiff得到新图像。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">对新图像做灰度和二值化处理。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">使用findContours函数获取二值化处理之后的图片中的轮廓。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">使用contourArea()过滤掉自己不想要的面积范围的轮廓。</p></li></ul><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">这个办法基本上能够检测出物体的图像中物体的移动，而且我觉得通过设定contourArea()函数的过滤范围，可以检测距离摄像头不同距离范围的运动物体。</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">以下是代码示例：</p><pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-comment" style="color:rgb(147,161,161)">#!usr/bin/env python</span>
<span class="hljs-comment" style="color:rgb(147,161,161)">#coding=utf-8</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2
<span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> numpy <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> np

camera = cv2.VideoCapture(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)
width = int(camera.get(<span class="hljs-number" style="color:rgb(42,161,152)">3</span>))
height = int(camera.get(<span class="hljs-number" style="color:rgb(42,161,152)">4</span>))

firstFrame = <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:
  (grabbed, frame) = camera.read()
  gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
  gray = cv2.GaussianBlur(gray, (<span class="hljs-number" style="color:rgb(42,161,152)">21</span>, <span class="hljs-number" style="color:rgb(42,161,152)">21</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

  <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> firstFrame <span class="hljs-keyword" style="color:rgb(133,153,0)">is</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>:
    firstFrame = gray
    <span class="hljs-keyword" style="color:rgb(133,153,0)">continue</span>

  frameDelta = cv2.absdiff(firstFrame, gray)
  thresh = cv2.threshold(frameDelta, <span class="hljs-number" style="color:rgb(42,161,152)">25</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>, cv2.THRESH_BINARY)[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]
  <span class="hljs-comment" style="color:rgb(147,161,161)"># thresh = cv2.adaptiveThreshold(frameDelta,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C,\</span>
            <span class="hljs-comment" style="color:rgb(147,161,161)"># cv2.THRESH_BINARY,11,2)</span>
  <span class="hljs-comment" style="color:rgb(147,161,161)"># thresh = cv2.adaptiveThreshold(frameDelta,255,cv2.ADAPTIVE_THRESH_MEAN_C,\</span>
  <span class="hljs-comment" style="color:rgb(147,161,161)">#           cv2.THRESH_BINARY,11,2)</span>
  thresh = cv2.dilate(thresh, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, iterations=<span class="hljs-number" style="color:rgb(42,161,152)">2</span>)
  (_, cnts, _) = cv2.findContours(thresh.copy(), cv2.RETR_CCOMP, cv2.CHAIN_APPROX_SIMPLE)
  <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> c <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> cnts:
     <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> cv2.contourArea(c) &lt; <span class="hljs-number" style="color:rgb(42,161,152)">10000</span>:
       <span class="hljs-keyword" style="color:rgb(133,153,0)">continue</span>
     (x, y, w, h) = cv2.boundingRect(c)

     cv2.rectangle(frame, (x, y), (x + w, y + h), (<span class="hljs-number" style="color:rgb(42,161,152)">0</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0</span>), <span class="hljs-number" style="color:rgb(42,161,152)">2</span>)

   cv2.imshow(<span class="hljs-string" style="color:rgb(42,161,152)">"Security Feed"</span>, frame)
  
  firstFrame = gray.copy()
camera.release()
cv2.destroyAllWindows()</code></pre><br> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; white-space:inherit; line-height:1.3; background-color:initial">——————————————————————————————————汪星人说这是分割线</span><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">——————————————————————————————————</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial"></span><p style="margin-top:0px; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"><span style="font-weight:700">注意，我使用的OpenCV 版本是 3.0， 低版本就有可能出现第一条评论里的报错</span></p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">在检测出运动的物体之后，我还需要知道运动的方向，使用了上一节中的办法检测运动我发现很难去计算运动方向，开始考虑通过计算轮廓的中点的变化来实现，但是因为每次检测出得轮廓的数量不稳定，所以这个办法会让误差不可控。</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">这时我发现了 <code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">goodFeaturesToTrack</code> 函数，简直是救了我，<code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">goodFeaturesToTrack</code> 函数可以获取图像中的最大特征值的角点，以下是我的思路：</p><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"><span style="font-weight:700">Tips: 看代码之前请先看看我下面写的实现思路，另外还有代码里的注释也对于理解代码会有所帮助</span></p>
 
 </pre><ul style="margin:1.5em 0px 1.5em 3em; padding-left:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px"><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">对两帧图像做一个 <code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">absdiff</code> 得到新图像。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">对新图像做灰度和二值化处理。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">使用 <code style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; color:rgb(199,37,78); padding:2px 4px; background-color:rgb(249,242,244)">goodFeaturesToTrack</code> 函数得到最大特征值的角点。</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">计算角点的平均点，写入队列。（通过计算平均点的解决办法类似物理中刚体问题抽象成质点解决的思路）</p></li><li style="margin:0.3em 0px"><p style="margin-top:0px; margin-bottom:0px">维护一个长度为 10 的队列，队列满时计算队列中数据的增减情况，来确定运动方向。</p></li></ul><p style="margin-top:1.5em; margin-bottom:1.5em; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">代码示例（只实现了左右移动的判断）：</p><pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><code class="python" style="font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:1em; color:inherit; padding:0px; white-space:inherit; background:none"><span class="hljs-comment" style="color:rgb(147,161,161)">#!usr/bin/env python</span>
<span class="hljs-comment" style="color:rgb(147,161,161)">#coding=utf-8</span>

<span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> cv2
<span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> numpy <span class="hljs-keyword" style="color:rgb(133,153,0)">as</span> np
<span class="hljs-keyword" style="color:rgb(133,153,0)">import</span> Queue

camera = cv2.VideoCapture(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>)
width = int(camera.get(<span class="hljs-number" style="color:rgb(42,161,152)">3</span>))
height = int(camera.get(<span class="hljs-number" style="color:rgb(42,161,152)">4</span>))

firstFrame = <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>
lastDec = <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>
firstThresh = <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>

feature_params = dict( maxCorners = <span class="hljs-number" style="color:rgb(42,161,152)">100</span>,
                       qualityLevel = <span class="hljs-number" style="color:rgb(42,161,152)">0.3</span>,
                       minDistance = <span class="hljs-number" style="color:rgb(42,161,152)">7</span>,
                       blockSize = <span class="hljs-number" style="color:rgb(42,161,152)">7</span> )

lk_params = dict( winSize  = (<span class="hljs-number" style="color:rgb(42,161,152)">15</span>,<span class="hljs-number" style="color:rgb(42,161,152)">15</span>),
                  maxLevel = <span class="hljs-number" style="color:rgb(42,161,152)">2</span>,
                  criteria = (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, <span class="hljs-number" style="color:rgb(42,161,152)">10</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.03</span>))

color = np.random.randint(<span class="hljs-number" style="color:rgb(42,161,152)">0</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>,(<span class="hljs-number" style="color:rgb(42,161,152)">100</span>,<span class="hljs-number" style="color:rgb(42,161,152)">3</span>))
num = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>

q_x = Queue.Queue(maxsize = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>)
q_y = Queue.Queue(maxsize = <span class="hljs-number" style="color:rgb(42,161,152)">10</span>)

<span class="hljs-keyword" style="color:rgb(133,153,0)">while</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">True</span>:
  (grabbed, frame) = camera.read()
  gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
  gray = cv2.GaussianBlur(gray, (<span class="hljs-number" style="color:rgb(42,161,152)">21</span>, <span class="hljs-number" style="color:rgb(42,161,152)">21</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>)

  <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> firstFrame <span class="hljs-keyword" style="color:rgb(133,153,0)">is</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>:
    firstFrame = gray
    <span class="hljs-keyword" style="color:rgb(133,153,0)">continue</span>

  <span class="hljs-comment" style="color:rgb(147,161,161)"># 对两帧图像进行 absdiff 操作</span>
  frameDelta = cv2.absdiff(firstFrame, gray)
  <span class="hljs-comment" style="color:rgb(147,161,161)"># diff 之后的图像进行二值化</span>
  thresh = cv2.threshold(frameDelta, <span class="hljs-number" style="color:rgb(42,161,152)">25</span>, <span class="hljs-number" style="color:rgb(42,161,152)">255</span>, cv2.THRESH_BINARY)[<span class="hljs-number" style="color:rgb(42,161,152)">1</span>]
  <span class="hljs-comment" style="color:rgb(147,161,161)"># 下面的是几种不同的二值化的方法，感觉对我来说效果都差不多</span>
  <span class="hljs-comment" style="color:rgb(147,161,161)"># thresh = cv2.adaptiveThreshold(frameDelta,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C,\</span>
            <span class="hljs-comment" style="color:rgb(147,161,161)"># cv2.THRESH_BINARY,11,2)</span>
  <span class="hljs-comment" style="color:rgb(147,161,161)"># thresh = cv2.adaptiveThreshold(frameDelta,255,cv2.ADAPTIVE_THRESH_MEAN_C,\</span>
  <span class="hljs-comment" style="color:rgb(147,161,161)">#           cv2.THRESH_BINARY,11,2)</span>
  thresh = cv2.dilate(thresh, <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, iterations=<span class="hljs-number" style="color:rgb(42,161,152)">2</span>)
  <span class="hljs-comment" style="color:rgb(147,161,161)"># 识别角点</span>
  p0 = cv2.goodFeaturesToTrack(thresh, mask = <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>, **feature_params)
  <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> p0 <span class="hljs-keyword" style="color:rgb(133,153,0)">is</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">not</span> <span class="hljs-keyword" style="color:rgb(133,153,0)">None</span>:
    x_sum = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    y_sum = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> i, old <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> enumerate(p0):
      x, y = old.ravel()
      x_sum += x
      y_sum += y
    <span class="hljs-comment" style="color:rgb(147,161,161)"># 计算出所有角点的平均值</span>
    x_avg = x_sum / len(p0)
    y_avg = y_sum / len(p0)
    
    <span class="hljs-comment" style="color:rgb(147,161,161)"># 写入固定长度的队列</span>
    <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> q_x.full():
      <span class="hljs-comment" style="color:rgb(147,161,161)"># 如果队列满了，就计算这个队列中元素的增减情况</span>
      qx_list = list(q_x.queue)
      key = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
      diffx_sum = <span class="hljs-number" style="color:rgb(42,161,152)">0</span>
      <span class="hljs-keyword" style="color:rgb(133,153,0)">for</span> item_x <span class="hljs-keyword" style="color:rgb(133,153,0)">in</span> qx_list:
        key +=<span class="hljs-number" style="color:rgb(42,161,152)">1</span>
        <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> key &lt; <span class="hljs-number" style="color:rgb(42,161,152)">10</span>:
          <span class="hljs-comment" style="color:rgb(147,161,161)"># 下一个元素减去上一个元素</span>
          diff_x = item_x - qx_list[key]
          diffx_sum += diff_x
      <span class="hljs-comment" style="color:rgb(147,161,161)"># 加和小于0，表明队列中的元素在递增</span>
      <span class="hljs-keyword" style="color:rgb(133,153,0)">if</span> diffx_sum &lt; <span class="hljs-number" style="color:rgb(42,161,152)">0</span>:
        <span class="hljs-keyword" style="color:rgb(133,153,0)">print</span> <span class="hljs-string" style="color:rgb(42,161,152)">"left"</span>
        cv2.putText(frame, <span class="hljs-string" style="color:rgb(42,161,152)">"some coming form left"</span>, (<span class="hljs-number" style="color:rgb(42,161,152)">100</span>,<span class="hljs-number" style="color:rgb(42,161,152)">100</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.5</span>, (<span class="hljs-number" style="color:rgb(42,161,152)">0</span>,<span class="hljs-number" style="color:rgb(42,161,152)">0</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>),<span class="hljs-number" style="color:rgb(42,161,152)">2</span>)
      <span class="hljs-keyword" style="color:rgb(133,153,0)">else</span>:
        <span class="hljs-keyword" style="color:rgb(133,153,0)">print</span> <span class="hljs-string" style="color:rgb(42,161,152)">"right"</span>

      <span class="hljs-keyword" style="color:rgb(133,153,0)">print</span> x_avg
      q_x.get()
    q_x.put(x_avg)
    cv2.putText(frame, str(x_avg), (<span class="hljs-number" style="color:rgb(42,161,152)">300</span>,<span class="hljs-number" style="color:rgb(42,161,152)">100</span>), <span class="hljs-number" style="color:rgb(42,161,152)">0</span>, <span class="hljs-number" style="color:rgb(42,161,152)">0.5</span>, (<span class="hljs-number" style="color:rgb(42,161,152)">0</span>,<span class="hljs-number" style="color:rgb(42,161,152)">0</span>,<span class="hljs-number" style="color:rgb(42,161,152)">255</span>),<span class="hljs-number" style="color:rgb(42,161,152)">2</span>)
    frame = cv2.circle(frame,(int(x_avg),int(y_avg)),<span class="hljs-number" style="color:rgb(42,161,152)">5</span>,color[i].tolist(),-<span class="hljs-number" style="color:rgb(42,161,152)">1</span>)
  
  cv2.imshow(<span class="hljs-string" style="color:rgb(42,161,152)">"Security Feed"</span>, frame)
  firstFrame = gray.copy()

camera.release()
cv2.destroyAllWindows()</code></pre><p style="margin-top:1.5em; margin-bottom:0px; color:rgb(51,51,51); font-family:'Helvetica Neue',Helvetica,Arial,'PingFang SC','Hiragino Sans GB','WenQuanYi Micro Hei','Microsoft Yahei',sans-serif; font-size:14px; line-height:22.4px">总的来讲作为一个图像处理的小白，不断地折腾和尝试，终于搞出了自己想要的东西，OpenCV绝对是喜欢折腾的人必要掌握的一个库了，以后肯定还会继续研究这块东西。</p><br> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">from: https://segmentfault.com/a/1190000003804820</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">https://segmentfault.com/a/1190000003804835
</span></pre> 
<pre style="overflow:auto; font-family:'Source Code Pro',Consolas,Menlo,Monaco,'Courier New',monospace; font-size:0.93em; padding:1em; margin-top:1.5em; margin-bottom:1.5em; line-height:1.3; word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); border:none; max-height:35em; position:relative"><span style="color:rgb(133,153,0); font-size:1em; line-height:1.3; white-space:inherit; background-color:initial">https://segmentfault.com/a/1190000003804867
</span></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3e8baf70ae84986cf5df5cdac942921/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大量POI点展示的一种解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/739693b7989d23743d16f54e799f2889/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ARM汇编指令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>