<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2023 最新最细 vite&#43;vue3&#43;ts 多页面项目架构，建议收藏备用！ - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2023 最新最细 vite&#43;vue3&#43;ts 多页面项目架构，建议收藏备用！" />
<meta property="og:description" content="🌻 前言 本文教程 github地址 、码云。 如果对你有帮助，希望能点个star ⭐️⭐️⭐️ 万分感谢😊😊😊
🧱 背景 不久前我司需要重新部署一个前端项目，由我来负责这个项目的搭建。因为这个项目是需要和app混合开发的h5页面，包括以后可能会做一些运营h5，所以自然不能采用常规的SPA单页面应用架构（因为大部分页面耦合度低，全都塞一个项目里的话，即使打开个纯静态页都要跑起来整个项目，严重影响页面的加载速度）.
另外，我们其实已经有混合开发h5项目，采用的gulp工作流，即每个页面都是单独的一个html文件。这种架构的优势很明显，就是体量小，结构清晰等，但是它的缺点也非常明显，例如有些轮子无法使用，组件化、模块化开发非常不便影响开发效率等。
目前此项目已在平稳运行，最近有空闲时间记录一下我搭建项目的过程，同时也希望能帮助到有这方面需求的掘友😊
💡 思路 ** 综合考虑，我决定用vite &#43; vue3 &#43; ts &#43; esint &#43; prettier &#43; stylelint &#43; husky &#43; lint-stage &#43; commitlint 搭建一套多页面项目。
1. 初步定了几个目标：
🍀 支持打包指定子页面，打包后的文件夹：各页面相互独立（各子页面解耦，避免相互影响）🍀 支持启动指定子页面（常规的多页面项目，启动后需要手动拼接页面地址，或者在根目录做一个重定向的页面，总之调试非常不便）🍀 支持指令化新建页面（手动创建页面太麻烦，每次都得复制一份干净的文件夹）🍀 自由选择创建ts页面 / js页面（对于一些重要的页面可以使用ts提高规范性，一些简单的页面则使用js提高开发效率） 2. 本文将从以下几个方面逐步讲解：
项目目录结构新建项目安装依赖及一些基础插件vite配置项修改ts配置多页面入口配置多页面打包配置指令化新建子页面（*重点）多页面架构改造（*重点）完善项目架构 🌈 教程 一、 项目目录结构 ├── README.md ├── .husky //git hook钩子 │ ├── commit-msg //规范 commit message 信息 │ └── verify-commit-msg.mjs //脚本：commitlint 替代方案 ├── dist //打包输出目录 ├── scripts //存放一些脚本 │ ├── template //创建子页面的js模版 │ ├── template-ts //创建子页面的ts模版 │ ├── index." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/41a4cf36cad6fb86f4c907f6016a2c42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-04T10:25:09+08:00" />
<meta property="article:modified_time" content="2023-09-04T10:25:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2023 最新最细 vite&#43;vue3&#43;ts 多页面项目架构，建议收藏备用！</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="__0"></a>🌻 前言</h2> 
<p>本文教程 <a href="https://github.com/web-abin/vue3-mpa">github地址</a> 、<a href="https://gitee.com/web-abin/vue3-mpa" rel="nofollow">码云</a>。 如果对你有帮助，希望能点个star ⭐️⭐️⭐️ 万分感谢😊😊😊</p> 
<h3><a id="__6"></a><strong>🧱 背景</strong></h3> 
<p>不久前我司需要重新部署一个前端项目，由我来负责这个项目的搭建。因为这个项目是需要和app混合开发的h5页面，包括以后可能会做一些运营h5，所以自然不能采用常规的<code>SPA单页面应用</code>架构（因为大部分页面耦合度低，全都塞一个项目里的话，即使打开个纯静态页都要跑起来整个项目，严重影响页面的加载速度）.</p> 
<p>另外，我们其实已经有混合开发h5项目，采用的<code>gulp工作流</code>，即每个页面都是单独的一个html文件。这种架构的优势很明显，就是体量小，结构清晰等，但是它的缺点也非常明显，例如有些轮子无法使用，组件化、模块化开发非常不便影响开发效率等。</p> 
<blockquote> 
 <p>目前此项目已在平稳运行，最近有空闲时间记录一下我搭建项目的过程，同时也希望能帮助到有这方面需求的掘友😊</p> 
</blockquote> 
<h3><a id="___14"></a>💡 思路 **</h3> 
<p>综合考虑，我决定用<code>vite + vue3 + ts + esint + prettier + stylelint + husky + lint-stage + commitlint</code> 搭建一套多页面项目。</p> 
<p><strong>1. 初步定了几个目标：</strong></p> 
<ul><li>🍀 支持打包指定子页面，打包后的文件夹：各页面相互独立（各子页面解耦，避免相互影响）</li><li>🍀 支持启动指定子页面（常规的多页面项目，启动后需要手动拼接页面地址，或者在根目录做一个重定向的页面，总之调试非常不便）</li><li>🍀 支持指令化新建页面（手动创建页面太麻烦，每次都得复制一份干净的文件夹）</li><li>🍀 自由选择创建<code>ts</code>页面 / <code>js</code>页面（对于一些重要的页面可以使用ts提高规范性，一些简单的页面则使用js提高开发效率）</li></ul> 
<p><strong>2. 本文将从以下几个方面逐步讲解：</strong></p> 
<ul><li>项目目录结构</li><li>新建项目</li><li>安装依赖及一些基础插件</li><li>vite配置项修改</li><li>ts配置</li><li>多页面入口配置</li><li>多页面打包配置</li><li>指令化新建子页面（<code>*重点</code>）</li><li>多页面架构改造（<code>*重点</code>）</li><li>完善项目架构</li></ul> 
<h2><a id="__38"></a>🌈 教程</h2> 
<h3><a id="__40"></a>一、 项目目录结构</h3> 
<pre><code class="prism language-js">├── <span class="token constant">README</span><span class="token punctuation">.</span>md 
├── <span class="token punctuation">.</span>husky   <span class="token comment">//git hook钩子</span>
│   ├── commit<span class="token operator">-</span>msg <span class="token comment">//规范 commit message 信息</span>
│   └── verify<span class="token operator">-</span>commit<span class="token operator">-</span>msg<span class="token punctuation">.</span>mjs  <span class="token comment">//脚本：commitlint 替代方案</span>
├── dist <span class="token comment">//打包输出目录</span>
├── scripts <span class="token comment">//存放一些脚本</span>
│   ├── template         <span class="token comment">//创建子页面的js模版</span>
│   ├── template<span class="token operator">-</span>ts      <span class="token comment">//创建子页面的ts模版</span>
│   ├── index<span class="token punctuation">.</span>mjs        <span class="token comment">//创建子页面的脚本</span>
│   └── multiPages<span class="token punctuation">.</span>json  <span class="token comment">//子页面描述说明集合文件</span>
├── src 
│   ├── arrets       <span class="token comment">//公共静态资源</span>
│   ├── components   <span class="token comment">//公共组件</span>
│   ├── store        <span class="token comment">//pinia 共享状态存储库</span>
│   ├── utils        <span class="token comment">//公共方法</span>
│   └── Projects     <span class="token comment">//多页面文件夹</span>
├── types  <span class="token comment">//ts 声明文件</span>
├── <span class="token punctuation">.</span>env<span class="token punctuation">.</span>development   <span class="token comment">//开发环境-环境变量</span>
├── <span class="token punctuation">.</span>env<span class="token punctuation">.</span>production    <span class="token comment">//生产环境-环境变量</span>
├── <span class="token punctuation">.</span>eslintrc<span class="token punctuation">.</span>cjs      <span class="token comment">//eslint 配置</span>
├── <span class="token punctuation">.</span>gitignore         <span class="token comment">//git 提交忽略文件</span>
├── <span class="token punctuation">.</span>prettierignore    <span class="token comment">//prettier 忽略文件</span>
├── <span class="token punctuation">.</span>prettierrc<span class="token punctuation">.</span>js     <span class="token comment">//prettier 配置</span>
├── <span class="token punctuation">.</span>stylelintignore   <span class="token comment">//stylelint 忽略文件</span>
├── <span class="token punctuation">.</span>stylelintrc<span class="token punctuation">.</span>js    <span class="token comment">//stylelint 配置</span>
├── <span class="token punctuation">.</span>pnpm<span class="token operator">-</span>lock<span class="token punctuation">.</span>yaml    <span class="token comment">//锁定项目于一份各个依赖稳定的版本信息</span>
├── <span class="token punctuation">.</span>stats<span class="token punctuation">.</span>html        <span class="token comment">//chunck size 分析页面</span>
├── tsconfig<span class="token punctuation">.</span>json      <span class="token comment">//ts 配置</span>
├── tsconfig<span class="token punctuation">.</span>node<span class="token punctuation">.</span>json <span class="token comment">//vite在node环境中的 ts 规则</span>
├── vite<span class="token punctuation">.</span>config<span class="token punctuation">.</span>ts     <span class="token comment">//vite 配置</span>
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre> 
<h3><a id="__76"></a>二、 新建项目</h3> 
<p>首先我们用命令行新建一个vite项目，不要使用模板创建，就创建一个基础模板就行，注意创建过程选择 vue3+typescript。创建命令如下：</p> 
<pre><code class="prism language-js"># npm <span class="token number">6</span><span class="token punctuation">.</span>x
npm create vite\@latest vue3<span class="token operator">-</span>mpa

# npm <span class="token number">7</span><span class="token operator">+</span><span class="token punctuation">,</span> extra double<span class="token operator">-</span>dash is needed<span class="token operator">:</span>
npm create vite\@latest  vue3<span class="token operator">-</span>mpa

# yarn
yarn create vite  vue3<span class="token operator">-</span>mpa

# pnpm
pnpm create vite  vue3<span class="token operator">-</span>mpa
</code></pre> 
<h3><a id="__94"></a>三、 安装依赖及一些基础插件</h3> 
<p>新建项目后记得 <code>npm i</code> 安装依赖。然后我们先装一些基础的插件，例如vue-router等，方便后面调试，这里可能没装全，毕竟是返工，有些东西忘记了，大家根据报错提示自行安装即可。</p> 
<pre><code class="prism language-js"><span class="token comment">//安装vue-router4</span>
npm install vue<span class="token operator">-</span>router\@next <span class="token operator">-</span><span class="token constant">S</span>

<span class="token comment">//安装 sass</span>
npm install sass <span class="token operator">-</span><span class="token constant">D</span>

<span class="token comment">//安装 chalk（chalk是一个颜色的插件。可以通过chalk.blue(‘hello world’)来改变console打印的颜色）</span>
npm install chalk@<span class="token operator">^</span><span class="token number">4.1</span><span class="token number">.2</span>

<span class="token comment">//处理使用 node 模块代码飘红，例如 ‘找不到模块 “path“ 或其相对应的类型声明’</span>
npm install @types<span class="token operator">/</span>node <span class="token operator">--</span>save<span class="token operator">-</span>dev
</code></pre> 
<h3><a id="_vite_112"></a>四、 vite配置项修改</h3> 
<p>对<code>vite.config.ts</code>进行调整，先做一些基础的配置，后面我们调通项目之后再丰富项目插件。</p> 
<p>🍀 配置下启动端口，热更新</p> 
<pre><code class="prism language-js"><span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token comment">// 指定服务器主机名</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8880</span><span class="token punctuation">,</span> <span class="token comment">// 指定服务器端口</span>
    <span class="token literal-property property">hmr</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 开启热更新</span>
    <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 在服务器启动时自动在浏览器中打开应用程序</span>
    <span class="token literal-property property">https</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 是否开启 https</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>🍀 配置文件路径的别名，方便书写文件引入路径。</p> 
<pre><code class="prism language-js"><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-property property">'@Project'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/Project'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_ts_139"></a>五、 ts配置</h3> 
<p>项目根目录下找到 <code>tsconfig.json</code> 文件，它是是用来配置 TS 编译选项的。<br> 这一步可以晚一点配置，但是避免后面操作过程中的一些报错，可以提前配置好，以下是我使用的配置项，基本对每一项都做了解释。</p> 
<pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span> <span class="token comment">//用于指定 TS 最后编译出来的 ES 版本</span>
<span class="token string-property property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vite/client"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//要包含的类型声明文件名列表</span>
<span class="token string-property property">"useDefineForClassFields"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//将 class 声明中的字段语义从 [[Set]] 变更到 [[Define]]</span>
<span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>  <span class="token comment">// 设置编译后代码使用的模块化系统：commonjs | UMD | AMD | ES2020 | ESNext | System</span>
<span class="token string-property property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token comment">// 模块解析策略，ts默认用node的解析策略，即相对的方式导入</span>
<span class="token string-property property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//开启所有的严格检查</span>
<span class="token string-property property">"jsx"</span><span class="token operator">:</span> <span class="token string">"preserve"</span><span class="token punctuation">,</span> <span class="token comment">//在 `.tsx`文件里支持JSX： `"React"`或 `"Preserve"`</span>
<span class="token string-property property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 生成目标文件的sourceMap文件</span>
<span class="token string-property property">"resolveJsonModule"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//允许导入扩展名为“.json”的模块</span>
<span class="token string-property property">"isolatedModules"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//确保每个文件都可以在不依赖其他导入的情况下安全地进行传输</span>
<span class="token string-property property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//支持导入 CommonJs 模块</span>
<span class="token string-property property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"esnext"</span><span class="token punctuation">,</span> <span class="token string">"dom"</span><span class="token punctuation">,</span> <span class="token string">"ES2015"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入"ES2019.Array",</span>
<span class="token comment">// "noLib": false, //不包含默认的库文件（ lib.d.ts）</span>
<span class="token string-property property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//忽略所有的声明文件（ *.d.ts）的类型检查</span>
<span class="token string-property property">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许编译器编译JS，JSX文件</span>
<span class="token string-property property">"noEmit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 不输出文件,即编译后不会生成任何js文件</span>
<span class="token string-property property">"allowSyntheticDefaultImports"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//允许从没有设置默认导出的模块中默认导入。这并不影响代码的输出，仅为了类型检查。默认值：module === "system" 或设置了 --esModuleInterop 且 module 不为 es2015 / esnext</span>
<span class="token string-property property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>  <span class="token comment"> 解析非相对模块的基地址，默认是当前目录</span>
<span class="token string-property property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
  <span class="token string-property property">"@/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//解决引入报错  找不到模块“@/xxxx” 或其相应的类型声明</span>
  <span class="token string-property property">"@Project"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/Project/*"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token string">"scripts/**/*.ts"</span><span class="token punctuation">,</span>
<span class="token string">"src/**/*.ts"</span><span class="token punctuation">,</span>
<span class="token string">"src/**/*.js"</span><span class="token punctuation">,</span>
<span class="token string">"src/**/*.d.ts"</span><span class="token punctuation">,</span>
<span class="token string">"src/**/*.tsx"</span><span class="token punctuation">,</span>
<span class="token string">"src/**/*.vue"</span><span class="token punctuation">,</span>
<span class="token string">"scripts/index.mts"</span><span class="token punctuation">,</span>
<span class="token string">"scripts/template-ts/router/routes.ts"</span><span class="token punctuation">,</span>
<span class="token string">"scripts/template-ts/router/index.ts"</span><span class="token punctuation">,</span>
<span class="token string">"scripts/template-ts/main.ts"</span><span class="token punctuation">,</span>
<span class="token string">"src/env.d.ts"</span><span class="token punctuation">,</span>
<span class="token string">"src/global.d.ts"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vite.config.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"references"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> <span class="token string-property property">"path"</span><span class="token operator">:</span> <span class="token string">"./tsconfig.node.json"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment">//每个引用的`path`属性都可以指向到包含`tsconfig.json`文件的目录，或者直接指向到配置文件本身（名字是任意的）</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="__189"></a>六、 多页面入口配置</h3> 
<p><code>vite</code> 和 <code>webpack</code> 配置多页面的方式不同。vite 使用的是 <code>rollup</code> 的打包方式。</p> 
<h4><a id="1__193"></a>1. 基本配置</h4> 
<p>想要将项目改造成多页面项目，我们可以<strong>自定义底层的 Rollup 打包配置</strong>，只需要指定多个 <code>.html</code> 文件作为入口点即可，此设置在<code>build.rollupOptions.input</code> 配置项下。</p> 
<p>首先我们现在 Project 文件夹下新建两个子页面 <code>pageone、pagetwo </code>，目录结构如下：</p> 
<p align="center"><img src="https://images2.imgbox.com/f3/5f/QzBJQauy_o.jpg" alt="image.png" width="30%"></p> 
<p>然后在 <code>vite.config.ts</code> 文件中指定这两个子页面的入口。</p> 
<pre><code class="prism language-js"><span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//自定义底层的 Rollup 打包配置</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">project1</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/Project/pageone/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">project2</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/Project/pagetwo/index.html'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>这里需要注意的是：</strong><br> <strong><code>__dirname</code></strong> 占位符指的是 <code>vite.config.js</code> 文件所在的目录，即使修改了项目的根目录，它的值也不会变（后面我们将会修改项目的根目录）。</p> 
<h4><a id="2__217"></a>2. 动态生成多页面入口</h4> 
<p>因为我们要不断新建子页面，不可能每个子页面都手动去配置入口，所以可以获取到<code>/Progect</code>文件夹下文件名后，动态配置多页面入口。</p> 
<p>fs 模块是 Node.js 官方提供的、用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求，这里我们用到了<code>fs.readdirSync</code> 方法。<br> <code>fs.readdirSync</code> 方法同步返回一个包含“指定目录下所有文件的名称”的数组对象。</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">"fs"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getEntryPath</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">//最后生成的多页面配置项</span>
    <span class="token keyword">const</span> <span class="token constant">PAGE_PATH</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>\__dirname<span class="token punctuation">,</span> <span class="token string">'./src/Project'</span><span class="token punctuation">)</span>  <span class="token comment">//指定要查询的目录</span>
    <span class="token keyword">const</span> entryFiles <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span><span class="token punctuation">)</span>   <span class="token comment">//获取到指定目录下的所有文件名</span>
    entryFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">filePath</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>   <span class="token comment">//遍历处理每个子页面的入口</span>
        map<span class="token punctuation">[</span>filePath<span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/Project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> map
<span class="token punctuation">}</span>

<span class="token comment">// 自定义底层的 Rollup 打包配置</span>
<span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">getEntryPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3__245"></a>3. 配置重定向页面</h4> 
<p>配置完多页面入口后，我们可以启动项目看看效果。<code>npm run dev</code> 启动项目：</p> 
<p align="center"><img src="https://images2.imgbox.com/f7/fe/b4qOP5ls_o.jpg" alt="image.png" width="30%"></p> 
<p>你会发现什么都没有，因为此时项目跟路径还是<code>‘/’</code>，找不到可以作为入口的index.html文件，这时我们只能手动拼接上地址<code>/src/Project/pageone/</code>，进入子项目的 <code>index.html</code> 文件</p> 
<p align="center"><img src="https://images2.imgbox.com/7e/12/4IkiSRAy_o.jpg" alt="image.png" width="30%"></p> 
<p>每次启动项目的时候都手动拼接地址未免也太麻烦了，太沙壁了😅。ok，那我们在项目根目录下写一个重定向的页面，专门用来启动项目后跳转到指定的子项目，代码如下：</p> 
<p><strong>注意：</strong> 到目前为止我们没有修改过项目根目录，仍然在 <code>vite.config.ts</code> 文件同级文件夹下。</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>重定向<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"./src/Project/pageone/index.html"</span><span class="token operator">&gt;</span>子页面<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"./src/Project/pagetwo/index.html"</span><span class="token operator">&gt;</span>子页面<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

</code></pre> 
<p align="center"><img src="https://images2.imgbox.com/35/e1/J8OKiFpM_o.jpg" alt="image.png" width="30%"></p> 
<h3><a id="__278"></a>七、 多页面打包配置</h3> 
<p>build 选项指定多个入口之后，就可以进行多页面打包了。我们执行 <code>npm run build</code> 看看打包生成的 <code>dist</code> 文件夹结构。</p> 
<p align="center"><img src="https://images2.imgbox.com/9d/b2/39sqc3Ea_o.jpg" alt="image.png" width="30%"></p> 
<p>你会发现所有静态资源全都打包到了assets文件夹下，我们可以修改 <code>rollupOptions</code> 选项中的 <code>output</code> 选项修改输出文件夹的格式，如下：</p> 
<pre><code class="prism language-js"><span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> 指定多页面入口<span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">assetFileNames</span><span class="token operator">:</span> <span class="token string">'[ext]/[name]-[hash].[ext]'</span><span class="token punctuation">,</span> <span class="token comment">//静态文件输出的文件夹名称</span>
    <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'js/[name]-[hash].js'</span><span class="token punctuation">,</span>  <span class="token comment">//chunk包输出的文件夹名称</span>
    <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'js/[name]-[hash].js'</span><span class="token punctuation">,</span>  <span class="token comment">//入口文件输出的文件夹名称</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p><strong>占位符说明 &gt;&gt;&gt;</strong></p> 
<ul><li><code>[extname]</code> ：文件扩展名，包括前面的 <code>.</code> ,例如 <code>.css</code>；</li><li><code>[ext]</code> ：文件扩展名，不包括前面的 <code>.</code> ,例如 <code>css</code>；</li><li><code>[name]</code> ：文件名；</li><li><code>[hash]</code> ：基于文件内容生成的哈希值，可以通过<code>[hash:10]</code>设置特定的哈希长度；</li></ul> 
<h3><a id="__306"></a>八、 指令化新建子页面（<code>重点来了～</code>）</h3> 
<p>到这里其实已经改造出来了一个多页面项目脚手架。但是离我们都目标还相差甚远：</p> 
<ul><li>☘️ 不能指令化创建页面</li><li>☘️ 不能单独启动指定的子项目</li><li>☘️ 打包后所有子项目的静态文件都混淆在一起</li></ul> 
<p><strong>那么怎么解决这些问题呢？</strong> 我们逐个剖析：</p> 
<p>先来解决<strong>指令化新建页面</strong>的问题，既然要创建页面，就是要和文件打交道，所以我们还是要使用到 <code>fs</code> 文件系统模块。先来了解它的一下几个方法，我们之后会用到（这里只是大概对方法简单说明，具体使用自行查询）：</p> 
<p>🔥 <strong><code>fs.mkdirSync( path, options )</code></strong> 方法用于同步创建目录，创建子页面主要就是使用这个方法。</p> 
<p>🔥 <strong><code>fs.readFile( filename, encoding, callback_function )</code></strong> 方法用于异步读取指定文件中的内容。</p> 
<p>🔥 <strong><code>fs.writeFile( file, data, options, callback )</code></strong> 方法用于异步读取指定文件中的内容。</p> 
<p>🔥 <strong><code>fs.existsSync( path )</code></strong> 方法用于同步检测目录是否存在;</p> 
<p>🔥 <strong><code>fs.readdirSync( path, options )</code></strong> 方法用于同步读取给定目录的内容。该方法返回一个数组，其中包含目录中的所有文件名或对象。</p> 
<p>🔥 <strong><code>fs.copyFileSync( src, dest, mode )</code></strong> 方法用于将文件从源路径同步复制到目标路径。</p> 
<p><strong>了解这些以后，我们捋一下创建文件的步骤：</strong></p> 
<ol><li><code>package.json</code> 文件中添加以下指令，以执行创建子页面的脚本；</li></ol> 
<pre><code class="prism language-js"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token string-property property">"new:page"</span><span class="token operator">:</span> <span class="token string">"node ./scripts/index.mjs"</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>然后开发写创建子页面的脚本，第一步要先提示用户输入要创建的页面名称和描述，并验证输入的格式；</li></ol> 
<pre><code class="prism language-js"><span class="token comment">//./scripts/index.mjs</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">successLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">errorLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请输入要生成的"页面名称:页面描述"、会生成在 /src/Project 目录下'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>使用 <code>fs.existsSync</code> 方法验证是否已存在同名页面；</li></ol> 
<pre><code class="prism language-js"><span class="token comment">//process.stdin属性是流程模块的内置应用程序编程接口，用于侦听用户输入，它使用on()函数来监听事件。</span>
process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 获取输入的信息</span>
<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inputSearch <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>inputSearch <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">errorLog</span><span class="token punctuation">(</span><span class="token string">'格式错误，请重新输入'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token comment">// 拆分用户输入的名称和描述</span>
<span class="token keyword">const</span> inputName <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> inputDesc <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> inputName
<span class="token keyword">const</span> isTs <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_ts
<span class="token function">successLog</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">将在 /src/Project 目录下创建 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>inputName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 文件夹</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> targetPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./src/Project'</span><span class="token punctuation">,</span> inputName<span class="token punctuation">)</span>
<span class="token comment">// 判断同名文件夹是否存在</span>
<span class="token keyword">const</span> pageExists <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pageExists<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">errorLog</span><span class="token punctuation">(</span><span class="token string">'页面已经存在，请重新输入'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>在同级 <code>script</code> 文件夹下，新建 <code>multiPages.json</code> 用于记录目前已有的页面名称，每次新建页面都会写入进去；</li></ol> 
<pre><code class="prism language-js"><span class="token comment">// 获取multiPages.json文件内容，获取当前已有的页面集合</span>
<span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./scripts'</span><span class="token punctuation">,</span> <span class="token string">'multiPages.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">'utf-8'</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//获取老数据</span>
  <span class="token keyword">let</span> datas <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token comment">//和老数据去重</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> datas<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> ele<span class="token punctuation">.</span>chunk <span class="token operator">==</span> inputName
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//写入新页面的</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">chunk</span><span class="token operator">:</span> inputName<span class="token punctuation">,</span>
      <span class="token literal-property property">chunkName</span><span class="token operator">:</span> inputDesc
    <span class="token punctuation">}</span>
    datas<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token function">setFile</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 写入multiPages.json</span>
<span class="token keyword">function</span> <span class="token function">setFile</span><span class="token punctuation">(</span><span class="token parameter">datas</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 通过writeFile改变数据内容</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./scripts'</span><span class="token punctuation">,</span> <span class="token string">'multiPages.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token comment">// 在project中建立新的目录</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span>
    <span class="token keyword">const</span> sourcePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>
      isTs <span class="token operator">?</span> <span class="token string">'./scripts/template-ts'</span> <span class="token operator">:</span> <span class="token string">'./scripts/template'</span>
    <span class="token punctuation">)</span>
    <span class="token function">copyFile</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">,</span> targetPath<span class="token punctuation">)</span>
    process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="6"><li>将新页面的信息写入 <code>multiPages.json</code> 文件后，在 Project 文件夹下复制我们提前创建好的模板页面。我这里创建了两个模版页面，分别是js和ts的模版，如果<strong>需要创建支持 <code>TS</code> 的子页面</strong>，创建命令为 <code>npm run new:page --ts</code></li></ol> 
<pre><code class="prism language-js"><span class="token comment">// 判断文件夹是否存在，不存在创建一个</span>
<span class="token keyword">const</span> <span class="token function-variable function">isExist</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//递归复制模版文件夹内的文件</span>
<span class="token keyword">const</span> <span class="token function-variable function">copyFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sourcePath<span class="token punctuation">,</span> targetPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> sourceFile <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">withFileTypes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

sourceFile<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> newSourcePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>sourcePath<span class="token punctuation">,</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">const</span> newTargetPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>targetPath<span class="token punctuation">,</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token comment">//isDirectory() 判断这个文件是否是文件夹，是就继续递归复制其内容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token function">isExist</span><span class="token punctuation">(</span>newTargetPath<span class="token punctuation">)</span>
          <span class="token function">copyFile</span><span class="token punctuation">(</span>newSourcePath<span class="token punctuation">,</span> newTargetPath<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>newSourcePath<span class="token punctuation">,</span> newTargetPath<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="__461"></a>九、 多页面架构改造</h3> 
<p>到这里可以做如下思考：</p> 
<p>🤔 如何支持单独启动指定的子页面？<br> 指定子页面可以在执行 <code>npm run dev</code> 命令时配置自定义环境变量。格式为 <code>npm run dev --变量名=值</code> ，例如我要单独启动 pageone 子页面： <code>npm run dev --page=pageone</code>。关于<strong>npm环境变量</strong>的使用可以查看<a href="https://www.w3cschool.cn/npmjs/npmjs-tfry3kmu.html" rel="nofollow">传送门</a><br> 如何启动后直接进入这个子页面呢？这时候我们就需要修改项目的根路径了：</p> 
<blockquote> 
 <p><strong>注意：将根路径修改到指定子页面目录下后，就只能单独启动/打包 指定的子页面了，无法打包全部的子页面。这么做有以下优缺点：</strong><br> <strong>优点：打包后的子页面相互独立，可以直接启动指定的子页面；</strong><br> <strong>缺点：无法一次性打包全部页面，需要配置重定向页面方便调试</strong></p> 
</blockquote> 
<p>所以你可以根据需要决定是否要修改项目根目录，因为我考虑到页面是逐步新增的，需要一次性打包全部页面的情况很少，而且我认为打包后的子页面相互独立非常重要，避免出现一些意料之外的问题影响多个页面，所以我果断选择了每次都单独打包页面。</p> 
<p>这里我把两种情况的处理都列出来：</p> 
<h4><a id="1_477"></a>情况1：支持单页面打包和打包全部页面</h4> 
<p>处理方式：</p> 
<ol><li>多页面入口配置\</li></ol> 
<p>使用说明： <code>npm run build</code>打包全部页面; <code>npm run build --page=页面名称</code> 打包单页面；</p> 
<pre><code class="prism language-js"><span class="token comment">//vite.config.ts</span>

<span class="token comment">// 引入多页面配置文件</span>
<span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./scripts/multiPages.json'</span><span class="token punctuation">)</span>
<span class="token comment">// 获取npm run dev后缀 配置的环境变量</span>
<span class="token keyword">const</span> <span class="token literal-property property">npm_config_page</span><span class="token operator">:</span>string <span class="token operator">=</span>  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_page <span class="token operator">||</span> <span class="token string">''</span>

<span class="token keyword">let</span> filterProjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>npm_config_page<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//如果指定了单页面打包，过滤出这个页面的配置项</span>
	filterProjects <span class="token operator">=</span> project<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">return</span> ele<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> npm_config_page<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">--------单独构建：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>filterProjects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'chunkName'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">--------</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	filterProjects <span class="token operator">=</span> project
<span class="token punctuation">}</span>

<span class="token comment">//多页面入口</span>
<span class="token keyword">const</span> <span class="token function-variable function">getEnterPages</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	p<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> htmlUrl <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
	  __dirname<span class="token punctuation">,</span>
	  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/Project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>ele<span class="token punctuation">.</span>chunk<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span>
	pages<span class="token punctuation">[</span>ele<span class="token punctuation">.</span>chunk<span class="token punctuation">]</span> <span class="token operator">=</span> htmlUrl
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> pages
<span class="token punctuation">}</span>

<span class="token comment">//入口配置</span>
<span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">getEnterPages</span><span class="token punctuation">(</span>filterProjects<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
</code></pre> 
<ol start="2"><li> <p>项目根路径修改为 <code>root: './src/Project/'</code> ，不修改其实也能实现，但是不改的话打包后dist文件夹层级太深；</p> </li><li> <p>修改打包的输出路径为：</p> </li></ol> 
<pre><code class="prism language-js"><span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">outDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 指定输出路径</span>
<span class="token operator">...</span>
</code></pre> 
<p>打包后的dist目录结构：</p> 
<p align="center"><img src="https://images2.imgbox.com/f9/31/m41hyrzr_o.jpg" alt="image.png" width="30%"></p> 4. 修改 `envDir` 配置项，修改到项目根的路径，用于加载`.env` 环境变量文件 
<pre><code class="prism language-js"><span class="token literal-property property">envDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>在自定义的 <code>root</code> 根路径下（这里是 <code>src/Project</code> 文件夹下）创建重定向页面，方便启动后调试。</li></ol> 
<h4><a id="2_545"></a>情况2：只支持单页面打包</h4> 
<ol><li>多页面入口配置\</li></ol> 
<p>使用说明： <code>npm run build --page=页面名称</code> 单独打包指定页面。</p> 
<pre><code class="prism language-js"><span class="token comment">//vite.config.ts</span>
<span class="token keyword">import</span> chalk <span class="token keyword">from</span> <span class="token string">'chalk'</span>

<span class="token comment">// 引入多页面配置文件</span>
<span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./scripts/multiPages.json'</span><span class="token punctuation">)</span>
<span class="token comment">// 获取npm run dev后缀 配置的环境变量</span>
<span class="token keyword">const</span> <span class="token literal-property property">npm_config_page</span><span class="token operator">:</span>string <span class="token operator">=</span>  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_page <span class="token operator">||</span> <span class="token string">''</span>
<span class="token comment">// 命令行报错提示</span>
<span class="token keyword">const</span> <span class="token function-variable function">errorLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//获取指定的单页面入口</span>
<span class="token keyword">const</span> <span class="token function-variable function">getEnterPages</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>npm_config_page<span class="token punctuation">)</span> <span class="token function">errorLog</span><span class="token punctuation">(</span><span class="token string">'-------------------请在命令行后以 `--page=页面名称` 格式指定页面名称！-------------------'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> filterArr <span class="token operator">=</span> project<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> npm_config_page<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filterArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token function">errorLog</span><span class="token punctuation">(</span><span class="token string">'-------------------不存在此页面，请检查页面名称！-------------------'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">[</span>npm_config_page<span class="token punctuation">]</span> <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
          __dirname<span class="token punctuation">,</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/Project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>npm_config_page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//入口配置</span>
<span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">getEnterPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>

</code></pre> 
<ol start="2"><li>项目根路径修改到用户输入的单页面文件夹下</li></ol> 
<pre><code class="prism language-js"><span class="token literal-property property">root</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./src/Project/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>npm_config_page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>修改打包的输出路径为：</li></ol> 
<pre><code class="prism language-js"><span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">outDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> npm_config_page <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 指定输出路径</span>
<span class="token operator">...</span>
</code></pre> 
<p>打包后的dist目录结构：</p> 
<p align="center"><img src="https://images2.imgbox.com/f8/0f/zPor4maH_o.jpg" alt="image.png" width="30%"></p> 
<ol start="4"><li>修改 <code>envDir</code> 配置项，修改到项目根的路径，用于加载<code>.env</code> 环境变量文件</li></ol> 
<pre><code class="prism language-js"><span class="token literal-property property">envDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
</code></pre> 
<p><strong>到这里，多页面架构已经基本改造完成了🎉🎉🎉</strong></p> 
<p>🤔 再做一些打包的优化：</p> 
<pre><code class="prism language-js"><span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 这个生产环境一定要关闭，不然打包的产物会很大</span>
    <span class="token literal-property property">assetsInlineLimit</span><span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">,</span> <span class="token comment">//小于此阈值的导入或引用资源将内联为 base64 编码，以避免额外的 http 请求</span>
    <span class="token literal-property property">emptyOutDir</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//Vite 会在构建时清空该目录</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token operator">...</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token operator">...</span>
        <span class="token literal-property property">compact</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//压缩代码，删除换行符等</span>
        <span class="token function-variable function">manualChunks</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//配置分包</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"node_modules"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'node_modules/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拆分多个vendors</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre> 
<h3><a id="__633"></a>十、 完善项目架构</h3> 
<h4><a id="1__pnpm__npm__635"></a>1. <code>pnpm</code> 替代 <code>npm</code> 管理依赖包</h4> 
<p><strong>pnpm 是一款磁盘空间高效的软件包管理器。</strong> 如果你还在用 npm 管理依赖包，我建议你不妨试试pnpm，因为他是真的香，速度杠杠的😆<br> 详细介绍这里就不做展开了，官网传送门<a href="https://pnpm.io/zh/motivation" rel="nofollow">https://pnpm.io/zh/motivation</a></p> 
<pre><code class="prism language-js"><span class="token comment">//全局安装 pnpm</span>
npm install <span class="token operator">-</span>g pnpm
<span class="token comment">//切换淘宝源</span>
pnpm config <span class="token keyword">set</span> registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">registry.npmmirror.com</span><span class="token regex-delimiter">/</span></span>
<span class="token comment">//删除node_modules文件夹，执行 pnpm i</span>
</code></pre> 
<h4><a id="2__eslint__stylelint__prettier__648"></a>2. 引入<code>eslint</code> + <code>stylelint</code> + <code>prettier</code> 规范代码风格和质量</h4> 
<blockquote> 
 <p><code>eslint</code> 是代码检查工具（lint工具），我们用它来避免低级错误和统一代码的风格，以保证代码质量；<br> <code>stylelint</code> 为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等；<br> <code>prettier</code> 是代码格式化工具，我们用它来统一代码格式，风格。</p> 
</blockquote> 
<p><strong>🍀 首先先来安装 <code>eslint</code></strong> ，依次执行以下命令：</p> 
<pre><code class="prism language-js"><span class="token comment">// 安装 eslint</span>
pnpm add eslint <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// eslint初始化</span>
pnpm eslint <span class="token operator">--</span>init
</code></pre> 
<p>初始化配置项如下：</p> 
<p align="center"><img src="https://images2.imgbox.com/b3/a5/bT5IOpzB_o.jpg" alt="image.png" width="50%"></p> 
<p>eslint初始化之后，会生成<code>.eslintrc.cjs</code>配置文件。刚初始化完的时候你会发现有个 <code>module</code> 报错了，很简单，只要在 <code>env</code> 配置项下新增选项 <code>"node": true</code> 即可。</p> 
<p align="center"><img src="https://images2.imgbox.com/e4/79/FEYifhDN_o.png" alt="截屏2023-04-10 下午6.38.39.png" width="30%"></p> 
<pre><code class="prism language-js"><span class="token comment">// --ext 为指定lint哪些后缀的文件    --fix 开启自动修复</span>
<span class="token string-property property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix"</span>
</code></pre> 
<p>此时打开<code>.eslintrc.cjs</code>配置文件会出现一个报错，需要再<code>env</code>字段中增加<code>node: true</code>配置以解决eslint找不到module的报错。</p> 
<blockquote> 
 <p><strong>注意：</strong> <code>.eslintrc.cjs</code> 配置文件名需以<code>.cjs</code>结尾，如果以 <code>.js</code> 结尾，需要删除<code>package.json</code> 文件中的字段<code>"type": "module"</code>。<code>prettier</code> 同理，因为我们要用到 chalk 插件，所以统一采用 <code>.cjs</code> 文件。</p> 
</blockquote> 
<p>具体<code>eslint</code>规则根据自己的习惯进行配置，这里也贴下我的粗糙配置：</p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"browser"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"es2021"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"node"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span>
    <span class="token string">"plugin:vue/vue3-essential"</span><span class="token punctuation">,</span>
    <span class="token string">"plugin:@typescript-eslint/recommended"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"parser"</span><span class="token operator">:</span> <span class="token string">"vue-eslint-parser"</span><span class="token punctuation">,</span>
<span class="token string-property property">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"ecmaVersion"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"parser"</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"vue"</span><span class="token punctuation">,</span>
    <span class="token string">"@typescript-eslint"</span><span class="token punctuation">,</span>
    <span class="token string">"prettier"</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">'@typescript-eslint/no-var-requires'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//解决报错：Require statement not part of import statement.</span>
  <span class="token string-property property">'vue/multi-word-component-names'</span><span class="token operator">:</span> <span class="token string">'off'</span> <span class="token comment">//关闭组件命名规则娇艳</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">"root"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>🍀 再来安装<code>stylelint</code></strong></p> 
<pre><code class="prism language-js">pnpm add stylelint stylelint<span class="token operator">-</span>order stylelint<span class="token operator">-</span>config<span class="token operator">-</span>standard  stylelint<span class="token operator">-</span>config<span class="token operator">-</span>prettier <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> 
<p>依赖说明：</p> 
<ul><li><code>stylelint</code>:检验工具</li><li><code>stylelint-order</code>：css样式书写顺序插件</li><li><code>stylelint-config-standard</code>:stylelint的推荐配置</li><li><code>stylelint-config-prettier</code>：关闭所有不必要的或可能与 Prettier 冲突的规则</li></ul> 
<p>创建 <code>.stylelintrc.js</code> 配置文件：</p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 注册 stylelint 的 prettier 插件</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'stylelint-prettier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">// 继承一系列规则集合</span>
<span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token string">'stylelint-config-standard-scss'</span><span class="token punctuation">,</span>
<span class="token string">'stylelint-config-html/vue'</span><span class="token punctuation">,</span>
<span class="token string">'stylelint-config-recommended-vue/scss'</span><span class="token punctuation">,</span>
<span class="token string">'stylelint-config-recess-order'</span><span class="token punctuation">,</span>
<span class="token comment">// 接入 Prettier 规则</span>
<span class="token string">'stylelint-config-prettier'</span><span class="token punctuation">,</span>
<span class="token string">'stylelint-prettier/recommended'</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">// 配置 rules</span>
<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 开启 Prettier 自动格式化功能</span>
<span class="token string-property property">'prettier/prettier'</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>及忽略文件 <code>.stylelintignore</code></p> 
<pre><code class="prism language-js">node_modules<span class="token comment">/*
/dist/
</span></code></pre> 
<p>最后配置命令</p> 
<pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"script"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"lint:stylelint"</span><span class="token operator">:</span> <span class="token string">"stylelint --cache --fix \"**/*.{vue,less,postcss,css,scss}\" --cache --cache-location node_modules/.cache/stylelint/"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>🍀 最后安装<code>prettier</code></strong></p> 
<pre><code class="prism language-js">pnpm add prettier <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> 
<p>安装好之后在项目根目录创建 <code>.prettierrc.cjs</code> 配置文件，这里也贴下我的配置，大家自己根据需要调整规则。</p> 
<pre><code class="prism language-js"><span class="token comment">//.prettierrc.cjs</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token comment">//一行的字符数，如果超过会进行换行，默认为80</span>
<span class="token literal-property property">singleAttributePerLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//每行强制换行，只能使用单个属性</span>
<span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 一个 tab 代表几个空格数，默认为 2 个</span>
<span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否使用 tab 进行缩进，默认为false，表示用空格进行缩减</span>
<span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 字符串是否使用单引号，默认为 false，使用双引号</span>
<span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 行尾是否使用分号，默认为true</span>
<span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token comment">// 是否使用尾逗号</span>
<span class="token literal-property property">bracketSpacing</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 对象大括号直接是否有空格，默认为 true，效果：{ a: 1 }</span>
<span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">'auto'</span><span class="token punctuation">,</span>
<span class="token literal-property property">jsxBracketSameLine</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 在jsx中把'&gt;' 是否单独放一行</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>同时创建 <code>.prettierignore</code> 为Prettier忽略指定文件</p> 
<pre><code class="prism language-js"><span class="token punctuation">.</span>DS_Store
node_modules
dist
dist<span class="token operator">-</span>ssr

<span class="token operator">**</span><span class="token comment">/*.svg
**/</span><span class="token operator">*</span><span class="token punctuation">.</span>sh
</code></pre> 
<p><code>eslint</code> 和 <code>prettier</code> 的配置难免会有冲突，目前比较成熟的方案是使用以下两个插件：</p> 
<ul><li> <p><code>eslint-plugin-prettier</code>： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。</p> </li><li> <p><code>eslint-config-prettier</code>： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，<strong>确保将其放在 extends 队列最后，这样它将覆盖其他配置</strong></p> </li><li></ul> 
<pre><code class="prism language-js">pnpm add eslint<span class="token operator">-</span>config<span class="token operator">-</span>prettier eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>prettier <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> 
<p>安装完成后在 <code>.eslintrc.cjs</code> 文件中<code>extends</code>的最后添加一个配置</p> 
<p>{<!-- --><br> extends: [<br> ‘eslint:recommended’,<br> ‘plugin:vue/vue3-essential’,<br> ‘plugin:@typescript-eslint/recommended’,<br> // 新增，必须放在最后面<br> ‘plugin:prettier/recommended’<br> ]<br> }</p> 
<h4><a id="3__husky__lintstaged__Commitlint__git__829"></a>3. 引入<code>husky</code> + <code>lint-staged</code> + <code>Commitlint</code> 规范 git 工作流程</h4> 
<p>在团队协作开发时，为了避免开发人员代码格式和风格不同导致的冲突，我们最好遵循<code>husky</code>+<code>Commitlint</code>+<code>lint-staged</code> git工作流规范，这样在本地提交代码前，能够强制让开发人员进行统一的代码规范化处理，避免造成冲突和一些潜在问题。</p> 
<blockquote> 
 <p><code>husky</code> 是常见的<strong>git hook</strong>工具，使用husky可以挂载Git钩子，当我们本地进行git commit或git push等操作前，能够执行其它一些操作，比如进行ESLint检查，如果不通过，就不允许commit或push。</p> 
</blockquote> 
<pre><code class="prism language-js">pnpm add husky <span class="token operator">-</span><span class="token constant">D</span>
# 执行以下命令会生成 <span class="token punctuation">.</span>husky 文件
npx husky install
<span class="token comment">// 配合lint-staged使用</span>
npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>pre<span class="token operator">-</span>commit <span class="token string">"npx lint-staged"</span>
</code></pre> 
<blockquote> 
 <p><code>Lint-staged</code> 可以在git staged阶段（即git add 后的暂存阶段）的文件上执行Linters，简单说就是当我们运行ESlint或Stylelint命令时，可以通过设置指定只检查我们通过git add添加到暂存区的文件，可以避免我们每次检查都把整个项目的代码都检查一遍，从而提高效率。</p> 
</blockquote> 
<pre><code class="prism language-js">pnpm add husky lint<span class="token operator">-</span>staged <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> 
<p>在 <code>package.json</code> 文件中配置lint-staged</p> 
<pre><code class="prism language-js"><span class="token string-property property">"lint-staged"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"src/**/*.{js,ts,vue}"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"pnpm run lint:script"</span><span class="token punctuation">,</span>
      <span class="token string">"pnpm run lint:prettierrc"</span><span class="token punctuation">,</span>
      <span class="token string">"git add ."</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><code>Commitlint</code> 是用来规范git提交代码时 <code>Commit Message</code> 格式的工具。结合husky一起使用，可以在开发者进行commit前就对Commit Message进行检查，只有符合规范，才能够进行commit。</p> 
</blockquote> 
<p>安装<code>Commitlint</code></p> 
<pre><code class="prism language-js">pnpm add @commitlint<span class="token operator">/</span>cli @commitlint<span class="token operator">/</span>config<span class="token operator">-</span>conventional
</code></pre> 
<p><code>Commitlint</code>配合 <code>husky</code> 使用：执行下方命令，会在 <code>.husky</code> 目录下生成 <code>commit-msg</code> 文件。</p> 
<pre><code class="prism language-js">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>commit<span class="token operator">-</span>msg <span class="token string">'npx --no -- commitlint --edit $1'</span>
</code></pre> 
<p>然后在根目录创建 <code>commitlint.config.js</code> 文件进行配置。</p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@commitlint/config-conventional'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string-property property">'type-case'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'always'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'lower-case'</span><span class="token punctuation">,</span> <span class="token string">'upper-case'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token string-property property">'type-enum'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string">'always'</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token string">'feat'</span><span class="token punctuation">,</span> <span class="token comment">//新的特性</span>
    <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token comment">//修复Bug</span>
    <span class="token string">'docs'</span><span class="token punctuation">,</span>  <span class="token comment">//添加或更新文档</span>
    <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token comment">//代码格式的更改</span>
    <span class="token string">'refactor'</span><span class="token punctuation">,</span> <span class="token comment">//代码进行重构</span>
    <span class="token string">'perf'</span><span class="token punctuation">,</span> <span class="token comment">//提升性能</span>
    <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token comment">//添加或更新测试用例</span>
    <span class="token string">'chore'</span><span class="token punctuation">,</span>  <span class="token comment">//更改配置文件</span>
    <span class="token string">'revert'</span><span class="token punctuation">,</span>  <span class="token comment">//版本回退</span>
    <span class="token string">'merge'</span><span class="token punctuation">,</span>  <span class="token comment">//分支合并</span>
    <span class="token string">'build'</span><span class="token punctuation">,</span>  <span class="token comment">//打包工具的更改</span>
    <span class="token string">'release'</span><span class="token punctuation">,</span>  <span class="token comment">//发布/版本标签</span>
    <span class="token string">'ci'</span>  <span class="token comment">//对CI配置和脚本的更改</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>🌈 脚本替代<code>Commitlint</code>方案</strong></p> 
<p>我这里为了在输入 <code>commit msg</code> 时有比较清晰的报错提示，所以决定采用脚本代替 <code>Commitlint</code> ，当然，你也可以采用 <code>Commitlint</code> 的 <code>prompt</code> (命令行提示工具) ，并在<code>package.json</code> 文件中添加 commit 命令来规范 git 提交操作（但是我认为这么整太麻烦了，降低开发效率）。</p> 
<p>脚本的思路无非就是定义一个 <code>commit type</code> 的字典集，然后比对输入的类型，不符合要求则用node插件<code>boxen</code>（控制台输出盒子）进行规范化提示。</p> 
<p>注意要将 <code>husky</code> 的 <code>commit-msg</code> 钩子修改为我们的脚本地址</p> 
<pre><code class="prism language-js"><span class="token comment">//修改husky文件夹下的 commit-msg 文件</span>
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env sh
<span class="token punctuation">.</span> <span class="token string">"$(dirname -- "</span>$0<span class="token string">")/_/husky.sh"</span>

node <span class="token punctuation">.</span>husky<span class="token operator">/</span>verify<span class="token operator">-</span>commit<span class="token operator">-</span>msg<span class="token punctuation">.</span>mjs 
</code></pre> 
<p>在mac上如果报错<code>[hint](https://so.csdn.net/so/search?q=hint&amp;spm=1001.2101.3001.7020): The '.husky/pre-commit' hook was ignored because it's not set as executable.</code>，因为指定的文件是不可执行的，只需要执行以下命令即可解决：</p> 
<pre><code class="prism language-js">chmod <span class="token number">777</span> <span class="token punctuation">.</span><span class="token operator">/</span>husky<span class="token comment">/*
</span></code></pre> 
<pre><code class="prism language-js"><span class="token comment">//安装 boxen插件</span>
pnpm add boxen <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>
<span class="token keyword">import</span> chalk <span class="token keyword">from</span> <span class="token string">'chalk'</span>
<span class="token comment">//设置chalk等级 解决颜色无效问题</span>
chalk<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// 引入node控制台输出盒子插件</span>
<span class="token keyword">import</span> boxen <span class="token keyword">from</span> <span class="token string">'boxen'</span>

<span class="token comment">// 挂载boxen</span>
console<span class="token punctuation">.</span><span class="token function-variable function">boxen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">borderColor</span><span class="token operator">:</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span>
<span class="token literal-property property">borderStyle</span><span class="token operator">:</span> <span class="token string">'classic'</span><span class="token punctuation">,</span>
<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Vite-demo'</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">boxen</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">TYPE_MAP</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token punctuation">[</span><span class="token string">'feat'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'✨'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'feat'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'新的特性'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🐛'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'fix'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'修复Bug'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'merge'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🔀'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'merge'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'分支合并'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🎨'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'代码格式的更改'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'perf'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🚀'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'perf'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'提升性能'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'✅'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'添加或更新测试用例'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'revert'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'⏪️'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'revert'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'版本回退'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'📦'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'打包工具的更改'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'chore'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🔧'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'chore'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'更改配置文件'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'ci'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'👷'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'ci'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'对CI配置和脚本的更改'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'refactor'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'💻'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'refactor'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'代码进行重构'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'docs'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'📝'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'docs'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'添加或更新文档'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span><span class="token string">'release'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">emoji</span><span class="token operator">:</span> <span class="token string">'🔖'</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'release'</span><span class="token punctuation">,</span> <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'发布/版本标签'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// commit regexp</span>
<span class="token keyword">const</span> commitRE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">TYPE_MAP</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> title<span class="token punctuation">,</span> emoji <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">|</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>emoji<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)(\\(.+\\))?: .{1,100}</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> msgPath <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>msgPath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n#.*</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Merge.+branch \'.+\'</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>msgPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🔀 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'Merge'</span><span class="token punctuation">,</span> <span class="token string">'merge:'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commit信息内容不得超出100个字符串长度</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>commitRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 添加emoji</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> emoji <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token constant">TYPE_MAP</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>msgPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>emoji<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// show error feedback</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#fbb957'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'✨feat: 新的特性'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#41ae3c'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token string">'🐛fix: 修复Bug'</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#51c4d3'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'🔀merge: 分支合并'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#813c85'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token string">'🎨style: 代码格式的更改'</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#ef475d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'🚀perf: 提升性能'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#40a070'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token string">'✅test: 提升性能添加或更新测试用例'</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#63bbd0'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'⏪️revert: 版本回退'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span>
    <span class="token string">'#f8df70'</span>
  <span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'📦build: 打包工具的更改'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#158bb8'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token string">'🔧chore: 更改配置文件'</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#f9d367'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'👷ci: 对CI配置和脚本的更改'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span>
    <span class="token string">'#f86b1d'</span>
  <span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'💻refactor: 代码进行重构'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#d2568c'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token string">'📝docs: 添加或更新文档'</span>
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token string">'#f9d367'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'🔖release: 发布/版本标签'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">boxen</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commit信息不符合规范\n正确示例: "feat: 新增xxx功能..."\n正确示例: "feat(moduleName): 新增xxx功能..." </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span>
<span class="token comment">// process quit</span>
process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">boxen</span><span class="token punctuation">(</span><span class="token string">'commit 提交异常'</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4__env__1026"></a>4. 配置 <code>.env</code> 环境变量</h4> 
<p>因为我们修改了项目的根目录，所以在配置环境变量前，一定要记得在 <code>vite.config.ts</code> 中修改 <code>envDIr</code> 到相对于项目根的路径：</p> 
<pre><code class="prism language-js"><span class="token literal-property property">envDir</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
</code></pre> 
<p>然后就可以在根目录创建 <code>.env.development</code> 和 <code>.env.production</code> 文件来分别定义开发环境和生产环境的环境变量了。</p> 
<p><strong>需要注意的是：</strong> 只有以 <code>VITE_</code> 为前缀的变量才会生效。例如我们设置开发环境的接口基础路径：</p> 
<pre><code class="prism language-js"><span class="token constant">VITE_BASE_URL</span> <span class="token operator">=</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">api-test.xxx.com</span><span class="token regex-delimiter">/</span></span>
</code></pre> 
<h4><a id="5__1042"></a>5. 安装一些插件</h4> 
<ul><li><code>unplugin-vue-components</code> 【组件自动按需导入】</li></ul> 
<p>这里以 <code>vant</code> 为例，如下配置后，就不需要引入vant插件了，直接可以使用：</p> 
<pre><code class="prism language-js">pnpm add vant
pnpm add unplugin<span class="token operator">-</span>vue<span class="token operator">-</span>components <span class="token operator">-</span><span class="token constant">D</span>

<span class="token comment">//vite.config.ts</span>
<span class="token keyword">import</span> Components <span class="token keyword">from</span> <span class="token string">'unplugin-vue-components/vite'</span> <span class="token comment">//组件自动按需引入</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> VantResolver <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'unplugin-vue-components/resolvers'</span><span class="token punctuation">;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token function">Components</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">resolvers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">VantResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>unplugin-auto-import/vite</code> 【自动导入 Composition API】</li></ul> 
<p>配置这个插件后，就不需要引入例如 <code>ref、reactive、useRouter</code> 等 api 了。<br> 为了避免这些 api <code>undefined</code> 报错，需要生成 <code>auto-import.d.ts</code> 说明文件，注意在项目根路路径生成。</p> 
<pre><code class="prism language-js">pnpm add unplugin<span class="token operator">-</span>auto<span class="token operator">-</span><span class="token keyword">import</span><span class="token operator">/</span>vite <span class="token operator">-</span><span class="token constant">D</span>
<span class="token keyword">import</span> autoImport <span class="token keyword">from</span> <span class="token string">'unplugin-auto-import/vite'</span> <span class="token comment">//自动导入 Composition API</span>

<span class="token comment">//vite.config.ts</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token function">autoImport</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">imports</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'vue'</span><span class="token punctuation">,</span>
        <span class="token string">'vue-router'</span><span class="token punctuation">,</span>
        <span class="token string">'pinia'</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dts</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">"types/auto-import.d.ts"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">eslintrc</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 已存在文件设置默认 false，需要更新时再打开，防止每次更新都重新生成</span>
          <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token comment">// 生成文件地址和名称</span>
          <span class="token literal-property property">filepath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">"./.eslintrc-auto-import.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">globalsPropValue</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>rollup-plugin-visualizer</code> 【打包size分析工具】</li></ul> 
<p>打包后会在根目录下生成一个 <code>stats.html</code> 文件，用浏览器打开即可查看 chunk size 的结构。</p> 
<pre><code class="prism language-js">pnpm add rollup<span class="token operator">-</span>plugin<span class="token operator">-</span>visualizer <span class="token operator">-</span><span class="token constant">D</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> visualizer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-visualizer'</span> <span class="token comment">//打包size分析工具</span>

<span class="token comment">//vite.config.ts</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token function">visualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> 
<ul><li><code>vite-plugin-compression</code> 【打包压缩工具 gzip / br 】</li></ul> 
<p>打包时使用 <code>gzip</code> 或 <code>brotli</code> 进行压缩资源，以减小打包体积：</p> 
<pre><code class="prism language-js">pnpm add vite<span class="token operator">-</span>plugin<span class="token operator">-</span>compression <span class="token operator">-</span><span class="token constant">D</span>
<span class="token keyword">import</span> compression <span class="token keyword">from</span> <span class="token string">'vite-plugin-compression'</span> <span class="token comment">//gzip/br 压缩</span>

<span class="token comment">//vite.config.ts</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token comment">// gzip格式</span>
<span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>   <span class="token comment">// 体积大于 threshold 才会被压缩,单位 b</span>
  <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">'.gz'</span><span class="token punctuation">,</span>   <span class="token comment">// 压缩文件格式</span>
  <span class="token literal-property property">deleteOriginFile</span><span class="token operator">:</span> <span class="token boolean">false</span>   <span class="token comment">// 是否删除源文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">// br格式</span>
<span class="token comment">// compression({<!-- --></span>
<span class="token comment">//   threshold: 1024 * 500,    // 体积大于 threshold 才会被压缩,单位 b</span>
<span class="token comment">//   ext: '.br',</span>
<span class="token comment">//   algorithm: 'brotliCompress',</span>
<span class="token comment">//   deleteOriginFile: false</span>
<span class="token comment">// })</span>
<span class="token punctuation">]</span>
</code></pre> 
<h2><a id="__1130"></a>⏰ 写在最后</h2> 
<p>在搭建的过程中，<strong>一定要注意因为修改了项目根目录（root）所带来的问题</strong>，利用 <code>path.resolve(__dirname, ...)</code> 将路径重置到相对于项目根的位置！</p> 
<p>关于如何使用这个多页面脚手架，可以看 README.md 文件。</p> 
<p><a href="https://github.com/web-abin/vue3-mpa">github地址</a> 、<a href="https://gitee.com/web-abin/vue3-mpa" rel="nofollow">码云</a>。 如果对你有帮助，希望能点个star ⭐️⭐️⭐️ 万分感谢😊😊😊</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e74ea238cdf1dc031bea4511141b79d4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PyQt5&#43;Pyinstaller：从零开始将Python打包成一个程序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/818a51d952e93e59cdeac82d1668ea0b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Excel自学三部曲_Part1：excel中最常用的八大函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>