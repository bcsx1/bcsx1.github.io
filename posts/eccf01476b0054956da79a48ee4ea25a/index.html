<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Servlet】什么是Servlet；常见状态码；Servlet API；Cookie和Session - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Servlet】什么是Servlet；常见状态码；Servlet API；Cookie和Session" />
<meta property="og:description" content="Servlet 文章目录 Servlet1. Servlet是什么2. 第一个Servlet程序2.1 创建项目2.2 引入依赖2.3 创建目录2.4 编写代码2.5 打包程序2.6 部署程序2.7 验证程序 3. 更方便的部署方式(Smart Tomcat)3.1 安装Smart Tomcat插件3.2 配置Smart Tomcat插件 4. 常见的访问出错4.1 出现4044.2 出现4054.3 出现5004.4 出现&#34;空白页面&#34;4.5 出现&#34;无法访问此网站&#34;4.6 小结 5. Servlet运行原理6. Tomcat执行流程7. Servlet API7.1 HttpServlet1.核心方法2. 代码实例：处理GET请求3. 处理POST请求 7.2 HttpServletRequest1. 核心方法2. 打印请求信息3. 获取GET请求中的参数4. 获取POST请求中的参数(1)5. 获取POST请求中的参数(2)6. 获取POST请求中的参数(3) 7.3 HttpServletResponse1. 核心方法2. 示例：设置状态码3. 示例：自动刷新4. 示例：重定向 8. Cookie和Session8.1Cookie8.2 会话机制(Session)8.3 Cookie和Session的区别8.4 核心方法 9. 上传文件9.1 核心方法9.2 示例 1. Servlet是什么 Servlet是一种实现动态页面的技术，是一组Tomcat提供给程序猿的API，帮助程序猿简单高效的开发一个web app，主要是开发动态页面
静态页面也就是内容始终固定的页面，即使用户不同/时间不同/输入的参数不同，页面内容也不会发生变化。
动态页面就是用户不同/时间不同/输入的参数不同，页面内容会发生变化
构造动态页面的奇数有很多，每种语言都有意思额相关的库/框架来做这件事
Servlet就是Tomcat这个HTTP服务器提供给Java的一组API，来完成构建动态页面这个任务
Servlet主要做的工作
允许程序猿注册一个类，在Tomcat收到某个特定的HTTP请求的时候，执行这个类中的一些代码帮助程序猿解析HTTP请求，把HTTP请求从一个字符串解析成一个HttpRequest对象帮助程序猿构造HTTP响应，程序猿只要给指定的HttpResponse对象填写一些属性字段，Servlet就会自动的按照HTTP协议的方式构造出一个HTTP响应字符串，并通过Socket写回给客户端 2. 第一个Servlet程序 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/eccf01476b0054956da79a48ee4ea25a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-21T22:55:43+08:00" />
<meta property="article:modified_time" content="2022-06-21T22:55:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Servlet】什么是Servlet；常见状态码；Servlet API；Cookie和Session</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Servlet_0"></a>Servlet</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Servlet_0" rel="nofollow">Servlet</a></li><li><ul><li><a href="#1_Servlet_3" rel="nofollow">1. Servlet是什么</a></li><li><a href="#2_Servlet_21" rel="nofollow">2. 第一个Servlet程序</a></li><li><ul><li><a href="#21__23" rel="nofollow">2.1 创建项目</a></li><li><a href="#22__27" rel="nofollow">2.2 引入依赖</a></li><li><a href="#23__76" rel="nofollow">2.3 创建目录</a></li><li><a href="#24__118" rel="nofollow">2.4 编写代码</a></li><li><a href="#25__152" rel="nofollow">2.5 打包程序</a></li><li><a href="#26__176" rel="nofollow">2.6 部署程序</a></li><li><a href="#27__183" rel="nofollow">2.7 验证程序</a></li></ul> 
   </li><li><a href="#3_Smart_Tomcat_195" rel="nofollow">3. 更方便的部署方式(Smart Tomcat)</a></li><li><ul><li><a href="#31_Smart_Tomcat_199" rel="nofollow">3.1 安装Smart Tomcat插件</a></li><li><a href="#32_Smart_Tomcat_206" rel="nofollow">3.2 配置Smart Tomcat插件</a></li></ul> 
   </li><li><a href="#4__234" rel="nofollow">4. 常见的访问出错</a></li><li><ul><li><a href="#41_404_236" rel="nofollow">4.1 出现404</a></li><li><a href="#42_405_245" rel="nofollow">4.2 出现405</a></li><li><a href="#43_500_253" rel="nofollow">4.3 出现500</a></li><li><a href="#44__270" rel="nofollow">4.4 出现"空白页面"</a></li><li><a href="#45__274" rel="nofollow">4.5 出现"无法访问此网站"</a></li><li><a href="#46__286" rel="nofollow">4.6 小结</a></li></ul> 
   </li><li><a href="#5_Servlet_293" rel="nofollow">5. Servlet运行原理</a></li><li><a href="#6_Tomcat_322" rel="nofollow">6. Tomcat执行流程</a></li><li><a href="#7_Servlet_API_342" rel="nofollow">7. Servlet API</a></li><li><ul><li><a href="#71_HttpServlet_344" rel="nofollow">7.1 HttpServlet</a></li><li><ul><li><a href="#1_348" rel="nofollow">1.核心方法</a></li><li><a href="#2_GET_370" rel="nofollow">2. 代码实例：处理GET请求</a></li><li><a href="#3_POST_423" rel="nofollow">3. 处理POST请求</a></li></ul> 
    </li><li><a href="#72_HttpServletRequest_457" rel="nofollow">7.2 HttpServletRequest</a></li><li><ul><li><a href="#1__461" rel="nofollow">1. 核心方法</a></li><li><a href="#2__482" rel="nofollow">2. 打印请求信息</a></li><li><a href="#3_GET_525" rel="nofollow">3. 获取GET请求中的参数</a></li><li><a href="#4_POST1_565" rel="nofollow">4. 获取POST请求中的参数(1)</a></li><li><a href="#5_POST2_627" rel="nofollow">5. 获取POST请求中的参数(2)</a></li><li><a href="#6_POST3_704" rel="nofollow">6. 获取POST请求中的参数(3)</a></li></ul> 
    </li><li><a href="#73_HttpServletResponse_764" rel="nofollow">7.3 HttpServletResponse</a></li><li><ul><li><a href="#1__770" rel="nofollow">1. 核心方法</a></li><li><a href="#2__788" rel="nofollow">2. 示例：设置状态码</a></li><li><a href="#3__824" rel="nofollow">3. 示例：自动刷新</a></li><li><a href="#4__848" rel="nofollow">4. 示例：重定向</a></li></ul> 
   </li></ul> 
   </li><li><a href="#8_CookieSession_878" rel="nofollow">8. Cookie和Session</a></li><li><ul><li><a href="#81Cookie_887" rel="nofollow">8.1Cookie</a></li><li><a href="#82_Session_897" rel="nofollow">8.2 会话机制(Session)</a></li><li><a href="#83_CookieSession_914" rel="nofollow">8.3 Cookie和Session的区别</a></li><li><a href="#84__921" rel="nofollow">8.4 核心方法</a></li></ul> 
   </li><li><a href="#9__1093" rel="nofollow">9. 上传文件</a></li><li><ul><li><a href="#91__1097" rel="nofollow">9.1 核心方法</a></li><li><a href="#92__1115" rel="nofollow">9.2 示例</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_Servlet_3"></a>1. Servlet是什么</h3> 
<p>Servlet是一种实现动态页面的技术，是一组Tomcat提供给程序猿的API，帮助程序猿简单高效的开发一个web app，主要是开发动态页面</p> 
<p>静态页面也就是内容始终固定的页面，即使用户不同/时间不同/输入的参数不同，页面内容也不会发生变化。</p> 
<p>动态页面就是用户不同/时间不同/输入的参数不同，页面内容会发生变化</p> 
<p>构造动态页面的奇数有很多，每种语言都有意思额相关的库/框架来做这件事</p> 
<p>Servlet就是Tomcat这个HTTP服务器提供给Java的一组API，来完成构建动态页面这个任务</p> 
<p><strong>Servlet主要做的工作</strong></p> 
<ul><li>允许程序猿注册一个类，在Tomcat收到某个特定的HTTP请求的时候，执行这个类中的一些代码</li><li>帮助程序猿解析HTTP请求，把HTTP请求从一个字符串解析成一个HttpRequest对象</li><li>帮助程序猿构造HTTP响应，程序猿只要给指定的HttpResponse对象填写一些属性字段，Servlet就会自动的按照HTTP协议的方式构造出一个HTTP响应字符串，并通过Socket写回给客户端</li></ul> 
<h3><a id="2_Servlet_21"></a>2. 第一个Servlet程序</h3> 
<h4><a id="21__23"></a>2.1 创建项目</h4> 
<p>使用IDEA创建一个Maven项目</p> 
<h4><a id="22__27"></a>2.2 引入依赖</h4> 
<p>Maven项目创建完毕后，会自动生成一个pom.xml文件，在这个文件中，引入Servlet API依赖的jar包</p> 
<p>在中央仓库中搜索servlet，选择3.1.0版本，Servlet版本和Tomcat版本匹配，Tomcat选择8.5版本，Servlet就要使用3.1.0版本</p> 
<p>把中央仓库中提供的xml复制到项目的pom.xml中</p> 
<p><img src="https://images2.imgbox.com/3a/65/nDjHTk8u_o.jpg" alt="在这里插入图片描述"></p> 
<p>修改后的pom.xml：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- scope这个标签表示当前这个jar包只是在开发阶段使用，不需要打包到最终的发布包中，因为Tomcat里面内置了Servlet--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--    tomcat不能识别jar包,所以需要在这里设置打包格式,tomcat能识别war包,所以设置打包格式为war包--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--    为了方便测试访问,设置打包后的名字,--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>helloservlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>标签内部放置项目依赖的jar包，maven会自动下载赖以到本地，</p> 
<h4><a id="23__76"></a>2.3 创建目录</h4> 
<p><img src="https://images2.imgbox.com/4f/4e/STTIpM6G_o.png" alt="在这里插入图片描述"></p> 
<p>当项目创建好了之后，IDEA会自动帮我们创建一些目录：</p> 
<ul><li>src：表示源代码所在的目录</li><li>main/java：表示源代码的根目录，后续创建.java文件就放到这个目录里</li><li>main/resources：表示项目的一些资源文件所在的目录</li><li>test/java：表示测试代码的根目录</li></ul> 
<p>1、除了这些目录，还需要创建webapp目录，</p> 
<p>在main目录下，和java目录并列，创建一个webapp目录</p> 
<p>2、创建WEB-INF</p> 
<p>再在webapp目录中创建一个WEB-INF目录</p> 
<p>3、创建web.xml</p> 
<p>在WEB-INF目录中创建一个web.xml文件</p> 
<p><img src="https://images2.imgbox.com/06/11/2x6j3VHz_o.png" alt="在这里插入图片描述"></p> 
<p>往web.xml文件中拷贝以下代码：</p> 
<pre><code class="prism language-xml"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">web-app</span> <span class="token name">PUBLIC</span>
<span class="token string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span>
<span class="token string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">&gt;</span></span>Archetype Created Web Application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>webapp目录就是未来部署到Tomcat中的一个重要的目录，当前我们可以往webapp中放一些静态资源，比如html，css等</p> 
<p>在这个目录中还有一个重要的文件web.xml，Tomcat找到这个文件才能正确处理webapp中的动态资源</p> 
<h4><a id="24__118"></a>2.4 编写代码</h4> 
<p>在java目录中创建一个HelloServlet类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
<span class="token comment">//这个/hello就是HTTP请求中URL的路径，只要是这个路径的HTTP请求，就会调用这个HttpServlet对应的方法，如果是GET请求，就调用doGET方法，如果是POST请求，就调用doPOST方法，这个路径没有包含(Content Path，就是当前webapp的名字)</span>
<span class="token comment">//保证当前的类和一个特定的HTTP请求关联起来，</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello  world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个操作就是往HTTP响应的body中写了一个字符串</span>
        <span class="token comment">//不管请求是什么 ，都返回一个hello  world</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>首先创建一个类HelloServlet，继承自HttpServlet</li><li>在类上方加上注解，</li><li>重写doGet方法，doGet方法有两个参数，分别表示收到的HTTP请求和要构造的HTTP响应，这个方法会在Tomcat收到GET请求时触发</li><li>HttpServletRequest表示HTTP请求，Tomcat按照HTTP请求的格式把字符串格式的请求转成了一个HttpServletRequest对象，后续想要获取请求中的信息(例如方法，url，header，body等)都是通过这个对象来获取</li><li>HttpServletResponse表示HTTP响应，代码中把响应对象构造好(构造响应的状态码，header，body等)</li><li>resp.getWriter() 会获取到一个流对象，通过这个流对象就可以写入一些数据，写入的数据会被构造成一个HTTP响应的body部分，Tomcat会把整个响应转成字符串，通过socket写回给浏览器</li></ul> 
<p>此时我们的代码不是通过main方法作为入口了，main方法已经被包含在Tomcat里，我们写的代码会被Tomcat在合适的实际调用起来，这里写的代码并不是一个完整的程序，而是Tomcat这个程序的一小部分逻辑，也就是根据请求处理响应的逻辑，其他部分都由Tomcat完成。</p> 
<p><strong>类要满足以下条件，Tomcat才会调用</strong></p> 
<ol><li>创建的类需要继承自HttpServlet</li><li>这个类需要使用@WebServlet注解关联上一个HTTP的路径</li><li>这个类需要实现doXXX方法</li></ol> 
<p><strong>当这三个条件都满足之后，Tomcat就可以找到这个类，并且在合适的时机进行调用</strong></p> 
<h4><a id="25__152"></a>2.5 打包程序</h4> 
<p>使用maven进行打包，打开maven窗口，展开Lifecycle，双击package即可进行打包</p> 
<p>打包成功后，可以看到在target目录下，生成了一个jar包</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-mpTv2H6a-1655822589958)(C:\Users\Freedom\Desktop\CSDN\JAVA EE\Servlet图片\打包.jpg)]</p> 
<p>但是这样的jar包并不是我们所需要的，Tomcat需要识别的是另一种war包格式，还有一点，打包生成的war包名字太复杂了，所以要在pom.xml中设置打包格式和生成的war包的名称</p> 
<p>在pom.xml中新增一个packing标签，表示打包的方式是打一个war包，再新增一个build标签，内置一个finalName标签，表示打出的war包的名字是helloservlet</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>helloservlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>重新打包结果：</p> 
<p><img src="https://images2.imgbox.com/99/6d/qyZqf1KX_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="26__176"></a>2.6 部署程序</h4> 
<p>把war包拷贝到Tomcat的webapps目录下，启动Tomcat(在解压后的Tomcat目录的bin目录中，找到startup.bat，双击即可启动Tomcat)，Tomcat就会自动把war包解压缩</p> 
<p><img src="https://images2.imgbox.com/8c/d5/2Jkd7pJy_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="27__183"></a>2.7 验证程序</h4> 
<p>通过浏览器访问http://127.0.0.1:8080/helloservlet/hello 就可以看到结果了</p> 
<p><img src="https://images2.imgbox.com/ed/ba/gOL7aDIY_o.png" alt="在这里插入图片描述"></p> 
<p>URL中的PTH分成两个部分，其中helloservlet为Context Path，hello为WebServlet注解中的路径</p> 
<p><img src="https://images2.imgbox.com/2b/2d/PMKfpNf4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_Smart_Tomcat_195"></a>3. 更方便的部署方式(Smart Tomcat)</h3> 
<p>手动拷贝war包到Tomcat的过程比较麻烦，我们可以使用IDEA中的Smart Tomcat插件来完成这个工作</p> 
<h4><a id="31_Smart_Tomcat_199"></a>3.1 安装Smart Tomcat插件</h4> 
<p>File-&gt;Settings-&gt;plugins，搜索tomcat</p> 
<p><img src="https://images2.imgbox.com/0e/d9/JIKkE1CU_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="32_Smart_Tomcat_206"></a>3.2 配置Smart Tomcat插件</h4> 
<p>点击IDEA右上角的"ADD Configuration",选择左侧的"Smart Tomcat"</p> 
<p><img src="https://images2.imgbox.com/34/ea/BWBHmEGe_o.jpg" alt="在这里插入图片描述"></p> 
<p>Name这一栏可以随便填写，在Tomcat Server这一栏选择Tomcat所在的目录</p> 
<p><img src="https://images2.imgbox.com/58/e7/ZD48BIKf_o.png" alt="在这里插入图片描述"></p> 
<p>Context Path默认填写的值是项目的名称</p> 
<p>配置完成后，启动程序，IDEA就会自动进行过编译，部署，启动Tomcat的过程</p> 
<p>在浏览器中使用http://127.0.0.1:8080/servlet/hello 访问页面</p> 
<p><img src="https://images2.imgbox.com/08/eb/fKhY5PuJ_o.png" alt="在这里插入图片描述"></p> 
<p>路径的对应关系:</p> 
<p><img src="https://images2.imgbox.com/3f/3f/n2VFKUsB_o.png" alt="在这里插入图片描述"></p> 
<p>使用Smart Tomcat部署的时候，可以发现Tomcat的webapps内部并没有拷贝一个war包，也没有看到解压缩的内容，Smart Tomcat相当于是在Tomcat启动的时候直接引用了项目中的webapp和target目录</p> 
<h3><a id="4__234"></a>4. 常见的访问出错</h3> 
<h4><a id="41_404_236"></a>4.1 出现404</h4> 
<p>404表示用户访问的资源不存在，大概率是URL的路径写的不正确，</p> 
<ul><li>例如少写了Context Path：127.0.0.1:8080/hello</li><li>少写了Servlet Path：127.0.0.1:8080/servlet</li><li>Servlet Path写的和URL不匹配:代码中@WebServlet注解中路径为(“/helloServlet”)，此时再用127.0.0.1:8080/servlet/hello 访问就访问不到了，两个路径要匹配才行</li><li>web.xml写错了，也会出现404</li></ul> 
<h4><a id="42_405_245"></a>4.2 出现405</h4> 
<p>405表示对象的HTTP请求方法没有实现。例如：没有实现doGet方法</p> 
<p>在浏览器地址栏直接输入URL，会发送一个HTTP GET请求</p> 
<p>此时就会根据/servlet/hello这个路径找到HelloServlet这个类，并且尝试调用类中的doGet方法，如果没有实现doGet方法，就会出现405</p> 
<h4><a id="43_500_253"></a>4.3 出现500</h4> 
<p>500状态码一般时Servlet代码中抛出异常导致的</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里设置一个String类型的s，引用为null，尝试将s的长度写入响应时会发生空指针异常。此时页面就会出现500</p> 
<h4><a id="44__270"></a>4.4 出现"空白页面"</h4> 
<p>如果不往响应中写内容，就会出现空白页面，通过抓包可以看到响应的body为空</p> 
<h4><a id="45__274"></a>4.5 出现"无法访问此网站"</h4> 
<p>一般就是Tomcat启动失败了</p> 
<p>例如：Servlet Path 写错了，将@WebServlet注解中写为(“hello”)，没有加斜杠，</p> 
<p><img src="https://images2.imgbox.com/77/4e/ft2mPEiw_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/42/60/Ct6Y6wAB_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="46__286"></a>4.6 小结</h4> 
<ul><li>4xx的状态码表示路径不存在，需要检查URL是否正确，和代码中设定的Context Path以及 Servlet Path是否一致</li><li>5xx的状态码表示服务器出现错误，需要观察页面的提示内容和Tomcat自身的日志，观察是否存在报错</li><li>出现连接失败一般是Tomcat没有正确启动，也需要观察Tomcat的自身日志是否有错误提示</li><li>空白页面这种情况需要我们使用抓包工具来分析HTTP请求响应的具体交互过程</li></ul> 
<h3><a id="5_Servlet_293"></a>5. Servlet运行原理</h3> 
<p><strong>Tomcat的定位</strong></p> 
<p><img src="https://images2.imgbox.com/9f/8f/XCWyKNHq_o.jpg" alt="在这里插入图片描述"></p> 
<p>当浏览器给服务器发送请求的时候，Tomcat作为HTTP服务器就可以接收到这个请求，HTTP协议作为一个应用层协议，需要底层协议来支持工作</p> 
<p><img src="https://images2.imgbox.com/6e/59/UNnCtYzP_o.jpg" alt="在这里插入图片描述"></p> 
<p>接收请求：</p> 
<ol><li>用户在浏览器中输入一个URL，此时浏览器就会构造一个HTTP请求</li><li>这个HTTP请求会经过网络协议栈逐层进行封装成二进制bit流，最终通过物理层的硬件设备转换成光电信号传输出去</li><li>这个承载信息的光电信息通过互联网上的一系列网络设备，最终到达目的主机，这个过程也需要网络层和数据链路层的参与</li><li>服务器收到这些信号，通过网络协议栈的逐层分用，层层解析，最终还原成HTTP请求，交给Tomcat进程进行处理，根据端口号确定进程</li><li>Tomcat通过Socket读取到这个请求，并按照HTTP请求的格式来解析这个请求，根据请求中的Context Path确定一个webapp，再通过Servlet Path确定一个具体的类，再根据当前请求的方法，决定调用这个类中的哪个方法，get对应doGet，post对应doPost…此时我们的代码中这些处理请求的方法中的第一个参数HttpServletRequest就包含了这个HTTP请求的详细信息</li></ol> 
<p>根据请求计算响应：</p> 
<ul><li>我们的代码会根据请求中的信息，给HttpServletResponse对象设置属性，例如状态码，header。body等</li></ul> 
<p>返回响应：</p> 
<ol><li>代码执行完毕后，Tomcat就会自动把HttpServletResponse这个对象转换成一个符合HTTP协议的字符串，通过Socket把这个响应发送出去</li><li>和接收请求一样，通过网络协议栈层层封装和分用，最终到达浏览器，浏览器通过Socket读到这个响应，按照HTTP响应的格式解析，并且把body中的数据按照一定的格式显示在浏览器的界面上</li></ol> 
<h3><a id="6_Tomcat_322"></a>6. Tomcat执行流程</h3> 
<p>Tomcat初始化逻辑：</p> 
<ul><li>Tomcat内置了main方法，当我们启动Tomcat的时候就是从main方法开始执行的</li><li>被@WebServlet注解修饰的类会在Tomcat启动的时候就被获取到，并集中管理</li><li>Tomcat通过反射这样的语法机制来创建被@WebServlet注解修饰的类的实例</li><li>这些实例被创建完了之后，会调用其中的init方法进行初始化，这些实例销毁之前，会调用destory方法进行收尾工作，这两个方法我们自己写的类都可以重写，但是注意destory这个方法，如果我们重写了，但是直接结束掉Tomcat进行，那么destory就来不及执行，</li><li>Tomcat内部也是通过Socket API进行网络通信的</li><li>为了能同时响应多个HTTP请求，采取多线程的方式实现，因此Servlet是运行在多线程环境下的</li></ul> 
<p>Tomcat处理请求逻辑：</p> 
<ul><li>Tomcat从Socket中读取到的HTTP请求是一个字符串，然后会按照HTTP协议的格式解析成一个HttpServletRequest对象</li><li>根据URL中的path判定这个请求是要请求一个静态资源还是动态资源，如果是静态资源，直接找到对应的文件，把文件的内容通过socket返回，如果是动态资源，才会执行到Servlet的相关逻辑</li><li>根据URL中的Context Path 和Servlet Path确定要调用哪个Servlet实例的service方法</li><li>通过service方法，就会进一步调用到我们之前写的doGet或者doPost</li></ul> 
<p>Servlet的service方法内部会根据当前请求的方法，决定调用其中某个doxxx方法，在调用doxxx方法的时候，因为我们创建的类继承了HttpServlet类，HttpServlet又继承自Servlet类，并且重写了doxxx方法，所以就会触发多态机制，从而执行到我们自己写的子类中的doxxx方法</p> 
<h3><a id="7_Servlet_API_342"></a>7. Servlet API</h3> 
<h4><a id="71_HttpServlet_344"></a>7.1 HttpServlet</h4> 
<p>我们写Servlet代码的时候，首先第一步就是创建类，继承自HttpServlet，并且重写其中的某些方法(例如doGet，doPost)</p> 
<h5><a id="1_348"></a>1.核心方法</h5> 
<table><thead><tr><th>方法名称</th><th>调用时机</th></tr></thead><tbody><tr><td>init</td><td>在HttpServlet实例化之后被调用一次</td></tr><tr><td>destory</td><td>在HttpServlet实例不再使用的时候调用一次</td></tr><tr><td>service</td><td>收到HTTP请求时候调用</td></tr><tr><td>doGet</td><td>收到GET请求的调用(由service方法调用)</td></tr><tr><td>doPost</td><td>收到POST请求的时候调用(由service方法调用)</td></tr><tr><td>doPut/…</td><td>收到其他请求的时候调用(由service方法调用)</td></tr></tbody></table> 
<p>Servlet生命周期：</p> 
<ol><li>Servlet在实例化之后被调用一次init</li><li>Servlet每次收到HTTP请求，调用一次service</li><li>Servlet在销毁之前，调用一次destory</li></ol> 
<p><img src="https://images2.imgbox.com/a7/8d/YVs3uKZQ_o.jpg" alt="在这里插入图片描述"></p> 
<p>HttpServlet的实例只是在程序启动时创建一次，而不是每次收到HTTP请求都重新创建实例</p> 
<h5><a id="2_GET_370"></a>2. 代码实例：处理GET请求</h5> 
<p>创建MethodServlet.java 重写doGet方法，当接收到一个HTTP GET请求时，返回一个响应，内容为"GET 响应"</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/method"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"GET 响应"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>创建testMethod.html，放到webapp目录中，</p> 
<p><img src="https://images2.imgbox.com/df/0d/WTBJbKTf_o.jpg" alt="在这里插入图片描述"></p> 
<p>一个Servlet程序中可以同时部署静态文件，静态文件放在webapp目录中</p> 
<p>通过一个按钮，为这个按钮创建一个回调函数，当按钮被点击时，向服务器发送一个HTTP GET请求，HTTP请求通过ajax的方式构造，type表示请求的方法，url表示请求的路径，回调函数中的data表示服务器返回的响应内容</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">sendGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>发送GET请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
         <span class="token keyword">function</span> <span class="token function">sendGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"method"</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
     </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>重新部署程序，使用URL 127.0.0.1:8080/servlet/testMethod.html访问页面，点击"发送GET请求"按钮，可以在控制台中看到响应内容，通过Fiddler抓包可以看到，当浏览器中输入URL之后，浏览器先给服务器发送了一个HTTP GET请求，服务器返回一个HTML页面的响应，当点击"发送GET请求"按钮后，浏览器又通过ajax给服务器发送一个HTTP GET请求，响应的body中内容为"GET 响应"</p> 
<h5><a id="3_POST_423"></a>3. 处理POST请求</h5> 
<p>在MethodServlet.java中，新增doPOST方法</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"POST 响应"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>在testMethod.html中新增一个按钮，和对应的点击事件处理函数</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">sendPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>发送POST请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">function</span> <span class="token function">sendPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"method"</span><span class="token punctuation">,</span>
                <span class="token comment">// POST请求的body</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">"request body"</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>重新部署程序，用相同的方法访问testMethod.html页面，点击"发送POST请求"，也可以在控制台中看到”POST 响应“</p> 
<h4><a id="72_HttpServletRequest_457"></a>7.2 HttpServletRequest</h4> 
<p>Tomcat通过Socket API读取HTTP请求，并且按照HTTP协议的格式把字符串解析成HttpServletRequest对象</p> 
<h5><a id="1__461"></a>1. 核心方法</h5> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>String getProtocol()</td><td>返回请求协议的名称和版本</td></tr><tr><td>String getMethod()</td><td>返回请求的HTTP方法的名称，例如GET,POST</td></tr><tr><td>String getRequestURI()</td><td>从协议名称直到HTTP请求的第一行的查询字符串中，返回该请求的URL的一部分</td></tr><tr><td>String getContextPath()</td><td>返回值是请求上下文的请求URI部分</td></tr><tr><td>String getQueryString()</td><td>返回包含在路径后的请求URL中的查询字符串</td></tr><tr><td>Enumeration getParameterNames()</td><td>返回一个String对象的枚举，相当于返回query string中所有键值对的key</td></tr><tr><td>String getParameter(String name)</td><td>以字符串形式返回指定key对应的value，如果参数不存在就返回null</td></tr><tr><td>String [] getParameterValues(String name)</td><td>返回一个字符串对象数组，包含指定key对应的所有value，针对key重复的情况，如果参数不存在则返回null</td></tr><tr><td>Enumeration getHeaderNames()</td><td>返回一个枚举，包含请求中header中所有的key</td></tr><tr><td>String getHeader(String name)</td><td>以字符串形式返回header中指定key的value</td></tr><tr><td>String getCharacterEncoding()</td><td>返回请求body中使用的字符编码的名称</td></tr><tr><td>String getContentType()</td><td>返回请求body中数据格式类型，如果不知道类型则返回null</td></tr><tr><td>int getContentLength()</td><td>以字节为单位返回请求body的长度，并提供输入流。如果长度未知则返回-1</td></tr><tr><td>InputStream getInputStream()</td><td>用于读取请求的body内容，返回一个InputStream对象</td></tr></tbody></table> 
<p>通过这些方法可以获取到一个请求中的各个方面的信息</p> 
<h5><a id="2__482"></a>2. 打印请求信息</h5> 
<p>创建ShowRequestServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/showRequest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShowRequestServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//设置body格式</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//把生成的响应的body放入respBody</span>
        <span class="token class-name">StringBuilder</span> respBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取到请求的版本号</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;h3&gt;headers&lt;/h3&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headerNames <span class="token operator">=</span>  req<span class="token punctuation">.</span><span class="token function">getHeaderNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>headerNames<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> headerName <span class="token operator">=</span> headerNames<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>headerName<span class="token operator">+</span><span class="token string">": "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>headerName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            respBody<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;br&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//respBody转为字符串写入响应</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>respBody<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>重新部署程序。在浏览器中输入127.0.0.1:8080/servlet/showRequest?a=10&amp;b=20</p> 
<p><img src="https://images2.imgbox.com/80/ea/d6uoMrNB_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_GET_525"></a>3. 获取GET请求中的参数</h5> 
<p>GET请求中的参数一般是通过query string传递给服务器的，在服务器端可以通过getParameter来获取到参数的值，query string里面的内容是程序猿自定义的内容，每个键值对的键和值都是程序猿自己定义好的</p> 
<p><strong>约定query string 中键值对例如：userId=100&amp;classId=200</strong></p> 
<p>创建GetParameterServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/getParameter"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetParameterServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//这是获取GET请求URL中的query string</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> classId <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"classId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//对query string 进行判定是否存在  key不存在 或者key存在value不存在 都视为query string不存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> userId<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//具体处理</span>
        <span class="token punctuation">}</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"userId:%s , classId: %s"</span><span class="token punctuation">,</span>userId<span class="token punctuation">,</span>classId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>重新部署程序，在浏览器中输入127.0.0.1:8080/servlet/getParameter</p> 
<p>可以看到当query string为空时，getParameter获取的值为null</p> 
<p><img src="https://images2.imgbox.com/41/f6/fsl0VBBq_o.png" alt="在这里插入图片描述"></p> 
<p>当在浏览器中输入127.0.0.1:8080/servlet/getParameter/userId=123&amp;classId=456 时可以看到：</p> 
<p><img src="https://images2.imgbox.com/dc/46/Ddg6p2TC_o.png" alt="在这里插入图片描述"></p> 
<p>此时说明服务器已经获取到客户端传过来的参数，注意：getParameter的返回值类型为String，如果需要对这个值进行算术运算，就需要手动将它转为int类型，Integer.parseInt</p> 
<h5><a id="4_POST1_565"></a>4. 获取POST请求中的参数(1)</h5> 
<p>POST请求的参数一般通过body传递给服务器，body中的数据格式有很多种，</p> 
<p><strong>如果采用form表单的形式，body中的数据格式为application/x-www-form-urlencoded，仍然可以通过getParameter获取参数的值</strong></p> 
<p>约定请求形如：</p> 
<p>创建PostParameterServlet类，</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/postParameter"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostParameterServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//POST请求中的body类型是application/x-www-form-urlencoded时，和获取query string的方式一样</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userId <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> classId <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"classId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"userId:%s;classId:%s &lt;br&gt;"</span><span class="token punctuation">,</span>userId<span class="token punctuation">,</span>classId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>创建testPost.html,放到webapp目录中</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>testPost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>postParameter<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classId<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>重新部署程序，在浏览器中输入 127.0.0.1:8080/servlet/testPost.html 可以看到HTML，</p> 
<p><img src="https://images2.imgbox.com/a6/39/v6qxsKyh_o.png" alt="在这里插入图片描述"></p> 
<p>输入内容，点击提交，可以看到跳转到了新的页面，并显示出了刚刚提交的数据</p> 
<p><img src="https://images2.imgbox.com/91/3f/F3A7UFlV_o.png" alt="在这里插入图片描述"></p> 
<p>通过抓包可以看到，form表单构造的body数据的格式为：</p> 
<p><img src="https://images2.imgbox.com/5d/cd/yZ0YFXeQ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_POST2_627"></a>5. 获取POST请求中的参数(2)</h5> 
<p><strong>如果POST请求中的body是按照json的格式来传递，可以先把整个body的字符串读取出来，再进行解析</strong></p> 
<p>约定请求形如：</p> 
<p>/servlet/postParameterJson</p> 
<p>{“userId”: 123,“classId”: 456} ，“key”: value格式</p> 
<p>创建PostParameterJsonServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/postParameterJson"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostParameterJsonServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//因为body类型是json，所以要先把POST请求的整个body读出来</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token function">readBody</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里只是读出来了，并没有解析</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">readBody</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//读取body需要根据req getInputStream得到一个流对象，从这个流对象中获取body</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//具体读多少个字节，可以通过Content-Length 可以拿到请求body中的字节数</span>
        <span class="token keyword">int</span> contentlength <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getContentLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>contentlength<span class="token punctuation">]</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>创建testPostJson.html</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>testPostJson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 构造body为json格式的数据,就只能用ajax的方式来实现 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">sendJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>发送请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">sendJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
                <span class="token literal-property property">classId</span><span class="token operator">:</span> <span class="token number">456</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"postParameterJson"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token comment">//设置请求中body数据的格式类型</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">body<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p><img src="https://images2.imgbox.com/c7/30/HKcejP0m_o.jpg" alt="在这里插入图片描述"></p> 
<p>通过浏览器可以看到响应的数据仍为一个整体的String类型，如果想要获取到userId和classId的具体值，还需要搭配json库进一步解析</p> 
<h5><a id="6_POST3_704"></a>6. 获取POST请求中的参数(3)</h5> 
<p>引入Jackson这个库，进行JSON解析</p> 
<p><img src="https://images2.imgbox.com/da/d5/bY5qzHgS_o.jpg" alt="在这里插入图片描述"></p> 
<p>把中央仓库中的依赖配置添加到pom.xml中，</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>修改代码:</p> 
<pre><code class="prism language-java"><span class="token comment">//通过这个类来表示解析后的结果</span>
<span class="token keyword">class</span> <span class="token class-name">JsonData</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> classId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/postParameterJson"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostParameterJsonServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//因为body类型是json，所以要先把POST请求的整个body读出来</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token function">readBody</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//使用jackson解析，先创建一个jackson的核心对象，objectMapper</span>
        <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonData</span> jsonData <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token class-name">JsonData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"userId: %d;classId: %d &lt;br&gt;"</span>
                <span class="token punctuation">,</span>jsonData<span class="token punctuation">.</span>userId<span class="token punctuation">,</span>jsonData<span class="token punctuation">.</span>classId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">readBody</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//读取body需要根据req getInputStream得到一个流对象，从这个流对象中获取body</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//具体读多少个字节，可以通过Content-Length 可以拿到请求body中的字节数</span>
        <span class="token keyword">int</span> contentlength <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getContentLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>contentlength<span class="token punctuation">]</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/9f/32/9gAQy1ka_o.png" alt="在这里插入图片描述"></p> 
<ul><li>JsonData这个类用来表示解析之后生成的json对象，这个类的属性的名字和类型要和json字符串的key对应</li><li>jackson库的核心类为ObjectMapper，其中的readVaule方法把json字符串转成java对象，其中的writeVauleAsString方法把一个Java对象转成json格式的字符串</li><li>readVaule的第二个参数为JsonData的类对象，通过这个类对象，在readVaule的内部就可以借助反射机制来构造出JsonData对象，并且根据json中key的名字，把对应的value赋值给JsonData的对应字段</li></ul> 
<h4><a id="73_HttpServletResponse_764"></a>7.3 HttpServletResponse</h4> 
<p>Servlet中的doxxx方法的目的就是根据请求计算得到响应，然后把响应的数据设置到HttpServletResponse对象中</p> 
<p>然后Tomcat就会把这个HttpServletResponse对象按照HTTP协议的格式，转成一个字符串，并通过Socket写回给浏览器</p> 
<h5><a id="1__770"></a>1. 核心方法</h5> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>void setStatus(int sc)</td><td>为该响应设置状态码</td></tr><tr><td>void setHeader(String name,String value)</td><td>设置一个带有给定名称和值的header，如果name已经存在，则覆盖旧的值</td></tr><tr><td>void addHeader(String name,String value)</td><td>添加一个带有给定名称和值的header，如果name已经存在，不覆盖旧的值，并列添加新的键值对</td></tr><tr><td>void setContentType(String type)</td><td>设置被发送到客户端的响应的body类型</td></tr><tr><td>void setCharacterEncoding(String charset)</td><td>设置被发送到客户端的响应的字符编码，例如utf-8</td></tr><tr><td>void sendRedirect(String location)</td><td>设置重定向位置URL，发送临时重定向响应到客户端</td></tr><tr><td>PrintWriter getWriter()</td><td>用于往body中写入文本格式数据</td></tr><tr><td>OutputStream getOutputStream()</td><td>用于往body中写入二进制格式数据</td></tr></tbody></table> 
<p><strong>注意</strong></p> 
<ol><li>响应对象是服务器要返回给浏览器的内容，这里的重要信息都是程序猿设置的，因此上面的方法都是写方法</li><li>对于状态码和响应头的设置要放到getWriter/getOutputStream之前，否则可能设置失效</li></ol> 
<h5><a id="2__788"></a>2. 示例：设置状态码</h5> 
<p>实现一个程序，用户在浏览器通过参数指定要返回响应的状态码</p> 
<p>创建StatusServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/status"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatusServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//让用户传入一个请求，在query string中带一个参数，代表响应的状态码。</span>
        <span class="token comment">//根据用户不同的输入，返回不同的状态码</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> statusString <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>statusString <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> statusString<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"当前的请求的参数status缺失"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        resp<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>statusString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置响应码为用户传入的参数,将字符串转成int</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"status: "</span><span class="token operator">+</span>statusString<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//响应body内容</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>部署程序，在浏览器中输入127.0.0.1:8080/servlet/status?status=200 可以看到</p> 
<p><img src="https://images2.imgbox.com/c3/a9/0gYo0Op2_o.png" alt="在这里插入图片描述"></p> 
<p>使用不同的status值，可以看到不同的响应结果，通过Fiddler抓包也可以看到响应结果</p> 
<p><img src="https://images2.imgbox.com/53/95/ynpr6Th9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3__824"></a>3. 示例：自动刷新</h5> 
<p>实现一个程序，让浏览器每秒钟自动刷新一次，并显示当前的时间戳</p> 
<p>创建AutoRefreshServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/autoRefresh"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoRefreshServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Refresh"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> timeStamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个方法可以获取到当前的毫秒级时间戳</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"timestamp: "</span><span class="token operator">+</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>通过设置HTTP响应报头中的Refresh字段，可以控制浏览器自动刷新的时间</p> 
<p>部署程序，浏览器中输入 127.0.0.1:8080/servlet/autoRefresh 访问页面，可以看到浏览器每秒钟自动刷新一次</p> 
<h5><a id="4__848"></a>4. 示例：重定向</h5> 
<p>实现一个程序，返回一个重定向HTTP响应，自动跳转到另一个页面</p> 
<p>创建RedirectServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/redirect"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedirectServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        resp.setStatus(302);</span>
<span class="token comment">//        resp.setHeader("Location","https://www.sogou.com/");</span>
        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"https://www.sogou.com/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//直接设置url发送临时重定向响应到客户端</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>可以通过设置状态码为302，header中Location的值完成页面跳转</p> 
<p>也可以直接设置url发送临时重定向响应到客户端</p> 
<p>部署程序，浏览器中输入 127.0.0.1:8080/servlet/redirect 访问页面，可以看到页面自动跳转到搜狗主页了。通过抓包可以看到HTTP请求的具体流程</p> 
<p><img src="https://images2.imgbox.com/c6/36/0eVpDfX6_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到当浏览器中输入url时，服务器返回了一个状态码为302的响应，header中Location表示页面将跳转到www.sogou.com， 紧接着又发送了一个获取到搜狗主页的HTTP请求</p> 
<h3><a id="8_CookieSession_878"></a>8. Cookie和Session</h3> 
<p>HTTP协议自身是属于"无状态"协议，无状态指的是：默认情况下HTTP协议的客户端和服务器之间的这次通信，和下次通信之间没有直接的联系</p> 
<p>但是实际开发中，我们需要知道请求之间的关联关系</p> 
<p><img src="https://images2.imgbox.com/ee/56/5um6uDAZ_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="81Cookie_887"></a>8.1Cookie</h4> 
<p>Cookie是HTTP协议中的一个字段，<strong>是浏览器在客户端这边保存数据的方式</strong>，浏览器会根据域名/地址分别存储cookie。</p> 
<p>Cookie是通过HTTP响应的set-Cookie字段来进行设置，是服务器返回给浏览器的。</p> 
<p>Cookie会在下次请求中自动添加到请求中，发送给服务器，</p> 
<p>Cookie中存储的是键值对结构的字符串，这些都是程序猿自定义的</p> 
<h4><a id="82_Session_897"></a>8.2 会话机制(Session)</h4> 
<p>服务器同一时刻收到的请求是很多的，服务器需要清楚的区分每个请求是属于哪个用户，就需要服务器这边记录每个用户的信息的对应关系</p> 
<p>会话的本质就是一个"哈希表"，存储了一些键值对结构，key就是sessionId，vaule是用户信息，用户信息可以根据需求设计</p> 
<p>Session是由服务器生成的一个"唯一性字符串"，从session机制的角度来看，这个唯一性字符串称为"sessionId"，站在整个登录流程的角度来看，也可以把这个唯一性字符串称为"token"</p> 
<p><img src="https://images2.imgbox.com/d4/00/18rgEbAL_o.jpg" alt="在这里插入图片描述"></p> 
<ul><li>当用户登录的时候，服务器在Session中新增一个新记录，并且把sessionId/token返回给客户端，例如通过HTTP响应中的Set-Cookie字段返回</li><li>客户端后续再给服务器发送请求的时候，需要在请求中带上sessionId/token，例如通过HTTP请求中的Cookie字段带上</li><li>服务器收到请求之后，根据请求中的sessionId/tonke在Session信息中获取到对应的用户的信息，再进行后续操作</li></ul> 
<p><strong>Servlet的Session默认是保存在内存中的，如果重启服务器则Session数据就会丢失</strong></p> 
<h4><a id="83_CookieSession_914"></a>8.3 Cookie和Session的区别</h4> 
<ol><li>Cookie是客户端的机制，Session是服务器端的机制</li><li>Cookie和Session经常在一起配合使用，但是不是必须配合 
  <ul><li>可以用Cookie来保存一些数据在客户端，这些数据不一定是用户身份信息，也不一定是sessionId/token</li><li>Session中的sessionId/token也不是非得通过Cookie/Set-Cookie传递</li></ul> </li></ol> 
<h4><a id="84__921"></a>8.4 核心方法</h4> 
<p><strong>HttpServletRequest类中的相关方法</strong></p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>HttpSession getSession()</td><td>在服务器中获取会话，参数如果为true，则当不存在会话时新建会话；参数如果为false，则当不存在会话时返回null</td></tr><tr><td>Cookie[] getCookie()</td><td>返回一个数组，包含客户端发送该请求的所有的Cookie对象，会自动把Cookie中的格式解析成键值对</td></tr></tbody></table> 
<p><strong>HttpServletResponse类中的相关方法</strong></p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>void addCookid(Cookie cookie)</td><td>把指定的cookie添加到响应中</td></tr></tbody></table> 
<p><strong>HttpSession类中的相关方法</strong></p> 
<p>一个HttpSession对象里面包含多个键值对，我们可以往HttpSession中存任何我们需要的信息</p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Object getAttribute(String name)</td><td>该方法返回在该session会话中具有指定名称的对象，也就是返回指定key的value，如果没有指定名称的对象，则返回null</td></tr><tr><td>void setAttribute(String name,Object value)</td><td>该方法使用指定的名称绑定一个对象到该session会话</td></tr><tr><td>boolean isNew()</td><td>判定当前是否是新创建出的会话</td></tr></tbody></table> 
<p><strong>Cookie类中的相关方法</strong></p> 
<p>每个Cookie对象都是一个键值对</p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>String getName()</td><td>该方法返回cookie的名称，名称在创建后不能改变，这个值是Set-Cookie字段设置给浏览器的</td></tr><tr><td>String getValue()</td><td>该方法获取与cookie关联的值</td></tr><tr><td>void setVaule(String newVaule)</td><td>该方法设置与cookie关联的值</td></tr></tbody></table> 
<p>HTTP的Cookie字段中存储的实际上是多组键值对，每个键值对在Servlet中都对应了一个Cookie对象</p> 
<p>通过HttpServletRequest.getCookies()获取到请求中的一系列Cookie键值对</p> 
<p>通过HttpServletResponse.addCookies()可以向响应中添加新的Cookie键值对</p> 
<p><strong>示例：实现用户登录</strong></p> 
<p>实现简单的用户登录逻辑，主要是通过HttpSession类完成，并不需要我们手动操作Cookie对象</p> 
<p>先有一个html，包含用户名密码的输入框，登录按钮</p> 
<p>LoginServlet类来处理登录请求</p> 
<p>IndexServlet类，模拟登陆完成后，跳转到的主页，在这个主页里面就能够获取到用户的身份信息，比如用户的用户名和访问次数</p> 
<p>login.html，放到webapp目录中</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>登录<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>LoginServlet</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.从请求的body中读取用户名和密码</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.判断用户名密码是否正确，此处不读数据库，固定用户名为zhangsan密码为123，</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"zhangsan"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token string">"123"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//登录失败</span>
           resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"用户名密码不正确"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登陆成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.登录成功就创建一个会话信息，参数为true，则会话不存在就创建</span>
        <span class="token comment">//会话是根据请求中的sessionId查找的，sessionId在Cookie中，</span>
        <span class="token comment">//此处是首次登录，没有Cookie,Cookie是服务器返回的，所以就触发创建"会话"，</span>
        <span class="token comment">//这里的创建"会话"，就是创建一个HttpSession对象作为value</span>
        <span class="token comment">//再生成一个随机的字符串作为sessionId 也就是key</span>
        <span class="token comment">//把这个key value插入到表中。同时把这个生成的sessionId同构Cookie字段返回给浏览器</span>
        <span class="token class-name">HttpSession</span> httpSession <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//还可以存入程序猿自定义的数据，比如存入身份信息(用户名和登录次数)</span>
        httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"loginCount"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//因为这里的setAttribute的第两个参数是Object类型，不能直接写int0</span>
        <span class="token comment">// 但是此处的0会触发自动装箱，将int0构造成Integer 0</span>
        <span class="token comment">//4.让页面跳转到主页，使用重定向</span>
        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>此处的getSession参数为true，表示查不到HttpSession时会创建新的HttpSession对象，并且生成一个sessionId，插入到哈希表中，并且把sessionId通过Set-Cookie返回给浏览器</p> 
<p>IndexServlet</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//根据当前用户请求中的sessionId，获取用户信息，并显示到页面上</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.判定当前用户是否已经登录了.也就是请求中有没有sessionId，以及是否合法</span>
        <span class="token comment">//如果会话不存在，就不创建，这里只是查询是否存在。而不是不存在就创建，</span>
        <span class="token class-name">HttpSession</span> httpSession <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>httpSession <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//当前没有合法会话，当前用户没有登录，就重定向到登陆页面，让用户进行登录</span>
            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//2.用户已经登录，就从httpsession中获取到用户信息，</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> httpSession<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> loginCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> httpSession<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"loginCount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loginCount <span class="token operator">=</span> loginCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//将访问次数加1，并写回</span>
        httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"loginCount"</span><span class="token punctuation">,</span>loginCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.返回一个HTML页面。显示获取到的信息，。</span>
        <span class="token class-name">StringBuilder</span> html <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        html<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;div&gt;用户: "</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">"&lt;/div&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        html<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;div&gt;访问次数: "</span><span class="token operator">+</span> loginCount <span class="token operator">+</span> <span class="token string">"&lt;/div&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>在这个代码中看不到"哈希表"，也看不到sessionId这样的概念，getSession操作内部提取到请求中的Cookie里的sessionId，然后查找哈希表，获取到对应的HttpSession对象</p> 
<p>getSession参数为false，则获取不到HttpSession，不会创建新的HttpSession，而是返回null，此时说明用户没有登录</p> 
<p>部署程序，通过127.0.0.1:8080/messagewall/index 访问</p> 
<p>首次访问的时候可以看到，当前用户尚未登录，此时页面自动重定向到login.html</p> 
<p>在login.html中输入用户名密码之后，会跳转到/login路径，此时服务器返回了一个sessionId,并在Session中记录用户信息，然后重定向到/index</p> 
<p><img src="https://images2.imgbox.com/a6/c3/be1RUMPp_o.png" alt="在这里插入图片描述"></p> 
<ol><li>第一次访问index时，用户还没有登录，直接重定向到login.html页面</li><li>输入用户名密码登陆成功后，跳转到login页面，并且生成了一个sessionId，再跳转到index主页</li></ol> 
<p><img src="https://images2.imgbox.com/60/25/slNbW4sh_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到第一次登录成功时，响应Set-Cookie字段中有JESSIONID属性，随机生成了一个唯一性的字符串，后续跳转到主页面index时，请求中就会通过Cookie带着这个字段，</p> 
<p><img src="https://images2.imgbox.com/8a/a7/d6JlCH3j_o.png" alt="在这里插入图片描述"></p> 
<p>服务器返回的JESSIONID和后续用户请求的Cookie中所传递的JESSIONID是一样的，这就相当于是用户的唯一身份标识</p> 
<h3><a id="9__1093"></a>9. 上传文件</h3> 
<p>在Servlet中也支持上传文件</p> 
<h4><a id="91__1097"></a>9.1 核心方法</h4> 
<p><strong>HttpServletRequest类方法</strong></p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>Part getPart(String name)</td><td>获取请求中给定name的文件</td></tr><tr><td>Collection getParts()</td><td>获取所有的文件</td></tr></tbody></table> 
<p><strong>Part类方法</strong></p> 
<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>String getSubmittedFileName()</td><td>获取提交的文件名</td></tr><tr><td>String getContentTypr()</td><td>获取提交的文件类型</td></tr><tr><td>long getSize()</td><td>获取文件的大小</td></tr><tr><td>void writy(String path)</td><td>把提交的文件数据写入磁盘文件</td></tr></tbody></table> 
<h4><a id="92__1115"></a>9.2 示例</h4> 
<p>实现程序，通过网页提交一个图片到服务器上</p> 
<p>创建upload.html，放到webapp目录中</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>上传图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MyImage<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>上传图片<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<ul><li>上传文件一般通过POST请求的表单实现</li><li>在form中要加上multipart/form-data</li></ul> 
<p>创建UploadServlet类</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@MultipartConfig</span><span class="token comment">//加上这个注解 servlet才能正确读取文件中的内容</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.从req对象中读取中part对象</span>
        <span class="token class-name">Part</span> part <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getPart</span><span class="token punctuation">(</span><span class="token string">"MyImage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//参数是HTML中form表单input标签中的name属性值</span>
        <span class="token comment">//2.读取part对象中的一些参数</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span><span class="token function">getSubmittedFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取出上传的文件的真实文件名</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件类型</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件大小</span>
        <span class="token comment">//3.把文件写入到指定目录中</span>
        part<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"c:/MyImage.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.返回响应</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"upload ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<ul><li>需要给UploadServlet加上@MultipartConfig注解，否则服务器代码无法使用getiPart方法</li><li>getPart的参数需要和form中input标签的name属性对应</li><li>客户端一次可以提交多个文件(使用多个input标签)，此时服务器就可以通过getParts获取所有的Part对象</li></ul> 
<p>部署程序，在浏览器中通过 127.0.0.1:8080/messagewall/upload,html 访问</p> 
<p><img src="https://images2.imgbox.com/9c/a5/It0Le2oN_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到Content-Type为multipart/form-data这样的请求中带有一个boundary，值为随机生成的字符串，这个字符串在body这边作为一个"分割线"，分割线下面是上传的文件的属性和文件的内容</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c573a07d9ed7177c9d75859db69ebd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Android -- 面试】Android 知识点（四大组件）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35fa2c216b3ec8851f5fb9f342b7d892/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android逆向必备工具</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>