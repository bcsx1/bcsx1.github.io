<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[深度学习]Part1 Python学习进阶Ch24图像处理OpenCV（24.1~24.13）——【DeepBlue学习笔记】 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[深度学习]Part1 Python学习进阶Ch24图像处理OpenCV（24.1~24.13）——【DeepBlue学习笔记】" />
<meta property="og:description" content="本文仅供学习使用
Python高级——Ch24图像处理OpenCV（24.1~24.13） 24. 图像处理OpenCV24.1 图像读取、显示、保存24.1.1 图像的基本操作24.1.2 摄像头/视频读取、写入24.1.3 简单实例应用 24.2 常用数据结构与颜色空间24.2.1 OpenCV常用数据结构24.2.2 图像基础24.2.3 基本绘图函数24.2.4 访问图像像素24.2.5 对比度亮度调整与通道分离合并24.2.6 图像翻转——Numpy 24.3 图像基本运算24.3.1 图像算数运算24.3.2 图像逻辑运算24.3.2 图像复制 24.4 图像ROI与mask掩码24.4.1 感兴趣区域ROI24.4.2 mask—掩码/掩膜操作24.4.3 ROI图像融合 24.5 图像几何变换24.5.1 图像缩放—cv2.resize()24.5.2 图像平移24.5.3 图像旋转24.5.4 转置和镜像24.5.5 重映射—cv2.remap()24.5.6 透视变换——图像校正 24.6 OpenCV界面事件操作24.6.1 鼠标操作24.6.2 鼠标操作&#43;透视变换 24.7 图像滤波24.7.1 图像滤波简介24.7.2 方框滤波——cv2.boxFilter()24.7.3 均值滤波——cv2.blur()24.7.4 高斯滤波——cv2.GaussianBlur()24.7.5 中值滤波——cv2.medianBlur()24.7.5 双边滤波——cv2.bilateralFilter() 24.8 图像阈值化24.8.1 图像阈值化简介24.8.2 固定阈值——`cv2.threshold()`24.8.3 自适应阈值——`cv2.adaptiveThreshold()`24.8.4 Otsu阈值化24.8.5 全局阈值——threshold 24.9 图像形态学操作24.9.1 膨胀——cv2.dilate()24.9.2 腐蚀——cv2.erode()24.9.3 开运算(open)24.9.4 闭运算(close)24.9.5 形态学梯度(Gradient)24.9.6 顶帽(Top Hat)24.9.7 黒帽(Black Hat) 24.10 图像边缘检测24.10.1 Canny边缘检测24.10.2 Sobel算子24.10.3 Laplacian算子 24." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ff023605d95c24d553568650b8d9cd36/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-09T09:24:24+08:00" />
<meta property="article:modified_time" content="2022-07-09T09:24:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[深度学习]Part1 Python学习进阶Ch24图像处理OpenCV（24.1~24.13）——【DeepBlue学习笔记】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文仅供学习使用</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>Python高级——Ch24图像处理OpenCV（24.1~24.13）</h4> 
 <ul><li><a href="#24_OpenCV_7" rel="nofollow">24. 图像处理OpenCV</a></li><li><ul><li><a href="#241___59" rel="nofollow">24.1 图像读取、显示、保存</a></li><li><ul><li><a href="#2411___63" rel="nofollow">24.1.1 图像的基本操作</a></li><li><a href="#2412___195" rel="nofollow">24.1.2 摄像头/视频读取、写入</a></li><li><a href="#2413___385" rel="nofollow">24.1.3 简单实例应用</a></li></ul> 
   </li><li><a href="#242___441" rel="nofollow">24.2 常用数据结构与颜色空间</a></li><li><ul><li><a href="#2421__OpenCV_442" rel="nofollow">24.2.1 OpenCV常用数据结构</a></li><li><a href="#2422___461" rel="nofollow">24.2.2 图像基础</a></li><li><a href="#2423___527" rel="nofollow">24.2.3 基本绘图函数</a></li><li><a href="#2424___622" rel="nofollow">24.2.4 访问图像像素</a></li><li><a href="#2425__685" rel="nofollow">24.2.5 对比度亮度调整与通道分离合并</a></li><li><a href="#2426_Numpy_750" rel="nofollow">24.2.6 图像翻转——Numpy</a></li></ul> 
   </li><li><a href="#243___778" rel="nofollow">24.3 图像基本运算</a></li><li><ul><li><a href="#2431__780" rel="nofollow">24.3.1 图像算数运算</a></li><li><a href="#2432___847" rel="nofollow">24.3.2 图像逻辑运算</a></li><li><a href="#2432___913" rel="nofollow">24.3.2 图像复制</a></li></ul> 
   </li><li><a href="#244_ROImask_944" rel="nofollow">24.4 图像ROI与mask掩码</a></li><li><ul><li><a href="#2441__ROI_945" rel="nofollow">24.4.1 感兴趣区域ROI</a></li><li><a href="#2442__mask_968" rel="nofollow">24.4.2 mask—掩码/掩膜操作</a></li><li><a href="#2443_ROI_1022" rel="nofollow">24.4.3 ROI图像融合</a></li></ul> 
   </li><li><a href="#245__1114" rel="nofollow">24.5 图像几何变换</a></li><li><ul><li><a href="#2451_cv2resize_1115" rel="nofollow">24.5.1 图像缩放—cv2.resize()</a></li><li><a href="#2452__1178" rel="nofollow">24.5.2 图像平移</a></li><li><a href="#2453___1259" rel="nofollow">24.5.3 图像旋转</a></li><li><a href="#2454___1339" rel="nofollow">24.5.4 转置和镜像</a></li><li><a href="#2455__cv2remap_1365" rel="nofollow">24.5.5 重映射—cv2.remap()</a></li><li><a href="#2456___1396" rel="nofollow">24.5.6 透视变换——图像校正</a></li></ul> 
   </li><li><a href="#246_OpenCV_1416" rel="nofollow">24.6 OpenCV界面事件操作</a></li><li><ul><li><a href="#2461__1477" rel="nofollow">24.6.1 鼠标操作</a></li><li><a href="#2462___1558" rel="nofollow">24.6.2 鼠标操作+透视变换</a></li></ul> 
   </li><li><a href="#247__1591" rel="nofollow">24.7 图像滤波</a></li><li><ul><li><a href="#2471___1592" rel="nofollow">24.7.1 图像滤波简介</a></li><li><a href="#2472__cv2boxFilter_1616" rel="nofollow">24.7.2 方框滤波——cv2.boxFilter()</a></li><li><a href="#2473__cv2blur_1628" rel="nofollow">24.7.3 均值滤波——cv2.blur()</a></li><li><a href="#2474__cv2GaussianBlur_1644" rel="nofollow">24.7.4 高斯滤波——cv2.GaussianBlur()</a></li><li><a href="#2475__cv2medianBlur_1655" rel="nofollow">24.7.5 中值滤波——cv2.medianBlur()</a></li><li><a href="#2475__cv2bilateralFilter_1663" rel="nofollow">24.7.5 双边滤波——cv2.bilateralFilter()</a></li></ul> 
   </li><li><a href="#248__1675" rel="nofollow">24.8 图像阈值化</a></li><li><ul><li><a href="#2481___1677" rel="nofollow">24.8.1 图像阈值化简介</a></li><li><a href="#2482___cv2threshold_1684" rel="nofollow">24.8.2 固定阈值——`cv2.threshold()`</a></li><li><a href="#2483___cv2adaptiveThreshold_1704" rel="nofollow">24.8.3 自适应阈值——`cv2.adaptiveThreshold()`</a></li><li><a href="#2484_Otsu_1745" rel="nofollow">24.8.4 Otsu阈值化</a></li><li><a href="#2485_threshold_1791" rel="nofollow">24.8.5 全局阈值——threshold</a></li></ul> 
   </li><li><a href="#249__1844" rel="nofollow">24.9 图像形态学操作</a></li><li><ul><li><a href="#2491_cv2dilate_1879" rel="nofollow">24.9.1 膨胀——cv2.dilate()</a></li><li><a href="#2492__cv2erode_1987" rel="nofollow">24.9.2 腐蚀——cv2.erode()</a></li><li><a href="#2493_open_2033" rel="nofollow">24.9.3 开运算(open)</a></li><li><a href="#2494_close_2053" rel="nofollow">24.9.4 闭运算(close)</a></li><li><a href="#2495_Gradient_2071" rel="nofollow">24.9.5 形态学梯度(Gradient)</a></li><li><a href="#2496_Top_Hat_2103" rel="nofollow">24.9.6 顶帽(Top Hat)</a></li><li><a href="#2497_Black_Hat_2122" rel="nofollow">24.9.7 黒帽(Black Hat)</a></li></ul> 
   </li><li><a href="#2410__2138" rel="nofollow">24.10 图像边缘检测</a></li><li><ul><li><a href="#24101_Canny_2159" rel="nofollow">24.10.1 Canny边缘检测</a></li><li><a href="#24102_Sobel_2200" rel="nofollow">24.10.2 Sobel算子</a></li><li><a href="#24103_Laplacian_2280" rel="nofollow">24.10.3 Laplacian算子</a></li></ul> 
   </li><li><a href="#2411___2296" rel="nofollow">24.11 霍夫变换及应用</a></li><li><a href="#2412___2299" rel="nofollow">24.12 直方图计算及绘制</a></li><li><ul><li><a href="#24121__2301" rel="nofollow">24.12.1 图像直方图概述</a></li><li><a href="#24122__2373" rel="nofollow">24.12.2 直方图相关及应用</a></li></ul> 
   </li><li><a href="#2413__2447" rel="nofollow">24.13 模板匹配及应用</a></li><li><ul><li><a href="#24131__2448" rel="nofollow">24.13.1 模板匹配</a></li><li><a href="#24132_cv2matchTemplate_2455" rel="nofollow">24.13.2 模板匹配——cv2.matchTemplate()</a></li><li><a href="#24133_cv2normalize_2523" rel="nofollow">24.13.3 矩阵归一化——cv2.normalize()</a></li><li><a href="#24134_cv2minMaxLoc_2535" rel="nofollow">24.13.4 寻找最值——cv2.minMaxLoc()</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="24_OpenCV_7"></a>24. 图像处理OpenCV</h2> 
<p>OpenCV<code>(Open Source Computer Vision Library)</code>是一个基于(开源免费)发行的跨平台计算机视觉库，可以运行在Linux、Windows、Android、ios等操作系统上，它轻量级而且高效—由一系列C函数和少量C++类构成，同时提供了Python、Ruby、MATLAB等语言的接口，实现了图像处理和计算机视觉方面的诸多通用算法。</p> 
<p><strong>参考网址</strong><br> <a href="http://docs.opencv.org/3.0-beta/doc/py_tutorials/py_tutorials.html" rel="nofollow">http://docs.opencv.org/3.0-beta/doc/py_tutorials/py_tutorials.html</a><br> <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html" rel="nofollow">https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html</a><br> <a href="http://docs.opencv.org/2.4/genindex.html" rel="nofollow">http://docs.opencv.org/2.4/genindex.html</a></p> 
<p><strong>OpenCV模块简介：</strong><br> <code>import cv2</code><br> 【core】–核心功能模块，包含OpenCV基本数据结构和绘图函数等<br> 【imgproc】–Image/Process,包含滤波、几何变换、直方图相关、 特征检测、运动分析和形状描述等<br> 【highgui】–高层图形用户界面，包含媒体输入输出、视频捕捉、 图像和视频的编码解码、图形交互界面接口等<br> 【calib3d】–Calibration和3D,相机标定和三维重建相关<br> 【contrib】–新增人脸识别、立体匹配、人工视网膜模型等技术<br> 【features2d】–2D功能框架，主要包含特征检测和描述及接口<br> 【flann】–快速最近邻搜索算法和聚类<br> 【gpu】–运用GPU加速的计算机视觉模块<br> 【legacy】–(弃用)包含运动分析、平面细分、描述符提取等<br> 【ml】–Machine Learning,机器学习模块<br> 【objdetect】–目标检测模块(级联分类器和SVM)<br> 【photo】–包含图像修复和图像去噪两部分<br> 【stitching】–图像拼接模块<br> 【……】</p> 
<p><strong>OpenCV安装</strong><br> <code>pip install opencv-python</code></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">print</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre> 
<p><strong>一个简单的程序</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token comment">#图像的基本操作</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/fengjing.jpg'</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>

k <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 等待按键</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
<span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>         <span class="token comment"># wait for ESC key to exit</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> k <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># wait for 's' key to save and exit</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'datas/messigray.png'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 销毁所有窗口</span>
</code></pre> 
<h3><a id="241___59"></a>24.1 图像读取、显示、保存</h3> 
<p><strong>OpenCV图像处理系统一般组成：</strong><br> <img src="https://images2.imgbox.com/da/b2/EAoJYGma_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2411___63"></a>24.1.1 图像的基本操作</h4> 
<p>图像读取：<code>cv2.imread()</code><br> 窗口创建：<code>cv2.namedWindow()</code><br> 图像显示：<code>cv2.imshow()</code><br> 图像保存：<code>cv2.imwrite()</code><br> 资源释放：<code>cv2.destroyWindow()</code><br> <img src="https://images2.imgbox.com/3d/2d/gREPlA66_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token comment">#图像的基本操作</span>

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/fengjing.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>  <span class="token comment"># 显示原图</span>

hsv_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span>  <span class="token comment"># 转为HSV图像</span>
cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">"hsv"</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>WINDOW_AUTOSIZE<span class="token punctuation">)</span>  <span class="token comment"># 创建hsv窗口</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"hsv"</span><span class="token punctuation">,</span>hsv_img<span class="token punctuation">)</span>  <span class="token comment"># 显示hsv图像</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">"hsv.jpg"</span><span class="token punctuation">,</span>hsv_img<span class="token punctuation">)</span>  <span class="token comment"># 保存hsv图像</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 等待按键按下</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 销毁所有窗口</span>
</code></pre> 
<blockquote> 
 <p>cv2.imread(filename, [flags])<br> <strong>第一个参数，需要填入图片路径名</strong>，支持如下格式：<br> · Windows bitmaps -<code>*.bmp</code>,<code>*.dib</code>(always supported)<br> · JPEG files-<code>*.jpeg</code>,<code>*.jng</code>,<code>*.jpe</code> (see the Motes section)<br> · JPEG 2000 files -<code>*.jp2</code>(see the Ntes section)<br> · Portable Network Graphics -<code>*png</code> (see the Motes section)<br> · Portable image format-<code>*.pbm</code>,<code>*.pgm</code>,<code>*.ppm</code> (always supported)<br> · Sun rasters -<code>*.sr</code>,<code>*.ras</code>(always supported)<br> · TIFF files -<code>*.tiff</code>,<code>*.tif</code>(see the Notes section)<br> <strong>注意路径格式用\或/，同时路径中不要有中文</strong><br> <strong>第二个参数，指定加载图像的颜色类型</strong> ，默认为1：<br> <code>cv2.IMREAD cOLOR</code> # 读入彩色图像，透明度被忽略，对应宏定义为1（默认参数）<br> <code>cv2.IMREAD GRAYSCALE</code> # 以灰度模式读入图像，对应宏定义为0<br> <code>cv2.IMREAD UNCHANGED</code> # 读入图像包含alpha通道，对应宏定义为-1<br> <strong>警告∶就算图像的路径是错的，OpenCV 也不会提醒你的，但是当你使用命令print img时得到的结果是None。</strong></p> 
</blockquote> 
<p>通过判断img是否为None来避免异常发生</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2

img0 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/fengjing.jpg'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token comment">#0</span>
<span class="token keyword">if</span> img0 <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'imgread is error'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'imgread is ok'</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img0'</span><span class="token punctuation">,</span>img0<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>img0<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (546,820)  一个通道</span>
    
img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/fengjing.jpg'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#0</span>
<span class="token keyword">if</span> img0 <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'imgread is error'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'imgread is ok'</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">,</span>img1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (546,820,3)  三个通道</span>

<span class="token comment">#  不同通道下的灰度图——RGB</span>
img1_0 <span class="token operator">=</span> img1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
img1_1 <span class="token operator">=</span> img1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
img1_2 <span class="token operator">=</span> img1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1_0'</span><span class="token punctuation">,</span>img1_0<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1_1'</span><span class="token punctuation">,</span>img1_1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1_2'</span><span class="token punctuation">,</span>img1_2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>namedWindow(winnname, [flags])<br> <strong>第一个参数，表示窗口名称，传入字符串即可</strong><br> <strong>第二个参数，窗口显示方式，取值如下:</strong><br> <code>cv2.WINDOW NORMAL</code> # 正常大小显示，用户可以改变窗口大小<br> <code>cv2.WINDow AUTOSIZE</code> # 根据图像大小自动调整，用户不能手动改变窗口大小</p> 
</blockquote> 
<blockquote> 
 <p>imshow(winnname, mat)<br> <strong>第一个参数，设置需要显示的窗口名称</strong><br> <strong>第二个参数，填写需要显示的图像</strong></p> 
</blockquote> 
<blockquote> 
 <p>imwrite(filename, img, [params])<br> <strong>第一个参数，设置保存的文件名，需填写后缀，如"1.bmp"</strong><br> <strong>第二个参数，要保存的Mat类型图像数据</strong><br> <strong>第三个参数，表示特定格式保存的参数编码，一般采用默认值不填写</strong><br> 对于JPEG，其表示的是图像的质量，用0~100的整数表示，默认为95<br> 对于PNG，第三个参数表示的是压缩级别，从0到9，压缩级别越高，图像尺寸越小，默认级别为3</p> 
</blockquote> 
<blockquote> 
 <p>waitKey([delay])<br> 第一个参数，如果delay&gt;0, 表示等待delay毫秒之后结束; 如果delay=0, 表示无限等待，直到有按键按下结束<br> 返回值为对应按下按键的ASCII码值, 如Esc的ASCII码为27</p> 
</blockquote> 
<pre><code class="prism language-python">k <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
<span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>         <span class="token comment"># wait for ESC key to exit</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">elif</span> k <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># wait for 's' key to save and exit</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'datas/messigray.png'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>destroyWindow(winname) / destroyAllWindow()<br> cv2.destroyWindow()销毁指定窗口，参数填窗口名称<br> cv2.destroyAllWindows()销毁所有打开的GUI窗口</p> 
</blockquote> 
<blockquote> 
 <p><code>img is None</code> 判断图像是否为空(读取是否成功）<br> <code>img.shape[0]</code> 获取图像行数(高度)<br> <code>img.shape[1]</code> 获取图像列数(宽度)<br> <code>img.shape[2]</code> 获取图像通道数<br> <code>img.size</code> 获取总的像素个数(宽度x高度x通道数)<br> <code>img.dtype</code> 获取图像的数据类型</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/fengjing.jpg'</span><span class="token punctuation">)</span>
<span class="token comment">#cv2显示 BGR</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'cv2'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#matlab显示 RGB</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#顺序调整</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Release everything if job is finished</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2412___195"></a>24.1.2 摄像头/视频读取、写入</h4> 
<p><strong>VideoCapture类:</strong> OpenCV2.x及以上版本新增VideoCapture类，提供了从摄像机或视频文件捕获视频的C++接口。<br> <strong>VideoCapture类三种构造函数方法：</strong></p> 
<blockquote> 
 <p>Python: <code>cv2.VideoCapture() → &lt;VideoCapture object&gt;</code><br> Python:<code>cv2.VideoCapture(filename) → &lt;VideoCapture object&gt;</code><br> Python:<code>ev2.VideoCapture(device) → &lt;VideoCapture object&gt;</code><br> <strong>参数说明：</strong><br> 参数filename表示输入视频文件的路径及名称<br> device表示打开摄像头索引号</p> 
</blockquote> 
<p><strong>取帧方法：</strong><br> Python: <code>cv2.VideoCapture.read([image]) → retval, image</code></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2

<span class="token comment"># 视频的基本操作 —— 单帧图片 </span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># device</span>
ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ret是否能取到帧，frame帧图片(ndarray)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2

<span class="token comment"># 视频的基本操作  —— 视频  </span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># device</span>
ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ret是否能取到帧，frame帧图片(ndarray)</span>
count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    count <span class="token operator">+=</span> <span class="token number">1</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">240</span><span class="token punctuation">:</span>
        cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># frame = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)#颜色空间转换</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>VideoCapture类常用函数功能：</strong></p> 
<blockquote> 
 <p>cv2.VideoCapture.open(filename) → retval<br> cv2.VideoCapture.open(device) → retval<br> 如果不能指定摄像头——(0, CAP_DSHOW) DirectShow，windows系统的视频管理系统<br> <code>open()</code>—打开视频文件或者摄像头</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment">#cap = cv2.VideoCapture(0)  #device</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'datas/vedioplay.mp4'</span><span class="token punctuation">)</span> <span class="token comment">#filename</span>
<span class="token comment"># cap = cv2.VideoCapture()</span>
<span class="token comment"># cap.open('datas/vedioplay.mp4')</span>
</code></pre> 
<blockquote> 
 <p>cv2.VideoCapture.isOpened()→ retval<br> <code>isOpened()</code>–判断读取视频文件是否正确，正确返回true</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>cv2.VideoCapture.release() → None<br> <code>release()</code>—关闭视频流文件</p> 
</blockquote> 
<blockquote> 
 <p>cv2.VideoCapture.grab（）→ retval<br> <code>grab()</code>—抓取下一帧的视频文件或设备</p> 
</blockquote> 
<blockquote> 
 <p>cv2.VideoCapture.retrieve([image[,channel]]) → retval, image → retval, image<br> <code>retrieve()</code>—解码并返回视频帧</p> 
</blockquote> 
<blockquote> 
 <p>cv2.VideoCapture.get(propId) → retval<br> <code>get()</code>—返回指定视频类的相关参数信息</p> 
</blockquote> 
<blockquote> 
 <p>cv2.VideoCapture.set(propId,value) → retval<br> <code>set()</code>—设置类信息的一个属性</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 视频属性</span>
<span class="token keyword">import</span> cv2
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'datas/vedioplay.mp4'</span><span class="token punctuation">)</span>

<span class="token comment"># 帧率</span>
fps <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>  <span class="token comment"># 25.0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Frames per second using video.get(cv2.CAP_PROP_FPS) : {0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>fps<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 总共有多少帧</span>
num_frames <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_COUNT<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'共有'</span><span class="token punctuation">,</span> num_frames<span class="token punctuation">,</span> <span class="token string">'帧'</span><span class="token punctuation">)</span>
<span class="token comment">#</span>
frame_height <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span>
frame_width <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'高：'</span><span class="token punctuation">,</span> frame_height<span class="token punctuation">,</span> <span class="token string">'宽：'</span><span class="token punctuation">,</span> frame_width<span class="token punctuation">)</span>

<span class="token comment">#FRAME_NOW = cap.get(cv2.CAP_PROP_POS_FRAMES)  # 第0帧</span>
<span class="token comment">#print('当前帧数', FRAME_NOW)  # 当前帧数 0.0</span>

<span class="token comment"># Release everything if job is finished</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>读取视频:</strong><br> 说明：视频读取本质上就是读取图像，因为视频是由一帧一帧图像组成的。</p> 
<ol><li>读取视频的两种方法：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 1</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'datas/vedioplay.mp4'</span><span class="token punctuation">)</span> <span class="token comment">#filename</span>

<span class="token comment"># 2</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token punctuation">)</span>
cap<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'datas/vedioplay.mp4'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>循环显示每一帧：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>  <span class="token comment"># ret == False</span>
        <span class="token keyword">break</span>
    hsv_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span> <span class="token comment"># 颜色空间转换</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span>  hsv_frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'1.bmp'</span><span class="token punctuation">,</span> hsv_frame<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>几点说明：</p> 
 <ol><li> <p>打开的视频可以是本地视频如:<code>cv2.VideoCapture cap("1.avi");</code><br> 也可以是网络视频如：<code>cv2.VideoCapture cap("http://www.laganiere.name/bike.avi");</code></p> </li><li> <p>读取视频一定要加异常判断<br> ① 打开视频失败(各种原因)<br> ② 取帧失败异常(程序结尾判断)<br> ex1:<code>if(cap.isopened())∶#检查打开是否成功</code><br> ex2:</p> </li></ol> 
 <pre><code class="prism language-python">ret<span class="token punctuation">,</span>frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># if（frame is None）∶# 判断当前帧是否为空</span>
<span class="token keyword">if</span> ret<span class="token operator">==</span><span class="token boolean">False</span>∶<span class="token comment"># 判断取帧是否失败</span>
	<span class="token keyword">break</span>
</code></pre> 
</blockquote> 
<p><strong>写入视频:</strong></p> 
<ol><li>VideoWriter：<br> Opencv提供VideoWriter类写视频文件，类的构造函数可以指定文件名、播放帧率、帧尺寸、是否创建彩色视频。</li></ol> 
<blockquote> 
 <p><code>cv2.VideoWriter([filename, fourcc, fps, frameSize[, isColor]) → &lt;VideoWriter object&gt;</code><br> · <strong>filename</strong> - Name of the output video file.<br> · <strong>fourcc</strong> - 4-character code of codec used to compress the frames. For example,CV_FOURCC(‘P’,‘I’,‘M’,‘1’)is a MPEG-1 codec, CV_FOURCC('M,‘J’,‘P’,‘G’) of codes can be obtained at <code>Video Codecs by FOURCC</code> page.<br> · <strong>fps</strong> - Framerate of the created video stream.<br> · <strong>frameSize</strong> - Size of the video frames.<br> · <strong>isColor</strong> - If it is not zero,the encoder will expect and encode color frames,otherwise it will work with grayscale frames(the flag is current)</p> 
</blockquote> 
<ol start="2"><li>写入帧方法</li></ol> 
<blockquote> 
 <p><code>fourcc = cv2.VideoWriter_fourcc(*'XVID')</code><br> <code>out= cv2.VideoWriter('output.avi',fourcc,20.0,(640,480))</code><br> <code>out.write(frame)</code></p> 
</blockquote> 
<ol start="3"><li>注意事项：</li></ol> 
<blockquote> 
 <p>写入视频前需安装对应的编解码器<br> 生成视频是否支持彩色应与构造函数设置一致<br> 生成视频尺寸需与读取视频尺寸一致</p> 
</blockquote> 
<p><strong>视频保存</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'datas/vedioplay.mp4'</span><span class="token punctuation">)</span>
height <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span>
width <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span>

<span class="token comment">#写入帧方法</span>
fourcc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'MJPG'</span><span class="token punctuation">)</span>  <span class="token comment"># opencv 3.0 #cv2.VideoWriter_fourcc('X','V','I','D')</span>

<span class="token comment">#创建一个视频写入对象 VideoWriter</span>
out <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'datas/output20220617-1.mp4'</span><span class="token punctuation">,</span> fourcc<span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>

<span class="token comment"># Release everything if job is finished</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2413___385"></a>24.1.3 简单实例应用</h4> 
<p><strong>视频分解:</strong> 读取视频并分解为一张一张的图片保存</p> 
<p><strong>批量读取图片:</strong></p> 
<ol><li>有序图片读取：根据图片名的规律来对文件名进行格式化，然后统一读入；</li><li>无序图片读取：文件名无规律，通过Windows相关方法读取。</li></ol> 
<p>**图片合成视频:**将一张一张的图片合成为视频保存</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random

<span class="token comment"># 1.读取datas/2-PI231imgs文件夹中的任意一张图片，并查看该图片的通道数。</span>
path_org <span class="token operator">=</span> <span class="token string">r"F:\2-PI231imgs"</span>  <span class="token comment"># 文件夹路径</span>
File_in_path <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path_org<span class="token punctuation">)</span>  <span class="token comment"># 获取该文件夹下所有的文件名 的一个列表</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
Choice_File <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>File_in_path<span class="token punctuation">)</span>  <span class="token comment"># 随机抽取一个文件</span>
path_get <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path_org<span class="token punctuation">,</span>Choice_File<span class="token punctuation">)</span>  <span class="token comment"># 随机文件的地址</span>

img_get <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>path_get<span class="token punctuation">)</span>  <span class="token comment"># 读取文件图片（默认为彩色图）</span>

<span class="token keyword">if</span> img_get <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'文件</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>Choice_File<span class="token punctuation">}</span></span><span class="token string">读取地址有误'</span></span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'文件</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>Choice_File<span class="token punctuation">}</span></span><span class="token string">的通道数为</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img_get<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


<span class="token comment"># 2.将 datas/2-PI231imgs文件夹中的图片保存成格式为mp4的视频</span>
Files_in_path <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path_org<span class="token punctuation">,</span>File_path<span class="token punctuation">)</span> <span class="token keyword">for</span> File_path <span class="token keyword">in</span> File_in_path<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Files_in_path<span class="token punctuation">)</span>
<span class="token comment"># 获取文件的尺寸大小</span>
test_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>Files_in_path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> test_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"图片读取错误！"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>test_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    wid <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>test_img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span>wid<span class="token punctuation">)</span>
    fourcc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'XVID'</span><span class="token punctuation">)</span>
    out<span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'output.avi'</span><span class="token punctuation">,</span>fourcc<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token punctuation">(</span>wid<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> path <span class="token keyword">in</span> Files_in_path<span class="token punctuation">:</span>
        img_in_path <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token comment"># cv2.waitKey(3)</span>
        <span class="token comment"># cv2.imshow('test',img_in_path)</span>
        out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_in_path<span class="token punctuation">)</span>
    

out<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'视频以保存'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="242___441"></a>24.2 常用数据结构与颜色空间</h3> 
<h4><a id="2421__OpenCV_442"></a>24.2.1 OpenCV常用数据结构</h4> 
<ol><li><strong>Point类</strong><br> Point类数据结构表示二维坐标系的点，由坐标x, y指定的2D点，Python中直接用元组(x,y)</li><li><strong>Rect类</strong><br> Rect类用来表示矩形，成员有x,y, width, height，Python中直接用元组(x,y,w,h)<br> <img src="https://images2.imgbox.com/42/e0/D6b3XNfX_o.png" alt="在这里插入图片描述"></li><li><strong>Size类</strong><br> Size表示区域大小，常用构造函数Size(int _width, int _height)，Python中直接用元组(width, height)</li><li><strong>Scalar类</strong><br> Scalar()表示具有四个元素的数组，大量用来传递像素值，如RGB颜色，Python中直接用元组(B, G, R)<br> 一般形式：<code>Scalar(double B, double G, double R, double Alpha)</code><br> 如果用不到第四个则表示<code>Scalar(B, G, R)</code>, 其中：<code>B—表示蓝色分量</code>，<code>G—表示绿色分量</code>，<code>R—表示红色分量</code>，<code>Alpha—表示透明度</code></li></ol> 
<blockquote> 
 <p>注意:Scalar表示颜色顺序为BGR<br> Scalar(255, 0, 0) ----表示纯蓝色<br> Scalar(0, 255, 0) ----表示纯绿色<br> Scalar(0, 0, 255) ----表示纯红色<br> Scalar(255, 255, 0) ----表示青色<br> Scalar(0, 255, 255) ----表示黄色</p> 
</blockquote> 
<h4><a id="2422___461"></a>24.2.2 图像基础</h4> 
<ol><li><strong>基础图像容器：</strong><br> Python用numpy来操作</li><li><strong>Numpy相关属性简介:</strong><br> <code>np is None</code> 数组是否为空<br> <code>np.shape</code> 数组行，列，维度<br> <code>img.size</code> 数组元素总个数<br> <code>img.dtype</code> 数组元素数据类型</li><li><strong>Numpy相关方法简介:</strong><br> <code>np.zeros()</code>创建全为元素0的数组<br> <code>np.ones()</code>创建全为元素1的数组<br> <code>np.eye()</code>创建对角线元素全为1的数组<br> <code>np.copy()</code>数组深拷贝</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np 
<span class="token keyword">import</span> cv2

<span class="token comment"># img=np.zeros((512,512,3),np.uint8)</span>
<span class="token comment"># img=np.ones((512,512,3),np.uint8)</span>
img<span class="token operator">=</span>np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> img
<span class="token comment"># print(img)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li><strong>常用颜色空间介绍:</strong><br> RBG颜色空间——R/G/B取值范围[0,255]<br> <img src="https://images2.imgbox.com/c4/26/8gWvugcG_o.png" alt="在这里插入图片描述"></li></ol> 
<p>HSV/HLS颜色空间——H取值范围[0,360]，S/V取值范围[0,1]<br> H：色调，0度（红色）<br> S：饱和度，接近某种光谱色的程度，值越大表示越接近。<br> V：亮度，值越大亮度越高。<br> 主要用于：颜色识别（跟踪）<br> <img src="https://images2.imgbox.com/7f/08/xcN315l0_o.png" alt="在这里插入图片描述"></p> 
<p>Lab颜色空间——L取值范围[0,100]a/b取值范围[127,-128]<br> <img src="https://images2.imgbox.com/00/43/d6BVxzM6_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2

size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2560</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">)</span>
<span class="token comment"># 全黑.可以用在屏保</span>
black <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>size<span class="token punctuation">)</span>
black<span class="token punctuation">[</span><span class="token number">225</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
<span class="token comment"># black[:,225:300] = 255</span>
black<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">56</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>black<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span> black<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'black.jpg'</span><span class="token punctuation">,</span>black<span class="token punctuation">)</span>

<span class="token comment">#white 全白</span>
black<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">255</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>black<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">,</span> black<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'white.jpg'</span><span class="token punctuation">,</span>black<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2423___527"></a>24.2.3 基本绘图函数</h4> 
<p><strong>OpenCV常用绘图函数:</strong><br> <code>cv2.line()</code>函数------用于绘制直线<br> <code>cv2.circle()</code>函数------用于绘制圆<br> <code>cv2.rectangle()</code>函数------用于绘制矩形<br> <code>cv2.ellipse()</code>函数------用于绘制椭圆<br> <code>cv2.fillPoly()</code>/<code>polylines()</code>函数-----用于绘制多边形<br> <code>cv2.putText()</code>函数------用于添加文字</p> 
<blockquote> 
 <p><strong>绘制直线</strong>——<code>cv2.line()</code><br> cv2.line(img,pt1, pt2, color[, thclaness[, lineTye[, shift]]]) → None</p> 
</blockquote> 
<blockquote> 
 <p><strong>绘制圆</strong>——<code>cv2.circle()</code><br> cv2.circle(img, center,radius,color[,thickness[, lineType[,shift]]]) → None<br> <strong>Opencv2—cv2.CV_AA, OpenCV3—cv2.LINE_AA</strong></p> 
</blockquote> 
<blockquote> 
 <p><strong>绘制矩形</strong>——<code>cv2.rectangle()</code><br> cv2.rectangle(img,pt1,pt2,color[,thickness[,lineType[, shift]]]) → None</p> 
</blockquote> 
<blockquote> 
 <p><strong>绘制椭圆</strong>——<code>cv2.ellipse()</code><br> cv2.ellipse(img,center, axes,angle, startAngle,endangle,color[,thickness[,lineTye[,shift]]]) → None<br> cv2.ellipse(img, box,color[,thicknese[,linetype]]) → None</p> 
</blockquote> 
<blockquote> 
 <p><strong>绘制多边形</strong>——<code>cv2.fillPoly()</code>/<code>cv2.polylines()</code><br> cv2.fillPoly(img,pts,color[,lineType,shift[,offset]]]) → None<br> cv2.polylines(img,pts,isClosed,color[, thickmess[,lineType[,shift]]]）→ None</p> 
</blockquote> 
<blockquote> 
 <p><strong>添加文字</strong>——<code>cv2.putText()</code><br> cv2.puText(img, text, org, fontFace, fontScale, color[, thickness[, lineType[, bottomleftOrigin]]])→ None</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2

<span class="token triple-quoted-string string">'''
• img: 你想绘制图形的 幅图像。
• color: 形状的颜色。以RGB为例,需要传入一个元组 BGR 例如 255,0,0 
   代表蓝色，第一个是蓝色通道，第二个是绿色通道，第三个是红色通道。对于灰度图只需要传入灰度值。
• thickness 线条的粗细。如果给一个闭合图形置为 -1  那么这个图形就会被填充。默认值是 1.
• linetype 线条的类型， 8 连接，抗锯齿等。  默认情况是8 连接。cv2.LINE_AA
   为抗锯齿,这样看起来会非常平滑。

'''</span>
<span class="token comment">#0 1 2 3.....255</span>

<span class="token comment"># Create a black image</span>
img <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>winname<span class="token operator">=</span><span class="token string">'img'</span><span class="token punctuation">,</span> mat<span class="token operator">=</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># Draw a diagonal blue line with thickness of 5 px</span>
cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> pt1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pt2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">511</span><span class="token punctuation">,</span> <span class="token number">511</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># pt1, pt2, color, thickness=5</span>

<span class="token comment"># cv2.polylines() 可以用来画很多条线。只需要把想画的线放在一 个列表中， </span>
<span class="token comment">#                 将列表传给函数就可以了。每条线会被独立绘制。这会比用 cv2.line() 一条一条的绘制要快一些。</span>
<span class="token comment"># cv2.polylines(img, pts, isClosed, color, thickness=None, lineType=None, shift=None)</span>

cv2<span class="token punctuation">.</span>arrowedLine<span class="token punctuation">(</span>img<span class="token punctuation">,</span>pt1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pt2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">510</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># (x,y,h,w)  (x,y)   (h,w)</span>

cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">447</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">63</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># center, radius, color, thickness=None</span>

<span class="token comment"># 一个参数是中心点的位置坐标。 下一个参数是长轴和短轴的长度。椭圆沿逆时针方向旋转的角度。</span>
<span class="token comment"># 椭圆弧演顺时针方向起始的角度和结束角度 如果是 0 和 360 就是整个椭圆</span>
cv2<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>img<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> angle<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> startAngle<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> endAngle<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span>
            thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># center, axes, angle, startAngle, endAngle, color, thickness=</span>

pts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
pts <span class="token operator">=</span> pts<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 这里 reshape 的第一个参数为-1, 表明这一维的长度是根据后面的维度的计算出来的。</span>

cv2<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">[</span>pts<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 注意 如果第三个参数是 isClosed=False 我们得到的多边形是不闭合的，首尾不相连。</span>

font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX <span class="token comment"># 添加文本的字体类型</span>

<span class="token comment"># org :Bottom-left corner of the text string in the image.左下角</span>
<span class="token comment"># 或使用 bottomLeftOrigin=True,文字会上下颠倒</span>
cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'bottomLeftOrigin'</span><span class="token punctuation">,</span> org<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fontFace<span class="token operator">=</span>font<span class="token punctuation">,</span> fontScale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>bottomLeftOrigin<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># text, org, fontFace, fontScale, color, thickness=</span>
cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'OpenCV'</span><span class="token punctuation">,</span> org<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fontFace<span class="token operator">=</span>font<span class="token punctuation">,</span> fontScale<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># text, org, fontFace, fontScale, color, thickness=</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>winname<span class="token operator">=</span><span class="token string">'img'</span><span class="token punctuation">,</span> mat<span class="token operator">=</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># 所有的绘图函数的返回值都是 None ，所以不能使用 img = cv2.line(img,(0,0),(5</span>

<span class="token comment"># winname = 'example'</span>
<span class="token comment"># cv2.namedWindow(winname, 0)</span>
<span class="token comment"># cv2.imshow(winname, img)</span>

cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">"example.png"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2424___622"></a>24.2.4 访问图像像素</h4> 
<p><strong>预备知识:</strong><br> 图像矩阵的大小取决于所用的颜色模型(或者说通道数)，灰度图矩阵如下:<br> <img src="https://images2.imgbox.com/ea/97/KE3YuJeB_o.png" alt="在这里插入图片描述"><br> 多通道图像，如RGB颜色模型的矩阵如下：<br> <img src="https://images2.imgbox.com/95/8a/EKJGngzi_o.png" alt="在这里插入图片描述"><br> 注：opencv的通道顺序是BGR，而不是RGB</p> 
<p><strong>访问图像中像素方法:</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">255</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 访问每个像素点</span>
img <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">255</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> x <span class="token operator">==</span> y <span class="token keyword">and</span><span class="token punctuation">:</span>
            img<span class="token punctuation">[</span>y<span class="token punctuation">,</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>     
</code></pre> 
<p><strong>简单应用——雪花效果</strong></p> 
<p><strong>简单应用——减色效果</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:\2-PI231imgs\001.jpg'</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img2'</span><span class="token punctuation">,</span>img<span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      


<span class="token comment"># 访问每个像素点</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> x <span class="token operator">==</span> y<span class="token punctuation">:</span>
            img<span class="token punctuation">[</span>y<span class="token punctuation">,</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      

</code></pre> 
<h4><a id="2425__685"></a>24.2.5 对比度亮度调整与通道分离合并</h4> 
<p><strong>对比度亮度调整:</strong></p> 
<ol><li> <p>原理介绍<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           g 
          
          
          
            ( 
           
          
            x 
           
          
            ) 
           
          
         
           = 
          
         
           a 
          
         
           ⋅ 
          
         
           f 
          
          
          
            ( 
           
          
            x 
           
          
            ) 
           
          
         
           + 
          
         
           b 
          
         
        
          g\left( x \right)=a\cdot f\left( x \right)+b 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord mathdefault">x</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.44445em; vertical-align: 0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord mathdefault">x</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span></span></span></span></span> → <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           g 
          
          
          
            ( 
           
          
            i 
           
          
            , 
           
          
            j 
           
          
            ) 
           
          
         
           = 
          
         
           a 
          
         
           ⋅ 
          
         
           f 
          
          
          
            ( 
           
          
            i 
           
          
            , 
           
          
            j 
           
          
            ) 
           
          
         
           + 
          
         
           b 
          
         
        
          g\left( i,j \right)=a\cdot f\left( i,j \right)+b 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.44445em; vertical-align: 0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span></span></span></span></span><br> 参数f(x)表示原图像像素<br> 参数g(x)表示输出图像像素<br> 参数a(a&gt;0),被称为增益(gain), 通常用来控制图像的对比度<br> 参数b通常被称为偏置(bias), 通常用来控制图像的亮度</p> </li><li> <p>方法</p> </li></ol> 
<pre><code class="prism language-python">img <span class="token operator">=</span> img <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span><span class="token number">100</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img3'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
</code></pre> 
<p><strong>通道分离与合并:</strong></p> 
<ol><li> <p>通道分离：<code>cv2.split()</code>函数</p> </li><li> <p>通道合并：<code>cv2.merge()</code>函数</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:\2-PI231imgs\001.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 打印图像属性</span>
b<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token operator">=</span>cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span>  <span class="token comment"># 蓝色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">,</span>g<span class="token punctuation">)</span>  <span class="token comment"># 绿色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'R'</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span>  <span class="token comment"># 红色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
dst<span class="token operator">=</span>cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 通道合并</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'merge'</span><span class="token punctuation">,</span>dst<span class="token punctuation">)</span>  <span class="token comment"># 通道合并</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:\2-PI231imgs\001.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 打印图像属性</span>
b <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 蓝色通道</span>
g <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 绿色通道</span>
r <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 红色通道</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span>  <span class="token comment"># 蓝色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">,</span>g<span class="token punctuation">)</span>  <span class="token comment"># 绿色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'R'</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span>  <span class="token comment"># 红色通道</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
dst<span class="token operator">=</span>cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 通道合并</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'merge'</span><span class="token punctuation">,</span>dst<span class="token punctuation">)</span>  <span class="token comment"># 通道合并</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   
</code></pre> 
<p>numpy：</p> 
<pre><code class="prism language-python">np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape
</code></pre> 
<h4><a id="2426_Numpy_750"></a>24.2.6 图像翻转——Numpy</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:\2-PI231imgs\001.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span>

img_BGR2RGB <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 

img_np <span class="token operator">=</span> img_BGR2RGB<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 上下</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src2'</span><span class="token punctuation">,</span>img_np<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 

img_np <span class="token operator">=</span> img_BGR2RGB<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 左右</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src3'</span><span class="token punctuation">,</span>img_np<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 

img_np <span class="token operator">=</span> img_BGR2RGB<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 中心对称</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src4'</span><span class="token punctuation">,</span>img_np<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 

img_np <span class="token operator">=</span> img_BGR2RGB<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 通道翻转——RGB-BGR  img_BGR2RGB[...,::[2,1,0]]</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src5'</span><span class="token punctuation">,</span>img_np<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
</code></pre> 
<h3><a id="243___778"></a>24.3 图像基本运算</h3> 
<p>图像的基本运算，是两张图片相应位置的元素进行运算——满足广播条件（形状相同）</p> 
<h4><a id="2431__780"></a>24.3.1 图像算数运算</h4> 
<ol><li>图像加法——优先使用OpenCV接口</li></ol> 
<blockquote> 
 <p>cv2.add(src1,src2[,dst[,mask[,dtype]]]) → dst 图像加法<br> cv2.addWeighted(src1,alpha,src2,beta,gamma[,dst[,dtype]]) → dst 图像权重叠加<br> <code> dst(I)=saturate(src1(I) * alpha＋src2(I) * beta + gamma)</code></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/fengjing1.png'</span><span class="token punctuation">)</span>  <span class="token comment"># (546, 820, 3)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/logo.png'</span><span class="token punctuation">)</span>  <span class="token comment"># (300, 244, 3)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>img2<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># img1resize = cv2.resize(img1, (512, 512) )</span>
<span class="token comment"># print(img1resize.shape)  # (512, 512, 3)</span>
img1resize <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># (244, 300)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1resize<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (300, 244, 3)</span>
img1resize2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1resize2<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (244, 300, 3)</span>

<span class="token comment"># cv2.imshow('img2-1',img1resize)</span>
<span class="token comment"># cv2.waitKey(0)</span>

<span class="token comment"># cv2.imshow('img2-2',img1resize2)</span>
<span class="token comment"># cv2.waitKey(0)</span>

<span class="token comment"># 加法</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>img1resize<span class="token punctuation">,</span>img2<span class="token punctuation">)</span>
dstw <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>img1resize<span class="token punctuation">,</span><span class="token number">0.6</span><span class="token punctuation">,</span>img2<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
dst2 <span class="token operator">=</span> img1resize <span class="token operator">+</span> img2
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>dst<span class="token punctuation">,</span>dstw<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span>dst2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>图像减法</li></ol> 
<blockquote> 
 <p>cv2.subtract(src1,src2[,dst[,mask[,dtype]]]) → dst<br> cv2.absdiff(src1,src2[,dst]) → dst</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/fengjing1.png'</span><span class="token punctuation">)</span>  <span class="token comment"># (546, 820, 3)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/logo.png'</span><span class="token punctuation">)</span>  <span class="token comment"># (300, 244, 3)</span>
img1resize <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
img1resize2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

<span class="token comment">#减法</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>img1resize<span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
dstw <span class="token operator">=</span> cv2<span class="token punctuation">.</span>absdiff<span class="token punctuation">(</span>img1resize<span class="token punctuation">,</span> img2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'sub'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>dstw<span class="token punctuation">,</span> dst2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>图像加减法都需要两个图像有相同的大小和类型</p> 
</blockquote> 
<ol start="3"><li>图像乘除法</li></ol> 
<pre><code class="prism language-python">dst2 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> img1 <span class="token operator">-</span><span class="token number">200</span>
dstw <span class="token operator">=</span> img1 <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">-</span><span class="token number">20</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'sub'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>dstw<span class="token punctuation">,</span> dst2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2432___847"></a>24.3.2 图像逻辑运算</h4> 
<ol><li>图像相与 &amp;（&amp;=）</li></ol> 
<blockquote> 
 <p>c2.bitwise_and(src1, src2,dst[, mask]]) → dst</p> 
</blockquote> 
<ol start="2"><li>图像相或 | （|=）</li></ol> 
<blockquote> 
 <p>c2.bitwise_or(src1, src2,dst[, mask]]) → dst</p> 
</blockquote> 
<ol start="3"><li>图像异或 <sup>(</sup>=)</li></ol> 
<blockquote> 
 <p>c2.bitwise_xor(src1, src2,dst[, mask]]) → dst</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 1.与运算</span>
fig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>axes1<span class="token punctuation">,</span> axes2<span class="token punctuation">,</span> axes3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>axes4<span class="token punctuation">,</span> axes5<span class="token punctuation">,</span> axes6<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
xiaoxin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/xiaoxin.png'</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> xiaoxin<span class="token punctuation">.</span>shape
wcircle <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>xiaoxin<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment"># 创建一张全黑的图片</span>
cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>wcircle<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> h<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>h<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># dst = xiaoxin &amp; wcircle</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>xiaoxin<span class="token punctuation">,</span> wcircle<span class="token punctuation">)</span>  <span class="token comment"># 与</span>
axes1<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>xiaoxin<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>wcircle<span class="token punctuation">)</span>
axes3<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes1<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin'</span><span class="token punctuation">)</span>
axes2<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'wcircle'</span><span class="token punctuation">)</span>
axes3<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin and wcircle'</span><span class="token punctuation">)</span>

<span class="token comment"># cv2.imwrite('datas/xiaoxin_1.png', dst)</span>

<span class="token comment"># 2.或运算</span>
xiaoxin_1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/xiaoxin_1.png'</span><span class="token punctuation">)</span>
<span class="token comment"># bcircle = np.where(wcircle==0, 255, 0)</span>
bcircle <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>wcircle<span class="token punctuation">)</span>  <span class="token comment"># 取反</span>
<span class="token comment"># dst = xiaoxin | bcircle  # 或</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>xiaoxin_1<span class="token punctuation">,</span> bcircle<span class="token punctuation">)</span>  <span class="token comment"># 或</span>

axes4<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>xiaoxin_1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes5<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>bcircle<span class="token punctuation">)</span>
axes6<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes4<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin_1'</span><span class="token punctuation">)</span>
axes5<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'bcircle'</span><span class="token punctuation">)</span>
axes6<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin_1 or bcircle'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># cv2.imwrite('datas/xiaoxin_2.png', dst)</span>

<span class="token comment"># 3.异或运算</span>
fig<span class="token punctuation">,</span> <span class="token punctuation">(</span>axes1<span class="token punctuation">,</span> axes2<span class="token punctuation">,</span> axes3<span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
xiaoxin <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'datas/xiaoxin.png'</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> xiaoxin<span class="token punctuation">.</span>shape
white <span class="token operator">=</span> np<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>xiaoxin<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span>  <span class="token comment"># 创建一张全白的图片</span>
cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>white<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> h<span class="token operator">//</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> xiaoxin <span class="token operator">^</span> white
axes1<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>xiaoxin<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>white<span class="token punctuation">)</span>
axes3<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axes1<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin'</span><span class="token punctuation">)</span>
axes2<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span>
axes3<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'xiaoxin nor white'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'datas/xiaoxin_3.png'</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2432___913"></a>24.3.2 图像复制</h4> 
<p>浅拷贝：temp = img<br> 深拷贝：temp = img.copy()</p> 
<pre><code class="prism language-python"><span class="token comment"># encoding:utf8</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> random
<span class="token comment"># 读取一张图片，并显示出其雪花效果</span>

car <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/car.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># (800, 1280, 3)</span>

<span class="token keyword">def</span> <span class="token function">snowlean_show</span><span class="token punctuation">(</span>photo<span class="token punctuation">,</span>num <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> photo <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        org <span class="token operator">=</span> photo<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            xi <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>photo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            yi <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>photo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            ri <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>photo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>photo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># 绘制圆形白点</span>
            cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>photo<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span>xi<span class="token punctuation">,</span>yi<span class="token punctuation">)</span><span class="token punctuation">,</span>radius<span class="token operator">=</span>ri<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'snowlean_show'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>photo<span class="token punctuation">,</span>org<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'图片导入有误！'</span><span class="token punctuation">)</span>

snowlean_show<span class="token punctuation">(</span>car<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="244_ROImask_944"></a>24.4 图像ROI与mask掩码</h3> 
<h4><a id="2441__ROI_945"></a>24.4.1 感兴趣区域ROI</h4> 
<ol><li> <p>ROI介绍<br> ROI—<code>(region of interest)</code>—感兴趣区域：一般为矩形区域；能够确定分析重点，减少处理时间，提高精度<br> 定义方法：使用Rect起点终点范围</p> </li><li> <p>ROI选取<br> 注意ROI参数顺序y1: y2, x1:x2</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

car <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/car.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># (800, 1280, 3)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>car<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
car_roi <span class="token operator">=</span> car<span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">:</span><span class="token number">600</span><span class="token punctuation">]</span>  <span class="token comment"># y1:y2 , x1:x2</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src2'</span><span class="token punctuation">,</span>car_roi<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2442__mask_968"></a>24.4.2 mask—掩码/掩膜操作</h4> 
<blockquote> 
 <p>mask—(掩码)—是一个8位单通道图像(灰度图/二值图) ，掩码某个位置如果为0，则在此位置上的操作不起作用；掩码某个位置如果不为0，则在此位置上的操作会起作用，可以用来提取不规则ROI<br> <img src="https://images2.imgbox.com/1e/2d/BSHw7OpU_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>(见24.8)</p> 
<p><strong>阈值函数</strong> ：<code>cv2.threshold(src, thresh, maxval, type[, dst]) → retval, dst</code><br> src：表示的是图片源<br> thresh：表示的是阈值（起始值）<br> maxval：表示的是最大值<br> type：表示算法类型, <strong>常用值为0（cv2.THRESH_BINARY）</strong><br> retval：表示返回的阈值。若是全局固定阈值算法，则返回 hresh 参数值。若是全局自适应阈值算法，则返回自适应计算得出的合适阈值。<br> dst：表示输出与src相同大小和类型以及相同通道数的图像。</p> 
<blockquote> 
 <p>二值化阈值处理<br> <strong>THRESH_BINARY：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                m 
               
              
                a 
               
              
                x 
               
              
                V 
               
              
                a 
               
              
                l 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                i 
               
              
                f 
               
               
                
                 
                  
                 
                
                
                
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
              
                &gt; 
               
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
             
            
           
           
            
             
              
              
                0 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                o 
               
              
                t 
               
              
                h 
               
              
                e 
               
              
                r 
               
              
                w 
               
              
                i 
               
              
                s 
               
              
                e 
               
              
             
            
           
          
         
        
       
         dst(x,y)=\left\{ \begin{matrix} maxVal \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\0\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 反二值化阈值处理<br> <strong>THRESH_BINARY_INV：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                0 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                i 
               
              
                f 
               
               
                
                 
                  
                 
                
                
                
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
              
                &gt; 
               
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
             
            
           
           
            
             
              
              
                m 
               
              
                a 
               
              
                x 
               
              
                V 
               
              
                a 
               
              
                l 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                o 
               
              
                t 
               
              
                h 
               
              
                e 
               
              
                r 
               
              
                w 
               
              
                i 
               
              
                s 
               
              
                e 
               
              
             
            
           
          
         
        
       
         dst(x,y)=\left\{ \begin{matrix} 0 \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\maxVal\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 截断阈值化处理<br> <strong>THRESH_TRUNC：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
                o 
               
              
                l 
               
              
                d 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                i 
               
              
                f 
               
               
                
                 
                  
                 
                
                
                
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
              
                &gt; 
               
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
             
            
           
           
            
             
              
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                o 
               
              
                t 
               
              
                h 
               
              
                e 
               
              
                r 
               
              
                w 
               
              
                i 
               
              
                s 
               
              
                e 
               
              
             
            
           
          
         
        
       
         dst(x,y)=\left\{ \begin{matrix} threshold \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\src(x,y)\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 超阈值零处理<br> <strong>THRESH_TOZORE：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                i 
               
              
                f 
               
               
                
                 
                  
                 
                
                
                
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
              
                &gt; 
               
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
             
            
           
           
            
             
              
              
                0 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                o 
               
              
                t 
               
              
                h 
               
              
                e 
               
              
                r 
               
              
                w 
               
              
                i 
               
              
                s 
               
              
                e 
               
              
             
            
           
          
         
        
       
         dst(x,y)=\left\{ \begin{matrix} src(x,y) \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\0\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 低阈值零处理<br> <strong>THRESH_TOZORE_INV：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
         
         
           { 
          
          
           
            
             
              
              
                0 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                i 
               
              
                f 
               
               
                
                 
                  
                 
                
                
                
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
              
                &gt; 
               
              
                t 
               
              
                h 
               
              
                r 
               
              
                e 
               
              
                s 
               
              
                h 
               
              
             
            
           
           
            
             
              
              
                s 
               
              
                r 
               
              
                c 
               
              
                ( 
               
              
                x 
               
              
                , 
               
              
                y 
               
              
                ) 
               
               
                
                 
                
                
                
               
               
                
                 
                
                
                
               
              
                o 
               
              
                t 
               
              
                h 
               
              
                e 
               
              
                r 
               
              
                w 
               
              
                i 
               
              
                s 
               
              
                e 
               
              
             
            
           
          
         
        
       
         dst(x,y)=\left\{ \begin{matrix} 0 \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\src(x,y)\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

car <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/car.jpg'</span><span class="token punctuation">)</span>  <span class="token comment"># (800, 1280, 3)</span>
logo <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/logo.png'</span><span class="token punctuation">)</span> <span class="token comment"># (300, 244, 3)</span>

<span class="token keyword">def</span> <span class="token function">getmask</span><span class="token punctuation">(</span>logo<span class="token punctuation">,</span> thred<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># logo:bgr模式</span>
    <span class="token comment"># 转灰度图</span>
    logo_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>logo<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 转二值图（阈值的操作）</span>
    logo_thred <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>logo_gray <span class="token operator">&lt;</span> thred<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>   
    <span class="token keyword">return</span> logo_thred

<span class="token comment"># 1.获取背景</span>
<span class="token comment"># 1.1 获取ROI，ROI的shape:</span>
car_roi <span class="token operator">=</span> car<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>logo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>logo<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># 1.2 获取掩码</span>
mask <span class="token operator">=</span> getmask<span class="token punctuation">(</span>logo<span class="token punctuation">)</span>
retval<span class="token punctuation">,</span> dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>logo<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'car_roi'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>car_roi<span class="token punctuation">,</span>dst<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'retval'</span><span class="token punctuation">,</span>retval<span class="token punctuation">)</span>  <span class="token comment"># 50</span>

</code></pre> 
<h4><a id="2443_ROI_1022"></a>24.4.3 ROI图像融合</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 作业１. 高级融合</span>
<span class="token keyword">def</span> <span class="token function">get_mask</span><span class="token punctuation">(</span>InMat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">,</span> ThreNum<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    返回阈值大于ThreNum的区域
    """</span>
    <span class="token comment"># 先把3通道的图像转化为单通道</span>
    <span class="token keyword">if</span> InMat<span class="token punctuation">.</span>ndim <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        InMat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>InMat<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>

    <span class="token comment"># 过滤选择出大于ThreNum的区域</span>
    OutMat <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>InMat <span class="token operator">&gt;=</span> ThreNum<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  
    <span class="token comment"># 对每个元素进行判断; 需制定元素的格式为np.uint8</span>
    <span class="token keyword">return</span> OutMat

<span class="token keyword">def</span> <span class="token function">work1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 找到掩膜</span>
    LogoPath <span class="token operator">=</span> <span class="token string">r"F:/datas/logo.png"</span>
    LogoImg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>LogoPath<span class="token punctuation">)</span>
    h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> _ <span class="token operator">=</span> LogoImg<span class="token punctuation">.</span>shape
    mask <span class="token operator">=</span> get_mask<span class="token punctuation">(</span>LogoImg<span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">)</span>   <span class="token comment"># 掩膜1</span>
    mask_inv <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> mask           <span class="token comment"># 掩膜2</span>
    <span class="token comment"># mask_inv = cv2.bitwise_not(mask)</span>

    <span class="token comment"># 抠出logo彩色区域</span>
    MaskLogoImg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>LogoImg<span class="token punctuation">,</span> LogoImg<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask_inv<span class="token punctuation">)</span>      <span class="token comment"># "mask="这个标识符不可少</span>

    <span class="token comment"># 读入汽车图像</span>
    CarPath <span class="token operator">=</span> <span class="token string">r"F:\datas\car.jpg"</span>
    CarImg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>CarPath<span class="token punctuation">)</span>
    start_x<span class="token punctuation">,</span> start_y <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span>       <span class="token comment"># 定义贴图的左上角起始点</span>
    CarRoi <span class="token operator">=</span> CarImg<span class="token punctuation">[</span>start_y<span class="token punctuation">:</span>start_y <span class="token operator">+</span> h<span class="token punctuation">,</span> start_x<span class="token punctuation">:</span>start_x <span class="token operator">+</span> w<span class="token punctuation">]</span>
    <span class="token comment"># MaskCarRoi = cv2.bitwise_and(CarRoi, CarRoi, mask=mask)</span>
    MaskCarRoi <span class="token operator">=</span> cv2<span class="token punctuation">.</span>copyTo<span class="token punctuation">(</span>CarRoi<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>          <span class="token comment"># cv2.copyTo()也响应掩膜, 只复制掩膜对应的区域</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>MaskLogoImg<span class="token punctuation">,</span> MaskCarRoi<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    
    ShowCarRoi <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>MaskLogoImg<span class="token punctuation">,</span> MaskCarRoi<span class="token punctuation">)</span>       <span class="token comment"># 两张图像相加</span>
    CarImg<span class="token punctuation">[</span>start_y<span class="token punctuation">:</span>start_y <span class="token operator">+</span> h<span class="token punctuation">,</span> start_x<span class="token punctuation">:</span>start_x <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">=</span> ShowCarRoi

    <span class="token comment"># 显示图像</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'CarImg'</span><span class="token punctuation">,</span>CarImg<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    
<span class="token comment"># work1()</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

VideoPath<span class="token operator">=</span><span class="token string">"F:/datas/objecttracking2.avi"</span>
<span class="token comment"># 读入视频</span>
cap<span class="token operator">=</span>cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>VideoPath<span class="token punctuation">)</span>
num <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>  <span class="token comment"># 取这一帧的图像失败, 就退出</span>

    <span class="token comment"># 视频显示</span>
    <span class="token comment"># cv2.imshow('frame',frame)</span>
    <span class="token comment"># cv2.waitKey(1)</span>

    <span class="token comment"># HSV转换</span>
    HSV <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span>  <span class="token comment"># 把BGR图像转换为HSV格式</span>
    Lower <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 要识别颜色的下限</span>
    Upper <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 要识别的颜色的上限</span>
    <span class="token comment"># mask是把HSV图片中在颜色范围内的区域变成白色，其他区域变成黑色</span>
    mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>HSV<span class="token punctuation">,</span> Lower<span class="token punctuation">,</span> Upper<span class="token punctuation">)</span>
    <span class="token comment"># 视频显示</span>
    <span class="token comment"># cv2.imshow('mask',mask)</span>
    <span class="token comment"># cv2.waitKey(1)</span>
    <span class="token comment">#下面四行是用卷积进行滤波</span>
    kernel_2 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token comment">#2x2的卷积核</span>
    kernel_3 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token comment">#3x3的卷积核</span>
    kernel_4 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token comment">#4x4的卷积核</span>
    erosion <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>mask<span class="token punctuation">,</span>kernel_4<span class="token punctuation">,</span>iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    erosion <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>erosion<span class="token punctuation">,</span>kernel_4<span class="token punctuation">,</span>iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>erosion<span class="token punctuation">,</span>kernel_4<span class="token punctuation">,</span>iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>dilation<span class="token punctuation">,</span>kernel_4<span class="token punctuation">,</span>iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">#target是把原图中的非目标颜色区域去掉剩下的图像</span>
    target <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> mask<span class="token operator">=</span>dilation<span class="token punctuation">)</span>
    <span class="token comment"># # 视频显示</span>
    <span class="token comment"># cv2.imshow('target',target)</span>
    <span class="token comment"># cv2.waitKey(1)</span>
</code></pre> 
<h3><a id="245__1114"></a>24.5 图像几何变换</h3> 
<h4><a id="2451_cv2resize_1115"></a>24.5.1 图像缩放—cv2.resize()</h4> 
<blockquote> 
 <p><code>cv2.resize(src,dsize[,dst[,fx,fy[,interpolation]]]]) → dst</code><br> <strong>src:</strong> 输入图像<br> <strong>dst:</strong> 输出图像<br> <strong>dsize:</strong> Size类型，指定输出图像大小，如果它等于0:dsize = Size(round(fx<em>src.cols), round(fy</em>src.rows))<br> <strong>fx:</strong> 沿水平方向的缩放系数，默认值0，等于0时:(double)dsize.width/src.cols<br> <strong>fy:</strong> 沿垂直方向的缩放系数，默认值0，等于0时:(double)dsize.height/src.rows<br> <strong>interpolation:</strong> 用于指定插值方式，默认为cv2.INTER_LINEAR (线性插值)</p> 
 <blockquote> 
  <p>INTER_NEAREST 最邻近插值<br> INTER_LINEAR 线性插值（默认值）（放大图像使用–快）<br> INTER_AREA 区域插值（缩小图像推荐使用）<br> INTER_CUBIC 三次样条插值（放大图像使用–慢）<br> INTER_LANCZOS4 Lanczos插值</p> 
 </blockquote> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#图像的缩放</span>

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/fengjing1.png'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (546, 820, 3)</span>
dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span> <span class="token comment"># 输出图像的形状:(w, h)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dst1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (109, 410, 3)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dst2<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (109, 164, 3)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>dst1<span class="token punctuation">,</span> dst2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">#cv2.imwrite('test1.png', dst1)</span>
<span class="token comment">#cv2.imwrite('test2.png', dst2)</span>
</code></pre> 
<blockquote> 
 <p>通过变换步骤构建仿射变换的M矩阵</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math
<span class="token comment">#图像的缩放</span>
img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/snowqueen.png'</span><span class="token punctuation">)</span><span class="token comment"># cv2.imread(r'datas/fengjing1.png')</span>

<span class="token triple-quoted-string string">'''
一、通过变换步骤构建仿射变换的M矩阵
'''</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape

<span class="token comment"># 以中心点进行缩放</span>
M1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M3 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M <span class="token operator">=</span> M1 @ M2 @ M3 <span class="token comment"># 相对图像的中点缩放的反射矩阵</span>

<span class="token comment"># 以原点进行缩放</span>
<span class="token comment"># M = np.float64([[0.5,0,0],[0,0.5, 0], [0, 0, 1]])</span>

dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst1_s'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2452__1178"></a>24.5.2 图像平移</h4> 
<ol><li>原理简介<br> 平移后，图像大小不变，信息丢失<br> <img src="https://images2.imgbox.com/c0/29/y0Qn0bza_o.png" alt="在这里插入图片描述"></li></ol> 
<pre><code class="prism language-python"><span class="token comment">#---平移函数1（原图，X方向位移，Y方向位移）</span>
<span class="token comment">#---不改变原图大小，会丢失信息</span>
<span class="token keyword">def</span> <span class="token function">imgTranslate</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>xOffset<span class="token punctuation">,</span>yOffset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rows <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    cols <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    dst <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> j <span class="token operator">+</span> xOffset 
            y <span class="token operator">=</span> i <span class="token operator">+</span> yOffset
            <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">and</span> y <span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">and</span> x<span class="token operator">&lt;</span>cols <span class="token keyword">and</span> y<span class="token operator">&lt;</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
                dst<span class="token punctuation">[</span>y<span class="token punctuation">,</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
    <span class="token keyword">return</span> dst
</code></pre> 
<p>平移后，图像大小改变，信息完整<br> <img src="https://images2.imgbox.com/53/23/REGwCWmI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">#---平移函数2（原图，x方向位移，Y方向位移）</span>
<span class="token comment">#---改变原图大小，不丢失信息</span>
<span class="token keyword">def</span> <span class="token function">imgTranslate2</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>xOffset<span class="token punctuation">,</span>yOffset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rows <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token builtin">abs</span> <span class="token punctuation">(</span>yOffset<span class="token punctuation">)</span>
    cols <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token builtin">abs</span><span class="token punctuation">(</span>xOffset<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> j <span class="token operator">+</span> xOffset 
            y <span class="token operator">=</span> i <span class="token operator">+</span> yOffset
    <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">and</span> y<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token keyword">and</span> x<span class="token operator">&lt;</span>cols <span class="token keyword">and</span> y<span class="token operator">&lt;</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dst<span class="token punctuation">[</span>y<span class="token punctuation">,</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
    <span class="token keyword">return</span> dst
</code></pre> 
<ol start="2"><li>简单快速平移方法<br> 平移就是将对象换一个位置。如果你要沿（x，y）方向移动，移动的距离是（tx，ty），你可以以下面的方式构建移动矩阵∶<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          M 
         
        
          = 
         
         
         
           [ 
          
          
           
            
             
             
               1 
              
             
            
            
             
             
               0 
              
             
            
            
             
              
              
                t 
               
              
                x 
               
              
             
            
           
           
            
             
             
               0 
              
             
            
            
             
             
               1 
              
             
            
            
             
              
              
                t 
               
              
                y 
               
              
             
            
           
          
         
           ] 
          
         
        
       
         M\text{=}\left[ \begin{matrix}1 &amp; 0 &amp; {<!-- -->{t}_{x}} \\0 &amp; 1 &amp; {<!-- -->{t}_{y}} \\\end{matrix} \right] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mord text"><span class="mord">=</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">t</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">t</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span><br> 你可以使用Numpy 数组构建这个矩阵（数据类型是np.float32），然后把它传给函数 cv2.warpAffine()</li></ol> 
<blockquote> 
 <p><code>cv2.warpAffine(src, M, dsize, dst=None, flags=None, borderMode=None, borderValue=None) → dst</code><br> <strong>src：</strong> 输入图像 dst：输出图像<br> <strong>M：</strong> 2×3的变换矩阵<br> <strong>dsize：</strong> 变换后输出图像尺寸<br> <strong>flag：</strong> 插值方法<br> <strong>borderMode：</strong> 边界像素外扩方式<br> <strong>borderValue：</strong> 边界像素插值，默认用0填充<br> 变换矩阵M可通过<code>cv2.getAffineTransfrom(points1, points2)</code>函数获得</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#图像的缩放</span>
img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/fengjing1.png'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span> <span class="token comment"># 输出图像的形状:(w, h)</span>

M <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape
<span class="token comment">#平移</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token operator">+</span><span class="token number">100</span><span class="token punctuation">,</span> h<span class="token operator">+</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst'</span><span class="token punctuation">,</span>  dst<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>通过解方程组，获取M</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 根据3组坐标解方程，（2行3列总共6个未知数，需要6组方程）</span>
<span class="token comment"># 解方程方法：cv2.getAffineTransform(src, dst)</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token comment"># 通过解方程组，获取M</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'getAffine'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2453___1259"></a>24.5.3 图像旋转</h4> 
<ol><li>图示简介</li></ol> 
<p><img src="https://images2.imgbox.com/4e/20/BGhVfq4z_o.png" alt="在这里插入图片描述"><br> OpenCV没有提供直接旋转图像的函数，图像旋转可能会造成图像信息丢失，图像旋转可以用仿射变换来实现，主要用到函数：<code>cv2.getRotationMatrix2D()</code> 、<code>cv2.warpAffine()</code></p> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         = 
        
        
        
          [ 
         
         
          
           
            
             
             
               cos 
              
             
               ⁡ 
              
             
               θ 
              
             
            
           
           
            
             
             
               − 
              
             
               sin 
              
             
               ⁡ 
              
             
               θ 
              
             
            
           
          
          
           
            
             
             
               sin 
              
             
               ⁡ 
              
             
               θ 
              
             
            
           
           
            
             
             
               cos 
              
             
               ⁡ 
              
             
               θ 
              
             
            
           
          
         
        
          ] 
         
        
       
         ⇒ 
        
        
        
          [ 
         
         
          
           
            
            
              α 
             
            
           
           
            
            
              β 
             
            
           
           
            
             
             
               ( 
              
             
               1 
              
             
               − 
              
             
               α 
              
             
               ) 
              
             
               ⋅ 
              
             
               c 
              
             
               e 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               ( 
              
             
               x 
              
             
               ) 
              
             
               − 
              
             
               β 
              
             
               ⋅ 
              
             
               c 
              
             
               e 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               ( 
              
             
               y 
              
             
               ) 
              
             
            
           
          
          
           
            
             
             
               − 
              
             
               β 
              
             
            
           
           
            
            
              α 
             
            
           
           
            
             
             
               β 
              
             
               ⋅ 
              
             
               c 
              
             
               e 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               ( 
              
             
               x 
              
             
               ) 
              
             
               + 
              
             
               ( 
              
             
               1 
              
             
               − 
              
             
               α 
              
             
               ) 
              
             
               ⋅ 
              
             
               c 
              
             
               e 
              
             
               n 
              
             
               t 
              
             
               e 
              
             
               r 
              
             
               ( 
              
             
               y 
              
             
               ) 
              
             
            
           
          
         
        
          ] 
         
        
       
      
        M=\left[ \begin{matrix}\cos \theta &amp; -\sin \theta \\ \sin \theta &amp; \cos \theta \\\end{matrix} \right]\Rightarrow \left[ \begin{matrix} \alpha &amp; \beta &amp; (1-\alpha )\cdot center(x)-\beta \cdot center(y) \\ -\beta &amp; \alpha &amp; \beta \cdot center(x)+(1-\alpha )\cdot center(y) \\\end{matrix} \right] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault" style="margin-right: 0.05278em;">β</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.05278em;">β</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.05278em;">β</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.05278em;">β</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p> 
<blockquote> 
 <p><code>cv2.getRotationMatrix2D(center,angle,scale) → retval</code><br> 旋转中心，旋转角度，旋转后的缩放因子</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#图像的缩放</span>
img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/fengjing1.png'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span><span class="token comment"># 输出图像的形状:(w, h)</span>

M <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape

<span class="token comment">#旋转</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> h<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>通过变换步骤构建仿射变换的M矩阵</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math

img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/snowqueen.png'</span><span class="token punctuation">)</span><span class="token comment"># cv2.imread(r'datas/fengjing1.png')</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape
<span class="token triple-quoted-string string">'''============================================='''</span>
<span class="token comment"># 旋转 逆时针30度——原点</span>
rad <span class="token operator">=</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
<span class="token comment"># 旋转 顺时针30度——原点</span>
rad <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">30</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi

M <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst1_r'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''============================================='''</span>
<span class="token comment"># 以中点为中心点逆时针旋转30度</span>
rad <span class="token operator">=</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
M1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M3 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M <span class="token operator">=</span> M1 @ M2 @ M3
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst1_r'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''============================================='''</span>
<span class="token comment"># 以中点为中心点缩放0.8，然后逆时针旋转30度</span>
<span class="token comment">#1</span>
rad <span class="token operator">=</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">180</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
M1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M2_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M2_2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M3 <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
M <span class="token operator">=</span> M1 @ <span class="token punctuation">(</span>M2_1 @ M2_2<span class="token punctuation">)</span> @ M3<span class="token comment">#</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst1_r'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#2</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> h<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'all'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> dst<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>插值算法——最近邻算法<br> 仿射变换之后的坐标为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
         
         
           x 
          
         
           ^ 
          
         
        
          , 
         
         
         
           y 
          
         
           ^ 
          
         
        
          ) 
         
        
       
         (\hat{x},\hat{y}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">x</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.22222em;">^</span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，之后的为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         (x,y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>，获取到值的函数为f：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           f 
          
          
          
            i 
           
          
            n 
           
          
            p 
           
          
            u 
           
          
            t 
           
          
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         {<!-- -->{f}_{input}}(x,y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>、<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           f 
          
          
          
            o 
           
          
            u 
           
          
            t 
           
          
            p 
           
          
            u 
           
          
            t 
           
          
         
        
          ( 
         
         
         
           x 
          
         
           ^ 
          
         
        
          , 
         
         
         
           y 
          
         
           ^ 
          
         
        
          ) 
         
        
       
         {<!-- -->{f}_{output}}(\hat{x},\hat{y}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">x</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.22222em;">^</span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">^</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li></ol> 
<h4><a id="2454___1339"></a>24.5.4 转置和镜像</h4> 
<p>用到的函数<code>cv2.transpose()</code>、<code>cv2.flip()</code>，可以实现转置和镜像变换，以及90°，180°旋转</p> 
<blockquote> 
 <p>cv2.transpose(src[,dst]) → dst 行列互换</p> 
</blockquote> 
<blockquote> 
 <p>cv2.flip(src[,dst]) → dst 对称变化<br> flipCode = 0, 垂直翻转(沿X轴翻转)；<br> flipCode &gt; 0, 水平翻转(沿Y轴翻转)；<br> flipCode &lt; 0, 水平垂直翻转(180°中心)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment">#转置和镜像</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/snowqueen.png'</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'transpose'</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
dst1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># img(:,::-1)</span>
dst2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># img(::-1,:)</span>
dst3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># img(::-1,::-1)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'flip'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> dst1<span class="token punctuation">,</span> dst2<span class="token punctuation">,</span> dst3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2455__cv2remap_1365"></a>24.5.5 重映射—cv2.remap()</h4> 
<p><code>cv2.remap()</code>函数<br> 重映射是指把一个图像中的一个位置的像素通过映射关系转换到另一图像的指定位置。对于输入原图像f(x, y), 目标图像g(x, y), 映射关系为T, 则满足下式：<code>g(x, y) = T(f(x, y))</code></p> 
<blockquote> 
 <p><code>cv2.remap(src, map1, map2, interpolation[,dst[,borderMode[, borderValue]]]) → dst</code><br> <strong>map1:</strong> 表示(x, y)点的坐标或x坐标，CV_16SC2, CV_32FC1,CV_32FC2类型<br> <strong>map2:</strong> 表示(x, y)点y坐标，如果map1为(x, y)，map2可以选择不用，可以是CV_16UC1, CV_32FC1<br> <strong>interpolation:</strong> 表示插值方法<br> <strong>borderMode:</strong> 表示边界插值类型<br> <strong>borderValue:</strong> 表示插值数值</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 重映射</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'F:/datas/snowqueen.png'</span><span class="token punctuation">)</span>
xMap <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
yMap <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
rows <span class="token operator">=</span> img<span class="token punctuation">.</span>shape <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
cols <span class="token operator">=</span> img<span class="token punctuation">.</span>shape <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
        xMap<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        yMap<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token operator">*</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>j<span class="token operator">/</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>remap<span class="token punctuation">(</span>img<span class="token punctuation">,</span>xMap<span class="token punctuation">,</span>yMap<span class="token punctuation">,</span>interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dst'</span><span class="token punctuation">,</span>  dst<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2456___1396"></a>24.5.6 透视变换——图像校正</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
img_src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/imageTextR.png'</span><span class="token punctuation">)</span><span class="token comment"># chessboard-2.png</span>
img <span class="token operator">=</span> img_src<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> _ <span class="token operator">=</span> img_src<span class="token punctuation">.</span>shape

<span class="token comment">#手动捕捉特征点：</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">508</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">516</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">305</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
affineResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'compare'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span>affineResult<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/e5/pxnTuJtB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="246_OpenCV_1416"></a>24.6 OpenCV界面事件操作</h3> 
<p><strong>utils工具包：</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># encoding:utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">class</span> <span class="token class-name">Mouse</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> winname<span class="token operator">=</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>img <span class="token operator">=</span> img
        self<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment"># 保存每次鼠标单击的位置</span>
        self<span class="token punctuation">.</span>winname <span class="token operator">=</span> winname
    <span class="token keyword">def</span> <span class="token function">selectPoints</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span>self<span class="token punctuation">.</span>winname<span class="token punctuation">)</span>
        <span class="token comment">#绑定鼠标事件</span>
        cv2<span class="token punctuation">.</span>setMouseCallback<span class="token punctuation">(</span>self<span class="token punctuation">.</span>winname<span class="token punctuation">,</span> self<span class="token punctuation">.</span>onMouse<span class="token punctuation">)</span>
        <span class="token comment">#打开窗口进行标记</span>
        show_img<span class="token punctuation">(</span>self<span class="token punctuation">.</span>winname<span class="token punctuation">,</span> self<span class="token punctuation">.</span>img<span class="token punctuation">)</span>
    <span class="token comment">#鼠标事件的回调函数    </span>
    <span class="token keyword">def</span> <span class="token function">onMouse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> userdatas<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        event:鼠标事件，可以通过[i for i in dir(cv2) if i.startswith('EVENT')]查看
        x,y:当前鼠标的位置
        flags:鼠标事件标记，可以通过[i for i in dir(cv2) if i.startswith('EVENT_FLAG')]查看
        userdatas:额外的参数
        '''</span>
        <span class="token comment">#print('onMouse')</span>
        <span class="token keyword">if</span> event <span class="token operator">==</span> cv2<span class="token punctuation">.</span>EVENT_LBUTTONDOWN <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>points<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token comment"># 单击鼠标事件</span>
            point <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>points<span class="token punctuation">.</span>append<span class="token punctuation">(</span>point<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>drawSelectPoints<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">drawSelectPoints</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>drawMarker<span class="token punctuation">(</span>self<span class="token punctuation">.</span>img<span class="token punctuation">,</span> self<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>color<span class="token punctuation">,</span>
                       markerType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>MARKER_STAR<span class="token punctuation">,</span> markerSize<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>img<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>self<span class="token punctuation">.</span>winname<span class="token punctuation">,</span> self<span class="token punctuation">.</span>img<span class="token punctuation">)</span>
        k <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show_img</span><span class="token punctuation">(</span>winname<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>winname<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">show_imgs</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 展示多组对比图</span>
    nrows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span>
    fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> group <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">:</span>
        axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'before'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>group<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'after'</span><span class="token punctuation">)</span>
        axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>group<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
    
</code></pre> 
<h4><a id="2461__1477"></a>24.6.1 鼠标操作</h4> 
<p>指定鼠标操作消息回调函数，setMouseCallback(),原型如下：<code>cv2.setMouseCallback()</code></p> 
<blockquote> 
 <p>CV_EXPORTS void setMouseCalback(const sring&amp; winmname, MouseCallack onMouse, void* userdata=0);<br> <strong>winname</strong>——窗口名<br> <strong>onMouse</strong>——鼠标事件时被调用的函数指针，原型形式：<code>void Fun(int event, int x, int y, int flags, void* param);</code><br> <strong>userdata</strong>——用户定义传到回调函数的参数，默认值0</p> 
</blockquote> 
<p><strong>event：</strong><br> CV_EVENT_MOUSEMOVE = 0<br> CV_EVENT_LBUTTONDOWN = 1<br> CV_EVENT_RBUTTONDOWN = 2<br> CV_EVENT_MBUTTONDOWN = 3<br> CV_EVENT_LBUTTONNUP = 4<br> CV_EVENT_RBUTTONNUP = 5<br> CV_EVENT_MUTTONNUP = 6<br> CV_EVENT_LBUTTONDBLCLK = 7<br> CV_EVENT_RBUTTONDBLCLK = 8<br> CV_EVENT_MBUTTONDBLCLK = 9</p> 
<p><strong>flags：</strong><br> CV_EVENT_FLAG_LBUTTON = 1<br> CV_EVENT_FLAG_RBUTTON = 2<br> CV_EVENT_FLAG_MBUTTON = 4<br> CV_EVENT_FLAG_CTRLKEY = 8<br> CV_EVENT_FLAG_SHIFTKEY = 16<br> CV_EVENT_FLAG_ALTKEY = 32</p> 
<blockquote> 
 <p>手动变换</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> utils <span class="token keyword">import</span> Mouse<span class="token punctuation">,</span> show_img<span class="token punctuation">,</span> show_imgs
<span class="token keyword">import</span> math
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
img_src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/imageTextR.png'</span><span class="token punctuation">)</span><span class="token comment"># chessboard-2.png</span>
img <span class="token operator">=</span> img_src<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> _ <span class="token operator">=</span> img_src<span class="token punctuation">.</span>shape

<span class="token comment">#手动捕捉特征点：</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">508</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">516</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">305</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
affineResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'compare'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span>affineResult<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>鼠标点击——三个点</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> utils <span class="token keyword">import</span> Mouse<span class="token punctuation">,</span> show_img<span class="token punctuation">,</span> show_imgs
<span class="token keyword">import</span> math
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
img_src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/imageTextR.png'</span><span class="token punctuation">)</span><span class="token comment"># chessboard-2.png</span>
img <span class="token operator">=</span> img_src<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> _ <span class="token operator">=</span> img_src<span class="token punctuation">.</span>shape

<span class="token comment">#通过鼠标标记位置</span>
colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
winnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'dst'</span><span class="token punctuation">]</span>
mouse_src <span class="token operator">=</span> Mouse<span class="token punctuation">(</span>img<span class="token punctuation">,</span> winnames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mouse_src<span class="token punctuation">.</span>selectPoints<span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 绑定鼠标事件</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>mouse_src<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token comment"># 矫正之前的位置</span>
mouse_dst <span class="token operator">=</span> Mouse<span class="token punctuation">(</span>img<span class="token punctuation">,</span> winnames<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mouse_dst<span class="token punctuation">.</span>selectPoints<span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 绑定鼠标事件</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>mouse_dst<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token comment"># 矫正之后的位置</span>
<span class="token comment"># 获取仿射变换矩阵M(2,3)</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
affineResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">120</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取透视变换/投影变换的矩阵M(3,3)</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getPerspectiveTransform<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
<span class="token comment"># 进行透视变换</span>
perspectiveResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>img_src<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 展示图片</span>
show_imgs<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> affineResult<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> perspectiveResult<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#cv2.imwrite('图片矫正结果.png', perspectiveResult)</span>
<span class="token comment">#cv2.imshow('perspectiveResult', perspectiveResult)</span>
<span class="token comment">#cv2.waitKey(0)</span>
<span class="token comment">#cv2.destroyAllWindows()</span>
</code></pre> 
<h4><a id="2462___1558"></a>24.6.2 鼠标操作+透视变换</h4> 
<blockquote> 
 <p>鼠标点击——4个点</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> utils <span class="token keyword">import</span> Mouse<span class="token punctuation">,</span> show_img<span class="token punctuation">,</span> show_imgs
<span class="token keyword">import</span> math
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
img_src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/chessboard-2.png'</span><span class="token punctuation">)</span><span class="token comment"># chessboard-2.png</span>
img <span class="token operator">=</span> img_src<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> _ <span class="token operator">=</span> img_src<span class="token punctuation">.</span>shape

<span class="token comment">#通过鼠标标记位置</span>
colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
winnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'dst'</span><span class="token punctuation">]</span>
mouse_src <span class="token operator">=</span> Mouse<span class="token punctuation">(</span>img<span class="token punctuation">,</span> winnames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mouse_src<span class="token punctuation">.</span>selectPoints<span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 绑定鼠标事件</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>mouse_src<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token comment"># 矫正之前的位置</span>
mouse_dst <span class="token operator">=</span> Mouse<span class="token punctuation">(</span>img<span class="token punctuation">,</span> winnames<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
mouse_dst<span class="token punctuation">.</span>selectPoints<span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 绑定鼠标事件</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>mouse_dst<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token comment"># 矫正之后的位置</span>
<span class="token comment"># 获取仿射变换矩阵M(2,3)</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>src<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
affineResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">120</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取透视变换/投影变换的矩阵M(3,3)</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getPerspectiveTransform<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
<span class="token comment"># 进行透视变换</span>
perspectiveResult <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>img_src<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 展示图片</span>
show_imgs<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> affineResult<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> perspectiveResult<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="247__1591"></a>24.7 图像滤波</h3> 
<h4><a id="2471___1592"></a>24.7.1 图像滤波简介</h4> 
<blockquote> 
 <p>滤波实际上是信号处理的一个概念，图像可以看成一个二维信号，其中像素点灰度值得高低代表信号的强弱<br> <strong>高频：</strong> 图像中变化剧烈的部分<br> <strong>低频：</strong> 图像中变化缓慢，平坦的部分</p> 
</blockquote> 
<blockquote> 
 <p>根据图像高低频特性，设置高通和低通滤波器。<code>高通滤波</code>可以检测图像中尖锐、变化明显的地方，<code>低通滤波</code>可以让图像变得平滑，消除噪声干扰<br> 图像滤波是OpenCV图像处理的重要部分，在<code>图像预处理</code>方面应用广泛，图像滤波的好坏决定着后续处理的结果好坏<br> 本节主要介绍低通滤波部分(图像平滑去噪)，高通部分(边缘检测)后续介绍</p> 
</blockquote> 
<blockquote> 
 <p>本节主要介绍的图像滤波函数方法：<br> <strong>线性滤波：</strong> 方框滤波、均值滤波、高斯滤波<br> <strong>非线性滤波：</strong> 中值滤波、双边滤波</p> 
</blockquote> 
<p><strong>邻域算子</strong>：利用给定像素周围的像素值决定此像素的最终输出值的一种算子<br> <strong>线性滤波</strong>：一种常用的邻域算子，像素输出取决于输入像素的加权和<br> <img src="https://images2.imgbox.com/73/f2/Ph1c5rrP_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         ( 
        
       
         i 
        
       
         , 
        
       
         j 
        
       
         ) 
        
       
         = 
        
        
        
          ∑ 
         
         
         
           k 
          
         
           , 
          
         
           l 
          
         
        
        
        
          f 
         
        
          ( 
         
        
          i 
         
        
          + 
         
        
          k 
         
        
          , 
         
        
          j 
         
        
          + 
         
        
          l 
         
        
          ) 
         
        
          ⋅ 
         
        
       
           
        
       
         h 
        
       
         ( 
        
       
         k 
        
       
         , 
        
       
         l 
        
       
         ) 
        
       
      
        g(i,j)=\sum\limits_{k,l}{f(i+k,j+l)\cdot }\text{ }h(k,l) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.88823em; vertical-align: -1.13822em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.09789em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13822em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mclose">)</span><span class="mord">⋅</span></span><span class="mord text"><span class="mord"> </span></span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mclose">)</span></span></span></span></span><br> 线性滤波器输出像素 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         ( 
        
       
         i 
        
       
         , 
        
       
         j 
        
       
         ) 
        
       
      
        g(i,j) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mclose">)</span></span></span></span></span> 是输入像素 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         ( 
        
       
         i 
        
       
         + 
        
       
         k 
        
       
         , 
        
       
         j 
        
       
         + 
        
       
         l 
        
       
         ) 
        
       
      
        f(i+k,j+l) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mclose">)</span></span></span></span></span> 的加权和，其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         h 
        
       
         ( 
        
       
         k 
        
       
         , 
        
       
         l 
        
       
         ) 
        
       
      
        h(k,l) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mclose">)</span></span></span></span></span> 我们称之为核，是滤波器的加权系数，上面式子简写为:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
         = 
        
       
         f 
        
       
         ⊗ 
        
       
         h 
        
       
      
        g=f\otimes h 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">h</span></span></span></span></span></p> 
<blockquote> 
 <p>核个数 = 输出通道数<br> 输入通道数 = 每个核的通道数<br> 输入通道数 ≠ 输出通道数</p> 
</blockquote> 
<h4><a id="2472__cv2boxFilter_1616"></a>24.7.2 方框滤波——cv2.boxFilter()</h4> 
<p>方框滤波用到的核：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         h 
        
       
         = 
        
       
         α 
        
        
        
          [ 
         
         
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
          
           
            
            
              ⋮ 
             
             
              
             
            
           
           
            
            
              ⋮ 
             
             
              
             
            
           
           
            
            
              ⋱ 
             
            
           
           
            
            
              ⋮ 
             
             
              
             
            
           
          
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
         
        
          ] 
         
        
       
      
        h=\alpha \left[ \begin{matrix} 1 &amp; 1 &amp; \ldots &amp; 1 \\ 1 &amp; 1 &amp; \ldots &amp; 1 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 1 &amp; 1 &amp; \ldots &amp; 1 \\\end{matrix} \right] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 5.46em; vertical-align: -2.48em;"></span><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.95301em;"><span class="" style="top: -1.34999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.50499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.10599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.70699em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.95301em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.45003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.64em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span><span class="" style="top: -4.44em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span><span class="" style="top: -2.58em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">⋱</span></span></span><span class="" style="top: -1.38em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.95301em;"><span class="" style="top: -1.34999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.50499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.10599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.70699em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.95301em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.45003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span>，其中： <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         α 
        
       
         = 
        
        
        
          { 
         
         
          
           
            
             
             
               1 
              
              
              
                h 
               
              
                s 
               
              
                i 
               
              
                z 
               
              
                e 
               
              
                . 
               
              
                w 
               
              
                i 
               
              
                d 
               
              
                t 
               
              
                h 
               
              
                ⋅ 
               
              
                h 
               
              
                s 
               
              
                i 
               
              
                z 
               
              
                e 
               
              
                . 
               
              
                h 
               
              
                e 
               
              
                i 
               
              
                g 
               
              
                h 
               
              
                t 
               
              
             
            
           
           
            
             
             
               n 
              
             
               o 
              
             
               r 
              
             
               m 
              
             
               a 
              
             
               l 
              
             
               i 
              
             
               z 
              
             
               e 
              
             
               = 
              
             
               t 
              
             
               r 
              
             
               u 
              
             
               e 
              
             
            
           
          
          
           
            
            
              1 
             
            
           
           
            
             
             
               o 
              
             
               t 
              
             
               h 
              
             
               e 
              
             
               r 
              
             
               w 
              
             
               i 
              
             
               s 
              
             
               e 
              
             
            
           
          
         
        
       
      
        \alpha =\left\{ \begin{matrix} \frac{1}{hsize.width\cdot hsize.height} &amp; normalize=true \\ 1 &amp; otherwise \\\end{matrix} \right. 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.52622em; vertical-align: -1.01311em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.51311em;"><span class="" style="top: -3.668em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault mtight">e</span><span class="mord mtight">.</span><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">h</span><span class="mbin mtight">⋅</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault mtight">e</span><span class="mord mtight">.</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -2.34689em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.01311em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.51311em;"><span class="" style="top: -3.668em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span></span></span><span class="" style="top: -2.34689em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.01311em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 当normalize为true时，方框滤波也就成了均值滤波。也就是说<strong>均值滤波是方框滤波归一化后的特殊情况</strong>。归一化就是将要处理的量缩放到一定范围，比如(0, 1)。</p> 
<blockquote> 
 <p><code>cv2.boxFilter(src,ddepth, ksize[,dst[anchor[,normalize[, borderType]]]]) → dst</code><br> <strong>ddepth:</strong> 输出图像的深度, -1代表使用原图像深度，即<code>src.depth()</code><strong>（卷积核的个数）</strong><br> <strong>ksize:</strong> Size类型表示内核大小,一般用Size(w,h)表示内核大小, Size(3,3)表示3x3的核大小<br> <strong>anchor:</strong> 表示锚点(即被平滑的那个点), 默认值Point(-1, -1),表示锚点在核中心<br> <strong>normalize:</strong> 默认值true, 标识符, 表示内核是否被归一化<br> <strong>borderType:</strong> 图像像素边界模式，一般用默认值即可</p> 
</blockquote> 
<h4><a id="2473__cv2blur_1628"></a>24.7.3 均值滤波——cv2.blur()</h4> 
<p>均值滤波用到的核：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         h 
        
       
         = 
        
        
         
         
          
          
            K 
           
           
           
             w 
            
           
             i 
            
           
             d 
            
           
             t 
            
           
             h 
            
           
          
         
           ⋅ 
          
          
          
            K 
           
           
           
             h 
            
           
             e 
            
           
             i 
            
           
             g 
            
           
             h 
            
           
             t 
            
           
          
         
        
        
        
          [ 
         
         
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
          
           
            
            
              ⋮ 
             
             
              
             
            
           
           
            
            
              ⋮ 
             
             
              
             
            
           
           
            
            
              ⋱ 
             
            
           
           
            
            
              ⋮ 
             
             
              
             
            
           
          
          
           
            
            
              1 
             
            
           
           
            
            
              1 
             
            
           
           
            
            
              … 
             
            
           
           
            
            
              1 
             
            
           
          
         
        
          ] 
         
        
       
      
        h=\frac{<!-- -->{}}{<!-- -->{<!-- -->{K}_{width}}\cdot {<!-- -->{K}_{height}}}\left[ \begin{matrix} 1 &amp; 1 &amp; \ldots &amp; 1 \\ 1 &amp; 1 &amp; \ldots &amp; 1 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 1 &amp; 1 &amp; \ldots &amp; 1 \\ \end{matrix} \right] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 5.46em; vertical-align: -2.48em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.394em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">K</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.34877em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.151229em;"><span class=""></span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">K</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.34877em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.290114em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.54808em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.95301em;"><span class="" style="top: -1.34999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.50499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.10599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.70699em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.95301em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.45003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.64em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span><span class="" style="top: -4.44em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span><span class="" style="top: -2.58em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">⋱</span></span></span><span class="" style="top: -1.38em;"><span class="pstrut" style="height: 3.5em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.98em;"><span class="" style="top: -5.8275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -4.6275em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -2.7675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width: 0em; border-top-width: 1.5em; bottom: 0em;"></span></span></span></span><span class="" style="top: -1.5675em;"><span class="pstrut" style="height: 3.6875em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.48em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.95301em;"><span class="" style="top: -1.34999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.50499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.10599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.70699em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.95301em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.45003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 均值滤波即方框滤波归一化特例，就是用邻域内像素均值来代替该点像素值，均值滤波在去噪的同时也破坏了图像细节部分</p> 
<blockquote> 
 <p><code>cv2.blur(src,ksize[,dst[,anchor[,borderType]]]) → dst</code><br> <strong>ksize:</strong> Size类型表示内核大小,一般用Size(w,h)表示内核大小, Size(3,3)表示3x3的核大小<br> <strong>anchor:</strong> 表示锚点(即被平滑的那个点), 默认值Point(-1, -1),表示锚点在核中心<br> <strong>borderType:</strong> 图像像素边界模式，一般用默认值即可</p> 
</blockquote> 
<h4><a id="2474__cv2GaussianBlur_1644"></a>24.7.4 高斯滤波——cv2.GaussianBlur()</h4> 
<p>高斯滤波器被称为最有用的滤波器,每个像素点都是由本身和邻域内的其他像素值经过加权平均后得到的, 加权系数越靠近中心越大, 越远离中心越小, 能够很好的滤除噪声。<br> <img src="https://images2.imgbox.com/bd/7a/rjESm6es_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><code>cv2.GaussianBlur(src,ksize,sigmaX[,dst[,sigmaY[,borderType]]]) → dst</code><br> <strong>ksize:</strong> 高斯内核大小,一般用Size(w,h)表示内核大小, w, h可以不同, 但是必须为正奇数或者0, 由sigma计算得来<br> <strong>sigmaX:</strong> 表示高斯函数在X方向上的标准偏差<br> <strong>sigmaY:</strong> 表示高斯函数在Y方向上的标准偏差, 若sigmaY=0, 就将它设置为sigmaX,若sigmaY=0 &amp;&amp; sigmaX=0则由<code>ksize.width</code>和<code>ksize.height</code>计算出来<br> <strong>borderType:</strong> 图像像素边界模式，一般用默认值即可</p> 
</blockquote> 
<h4><a id="2475__cv2medianBlur_1655"></a>24.7.5 中值滤波——cv2.medianBlur()</h4> 
<p>中值滤波是一种非线性滤波, 是用像素点邻域灰度值的中值代替该点的灰度值, 可以去除脉冲噪声和椒盐噪声<br> <code>median({1,2,3,3,7,5,1,8})=3 排序后的中间那个值</code></p> 
<blockquote> 
 <p><code>cv2.medianBlur(src,ksize[,dst]) → dst</code><br> <strong>ksize:</strong> int类型的孔径的线性尺寸, 大于1的奇数</p> 
</blockquote> 
<p>适用于：椒盐噪声</p> 
<h4><a id="2475__cv2bilateralFilter_1663"></a>24.7.5 双边滤波——cv2.bilateralFilter()</h4> 
<p>双边滤波是一种非线性滤波, 是结合图像空间邻近度和像素值相似度的一种折中处理, 尽量在去噪同时保存边缘</p> 
<blockquote> 
 <p><code>cv2.bilateralFilter(src,d, sigmaColor,sigmaSpace[,dst[, borderTypel] → dst</code><br> <strong>d:</strong> 表示过滤过程中每个像素的邻域直径<br> <strong>sigmaColor:</strong> 颜色空间滤波器sigma值, 值越大表面该像素邻域内有越广泛的颜色会混到一起，产生较大的半相等颜色区域<br> <strong>sigmaSpace:</strong> 坐标空间中滤波器的sigma值, 坐标空间的标准方差<br> <strong>borderType:</strong> 图像像素边界模式，一般用默认值即可</p> 
</blockquote> 
<h3><a id="248__1675"></a>24.8 图像阈值化</h3> 
<h4><a id="2481___1677"></a>24.8.1 图像阈值化简介</h4> 
<p>图像阈值化是图像处理的重要基础部分, 应用很广泛, 可以根据灰度差异来分割图像不同部分。阈值化处理的图像一般为单通道图像(灰度图) ；阈值化参数的设置可以使用滑动条来debug；阈值化处理易光照影响, 处理时应注意</p> 
<blockquote> 
 <p>本节主要介绍的图像阈值化函数方法：<br> <strong>固定阈值：</strong> <code>cv2.threshold()</code><br> <strong>自适应阈值：</strong> <code>cv2.adaptiveThreshold()</code></p> 
</blockquote> 
<h4><a id="2482___cv2threshold_1684"></a>24.8.2 固定阈值——<code>cv2.threshold()</code></h4> 
<p>给定阈值进行阈值操作得到二值图(0, 1两类值), 可以过滤灰度值过大或过小的点</p> 
<blockquote> 
 <p><code>cv2.threshold(src, thresh, maxval, type[, dst]) → retval, dst</code><br> <strong>src:</strong> 单通道图像(灰度图或二值图)<br> <strong>dst:</strong> 输出图像要求和src一样的尺寸和类型<br> <strong>thresh:</strong> 给定的阈值<br> <strong>maxval:</strong> 第五个参数设置为<code>CV_THRESH_BINARY</code>或<code>CV_THRESH_BINARY_INV </code>阈值类型的最大值</p> 
 <blockquote> 
  <p>二值化阈值处理<br> <strong>THRESH_BINARY：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 m 
                
               
                 a 
                
               
                 x 
                
               
                 V 
                
               
                 a 
                
               
                 l 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 0 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} maxVal \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\0\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 反二值化阈值处理<br> <strong>THRESH_BINARY_INV：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 0 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 m 
                
               
                 a 
                
               
                 x 
                
               
                 V 
                
               
                 a 
                
               
                 l 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} 0 \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\maxVal\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 截断阈值化处理<br> <strong>THRESH_TRUNC：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
                 o 
                
               
                 l 
                
               
                 d 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} threshold \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\src(x,y)\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 超阈值零处理<br> <strong>THRESH_TOZORE：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 0 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} src(x,y) \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\0\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 低阈值零处理<br> <strong>THRESH_TOZORE_INV：</strong><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 0 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} 0 \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\src(x,y)\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
 </blockquote> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c8/bc/B4GVAEjb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2483___cv2adaptiveThreshold_1704"></a>24.8.3 自适应阈值——<code>cv2.adaptiveThreshold()</code></h4> 
<p>对矩阵采用自适应阈值操作, 自适应阈值是根据像素的邻域块的像素值分布来确定该像素位置上的二值化阈值，把局部的均值作为局部的阈值</p> 
<blockquote> 
 <p><code>cv2.adaptiveThreshold(src, maxValue, adaptiveMethod, thresholdType, blockSize, C[, dst]) → dst</code><br> <strong>src:</strong> 单通道图像(灰度图或二值图)<br> <strong>dst:</strong> 输出图像要求和src一样的尺寸和类型<br> <strong>maxValue:</strong> 使用<code>cv2.THRESH_BINARY</code>和<code> cv2.THRESH_BINARY_INV</code> 的最大值<br> <strong>adaptiveMethod:</strong> 指定自适应阈值算法, 可取值为<code>cv2.ADAPTIVE_THRESH_MEAN_C</code> 或<code>cv2.ADAPTIVE_THRESH_GAUSSIAN_C</code><br> <strong>thresholdType:</strong> 取阈值类型取值必须为<code>cv2.THRESH_BINARY</code>、<code>cv2.THRESH_BINARY_INV</code>二者之一<br> <strong>blockSize:</strong> 用来计算阈值的邻域大小3, 5, 7,…<br> <strong>C:</strong> 减去平均或加权平均后的常数值</p> 
 <blockquote> 
  <p>函数 <code>adaptiveThreshold</code> 将灰度图像变换到二值图像，采用下面公式:<br> <strong>thresholdType= cv2.THRESH_BINARY :</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 m 
                
               
                 a 
                
               
                 x 
                
               
                 V 
                
               
                 a 
                
               
                 l 
                
               
                   
                
               
                 i 
                
               
                 f 
                
               
                   
                
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 0 
                
               
                   
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} maxVal\text{ }if\text{ }src(x,y)&gt;thresh \\ 0\text{ }otherwise \\ \end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord text"><span class="mord"> </span></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord text"><span class="mord"> </span></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mord text"><span class="mord"> </span></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> <strong>thresholdType= cv2.THRESH_BINARY_INV:</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           d 
          
         
           s 
          
         
           t 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            { 
           
           
            
             
              
               
               
                 0 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 i 
                
               
                 f 
                
                
                 
                  
                   
                  
                 
                 
                 
               
                 s 
                
               
                 r 
                
               
                 c 
                
               
                 ( 
                
               
                 x 
                
               
                 , 
                
               
                 y 
                
               
                 ) 
                
               
                 &gt; 
                
               
                 t 
                
               
                 h 
                
               
                 r 
                
               
                 e 
                
               
                 s 
                
               
                 h 
                
               
              
             
            
            
             
              
               
               
                 m 
                
               
                 a 
                
               
                 x 
                
               
                 V 
                
               
                 a 
                
               
                 l 
                
                
                 
                  
                 
                 
                 
                
                
                 
                  
                 
                 
                 
                
               
                 o 
                
               
                 t 
                
               
                 h 
                
               
                 e 
                
               
                 r 
                
               
                 w 
                
               
                 i 
                
               
                 s 
                
               
                 e 
                
               
              
             
            
           
          
         
        
          dst(x,y)=\left\{ \begin{matrix} 0 \mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}if\overset{<!-- -->{}}{\mathop{<!-- -->{}}}\,src(x,y)&gt;thresh \\maxVal\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}\mathop{<!-- -->{}}_{<!-- -->{}}^{<!-- -->{}}otherwise \\\end{matrix} \right. 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.3em;"><span class="" style="top: -2em;"><span class="pstrut" style="height: 2em;"></span><span class=""><span class="mop"><span class="mop"><span class="mord"></span></span></span></span></span><span class="" style="top: -2.2em; margin-left: 0em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right: 0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop"><span class="mord"></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.363em;"><span class="" style="top: -1.753em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span><span class="" style="top: -2.363em; margin-right: 0.05em;"><span class="pstrut" style="height: 2em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> <strong>其中T(x, y)为分别计算每个单独像素的阈值, 取值如下:</strong><br> 对方法 <code>cv2.ADAPTIVE_THRESH_MEAN_C</code>, 先求出块中的均值，再减掉C<br> 对方法 <code>cv2.ADAPTIVE_THRESH_GAUSSIAN_C</code>, 先求出块中的加权和(gaussian), 再减掉C</p> 
 </blockquote> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
image_path <span class="token operator">=</span> <span class="token string">r'D:/datas2/yellowmoon.png'</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

img_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img_gray'</span><span class="token punctuation">,</span> img_gray<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>adaptiveThreshold<span class="token punctuation">(</span>img_gray<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ADAPTIVE_THRESH_MEAN_C<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY_INV<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
<span class="token comment"># _, thresh = cv2.threshold(img_gray, 0, 255, cv2.THRESH_BINARY+cv2.THRESH_OTSU)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'thresh'</span><span class="token punctuation">,</span> thresh<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/d5/z1fl4pCx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2484_Otsu_1745"></a>24.8.4 Otsu阈值化</h4> 
<p>在使用全局阈值时，我们就是随便给了一个数来做阈值，那我们怎么知道我们选取的这个数的好坏呢？答案就是不停的尝试。如果是一副双峰图像（简单来说双峰图像是指图像直方图中存在两个峰）呢？我们岂不是应该在两个峰之间的峰谷选一个值作为阈值？这就是 Otsu 二值化要做的。简单来说就是对一副双峰图像自动根据其直方图计算出一个阈值。（对于非双峰图像，这种方法得到的结果可能会不理想）</p> 
<p>这里用到到的函数还是 <code>cv2.threshold()</code>，但是需要多传入一个参数<code>（flag）: cv2.THRESH_OTSU</code>。这时要把阈值设为 0。然后算法会找到最优阈值，这个最优阈值就是返回值 retVal。如果不使用 Otsu 二值化，返回的 retVal 值与设定的阈值相等</p> 
<p><img src="https://images2.imgbox.com/96/8c/OMhhAwG1_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><code>cv2.calcHist(images, channels, mask, histSize, ranges[, hist[, accumulate ]]) -&gt;hist</code><br> 通过直方图可以很好的对整幅图像的灰度分布有一个整体的了解，直方图的x轴是灰度值（0~255），y轴是图片中具有同一个灰度值的点的数目。而calcHist()函数则可以帮助我们统计一幅图像的直方图<br> <strong>mages:</strong> 原图像图像格式为 uint8 或 ﬂoat32。当传入函数时应 用中括号 [] 括来例如[img]<br> <strong>channels:</strong> 同样用中括号括来它会告函数我们统幅图 像的直方图。如果入图像是灰度图它的值就是 [0]; 如果是彩色图像的传入的参数可以是 [0][1][2] 它们分别对应着 BGR。<br> <strong>mask:</strong> 掩模图像。统整幅图像的直方图就把它为 None。但是如果你想统图像某一分的直方图的你就制作一个掩模图像并使用它。<br> <strong>histSize:</strong> BIN 的数目。也应用中括号括来<br> <strong>ranges:</strong> 像素值范围常为 [0 256]</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/snowqueen.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
hist <span class="token operator">=</span> cv2<span class="token punctuation">.</span>calcHist<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>hist<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>hist<span class="token punctuation">[</span><span class="token number">175</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>hist<span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>img<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>hist<span class="token punctuation">,</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/39/p4795gAP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2485_threshold_1791"></a>24.8.5 全局阈值——threshold</h4> 
<ol><li>手动滑动条调试</li><li>不断测试（debug）</li><li>Otsu算法：根据统计直方图分析获取</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment">#img = cv2.imread('grey-gradient.jpg', 0)#</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/snowqueen.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY_INV<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TRUNC<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh4 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TOZERO<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh5 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TOZERO_INV<span class="token punctuation">)</span>

titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span> <span class="token string">'BINARY'</span><span class="token punctuation">,</span> <span class="token string">'BINARY_INV'</span><span class="token punctuation">,</span> <span class="token string">'TRUNC'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO_INV'</span><span class="token punctuation">]</span>
images <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> thresh1<span class="token punctuation">,</span> thresh2<span class="token punctuation">,</span> thresh3<span class="token punctuation">,</span> thresh4<span class="token punctuation">,</span> thresh5<span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'gray'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/a5/fBtyFaYY_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

<span class="token comment">#img = cv2.imread('grey-gradient.jpg', 0)#</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/snowqueen.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY_INV<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TRUNC<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh4 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TOZERO<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh5 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_TOZERO_INV<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU

titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span> <span class="token string">'BINARY'</span><span class="token punctuation">,</span> <span class="token string">'BINARY_INV'</span><span class="token punctuation">,</span> <span class="token string">'TRUNC'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO_INV'</span><span class="token punctuation">]</span>
images <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> thresh1<span class="token punctuation">,</span> thresh2<span class="token punctuation">,</span> thresh3<span class="token punctuation">,</span> thresh4<span class="token punctuation">,</span> thresh5<span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'gray'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/5d/1BJ3rtiP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="249__1844"></a>24.9 图像形态学操作</h3> 
<p><strong>膨胀腐蚀概述</strong></p> 
<ol><li>膨胀、腐蚀属于形态学的操作, 简单来说就是基于形状的一系列图像处理操作</li><li>膨胀腐蚀是基于高亮部分(白色)操作的, 膨胀是対高亮部分进行膨胀, 类似“领域扩张”, 腐蚀是高亮部分被腐蚀, 类似“领域被蚕食”</li><li>膨胀腐蚀的应用和功能:<br> 消除噪声<br> 分割独立元素或连接相邻元素<br> 寻找图像中的明显极大值、极小值区域<br> 求图像的梯度</li><li>其他相关:<br> 开运算、闭运算<br> 顶帽、黒帽<br> 形态学梯度</li></ol> 
<p><strong>形态学其他操作:</strong><br> 开运算、闭运算、顶帽、黒帽、形态学梯度<br> 基于膨胀腐蚀基础, 利用<code>cv2.morphologyEx()</code>函数进行操作<br> <strong>核心函数:</strong></p> 
<blockquote> 
 <p><code>cv2.morphologyEx(src,op, kernel[, dst[,anchor[,iterations[, borderType[, borderValue]]]]]) → dst</code><br> <strong>src:</strong> 输入原图像<br> <strong>op:</strong> 表示形态学运算的类型, 可以取如下值:</p> 
 <blockquote> 
  <p>cv2.MORPH_GRADIENT<br> cv2.MORPH_ERODE<br> cv2.MORPH_DILATE<br> cv2.MORPH_OPEN<br> cv2.MORPH_CLOSE<br> cv2.MORPH_TOPHAT<br> cv2.MORPH_BILACKHAT</p> 
 </blockquote> 
 <p><strong>kernel:</strong> 形态学运算内核, 若为NULL, 表示使用参考点位于中心的3x3内核, 一般使用<code>getStruecuringElement</code>函数获得<br> <strong>dst:</strong> 输出图像要求和 src 一样的尺寸和类型<br> <strong>anchor:</strong> 锚的位置, 默认值Point(-1,-1), 表示位于中心<br> <strong>interations:</strong> 迭代使用函数的次数, 默认为1<br> <strong>borderType:</strong> 边界模式, 一般采用默认值<br> <strong>borderValue:</strong> 边界值, 一般采用默认值</p> 
</blockquote> 
<h4><a id="2491_cv2dilate_1879"></a>24.9.1 膨胀——cv2.dilate()</h4> 
<p>膨胀就是求局部最大值的操作, 从数学角度上来讲, 膨胀或腐蚀就是将图像(或区域)A与 核B进行卷积。<br> 核可以是任意大小和形状, 它有一个独立定义的参考点(锚点), 多数情况下, 核是一个小的中间带参考点和实心正方形或者圆盘, 可以看做是一个模板或掩码。</p> 
<blockquote> 
 <p><code>cv2.getStructuringElement(shape, ksize, point)</code><br> shape: MORPH_RECT=0.MORPH_CROSS=1,MORPH_ELLIPSE=2<br> ksize和point(默认值为中心)分别表示内核尺寸和锚点位置</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># MORPH_CROSS</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_CROSS<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[0 1 0]
 [1 1 1]
 [0 1 0]]
'''</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_CROSS<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[0 0 1 0 0]
 [1 1 1 1 1]
 [0 0 1 0 0]]
'''</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_CROSS<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[0 0 1 0]
 [1 1 1 1]
 [0 0 1 0]]
'''</span>

<span class="token comment"># MORPH_ELLIPSE</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[0 0 0 1 0 0 0]
 [0 1 1 1 1 1 0]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [0 1 1 1 1 1 0]
 [0 0 0 1 0 0 0]]
'''</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[0 0 0 1 0 0 0]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [0 0 0 1 0 0 0]]
'''</span>

<span class="token comment"># MORPH_RECT</span>
kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_RECT<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'kernel:\n'</span><span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
kernel:
 [[1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]
 [1 1 1 1 1 1 1]]
'''</span>
</code></pre> 
<p>膨胀是求局部最大值的操做, 核B与图形卷积, 即核B覆盖的区域的像素点的最大值, 并把这个最大值复制给参考点指定的像素, 这样就会使图像中的高亮区域逐渐增长, 如下图<br> <img src="https://images2.imgbox.com/be/cf/QeBYDxAN_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><code>cv2.dilate(src, kernel, dst,[ anchor[, iterations[, borderType[, borderValue]]]]]) → dst</code><br> <strong>src:</strong> 输入原图像(建议为二值图)<br> <strong>dst:</strong> 输出图像要求和src一样的尺寸和类型<br> <strong>kernel:</strong> 膨胀操作的核, 当为NULL时, 表示使用参考点位于中心的3x3的核，一般使用<code>cv2.getStructuringElement</code>获得指定形状和尺寸的结构元素(核)，可选: 矩形、交叉形、椭圆形<br> <strong>anchor:</strong> 锚的位置, 默认值Point(-1,-1), 表示位于中心<br> <strong>interations:</strong> 膨胀的次数<br> <strong>borderType:</strong> 边界模式, 一般采用默认值<br> <strong>borderValue:</strong> 边界值, 一般采用默认值</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/j.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'j.png'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
kernel17 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
kernel71 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
dilation17 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel17<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
dilation71 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel71<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'dilation'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> dilation<span class="token punctuation">,</span> dilation17<span class="token punctuation">,</span> dilation71<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>moveWindow<span class="token punctuation">(</span><span class="token string">'dilation'</span><span class="token punctuation">,</span> x<span class="token operator">=</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/66/f5ALyhCJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2492__cv2erode_1987"></a>24.9.2 腐蚀——cv2.erode()</h4> 
<p>腐蚀和膨胀相反, 是取局部最小值, 高亮区域逐渐减小, 如下图所示:<br> <img src="https://images2.imgbox.com/be/c7/BVwxOpQv_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>cv2.erode(src, kernel[, dst[,anchor[,iterations[, borderType[, borderValue]]]]]) → dst</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'j.png'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># cv2.getStructuringElement(shape, ksize)</span>
erosion <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> erosion<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dilation<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'erode'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> erosion<span class="token punctuation">,</span> dilation<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>moveWindow<span class="token punctuation">(</span><span class="token string">'erode'</span><span class="token punctuation">,</span> x<span class="token operator">=</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/62/LL7JrMR8_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'j2.png'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
erosion <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 腐蚀</span>
dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 膨胀</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'erosion&amp;dilation'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span>erosion<span class="token punctuation">,</span>dilation<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/64/c2/xxYcAD7o_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2493_open_2033"></a>24.9.3 开运算(open)</h4> 
<p>开运算是先腐蚀后膨胀的过程, 开运算可以用来消除小物体, 在纤细点处分离物体, 并在平滑较大物体边界的同时不明显的改变其面积。</p> 
<blockquote> 
 <p>opening= cv2.morphologyEx(img,cv2.MORPH_OPEN,k1)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># 开运算：先腐蚀再膨胀就叫做开运算。就像我们上介绍的样，它用来去噪声。</span>
opening <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'opening'</span><span class="token punctuation">,</span> opening<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>moveWindow<span class="token punctuation">(</span><span class="token string">'opening'</span><span class="token punctuation">,</span> x<span class="token operator">=</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/fe/13j6O3lQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2494_close_2053"></a>24.9.4 闭运算(close)</h4> 
<p>闭运算是先膨胀后腐蚀的过程, 闭运算可以用来消除小型黑洞(黑色区域)。</p> 
<blockquote> 
 <p>closing = cv2.morphologyEx(img,cv2.MORPH_CLOSE,k1)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># 闭运算</span>
<span class="token comment"># 先膨胀再腐蚀。它经常用来填充前景物体中的小洞或者前景物体上的小黑点。</span>
closing <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'closing'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> closing<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/94/pVYYma8D_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2495_Gradient_2071"></a>24.9.5 形态学梯度(Gradient)</h4> 
<p>形态学梯度是膨胀图与腐蚀图之差, 对二值图可以将团块(blob)边缘凸显出来, 可以用其来保留边缘轮廓。</p> 
<blockquote> 
 <p>gradient = cv2.morphologyEx(img,cv2.MORPH_GRADIENT,k1)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
erosion <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 腐蚀</span>
dilation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 膨胀</span>
<span class="token comment"># 开运算：</span>
opening <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
<span class="token comment"># 闭运算</span>
closing <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>

<span class="token comment"># 形态学梯度</span>
<span class="token comment"># 其实就是一幅图像膨胀与腐蚀的差别。</span>
<span class="token comment"># 结果看上去就像前景物体的轮廓。</span>
kernel1 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment">#kernel2=np.uint8(np.asarray([[0,1,0],[1,-8,1],[0,1,0]]))</span>
gradient <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_GRADIENT<span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span>
mygrad <span class="token operator">=</span> dilation <span class="token operator">-</span> erosion
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'gradient'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span> gradient<span class="token punctuation">,</span> mygrad<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/13/a0/QLoRtC1n_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2496_Top_Hat_2103"></a>24.9.6 顶帽(Top Hat)</h4> 
<p>顶帽运算也被称为”礼帽”, 是开运算结果和原图像做差的结果, 可以用来分离比邻近点亮一些的斑块。</p> 
<blockquote> 
 <p>tophat = cv2.morphologyEx(img,cv2.MORPH_TOPHAT,k1)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># 礼帽</span>
<span class="token comment"># 原始图像与  开运算之后得到的图像的差。</span>
tophat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_TOPHAT<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'tophat'</span><span class="token punctuation">,</span> tophat<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/10/12/eExVpnod_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2497_Black_Hat_2122"></a>24.9.7 黒帽(Black Hat)</h4> 
<p>黑帽运算是原图像和开运算做差的结果, 可以用来分离比邻近点暗一些的斑块。</p> 
<blockquote> 
 <p>blackhat = cv2.morphologyEx(img,cv2.MORPH_BLACKHIAT,k1)</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:/datas2/j2.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># 黑帽  进行闭运算之后得到的图像与原始图像的差</span>
blackhat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_BLACKHAT<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'blackhat'</span><span class="token punctuation">,</span> blackhat<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/51/wtpc91iY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2410__2138"></a>24.10 图像边缘检测</h3> 
<p><strong>边缘检测概述</strong><br> 边缘检测可以提取图像重要轮廓信息, 减少图像内容, 可以用于分割图像、做特征提取等</p> 
<ol><li>边缘检测的一般步骤:<br> 滤波----(滤出噪声対检测边缘的影响)<br> 增强----(可以将像素邻域强度变化凸显出来—梯度算子)<br> 检测----(阈值方法确定边缘)</li><li>常用边缘检测算子:<br> Canny算子<br> Sobel算子<br> Scharr算子<br> Laplacian算子<br> Roberts 算子、Prewitt算子… …</li></ol> 
<p>边缘检测：</p> 
<ol><li>确定边缘——灰度值函数变化尖锐的地方：如sobel算子近似获取梯度（x方向，y方向）</li><li>sobel：比较简单，但是如果出现锯齿形边缘，则提取不到连续的边缘</li><li>canny：常用/通用，如果出现锯齿形的边缘，也能提取到连续的边缘，但是阈值需要进行调试</li><li>拉普拉斯</li><li>形态学梯度：保留边缘轮廓</li><li>局部阈值处理:如果轮廓有毛边，阈值方法可以优先考虑cv2.ADAPTIVE_THRESH_GAUSSIAN_C，然后调试阈值C</li></ol> 
<h4><a id="24101_Canny_2159"></a>24.10.1 Canny边缘检测</h4> 
<p>Canny边缘检测算子是John F.Canny于1986 年开发出来的一个多级边缘检测算法, Canny边缘检测算法以Canny的名字命名, 被很多人推崇为当今最优的边缘检测的算法。</p> 
<p><strong>Canny边缘检测步骤:</strong></p> 
<ol><li> <p>消除噪声: 一般情况使用高斯平滑滤波器卷积降噪</p> </li><li> <p>计算梯度幅值和方向: 安装Sobel滤波器的步骤操作<br> <img src="https://images2.imgbox.com/cb/51/5b2VZTz3_o.png" alt="在这里插入图片描述"></p> </li><li> <p>非极大值抑制: 排除非边缘像素</p> </li><li> <p>滞后阈值: 滞后阈值需要两个阈值(高阈值和低阈值):<br> Ⅰ.如果某一像素位置的幅值超过高阈值，该像素被保留为边缘像素。<br> Ⅱ.如果某一像素位置的幅值小于低 阈值，该像素被排除。<br> Ⅲ如果某一像素位置的幅值在两个阈值之间该像素仅仅在连接到一个高于高阈值的像素时被保留。</p> </li></ol> 
<blockquote> 
 <p><code>cv2.Canny(image,threshold1,threshold2l,edges[,apertureSize[,L2gradient]]]) → edges</code><br> <strong>src:</strong> 输入原图像(一般为单通道8位图像)<br> <strong>dst:</strong> 输出边缘图像要求和src一样的尺寸和类型(单通道)<br> <strong>threshold1:</strong> 滞后阈值低阈值(用于边缘连接)<br> <strong>threshold2:</strong> 滞后阈值高阈值(控制边缘初始段)推荐高低阈值比值在2:1到3:1之间<br> <strong>apertureSize:</strong> 表示Sobel算子孔径大小, 默认值3<br> <strong>L2gradient:</strong> 计算图像梯度幅值的标识</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/20/b4/nW0hPkhB_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'D:\datas2\sudoku.jpg'</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
edges <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
edges1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span>
edges2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">254</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Edges'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>edges1<span class="token punctuation">,</span>edges2<span class="token punctuation">,</span>edges<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/7e/3tJt06eK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24102_Sobel_2200"></a>24.10.2 Sobel算子</h4> 
<p>Sobel算子是一个主要用于边缘检测的离散微分算子, 它结合了高斯平滑和微分求导, 用来计算图像灰度函数的近似梯度。</p> 
<p><strong>Sobel算子计算过程:</strong></p> 
<ol><li>分别在x和y两个方向求导:<br> Ⅰ 水平变化：将Ⅰ与—个奇数大小的内核Gx进行卷积。比如，当内核大小为3时，Gx的计算结果为;<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           G 
          
         
           x 
          
         
        
          = 
         
         
         
           [ 
          
          
           
            
             
              
              
                − 
               
              
                1 
               
              
             
            
            
             
             
               0 
              
             
            
            
             
              
              
                + 
               
              
                1 
               
              
             
            
           
           
            
             
              
              
                − 
               
              
                2 
               
              
             
            
            
             
             
               0 
              
             
            
            
             
              
              
                + 
               
              
                2 
               
              
             
            
           
           
            
             
              
              
                − 
               
              
                1 
               
              
             
            
            
             
             
               0 
              
             
            
            
             
              
              
                + 
               
              
                1 
               
              
             
            
           
          
         
           ] 
          
         
        
          ⊗ 
         
        
          I 
         
        
       
         {<!-- -->{G}_{x}}=\left[ \begin{matrix} -1 &amp; 0 &amp; +1 \\ -2 &amp; 0 &amp; +2 \\ -1 &amp; 0 &amp; +1 \\ \end{matrix} \right]\otimes I 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.60004em; vertical-align: -1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">2</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">2</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span></span></span></span></span><br> Ⅱ.垂直变化∶将Ⅰ 与一个奇数大小的内核Gy进行卷积。比如，当内核大小为3时，Gy的计算结果为:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           G 
          
         
           y 
          
         
        
          = 
         
         
         
           [ 
          
          
           
            
             
              
              
                − 
               
              
                1 
               
              
             
            
            
             
              
              
                − 
               
              
                2 
               
              
             
            
            
             
              
              
                − 
               
              
                1 
               
              
             
            
           
           
            
             
             
               0 
              
             
            
            
             
             
               0 
              
             
            
            
             
             
               0 
              
             
            
           
           
            
             
              
              
                + 
               
              
                1 
               
              
             
            
            
             
              
              
                + 
               
              
                2 
               
              
             
            
            
             
              
              
                + 
               
              
                1 
               
              
             
            
           
          
         
           ] 
          
         
        
          ⊗ 
         
        
          I 
         
        
       
         {<!-- -->{G}_{y}}=\left[ \begin{matrix} -1 &amp; -2 &amp; -1 \\ 0 &amp; 0 &amp; 0 \\ +1 &amp; +2 &amp; +1 \\ \end{matrix} \right]\otimes I 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.60004em; vertical-align: -1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">2</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05em;"><span class="" style="top: -4.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span></span></span></span></span></li><li>在图像的每一点，结合以上两个结果求出近似梯度：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
          = 
         
         
          
           
            
            
              G 
             
            
              x 
             
            
           
             2 
            
           
          
            + 
           
           
            
            
              G 
             
            
              y 
             
            
           
             2 
            
           
          
         
        
       
         G=\sqrt{<!-- -->{<!-- -->{G}_{x}}^{2}+{<!-- -->{G}_{y}}^{2}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.84em; vertical-align: -0.554385em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.28561em;"><span class="svg-align" style="top: -3.8em;"><span class="pstrut" style="height: 3.8em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.887338em;"><span class="" style="top: -3.13623em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.887338em;"><span class="" style="top: -3.13623em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.24561em;"><span class="pstrut" style="height: 3.8em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.88em;"> 
            <svg width="400em" height="1.8800000000000001em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
             <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.554385em;"><span class=""></span></span></span></span></span></span></span></span></span><br> 另外有时，也可用下面更简单的公式代替：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
          = 
         
         
         
           ∣ 
          
          
          
            G 
           
          
            x 
           
          
         
           ∣ 
          
         
        
          + 
         
         
         
           ∣ 
          
          
          
            G 
           
          
            y 
           
          
         
           ∣ 
          
         
        
       
         G=\left| {<!-- -->{G}_{x}} \right|+\left| {<!-- -->{G}_{y}} \right| 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∣</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">∣</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∣</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">G</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">∣</span></span></span></span></span></span></li></ol> 
<p><strong>Sobel边缘检测函数—cv2.Sobel()</strong></p> 
<blockquote> 
 <p><code>cv2.Sobel(src,ddepth,dx,dy[,dst[,ksize[,scale[, delta[, borderType]]]]]) → dst</code><br> <strong>src:</strong> 输入原图像<br> <strong>dst:</strong> 输出图像要求和src一样的尺寸和类型<br> <strong>ddepth:</strong> 输出图像的深度, 支持如下组合:</p> 
 <blockquote> 
  <p>若src.depth0=CV_8U，取ddepth = -1/CV16S/CV_32F/CV64F<br> 若src.depth0=CV_16U/CV_16S，取ddepth = -1/CV 32F/CV_64F<br> 若src.depth0=CV_32F，取ddepth = -1/CV32F/CV64F<br> 若src.depth0= CV 64F，取ddepth = -1/CV 64F</p> 
 </blockquote> 
 <p><strong>dx:</strong> X方向上的差分阶数<br> <strong>dy:</strong> Y方向上的差分阶数<br> <strong>ksize:</strong> 默认值3, 表示Sobel核大小, 1,3,5,7<br> <strong>scale:</strong> 计算导数值时的缩放因子, 默认值1, 表示不缩放<br> <strong>delta(δ):</strong> 表示在结果存入目标图之前可选的delta值, 默认值0<br> <strong>borderType:</strong> 边界模式, 一般采用默认</p> 
</blockquote> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">r'd:\datas2\sudoku.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># cv2.CV_64F 出图像的深度 数据类型 可以使用 -1, 与原图像保持一致 np.uint8</span>
laplacian <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Laplacian<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_64F<span class="token punctuation">)</span>
<span class="token comment"># 参数 1,0 为只在 x 方向求一 导数 最大可以求 2 导数。</span>
sobelx <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># ksize 1 3 5 7等奇数</span>
sobelxabs <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>sobelx<span class="token punctuation">)</span>
<span class="token comment"># 参数 0,1 为只在 y 方向求一 导数 最大可以求 2 导数。</span>
sobely <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> 

sobelyabs <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>sobely<span class="token punctuation">)</span>
sobel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>sobelxabs<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> sobelyabs<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

sobel11 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>


<span class="token comment">#cv2.imshow('sobely', sobely)</span>
<span class="token comment">#cv2.waitKey(0)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Original'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>sobel11<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'sobel11'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>sobelx<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sobel X'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>sobely<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sobel Y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>sobel<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sobel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/29/S9vOItU7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24103_Laplacian_2280"></a>24.10.3 Laplacian算子</h4> 
<p>Laplacian算子是n维欧几里德中的一个二阶微分算子。</p> 
<p>Laplacian算子的定义:<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         L 
        
       
         a 
        
       
         p 
        
       
         l 
        
       
         a 
        
       
         c 
        
       
         e 
        
       
         ( 
        
       
         f 
        
       
         ) 
        
       
         = 
        
        
         
          
          
            ∂ 
           
          
            2 
           
          
         
           f 
          
         
         
         
           ∂ 
          
          
          
            x 
           
          
            2 
           
          
         
        
       
         + 
        
        
         
          
          
            ∂ 
           
          
            2 
           
          
         
           f 
          
         
         
         
           ∂ 
          
          
          
            y 
           
          
            2 
           
          
         
        
       
      
        Laplace(f)=\frac{<!-- -->{<!-- -->{\partial }^{2}}f}{\partial {<!-- -->{x}^{2}}}+\frac{<!-- -->{<!-- -->{\partial }^{2}}f}{\partial {<!-- -->{y}^{2}}} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.41503em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.07003em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.746314em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.44611em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.55114em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.07003em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.746314em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.44611em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
<p><strong>Laplacian边缘检测函数</strong>——<code>cv2.Laplacian()</code></p> 
<blockquote> 
 <p><code>cv2.Laplacian(src, ddepth[,dst[, ksize[, scalel[, deltal[, borderTyel]]]]) → dst</code><br> <strong>src:</strong> 输入原图像(单通道8位图像)<br> <strong>dst:</strong> 输出边缘图像要求和src一样的尺寸和通道数<br> <strong>ddepth:</strong> 目标图像的深度<br> <strong>Ksize:</strong> 用于计算二阶导数的滤波器孔径大小, 须为正奇数, 默认值1<br> <strong>scale:</strong> 可选比例因子, 默认值1<br> <strong>delta:</strong> 可选参数δ, 默认值0<br> <strong>borderType:</strong> 边界模式, 一般采用默认值</p> 
</blockquote> 
<h3><a id="2411___2296"></a>24.11 霍夫变换及应用</h3> 
<p>(待补充)</p> 
<h3><a id="2412___2299"></a>24.12 直方图计算及绘制</h3> 
<h4><a id="24121__2301"></a>24.12.1 图像直方图概述</h4> 
<p>直方图是对数据进行统计的一种方法, 可以直观表现图像某属性的数值(频率)分布情况, 包括灰度直方图、RGB直方图等<br> <strong>相关概念及函数:</strong><br> dims: 需要统计得特征的数目, 如只统计灰度值——dims=1, 统计RGB值——dims=3<br> bins: 每个特征空间子区域段的数目,也可称为组距(简单理解为直方图分成几个柱子组成)<br> range: 每个特征空间的取值范围, 如灰度值取值范围[0, 255]<br> 计算直方图函数: <code>cv2.calcHist()</code></p> 
<blockquote> 
 <p><code>cv2.calcHist(images, channels, mask, histSize, ranges[, hist[, accumulate ]]) -&gt;hist</code><br> <strong>images:</strong> 源图像, 输入数组(或数组集), 需要有相同的深度和尺寸<br> <strong>nimages:</strong> 输入数组的个数, 即第一个参数中存放图像个数<br> <strong>channels:</strong> 需要统计通道的索引, 表示要使用哪个通道或多个通道(属性)<br> <strong>mask:</strong> 可选的操作掩码, 如果不为空, 则必须为8位, 并且与图像有一样大小尺寸<br> <strong>hist:</strong> 输出的目标直方图<br> <strong>dims:</strong> 需要计算的直方图维度, 必须是正数<br> <strong>histSize:</strong> 存放每个维度的直方图尺寸的数组, 即bins<br> <strong>ranges:</strong> 表示每一维数值的取值范围<br> <strong>uniform:</strong> 直方图是否均匀的标识符, 默认值true<br> <strong>accumulate:</strong> 累计标识符, 默认值false, 若为true, 直方图在配置阶段不会被清零</p> 
</blockquote> 
<blockquote> 
 <p>灰度直方图</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4a/97/gIdRUeR6_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt 
<span class="token keyword">print</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
hist <span class="token operator">=</span> cv2<span class="token punctuation">.</span>calcHist<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>img<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/07/52/NqQGhFm9_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>RGB三色直方图</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">from</span> cv2 <span class="token keyword">import</span> waitKey
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt 

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">)</span>
color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>col <span class="token keyword">in</span> <span class="token builtin">enumerate</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">:</span>
    histr<span class="token operator">=</span> cv2<span class="token punctuation">.</span>calcHist<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>histr<span class="token punctuation">,</span>color <span class="token operator">=</span> col<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/59/SzLPJkWg_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">from</span> cv2 <span class="token keyword">import</span> waitKey
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt 

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">)</span>
mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
mask<span class="token punctuation">[</span><span class="token number">130</span><span class="token punctuation">:</span><span class="token number">327</span><span class="token punctuation">,</span><span class="token number">158</span><span class="token punctuation">:</span><span class="token number">473</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
color <span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span>col <span class="token keyword">in</span> <span class="token builtin">enumerate</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">:</span>
    histr<span class="token operator">=</span> cv2<span class="token punctuation">.</span>calcHist<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>mask<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>histr<span class="token punctuation">,</span>color <span class="token operator">=</span> col<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/6e/YGVLZ2gN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24122__2373"></a>24.12.2 直方图相关及应用</h4> 
<ol><li><strong>直方图均衡化——<code>cv2.equalizeHist()</code></strong><br> · 直方图均衡化是灰度变换的一个重要应用, 它是通过拉伸像素强度分布范围来增强图像对比度的一种方法, 广泛应用于图像增强处理中。<br> · <code>直方图均衡化（Histogram Equalization）</code>是直方图最典型的应用，是图像点运算的一种。对于一幅输入图像，通过运算产生一幅输出图像，点运算是指输出图像的每个像素点的灰度值由输入像素点决定，即∶<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          B 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          = 
         
        
          f 
         
        
          [ 
         
        
          A 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
          ] 
         
        
       
         B(x,y)=f[A(x,y)] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span><br> · 直方图均衡化是通过灰度变换将一幅图像转换为另—幅具有均衡直方图，即在每个灰度级上都具有相同的像素点数过程。从分布图上的理解就是希望原始图像中 y 轴的值在新的分布中尽可能的展开。变换过程是利用累积分布函数对原始分布进行映射，生成新的均匀拉伸的分布。因此对应每个点的操作是寻找原始分布中 y 值在均匀分布中的位置，如下图是理想的单纯高斯分布映射的示意图∶<br> <img src="https://images2.imgbox.com/42/04/V51siQ5x_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p><code>cv2.equalizeHist(src [,dst]) → dst</code><br> src: 输入原图像, Mat类对象即可, 需为8位单通道图像<br> dst: 均衡化后结果图像, 需和原图一样的尺寸和类型</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">from</span> cv2 <span class="token keyword">import</span> waitKey
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt 

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
equ <span class="token operator">=</span> cv2<span class="token punctuation">.</span>equalizeHist<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
res <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">,</span>equ<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 将2张图片合并一起</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span>equ<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'1.bmp'</span><span class="token punctuation">,</span>equ<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/cd/tWFWudlg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/79/76/gvUgYCGs_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>CLAHE自适应直方图均衡化</strong><br> 当直方图并不集中在某一区域时，使用直方图均衡化会丢失信息，效果不好</p> 
</blockquote> 
<p>为了解决这个问题，我们需要使用<code>自适应的直方图均衡化</code>。这种情况下，整幅图像会被分成很多小块，这些小块被称为<code>“tiles”（在 OpenCV中tiles 的大小默认是8x8）</code>，然后再对每一个小块分别进行直方图均衡化（跟前面类似）。所以在每一个的区域中，直方图会集中在某一个小的区域中（除非有噪声干扰）。如果有噪声的话，噪声会被放大。为了避免这种情况的出现要使用对比度限制。对于每个小块来说，如果直方图中的 bin 超过对比度的上限的话，就把其中的像素点均匀分散到其他bins中，然后在进行直方图均衡化。最后，为了去除每一个小块之间“人造的”（由于算法造成）边界，再使用<code>双线性差值</code>，对小块进行缝合。</p> 
<ol start="2"><li><strong>直方图对比——<code>cv2.compareHist()</code></strong><br> 直方图对比就是根据一定的标准来比较两幅图像的直方图的相似度, 近而确定图像的相似度, opencv提供对比直方图相似度的函数为: <code>cv2.compareHist()</code></li></ol> 
<blockquote> 
 <p><code>cv2.compareHist(H1,H2,method retval →retrval</code><br> <strong>H1:</strong> 需要比较的直方图1<br> <strong>H2:</strong> 需要比较的直方图2<br> <strong>method:</strong> 直方图对比的方法, 有如下四种:</p> 
 <blockquote> 
  <p>◆ <code>cv2.HISTCMP_CORREL</code>, ——<strong>相关性方法</strong>(值越大匹配度越高)</p> 
  <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            d 
           
           
           
             c 
            
           
             o 
            
           
             r 
            
           
             r 
            
           
             e 
            
           
             l 
            
           
          
         
           ( 
          
          
          
            H 
           
          
            1 
           
          
         
           , 
          
          
          
            H 
           
          
            2 
           
          
         
           ) 
          
         
           = 
          
          
           
            
            
              ∑ 
             
            
              i 
             
            
            
             
             
               H 
              
             
               1 
              
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
              ⋅ 
             
             
             
               H 
              
             
               2 
              
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
           
           
            
             
             
               ∑ 
              
             
               i 
              
             
             
              
              
                H 
               
              
                1 
               
              
             
               ( 
              
             
               i 
              
             
               ) 
              
             
               ⋅ 
              
              
              
                H 
               
              
                2 
               
              
             
               ( 
              
             
               i 
              
             
               ) 
              
             
            
           
          
         
        
          {<!-- -->{d}_{correl}}({<!-- -->{H}_{1}},{<!-- -->{H}_{2}})=\frac{\sum\limits_{i}{<!-- -->{<!-- -->{H}_{1}}(i)\cdot {<!-- -->{H}_{2}}(i)}}{\sqrt{\sum\limits_{i}{<!-- -->{<!-- -->{H}_{1}}(i)\cdot {<!-- -->{H}_{2}}(i)}}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.18567em; vertical-align: -1.6296em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.55607em;"><span class="" style="top: -2.33719em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2183em;"><span class="svg-align" style="top: -4.57143em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="mord mtight" style="padding-left: 1.42857em;"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.86291em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -2.75001em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.03009em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.1903em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="hide-tail mtight" style="min-width: 1.02em; height: 2.68571em;"> 
                     <svg width="400em" height="2.685714285714286em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
                      <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.38113em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -4.03106em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.86291em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -2.75001em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.03009em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.6296em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
  <p>◆ <code>cv2.HISTCMP_CHISQR</code>, ——<strong>卡方测量法</strong>(值越小匹配度越高)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            d 
           
           
           
             c 
            
           
             h 
            
           
             i 
            
           
             − 
            
           
             s 
            
           
             q 
            
           
             u 
            
           
             a 
            
           
             r 
            
           
             e 
            
           
          
         
           ( 
          
          
          
            H 
           
          
            1 
           
          
         
           , 
          
          
          
            H 
           
          
            2 
           
          
         
           ) 
          
         
           = 
          
          
          
            ∑ 
           
          
            i 
           
          
          
           
            
            
              ( 
             
             
             
               H 
              
             
               1 
              
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
              − 
             
             
             
               H 
              
             
               2 
              
             
            
              ( 
             
            
              i 
             
            
              ) 
             
            
              ) 
             
            
           
             2 
            
           
           
            
            
              H 
             
            
              1 
             
            
           
             ( 
            
           
             i 
            
           
             ) 
            
           
             + 
            
            
            
              H 
             
            
              2 
             
            
           
             ( 
            
           
             i 
            
           
             ) 
            
           
          
         
        
          {<!-- -->{d}_{chi-square}}({<!-- -->{H}_{1}},{<!-- -->{H}_{2}})=\sum\limits_{i}{\frac{<!-- -->{<!-- -->{({<!-- -->{H}_{1}}(i)-{<!-- -->{H}_{2}}(i))}^{2}}}{<!-- -->{<!-- -->{H}_{1}}(i)+{<!-- -->{H}_{2}}(i)}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">q</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.08659em; vertical-align: -0.977669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.12233em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.977669em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.10892em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.485em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> ◆ <code>cv2.HISTCMP_INTERSECT</code>, ——<strong>直方图相交法</strong>(值越大匹配度越高)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            d 
           
           
           
             i 
            
           
             n 
            
           
             t 
            
           
             e 
            
           
             r 
            
           
             s 
            
           
             c 
            
           
             e 
            
           
             t 
            
           
             i 
            
           
             o 
            
           
             n 
            
           
          
         
           ( 
          
          
          
            H 
           
          
            1 
           
          
         
           , 
          
          
          
            H 
           
          
            2 
           
          
         
           ) 
          
         
           = 
          
          
          
            ∑ 
           
          
            i 
           
          
          
          
            min 
           
          
            ⁡ 
           
          
            ( 
           
           
           
             H 
            
           
             1 
            
           
          
            ( 
           
          
            i 
           
          
            ) 
           
          
            , 
           
           
           
             H 
            
           
             2 
            
           
          
            ( 
           
          
            i 
           
          
            ) 
           
          
            ) 
           
          
         
        
          {<!-- -->{d}_{interscetion}}({<!-- -->{H}_{1}},{<!-- -->{H}_{2}})=\sum\limits_{i}{\min ({<!-- -->{H}_{1}}(i),{<!-- -->{H}_{2}}(i))} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.72767em; vertical-align: -0.977669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.12233em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.977669em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></span><br> ◆<code>cv2.HISTCMP_BHATTACHARYYA</code> ,——<strong>Bhattacharyya测量法</strong>(小)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            d 
           
           
           
             B 
            
           
             h 
            
           
             a 
            
           
             t 
            
           
             t 
            
           
             a 
            
           
             c 
            
           
             h 
            
           
             a 
            
           
             r 
            
           
             y 
            
           
             y 
            
           
             a 
            
           
          
         
           ( 
          
          
          
            H 
           
          
            1 
           
          
         
           , 
          
          
          
            H 
           
          
            2 
           
          
         
           ) 
          
         
           = 
          
          
           
           
             1 
            
           
             − 
            
            
            
              ∑ 
             
            
              i 
             
            
            
             
              
               
               
                 H 
                
               
                 1 
                
               
              
                ( 
               
              
                i 
               
              
                ) 
               
              
                ⋅ 
               
               
               
                 H 
                
               
                 2 
                
               
              
                ( 
               
              
                i 
               
              
                ) 
               
              
             
             
              
               
               
                 ∑ 
                
               
                 i 
                
               
               
                
                
                  H 
                 
                
                  1 
                 
                
               
                 ( 
                
               
                 i 
                
               
                 ) 
                
               
              
                ⋅ 
               
               
               
                 ∑ 
                
               
                 i 
                
               
               
                
                
                  H 
                 
                
                  2 
                 
                
               
                 ( 
                
               
                 i 
                
               
                 ) 
                
               
              
             
            
           
          
         
        
          {<!-- -->{d}_{Bhattacharyya}}({<!-- -->{H}_{1}},{<!-- -->{H}_{2}})=\sqrt{1-\sum\limits_{i}{\frac{\sqrt{<!-- -->{<!-- -->{H}_{1}}(i)\cdot {<!-- -->{H}_{2}}(i)}}{\sqrt{\sum\limits_{i}{<!-- -->{<!-- -->{H}_{1}}(i)}\cdot \sum\limits_{i}{<!-- -->{<!-- -->{H}_{2}}(i)}}}}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault">d</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.05017em;">B</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.0892em; vertical-align: -1.6296em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.4596em;"><span class="svg-align" style="top: -5.0492em;"><span class="pstrut" style="height: 5.0492em;"></span><span class="mord" style="padding-left: 1.056em;"><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.12233em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.977669em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3296em;"><span class="" style="top: -2.33719em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2183em;"><span class="svg-align" style="top: -4.57143em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="mord mtight" style="padding-left: 1.42857em;"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.86291em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -2.75001em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.03009em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span><span class="mbin mtight">⋅</span><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.86291em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -2.75001em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.03009em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.1903em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="hide-tail mtight" style="min-width: 1.02em; height: 2.68571em;"> 
                            <svg width="400em" height="2.685714285714286em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
                             <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
                            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.38113em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.60376em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.03691em;"><span class="svg-align" style="top: -3.42857em;"><span class="pstrut" style="height: 3.42857em;"></span><span class="mord mtight" style="padding-left: 1.19em;"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.08125em;">H</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span><span class="" style="top: -3.00891em;"><span class="pstrut" style="height: 3.42857em;"></span><span class="hide-tail mtight" style="min-width: 0.853em; height: 1.54286em;"> 
                            <svg width="400em" height="1.5428571428571431em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
                             <path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"></path> 
                            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.419661em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.6296em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="" style="top: -3.4196em;"><span class="pstrut" style="height: 5.0492em;"></span><span class="hide-tail" style="min-width: 0.742em; height: 3.1292em;"> 
             <svg width="400em" height="3.1292em" viewbox="0 0 400000 3129" preserveaspectratio="xMinYMin slice"> 
              <path d="M702 80H400000v40H742v2995l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z"></path> 
             </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.6296em;"><span class=""></span></span></span></span></span></span></span></span></span></p> 
 </blockquote> 
</blockquote> 
<ol start="3"><li><strong>反向投影——<code>cv2.calcBackProject()</code></strong><br> · 反向投影是一种记录给定图像中的像素点如何适应直方图模型像素分布的方式, 简单来说, 所谓反向投影就是<code>首先计算某一特征的直方图模型，然后使用模型去寻找图像中存在该特征的方法</code>。例如, 你有一个<code>肤色直方图 ( Hue-Saturation 直方图 )</code>,你可以用它来寻找图像中的肤色区域, 具体原理:<br> · 假设已经通过下图得到一个肤色直方图(Hue-Saturation)，直方图就是模型直方图 ( 代表手掌的皮肤色调).可以通过掩码操作来抓取手掌所在区域的直方图<br> · 我们要做的就是使用模型直方图 (代表手掌的皮肤色调) 来检测测试图像中的皮肤区域。以下是检测的步骤:<br> ①对测试图像中的每个像素 p(I,j),获取色调数据并找到该色调 (hij, sij )在直方图中的bin的位置。<br> ②查询 模型直方图中对应的bin——并读取该bin的数值。<br> ③将此数值储存在新的图像中 (BackProjection)。也可以先归一化模型直方图 ,这样测试图像的输出就可以在屏幕显示了。<br> ④通过对测试图像中的每个像素采用以上步骤，得到了 BackProjection 结果图<br> ⑤使用统计学的语言, BackProjection 中储存的数值代表了测试图像中该像素属于皮肤区域的概率 。亮起的区域是皮肤区域的概率更大(事实确实如此),而更暗的区域则表示更低的概率(注意手掌内部和边缘的阴影影响了检测的精度)。<br> <strong>反向投影的作用:</strong><br> 反向投影应用在输入图像(大)中查找与特定图像(模板图像), 最匹配的点或者区域, 也就是定位模板图像出现在输入图像的位置</li></ol> 
<blockquote> 
 <p><code>cv2.calcBackProject(images, chamnels, hist,ranges,scale[,dst]) → dst</code><br> <strong>images:</strong> 输入数组或数组集, 需要为相同深度和尺寸<br> <strong>nimages:</strong> 输入数组个数, 也就是图像数量<br> <strong>channels:</strong> 需要统计的通道索引<br> <strong>hist:</strong> 输入的直方图<br> <strong>backProject:</strong> 目标反向投影阵列, 需为单通道, 并且和image[0]有相同大小和深度<br> <strong>ranges:</strong> 表示每一维度数组的每一维的边界阵列(取值范围)<br> <strong>uniform:</strong> 直方图是否均匀标识, 默认值true</p> 
</blockquote> 
<h3><a id="2413__2447"></a>24.13 模板匹配及应用</h3> 
<h4><a id="24131__2448"></a>24.13.1 模板匹配</h4> 
<p>模板匹配是一项在一幅图像中寻找与另一幅模板图像最匹配(相似)部分的技术。模板匹配不是基于直方图的, 而是通过在输入图像上滑动图像块(模板)同时比对相似度, 来对模板和输入图像进行匹配的一种方法。</p> 
<p>应用:<br> ①目标查找定位<br> ②运动物体跟踪<br> ③其他…</p> 
<h4><a id="24132_cv2matchTemplate_2455"></a>24.13.2 模板匹配——cv2.matchTemplate()</h4> 
<blockquote> 
 <p><code>cv2.matchTemplate(image,templ,method[,result]) → result</code><br> <strong>image:</strong> 待搜索图像(大图)<br> <strong>templ:</strong> 搜索模板, 需和原图一样的数据类型且尺寸不能大于源图像<br> <strong>result:</strong> 比较结果的映射图像, 其必须为单通道, 32位浮点型图像, 如果原图(待搜索图像)尺寸为<code>W x H</code>, 而templ尺寸为 <code>w x h</code>, 则result尺寸一定是<code>(W-w+1)x(H-h+1)</code><br> <strong>method:</strong> 指定的匹配方法, 有如下6种:</p> 
 <blockquote> 
  <p><strong>平方差匹配</strong><code>cv2.TM_SQDIFF</code> ——平方差匹配法(最好匹配0)<br> 这类方法利用平方差来进行匹配，最好匹配为0，匹配越差，匹配值越大:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
           
            
            
              ∑ 
             
             
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
            
            
            
              ( 
             
            
              T 
             
            
              ( 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              − 
             
            
              I 
             
            
              ( 
             
            
              x 
             
            
              + 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
            
              y 
             
            
              + 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              ) 
             
            
           
          
            2 
           
          
         
        
          R(x,y)={<!-- -->{\sum\limits_{x',y'}{(T(x',y')-I(x+x',y+y'))}}^{2}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.08599em; vertical-align: -1.13009em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.10602em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13009em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9559em;"><span class="" style="top: -3.20479em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <p><strong>标准平方差匹配</strong><code>cv2.TM_SQDIFF_NORMED</code>——归一化平方差匹配法(最好匹配0)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
           
            
            
              ∑ 
             
             
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
            
            
             
             
               ( 
              
             
               T 
              
             
               ( 
              
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
               ) 
              
             
               − 
              
             
               I 
              
             
               ( 
              
             
               x 
              
             
               + 
              
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
             
               y 
              
             
               + 
              
              
              
                y 
               
              
                ′ 
               
              
             
               ) 
              
             
               ) 
              
             
            
              2 
             
            
           
           
            
             
             
               ∑ 
              
              
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
             
             
             
               T 
              
              
               
               
                 ( 
                
                
                
                  x 
                 
                
                  ′ 
                 
                
               
                 , 
                
                
                
                  y 
                 
                
                  ′ 
                 
                
               
                 ) 
                
               
              
                2 
               
              
             
            
              ⋅ 
             
             
             
               ∑ 
              
              
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
             
             
             
               I 
              
              
               
               
                 ( 
                
               
                 x 
                
               
                 + 
                
                
                
                  x 
                 
                
                  ′ 
                 
                
               
                 , 
                
               
                 y 
                
               
                 + 
                
                
                
                  y 
                 
                
                  ′ 
                 
                
               
                 ) 
                
               
              
                2 
               
              
             
            
           
          
         
        
          R(x,y)=\frac{\sum\limits_{x',y'}{<!-- -->{<!-- -->{(T(x',y')-I(x+x',y+y'))}^{2}}}}{\sqrt{\sum\limits_{x',y'}{T{<!-- -->{(x',y')}^{2}}}\cdot \sum\limits_{x',y'}{I{<!-- -->{(x+x',y+y')}^{2}}}}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.5076em; vertical-align: -1.6296em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.878em;"><span class="" style="top: -2.3957em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.13471em;"><span class="svg-align" style="top: -4.57143em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="mord mtight" style="padding-left: 1.42857em;"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.10671em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="hide-tail mtight" style="min-width: 1.02em; height: 2.68571em;"> 
                     <svg width="400em" height="2.685714285714286em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
                      <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.46472em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -4.2233em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.935286em;"><span class="" style="top: -2.97497em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.6296em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
  <p><strong>相关匹配</strong><code>cv2.TM_CCORR</code>——相关匹配法(最坏匹配0)<br> 这类方法采用模板和图像见的乘法操作，所以较大的数表示匹配程度较高，0表示最坏的匹配效果：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            ∑ 
           
           
            
            
              x 
             
            
              ′ 
             
            
           
             , 
            
            
            
              y 
             
            
              ′ 
             
            
           
          
          
          
            ( 
           
          
            T 
           
          
            ( 
           
           
           
             x 
            
           
             ′ 
            
           
          
            , 
           
           
           
             y 
            
           
             ′ 
            
           
          
            ) 
           
          
            ⋅ 
           
          
            I 
           
          
            ( 
           
          
            x 
           
          
            + 
           
           
           
             x 
            
           
             ′ 
            
           
          
            , 
           
          
            y 
           
          
            + 
           
           
           
             y 
            
           
             ′ 
            
           
          
            ) 
           
          
            ) 
           
          
         
        
          R(x,y)=\sum\limits_{x',y'}{(T(x',y')\cdot I(x+x',y+y'))} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.88199em; vertical-align: -1.13009em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.10602em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13009em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></span></p> 
  <p><strong>标准相关匹配</strong><code>cv2.TM_CCORR_NORMED</code>——归一化相关匹配法(最坏匹配0)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
           
            
            
              ∑ 
             
             
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
            
            
            
              ( 
             
            
              T 
             
            
              ( 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              ⋅ 
             
            
              I 
             
            
              ( 
             
            
              x 
             
            
              + 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
            
              y 
             
            
              + 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              ) 
             
            
           
           
            
             
             
               ∑ 
              
              
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
             
             
             
               T 
              
              
               
               
                 ( 
                
                
                
                  x 
                 
                
                  ′ 
                 
                
               
                 , 
                
                
                
                  y 
                 
                
                  ′ 
                 
                
               
                 ) 
                
               
              
                2 
               
              
             
            
              ⋅ 
             
             
             
               ∑ 
              
              
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
             
             
             
               I 
              
              
               
               
                 ( 
                
               
                 x 
                
               
                 + 
                
                
                
                  x 
                 
                
                  ′ 
                 
                
               
                 , 
                
               
                 y 
                
               
                 + 
                
                
                
                  y 
                 
                
                  ′ 
                 
                
               
                 ) 
                
               
              
                2 
               
              
             
            
           
          
         
        
          R(x,y)=\frac{\sum\limits_{x',y'}{(T(x',y')\cdot I(x+x',y+y'))}}{\sqrt{\sum\limits_{x',y'}{T{<!-- -->{(x',y')}^{2}}}\cdot \sum\limits_{x',y'}{I{<!-- -->{(x+x',y+y')}^{2}}}}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.43238em; vertical-align: -1.6296em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.80278em;"><span class="" style="top: -2.3957em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.13471em;"><span class="svg-align" style="top: -4.57143em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="mord mtight" style="padding-left: 1.42857em;"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.10671em;"><span class="pstrut" style="height: 4.57143em;"></span><span class="hide-tail mtight" style="min-width: 1.02em; height: 2.68571em;"> 
                     <svg width="400em" height="2.685714285714286em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
                      <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
                     </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.46472em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -4.2233em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">⋅</span><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.6296em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
  <p><code>cv2.TM_CCOEFF</code>——系数匹配法(最好匹配1)<br> 这类方法将模板对其均值的相对值与图像对其均值的相关值进行匹配，1表示完美匹配，-1表示糟糕的匹配，0表示没有任何相关性（随机）<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
          
            ∑ 
           
           
            
            
              x 
             
            
              ′ 
             
            
           
             , 
            
            
            
              y 
             
            
              ′ 
             
            
           
          
          
          
            ( 
           
           
           
             T 
            
           
             ′ 
            
           
          
            ( 
           
           
           
             x 
            
           
             ′ 
            
           
          
            , 
           
           
           
             y 
            
           
             ′ 
            
           
          
            ) 
           
          
            ⋅ 
           
           
           
             I 
            
           
             ′ 
            
           
          
            ( 
           
          
            x 
           
          
            + 
           
           
           
             x 
            
           
             ′ 
            
           
          
            , 
           
          
            y 
           
          
            + 
           
           
           
             y 
            
           
             ′ 
            
           
          
            ) 
           
          
            ) 
           
          
         
        
          R(x,y)=\sum\limits_{x',y'}{(T'(x',y')\cdot I'(x+x',y+y'))} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.88199em; vertical-align: -1.13009em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.10602em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13009em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></span>，<br> 其中：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            T 
           
          
            ′ 
           
          
         
           ( 
          
          
          
            x 
           
          
            ′ 
           
          
         
           , 
          
          
          
            y 
           
          
            ′ 
           
          
         
           ) 
          
         
           = 
          
         
           T 
          
         
           ( 
          
          
          
            x 
           
          
            ′ 
           
          
         
           , 
          
          
          
            y 
           
          
            ′ 
           
          
         
           ) 
          
         
           − 
          
          
          
            1 
           
           
           
             w 
            
           
             ⋅ 
            
           
             h 
            
           
          
          
          
            ∑ 
           
           
            
            
              x 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
             , 
            
            
            
              y 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
          
          
          
            T 
           
          
            ( 
           
           
           
             x 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
            , 
           
           
           
             y 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
            ) 
           
          
         
           , 
          
          
          
            I 
           
          
            ′ 
           
          
         
           ( 
          
         
           x 
          
         
           + 
          
          
          
            x 
           
          
            ′ 
           
          
         
           , 
          
         
           y 
          
         
           + 
          
          
          
            y 
           
          
            ′ 
           
          
         
           ) 
          
         
           = 
          
         
           I 
          
         
           ( 
          
         
           x 
          
         
           + 
          
          
          
            x 
           
          
            ′ 
           
          
         
           , 
          
         
           y 
          
         
           + 
          
          
          
            y 
           
          
            ′ 
           
          
         
           ) 
          
         
           − 
          
          
          
            1 
           
           
           
             w 
            
           
             ⋅ 
            
           
             h 
            
           
          
          
          
            ∑ 
           
           
            
            
              x 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
             , 
            
            
            
              y 
             
             
             
               ′ 
              
             
               ′ 
              
             
            
           
          
          
          
            I 
           
          
            ( 
           
          
            x 
           
          
            + 
           
           
           
             x 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
            , 
           
          
            y 
           
          
            + 
           
           
           
             y 
            
            
            
              ′ 
             
            
              ′ 
             
            
           
          
            ) 
           
          
         
        
          T'(x',y')=T(x',y')-\frac{1}{w\cdot h}\sum\limits_{x'',y''}{T(x'',y'')},I'(x+x',y+y')=I(x+x',y+y')-\frac{1}{w\cdot h}\sum\limits_{x'',y''}{I(x+x'',y+y'')} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.9752em; vertical-align: -1.13009em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span><span class="mbin mtight">⋅</span><span class="mord mathdefault mtight">h</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.10602em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13009em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">T</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.946332em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.946332em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.9752em; vertical-align: -1.13009em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02691em;">w</span><span class="mbin mtight">⋅</span><span class="mord mathdefault mtight">h</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -2.10602em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.00001em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop op-symbol small-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13009em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span></p> 
  <p><code>cv2.TM_CCOEFF_NORMED</code>——化相关系数匹配法(最好匹配1)</p> 
  <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           R 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
           = 
          
          
           
            
            
              ∑ 
             
             
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
            
            
            
              ( 
             
             
             
               T 
              
             
               ′ 
              
             
            
              ( 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              ⋅ 
             
             
             
               I 
              
             
               ′ 
              
             
            
              ( 
             
            
              x 
             
            
              + 
             
             
             
               x 
              
             
               ′ 
              
             
            
              , 
             
            
              y 
             
            
              + 
             
             
             
               y 
              
             
               ′ 
              
             
            
              ) 
             
            
              ) 
             
            
           
           
            
            
              ∑ 
             
             
              
              
                x 
               
              
                ′ 
               
              
             
               , 
              
              
              
                y 
               
              
                ′ 
               
              
             
            
            
             
             
               T 
              
             
               ′ 
              
             
             
              
              
                ( 
               
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
                ) 
               
              
             
               2 
              
             
             
             
               ∑ 
              
              
               
               
                 x 
                
               
                 ′ 
                
               
              
                , 
               
               
               
                 y 
                
               
                 ′ 
                
               
              
             
             
              
              
                I 
               
              
                ′ 
               
              
              
               
               
                 ( 
                
               
                 x 
                
               
                 + 
                
                
                
                  x 
                 
                
                  ′ 
                 
                
               
                 , 
                
               
                 y 
                
               
                 + 
                
                
                
                  y 
                 
                
                  ′ 
                 
                
               
                 ) 
                
               
              
                2 
               
              
             
            
           
          
         
        
          R(x,y)=\frac{\sum\limits_{x',y'}{(T'(x',y')\cdot I'(x+x',y+y'))}}{\sum\limits_{x',y'}{T'{<!-- -->{(x',y')}^{2}}\sum\limits_{x',y'}{I'{<!-- -->{(x+x',y+y')}^{2}}}}} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.12631em; vertical-align: -1.32352em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.80278em;"><span class="" style="top: -2.58978em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.682829em;"><span class="" style="top: -2.786em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.857457em;"><span class="" style="top: -2.89714em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -4.2233em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.750005em;"><span class="" style="top: -1.72717em; margin-left: 0em;"><span class="pstrut" style="height: 2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.84956em;"><span class="" style="top: -2.84956em; margin-right: 0.1em;"><span class="pstrut" style="height: 2.55556em;"></span><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.75em;"><span class="pstrut" style="height: 2.75em;"></span><span class=""><span class="mop op-symbol small-op mtight">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.30472em;"><span class=""></span></span></span></span></span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07847em;">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.32352em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
 </blockquote> 
</blockquote> 
<p>通常,随着从简单的测量(平方差)到更复杂的测量(相关系数),我们可获得越来越准确的匹配(同时也意味着越来越大的计算代价). 最好的办法是对所有这些设置多做一些测试实验,以便为自己的应用选择同时兼顾速度和精度的最佳方案</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt

img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/messi5.jpg'</span><span class="token punctuation">)</span>

img_ori <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
ball <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'D:/datas2/ball.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># cv2.imshow('src', img)</span>
<span class="token comment"># cv2.waitKey(0)</span>
<span class="token comment"># cv2.imshow('ball', ball)</span>
<span class="token comment"># cv2.waitKey(0)</span>

img_h<span class="token punctuation">,</span> img_w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape
ball_h<span class="token punctuation">,</span> ball_w <span class="token operator">=</span> ball<span class="token punctuation">.</span>shape
<span class="token comment">#选取比较方法</span>
method <span class="token operator">=</span> cv2<span class="token punctuation">.</span>TM_SQDIFF
<span class="token comment">##进行匹配与计算</span>
res <span class="token operator">=</span> cv2<span class="token punctuation">.</span>matchTemplate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> ball<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token comment">#res:原图每个区域与模板的相似度的值</span>
<span class="token comment">#最值的获取，也就是最相似的区域及其位置</span>
min_val<span class="token punctuation">,</span> max_val<span class="token punctuation">,</span> min_loc<span class="token punctuation">,</span> max_loc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>minMaxLoc<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
top_left <span class="token operator">=</span> min_loc
bottom_right <span class="token operator">=</span> <span class="token punctuation">(</span>top_left<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> ball_w<span class="token punctuation">,</span> top_left<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> ball_h<span class="token punctuation">)</span>
<span class="token comment">#绘制矩形 在灰度图上显示</span>
cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> top_left<span class="token punctuation">,</span> bottom_right<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img_ori<span class="token punctuation">,</span> img<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#绘制矩形 在彩色图上显示</span>
cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>src<span class="token punctuation">,</span> top_left<span class="token punctuation">,</span> bottom_right<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3e/3f/PIfKK5qO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a3/17/NK7PSe9J_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="24133_cv2normalize_2523"></a>24.13.3 矩阵归一化——cv2.normalize()</h4> 
<blockquote> 
 <p><code>cv2.normalize(src,dst[,alphal,betal,norm_type[,dtype[, mask]]]]) → dst</code><br> <strong>src:</strong> 输入原图像<br> <strong>dst:</strong> 输出结果图像, 需要和原图一样的尺寸和类型<br> <strong>alpha:</strong> 归一化后的最小值, 默认值1<br> <strong>beta:</strong> 归一化后的最大值, 默认值0<br> <strong>norm_type:</strong> 归一化类型, 可选NORM_INF, NORM_L1, NORM_L2(默认)等<br> <strong>dtype:</strong> 默认值-1, 此参数为负值时, 输出矩阵和src有同样类型<br> <strong>mask:</strong> 可选的掩码操作</p> 
</blockquote> 
<p>对矩阵进行归一化</p> 
<h4><a id="24134_cv2minMaxLoc_2535"></a>24.13.4 寻找最值——cv2.minMaxLoc()</h4> 
<blockquote> 
 <p><code>cv2.minMaxLoc(src, mask=None)</code> 求这个矩阵的最小值，最大值，并得到最大值，最小值的索引<br> <strong>src</strong>: 输入原图像, 单通道图像<br> <strong>minVal:</strong> 返回最小值的指针, 若无需返回, 则设置0<br> <strong>maxVal:</strong> 返回最大值的指针, 若无需返回, 则设置0<br> <strong>minLoc:</strong> 返回最小位置的指针,若无需返回, 则设置0<br> <strong>maxLoc:</strong> 返回最大位置的指针,若无需返回, 则设置0<br> <strong>mask:</strong> 可选的掩码操作</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b4774a6b42fa6eb85a2ca5861804067/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最流行的 .NET 反编译工具合集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a8cae9f1fe37ea8ccb16f90c365894ad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RSA算法过程与正确性推导</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>