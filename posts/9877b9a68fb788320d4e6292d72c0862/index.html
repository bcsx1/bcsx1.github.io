<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s的二进制部署（二）网络 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s的二进制部署（二）网络" />
<meta property="og:description" content="节点部署完成之后,节点的状态都是Notready，所以要部署k8s网络：
k8s的网络类型： k8s中的通信模式：
pod内部之间容器与容器之间的通信。 在同一个pod中的容器共享资源和网络，使用同一个网络命名空间，可以直接通信的
同一个node节点之内，不同pod之间的通信 每个pod都有一个全局的真实的IP地址，同一个node直接的不同pod可以直接使用对方的pod的IP地址进行通信。
Pod1和pod2是通过docker的网桥来进行通信的
不同node节点的上的pod之间如何进行通信？ Cni插件：cni是一个标准接口，用于容器运行时调用网络插件，配置容器网络，负责设置容器的网络命名空间，IP地址，路由等等参数
Flanne插件：功能就是让集群之中不同节点的docker容器具有全集群唯一的虚拟IP地址，他是一个overlay网络，在底层物理网络的基础之上，创建一个逻辑的网络层，二层&#43;三层的集合，二层是物理网络，三层是逻辑上的网络层，overlay网络也是一种网络虚拟化的技术
Flannel支持的数据转发方式： UDP模式，默认模式，应用转发，配置简单，但是性能最差Vxlan模式，基于内核转发，也是最常用的网络类型（小集群都使用这个模式）Host-gw（性能最好，但是配置麻烦，了解即可） UDP模式（用的较少）：基于应用转发，是由flannel来提供路由表，flannel封装数据包，解封装
每个node节点都会有一个flannel的虚拟网卡
数据流向图：
Vxlan模式：使用的就是overlay的虚拟隧道通信技术，是一个二层＋三层的模式
而UDP是基于应用层，用户态
Vxlan：flannel提供路由表，内核封装解封装
Flannel1.1接口，用的就是vxlan
Vxlan的工作模式图：简单来说就是说vni&#43;ip地址
vim /etc/profile
source &lt;(kubectl completion bash)
source /etc/profile
Node1,node2
将flannel.tar拖入
docker load -i flannel.tar
mkdir -p /opt/cni/bin
将cni-plugins-linux-amd64-v0.8.6.tgz拖入
tar -xf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin/
Node2同样的操作
Master01
拖入kube-flannel.yml
kubectl apply -f kube-flannel.yml
查看（多刷新几次，需要等待时间）
kubectl get pod -n kube-system
kubectl get pod -o wide -n kube-system
Ifconfig查看
Node1，node2
网络已部署完成
kubectl get nodes" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9877b9a68fb788320d4e6292d72c0862/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T17:18:54+08:00" />
<meta property="article:modified_time" content="2023-12-28T17:18:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s的二进制部署（二）网络</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">节点部署完成之后,节点的状态都是Notready，所以要部署k8s网络：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="104" src="https://images2.imgbox.com/72/93/uTLYG2Wa_o.png" width="681"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;">k8s的网络类型：</h3> 
<p style="margin-left:.0001pt;text-align:justify;">k8s中的通信模式：</p> 
<ol><li style="text-align:justify;">pod内部之间容器与容器之间的通信。</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">在同一个pod中的<span style="color:#ff0000;">容器共享资源和网络</span>，使用同一个网络命名空间，<span style="color:#ff0000;">可以直接通信的</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<ol><li style="text-align:justify;">同一个node节点之内，不同pod之间的通信</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">每个pod都有一个全局的真实的IP地址</span>，同一个node直接的不同pod可以直接使用对方的pod的IP地址进行通信。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">Pod1和pod2是通过docker的网桥来进行通信的</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<ol><li style="text-align:justify;"> <h3><span style="background-color:#ffff00;">不同node节点的上的pod之间如何进行通信？</span></h3> </li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">Cni插件：</span>cni是一个标准接口，用于容器运行时调用网络插件，<span style="color:#ff0000;">配置容器网络，负责设置容器的网络命名空间</span>，IP地址，路由等等参数</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">Flanne插件：功能就是让集群之中不同节点的docker容器具有全集群唯一的虚拟IP地址，他是一个overlay网络</span>，在底层物理网络的基础之上，创建一个逻辑的网络层，二层+三层的集合，二层是物理网络，三层是逻辑上的网络层，overlay网络也是一种网络虚拟化的技术</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">Flannel支持的数据转发方式：</span></h3> 
<ol><li style="text-align:justify;"><span style="color:#ff0000;">UDP模式，默认模式，</span>应用转发，配置简单，但是性能最差</li><li style="text-align:justify;"><span style="color:#ff0000;">Vxlan模式</span>，基于内核转发，也是最常用的网络类型（小集群都使用这个模式）</li><li style="text-align:justify;"><span style="color:#ff0000;">Host-gw</span>（性能最好，但是配置麻烦，了解即可）</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">UDP模式（用的较少）：基于应用转发，是由flannel来提供路由表，flannel封装数据包，解封装</p> 
<p style="margin-left:.0001pt;text-align:justify;">每个node节点都会有一个flannel的虚拟网卡</p> 
<p style="margin-left:.0001pt;text-align:justify;">数据流向图：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="383" src="https://images2.imgbox.com/d6/93/lQ8KvpMv_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Vxlan模式：使用的就是overlay的虚拟隧道通信技术，是一个二层＋三层的模式</p> 
<p style="margin-left:.0001pt;text-align:justify;">而UDP是基于应用层，用户态</p> 
<p style="margin-left:.0001pt;text-align:justify;">Vxlan：flannel提供路由表，内核封装解封装</p> 
<p style="margin-left:.0001pt;text-align:justify;">Flannel1.1接口，用的就是vxlan</p> 
<p style="margin-left:.0001pt;text-align:justify;">Vxlan的工作模式图：<span style="color:#ff0000;">简单来说就是说vni+ip地址</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="406" src="https://images2.imgbox.com/89/48/PmqjbKZT_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="156" src="https://images2.imgbox.com/f3/83/rDJIKUTI_o.png" width="473"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/profile</p> 
<p style="margin-left:.0001pt;text-align:justify;">source &lt;(kubectl completion bash)</p> 
<p style="margin-left:.0001pt;text-align:justify;">source /etc/profile</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="415" src="https://images2.imgbox.com/1f/c2/8aCw8cMz_o.png" width="622"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Node1,node2</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="89" src="https://images2.imgbox.com/a3/27/a72ma752_o.png" width="650"></p> 
<p style="margin-left:.0001pt;text-align:justify;">将flannel.tar拖入</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load -i flannel.tar</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="187" src="https://images2.imgbox.com/61/8d/dXvUAgmg_o.png" width="444"></p> 
<p style="margin-left:.0001pt;text-align:justify;">mkdir -p /opt/cni/bin</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="36" src="https://images2.imgbox.com/77/0b/kmzFXhqj_o.png" width="371"></p> 
<p style="margin-left:.0001pt;text-align:justify;">将cni-plugins-linux-amd64-v0.8.6.tgz拖入</p> 
<p style="margin-left:.0001pt;text-align:justify;">tar -xf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin/</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="46" src="https://images2.imgbox.com/50/4f/JMrL2RQZ_o.png" width="643">Node2同样的操作</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Master01</p> 
<p style="margin-left:.0001pt;text-align:justify;">拖入kube-flannel.yml</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl apply -f kube-flannel.yml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="134" src="https://images2.imgbox.com/3d/8f/jMkhvFwa_o.png" width="520"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看（多刷新几次，需要等待时间）</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="106" src="https://images2.imgbox.com/40/37/HAJDmoLX_o.png" width="482"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod -o wide -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="65" src="https://images2.imgbox.com/51/6a/8RPRL0eI_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Ifconfig查看</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="363" src="https://images2.imgbox.com/d0/29/nr3G2sLW_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Node1，node2</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">网络已部署完成</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get nodes</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="83" src="https://images2.imgbox.com/50/34/xDYrZ0qm_o.png" width="434"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="background-color:transparent;margin-left:.0001pt;text-align:justify;"><strong><strong>第二个网络插件calico插件：</strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">Flannel：每个发向容器的数据包进行封装，vxlan通过vtep打包数据，由内核封装数据包-----》转发到目标的node节点。到了目标node节点后，还有一个解封装的过程，再发送到目标pod，性能是有一定影响的</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Calico:它是采用直接路由的方式，他的性能是最好的，也就是BGP路由，不需要修改报文，统一直接通过路由表转发，路由表会很复杂，运行维护的要求比较高</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">BGP模式的特点：交换路由信息外部网关协议，可以连接不同的node节点，node节点可能不是一个网段，BGP会自动寻址，自动选择可靠的，最佳的，动态的路由选择，自动识别相邻的路由设备</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Calico不能使用overlay，也不需要交换，直接通过虚拟路由实现，每一台虚拟路由都通过BGP转发</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">核心组件：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffff00;">Felix:</span>也是运行在主机上的一个个pod，一个进程，k8s  daemonset的方式部署的pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">Daemont set会在每个node节点部署相同的pod，后台的运行方式</p> 
<p style="margin-left:.0001pt;text-align:justify;">负责在宿主机上插入路由规则，维护calico需要的网络设备，网络接口的管理，监听，路由转发等等</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffff00;">BGP Client： </span>bird BGP的客户端，专门负责在集群当中转发路由规则的信息，每一个节点都会有一个BGP Client</p> 
<p style="margin-left:.0001pt;text-align:justify;">BGP协议广播的方式通知其他节点的，分发路由的规则，实现网络互通</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffff00;">ETCD：</span>报错路由信息，负责网络元数据的一致性，<span style="color:#ff0000;">元数据就是保证网络状态的一致性和准确</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Calico的工作原理：</p> 
<p style="margin-left:.0001pt;text-align:justify;">路由表来维护每个pod之间的通信，一旦创建好pod之后，会添加一个设备cali  也试试veth pair设备，比如说虚拟网卡：veth pair是一对设备，虚拟的以太网设备，<strong><span style="color:#ff0000;"><strong>一头连接在容器的网络命名空间，另一头连接网络宿主机的网络命名空间，</strong></span></strong>名字叫做cali</p> 
<p style="margin-left:.0001pt;text-align:justify;">这个设备的作用：IP地址的分配，veth pair连接容器的部分给容器分配一个IP地址，这个IP地址是一个唯一的标识，宿主机也会被这个veth pair分配一个calico网络的内部IP地址，和其他节点上的容器进行通信</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;"><strong>Veth设备，容器发出的IP地址通过veth pair设备到宿主机，宿主机就根据</strong></span></strong><strong><span style="background-color:#ffff00;"><span style="color:#ff0000;"><strong>路由规则</strong></span></span></strong><strong><span style="color:#ff0000;"><strong>的下一跳地址发送到网关（目标宿主机）</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">数据包到达目标宿主机，veth pair设备，目标宿主机也是根据路由规则，下一跳地址，转发到目标容器</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">原理图：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="399" src="https://images2.imgbox.com/4c/ca/XyKt6GaS_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Ipip模式：会生成一个tunnel，数据包都在tunnel内部打包，封装：宿主机IP 容器内部得分IP地址</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;">实验部分：</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="171" src="https://images2.imgbox.com/32/21/aR3BIzBO_o.png" width="492"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 calico.yaml 文件到 /opt/k8s 目录中，部署 CNI 网络</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /opt/k8s</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="208" src="https://images2.imgbox.com/5c/7d/u8qKeKuz_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vim calico.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;">#修改里面定义 Pod 的网络（CALICO_IPV4POOL_CIDR），需与前面 kube-controller-manager 配置文件指定的 cluster-cidr 网段一样</p> 
<p style="margin-left:.0001pt;text-align:justify;">    - name: CALICO_IPV4POOL_CIDR</p> 
<p style="margin-left:.0001pt;text-align:justify;">      value: "10.244.0.0/16"        #Calico 默认使用的网段为 192.168.0.0/16</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="46" src="https://images2.imgbox.com/f7/52/P6YQD5ZX_o.png" width="331"></p> 
<p style="margin-left:.0001pt;text-align:justify;">搜索</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="30" src="https://images2.imgbox.com/2d/f3/pzvjLWA1_o.png" width="301"></p> 
<p style="margin-left:.0001pt;text-align:justify;">改为：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="34" src="https://images2.imgbox.com/58/96/aJkDX64R_o.png" width="386"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">运行yml文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl apply -f calico.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="23" src="https://images2.imgbox.com/06/42/5TtX2ub2_o.png" width="447"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="117" src="https://images2.imgbox.com/25/c7/rSJH5irw_o.png" width="630"></p> 
<p style="margin-left:.0001pt;text-align:justify;">多刷新几下#等 Calico Pod 都 Running，节点也会准备就绪</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="185" src="https://images2.imgbox.com/f8/8b/C3XyZJay_o.png" width="683"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ifconfig 查看node1 node2</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="610" src="https://images2.imgbox.com/dd/1a/8WSzSNWw_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="212" src="https://images2.imgbox.com/de/30/FS0Wuixk_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">已完成</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create deployment nginx1 --image=nginx:1.22 --replicas=3</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="139" src="https://images2.imgbox.com/e3/99/YPx7WLsW_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建完成</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="181" src="https://images2.imgbox.com/f6/fd/G83ji9fp_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="126" src="https://images2.imgbox.com/76/36/HPpfNPJI_o.png" width="529"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看详细信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod -o wide</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="167" src="https://images2.imgbox.com/27/ce/1G75sdk7_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ip route</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="187" src="https://images2.imgbox.com/0d/7e/6evD0JgT_o.png" width="691"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">再次演示</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create deployment httpd --image=nginx:1.22 --replicas=3</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete deployments httpd</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="312" src="https://images2.imgbox.com/f5/46/gpD2lbki_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;">添加http后就会生成一个路由条目</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="199" src="https://images2.imgbox.com/c2/f5/o67vI5K5_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;">总结：</h3> 
<p style="margin-left:.0001pt;text-align:justify;">Flannel和calico：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffff00;">Flannel：</span>配置简单，功能简单，基于overlay叠加网络实现，在物理层的网络上再封装一个虚拟的网络，</p> 
<p style="margin-left:.0001pt;text-align:justify;">vxlan是虚拟三层网络，UDP模式是默认不用的，常用的就是vxlan模式，IP进行转发，Fannel提供路由表，内核封装和解封装</p> 
<p style="margin-left:.0001pt;text-align:justify;">host-gw也是不用的，由于封装和解封装的过程，对数据传输可能会有影响，没有网络策略配置的能力UDP（协议）默认网段：10.244.0.0/16</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffff00;">Calicao:</span>功能强大</p> 
<p style="margin-left:.0001pt;text-align:justify;">，基于路由表进行转发，没有封装和解封装的过程，具备网络策略的配置能力，但是路由表维护起来复杂</p> 
<p style="margin-left:.0001pt;text-align:justify;">模式：ipip BGP</p> 
<p style="margin-left:.0001pt;text-align:justify;">BGP:通过为IP路由表的前缀来实现目标主机的可达性</p> 
<p style="margin-left:.0001pt;text-align:justify;">对比ipip模式，BGP模式没有隧道，BGP模式下，pod的数据包直接通过网卡发送到目的地</p> 
<p style="margin-left:.0001pt;text-align:justify;">Ipip的隧道：在隧道进行数据包的封装IP---ipv4</p> 
<p style="margin-left:.0001pt;text-align:justify;">简单的小集群：使用flannel</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果也会要扩容，那配置的网络策略：calico</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="background-color:transparent;margin-left:.0001pt;text-align:justify;">Coredns:</h3> 
<p style="margin-left:.0001pt;text-align:justify;">可以集群当中的service资源创建一个域名和IP进行对应解析的关系。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Service是对外提供访问的一个地址，现在我们加入DNS机制之后，可以直接访问他的服务名</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="204" src="https://images2.imgbox.com/21/da/aVtTLlna_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl expose deployment nginx1 --port=30000 --target-port=80 --name=nginx-server</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get svc</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="209" src="https://images2.imgbox.com/5d/e0/48PpKtOz_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//在所有 node 节点上操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 coredns.tar 到 /opt 目录中</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /opt</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load -i coredns.tar</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="66" src="https://images2.imgbox.com/5a/14/bfCVjuyB_o.png" width="373"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//在 master01 节点上操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 coredns.yaml 文件到 /opt/k8s 目录中，部署 CoreDNS</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /opt/k8s</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl apply -f coredns.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="149" src="https://images2.imgbox.com/b4/f4/DIViuEFg_o.png" width="605"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="131" src="https://images2.imgbox.com/cc/ad/uGJhUg5u_o.png" width="656"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#DNS 解析测试</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create clusterrolebinding cluster-system-anonymous --clusterrole=cluster-admin --user=system:anonymous</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="84" src="https://images2.imgbox.com/30/3a/saV1HY48_o.png" width="685"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl run -it --rm dns-test --image=busybox:1.28.4 sh</p> 
<p style="margin-left:.0001pt;text-align:justify;">If you don't see a command prompt, try pressing enter.</p> 
<p style="margin-left:.0001pt;text-align:justify;">/ # nslookup kubernetes</p> 
<p style="margin-left:.0001pt;text-align:justify;">Server:    10.0.0.2</p> 
<p style="margin-left:.0001pt;text-align:justify;">Address 1: 10.0.0.2 kube-dns.kube-system.svc.cluster.local</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Name:      kubernetes</p> 
<p style="margin-left:.0001pt;text-align:justify;">Address 1: 10.0.0.1 kubernetes.default.svc.cluster.local</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">exit</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="139" src="https://images2.imgbox.com/df/e5/ztxDh9JK_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl edit svc nginx-server</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="32" src="https://images2.imgbox.com/53/7d/4K6wNtjz_o.png" width="477"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="383" src="https://images2.imgbox.com/2f/1f/Ii54m2o1_o.png" width="454"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get svc</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="65" src="https://images2.imgbox.com/86/c9/RPm1hw4x_o.png" width="690"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;"><strong><strong>部署多节点，部署master2：</strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="133" src="https://images2.imgbox.com/8e/5c/69jh1W1i_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">映射（全部，除了两台nginx）</p> 
<p style="margin-left:.0001pt;text-align:justify;">20.0.0.71 master01</p> 
<p style="margin-left:.0001pt;text-align:justify;">20.0.0.72 node01</p> 
<p style="margin-left:.0001pt;text-align:justify;">20.0.0.73 node02</p> 
<p style="margin-left:.0001pt;text-align:justify;">20.0.0.74 master02</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="201" src="https://images2.imgbox.com/0a/0b/ElFD1fYx_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">内核优化</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/sysctl.d/k8s.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">net.bridge.bridge-nf-call-ip6tables = 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">net.bridge.bridge-nf-call-iptables = 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">net.ipv6.conf.all.disable_ipv6=1</p> 
<p style="margin-left:.0001pt;text-align:justify;">net.ipv4.ip_forward=1</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">sysctl --system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="158" src="https://images2.imgbox.com/2b/4b/kF4ZTx2A_o.png" width="629"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">时间同步</p> 
<p style="margin-left:.0001pt;text-align:justify;">yum install ntpdate -y</p> 
<p style="margin-left:.0001pt;text-align:justify;"> ntpdate ntp.aliyun.com</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//从 master01 节点上拷贝证书文件、各master组件的配置文件和服务管理文件到 master02 节点</p> 
<p style="margin-left:.0001pt;text-align:justify;">scp -r /opt/etcd/ root@20.0.0.74:/opt/</p> 
<p style="margin-left:.0001pt;text-align:justify;">scp -r /opt/kubernetes/ root@20.0.0.74:/opt</p> 
<p style="margin-left:.0001pt;text-align:justify;">scp -r /root/.kube root@20.0.0.74:/root</p> 
<p style="margin-left:.0001pt;text-align:justify;">scp /usr/lib/systemd/system/{kube-apiserver,kube-controller-manager,kube-scheduler}.service root@20.0.0.73:/usr/lib/systemd/system/</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Master02：</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//修改配置文件kube-apiserver中的IP</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /opt/kubernetes/cfg/kube-apiserver</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_APISERVER_OPTS="--logtostderr=true \</p> 
<p style="margin-left:.0001pt;text-align:justify;">--v=4 \</p> 
<p style="margin-left:.0001pt;text-align:justify;">--etcd-servers=https://192.168.233.91:2379,https://192.168.233.93:2379,https://192.168.233.94:2379 \</p> 
<p style="margin-left:.0001pt;text-align:justify;">--bind-address=192.168.233.92 \ #修改</p> 
<p style="margin-left:.0001pt;text-align:justify;">--secure-port=6443 \</p> 
<p style="margin-left:.0001pt;text-align:justify;">--advertise-address=192.168.233.92 \ #修改</p> 
<p style="margin-left:.0001pt;text-align:justify;">......</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//在 master02 节点上启动各服务并设置开机自启</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start kube-apiserver.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable kube-apiserver.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start kube-controller-manager.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable kube-controller-manager.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start kube-scheduler.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable kube-scheduler.service</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="102" src="https://images2.imgbox.com/92/68/Fs7YfvBR_o.png" width="675"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//查看node节点状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">ln -s /opt/kubernetes/bin/* /usr/local/bin/</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get nodes</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get nodes -o wide #-o=wide：输出额外信息；对于Pod，将输出Pod所在的Node名</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//此时在master02节点查到的node节点状态仅是从etcd查询到的信息，</p> 
<p style="margin-left:.0001pt;text-align:justify;">而此时node节点实际上并未与master02节点建立通信连接，因此需要使用一个VIP把node节点与master节点都关联起来</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="231" src="https://images2.imgbox.com/f9/b3/s9YP46NN_o.png" width="500"></p> 
<p style="margin-left:.0001pt;text-align:justify;">软连接</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="17" src="https://images2.imgbox.com/ab/f9/gZILZe7U_o.png" width="569"></p> 
<p style="margin-left:.0001pt;text-align:justify;">完成</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="333" src="https://images2.imgbox.com/18/77/hWYilmL1_o.png" width="659"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="95" src="https://images2.imgbox.com/05/36/IU6GrGn3_o.png" width="691"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Node节点和master02并没真正的建立通信，获取的都是etcd的信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;">负载均衡部署</h3> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//配置load balancer集群双机热备负载均衡（nginx实现负载均衡，keepalived实现双机热备）</p> 
<p style="margin-left:.0001pt;text-align:justify;">##### 在lb01、lb02节点上操作 #####</p> 
<p style="margin-left:.0001pt;text-align:justify;">//配置nginx的官方在线yum源，配置本地nginx的yum源</p> 
<p style="margin-left:.0001pt;text-align:justify;">cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; 'EOF'</p> 
<p style="margin-left:.0001pt;text-align:justify;">[nginx]</p> 
<p style="margin-left:.0001pt;text-align:justify;">name=nginx repo</p> 
<p style="margin-left:.0001pt;text-align:justify;">baseurl=http://nginx.org/packages/centos/7/$basearch/</p> 
<p style="margin-left:.0001pt;text-align:justify;">gpgcheck=0</p> 
<p style="margin-left:.0001pt;text-align:justify;">EOF</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">yum install nginx -y</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//修改nginx配置文件，配置四层反向代理负载均衡，指定k8s群集2台master的节点ip和6443端口</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/nginx/nginx.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;">events {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    worker_connections  1024;</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="328" src="https://images2.imgbox.com/38/5c/U2iWMlpV_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">stream {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    log_format  main  '$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent';</p> 
<p style="margin-left:.0001pt;text-align:justify;">#日志记录格式</p> 
<p style="margin-left:.0001pt;text-align:justify;">#$remote_addr: 客户端的 IP 地址。</p> 
<p style="margin-left:.0001pt;text-align:justify;">#$upstream_addr: 上游服务器的地址。</p> 
<p style="margin-left:.0001pt;text-align:justify;">#[$time_local]: 访问时间，使用本地时间。</p> 
<p style="margin-left:.0001pt;text-align:justify;">#$status: HTTP 响应状态码。</p> 
<p style="margin-left:.0001pt;text-align:justify;">#$upstream_bytes_sent: 从上游服务器发送到客户端的字节数。</p> 
<p style="margin-left:.0001pt;text-align:justify;">    </p> 
<p style="margin-left:.0001pt;text-align:justify;">access_log  /var/log/nginx/k8s-access.log  main;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">    upstream k8s-apiserver {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        server 192.168.233.91:6443;</p> 
<p style="margin-left:.0001pt;text-align:justify;">        server 192.168.233.92:6443;</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">    server {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        listen 6443;</p> 
<p style="margin-left:.0001pt;text-align:justify;">        proxy_pass k8s-apiserver;</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">http {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">......</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">另一边的nginx同样的操作</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//检查配置文件语法</p> 
<p style="margin-left:.0001pt;text-align:justify;">nginx -t   </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//启动nginx服务，查看已监听6443端口</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;">netstat -natp | grep nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">然后</p> 
<p style="margin-left:.0001pt;text-align:justify;">//部署keepalived服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">yum install keepalived -y</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//修改keepalived配置文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/keepalived/keepalived.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;">! Configuration File for keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">global_defs {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">   # 接收邮件地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">     acassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     failover@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     sysadmin@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   }</p> 
<p style="margin-left:.0001pt;text-align:justify;">   # 邮件发送地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email_from Alexandre.Cassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_server 127.0.0.1</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_connect_timeout 30</p> 
<p style="margin-left:.0001pt;text-align:justify;">   router_id NGINX_MASTER #lb01节点的为 NGINX_MASTER，lb02节点的为 NGINX_BACKUP</p> 
<p style="margin-left:.0001pt;text-align:justify;">   #vrrp_strict  #注释掉</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#添加一个周期性执行的脚本</p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_script check_nginx {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    script "/etc/nginx/check_nginx.sh" #指定检查nginx存活的脚本路径</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_instance VI_1 {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    state MASTER #lb01节点的为 MASTER，lb02节点的为 BACKUP</p> 
<p style="margin-left:.0001pt;text-align:justify;">    interface ens33 #指定网卡名称 ens33</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_router_id 51 #指定vrid，两个节点要一致</p> 
<p style="margin-left:.0001pt;text-align:justify;">    priority 100 #lb01节点的为 100，lb02节点的为 90</p> 
<p style="margin-left:.0001pt;text-align:justify;">    advert_int 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">    authentication {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_type PASS</p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_pass 1111</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_ipaddress {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        192.168.233.100/24 #指定 VIP</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">    track_script {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        check_nginx #指定vrrp_script配置的脚本</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/keepalived/keepalived.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="32" src="https://images2.imgbox.com/89/04/SRUZuGOc_o.png" width="390"></p> 
<p style="margin-left:.0001pt;text-align:justify;">主：</p> 
<p style="margin-left:.0001pt;text-align:justify;">! Configuration File for keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">global_defs {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">     acassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     failover@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     sysadmin@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   }</p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email_from Alexandre.Cassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_server 127.0.0.1</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_connect_timeout 30</p> 
<p style="margin-left:.0001pt;text-align:justify;">   router_id NGINX_MASTER</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_skip_check_adv_addr</p> 
<p style="margin-left:.0001pt;text-align:justify;">  # vrrp_strict</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_garp_interval 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_gna_interval 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_script check_nginx {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;"> script "/etc/nginx/check_nginx.sh"</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_instance VI_1 {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    state MASTER</p> 
<p style="margin-left:.0001pt;text-align:justify;">    interface ens33</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_router_id 51</p> 
<p style="margin-left:.0001pt;text-align:justify;">    priority 100</p> 
<p style="margin-left:.0001pt;text-align:justify;">    advert_int 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">    authentication {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_type PASS</p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_pass 1111</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_ipaddress {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        20.0.0.100/24</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">      track_script {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">      check_nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="441" src="https://images2.imgbox.com/9e/03/VmI0QYTc_o.png" width="579"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="418" src="https://images2.imgbox.com/f2/07/ypoGId1m_o.png" width="530"></p> 
<p style="margin-left:.0001pt;text-align:justify;">设置时间</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="433" src="https://images2.imgbox.com/70/f4/odRqk0wy_o.png" width="606"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//创建nginx状态检查脚本</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/nginx/check_nginx.sh</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#!/bin/bash                                                        </p> 
<p style="margin-left:.0001pt;text-align:justify;">/usr/bin/curl -I http://localhost &amp;&gt;/dev/null    </p> 
<p style="margin-left:.0001pt;text-align:justify;">if [ $? -ne 0 ];then                                            </p> 
<p style="margin-left:.0001pt;text-align:justify;">#    /etc/init.d/keepalived stop</p> 
<p style="margin-left:.0001pt;text-align:justify;">    systemctl stop keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;">fi</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">chmod +x /etc/nginx/check_nginx.sh</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//启动keepalived服务（一定要先启动了nginx服务，再启动keepalived服务）</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;">ip a #查看VIP是否生成</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="42" src="https://images2.imgbox.com/f1/b7/YvBfvj8I_o.png" width="437"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="135" src="https://images2.imgbox.com/e2/55/Ap8DXAl8_o.png" width="466"></p> 
<p style="margin-left:.0001pt;text-align:justify;">同样的配置从（稍稍微修改）</p> 
<p style="margin-left:.0001pt;text-align:justify;">! Configuration File for keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">global_defs {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">     acassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     failover@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">     sysadmin@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   }</p> 
<p style="margin-left:.0001pt;text-align:justify;">   notification_email_from Alexandre.Cassen@firewall.loc</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_server 127.0.0.1</p> 
<p style="margin-left:.0001pt;text-align:justify;">   smtp_connect_timeout 30</p> 
<p style="margin-left:.0001pt;text-align:justify;">   router_id NGINX_BACKUP</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_skip_check_adv_addr</p> 
<p style="margin-left:.0001pt;text-align:justify;">  # vrrp_strict</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_garp_interval 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">   vrrp_gna_interval 0</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_script check_nginx {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;"> script "/etc/nginx/check_nginx.sh"</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">vrrp_instance VI_1 {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">    state BACKUP</p> 
<p style="margin-left:.0001pt;text-align:justify;">    interface ens33</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_router_id 51</p> 
<p style="margin-left:.0001pt;text-align:justify;">    priority 90</p> 
<p style="margin-left:.0001pt;text-align:justify;">    advert_int 1</p> 
<p style="margin-left:.0001pt;text-align:justify;">    authentication {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_type PASS</p> 
<p style="margin-left:.0001pt;text-align:justify;">        auth_pass 1111</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">    virtual_ipaddress {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">        20.0.0.100/24</p> 
<p style="margin-left:.0001pt;text-align:justify;">    }</p> 
<p style="margin-left:.0001pt;text-align:justify;">      track_script {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:justify;">      check_nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">}</p> 
<p style="margin-left:.0001pt;text-align:justify;">先起nginx，再起keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="54" src="https://images2.imgbox.com/d5/90/O09bvEd5_o.png" width="492"></p> 
<p style="margin-left:.0001pt;text-align:justify;">测试主恢复之后，要先启动nginx在启动keepalived</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl restart keepalived.service</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Node1，2</p> 
<p style="margin-left:.0001pt;text-align:justify;">//修改node节点上的bootstrap.kubeconfig,kubelet.kubeconfig配置文件为VIP</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /opt/kubernetes/cfg/</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim bootstrap.kubeconfig</p> 
<p style="margin-left:.0001pt;text-align:justify;">server: https://192.168.233.100:6443</p> 
<p style="margin-left:.0001pt;text-align:justify;">                      </p> 
<p style="margin-left:.0001pt;text-align:justify;">vim kubelet.kubeconfig</p> 
<p style="margin-left:.0001pt;text-align:justify;">server: https://192.168.233.100:6443</p> 
<p style="margin-left:.0001pt;text-align:justify;">                        </p> 
<p style="margin-left:.0001pt;text-align:justify;">vim kube-proxy.kubeconfig</p> 
<p style="margin-left:.0001pt;text-align:justify;">server: https://192.168.233.100:6443</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="72" src="https://images2.imgbox.com/7e/16/oy1RgMOY_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="71" src="https://images2.imgbox.com/14/9e/Yo3QdcmL_o.png" width="679"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="50" src="https://images2.imgbox.com/39/4b/hEwqKJ12_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="329" src="https://images2.imgbox.com/08/64/1fRWeZB3_o.png" width="659"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="89" src="https://images2.imgbox.com/0e/6a/i32DatQa_o.png" width="715"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="452" src="https://images2.imgbox.com/53/ed/4rtfPc3U_o.png" width="686"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="65" src="https://images2.imgbox.com/79/2b/mr8Kx0Vy_o.png" width="565"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="281" src="https://images2.imgbox.com/df/39/6JXQftYp_o.png" width="565"></p> 
<p style="margin-left:.0001pt;text-align:justify;">重启</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="74" src="https://images2.imgbox.com/8d/81/mP626F4N_o.png" width="541"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//在 lb01 上查看 nginx 和 node 、 master 节点的连接状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">netstat -natp | grep nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="238" src="https://images2.imgbox.com/c0/f7/ZZvWPXBY_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">测试</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="66" src="https://images2.imgbox.com/d5/da/gflWogcZ_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">从节点查看</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="215" src="https://images2.imgbox.com/2d/03/EO1xtah7_o.png" width="631"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//测试创建pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl run nginx --image=nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//查看Pod的状态信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pods -o wide</p> 
<p style="margin-left:.0001pt;text-align:justify;">//在对应网段的node节点上操作，可以直接使用浏览器或者curl命令访问</p> 
<p style="margin-left:.0001pt;text-align:justify;">curl 172.17.36.2</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl exec -it nginx bash</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//这时在master01节点上查看nginx日志</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl logs nginx-dbddb74b8-nf9sk</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;">Dashboard：</h3> 
<p style="margin-left:.0001pt;text-align:justify;">仪表盘，就是kubenetes的可视化界面，在这个可视化界面上，可以对k8s集群化管理</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">//在 master01 节点上操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 recommended.yaml 文件到 /opt/k8s 目录中</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /opt/k8s</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim recommended.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;">#默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="172" src="https://images2.imgbox.com/67/31/rJx1ySIQ_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="718" src="https://images2.imgbox.com/f3/90/Dmdwu5y7_o.png" width="660"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl apply -f recommended.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="31" src="https://images2.imgbox.com/ed/c1/vTsCtJ1O_o.png" width="432"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建角色</p> 
<p style="margin-left:.0001pt;text-align:justify;">#创建service account并绑定默认cluster-admin管理员集群角色</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create serviceaccount dashboard-admin -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="52" src="https://images2.imgbox.com/8c/72/SKc0VQkO_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">绑定到集群，#获取token值</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk '/dashboard-admin/{print $1}')</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="60" src="https://images2.imgbox.com/7a/fc/Bu07grE5_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="355" src="https://images2.imgbox.com/02/81/0rxead3K_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">去浏览器访问：（火狐浏览器）</p> 
<p style="margin-left:.0001pt;text-align:justify;">#使用输出的token登录Dashboard</p> 
<p style="margin-left:.0001pt;text-align:justify;">https://20.0.0.73:30001</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="377" src="https://images2.imgbox.com/7b/88/Lxb0nTDI_o.png" width="692"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/867dc1aa2c6351e1b16ae7d06f7d7ea4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python实现rtmp推流</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b7e96251269b26be58c47546e88a41a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java开发框架和中间件面试题(10)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>