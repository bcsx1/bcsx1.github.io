<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Node.js教程-express框架 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Node.js教程-express框架" />
<meta property="og:description" content="概述 Express是基于Node.js平台(建立在Node.js内置的http模块上)，快速、开放、极简的Web开发框架。
中文官网 http://www.expressjs.com.cn/。
Github地址：https://github.com/orgs/expressjs。
Express核心特性：
可设置中间件来响应 HTTP 请求定义了路由表用于执行不同的 HTTP 请求可通过向模板传递参数来动态渲染 HTML 页面 安装 npm i express 以上命令会将express安装在当前目录下的node_modules文件夹下，并且将其依赖的包也一并下载下来
以下几个和express搭配使用的包：
body-parser 用于处理 JSON、Raw、Text和URL中的请求数据cookie-parser 用于处理Cookiemulter 用于处理**enctyoe=“multipart/form-data””**的表单数据 基本使用 基本使用步骤：
导入 express 模块创建 express 实例创建并启动HTTP服务绑定请求事件 // 1. 导入 express 包 const express = require(&#39;express&#39;) // 2. 创建 express 实例 const app = express() // 3. 启动服务 app.listen(80, () =&gt; { console.log(&#34;Express server is starting ...&#34;) }) // 4. 绑定请求事件 app.get(&#34;/&#34;, (req, res) =&gt; { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1322ad90988e41e99f87933ca2a623d8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-26T18:03:02+08:00" />
<meta property="article:modified_time" content="2023-12-26T18:03:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Node.js教程-express框架</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>概述</h3> 
<p><code>Express</code>是基于<code>Node.js</code>平台(建立在<code>Node.js</code>内置的<strong>http</strong>模块上)，快速、开放、极简的<strong>Web开发框架</strong>。<br> 中文官网 <a href="http://www.expressjs.com.cn/" rel="nofollow">http://www.expressjs.com.cn/</a>。<br> Github地址：<a href="https://github.com/orgs/expressjs">https://github.com/orgs/expressjs</a>。</p> 
<p><code>Express</code>核心特性：</p> 
<ul><li>可设置中间件来响应 HTTP 请求</li><li>定义了路由表用于执行不同的 HTTP 请求</li><li>可通过向模板传递参数来动态渲染 HTML 页面</li></ul> 
<h3><a id="_10"></a>安装</h3> 
<pre><code class="prism language-bash"><span class="token function">npm</span> i express
</code></pre> 
<p>以上命令会将<code>express</code>安装在当前目录下的<strong>node_modules</strong>文件夹下，并且将其依赖的包也一并下载下来<br> 以下几个和<code>express</code>搭配使用的包：</p> 
<ul><li><strong>body-parser</strong> 用于处理 <strong>JSON</strong>、<strong>Raw</strong>、<strong>Text</strong>和<strong>URL</strong>中的请求数据</li><li><strong>cookie-parser</strong> 用于处理Cookie</li><li><strong>multer</strong> 用于处理**enctyoe=“multipart/form-data””**的表单数据</li></ul> 
<h3><a id="_20"></a>基本使用</h3> 
<p><strong>基本使用步骤：</strong></p> 
<ol><li>导入 <strong>express</strong> 模块</li><li>创建 <strong>express</strong> 实例</li><li>创建并启动HTTP服务</li><li>绑定请求事件</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// 1. 导入 express 包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 创建 express 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 启动服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Express server is starting ..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 绑定请求事件</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求进来了 &gt;&gt;&gt; "</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"Hello Node.js"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="set__46"></a>set 方法</h3> 
<p><code>set</code>方法用于指定变量的值</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 设置 端口</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">)</span>

<span class="token comment">// 设定views变量，意为视图存放的目录</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设定view engine变量，意为网页模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'jade'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_58"></a>请求和响应</h3> 
<p><code>Express</code>处理请求中回调函数的参数：<strong>request</strong>和<strong>response</strong>对象来处理请求和响应。</p> 
<h4><a id="request__60"></a>request 对象</h4> 
<p><code>request</code>对象表示 <strong>HTTP</strong>请求，包含了请求查询的<strong>字符串</strong>，<strong>参数</strong>、<strong>内容</strong>、<strong>HTTP头部</strong>等属性。常见属性：</p> 
<ul><li><strong>request.app</strong> 当<strong>callback</strong>为外部文件时，用其访问<strong>express</strong>实例</li><li><strong>request.baseUrl</strong> 获取当前的 URL 路径</li><li><strong>request.method</strong> 获取请求方法</li><li><strong>request.body</strong> 获取请求体内容</li><li><strong>request.cookie</strong> 获取 Cookie 内容</li><li><strong>request.hostname</strong> 获取主机名</li><li><strong>request.ip</strong> 获取IP</li><li><strong>request.originalUrl</strong> 获取原始请求 URL</li><li><strong>request.params</strong> 获取请求参数(动态匹配的参数)</li><li><strong>request.path</strong> 获取请求路径</li><li><strong>request.protocol</strong> 获取请求协议</li><li><strong>request.query</strong> 获取URL的查询参数</li><li><strong>request.route</strong> 获取请求匹配的路由</li><li><strong>request.get()</strong> 获取指定的请求头</li><li><strong>request.is()</strong> 判断请求头<strong>Content-Type</strong>的<strong>MIME</strong>类型</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// http://domain:port/x1/x2/wz?age=18</span>
request<span class="token punctuation">.</span>path  <span class="token comment">// /x1/x2/wz</span>
request<span class="token punctuation">.</span>params  <span class="token comment">// wz</span>
request<span class="token punctuation">.</span>query  <span class="token comment">// age</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token comment">// 引入express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 启动服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Server is starting ..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 绑定 get 请求事件</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.protocol 获取请求协议</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"protocol &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span>
  <span class="token comment">// req.method 获取请求方法</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"method &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">)</span>
  <span class="token comment">// req.hostname 获取主机名</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hostname &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>
  <span class="token comment">// req.ip 获取请求 IP</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ip &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>ip<span class="token punctuation">)</span>
  <span class="token comment">// req.originalUrl 获取请求原始路径</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"originalUrl &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span>
  <span class="token comment">// req.path 获取请求路径</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"path &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
  <span class="token comment">// req.route 获取请求路由</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"route &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>route<span class="token punctuation">)</span>
  <span class="token comment">// req.params 获取请求参数</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"params &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
  <span class="token comment">// req.query 获取请求查询参数</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"query &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
  <span class="token comment">// req.body 获取请求体</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"body &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 绑定 post 请求事件</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.protocol 获取请求协议</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"protocol &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span>
  <span class="token comment">// req.method 获取请求方法</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"method &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">)</span>
  <span class="token comment">// req.hostname 获取主机名</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hostname &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>
  <span class="token comment">// req.ip 获取请求 IP</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ip &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>ip<span class="token punctuation">)</span>
  <span class="token comment">// req.originalUrl 获取请求原始路径</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"originalUrl &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span>
  <span class="token comment">// req.path 获取请求路径</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"path &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
  <span class="token comment">// req.route 获取请求路由</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"route &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>route<span class="token punctuation">)</span>
  <span class="token comment">// req.params 获取请求参数</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"params &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
  <span class="token comment">// req.query 获取请求查询参数</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"query &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
  <span class="token comment">// req.body 获取请求体</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"body &gt;&gt;&gt; "</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="response__149"></a>response 对象</h4> 
<p><code>response </code>对象表示 <strong>HTTP</strong>响应，即在接受到请求时向客户端发送的数据。常见属性：</p> 
<ul><li><strong>response.app</strong> 当<strong>callback</strong>为外部文件时，用其访问<strong>express</strong>实例</li><li><strong>response.cookie(name, value[, options])</strong> 设置<strong>Cookie</strong>信息</li><li><strong>response.clearCookie()</strong> 清空Cookie</li><li><strong>response.download()</strong> 传送指定的文件</li><li><strong>response.get()</strong> 获取指定的HTTP头信息</li><li><strong>response.set(name, value)</strong> 设置响应头(<strong>Header</strong>)</li><li><strong>response.json()</strong> 响应JSON格式的数据</li><li><strong>response.render(view[, locals], callback)</strong> 渲染网页模版</li><li><strong>response.send()</strong> 发送响应</li><li><strong>response.sendFile(path[, options][, fn])</strong> 传送文件</li><li><strong>response.status()</strong> 设置 HTTP 状态码</li><li><strong>response.type()</strong> 设置 <strong>Content-Type</strong>的 <strong>MIME</strong>类型</li><li><strong>response.redirect()</strong> 设置重定向</li></ul> 
<h3><a id="_165"></a>路由</h3> 
<p><code>路由</code>即路径映射。在<code>Express</code>中，<strong>路由</strong>指客户端的请求与服务器处理函数的映射。<br> <code>Express</code>中路由是一个单独的组件<code>Express.Router</code>。<br> <code>Express</code>中路由由三部分组成，分别为<strong>请求类型</strong>、<strong>请求URL</strong>、<strong>处理函数</strong>。其格式如下：</p> 
<blockquote> 
 <p>app.method(path, handler())</p> 
</blockquote> 
<p><strong>路由匹配过程</strong></p> 
<ul><li>请求到达服务器时，先经过路由的匹配，匹配成功了，才会调用对应的处理函数</li><li>在匹配时，按照定义的顺序依次匹配，仅当请求类型和请求URL同时匹配成功了，才会调用对应的处理函数</li></ul> 
<p><img src="https://images2.imgbox.com/2f/c5/pWLgnAlC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 express 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 创建路由实例</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 挂载路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"express router"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 注册路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

<span class="token comment">// 启动服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Server is starting ..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 访问路径 http://domain:port/api/user</span>
</code></pre> 
<h3><a id="_203"></a>中间件</h3> 
<p><strong>中间件</strong>(<code>Middleware</code>)指业务流程的中间处理环节。其是一个函数，包含了<strong>request</strong>、<strong>respoonse</strong>、<strong>next</strong>三个参数，其中 <strong>next()</strong> 把流转交给下一个中间件或路由。</p> 
<p><strong><code>Express</code> 中间件调用流程</strong><br> <img src="https://images2.imgbox.com/ad/7a/DZQuqU7j_o.png" alt="在这里插入图片描述"><br> <code>注意：</code></p> 
<ol><li>在注册路由之前注册中间件(错误中间件除外)</li><li>多个中间件共享<strong>request</strong>和<strong>response</strong>对象</li><li><strong>next()</strong> 函数后不能再写逻辑代码</li></ol> 
<h4><a id="_213"></a>全局中间件</h4> 
<p>通过<code>app.use()</code>注册的中间件为<strong>全局中间件</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间件A"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 注册全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间件B"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_236"></a>局部中间件</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 定义中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间件A"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 注册全局中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间件B"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_262"></a>中间件分类</h4> 
<p><strong>中间件</strong>按照作用可划分为三类：<strong>应用级别中间件</strong>、<strong>路由级别中间件</strong>、<strong>错误级别中间件</strong>。</p> 
<h5><a id="_264"></a>应用级别中间件</h5> 
<p>通过<code>app.use()</code>或<code>app.method()</code>注册，即绑定到<strong>app</strong>实例上的中间件即为<strong>应用级别中间件</strong>。(其中<strong>method</strong>为<code>get</code>、<code>post</code>、<code>put</code>、<code>delete</code>等请求方法)</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_276"></a>路由级别中间件</h5> 
<p>通过<code>router.use()</code>注册，即绑定到<strong>router</strong>实例上的中间件即为<strong>路由级别中间件</strong>。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 路由上注册中间件</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 注册路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_292"></a>错误级别中间件</h5> 
<p><strong>错误级别中间件</strong>用来捕获整个项目中发生的异常，从而防止项目异常崩溃。<br> <strong>错误级别中间件</strong>的处理函数中必须有<strong>4</strong>个形参，即<code>(error, request, response, next)</code><br> <strong>错误级别中间件</strong>必须注册在所有路由之后</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 请求处理 ...</span>

<span class="token comment">// 注册错误中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_308"></a>内置中间件</h4> 
<p><code>Express</code>中内置了多个中间件，极大的提高了 <strong>Express</strong> 项目的开发效率。常见内置中间件：</p> 
<ul><li> <p><strong>express.static</strong> 快速托管静态资源</p> 
  <blockquote> 
   <p>express.static(root[, options])</p> 
  </blockquote> </li><li> <p><strong>express.json</strong> 解析JSON格式的请求体数据</p> </li><li> <p><strong>express.urlencoded</strong> 解析 url-encoded 格式的请求体数据</p> </li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 快速托管静态资源</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 通过 express.json() 这个中间件，解析表单中的 JSON 格式的数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 通过 express.urlencoded() 这个中间件，来解析表单中的 url-encoded 格式的数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_326"></a>第三方中间件</h4> 
<h5><a id="cookieparser_327"></a>cookie-parser</h5> 
<p><code>cookie-parser</code> 用于处理请求中的<strong>Cookie</strong>。<br> <a href="https://github.com/expressjs/cookie-parser">https://github.com/expressjs/cookie-parser</a></p> 
<h6><a id="Cookie_330"></a>设置Cookie</h6> 
<blockquote> 
 <p>res.cookie(name, value[, options])</p> 
</blockquote> 
<p><strong>参数说明</strong></p> 
<ul><li><strong>name</strong> cookie名称</li><li><strong>value</strong> cookie值</li><li><strong>options</strong> 配置参数 
  <ul><li><strong>domain</strong> 域名。默认为当前域名</li><li><strong>expires</strong> 失效时间。未设置或0，表示浏览器关闭后即失效</li><li><strong>maxAge</strong> 最大失效时间(指从当前时间开始多久后失效)，单位毫秒</li><li><strong>secure</strong> 为 <strong>true</strong>时，cookie 在 http 失效，https 生效</li><li><strong>path</strong> cookie在什么路径下有效。默认为**/**</li><li><strong>httpOnly</strong> 只能被访问，防止 XSS攻击</li><li><strong>signed</strong> 是否签名。默认指为<strong>false</strong></li></ul> </li></ul> 
<p><strong>不签名实例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 app 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册 Cookie中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/setCookie'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">10000</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'cookie set success!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>签名实例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token string">'^123$'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ^123$ 为签名秘钥</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'setCookie'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 将cookie的name 进行签名</span>
	res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span> <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h6><a id="Cookie_380"></a>获取Cookie</h6> 
<p><code>注意：</code><strong>Cookie</strong>签名与不签名获取的方式不一样。<code>req.cookies</code>获取<strong>不签名</strong>的<strong>cookie</strong>；<code>req.signedCookies</code>获取<strong>签名</strong>的<strong>cookie</strong>。<br> <strong>不签名实例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 app 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册 Cookie中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getCookie'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"cookie got"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>签名实例</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建 app 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册 Cookie中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token string">'^123$'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ^123$ 为签名秘钥</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getCookie'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>signedCookies<span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"cookie got"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="Cookie_418"></a>删除Cookie</h6> 
<blockquote> 
 <p>res.clearCookie(name[, options])</p> 
</blockquote> 
<h5><a id="expresssession_421"></a>express-session</h5> 
<p><code>express-session</code>用于处理请求中的会话。<br> <a href="https://github.com/expressjs/session">https://github.com/expressjs/session</a></p> 
<h6><a id="_session_425"></a>配置 session</h6> 
<blockquote> 
 <p>session(options)</p> 
</blockquote> 
<p><strong>参数说明：</strong></p> 
<ul><li><strong>options</strong> 配置参数 
  <ul><li><strong>cookie</strong> cookie设置</li><li><strong>genid</strong> sessionid算法。默认为<strong>uid-safe库自动生成id</strong></li><li><strong>name</strong> 会话名称。默认为 <strong>connect.sid</strong></li><li><strong>secret</strong> 会话签名秘钥</li><li><strong>store</strong> 会话存储方式。默认为内存</li><li><strong>resave</strong> 是否强制保存会话，及时未被修改也被保存。默认为<strong>true</strong></li><li><strong>saveUninitialized</strong> 强制将未初始化的会话保存至存储中。(会话是新的且未被修改即为<strong>未初始化</strong>)</li><li><strong>unset</strong> 是否保存会话。默认为<strong>keep</strong>，不保存可设置为<strong>destory</strong></li></ul> </li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"session-cookie"</span><span class="token punctuation">,</span>
	<span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">"^123456$"</span><span class="token punctuation">,</span>  <span class="token comment">// 会话签名秘钥</span>
	<span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<h6><a id="reqsession_454"></a>req.session</h6> 
<p><code>req.session</code>可用于存储或访问会话数据，以<strong>JSON</strong>的形式序列化。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建服务实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 配置session，并注册session中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"express"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">"^123456$"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/setSession'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 存储会话</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"李四"</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"set session success"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getSession'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 获取会话</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"session got"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 启动服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_487"></a>属性</h6> 
<table><thead><tr><th align="left">属性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>req.session.id</code></td><td align="left">会话ID</td></tr><tr><td align="left"><code>req.session.sessionID</code></td><td align="left">会话ID</td></tr><tr><td align="left"><code>req.session.cookie</code></td><td align="left">获取会话中的 <strong>cookie</strong> 对象， 而后可对其修改</td></tr><tr><td align="left"><code>req.session.cookie.maxAge</code></td><td align="left">会话有效剩余时长</td></tr><tr><td align="left"><code>req.session.cookie.originalMaxAge</code></td><td align="left">返回会话 <strong>cookie</strong> 的原始 <strong>maxAge</strong>, 以毫秒为单位</td></tr></tbody></table> 
<h6><a id="_495"></a>方法</h6> 
<table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>req.session.regenerate(callback)</code></td><td align="left">重新生成会话</td></tr><tr><td align="left"><code>req.session.destroy(callback)</code></td><td align="left">销毁会话并取消设置 <strong>req.session</strong> 属性</td></tr><tr><td align="left"><code>req.session.reload(callback)</code></td><td align="left">从存储重新加载会话数据并重新填充 <strong>req.session</strong> 对象</td></tr><tr><td align="left"><code>req.session.save(callback)</code></td><td align="left">讲会话保存至 <strong>store</strong>，用内存中的内容替换 <strong>store</strong>上的内容</td></tr><tr><td align="left"><code>req.session.touch()</code></td><td align="left">更新 <strong>.maxAge</strong>属性</td></tr></tbody></table> 
<h5><a id="JWT_504"></a>JWT</h5> 
<p><code>JWT</code>(JSON Web Token)是由三部分组成：<strong>Header</strong>、<strong>Payload</strong>(真正的用户信息，加密后的字符串)、<strong>Signature</strong>。<br> <code>JWT</code>工作原理：用户的信息以<strong>Token</strong>的字符串的形式，保存在客户端中。用户每次请求，将<strong>Token</strong>存放在请求头<strong>Authorization</strong>上，服务器拿到该值后进行解析处理。<br> <img src="https://images2.imgbox.com/88/d8/b9l7liQe_o.png" alt="在这里插入图片描述"><br> <code>Express</code>中<code>jsonwebtoken</code>模块用于生成<strong>JWT</strong>字符串，<code>express-jwt</code>用于将<strong>JWT</strong>字符串还原成<strong>JSON</strong>对象。</p> 
<h6><a id="_509"></a>使用</h6> 
<ol><li>安装模块<pre><code class="prism language-javascript">npm install jsonwebtoken express<span class="token operator">-</span>jwt
</code></pre> </li><li>引入模块<pre><code class="prism language-javascript"><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">requre</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> expressJWT <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-jwt'</span><span class="token punctuation">)</span>
</code></pre> </li><li>生成 JWT 字符串 
  <blockquote> 
   <p>jwt.sign(payload, secret[, options[, callback]])</p> 
   <blockquote> 
    <p>payload 存储的对象<br> secret 签名秘钥<br> options 配置参数。常见有 <strong>expiresIn</strong>(过期时间)、<strong>algorithm</strong>(签名算法)<br> callback 回调函数</p> 
   </blockquote> 
  </blockquote> <pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">username</span><span class="token operator">:</span> username<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'^123456$'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">expireIn</span><span class="token operator">:</span> <span class="token string">'2h'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li><li>还原 JWT 字符串<pre><code class="prism language-javascript"><span class="token comment">// 此处的 secret 值必须和jwt 生成时所使用的秘钥相同</span>
<span class="token comment">// unless 指定了哪些接口无须携带Token访问</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">expressJWT</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'^123456$'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li><li>获取 JWT 信息 
  <blockquote> 
   <p>在访问权限的接口中，可通过<strong>req.user</strong>对象即可访问 JWT 字符串中解析的内容</p> 
  </blockquote> </li><li>捕获 JWT 异常<pre><code class="prism language-javascript"><span class="token comment">// 通过异常中间件来处理JWT解析失败</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token comment">// TODO</span>
	<span class="token punctuation">}</span>
	<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h5><a id="multer_548"></a>multer</h5> 
<p><code>multer</code>是用于处理<code>multipart/form-data</code>类型的表单数据，主要用于上传文件。(<code>不会处理任何非 multipart/form-data 的数据 </code>)<br> <code>multer</code>在解析完请求体后，会向<strong>request</strong>对象上添加一个<strong>body</strong>对象和一个<strong>file</strong>或<strong>files</strong>对象。<strong>body</strong>对应表单中提交的文本字段，<strong>file</strong>或<strong>files</strong>包含了表单上传的文件。<br> <a href="https://github.com/expressjs/multer">https://github.com/expressjs/multer</a></p> 
<blockquote> 
 <p>multer(options)</p> 
</blockquote> 
<p><strong>参数说明：</strong></p> 
<ul><li><strong>options</strong> 参数配置 
  <ul><li><strong>dest / storage</strong> 上传文件存放目录。</li><li><strong>fileFilter</strong> 文件过滤器</li><li><strong>limits</strong> 限制上传文件 (可有效防止Dos攻击) 
    <ul><li><strong>fieldNameSize</strong> <strong>field</strong>名字最大长度。默认为 <strong>100 bytes</strong></li><li><strong>fieldSize</strong> <strong>field</strong>指最大长度。默认为<strong>1MB</strong></li><li><strong>fields</strong> 非文件<strong>field</strong>的最大数量。默认为<strong>无限</strong></li><li><strong>fileSize</strong> 文件最大长度，单位字节。默认为<strong>无限</strong></li><li><strong>files</strong> 文件最大数量。默认为<strong>无限</strong></li><li><strong>parts</strong> <strong>part</strong>传输的最大数量(<strong>field</strong> + <strong>file</strong>)。默认为<strong>无限</strong></li><li><strong>headerPairs</strong> 键值对最大组数。默认为<strong>2000</strong></li></ul> </li><li><strong>preservePath</strong> 保存包含文件名的完整路径</li></ul> </li></ul> 
<h6><a id="storage_569"></a>storage</h6> 
<p><code>storage</code>为存储引擎，<code>multer</code>中具有<strong>DiskStorage</strong>、<strong>MemoryStorage</strong>和第三方等引擎。</p> 
<h6><a id="DiskStorage_571"></a>DiskStorage</h6> 
<p><code>DiskStorage</code>为磁盘存储引擎，其有两个选项可用：<strong>destination</strong>和<strong>filename</strong>。<br> <strong>destination</strong> 用来确定上传的文件存放的位置。可提供一个 <strong>string</strong>或<strong>function</strong>。若没有设置则使用操作系统默认的临时文件夹。<br> <code>注意：</code>若<strong>destination</strong> 是一个<strong>function</strong>，则需用手动创建文件夹；若<strong>destination</strong> 是一个<strong>string</strong>，multer 会自动创建。<br> <strong>filename</strong>用来确定文件夹中文件名。若未设置该参数，则文件将设置一个随机文件名且没有后缀名。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">DiskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token function-variable function">distination</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'/xxx/xxx'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>fieldname <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="MemoryStorage_589"></a>MemoryStorage</h6> 
<p><code>MemoryStorage</code> 为内层存储引擎(将内容存储在<strong>Buffer</strong>中)</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">memoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>注意：</code>当使用内层存储，上传文件非常大，或上传文件非常多时，可能会导致内层溢出。</p> 
<h6><a id="_597"></a>方法</h6> 
<p><strong>multer.single(fieldname)</strong><br> <code>multer.signle()</code>接受一个以<strong>filename</strong>命名的文件，文件保存至<strong>request.file</strong>中<br> <strong>multer.array(fieldname[, maxCount])</strong><br> <code>multer.array()</code> 接受一个以<strong>fieldname</strong>命名的文件数组，可配置<strong>maxCount</strong>来限制上传文件数量，文件保存至<strong>request.files</strong>中<br> <strong>multer.fields(fields)</strong><br> <code>multer.fields()</code>接受<strong>fileds</strong>的混合文件，文件保存至<strong>request.files</strong>中<br> <strong>multer.none()</strong><br> <code>multer.none()</code> 只接受文本域，和<code>multer.fields([])</code>效果一样。若该模式有文件上传，则抛出<strong>LIMIT_UNEXPECTED_FILE</strong><br> <strong>multer.any()</strong><br> <code>multer.any()</code> 接受一切上传的文件。文件保存至<strong>request.files</strong>中</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span>

<span class="token comment">// 存储设置</span>
<span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">DiskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token function-variable function">distination</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cp</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">cp</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'/xxx/xx'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cp</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">storage</span><span class="token operator">:</span>storage<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload/photo'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.file 是 `avatar` 文件的信息</span>
  <span class="token comment">// req.body 将具有文本域数据，如果存在的话</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload/file'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.files 是 `file` 文件组的信息</span>
  <span class="token comment">// req.body 将具有文本域数据，如果存在的话</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'avatar'</span><span class="token punctuation">,</span> <span class="token literal-property property">maxCount</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token literal-property property">maxCount</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// req.files 是一个对象 (String -&gt; Array) 键是文件名，值是文件数组</span>
  <span class="token comment">// 	req.files['avatar'][0] -&gt; File</span>
  <span class="token comment">//    req.files['file'] -&gt; Array</span>
  <span class="token comment">// req.body 将具有文本域数据，如果存在的话</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_639"></a>文件属性</h6> 
<table><thead><tr><th align="left">属性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>fieldname</code></td><td align="left">表单定义的名称</td></tr><tr><td align="left"><code>originalname</code></td><td align="left">文件原始名称</td></tr><tr><td align="left"><code>encoding</code></td><td align="left">文件编码</td></tr><tr><td align="left"><code>mimetype</code></td><td align="left">文件的 MIME 类型</td></tr><tr><td align="left"><code>size</code></td><td align="left">文件大小</td></tr><tr><td align="left"><code>distination</code></td><td align="left">文件保存路径</td></tr><tr><td align="left"><code>filename</code></td><td align="left">保存至 <strong>distination</strong> 中的文件名</td></tr><tr><td align="left"><code>path</code></td><td align="left">已上传文件的完整路径</td></tr><tr><td align="left"><code>buffer</code></td><td align="left">存放整个文件的 <strong>Buffer</strong></td></tr></tbody></table> 
<h4><a id="_651"></a>自定义中间件</h4> 
<p><strong>自定义中间件流程：</strong></p> 
<ol><li>定义中间件</li><li>监听<strong>request</strong>对象的 <strong>data</strong> 事件</li><li>监听 <strong>request</strong> 对象的 <strong>end</strong> 事件</li><li>解析请求参数</li><li>封装模块</li></ol> 
<p><strong>自定义中间件解析POST提交的数据</strong></p> 
<pre><code class="prism language-javascript"><span class="token comment">// querything 是 Node.js的内置模块</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querything'</span><span class="token punctuation">)</span>

<span class="token comment">// 定义中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">bodyParser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>

	<span class="token comment">// 监听 req 的 data 事件</span>
	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		str <span class="token operator">+=</span> chunk
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 解析数据，并将数据放在 req 的 body 中，供下游访问</span>
		req<span class="token punctuation">.</span>body <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
		<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> bodyParser
</code></pre> 
<h3><a id="_682"></a>模板</h3> 
<p><code>Express</code>模板是用于渲染视图的文件，可以包含<strong>HTML</strong>、<strong>CSS</strong>、<strong>JavaScript</strong>等内容，用于构建 <strong>Web</strong>应用程序的图形界面。<br> 使用<code>Express</code>模板可以快速、方便地创建Web应用程序，并可轻松地将动态数据注入到模板中，以便呈现动态效果。常见的模版引擎有：<a href="https://ejs.bootcss.com" rel="nofollow">EJS</a>、<a href="https://pugjs.org" rel="nofollow">Pug</a>、<a href="https://handlebarsjs.com/" rel="nofollow">Handlebars </a>等。</p> 
<h4><a id="_686"></a>分类</h4> 
<p><code>Express</code>模板可分<strong>静态模板</strong>和<strong>动态模板</strong>两类：</p> 
<ol><li><strong>静态模板</strong> 预先定义好的 HTML 文件，可通过路由直接呈现</li><li><strong>动态模板</strong> 通过模版引擎加载动态数据来生成动态内容</li></ol> 
<p><code>Express</code>中常用的模板引擎：</p> 
<ul><li>基于<code>HTML</code>的模版引擎：<strong>Mustache</strong>、<strong>Handlebars</strong></li><li>基于<code>JavaScript</code>的模版引擎：<strong>EJS</strong>、<strong>Underscore.js</strong></li><li>基于<code>CSS</code>的模版引擎：<strong>LESS</strong>、<strong>SASS</strong></li></ul> 
<h4><a id="_695"></a>使用</h4> 
<p><strong>模版使用步骤</strong></p> 
<ol><li>下载模板包</li><li>配置模版引擎 <code>app.set("view engine", "xxx")</code></li><li>配置模板路径 <code>app.set("views", path.resolve(__dirname, "views"))</code> (表示模板存放在当前目录下views文件夹中)</li><li>在请求响应中设置渲染 <code>res.render('xx'，renderDataObj)</code></li></ol> 
<h3><a id="expressgenerator_702"></a>express-generator</h3> 
<p><code>express-generator</code> 是 快速创建 <strong>express</strong> 项目生成器工具。</p> 
<h4><a id="_704"></a>使用</h4> 
<pre><code class="prism language-bash"><span class="token comment">## 1. 全局安装 express-generator</span>
<span class="token function">npm</span> i <span class="token parameter variable">-g</span> express-generator


<span class="token comment">## 2. 创建项目</span>
<span class="token comment">#### 快速创建 [project_name[ 的项目，并且使用默认的 jade 模板引擎</span>
express <span class="token punctuation">[</span>project_name<span class="token punctuation">]</span>  

<span class="token comment">#### 快速创建 [project_name[ 的项目，并且使用指定的 ejs 模板引擎</span>
express <span class="token punctuation">[</span>project_name<span class="token punctuation">]</span> <span class="token parameter variable">--view</span><span class="token operator">=</span>ejs


<span class="token comment">## 3.进入到项目根目录下执行 npm install</span>
<span class="token function">npm</span> <span class="token function">install</span>

<span class="token comment">## 4. 启动项目</span>
<span class="token comment">#### npm 命令</span>
<span class="token function">npm</span> run start   或   <span class="token function">npm</span> start

<span class="token comment">#### node 命令</span>
<span class="token function">node</span> ./bin/www

<span class="token comment">## 5.访问 express-generator生成的项目服务默认端口为 3000 </span>
</code></pre> 
<h4><a id="_731"></a>项目结构</h4> 
<p><img src="https://images2.imgbox.com/c6/4d/xkjsjEwm_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/071ff084919ee22d251d79fadf570037/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python-docx 深入word源码 自定义带有序号的段落中的序号字体样式设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5b03657a04efeba53e4fb058a6c74ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JavaWeb学习笔记】16 - JSon和Ajax</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>