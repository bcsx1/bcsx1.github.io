<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>4.1 媒资管理模块 - Nacos与Gateway搭建 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="4.1 媒资管理模块 - Nacos与Gateway搭建" />
<meta property="og:description" content="文章目录 媒资管理模块 - 媒资项目搭建一、需求分析1.1 介绍1.2 数据模型1.3 分析网关 二、 搭建Nacos2.1 服务发现中心2.2.1 Maven2.2.2 配置Nacos 2.2 配置中心2.2.1 介绍2.2.2 Maven 坐标2.2.3 配置 content-api 工程2.2.4 配置 content-service 工程2.2.5 配置 system-api 工程2.2.6 配置 system-service 工程 2.3 配置中心 - 公用配置2.4 配置中心 - 配置加载优先级2.5 配置中心 - 灵活切换环境2.6 配置中心 - 导入配置 三、 搭建 Gateway 网关3.1 创建xuecheng-plus-gateway网关工程3.2 Maven坐标3.3 bootstrap.yaml配置文件3.4 Nacos配置网关路由策略3.5 测试网关 媒资管理模块 - 媒资项目搭建 一、需求分析 1.1 介绍 媒资管理系统是每个在线教育平台所必须具备的
每个教学机构都可以在媒资系统管理自己的教学资源，包括:视频、教案等文件，目前媒资管理的主要管理对象是视频、图片、文档等，包括:媒资文件的查询、文件上传、视频处理等.
媒资查询:教学机构查询自己所拥有的媒资信息
文件上传:包括上传图片、上传文档、上传视频
比如说内容管理中课程编辑和新增时需要添加课程封面图片
视频处理:视频上传成功，系统自动对视频进行编码处理
假如我们上传了一个avi格式的视频，这个视频在浏览器上是无法播放的需要进行转码，比如说转成Mp4格式
文件删除:教学机构删除自己上传的媒资文件
1.2 数据模型 mdia_files媒资文件表：存储文件信息，包括图片、视频、文档等，并不是文件本身，真正的文件存储在我们的分布式系统中。
media_process: 待处理视频表。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/5c8d5db32448c72763c957a062089c7b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-23T20:46:43+08:00" />
<meta property="article:modified_time" content="2023-12-23T20:46:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">4.1 媒资管理模块 - Nacos与Gateway搭建</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#___1" rel="nofollow">媒资管理模块 - 媒资项目搭建</a></li><li><a href="#_3" rel="nofollow">一、需求分析</a></li><li><ul><li><a href="#11__5" rel="nofollow">1.1 介绍</a></li><li><a href="#12__29" rel="nofollow">1.2 数据模型</a></li><li><a href="#13__55" rel="nofollow">1.3 分析网关</a></li></ul> 
  </li><li><a href="#_Nacos_119" rel="nofollow">二、 搭建Nacos</a></li><li><ul><li><a href="#21__141" rel="nofollow">2.1 服务发现中心</a></li><li><ul><li><a href="#221_Maven_151" rel="nofollow">2.2.1 Maven</a></li><li><a href="#222_Nacos_186" rel="nofollow">2.2.2 配置Nacos</a></li></ul> 
   </li><li><a href="#22__232" rel="nofollow">2.2 配置中心</a></li><li><ul><li><a href="#221__234" rel="nofollow">2.2.1 介绍</a></li><li><a href="#222_Maven__328" rel="nofollow">2.2.2 Maven 坐标</a></li><li><a href="#223__contentapi__338" rel="nofollow">2.2.3 配置 content-api 工程</a></li><li><a href="#224__contentservice__414" rel="nofollow">2.2.4 配置 content-service 工程</a></li><li><a href="#225__systemapi__557" rel="nofollow">2.2.5 配置 system-api 工程</a></li><li><a href="#226__systemservice__639" rel="nofollow">2.2.6 配置 system-service 工程</a></li></ul> 
   </li><li><a href="#23____692" rel="nofollow">2.3 配置中心 - 公用配置</a></li><li><a href="#24____760" rel="nofollow">2.4 配置中心 - 配置加载优先级</a></li><li><a href="#25____908" rel="nofollow">2.5 配置中心 - 灵活切换环境</a></li><li><a href="#26____920" rel="nofollow">2.6 配置中心 - 导入配置</a></li></ul> 
  </li><li><a href="#__Gateway__938" rel="nofollow">三、 搭建 Gateway 网关</a></li><li><ul><li><a href="#31_xuechengplusgateway_948" rel="nofollow">3.1 创建xuecheng-plus-gateway网关工程</a></li><li><a href="#32_Maven_954" rel="nofollow">3.2 Maven坐标</a></li><li><a href="#33_bootstrapyaml_1013" rel="nofollow">3.3 bootstrap.yaml配置文件</a></li><li><a href="#34_Nacos_1042" rel="nofollow">3.4 Nacos配置网关路由策略</a></li><li><a href="#35__1080" rel="nofollow">3.5 测试网关</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="___1"></a>媒资管理模块 - 媒资项目搭建</h2> 
<h2><a id="_3"></a>一、需求分析</h2> 
<h3><a id="11__5"></a>1.1 介绍</h3> 
<p>媒资管理系统是每个在线教育平台所必须具备的</p> 
<p>每个教学机构都可以在媒资系统管理自己的教学资源，包括:视频、教案等文件，<strong>目前媒资管理的主要管理对象是视频、图片、文档等，包括:媒资文件的查询、文件上传、视频处理等</strong>.</p> 
<p><strong>媒资查询:教学机构查询自己所拥有的媒资信息</strong></p> 
<p><strong>文件上传:包括上传图片、上传文档、上传视频</strong></p> 
<p>比如说内容管理中课程编辑和新增时需要添加课程封面图片</p> 
<p><img src="https://images2.imgbox.com/70/8e/I3gFB9ES_o.png" alt="image-20231217014015595"></p> 
<p><strong>视频处理:视频上传成功，系统自动对视频进行编码处理</strong></p> 
<p>假如我们上传了一个avi格式的视频，这个视频在浏览器上是无法播放的需要进行转码，比如说转成Mp4格式</p> 
<p><strong>文件删除:教学机构删除自己上传的媒资文件</strong></p> 
<p><img src="https://images2.imgbox.com/cf/9f/VPQjn9dv_o.png" alt="image-20231217012246722"></p> 
<h3><a id="12__29"></a>1.2 数据模型</h3> 
<p><img src="https://images2.imgbox.com/ef/79/CzgC2JkL_o.png" alt="image-20231217015244539"></p> 
<p><strong>mdia_files媒资文件表</strong>：存储文件信息，包括图片、视频、文档等，并不是文件本身，真正的文件存储在我们的分布式系统中。</p> 
<p><strong>media_process</strong>: 待处理视频表。</p> 
<p><strong>media_process_history</strong>: 视频处理历史表，记录已经处理成功的视频信息。</p> 
<hr> 
<p><strong>视频处理完成之后要绑定课程计划</strong></p> 
<p>媒资文件与课程计划绑定关系表如下：</p> 
<p>课程计划表teachplan</p> 
<p>课程计划与媒资关系teachplan_media，主要是操作这张表，将媒资与课程计划进行绑定</p> 
<p><img src="https://images2.imgbox.com/32/d7/ZWylRP8G_o.png" alt="image-20231217015322727"></p> 
<h3><a id="13__55"></a>1.3 分析网关</h3> 
<p>目前我们有三个服务，如下所示：</p> 
<p><strong>内容管理服务</strong>：管理课程信息</p> 
<p><strong>系统管理服务</strong>：目前引入了数据字典，不会有业务的东西，是一些系统本身的内容，比如日志、系统备份、数据字典</p> 
<p>媒资管理服务：管理课程相关视频、文档等文件</p> 
<p><img src="https://images2.imgbox.com/fd/44/YDobmMW4_o.png" alt="image-20231217200252172"></p> 
<p><strong>但是像上图那样，前端直接请求后端的服务会有一定的弊端</strong></p> 
<p>在前端对每个请求地址都配置绝对路径，非常不利于系统维护，假如后端的端口或者IP改变后，前端的每个请求地址都需要改变，这是非常不方便的</p> 
<blockquote> 
 <p>下图所示便是绝对路径，假如我们放到服务器上后，localhost显然是不合适的，那就设置成一个局域网的ip了</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ab/ef/sKpCqzPF_o.png" alt="image-20231217200932337"></p> 
<p>基于这个问题可以<strong>采用网关来解决这个麻烦</strong></p> 
<blockquote> 
 <p>之前我也学过网关：</p> 
 <p><a href="https://blog.csdn.net/weixin_51351637/article/details/129351785">SpringCloud - Gateway统一网关</a></p> 
</blockquote> 
<blockquote> 
 <p><strong>网关的作用其实就是路由</strong>，我们请求到网关，网关会把请求分配到相应的后端服务上</p> 
 <p>之前前端是和多个后端服务进行通信，但是现在不需要了，只需要请求网关就好了</p> 
</blockquote> 
<p><strong>总的来说，前端和网关对接，网关和后端的多个服务对接</strong></p> 
<p><img src="https://images2.imgbox.com/11/e1/OiFY3Xep_o.png" alt="image-20231217200917167"></p> 
<p>此时前端的路径变成下图所示，<strong>只需要指定每个接口的相对路径</strong></p> 
<p><strong>在前端代码的一个固定的地方在接口地址前统一加网关的地址，每个请求统一到网关，由网关将请求转发到具体的微服务</strong></p> 
<p><img src="https://images2.imgbox.com/f3/f3/DsF07ePP_o.png" alt="image-20231217201001640"></p> 
<hr> 
<p><strong>为什么所有的请求先到网关呢</strong>？</p> 
<p>有了网关就可以对请求进行路由，路由到具体的微服务，减少外界对接微服务的成本。</p> 
<p>路由可以根据请求路径进行路由、根据host地址进行路由等， 当微服务有多个实例时可以通过负载均衡算法进行路由，</p> 
<p>另外，网关还可以实现权限控制、限流等功能</p> 
<hr> 
<p><strong>网关是怎么知道微服务的IP地址呢</strong>？</p> 
<p>我们可以将服务的信息记录在Nacos上面，网关可以进行读取</p> 
<p><img src="https://images2.imgbox.com/65/93/BbwEu100_o.png" alt="image-20231217203220089"></p> 
<h2><a id="_Nacos_119"></a>二、 搭建Nacos</h2> 
<blockquote> 
 <p>之前做的Nacos笔记</p> 
 <p><a href="https://blog.csdn.net/weixin_51351637/category_12203379.html">Nacos知识大全</a></p> 
</blockquote> 
<p><strong>Spring Cloud</strong> ：一套规范</p> 
<p><strong>Spring Cloud alibaba</strong>: 这一套实现中就有nacos服务注册中心，配置中心</p> 
<blockquote> 
 <p>namespace和group的概念在上面的文章中有</p> 
</blockquote> 
<p><strong>namespace</strong>：用于区分环境、比如：开发环境、测试环境、生产环境。</p> 
<p><strong>group</strong>：用于区分项目，比如：xuecheng-plus项目、xuecheng2.0项目</p> 
<p>访问：http://192.168.101.65:8848/nacos/</p> 
<p>账号密码：nacos/nacos</p> 
<p><img src="https://images2.imgbox.com/38/d8/LifAtfKw_o.png" alt="image-20231217204505598"></p> 
<h3><a id="21__141"></a>2.1 服务发现中心</h3> 
<blockquote> 
 <p>也就是服务注册中心</p> 
</blockquote> 
<p>下面是创建的命名空间namespace</p> 
<p><img src="https://images2.imgbox.com/98/ab/fjPp1VjA_o.png" alt="image-20231217204942094"></p> 
<p><strong>注册完成命名空间namespace之后我们要把微服务注册到nacos，并且每个服务都是一个group</strong></p> 
<h4><a id="221_Maven_151"></a>2.2.1 Maven</h4> 
<ul><li><strong>xuecheng-plus-parent</strong></li></ul> 
<blockquote> 
 <p>这是所有工程的父工程</p> 
</blockquote> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6d/9c/biZvQtbW_o.png" alt="image-20231217205646424"></p> 
<ul><li><strong>上报服务信息</strong></li></ul> 
<p><strong>在内容管理模块的接口工程、系统管理模块的接口工程中添加如下依赖</strong></p> 
<p>如果是上报服务信息，就是用下面这个坐标</p> 
<blockquote> 
 <p>哪个模块需要上报服务，就写在哪里，假如说service模块需要上报服务，那service模块的pom就需要引入下面的坐标</p> 
</blockquote> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/20/2ueiXVIJ_o.png" alt="image-20231217211224421"></p> 
<h4><a id="222_Nacos_186"></a>2.2.2 配置Nacos</h4> 
<p>既然我们的服务需要向Nacos报服务信息，那怎么将信息报告到Nacos呢？</p> 
<p>我们也需要配置一下Nacos的地址，说明我们要向哪上报服务信息</p> 
<p><strong>在系统管理的接口工程的配置文件中配置如下信息</strong></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
</code></pre> 
<p><strong>在内容管理的接口工程的配置文件中配置如下信息</strong></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
</code></pre> 
<p><strong>当启动项目后，查看Nacos</strong></p> 
<p><img src="https://images2.imgbox.com/47/df/fogBCvf6_o.png" alt="image-20231217213430604"></p> 
<p>并且点击“详情”，还可以查看IP和端口</p> 
<p><img src="https://images2.imgbox.com/11/bc/RC8zU8Pj_o.png" alt="image-20231217213939392"></p> 
<h3><a id="22__232"></a>2.2 配置中心</h3> 
<h4><a id="221__234"></a>2.2.1 介绍</h4> 
<p><strong>实现配置中心的最终目标</strong>：将项目中的配置信息放入到Nacos上，不重启项目就可以修改服务的各种配置信息</p> 
<p><strong>对微服务中公有的配置信息和特有的配置信息进行分别配置</strong></p> 
<p><strong>将项目中的配置文件分类</strong></p> 
<ul><li> <p><strong>每个项目特有的配置</strong></p> <p>是指该配置只在有些项目中需要配置，或者该配置在每个项目中配置的值不同</p> 
  <blockquote> 
   <p>比如：spring.application.name每个项目都需要配置但值不一样，以及有些项目需要连接数据库而有些项目不需要，有些项目需要配置消息队列而有些项目不需要</p> 
   <p>下面的配置每个服务可能是不同的</p> 
  </blockquote> <pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /system
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63110</span>  
<span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>api    
</code></pre> </li><li> <p><strong>项目所公用的配置</strong></p> <p>是指在若干项目中配置内容相同的配置。</p> 
  <blockquote> 
   <p>比如：redis的配置，很多项目用的同一套redis服务所以配置也一样</p> 
  </blockquote> <pre><code class="prism language-yaml"><span class="token comment"># 日志文件配置路径</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml

<span class="token comment"># swagger 文档配置</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"学成在线系统管理"</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"系统管理接口"</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.system
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.0
</code></pre> </li></ul> 
<p><strong>Nacos是如何定位一个具体的配置文件的</strong>？</p> 
<p><strong>namespace、group、dataid</strong></p> 
<p><img src="https://images2.imgbox.com/fc/c9/1nzqkWTs_o.png" alt="image-20231217220931783"></p> 
<ul><li> <p><strong>通过namespace、group找到具体的环境和具体的项目</strong></p> </li><li> <p><strong>通过dataid找到具体的配置文件</strong></p> <p><strong>dataid有三部分组成</strong>，content-api-dev.yaml配置文件 由（content-api）-（dev）. (yaml)三部分组成</p> <p><strong>第一部分</strong>，它是在application.yaml中配置的<strong>应用名</strong>，即spring.application.name的值</p> <p><strong>第二部分</strong>，它是<strong>环境名</strong>，通过spring.profiles.active指定</p> <p><strong>第三部分</strong>，它是<strong>配置文件的后缀</strong>，目前nacos支持properties、yaml等格式类型，本项目选择yaml格式类型</p> 
  <blockquote> 
   <p>如果我们要配置content-api工程的配置文件:</p> 
   <p>在开发环境中配置content-api-dev.yaml</p> 
   <p>在测试环境中配置content-api-test.yaml</p> 
   <p>在生产环境中配置content-api-prod.yaml</p> 
   <p>我们启动项目中传入spring.profiles.active的参数决定引用哪个环境的配置文件，例如：传入spring.profiles.active=dev表示使用dev环境的配置文件即content-service-dev.yaml</p> 
  </blockquote> </li></ul> 
<pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 1.服务名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 2.配置环境名</span>
</code></pre> 
<h4><a id="222_Maven__328"></a>2.2.2 Maven 坐标</h4> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="223__contentapi__338"></a>2.2.3 配置 content-api 工程</h4> 
<blockquote> 
 <p>将Maven坐标导入到content-api工程中的pom文件里</p> 
</blockquote> 
<p>在Nacos中我们可以点击右侧的“+”来添加一个配置</p> 
<p><img src="https://images2.imgbox.com/f9/b5/5EN8kvHo_o.png" alt="image-20231217222358541"></p> 
<p><strong>配置如下图所示</strong></p> 
<p><img src="https://images2.imgbox.com/87/86/xqV9y6lG_o.png" alt="image-20231217223133064"></p> 
<p><strong>目前content-api项目bootstrap.yml文件的配置如下</strong></p> 
<p>我们发现dataid的三要素并没有被提取出来，还是在文件中放着</p> 
<blockquote> 
 <p>被注释掉的就是目前被提取出来的内容</p> 
</blockquote> 
<pre><code class="prism language-yaml"><span class="token comment">#server:</span>
<span class="token comment">#  servlet:</span>
<span class="token comment">#    context-path: /content</span>
<span class="token comment">#  port: 63040</span>
<span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment">#1.服务名 </span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span> <span class="token comment">#服务发现（注册）配置</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment">#服务注册配置</span>
         <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment"># 命名空间</span>
         <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment"># 组</span>
         <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment"># 3.文件扩展名</span>
         <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 当将 refresh 设置为 true 时，应用程序会定期从Nacos服务器获取配置并刷新已加载的配置</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 2.环境名</span>
<span class="token comment">#  datasource:</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#    url: jdbc:mysql://192.168.101.65:3306/xcplus_content?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false&amp;</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: mysql</span>
<span class="token comment"># 日志文件配置路径</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml

<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"学成在线内容管理系统"</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"内容系统管理系统对课程相关信息进行管理"</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.content
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'1.0.0'</span>
</code></pre> 
<p><strong>此时就可以启动content-api项目，一切正常</strong></p> 
<p>其中这个项目所需要的Nacos坐标</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--服务发现--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="224__contentservice__414"></a>2.2.4 配置 content-service 工程</h4> 
<p>其实在content-api工程bootstrap.yaml配置文件中不需要配置数据库的信息，因为content-api工程并不会访问数据库</p> 
<blockquote> 
 <p>之前在content-api工程配置文件配置数据库的信息是因为content-api工程会引用content-service工程，进而操作的数据库</p> 
</blockquote> 
<p>真正访问数据库的工程是content-api，所以其实也可以将数据库的配置信息配置在content-service</p> 
<p><strong>所以下面将修改content-service工程与content-api工程的配置文件</strong></p> 
<ul><li> <p><strong>修改content-api工程的配置文件</strong></p> <p>删除Nacos中数据库连接的配置</p> <p><img src="https://images2.imgbox.com/e3/de/VwTpvdLl_o.png" alt="image-20231218001325187"></p> <p>在content-api工程配置文件中引用(扩展)content-service工程的配置文件</p> </li></ul> 
<blockquote> 
 <p><strong>为什么是扩展的配置文件</strong>？</p> 
 <p>除了特有的配置、公用配置，还有扩展的配置</p> 
 <p>content-api工程运行的时候需要引入content-service工程，但是content-api功能从Nacos拿到的仅仅是自己特有的</p> 
 <p>所以需要将content-service工程在Nacos的配置文件引过来（也就是扩展一下）</p> 
</blockquote> 
<p>下面的配置新增了extension-configs项，也就是指定扩展配置文件</p> 
<pre><code class="prism language-yaml"><span class="token comment">#server:</span>
<span class="token comment">#  servlet:</span>
<span class="token comment">#    context-path: /content</span>
<span class="token comment">#  port: 63040</span>
<span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 项目名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos地址</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span> <span class="token comment">#服务发现（服务注册）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment">#组别</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment"># 配置中心</span>
         <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
         <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
         <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
         <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
         <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span> <span class="token comment"># 扩展配置信息的引用</span>
           <span class="token comment">#${spring.profiles.active} 这个写法就会找到此文件中spring.profiles.active对应的值</span>
           <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
             <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
             <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
<span class="token comment">#  datasource:</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#    url: jdbc:mysql://192.168.101.65:3306/xcplus_content?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false&amp;</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: mysql</span>
<span class="token comment"># 日志文件配置路径</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml

<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"学成在线内容管理系统"</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"内容系统管理系统对课程相关信息进行管理"</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.content
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'1.0.0'</span>
</code></pre> 
<ul><li> <p><strong>修改content-service工程的配置文件</strong></p> <p>此工程不需要将服务进行上报，所以只需要一个服务注册的坐标即可</p> </li></ul> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>此时bootstrap.yaml中的配置，注释掉的datasource信息将会配置在Nacos中</p> 
<pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service <span class="token comment"># 服务名</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 运行环境  </span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment">#服务配置相关信息</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment"># 命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment">#组</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment">#  datasource:</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#    url: jdbc:mysql://192.168.101.65:3306/xcplus_content?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false&amp;</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: mysql</span>

<span class="token comment"># 日志文件配置路径</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"学成在线内容管理系统"</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"内容系统管理系统对课程相关信息进行管理"</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.content
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'1.0.0'</span>
</code></pre> 
<p><strong>Nacos中配置信息</strong></p> 
<p><img src="https://images2.imgbox.com/94/f6/hCU5AX39_o.png" alt="image-20231217233857995"></p> 
<p>然后可以在测试类中测试一下，是正常的</p> 
<p><img src="https://images2.imgbox.com/70/33/Kv7qZXno_o.png" alt="image-20231217235824759"></p> 
<hr> 
<p>content-service项目中需要的nacos坐标</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>都配置完成后重启content-api项目，看是否启动成功，如果成功了说明配置也是成功的</p> 
<h4><a id="225__systemapi__557"></a>2.2.5 配置 system-api 工程</h4> 
<ul><li><strong>bootstrap.yaml配置文件</strong></li></ul> 
<pre><code class="prism language-yaml"><span class="token comment">#server:</span>
<span class="token comment">#  servlet:</span>
<span class="token comment">#    context-path: /system</span>
<span class="token comment">#  port: 63110</span>
<span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment"># 配置中心 </span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 当将 refresh 设置为 true 时，应用程序会定期从Nacos服务器获取配置并刷新已加载的配置</span>
        <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span> <span class="token comment"># 扩展配置信息的引用</span>
        <span class="token comment">#${spring.profiles.active} 这个写法就会找到此文件中spring.profiles.active对应的值</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> <span class="token comment">#公用配置</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> swagger<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
<span class="token comment">#  datasource:</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#    url: jdbc:mysql://192.168.101.65:3306/xcplus_system?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false&amp;</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: mysql</span>
<span class="token comment"># 日志文件配置路径</span>
<span class="token comment">#logging:</span>
<span class="token comment">#  config: classpath:log4j2-dev.xml</span>
<span class="token comment">#</span>
<span class="token comment">## swagger 文档配置</span>
<span class="token comment">#swagger:</span>
<span class="token comment">#  title: "学成在线系统管理"</span>
<span class="token comment">#  description: "系统管理接口"</span>
<span class="token comment">#  base-package: com.xuecheng.system</span>
<span class="token comment">#  enabled: true</span>
<span class="token comment">#  version: 1.0.0</span>
</code></pre> 
<ul><li><strong>Nacos中配置</strong></li></ul> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /system
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63110</span>
</code></pre> 
<ul><li><strong>Maven坐标</strong></li></ul> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--服务发现--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="226__systemservice__639"></a>2.2.6 配置 system-service 工程</h4> 
<ul><li><strong>bootstrap.yaml配置文件</strong></li></ul> 
<pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>service <span class="token comment"># 服务名</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 运行环境  </span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos地址</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment">#服务配置相关信息</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment"># 命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment">#组</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment">#  datasource:</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>
<span class="token comment">#    url: jdbc:mysql://192.168.101.65:3306/xcplus_content?serverTimezone=UTC&amp;userUnicode=true&amp;useSSL=false&amp;</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: mysql</span>
</code></pre> 
<ul><li><strong>Nacos配置</strong></li></ul> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.101.65<span class="token punctuation">:</span>3306/xcplus_system<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;userUnicode=true&amp;useSSL=false&amp;</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> mysql
</code></pre> 
<ul><li><strong>Maven坐标</strong></li></ul> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--服务注册--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="23____692"></a>2.3 配置中心 - 公用配置</h3> 
<p><strong>nacos提供了shared-configs可以引入公用配置</strong></p> 
<p>每个工程的bootstrap.yaml文件中都会有下面内容，随意我们可以配置一个公用配置</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>log4j2<span class="token punctuation">-</span>dev.xml

<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"学成在线内容管理系统"</span>
  <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"内容系统管理系统对课程相关信息进行管理"</span>
  <span class="token key atrule">base-package</span><span class="token punctuation">:</span> com.xuecheng.content
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'1.0.0'</span>
</code></pre> 
<p>单独在<strong>xuecheng-plus-common分组</strong>下创建xuecheng-plus的公用配置，进入nacos的开发环境，<strong>添加swagger-dev.yaml公用配置</strong></p> 
<p><img src="https://images2.imgbox.com/03/a6/5tjM5DgL_o.png" alt="image-20231218002741929"></p> 
<p><strong>相同的方式添加logging-dev.yaml公用配置</strong></p> 
<p><img src="https://images2.imgbox.com/e2/24/qTjGFIpM_o.png" alt="image-20231218002804244"></p> 
<hr> 
<p>**在content-api工程bootstrap.yaml配置文件中引入swagger-dev.yaml、loggin-dev.yaml公用配置文件 **</p> 
<pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 项目名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos地址</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span> <span class="token comment">#服务发现（服务注册）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment">#组别</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment"># 配置中心</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span> <span class="token comment"># 扩展配置信息的引用</span>
          <span class="token comment">#${spring.profiles.active} 这个写法就会找到此文件中spring.profiles.active对应的值</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> <span class="token comment">#公用配置</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> swagger<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre> 
<p>重新启动content-api工程，打开swagger页面，说明没有什么问题</p> 
<p><img src="https://images2.imgbox.com/84/ff/FYvhAdOU_o.png" alt="image-20231218003720580"></p> 
<h3><a id="24____760"></a>2.4 配置中心 - 配置加载优先级</h3> 
<blockquote> 
 <p>这个地方其实可以看看下面这个文章<a href="https://blog.csdn.net/weixin_51351637/article/details/133376539">Springboot配置文件-多环境开发控制</a></p> 
</blockquote> 
<p><strong>SpringBoot读取配置文件的顺序</strong></p> 
<p><img src="https://images2.imgbox.com/60/d4/AnfsCB4g_o.png" alt="image-20231218004318500"></p> 
<p><strong>引入配置文件的形式有</strong></p> 
<ul><li> <p><strong>以项目应用名方式引入</strong></p> <p>微服务它所对应的自己特有的配置</p> <p>也就是通过过项目名、环境名、文件后缀信息（三要素）从Nacos过去的配置</p> <pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 项目名</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment">#环境</span>
</code></pre> </li><li> <p><strong>以扩展配置文件方式引入</strong></p> <pre><code class="prism language-yaml">      <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span> <span class="token comment"># 扩展配置信息的引用</span>
          <span class="token comment">#${spring.profiles.active} 这个写法就会找到此文件中spring.profiles.active对应的值</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> </li><li> <p><strong>以共享配置文件 方式引入</strong></p> <pre><code class="prism language-yaml"><span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> <span class="token comment">#公用配置</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> swagger<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
    <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
    <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> </li><li> <p><strong>本地配置文件</strong></p> <pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 项目名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#Nacos地址</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span> <span class="token comment">#服务发现（服务注册）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project <span class="token comment">#组别</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment"># 配置中心</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev <span class="token comment">#命名空间</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件后缀</span>
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 当将 refresh 设置为 true 时，应用程序会定期从Nacos服务器获取配置并刷新已加载的配置</span>
        <span class="token key atrule">extension-configs</span><span class="token punctuation">:</span> <span class="token comment"># 扩展配置信息的引用</span>
          <span class="token comment">#${spring.profiles.active} 这个写法就会找到此文件中spring.profiles.active对应的值</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>service<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> <span class="token comment">#公用配置</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> swagger<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre> </li></ul> 
<blockquote> 
 <p>前面三个是在Nacos，最后一个在本地</p> 
</blockquote> 
<p><strong>假如上面方式引入的配置冲突了怎么办，以谁的为准</strong>？</p> 
<p>看下面的优先级</p> 
<p><strong>默认情况各配置文件的优先级</strong>：</p> 
<ul><li><strong>项目应用名配置文件 &gt; 扩展配置文件 &gt; 共享配置文件 &gt; 本地配置文件</strong></li></ul> 
<p><strong>问题，同个项目怎么启动多个</strong>？</p> 
<p>但是"项目应用名配置文件"优先级最高，那我们一个工程怎么运行两个呀，比如说content-api工程在Nacos中配置的运行端口是63040，那我们在本地将端口改成63041，是运行不了的，那我们实际项目部署的时候怎么办呢？</p> 
<p>那肯定会有人想，项目部署最终都会执行 java -jar命令，我们只需要加一个临时参数就好了</p> 
<p><img src="https://images2.imgbox.com/36/f2/4kwaY4gy_o.png" alt="image-20231218005846209"></p> 
<p>这种方法也是不行的，这种也是相当于在本地配置</p> 
<p><strong>那怎么解决这个问题呢</strong>？</p> 
<pre><code class="prism language-yaml">  <span class="token comment">#配置本地优先</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">override-none</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p><strong>在Nacos中配置一下就可以了，配置成本地配置最优先即可</strong></p> 
<p><img src="https://images2.imgbox.com/7d/87/wEMf7hly_o.png" alt="image-20231218010318387"></p> 
<p><strong>假如我们端口号，Nacos 63010、bootstrap.yaml 12321、application.yaml 8065 文件中各有配置，并且已经在Nacos中配置了本地优先策略，那启动项目后会运行哪个端口号呢</strong>？</p> 
<p><img src="https://images2.imgbox.com/b1/ab/g9Dqm6A5_o.png" alt="image-20231218223916504"></p> 
<p><strong>假如去掉Nacos中配置的本地优先策略后，再启动项目，端口号呢</strong>？</p> 
<p>以Nacos中为准</p> 
<p><img src="https://images2.imgbox.com/67/75/8JHcoMmn_o.png" alt="image-20231218224116605"></p> 
<blockquote> 
 <p>bootstrap.yml/bootstrap.properties：这些文件在应用程序的早期就被加载，主要用于系统级的配置，如加密属性的解密、配置服务的设置等。bootstrap文件的加载时机在application文件之前，因此可以说它的优先级更高。（优先级高优先加载，但是会被后加载的内容覆盖）</p> 
 <p>application.yml/application.properties：这些是Spring Boot应用程序的主要配置文件，用于配置应用程序特定的各种属性。它们在bootstrap配置之后加载。（所以application内容会覆盖bootstrap，但是实际上的优先级是bootstrap&gt;application）</p> 
 <p>在加载时，加载的顺序是yml，yaml，properities，所以在加载配置文件时，如果有在配置文件名相同时，以properities结尾的配置文件会生效，因为以properities结尾的文件是最后被加载的，覆盖了之前的相同配置</p> 
</blockquote> 
<p><strong>总结默认加载的优先级</strong>：</p> 
<ul><li> <p><strong>bootstrap &gt; application</strong></p> </li><li> <p><strong>yml &gt; yaml &gt; properities</strong></p> </li></ul> 
<p><strong>假如在Nacos中配置本地文件优先时，配置生效顺序：</strong></p> 
<blockquote> 
 <p>如果配置重复的话，会以左侧为主文件的配置为主</p> 
</blockquote> 
<p><strong>application.properities &gt; application.yaml &gt; application.yml &gt;bootstrap.properities &gt; bootstrap.yaml &gt; bootstrap.yml</strong></p> 
<h3><a id="25____908"></a>2.5 配置中心 - 灵活切换环境</h3> 
<p><strong>可以直接才配置文件中进行修改</strong></p> 
<p><img src="https://images2.imgbox.com/a8/c4/4xuZsq3U_o.png" alt="image-20231218010910974"></p> 
<p><strong>或者是配置临时参数</strong></p> 
<p><img src="https://images2.imgbox.com/ae/0b/VGOeoMBQ_o.png" alt="image-20231218011025732"></p> 
<h3><a id="26____920"></a>2.6 配置中心 - 导入配置</h3> 
<p>点击所选的”导入配置“</p> 
<p><img src="https://images2.imgbox.com/80/35/Cv1Pkc96_o.png" alt="image-20231218011319527"></p> 
<p>假如说导入配置时出现重复的配置，怎么办？</p> 
<p>根据实际情况选择即可，之后点击“上传文件”即可</p> 
<p><img src="https://images2.imgbox.com/51/ff/PC2uN2GN_o.png" alt="image-20231218011442946"></p> 
<p>选择合适的文件zip包即可，不需要自己解压</p> 
<p><img src="https://images2.imgbox.com/a1/02/lxZ5yLVl_o.png" alt="image-20231218011553666"></p> 
<h2><a id="__Gateway__938"></a>三、 搭建 Gateway 网关</h2> 
<p><strong>搭建Spring Cloud Gateway，创建网关工程</strong></p> 
<blockquote> 
 <p><a href="https://blog.csdn.net/weixin_51351637/article/details/129351785">SpringCloud - Gateway统一网关</a></p> 
</blockquote> 
<blockquote> 
 <p>之前搭建了Nacos，现在可以搭建一下Gateway网关</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/66/b1/JzNMPezp_o.png" alt="image-20231218214426690"></p> 
<h3><a id="31_xuechengplusgateway_948"></a>3.1 创建xuecheng-plus-gateway网关工程</h3> 
<p><strong>创建xuecheng-plus-gateway网关工程</strong></p> 
<p><img src="https://images2.imgbox.com/4f/8d/X4lizqKo_o.png" alt="image-20231218220649176"></p> 
<h3><a id="32_Maven_954"></a>3.2 Maven坐标</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.xuecheng<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xuecheng-plus-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">&gt;</span></span>../xuecheng-plus-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>relativePath</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xuecheng-plus-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--网关--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--服务发现中心--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--服务配置中心--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 排除 Spring Boot 依赖的日志包冲突 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Spring Boot 集成 log4j2 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="33_bootstrapyaml_1013"></a>3.3 bootstrap.yaml配置文件</h3> 
<pre><code class="prism language-yaml"><span class="token comment">#微服务配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment">#下面的配置是从Nacos拉取配置文件，并且要将服务上报到nacos</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.101.65<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span> <span class="token comment">#服务发现（服务配置）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
      <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token comment">#服务配置</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
        <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>project
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">refresh-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">data-id</span><span class="token punctuation">:</span> logging<span class="token punctuation">-</span>$<span class="token punctuation">{<!-- --></span>spring.profiles.active<span class="token punctuation">}</span>.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> xuecheng<span class="token punctuation">-</span>plus<span class="token punctuation">-</span>common
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre> 
<h3><a id="34_Nacos_1042"></a>3.4 Nacos配置网关路由策略</h3> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">63010</span> <span class="token comment"># 网关端口</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
<span class="token comment">#      filter:</span>
<span class="token comment">#        strip-prefix:</span>
<span class="token comment">#          enabled: true</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment"># 网关路由配置</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> content<span class="token punctuation">-</span>api <span class="token comment"># 路由id，自定义，只要唯一即可</span>
          <span class="token comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//content<span class="token punctuation">-</span>api <span class="token comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span>
            <span class="token punctuation">-</span> Path=/content/<span class="token important">**</span> <span class="token comment"># 这个是按照路径匹配，只要以/content/开头就符合要求</span>
<span class="token comment">#          filters:</span>
<span class="token comment">#            - StripPrefix=1</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>api
          <span class="token comment"># uri: http://127.0.0.1:8081</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//system<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/system/<span class="token important">**</span>
<span class="token comment">#          filters:</span>
<span class="token comment">#            - StripPrefix=1</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> media<span class="token punctuation">-</span>api
          <span class="token comment"># uri: http://127.0.0.1:8081</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//media<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/media/<span class="token important">**</span>
<span class="token comment">#          filters:</span>
<span class="token comment">#            - StripPrefix=1</span>

</code></pre> 
<h3><a id="35__1080"></a>3.5 测试网关</h3> 
<p>启动xuecheng-plus-gateway工程后，在Nacos发现有服务</p> 
<p><img src="https://images2.imgbox.com/03/ec/xollmSaY_o.png" alt="image-20231218230440022"></p> 
<p>但是并不是我们启动项目之后，Nacos立即拿到服务的，会有30s的空窗期</p> 
<p>假如说我们请求一个服务返回的响应状态码是503的话，很可能是我们请求的项目并没有启动，我们只需要启动对应的项目就好了</p> 
<p><strong>网关工程搭建完成即可将前端工程中的接口地址改为网关的地址</strong><br> 编辑一下“.env”文件<br> 63010是Gateway的端口号，63040是内容管理content模块的端口号<br> <img src="https://images2.imgbox.com/93/a2/70XDhVqt_o.png" alt="image-20231223204209858"></p> 
<p><strong>启动前端工程，查看是否有数据，如果有说明之前所有的配置是没有任何问题的</strong></p> 
<blockquote> 
 <p>相当正常，忐忑的心放下了</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b9/f9/guK8YD6G_o.png" alt="image-20231218233729319"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/59b8bdd7941eac29f1b23ab8dc8445e9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MyBatis的动态SQL</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d67a8d3d8008602c10479d5489493c0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win10如何关闭自动更新,win10关闭自动更新的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>