<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QoS服务质量五QoS边界行为之流量整形 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QoS服务质量五QoS边界行为之流量整形" />
<meta property="og:description" content="QoS服务质量五QoS边界行为之流量整形 3、流量整形3.1、GTS的原理3.2、自适应流量整形3.3流量监管和流量整形应用场景3.4、配置限速(流量监管和流量整形)3.4.1、配置流量整形3.4.2、基于流分类MQC的流量监管3.4.3、自适应流量整形 3、流量整形 流量整形TS（Traffic Shaping）是一种主动调整流量输出速率的措施，其作用是限制流量与突发，使这类报文以比较均匀的速率向外发送。流量整形通常使用缓冲区和令牌桶来完成，当报文的发送速度过快时，首先在缓冲区进行缓存，在令牌桶的控制下，再均匀地发送这些被缓冲的报文。
单速率双色单桶,缺点是上一秒令牌未用完，则下一秒将会被清空；单速率三色双桶，有两个令牌桶。可以有积存机制，解决超发问题；双速率三色双桶，整形红色流量进行缓存，等待下次获得令牌通过，未被丢弃。一般适用于高带宽向低带宽发送数据。
流量整形通常使用缓冲区或队列和令牌桶来完成，当报文的发送速度过快时，首先在缓冲区或队列进行缓存，在令牌桶的控制下，在均匀的发送这些缓存的报文。缓冲区的空间是有限的，如果缓冲区空间不足，则被延迟发送的报文会被丢弃。
流量监管和流量整形的比较：
名称流量监管流量整形流量方向差异应用于端口入方向应用于端口出方向超额流量差异丢弃超额流量或将超额流量重标记为低优先级缓存超额流量内存使用差异不需要额外的内存资源，不会带来延迟和抖动需要缓存超额流量，可能会带来延迟和抖动丢包率的差异丢包可能引发重传较少的丢包，因而较少导致重传重标记的差异可以重标记流量不能重标记双方共同点都是监控网络流量、都是用令牌桶算法评估流量速率、用于网络边缘一样 从上可以看出不同流量监管优点：是不需要内存，延迟小。缺点：丢包率大，抗突发能力弱；流量整形的优点：丢包率小，抗突发能力强，缺点：要内存，延迟高。两种的优点缺点互补。
从上图可以看出流量整形将上游不规整的流量进行削峰填谷，使流量输出比较平稳，从而解决下游设备的拥塞问题。
3.1、GTS的原理 GTS(Generic traffic shaping，通用流量整形)在收到报文后会先进行分类，符合GTS匹配条件的报文由GTS进行整形，不符合匹配条件的报文绕过GTS直接转发。GTS使用的令牌桶技术为单桶单速，只对出接口有作用。
解决下游设备的接口速率小于上游设备的接口速率，从而导致下游设备接口入方向丢包的问题。
GTS处理流程
GTS在收到报文后会先进行分类，使报文进入不同的队列。没有配置队列整形功能的报文绕过GTS直接转发。
符合GTS匹配条件的报文(配置队列整形功能)由GTS进行整形，GTS采用停牌桶技术对各类报文分别进行测量。
对需要流量整形的报文进行测量分为两种情况，一种是令牌桶中令牌数量足够多，也就是来的报文的符合所设置的CIR和CBS，放行此报文。
另一种情况是发送过来的报文不符合所设置的CIR和CBS，也就是令牌桶中令牌数量不足，这时报文被缓存在队列里，等待有足够令牌时再继续发送。
如果该接口和子接口同时配置了接口整形，则系统还要逐级按照子接口整形速率、接口整形速率对报文流进行速率控制。则报文全部进行流量整形。
3.2、自适应流量整形 有些场景下，下游设备的接口速率是不确定的，上游设备无法确定应该把整形参数设置为多少。此时可以配置自适应模板来实现自适应流量整形，通过在上游设备和下游设备间开启NQA检测，根据NQA检测到的下游设备丢包率动态调整整形参数。
NQA(Network Quality Analysis，网络质量分析)，是设备上集成网络检测功能，不仅可以实现对网络运行情况的准确测试，输出统计信息，有效的节约成本。NQA可以检测网络上运行的各种协议的性能，时运营商能够实时采集到各种网络运行指标，例如：HTTP的总时延、TCP连接时延、DNS解析时延、文件传输时延、FTP连接时延、DNS解析错误等等。
NQA把测试两端称为客户端和目的端，并在客户端发起测试，目的端接收报文后，返回给源端相应的回应信息。根据返回的回应信息，就可以了解相应的网络状况。
自适应模板规定了：
NQA测试例：通过此测试例检测下游设备接口入方向丢包率，根据检测结果调整整形参数。整形速率范围：上游设备接口出方向的整形速率上下限，整形速率在此范围内动态调整。整形速率调整步长：动态调整整形速率时，每次调整的速率大小。丢包率范围：下游设备接口入方向允许的丢包率范围。当丢包率在此范围之内时，不调整整形速率；当丢包率过大，减小上游设备整形速率；当丢包率过小，且上游设备发生拥塞，增大上游设备整形速率。整形速率增大的时间间隔：当丢包率在阈值附近频繁变化时，就需要频繁调整整形速率，用户可以通过设置此参数，限制增大整形速率的时间间隔，避免频繁更新。 系统根据NQA检测结果中的丢包率等调整整形速率：
自适应模板在流行为中绑定后，将流行为与流分类在流策略下进行绑定，并在接口下应用流策略，才能使自适应模板中配置的整形参数在该接口下生效。
3.3流量监管和流量整形应用场景 企业网中语音、视频和数据等多种不同的业务，报文从高速链路进入设备，再由低速链路转发出去。可能会因为带宽不足产生拥塞，需要对三种业务提供不同的保证带宽，优先保证语音业务的带宽，其次是视频业务，最后是数据业务，因此可以对不同业务进行不同的流量监督，为语音报文提供最大保证带宽，视频报文次之，数据报文保证带宽最小，从而在网络产生拥塞时，可以保证语音报文优先通过。
流量监管
流量整形
3.4、配置限速(流量监管和流量整形) 配置限速时，需要配置cir cir-value和cbs cbs-value等参数，其中cir cir-value指承诺信息速率，即保证能够通过的平均速率；cbs cbs-value指承诺突发尺寸，即瞬间能够通过的承诺突发流量。例如，用户想要配置限速4Mbit/s，则配置cir-value=4*1024 kbit/s=4096 kbit/s。cbs-value建议配置为cir-value的100–200倍，如果用户没有配置cbs-value，则设备会自动指定其为缺省值。cbs-value缺省为cir-value的125倍。突发流量速率 PIR 的设置，在工程上 PIR 的速率一般定义为 CIR 的 1.5 倍，即PIR=CIRx1.5，过大的 PIR 会导致设备过高的负荷。
3.4.1、配置流量整形 Switch通过接口GE0/0/2与路由器互连，局域网终端发送的语音、视频、数据，这些业务可经由交换机和路由器到达用户。各终端设备与SW2构成的局域网，速率远大于由SW1和R1构成的WAN速率，这种情况下SW1出接口GE0/0/1处容易发生带宽抖动。为减少带宽抖动，为减少抖动进行以下处理：
1、基于接口的流量整形
也叫接口限速 LR（Line rate），限制接口发送的所有报文（包括紧急报文）的总速率，是对整个出接口进行流量整形，不区分优先级。LR使用的令牌技术为单通单速，不允许突发流量的通过。
缺点：不能基于业务区别对待。
在SW1入口上配置限速，进入的速率限制在20000kbit/s。在SW2上配置端口整形，将端口出口速率限制在20000kbit/s。lr针对于接口下的所有流量。LR使用单速单桶。
[SW1]interface g0/0/1 [SW1-GigabitEthernet0/0/1]qos lr inbound cir 20000 cbs 2000000 //配置入方向的接口限速速率为20000kbit/s，CBS大小为2000000bit。 [SW2]interface g0/0/1 [SW2-GigabitEthernet0/0/1]qos gts cir 20000 //配置接口的发送数据的速率为20Mbps/s,对接口配置流量整形。 cbs是整形模型中使用的令牌桶的大小，cbs不是越大越好，越大则流量波动就越大：反之，流量波动就较小，但cbs一定要大于1500。cbs-value缺省为cir-value的125倍。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/57c35ca9c07bc1d822ceadcbfe7f66bd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T13:24:30+08:00" />
<meta property="article:modified_time" content="2023-03-17T13:24:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QoS服务质量五QoS边界行为之流量整形</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>QoS服务质量五QoS边界行为之流量整形</h4> 
 <ul><li><a href="#3_1" rel="nofollow">3、流量整形</a></li><li><a href="#31GTS_25" rel="nofollow">3.1、GTS的原理</a></li><li><a href="#32_44" rel="nofollow">3.2、自适应流量整形</a></li><li><a href="#33_62" rel="nofollow">3.3流量监管和流量整形应用场景</a></li><li><a href="#34_70" rel="nofollow">3.4、配置限速(流量监管和流量整形)</a></li><li><a href="#341_72" rel="nofollow">3.4.1、配置流量整形</a></li><li><a href="#342MQC_122" rel="nofollow">3.4.2、基于流分类MQC的流量监管</a></li><li><a href="#343_217" rel="nofollow">3.4.3、自适应流量整形</a></li></ul> 
</div> 
<p></p> 
<h2><a id="3_1"></a>3、流量整形</h2> 
<p>流量整形TS（Traffic Shaping）是一种主动调整流量输出速率的措施，其作用是限制流量与突发，使这类报文以比较均匀的速率向外发送。流量整形通常使用缓冲区和令牌桶来完成，当报文的发送速度过快时，首先在缓冲区进行缓存，在令牌桶的控制下，再均匀地发送这些被缓冲的报文。</p> 
<p>单速率双色单桶,缺点是上一秒令牌未用完，则下一秒将会被清空；单速率三色双桶，有两个令牌桶。可以有积存机制，解决超发问题；双速率三色双桶，整形红色流量进行缓存，等待下次获得令牌通过，未被丢弃。一般适用于高带宽向低带宽发送数据。</p> 
<p>流量整形通常使用<strong>缓冲区</strong>或队列和令牌桶来完成，当报文的发送速度过快时，首先在缓冲区或队列进行缓存，在令牌桶的控制下，在均匀的发送这些缓存的报文。缓冲区的空间是有限的，如果缓冲区空间不足，则被延迟发送的报文会被丢弃。</p> 
<p>流量监管和流量整形的比较：</p> 
<table><thead><tr><th align="left">名称</th><th align="left">流量监管</th><th align="left">流量整形</th></tr></thead><tbody><tr><td align="left">流量方向差异</td><td align="left">应用于端口入方向</td><td align="left">应用于端口出方向</td></tr><tr><td align="left">超额流量差异</td><td align="left">丢弃超额流量或将超额流量重标记为低优先级</td><td align="left">缓存超额流量</td></tr><tr><td align="left">内存使用差异</td><td align="left">不需要额外的内存资源，不会带来延迟和抖动</td><td align="left">需要缓存超额流量，可能会带来延迟和抖动</td></tr><tr><td align="left">丢包率的差异</td><td align="left">丢包可能引发重传</td><td align="left">较少的丢包，因而较少导致重传</td></tr><tr><td align="left">重标记的差异</td><td align="left">可以重标记流量</td><td align="left">不能重标记</td></tr><tr><td align="left">双方共同点</td><td align="left">都是监控网络流量、都是用令牌桶算法评估流量速率、用于网络边缘</td><td align="left">一样</td></tr></tbody></table> 
<p>从上可以看出不同流量监管优点：是不需要内存，延迟小。缺点：丢包率大，抗突发能力弱；流量整形的优点：丢包率小，抗突发能力强，缺点：要内存，延迟高。两种的优点缺点互补。</p> 
<p><img src="https://images2.imgbox.com/3e/37/4Gag5Yij_o.png" alt="在这里插入图片描述"><br> 从上图可以看出流量整形将上游不规整的流量进行削峰填谷，使流量输出比较平稳，从而解决下游设备的拥塞问题。</p> 
<h2><a id="31GTS_25"></a>3.1、GTS的原理</h2> 
<p>GTS(Generic traffic shaping，通用流量整形)在收到报文后会先进行分类，符合GTS匹配条件的报文由GTS进行整形，不符合匹配条件的报文绕过GTS直接转发。GTS使用的令牌桶技术为<strong>单桶单速</strong>，只对出接口有作用。</p> 
<p>解决下游设备的接口速率小于上游设备的接口速率，从而导致下游设备接口入方向丢包的问题。</p> 
<p>GTS处理流程<br> <img src="https://images2.imgbox.com/08/69/v2GyZLPE_o.png" alt="GTS处理流程"></p> 
<p>GTS在收到报文后会先进行分类，使报文进入不同的队列。没有配置队列整形功能的报文绕过GTS直接转发。</p> 
<p>符合GTS匹配条件的报文(配置队列整形功能)由GTS进行整形，GTS采用停牌桶技术对各类报文分别进行测量。</p> 
<p>对需要流量整形的报文进行测量分为两种情况，一种是令牌桶中令牌数量足够多，也就是来的报文的符合所设置的CIR和CBS，放行此报文。</p> 
<p>另一种情况是发送过来的报文不符合所设置的CIR和CBS，也就是令牌桶中令牌数量不足，这时报文被缓存在队列里，等待有足够令牌时再继续发送。</p> 
<p>如果该接口和子接口同时配置了接口整形，则系统还要逐级按照子接口整形速率、接口整形速率对报文流进行速率控制。则报文全部进行流量整形。</p> 
<h2><a id="32_44"></a>3.2、自适应流量整形</h2> 
<p>有些场景下，下游设备的接口速率是不确定的，上游设备无法确定应该把整形参数设置为多少。此时可以配置自适应模板来实现自适应流量整形，通过在上游设备和下游设备间开启NQA检测，根据NQA检测到的下游设备丢包率动态调整整形参数。</p> 
<p>NQA(Network Quality Analysis，网络质量分析)，是设备上集成网络检测功能，不仅可以实现对网络运行情况的准确测试，输出统计信息，有效的节约成本。NQA可以检测网络上运行的各种协议的性能，时运营商能够实时采集到各种网络运行指标，例如：HTTP的总时延、TCP连接时延、DNS解析时延、文件传输时延、FTP连接时延、DNS解析错误等等。</p> 
<p>NQA把测试两端称为客户端和目的端，并在客户端发起测试，目的端接收报文后，返回给源端相应的回应信息。根据返回的回应信息，就可以了解相应的网络状况。</p> 
<p>自适应模板规定了：</p> 
<ul><li>NQA测试例：通过此测试例检测下游设备接口入方向丢包率，根据检测结果调整整形参数。</li><li>整形速率范围：上游设备接口出方向的整形速率上下限，整形速率在此范围内动态调整。</li><li>整形速率调整步长：动态调整整形速率时，每次调整的速率大小。</li><li>丢包率范围：下游设备接口入方向允许的丢包率范围。当丢包率在此范围之内时，不调整整形速率；当丢包率过大，减小上游设备整形速率；当丢包率过小，且上游设备发生拥塞，增大上游设备整形速率。</li><li>整形速率增大的时间间隔：当丢包率在阈值附近频繁变化时，就需要频繁调整整形速率，用户可以通过设置此参数，限制增大整形速率的时间间隔，避免频繁更新。</li></ul> 
<p>系统根据NQA检测结果中的丢包率等调整整形速率：<br> <img src="https://images2.imgbox.com/59/bc/is9EK276_o.png" alt="在这里插入图片描述"></p> 
<p>自适应模板在流行为中绑定后，将流行为与流分类在流策略下进行绑定，并在接口下应用流策略，才能使自适应模板中配置的整形参数在该接口下生效。</p> 
<h2><a id="33_62"></a>3.3流量监管和流量整形应用场景</h2> 
<p>企业网中语音、视频和数据等多种不同的业务，报文从高速链路进入设备，再由低速链路转发出去。可能会因为带宽不足产生拥塞，需要对三种业务提供不同的保证带宽，优先保证语音业务的带宽，其次是视频业务，最后是数据业务，因此可以对不同业务进行不同的流量监督，为语音报文提供最大保证带宽，视频报文次之，数据报文保证带宽最小，从而在网络产生拥塞时，可以保证语音报文优先通过。</p> 
<p>流量监管<br> <img src="https://images2.imgbox.com/71/7b/oQy2Sv32_o.png" alt="流量监管位置"><br> 流量整形<br> <img src="https://images2.imgbox.com/c9/57/kU2yQycl_o.png" alt="流量整形位置"></p> 
<h2><a id="34_70"></a>3.4、配置限速(流量监管和流量整形)</h2> 
<p>配置限速时，需要配置cir cir-value和cbs cbs-value等参数，其中cir cir-value指承诺信息速率，即保证能够通过的平均速率；cbs cbs-value指承诺突发尺寸，即瞬间能够通过的承诺突发流量。例如，用户想要配置限速4Mbit/s，则配置cir-value=4*1024 kbit/s=4096 kbit/s。cbs-value建议配置为cir-value的100–200倍，如果用户没有配置cbs-value，则设备会自动指定其为缺省值。cbs-value缺省为cir-value的125倍。突发流量速率 PIR 的设置，在工程上 PIR 的速率一般定义为 CIR 的 1.5 倍，即PIR=CIRx1.5，过大的 PIR 会导致设备过高的负荷。</p> 
<h2><a id="341_72"></a>3.4.1、配置流量整形</h2> 
<p><img src="https://images2.imgbox.com/76/cc/kLPPqlah_o.png" alt="在这里插入图片描述"></p> 
<p>Switch通过接口GE0/0/2与路由器互连，局域网终端发送的语音、视频、数据，这些业务可经由交换机和路由器到达用户。各终端设备与SW2构成的局域网，速率远大于由SW1和R1构成的WAN速率，这种情况下SW1出接口GE0/0/1处容易发生带宽抖动。为减少带宽抖动，为减少抖动进行以下处理：</p> 
<p><strong>1、基于接口的流量整形</strong><br> 也叫接口限速 LR（Line rate），限制接口发送的所有报文（包括紧急报文）的总速率，是对整个出接口进行流量整形，不区分优先级。LR使用的令牌技术为单通单速，不允许突发流量的通过。<br> 缺点：不能基于业务区别对待。</p> 
<p>在SW1入口上配置限速，进入的速率限制在20000kbit/s。在SW2上配置端口整形，将端口出口速率限制在20000kbit/s。lr针对于接口下的所有流量。LR使用单速单桶。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW1<span class="token punctuation">]</span><span class="token keyword">interface</span> g0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span>qos lr inbound cir <span class="token number">20000</span> cbs <span class="token number">2000000</span>   <span class="token comment">//配置入方向的接口限速速率为20000kbit/s，CBS大小为2000000bit。</span>

<span class="token punctuation">[</span>SW2<span class="token punctuation">]</span><span class="token keyword">interface</span> g0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span>qos gts cir <span class="token number">20000</span>          <span class="token comment">//配置接口的发送数据的速率为20Mbps/s,对接口配置流量整形。</span>
</code></pre> 
<p>cbs是整形模型中使用的令牌桶的大小，cbs不是越大越好，越大则流量波动就越大：反之，流量波动就较小，但cbs一定要大于1500。cbs-value缺省为cir-value的125倍。</p> 
<p>注意：<br> cbs、pbs的大小可以不用配置，系统会根据定义的cir和pir的值自动计算。</p> 
<p><strong>2、基于队列的流量整形</strong><br> 华为设备默认支持0-7共八个队列（很老的队列技术，类似于管道），可以基于每种队列定义不同的整形技术，以及队列调度技术，丢弃技术，默认八个队列的调度技术为公平WFQ，无差异行为。<br> 为保证各类业务带宽要求，携带的802.1p优先级分别为5、4、2，现设置如下：</p> 
<table><thead><tr><th align="left">流量类型</th><th align="left">CIR(kbps)</th><th align="left">PIR(kbps)</th></tr></thead><tbody><tr><td align="left">语音</td><td align="left">8000kbit/s</td><td align="left">峰值带宽为12000kbit/s</td></tr><tr><td align="left">视频</td><td align="left">10000kbit/s</td><td align="left">峰值带宽为20000kbit/s</td></tr><tr><td align="left">数据</td><td align="left">2000kbit/s</td><td align="left">峰值带宽为3000kbit/s</td></tr></tbody></table> 
<p>在Switch上配置端口队列整形。shaping使用双速双桶，shaping可以针对于队列</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW2<span class="token punctuation">]</span>qos queue<span class="token operator">-</span>profile gts     <span class="token comment">//创建队列模板，名为gts</span>

<span class="token punctuation">[</span>SW2<span class="token operator">-</span>qos<span class="token operator">-</span>queue<span class="token operator">-</span>profile<span class="token operator">-</span>gts<span class="token punctuation">]</span> queue <span class="token number">2</span> <span class="token keyword">to</span> <span class="token number">5</span> gts cir <span class="token number">20000</span>  <span class="token comment">//配置队列2到5使用gts整形，速率为20000bit/s</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span>qos<span class="token operator">-</span>queue<span class="token operator">-</span>profile<span class="token operator">-</span>gts<span class="token punctuation">]</span> queue <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">5</span> length bytes <span class="token number">10000</span>  <span class="token comment">//配置队列2到5的长度为10000bit</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span>qos<span class="token operator">-</span>queue<span class="token operator">-</span>profile<span class="token operator">-</span>gts<span class="token punctuation">]</span>quit

<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> qos queue <span class="token number">5</span> shaping cir <span class="token number">8000</span> pir <span class="token number">12000</span>             <span class="token comment">//在ge0/0/1上配置队列5，队列5整形6整形的为8000bit/s，峰值信息速率12000</span>

<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> qos queue <span class="token number">4</span> shaping cir <span class="token number">10000</span> pir <span class="token number">20000</span>             <span class="token comment">//在ge0/0/1上配置队列4，队列4整形为10000bit/s。</span>

<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> qos queue <span class="token number">2</span> shaping cir <span class="token number">2000</span> pir <span class="token number">3000</span>             <span class="token comment">//在ge0/0/1上配置队列2，队列2整形为2000bit/s。</span>
</code></pre> 
<p>缺点：方案复杂，配置端口复杂</p> 
<h2><a id="342MQC_122"></a>3.4.2、基于流分类MQC的流量监管</h2> 
<p>条件如上前面图示，为了减少网络拥塞的发生，需要对SW2进行流量监管，限速到20000kbit/s，在SW1入方向配置基于MQC的流量监管，SW1为三层交换机与后面的路由器构成一个DS域，此DS域设备内部优先级以DSCP优先级用于内部资源分配和调度使用的值。</p> 
<table><thead><tr><th align="left">流量类型</th><th align="left">CIR(kbps)</th><th align="left">PIR(kbps)</th><th align="left">DSCP优先级</th></tr></thead><tbody><tr><td align="left">语音</td><td align="left">8000kbit/s</td><td align="left">峰值带宽为12000kbit/s</td><td align="left">将DSCP优先级标记为46，保证后续设备优先转发。</td></tr><tr><td align="left">视频</td><td align="left">10000kbit/s</td><td align="left">峰值带宽为20000kbit/s</td><td align="left">将DSCP优先级标记为30。</td></tr><tr><td align="left">数据</td><td align="left">2000kbit/s</td><td align="left">峰值带宽为3000kbit/s</td><td align="left">将DSCP优先级标记为14。</td></tr></tbody></table> 
<p>(1)、创建VLAN，并配置各接口</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>HUAWEI<span class="token punctuation">&gt;</span></span> system<span class="token operator">-</span>view
<span class="token punctuation">[</span>HUAWEI<span class="token punctuation">]</span> sysname SW1
<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> vlan batch <span class="token number">10</span> <span class="token number">20</span> <span class="token number">30</span> <span class="token number">40</span>

# 将接口GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>、GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>、GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span>的接入类型分别配置为trunk，并将接口GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>、GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span>、GE0<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span>加入VLAN <span class="token number">10</span>、<span class="token number">20</span>、<span class="token number">30</span>。
<span class="token punctuation">[</span>SW2<span class="token punctuation">]</span> <span class="token keyword">interface</span> <span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">2</span> <span class="token keyword">to</span> <span class="token number">100</span>
 
<span class="token punctuation">[</span>SW2<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">20</span>

<span class="token punctuation">[</span>SW2<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">30</span>

<span class="token punctuation">[</span>SW2<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span>
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span>SW2<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">40</span>
</code></pre> 
<p>(2)、入方向配置MQC的流量监管</p> 
<p>基础配置</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW1<span class="token punctuation">]</span><span class="token keyword">interface</span> <span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">2</span> <span class="token keyword">to</span> <span class="token number">100</span>
</code></pre> 
<p>1、配置流分类，设备根据报文VLAN进行分类。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic classifier voice operator and
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>classifier<span class="token operator">-</span>voice<span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match vlan<span class="token operator">-</span>id <span class="token number">20</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>classifier<span class="token operator">-</span>voice<span class="token punctuation">]</span> quit

<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic classifier video operator and
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>classifier<span class="token operator">-</span>video<span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match vlan<span class="token operator">-</span>id <span class="token number">30</span>
<span class="token punctuation">[</span><span class="token class-name">SW1h</span><span class="token operator">-</span>classifier<span class="token operator">-</span>video<span class="token punctuation">]</span> quit

<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic classifier data operator and
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>classifier<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match vlan<span class="token operator">-</span>id <span class="token number">40</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>classifier<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>2、创建流行为，配置流量监管参数，并标记优先级</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic behavior voice
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> car cir <span class="token number">8000</span> pir <span class="token number">12000</span>  <span class="token comment">//配置语音业务限速带宽</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> remark dscp <span class="token number">46</span>   <span class="token comment">//标记语音报文DSCP为46</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> statistic enable  <span class="token comment">//用于验证配置结果</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> quit

<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic behavior video
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> car cir <span class="token number">10000</span> pir <span class="token number">20000</span>  <span class="token comment">//配置视频业务限速带宽</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> remark dscp <span class="token number">30</span>    <span class="token comment">//标记视频报文DSCP为30</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> statistic enable
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> quit

<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic behavior <span class="token class-name">Data</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> car cir <span class="token number">2000</span>      <span class="token comment">//配置数据业务限速带宽</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> remark dscp <span class="token number">14</span>   <span class="token comment">//标记数据报文DSCP为14</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> statistic enable
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>behavior<span class="token operator">-</span><span class="token class-name">Data</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>注意：<br> cbs、pbs的大小可以不用配置，系统会根据定义的cir和pir的值自动计算。</p> 
<p>3、配置流策略，并在接口GE0/0/1入方向应用。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> traffic policy p1

<span class="token punctuation">[</span>SW1<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier voice behavior voice
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier video behavior video
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier <span class="token class-name">Data</span> behavior <span class="token class-name">Data</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> quit

<span class="token punctuation">[</span>SW1<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">]</span> traffic<span class="token operator">-</span>policy p1 inbound
<span class="token punctuation">[</span>SW1<span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">]</span> quit
</code></pre> 
<h2><a id="343_217"></a>3.4.3、自适应流量整形</h2> 
<p><img src="https://images2.imgbox.com/ca/07/Nao87VCt_o.png" alt="在这里插入图片描述"></p> 
<p>采用基于流的拥塞管理来实现语音、视频和数据报文的不同处理。</p> 
<p>NQA客户端RA配置：</p> 
<ul><li>配置配置Jitter类型的NQA测试例;</li><li>配置流分类，实现对数据、视频、语音报文的区分；</li><li>配置流行为，针对数据、视频、语音报文，指定不同的拥塞管理动作；</li><li>配置自适应整形模板并应用到接口GE1/0/0。</li></ul> 
<p>1、配置NQA测试例<br> 配置NQA服务器服务器端</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Huawei</span><span class="token punctuation">&gt;</span></span> system<span class="token operator">-</span>view
<span class="token punctuation">[</span><span class="token class-name">Huawei</span><span class="token punctuation">]</span> sysname RB
<span class="token punctuation">[</span>RB<span class="token punctuation">]</span> nqa<span class="token operator">-</span>server udpecho <span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.2</span> <span class="token number">9000</span>  <span class="token comment">//服务器端采用UDP端口9000进行NQA回复</span>
</code></pre> 
<p>NQA客户端，配置Jitter类型的NQA测试例。</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Huawei</span><span class="token punctuation">&gt;</span></span> system<span class="token operator">-</span>view
<span class="token punctuation">[</span><span class="token class-name">Huawei</span><span class="token punctuation">]</span> sysname RA
<span class="token punctuation">[</span>RA<span class="token punctuation">]</span> nqa test<span class="token operator">-</span>instance admin jitter1     <span class="token comment">//配置NQA管理员名称admin和实例名称jitter1</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>nqa<span class="token operator">-</span>admin<span class="token operator">-</span>jitter1<span class="token punctuation">]</span> test<span class="token operator">-</span>type jitter   <span class="token comment">//测试类型为抖动</span>
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span>nqa<span class="token operator">-</span>admin<span class="token operator">-</span>jitter1<span class="token punctuation">]</span> destination<span class="token operator">-</span>address ipv4 <span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.2</span>   <span class="token comment">//测试server端地址</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>nqa<span class="token operator">-</span>admin<span class="token operator">-</span>jitter1<span class="token punctuation">]</span> destination<span class="token operator">-</span>port <span class="token number">9000</span>     <span class="token comment">//测试server端口号</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>nqa<span class="token operator">-</span>admin<span class="token operator">-</span>jitter1<span class="token punctuation">]</span> start now       <span class="token comment">//开始时间为总是</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>nqa<span class="token operator">-</span>admin<span class="token operator">-</span>jitter1<span class="token punctuation">]</span> quit
</code></pre> 
<p>2、在RA上配置自适应整形模板</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> qos adaptation<span class="token operator">-</span>profile gts1         <span class="token comment">//定制自适应模板为gts1</span>
#配置整形速率范围下限为<span class="token number">128</span>，上限为<span class="token number">512</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>qos<span class="token operator">-</span>adaptation<span class="token operator">-</span>profile<span class="token operator">-</span>gts1<span class="token punctuation">]</span> rate<span class="token operator">-</span>range low<span class="token operator">-</span>threshold <span class="token number">128</span> high<span class="token operator">-</span>threshold <span class="token number">512</span> 
<span class="token punctuation">[</span>RA<span class="token operator">-</span>qos<span class="token operator">-</span>adaptation<span class="token operator">-</span>profile<span class="token operator">-</span>gts1<span class="token punctuation">]</span> rate<span class="token operator">-</span>adjust step <span class="token number">32</span>     <span class="token comment">//配置整形速率调整步长</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>qos<span class="token operator">-</span>adaptation<span class="token operator">-</span>profile<span class="token operator">-</span>gts1<span class="token punctuation">]</span> rate<span class="token operator">-</span>adjust loss low<span class="token operator">-</span>threshold <span class="token number">20</span> high<span class="token operator">-</span>threshold <span class="token number">30</span> <span class="token comment">//配置丢包率最低20最高30</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>qos<span class="token operator">-</span>adaptation<span class="token operator">-</span>profile<span class="token operator">-</span>gts1<span class="token punctuation">]</span> track nqa admin jitter1   <span class="token comment">//绑定名称admin和实例名称jitter1的nqa</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>qos<span class="token operator">-</span>adaptation<span class="token operator">-</span>profile<span class="token operator">-</span>gts1<span class="token punctuation">]</span> quit
</code></pre> 
<p>3、在RA的接口GE1/0/0上应用自适应整形模板</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> qos gts adaptation<span class="token operator">-</span>profile gts1   <span class="token comment">//应用自适应整形模板gts1</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>4、在RouterA上配置流分类，区分出数据、视频和语音业务</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic classifier data              <span class="token comment">//创建名称为data的流分类</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>data<span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match dscp af11   <span class="token comment">//匹配DSCP优先级af11数据</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>data<span class="token punctuation">]</span> quit
<span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic classifier video
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>video<span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match dscp af21  <span class="token comment">//匹配DSCP优先级af21视频</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>video<span class="token punctuation">]</span> quit
<span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic classifier voice
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>voice<span class="token punctuation">]</span> <span class="token keyword">if</span><span class="token operator">-</span>match dscp ef   <span class="token comment">//匹配DSCP优先级ef视频</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>classifier<span class="token operator">-</span>voice<span class="token punctuation">]</span> quit
</code></pre> 
<p>5、配置流行为，配置匹配分类规则的报文进入指定队列并为其分配带宽</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic behavior data         <span class="token comment">//创建名称为data的流行为</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>data<span class="token punctuation">]</span> queue af bandwidth pct <span class="token number">30</span>   <span class="token comment">//定义data行为进入af队列可确保的最小带宽为30%</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>data<span class="token punctuation">]</span> quit
<span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic behavior video
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> queue af bandwidth pct <span class="token number">60</span>  <span class="token comment">//定义video行为进入af队列可确保的最小带宽为60%</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>video<span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> traffic behavior voice
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> queue llq bandwidth pct <span class="token number">5</span>   <span class="token comment">//定义voice行为进入LLQ队列配置允许的最大带宽为5%</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span>behavior<span class="token operator">-</span>voice<span class="token punctuation">]</span> quit
</code></pre> 
<p>6、创建流策略，将流分类和对应流行为关联起来</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> traffic policy p1
<span class="token punctuation">[</span>RA<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier voice  behavior voice
<span class="token punctuation">[</span>RA<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier video  behavior video
<span class="token punctuation">[</span>RA<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> classifier data  behavior  data
<span class="token punctuation">[</span>RA<span class="token operator">-</span>trafficpolicy<span class="token operator">-</span>p1<span class="token punctuation">]</span> quit
</code></pre> 
<p>7、在RA上将流策略应用到接口GE1/0/0上</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span>RA<span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> ip address <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.2</span> <span class="token number">24</span>
<span class="token punctuation">[</span>RA<span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> traffic<span class="token operator">-</span>policy p1 outbound
<span class="token punctuation">[</span>RA<span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> quit
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6e0f9c60e2b0e53035a8b292e2a0e33/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QoS服务质量四QoS边界行为之流量监管</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f5efdc2620390022877bd05c01cba99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">QoS服务质量一QoS概述</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>