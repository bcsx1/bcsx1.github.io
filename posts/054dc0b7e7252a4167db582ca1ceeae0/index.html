<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s权限配置（ServiceAccount、Role、ClusterRole） - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s权限配置（ServiceAccount、Role、ClusterRole）" />
<meta property="og:description" content="一、在RBAC中的几个概念： 1、什么是RBAC RBAC全称Role-Based Access Control，是Kubernetes集群基于角色的访问控制，实现授权决策，允许通过Kubernetes API动态配置策略。
2、什么是Role Role是一组权限的集合，例如Role可以包含列出Pod权限及列出Deployment权限，Role用于给某个NameSpace中的资源进行鉴权。
3、什么是ClusterRole ClusterRole是一组权限的集合，但与Role不同的是，ClusterRole可以在包括所有NameSpace和集群级别的资源或非资源类型进行鉴权。
4、什么是Subject Subject：有三种Subjects，分别是Service Account、User Account、Groups，参照官方文档主要区别是User Account针对人，Service Accounts针对运行在Pods中运行的进程。
5、什么是RoleBinding与ClusterRoleBinding RoleBinding与ClusterRoleBindin：将Subject绑定到Role或ClusterRole。其区别在于：RoleBinding将使规则在命名空间内生效，而ClusterRoleBinding将使规则在所有命名空间中生效。
二、创建一个sa，并绑定Role和ClusterRole： 1、创建ServiceAccount apiVersion: v1 kind: ServiceAccount metadata: namespace: minio name: service-minio [root@app01 k8s-user]# vim service-account.yaml [root@app01 k8s-user]# kubectl apply -f service-account.yaml serviceaccount/service-minio created [root@app01 k8s-user]# kubectl get sa -n minio -owide NAME SECRETS AGE default 1 17m service-minio 1 14m [root@app01 k8s-user]# kubectl get serviceaccount -n minio -owide NAME SECRETS AGE default 1 18m service-minio 1 14m [root@app01 k8s-user]# 2、查找ServiceAccount的token用以登录 [root@app01 k8s-user]# kubectl describe sa service-minio -n minio Name: service-minio Namespace: minio Labels: &lt;none&gt; Annotations: kubectl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/054dc0b7e7252a4167db582ca1ceeae0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-15T14:01:43+08:00" />
<meta property="article:modified_time" content="2022-07-15T14:01:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s权限配置（ServiceAccount、Role、ClusterRole）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="RBAC_0"></a>一、在RBAC中的几个概念：</h3> 
<h5><a id="1RBAC_1"></a>1、什么是RBAC</h5> 
<p>RBAC全称Role-Based Access Control，是Kubernetes集群基于角色的访问控制，实现授权决策，允许通过Kubernetes API动态配置策略。</p> 
<h5><a id="2Role_3"></a>2、什么是Role</h5> 
<p>Role是一组权限的集合，例如Role可以包含列出Pod权限及列出Deployment权限，Role用于给某个NameSpace中的资源进行鉴权。</p> 
<h5><a id="3ClusterRole_5"></a>3、什么是ClusterRole</h5> 
<p>ClusterRole是一组权限的集合，但与Role不同的是，ClusterRole可以在包括所有NameSpace和集群级别的资源或非资源类型进行鉴权。</p> 
<h5><a id="4Subject_7"></a>4、什么是Subject</h5> 
<p>Subject：有三种Subjects，分别是Service Account、User Account、Groups，参照官方文档主要区别是User Account针对人，Service Accounts针对运行在Pods中运行的进程。</p> 
<h5><a id="5RoleBindingClusterRoleBinding_9"></a>5、什么是RoleBinding与ClusterRoleBinding</h5> 
<p>RoleBinding与ClusterRoleBindin：将Subject绑定到Role或ClusterRole。其区别在于：RoleBinding将使规则在命名空间内生效，而ClusterRoleBinding将使规则在所有命名空间中生效。</p> 
<h3><a id="saRoleClusterRole_12"></a>二、创建一个sa，并绑定Role和ClusterRole：</h3> 
<h5><a id="1ServiceAccount_13"></a>1、创建ServiceAccount</h5> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> minio
  <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>minio
</code></pre> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># vim service-account.yaml</span>
<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl apply -f service-account.yaml</span>
serviceaccount/service-minio created

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment">#  kubectl get sa -n minio -owide</span>
NAME            SECRETS   AGE
default         1         17m
service-minio   1         14m

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment">#  kubectl get serviceaccount -n minio -owide</span>
NAME            SECRETS   AGE
default         1         18m
service-minio   1         14m
<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment">#</span>
</code></pre> 
<h5><a id="2ServiceAccounttoken_38"></a>2、查找ServiceAccount的token用以登录</h5> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl describe sa service-minio -n minio</span>
Name:                service-minio
Namespace:           minio
Labels:              &lt;none&gt;
Annotations:         kubectl<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io/last-applied-configuration:
                       <span class="token punctuation">{<!-- --></span><span class="token string">"apiVersion"</span>:<span class="token string">"v1"</span><span class="token punctuation">,</span><span class="token string">"kind"</span>:<span class="token string">"ServiceAccount"</span><span class="token punctuation">,</span><span class="token string">"metadata"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"annotations"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"name"</span>:<span class="token string">"service-minio"</span><span class="token punctuation">,</span><span class="token string">"namespace"</span>:<span class="token string">"minio"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
Image pull secrets:  &lt;none&gt;
Mountable secrets:   service-minio-token-wzfsj
Tokens:              service-minio-token-wzfsj
Events:              &lt;none&gt;
</code></pre> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl describe secret service-minio-token-wzfsj -n minio</span>
Name:         service-minio-token-wzfsj
Namespace:    minio
Labels:       &lt;none&gt;
Annotations:  kubernetes<span class="token punctuation">.</span>io/service-account<span class="token punctuation">.</span>name: service-minio
              kubernetes<span class="token punctuation">.</span>io/service-account<span class="token punctuation">.</span>uid: df5c9f0d-1211-11ec-b7b2-00505697af9d

<span class="token function">Type</span>:  kubernetes<span class="token punctuation">.</span>io/service-account-token

<span class="token keyword">Data</span>
====
ca<span class="token punctuation">.</span>crt:     1025 bytes
namespace:  5 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9<span class="token punctuation">.</span>eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtaW5pbyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJzZXJ2aWNlLW1pbmlvLXRva2VuLXd6ZnNqIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InNlcnZpY2UtbWluaW8iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkZjVjOWYwZC0xMjExLTExZWMtYjdiMi0wMDUwNTY5N2FmOWQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWluaW86c2VydmljZS1taW5pbyJ9<span class="token punctuation">.</span>W06Umb1XXD3xSsWY2GMzct9NXvFrEYDHV1WsqHotho2cW3azOUyPRHX2nrLTg2WmwKrw6oV0dbD3W1cNFSZ7yQebLhLnvfGRZn2WLO6Arkue7VUJ5Iy1N7ev3l7wQpZj8gWTIi-Ju1DeQYoudOHodjSnqz6g5i18hYs_xnd6UuwTioqeaFyRtP2lST_JyuFM3gXuFq5_PRYjvHZuKleoMqmwdq96nmX5GRuGwR6EOnB2uGUxOC0eKwC58PJ0vy_aavAqiPp7d_X0sbgZtPcbq1qfpWz9-_xmHj50NhZN8E4Qp25EpLQIZfED8HpveeqaHo96fn2BD29Dpv46-4FRBg
<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment">#</span>
</code></pre> 
<p>kuboard就可以登录了<br> <img src="https://images2.imgbox.com/d4/05/A8j21KKT_o.png" alt="在这里插入图片描述"><br> 也可以用管理员查找token：<br> <img src="https://images2.imgbox.com/30/18/nnhOrHwq_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3role_74"></a>3、创建role</h5> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># vim role-minio-service-minio.yaml</span>

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl apply -f role-minio-service-minio.yaml</span>
role<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io/role-minio-service-minio created

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl get role -n minio</span>
NAME                       AGE
role-minio-service-minio   15s
<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># </span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># 限定可访问的命名空间为 minio</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> minio
  <span class="token comment"># 角色名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> role<span class="token punctuation">-</span>minio<span class="token punctuation">-</span>service<span class="token punctuation">-</span>minio

<span class="token comment"># 控制 dashboard 中 命名空间模块 中的面板是否有权限查看</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span> <span class="token comment"># 空字符串""表明使用core API group</span>
  <span class="token comment">#resources: ["pods","pods/log","pods/exec", "pods/attach", "pods/status", "events", "replicationcontrollers", "services", "configmaps", "persistentvolumeclaims"]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"namespaces"</span><span class="token punctuation">,</span><span class="token string">"pods"</span><span class="token punctuation">,</span><span class="token string">"pods/log"</span><span class="token punctuation">,</span><span class="token string">"pods/exec"</span><span class="token punctuation">,</span> <span class="token string">"pods/attach"</span><span class="token punctuation">,</span> <span class="token string">"pods/status"</span><span class="token punctuation">,</span><span class="token string">"services"</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"watch"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"create"</span><span class="token punctuation">,</span> <span class="token string">"update"</span><span class="token punctuation">,</span> <span class="token string">"patch"</span><span class="token punctuation">,</span> <span class="token string">"delete"</span><span class="token punctuation">]</span>

<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"apps"</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"deployments"</span><span class="token punctuation">,</span> <span class="token string">"daemonsets"</span><span class="token punctuation">,</span> <span class="token string">"statefulsets"</span><span class="token punctuation">,</span><span class="token string">"replicasets"</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"watch"</span><span class="token punctuation">]</span>
</code></pre> 
<p><code>提示：role资源没有spec字段，它的群组是rbac.authorization.k8s.io/v1，对应类型为Role；metadata字段中的name用于指定对应role的名称；namespace用户指定对应的名称空间；roles字段用来描述对资源和权限，该字段为一个列表对象，一个对象必须有apiGroup，resources和verbs字段；其中apiGroup字段用来描述对应资源所属群组，默认不写任何群组表示核心群组v1；如果是匹配所有群组可以写成“*”;该字段是一个列表类型数据，所以必须用中括号将其括起来，即便没有值；resources字段用来描述对应的资源，这里的资源如果可以使用复数形式的必须使用复数形式；所谓复数是指对应资源名称单词的复数形式；该字段也是一个列表，可以使用中括号，也可以直接使用-开头写对应的值；verbs字段用来描述对应的权限，该字段也是一个列表，可以使用中括号或者“-”开头从下一行直接写值的方式</code></p> 
<h5><a id="4ServiceAccountRole_108"></a>4、创建ServiceAccount和Role的绑定</h5> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># vim role-bind-minio-service-minio.yaml</span>

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl apply -f role-bind-minio-service-minio.yaml</span>
rolebinding<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io/role-bind-minio-service-monio created

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl get rolebinding -n minio -owide</span>
NAME                            AGE   ROLE                            USERS   GROUPS   SERVICEACCOUNTS
role-bind-minio-service-monio   29s   Role/role-minio-service-minio                    minio/service-minio
<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment">#</span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> minio
  <span class="token key atrule">name</span><span class="token punctuation">:</span> role<span class="token punctuation">-</span>bind<span class="token punctuation">-</span>minio<span class="token punctuation">-</span>service<span class="token punctuation">-</span>monio

<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> minio
  <span class="token comment"># 用户名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>minio

<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token comment"># 角色名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> role<span class="token punctuation">-</span>minio<span class="token punctuation">-</span>service<span class="token punctuation">-</span>minio
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
</code></pre> 
<h5><a id="5ClusterRole_139"></a>5、创建ClusterRole</h5> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># vim cluster-role-paas-basic-service-minio.yaml</span>

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl apply -f cluster-role-paas-basic-service-minio.yaml</span>
clusterrole<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io/cluster-role-kube-system-service-minio created

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl get clusterrole|grep cluster-role</span>
cluster-role-paas-basic-service-minio                                  12m
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># 鉴于ClusterRole是集群范围对象，所以这里不需要定义"namespace"字段</span>
  <span class="token comment"># 角色名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>role<span class="token punctuation">-</span>paas<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>service<span class="token punctuation">-</span>minio
<span class="token comment"># 控制 dashboard 中 命名空间模块 中的面板是否有权限查看</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"rbac.authorization.k8s.io"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span> <span class="token comment"># 空字符串""表明使用core API group</span>
  <span class="token comment">#resources: ["pods","pods/log","pods/exec", "pods/attach", "pods/status", "events", "replicationcontrollers", "services", "configmaps", "persistentvolumeclaims"]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"pods"</span><span class="token punctuation">,</span><span class="token string">"pods/log"</span><span class="token punctuation">,</span><span class="token string">"pods/exec"</span><span class="token punctuation">,</span> <span class="token string">"pods/attach"</span><span class="token punctuation">,</span> <span class="token string">"pods/status"</span><span class="token punctuation">,</span><span class="token string">"services"</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"watch"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"create"</span><span class="token punctuation">,</span> <span class="token string">"update"</span><span class="token punctuation">,</span> <span class="token string">"patch"</span><span class="token punctuation">,</span> <span class="token string">"delete"</span><span class="token punctuation">]</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"apps"</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"namespaces"</span><span class="token punctuation">,</span><span class="token string">"deployments"</span><span class="token punctuation">,</span> <span class="token string">"daemonsets"</span><span class="token punctuation">,</span> <span class="token string">"statefulsets"</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"watch"</span><span class="token punctuation">]</span>
</code></pre> 
<h5><a id="6ServiceAccountClusterRole_167"></a>6、创建ServiceAccount和ClusterRole的绑定</h5> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># vim cluster-role-bind-paas-basic-service-minio.yaml</span>

<span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl apply -f cluster-role-bind-paas-basic-service-minio.yaml</span>
rolebinding<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io/cluster-role-bind-paas-basic-service-monio created
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>role<span class="token punctuation">-</span>bind<span class="token punctuation">-</span>paas<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>service<span class="token punctuation">-</span>monio

<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> minio
  <span class="token comment"># 用户名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>minio

<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token comment"># 角色名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>role<span class="token punctuation">-</span>paas<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>service<span class="token punctuation">-</span>minio
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
</code></pre> 
<h5><a id="7ClusterRoleRole_193"></a>7、ClusterRole和Role的参数值说明</h5> 
<p>1、<code>apiGroups可配置参数</code><br> “”,“apps”, “autoscaling”, “batch”</p> 
<p>2、<code>resources可配置参数</code><br> “services”， “endpoints”，“pods”，“secrets”，“configmaps”，“crontabs”，“deployments”，“jobs”，“nodes”，“rolebindings”，“clusterroles”，“daemonsets”，“replicasets”，“statefulsets”，“horizontalpodautoscalers”，“replicationcontrollers”，“cronjobs”</p> 
<p>3、<code>verbs可配置参数</code><br> “get”，“list”，“watch”， “create”，“update”， “patch”， “delete”，“exec”</p> 
<p>4、<code>apiGroups和resources对应关系</code></p> 
<pre><code class="prism language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>                                       <span class="token comment"># 空字符串""表明使用core API group</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"pods"</span><span class="token punctuation">,</span><span class="token string">"pods/log"</span><span class="token punctuation">,</span><span class="token string">"pods/exec"</span><span class="token punctuation">,</span> <span class="token string">"pods/attach"</span><span class="token punctuation">,</span> <span class="token string">"pods/status"</span><span class="token punctuation">,</span> <span class="token string">"events"</span><span class="token punctuation">,</span> <span class="token string">"replicationcontrollers"</span><span class="token punctuation">,</span> <span class="token string">"services"</span><span class="token punctuation">,</span> <span class="token string">"configmaps"</span><span class="token punctuation">,</span> <span class="token string">"persistentvolumeclaims"</span><span class="token punctuation">]</span>

<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"apps"</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"deployments"</span><span class="token punctuation">,</span> <span class="token string">"daemonsets"</span><span class="token punctuation">,</span> <span class="token string">"statefulsets"</span><span class="token punctuation">,</span><span class="token string">"replicasets"</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@app01 k8s-user]</span><span class="token comment"># kubectl api-resources</span>
NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND
bindings                                                                      true         Binding
componentstatuses                 cs                                          false        ComponentStatus
configmaps                        cm                                          true         ConfigMap
endpoints                         ep                                          true         Endpoints
events                            ev                                          true         Event
limitranges                       limits                                      true         LimitRange
namespaces                        ns                                          false        Namespace
nodes                             no                                          false        Node
persistentvolumeclaims            pvc                                         true         PersistentVolumeClaim
persistentvolumes                 pv                                          false        PersistentVolume
pods                              po                                          true         Pod
podtemplates                                                                  true         PodTemplate
replicationcontrollers            rc                                          true         ReplicationController
resourcequotas                    quota                                       true         ResourceQuota
secrets                                                                       true         Secret
serviceaccounts                   sa                                          true         ServiceAccount
services                          svc                                         true         Service
mutatingwebhookconfigurations                  admissionregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io   false        MutatingWebhookConfiguration
validatingwebhookconfigurations                admissionregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io   false        ValidatingWebhookConfiguration
customresourcedefinitions         crd<span class="token punctuation">,</span>crds     apiextensions<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io           false        CustomResourceDefinition
apiservices                                    apiregistration<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io         false        APIService
controllerrevisions                            apps                           true         ControllerRevision
daemonsets                        ds           apps                           true         DaemonSet
deployments                       deploy       apps                           true         Deployment
replicasets                       rs           apps                           true         ReplicaSet
statefulsets                      sts          apps                           true         StatefulSet
tokenreviews                                   authentication<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io          false        TokenReview
localsubjectaccessreviews                      authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io           true         LocalSubjectAccessReview
selfsubjectaccessreviews                       authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io           false        SelfSubjectAccessReview
selfsubjectrulesreviews                        authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io           false        SelfSubjectRulesReview
subjectaccessreviews                           authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io           false        SubjectAccessReview
horizontalpodautoscalers          hpa          autoscaling                    true         HorizontalPodAutoscaler
cronjobs                          cj           batch                          true         CronJob
jobs                                           batch                          true         Job
certificatesigningrequests        csr          certificates<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io            false        CertificateSigningRequest
leases                                         coordination<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io            true         Lease
events                            ev           events<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io                  true         Event
daemonsets                        ds           extensions                     true         DaemonSet
deployments                       deploy       extensions                     true         Deployment
ingresses                         ing          extensions                     true         Ingress
networkpolicies                   netpol       extensions                     true         NetworkPolicy
podsecuritypolicies               psp          extensions                     false        PodSecurityPolicy
replicasets                       rs           extensions                     true         ReplicaSet
kuboardlicenses                   klcs         kuboard<span class="token punctuation">.</span>cn                     false        KuboardLicense
networkpolicies                   netpol       networking<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io              true         NetworkPolicy
poddisruptionbudgets              pdb          policy                         true         PodDisruptionBudget
podsecuritypolicies               psp          policy                         false        PodSecurityPolicy
clusterrolebindings                            rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io      false        ClusterRoleBinding
clusterroles                                   rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io      false        ClusterRole
rolebindings                                   rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io      true         RoleBinding
roles                                          rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io      true         Role
priorityclasses                   pc           scheduling<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io              false        PriorityClass
storageclasses                    <span class="token function">sc</span>           storage<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io                 false        StorageClass
volumeattachments                              storage<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io                 false        VolumeAttachment
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3376783c560cb5959df8f138829c009e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA解决内存不足 low memory(亲测好用)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/110e7366732d7cc3aa5940c2d029042f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于双符号数溢出的理解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>