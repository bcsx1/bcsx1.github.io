<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker的冷门高级玩法 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker的冷门高级玩法" />
<meta property="og:description" content="Docker 高级操作 文章目录 Docker 高级操作1. 容器的进程2. 命名空间3. chroot4. cgroups4.1 进程的CPU统计信息4.2 进程的内存配置4.3 如何配置cgroups? 5. Seccomp / AppArmor6. Capabilities7. 容器镜像8. 创建空镜像9. 不使用Dockerfile创建镜像 1. 容器的进程 $ docker run -d --name=db redis:alpine $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e2edc005ea6e redis:alpine &#34;docker-entrypoint.s…&#34; 31 seconds ago Up 30 seconds 6379/tcp db #Docker容器启动一个名为redis-server的进程。在主机上，我们可以看到所有正在运行的进程，包括由Docker启动的进程。 $ ps aux | grep redis-server 999 1099 0.3 1.1 29156 11316 ? Ssl 08:50 0:00 redis-server *:6379 docker top db UID PID PPID C STIME TTY TIME CMD 999 1099 1083 0 08:50 ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9fb03ea8a196a7295775490d6db94a0a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-04T00:50:05+08:00" />
<meta property="article:modified_time" content="2022-07-04T00:50:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker的冷门高级玩法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Docker___0"></a>Docker 高级操作</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Docker___0" rel="nofollow">Docker 高级操作</a></li><li><ul><li><a href="#1__4" rel="nofollow">1. 容器的进程</a></li><li><a href="#2__94" rel="nofollow">2. 命名空间</a></li><li><a href="#3_chroot_228" rel="nofollow">3. chroot</a></li><li><a href="#4_cgroups_233" rel="nofollow">4. cgroups</a></li><li><ul><li><a href="#41_CPU_258" rel="nofollow">4.1 进程的CPU统计信息</a></li><li><a href="#42__272" rel="nofollow">4.2 进程的内存配置</a></li><li><a href="#43_cgroups_293" rel="nofollow">4.3 如何配置cgroups?</a></li></ul> 
   </li><li><a href="#5_Seccomp__AppArmor_323" rel="nofollow">5. Seccomp / AppArmor</a></li><li><a href="#6_Capabilities_406" rel="nofollow">6. Capabilities</a></li><li><a href="#7__426" rel="nofollow">7. 容器镜像</a></li><li><a href="#8__525" rel="nofollow">8. 创建空镜像</a></li><li><a href="#9_Dockerfile_542" rel="nofollow">9. 不使用Dockerfile创建镜像</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__4"></a>1. 容器的进程</h3> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> run -d --name<span class="token operator">=</span>db redis:alpine

$ <span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
e2edc005ea6e        redis:alpine        <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">31</span> seconds ago      Up <span class="token number">30</span> seconds       <span class="token number">6379</span>/tcp            db

<span class="token comment">#Docker容器启动一个名为redis-server的进程。在主机上，我们可以看到所有正在运行的进程，包括由Docker启动的进程。</span>
$ <span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> redis-server
<span class="token number">999</span>       <span class="token number">1099</span>  <span class="token number">0.3</span>  <span class="token number">1.1</span>  <span class="token number">29156</span> <span class="token number">11316</span> ?        Ssl  08:50   <span class="token number">0</span>:00 redis-server *:6379

<span class="token function">docker</span> <span class="token function">top</span> db
<span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD
<span class="token number">999</span>                 <span class="token number">1099</span>                <span class="token number">1083</span>                <span class="token number">0</span>                   08:50               ?                   00:00:00            redis-server *:6379

<span class="token comment">#将列出所有子进程。</span>
$ pstree -c -p -A <span class="token variable"><span class="token variable">$(</span>pgrep dockerd<span class="token variable">)</span></span>
dockerd<span class="token punctuation">(</span><span class="token number">679</span><span class="token punctuation">)</span>-+-docker-containe<span class="token punctuation">(</span><span class="token number">717</span><span class="token punctuation">)</span>-+-docker-containe<span class="token punctuation">(</span><span class="token number">1083</span><span class="token punctuation">)</span>-+-redis-server<span class="token punctuation">(</span><span class="token number">1099</span><span class="token punctuation">)</span>-+-<span class="token punctuation">{<!-- --></span>bio_aof_fsync<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1134</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>                    <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>bio_close_file<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1133</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>                    <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>bio_lazy_free<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1135</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>                    <span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">{<!-- --></span>jemalloc_bg_thd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1136</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1084</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1085</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1086</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1087</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1088</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>                       <span class="token variable">`</span></span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1089</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">718</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">719</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">720</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">721</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">728</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">757</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">758</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>                      <span class="token variable"><span class="token variable">`</span>-<span class="token punctuation">{<!-- --></span>docker-containe<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">766</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">704</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">705</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">706</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">713</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">714</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">715</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">716</span><span class="token punctuation">)</span>
             <span class="token operator">|</span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">734</span><span class="token punctuation">)</span>
             <span class="token variable">`</span></span>-<span class="token punctuation">{<!-- --></span>dockerd<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1047</span><span class="token punctuation">)</span>




$ <span class="token assign-left variable">DBPID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pgrep redis-server<span class="token variable">)</span></span>
$ <span class="token builtin class-name">echo</span> Redis is <span class="token variable">$DBPID</span>
Redis is <span class="token number">1099</span>
$ <span class="token function">ls</span> /proc
<span class="token number">1</span>     <span class="token number">13</span>   <span class="token number">17</span>   <span class="token number">214</span>  <span class="token number">28</span>   <span class="token number">4</span>    <span class="token number">56</span>   <span class="token number">66</span>   <span class="token number">754</span>        bus          filesystems  kpagecount    partitions     thread-self
<span class="token number">10</span>    <span class="token number">130</span>  <span class="token number">170</span>  <span class="token number">215</span>  <span class="token number">29</span>   <span class="token number">473</span>  <span class="token number">57</span>   <span class="token number">67</span>   <span class="token number">8</span>          cgroups      fs           kpageflags    sched_debug    timer_list
<span class="token number">1083</span>  <span class="token number">131</span>  <span class="token number">18</span>   <span class="token number">22</span>   <span class="token number">3</span>    <span class="token number">475</span>  <span class="token number">58</span>   <span class="token number">674</span>  <span class="token number">844</span>        cmdline      interrupts   loadavg       schedstat      timer_stats
<span class="token number">1099</span>  <span class="token number">132</span>  <span class="token number">19</span>   <span class="token number">220</span>  <span class="token number">30</span>   <span class="token number">483</span>  <span class="token number">59</span>   <span class="token number">679</span>  <span class="token number">85</span>         consoles     iomem        locks         scsi           <span class="token function">tty</span>
<span class="token number">11</span>    <span class="token number">133</span>  <span class="token number">2</span>    <span class="token number">228</span>  <span class="token number">306</span>  <span class="token number">485</span>  <span class="token number">592</span>  <span class="token number">68</span>   <span class="token number">858</span>        cpuinfo      ioports      mdstat        self           <span class="token function">uptime</span>
<span class="token number">1172</span>  <span class="token number">134</span>  <span class="token number">20</span>   <span class="token number">23</span>   <span class="token number">309</span>  <span class="token number">5</span>    <span class="token number">6</span>    <span class="token number">698</span>  <span class="token number">86</span>         crypto       irq          meminfo       slabinfo       version
<span class="token number">12</span>    <span class="token number">135</span>  <span class="token number">200</span>  <span class="token number">235</span>  <span class="token number">31</span>   <span class="token number">52</span>   <span class="token number">60</span>   <span class="token number">7</span>    <span class="token number">87</span>         devices      kallsyms     misc          softirqs       version_signature
<span class="token number">124</span>   <span class="token number">14</span>   <span class="token number">203</span>  <span class="token number">24</span>   <span class="token number">32</span>   <span class="token number">53</span>   <span class="token number">61</span>   <span class="token number">707</span>  <span class="token number">9</span>          diskstats    kcore        modules       <span class="token function">stat</span>           vmallocinfo
<span class="token number">125</span>   <span class="token number">141</span>  <span class="token number">205</span>  <span class="token number">25</span>   <span class="token number">33</span>   <span class="token number">530</span>  <span class="token number">62</span>   <span class="token number">717</span>  <span class="token number">951</span>        dma          keys         mounts        swaps          <span class="token function">vmstat</span>
<span class="token number">126</span>   <span class="token number">15</span>   <span class="token number">21</span>   <span class="token number">26</span>   <span class="token number">34</span>   <span class="token number">54</span>   <span class="token number">63</span>   <span class="token number">72</span>   <span class="token number">957</span>        driver       key-users    mtrr          sys            zoneinfo
<span class="token number">127</span>   <span class="token number">16</span>   <span class="token number">210</span>  <span class="token number">264</span>  <span class="token number">35</span>   <span class="token number">540</span>  <span class="token number">64</span>   <span class="token number">725</span>  acpi       execdomains  kmsg         net           sysrq-trigger
<span class="token number">129</span>   <span class="token number">169</span>  <span class="token number">213</span>  <span class="token number">27</span>   <span class="token number">36</span>   <span class="token number">55</span>   <span class="token number">65</span>   <span class="token number">750</span>  buddyinfo  fb           kpagecgroup  pagetypeinfo  sysvipc


<span class="token comment">#每个进程都在不同的文件中定义了自己的配置和安全设置</span>
$ <span class="token function">ls</span> /proc/<span class="token variable">$DBPID</span>
attr        cmdline          environ  io         mem         ns             pagemap      schedstat  <span class="token function">stat</span>     timers
autogroup   <span class="token function">comm</span>             exe      limits     mountinfo   numa_maps      personality  sessionid  statm    uid_map
auxv        coredump_filter  fd       loginuid   mounts      oom_adj        projid_map   setgroups  status   wchan
cgroup      cpuset           fdinfo   map_files  mountstats  oom_score      root         smaps      syscall
clear_refs  cwd              gid_map  maps       net         oom_score_adj  sched        stack      task

<span class="token comment">#例如，您可以查看和更新为该流程定义的环境变量</span>
$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/environ
*:6379

$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it db <span class="token function">env</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>e2edc005ea6e
<span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm
<span class="token assign-left variable">REDIS_VERSION</span><span class="token operator">=</span><span class="token number">6.2</span>.5
<span class="token assign-left variable">REDIS_DOWNLOAD_URL</span><span class="token operator">=</span>http://download.redis.io/releases/redis-6.2.5.tar.gz
<span class="token assign-left variable">REDIS_DOWNLOAD_SHA</span><span class="token operator">=</span>4b9a75709a1b74b3785e20a6c158cab94cf52298aa381eea947a678a60d551ae
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root


</code></pre> 
<h3><a id="2__94"></a>2. 命名空间</h3> 
<p>容器的基本组成部分之一是名称空间。名称空间的概念是限制进程可以看到和访问系统的某些部分，比如其他网络接口或进程。</p> 
<p>当容器启动时，容器运行时(如Docker)将为进程创建新的命名空间。通过在它自己的Pid命名空间中运行进程，它将看起来像系统上的唯一进程。</p> 
<p>可用的命名空间有:<br> Mount (mnt)</p> 
<p>Process ID (pid)</p> 
<p>Network (net)</p> 
<p>Interprocess Communication (ipc)</p> 
<p>UTS (hostnames)</p> 
<p>User ID (user)</p> 
<p>Control group (cgroup)</p> 
<p>在不使用Docker等运行时的情况下，进程仍然可以在自己的命名空间内运行。一个可以提供帮助的工具是<code>unshare</code>。</p> 
<pre><code class="prism language-bash">$ unshare --help

Usage:
 unshare <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>program<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>argument<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>

Run a program with some namespaces unshared from the parent.

Options:
 -m, --mount<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>      unshare mounts namespace
 -u, --uts<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>        unshare UTS namespace <span class="token punctuation">(</span>hostname etc<span class="token punctuation">)</span>
 -i, --ipc<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>        unshare System V IPC namespace
 -n, --net<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>        unshare network namespace
 -p, --pid<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>        unshare pid namespace
 -U, --user<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>       unshare user namespace
 -f, --fork                fork before launching <span class="token operator">&lt;</span>program<span class="token operator">&gt;</span>
     --mount-proc<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token function">mount</span> proc filesystem first <span class="token punctuation">(</span>implies --mount<span class="token punctuation">)</span>
 -r, --map-root-user       map current user to root <span class="token punctuation">(</span>implies --user<span class="token punctuation">)</span>
     --propagation slave<span class="token operator">|</span>shared<span class="token operator">|</span>private<span class="token operator">|</span>unchanged
                           modify <span class="token function">mount</span> propagation <span class="token keyword">in</span> <span class="token function">mount</span> namespace
 -s, --setgroups allow<span class="token operator">|</span>deny  control the setgroups syscall <span class="token keyword">in</span> user namespaces

 -h, --help     display this <span class="token builtin class-name">help</span> and <span class="token builtin class-name">exit</span>
 -V, --version  output version information and <span class="token builtin class-name">exit</span>
</code></pre> 
<p>使用<code>unshare</code>，可以启动进程并让它创建一个新的名称空间，比如Pid。通过从主机取消Pid名称空间的共享，看起来bash提示符是唯一运行的进程：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> unshare --fork --pid --mount-proc <span class="token function">bash</span>
$ <span class="token function">ps</span>
  PID TTY          TIME CMD
    <span class="token number">1</span> pts/0    00:00:00 <span class="token function">bash</span>
    <span class="token number">9</span> pts/0    00:00:00 <span class="token function">ps</span>
$ <span class="token builtin class-name">exit</span>
<span class="token builtin class-name">exit</span>
</code></pre> 
<p>名称空间是磁盘上的索引节点位置。这允许进程<code>shared/reused</code>相同的名称空间，从而允许它们进行查看和交互。</p> 
<pre><code class="prism language-bash"><span class="token comment">#列出容器所有的名称空间</span>
$ <span class="token function">ls</span> -lha /proc/<span class="token variable">$DBPID</span>/ns/
total <span class="token number">0</span>
dr-x--x--x <span class="token number">2</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:50 <span class="token builtin class-name">.</span>
dr-xr-xr-x <span class="token number">9</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:50 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 09:04 cgroup -<span class="token operator">&gt;</span> cgroup:<span class="token punctuation">[</span><span class="token number">4026531835</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:52 ipc -<span class="token operator">&gt;</span> ipc:<span class="token punctuation">[</span><span class="token number">4026532157</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:52 mnt -<span class="token operator">&gt;</span> mnt:<span class="token punctuation">[</span><span class="token number">4026532155</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:50 net -<span class="token operator">&gt;</span> net:<span class="token punctuation">[</span><span class="token number">4026532160</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:52 pid -<span class="token operator">&gt;</span> pid:<span class="token punctuation">[</span><span class="token number">4026532158</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:52 user -<span class="token operator">&gt;</span> user:<span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:52 uts -<span class="token operator">&gt;</span> uts:<span class="token punctuation">[</span><span class="token number">4026532156</span><span class="token punctuation">]</span>
</code></pre> 
<p>另一个工具<code>nsenter</code>用于将进程附加到现有的命名空间。对调试有用。</p> 
<pre><code class="prism language-bash">$ nsenter --target <span class="token variable">$DBPID</span> --mount --uts --ipc --net --pid <span class="token function">ps</span> aux
PID   <span class="token environment constant">USER</span>     TIME  COMMAND
    <span class="token number">1</span> redis     <span class="token number">0</span>:02 redis-server *:6379
   <span class="token number">16</span> root      <span class="token number">0</span>:00 <span class="token function">ps</span> aux
</code></pre> 
<p>在Docker中，可以使用语法<code>container:&lt;container-name&gt;</code>共享这些名称空间。例如，下面的命令将nginx连接到DB命名空间。</p> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> run -d --name<span class="token operator">=</span>web --net<span class="token operator">=</span>container:db nginx:alpine
<span class="token assign-left variable">WEBPID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pgrep nginx <span class="token operator">|</span> <span class="token function">tail</span> -n1<span class="token variable">)</span></span>
$ <span class="token builtin class-name">echo</span> nginx is <span class="token variable">$WEBPID</span>
$ <span class="token function">cat</span> /proc/<span class="token variable">$WEBPID</span>/cgroup
<span class="token number">11</span>:hugetlb:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">10</span>:perf_event:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">9</span>:cpu,cpuacct:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">8</span>:cpuset:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">7</span>:freezer:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">6</span>:memory:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">5</span>:pids:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">4</span>:devices:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">3</span>:net_cls,net_prio:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">2</span>:blkio:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
<span class="token number">1</span>:name<span class="token operator">=</span>systemd:/docker/42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1
</code></pre> 
<p>虽然网络已被共享，但它仍将作为名称空间列出。</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span> -lha /proc/<span class="token variable">$WEBPID</span>/ns/
total <span class="token number">0</span>
dr-x--x--x <span class="token number">2</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 <span class="token builtin class-name">.</span>
dr-xr-xr-x <span class="token number">9</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:07 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 cgroup -<span class="token operator">&gt;</span> cgroup:<span class="token punctuation">[</span><span class="token number">4026531835</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 ipc -<span class="token operator">&gt;</span> ipc:<span class="token punctuation">[</span><span class="token number">4026532225</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 mnt -<span class="token operator">&gt;</span> mnt:<span class="token punctuation">[</span><span class="token number">4026532223</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 net -<span class="token operator">&gt;</span> net:<span class="token punctuation">[</span><span class="token number">4026532160</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 pid -<span class="token operator">&gt;</span> pid:<span class="token punctuation">[</span><span class="token number">4026532226</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 user -<span class="token operator">&gt;</span> user:<span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 uts -<span class="token operator">&gt;</span> uts:<span class="token punctuation">[</span><span class="token number">4026532224</span><span class="token punctuation">]</span>
</code></pre> 
<p>但是，这两个进程的网络名称空间指向相同的位置。</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span> -lha /proc/<span class="token variable">$WEBPID</span>/ns/ <span class="token operator">|</span> <span class="token function">grep</span> net
dr-x--x--x <span class="token number">2</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 <span class="token builtin class-name">.</span>
dr-xr-xr-x <span class="token number">9</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:07 <span class="token punctuation">..</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 cgroup -<span class="token operator">&gt;</span> cgroup:<span class="token punctuation">[</span><span class="token number">4026531835</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 ipc -<span class="token operator">&gt;</span> ipc:<span class="token punctuation">[</span><span class="token number">4026532225</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 mnt -<span class="token operator">&gt;</span> mnt:<span class="token punctuation">[</span><span class="token number">4026532223</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 net -<span class="token operator">&gt;</span> net:<span class="token punctuation">[</span><span class="token number">4026532160</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 pid -<span class="token operator">&gt;</span> pid:<span class="token punctuation">[</span><span class="token number">4026532226</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 user -<span class="token operator">&gt;</span> user:<span class="token punctuation">[</span><span class="token number">4026531837</span><span class="token punctuation">]</span>
lrwxrwxrwx <span class="token number">1</span> systemd-network systemd-journal <span class="token number">0</span> Sep <span class="token number">27</span> 09:10 uts -<span class="token operator">&gt;</span> uts:<span class="token punctuation">[</span><span class="token number">4026532224</span><span class="token punctuation">]</span>
$ <span class="token function">ls</span> -lha /proc/<span class="token variable">$DBPID</span>/ns/ <span class="token operator">|</span> <span class="token function">grep</span> net
lrwxrwxrwx <span class="token number">1</span> <span class="token number">999</span> packer <span class="token number">0</span> Sep <span class="token number">27</span> 08:50 net -<span class="token operator">&gt;</span> net:<span class="token punctuation">[</span><span class="token number">4026532160</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="3_chroot_228"></a>3. chroot</h3> 
<p>容器进程的一个重要部分是能够拥有独立于主机的不同文件。这就是我们如何基于不同的操作系统在我们的系统上运行不同的Docker映像。</p> 
<p>Chroot允许进程在父操作系统的不同根目录下启动。这允许不同的文件出现在根目录中。</p> 
<h3><a id="4_cgroups_233"></a>4. cgroups</h3> 
<p>CGroups限制了进程可以消耗的资源数量。这些cgroup是在/proc目录中的特定文件中定义的值。<br> 需要查看映射关系，使用命令:</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/cgroup
<span class="token number">11</span>:hugetlb:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">10</span>:perf_event:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">9</span>:cpu,cpuacct:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">8</span>:cpuset:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">7</span>:freezer:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">6</span>:memory:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">5</span>:pids:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">4</span>:devices:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">3</span>:net_cls,net_prio:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">2</span>:blkio:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
<span class="token number">1</span>:name<span class="token operator">=</span>systemd:/docker/e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0
</code></pre> 
<p>这些被映射到磁盘上的其他cgroup目录:</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span> /sys/fs/cgroup/
blkio  cpuacct      cpuset   freezer  memory   net_cls,net_prio  perf_event  systemd
cpu    cpu,cpuacct  devices  hugetlb  net_cls  net_prio          pids
</code></pre> 
<h4><a id="41_CPU_258"></a>4.1 进程的CPU统计信息</h4> 
<p>CPU统计数据和使用情况也存储在一个文件中!</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpuacct.stat
user <span class="token number">139</span>
system <span class="token number">144</span>
</code></pre> 
<p>这里还定义了CPU共享限制。</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpu.shares
<span class="token number">1024</span>
</code></pre> 
<h4><a id="42__272"></a>4.2 进程的内存配置</h4> 
<p>所有用于容器内存配置的Docker cgroups都存储在:</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span> /sys/fs/cgroup/memory/docker/
42e8d3ecb8137817669b58fd33c2b6e133bae8237513c7ed8af0a49a936248d1  memory.kmem.usage_in_bytes
cgroup.clone_children                                             memory.limit_in_bytes
cgroup.event_control                                              memory.max_usage_in_bytes
cgroup.procs                                                      memory.move_charge_at_immigrate
e2edc005ea6ef33fededdb8f7b58162665c81552a29a2ea777b8b9d05bd393d0  memory.numa_stat
memory.failcnt                                                    memory.oom_control
memory.force_empty                                                memory.pressure_level
memory.kmem.failcnt                                               memory.soft_limit_in_bytes
memory.kmem.limit_in_bytes                                        memory.stat
memory.kmem.max_usage_in_bytes                                    memory.swappiness
memory.kmem.slabinfo                                              memory.usage_in_bytes
memory.kmem.tcp.failcnt                                           memory.use_hierarchy
memory.kmem.tcp.limit_in_bytes                                    notify_on_release
memory.kmem.tcp.max_usage_in_bytes                                tasks
memory.kmem.tcp.usage_in_bytes
</code></pre> 
<h4><a id="43_cgroups_293"></a>4.3 如何配置cgroups?</h4> 
<p>Docker的属性之一是控制内存限制的能力。这是通过cgroup设置完成的。<br> 默认情况下，容器对内存没有限制。我们可以通过<code>docker stats</code>命令查看。</p> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> stats db --no-stream
CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
e2edc005ea6e        db                  <span class="token number">0.17</span>%               <span class="token number">6</span>.754MiB / <span class="token number">992</span>.1MiB   <span class="token number">0.68</span>%               <span class="token number">1</span>.3kB / 0B          0B / 0B             <span class="token number">5</span>
</code></pre> 
<p>内存引号存储在一个名为<code>memory.limit_in_bytes</code></p> 
<p>通过写入文件，我们可以改变进程的限制</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">echo</span> <span class="token number">8000000</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/memory/docker/<span class="token variable">$DBID</span>/memory.limit_in_bytes
</code></pre> 
<p>如果将文件读回去，您将注意到它已被转换为7999488。</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/memory/docker/<span class="token variable">$DBID</span>/memory.limit_in_bytes
<span class="token number">7999488</span>
</code></pre> 
<p>当再次检查Docker Stats时，进程的内存限制现在是7.629M</p> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> stats db --no-stream
CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
e2edc005ea6e        db                  <span class="token number">0.19</span>%               <span class="token number">6</span>.176MiB / <span class="token number">992</span>.1MiB   <span class="token number">0.62</span>%               <span class="token number">1</span>.3kB / 0B          <span class="token number">61</span>.4kB / 0B         <span class="token number">5</span>
</code></pre> 
<h3><a id="5_Seccomp__AppArmor_323"></a>5. Seccomp / AppArmor</h3> 
<p>Linux中的所有操作都是通过系统调用来完成的。内核有330个系统调用，执行读取文件、关闭句柄和检查访问权限等操作。所有应用程序都使用这些系统调用的组合来执行所需的操作。</p> 
<p><code>AppArmor</code>是一个应用程序定义的配置文件，它描述了进程可以访问系统的哪些部分。</p> 
<p>可以通过以下方式查看分配给进程的当前AppArmor配置文件</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/attr/current
docker-default <span class="token punctuation">(</span>enforce<span class="token punctuation">)</span>
</code></pre> 
<p>Docker的默认<code>AppArmor</code>配置文件是<code>docker-default (enforce)</code></p> 
<p>在Docker 1.13之前，它将AppArmor配置文件存储在<code>/etc/ AppArmor.d/Docker-default</code>(在Docker启动时被覆盖，因此用户无法修改它。在v1.13之后，Docker现在在<code>tmpfs</code>中生成<code>Docker -default</code>，使用<code>apparmor_parser</code>将其加载到内核中，然后删除该文件</p> 
<p>该模板可在<a href="https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/profiles/apparmor/template.go">https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/profiles/apparmor/template.go</a></p> 
<p>Seccomp提供了限制系统调用的能力，阻止诸如安装内核模块或更改文件权限等方面。</p> 
<p>Docker默认允许的调用可以在<a href="https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/profiles/seccomp/default.json">https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/profiles/seccomp/default.json</a></p> 
<p>当分配给进程时，它意味着进程将被限制在能力系统调用的子集。如果它试图调用一个被阻塞的系统调用将收到错误“操作不允许”。</p> 
<p><code>SecComp</code>的状态也在一个文件中定义。</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/status
Name:   redis-server
State:  S <span class="token punctuation">(</span>sleeping<span class="token punctuation">)</span>
Tgid:   <span class="token number">1099</span>
Ngid:   <span class="token number">0</span>
Pid:    <span class="token number">1099</span>
PPid:   <span class="token number">1083</span>
TracerPid:      <span class="token number">0</span>
Uid:    <span class="token number">999</span>     <span class="token number">999</span>     <span class="token number">999</span>     <span class="token number">999</span>
Gid:    <span class="token number">1000</span>    <span class="token number">1000</span>    <span class="token number">1000</span>    <span class="token number">1000</span>
FDSize: <span class="token number">64</span>
Groups: <span class="token number">1000</span> <span class="token number">1000</span> 
NStgid: <span class="token number">1099</span>    <span class="token number">1</span>
NSpid:  <span class="token number">1099</span>    <span class="token number">1</span>
NSpgid: <span class="token number">1099</span>    <span class="token number">1</span>
NSsid:  <span class="token number">1099</span>    <span class="token number">1</span>
VmPeak:    <span class="token number">29156</span> kB
VmSize:    <span class="token number">29156</span> kB
VmLck:         <span class="token number">0</span> kB
VmPin:         <span class="token number">0</span> kB
VmHWM:     <span class="token number">11316</span> kB
VmRSS:      <span class="token number">7032</span> kB
VmData:    <span class="token number">23204</span> kB
VmStk:       <span class="token number">132</span> kB
VmExe:      <span class="token number">1672</span> kB
VmLib:      <span class="token number">1656</span> kB
VmPTE:        <span class="token number">56</span> kB
VmPMD:        <span class="token number">12</span> kB
VmSwap:     <span class="token number">4324</span> kB
HugetlbPages:          <span class="token number">0</span> kB
Threads:        <span class="token number">5</span>
SigQ:   <span class="token number">0</span>/3824
SigPnd: 0000000000000000
ShdPnd: 0000000000000000
SigBlk: 0000000000000000
SigIgn: 0000000000001001
SigCgt: 00000000000044ea
CapInh: 00000000a80425fb
CapPrm: 0000000000000000
CapEff: 0000000000000000
CapBnd: 00000000a80425fb
CapAmb: 0000000000000000
Seccomp:        <span class="token number">2</span>
Cpus_allowed:   <span class="token number">3</span>
Cpus_allowed_list:      <span class="token number">0</span>-1
Mems_allowed:   00000000,00000001
Mems_allowed_list:      <span class="token number">0</span>
voluntary_ctxt_switches:        <span class="token number">24583</span>
nonvoluntary_ctxt_switches:     <span class="token number">507</span>
</code></pre> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/status <span class="token operator">|</span> <span class="token function">grep</span> Seccomp
Seccomp:        <span class="token number">2</span>
</code></pre> 
<p>标志位含义为:0:关闭。1:严格。2:过滤</p> 
<h3><a id="6_Capabilities_406"></a>6. Capabilities</h3> 
<p><code>Capabilities</code>是关于进程或用户有权做什么的分组。这些功能可能包括多个系统调用或操作，例如更改系统时间或主机名。</p> 
<p>状态文件还包含了<code>Capabilities</code>标志。一个进程可以丢弃尽可能多的capability，以确保其安全。</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/status <span class="token operator">|</span> <span class="token function">grep</span> ^Cap
CapInh: 00000000a80425fb
CapPrm: 0000000000000000
CapEff: 0000000000000000
CapBnd: 00000000a80425fb
CapAmb: 0000000000000000
</code></pre> 
<p>标志被存储为一个可以用capsh解码的位掩码</p> 
<pre><code class="prism language-bash">$ capsh --decode<span class="token operator">=</span>00000000a80425fb
<span class="token assign-left variable">0x00000000a80425fb</span><span class="token operator">=</span>cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
</code></pre> 
<h3><a id="7__426"></a>7. 容器镜像</h3> 
<p>容器映像是一个包含tar文件的tar文件。每个tar文件都是一个层。一旦所有tar文件被提取到相同的位置，那么您就拥有了容器的文件系统。</p> 
<p>这可以通过Docker进行探索。把这些image放到本地系统上。</p> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> pull redis:3.2.11-alpine
<span class="token number">3.2</span>.11-alpine: Pulling from library/redis
ff3a5c916c92: Pull complete 
aae70a2e6027: Pull complete 
87c655da471c: Pull complete 
bc3141806bdc: Pull complete 
53616fb426d9: Pull complete 
9791c5883c6a: Pull complete 
Digest: sha256:ebf1948b84dcaaa0f8a2849cce6f2548edb8862e2829e3e7d9e4cd5a324fb3b7
Status: Downloaded newer image <span class="token keyword">for</span> redis:3.2.11-alpine
</code></pre> 
<p>将images导出为原始tar格式。</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> save redis:3.2.11-alpine <span class="token operator">&gt;</span> redis.tar
</code></pre> 
<pre><code class="prism language-bash">$ <span class="token function">tar</span> -xvf redis.tar
46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/
46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/VERSION
46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/json
46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/layer.tar
498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/
498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/VERSION
498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/json
498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/layer.tar
ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/
ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/VERSION
ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/json
ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/layer.tar
ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json
da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/
da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/VERSION
da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/json
da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/layer.tar
db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/
db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/VERSION
db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/json
db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/layer.tar
f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/
f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/VERSION
f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/json
f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/layer.tar
manifest.json
repositories
</code></pre> 
<p>所有的tar层文件现在都是可见的。</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span>
46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557
498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59
ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c
ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json
da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c
db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3
f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c
manifest.json
redis.tar
repositories
</code></pre> 
<p>images还包含关于images的元数据，如版本信息和标记名称.</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> repositories
<span class="token punctuation">{<!-- --></span><span class="token string">"redis"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"3.2.11-alpine"</span><span class="token builtin class-name">:</span><span class="token string">"46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

$ <span class="token function">cat</span> manifest.json
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"Config"</span><span class="token builtin class-name">:</span><span class="token string">"ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json"</span>,<span class="token string">"RepoTags"</span>:<span class="token punctuation">[</span><span class="token string">"redis:3.2.11-alpine"</span><span class="token punctuation">]</span>,<span class="token string">"Layers"</span>:<span class="token punctuation">[</span><span class="token string">"498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/layer.tar"</span>,<span class="token string">"ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/layer.tar"</span>,<span class="token string">"da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/layer.tar"</span>,<span class="token string">"db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/layer.tar"</span>,<span class="token string">"f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/layer.tar"</span>,<span class="token string">"46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/layer.tar"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<p>tar中文件</p> 
<pre><code class="prism language-bash">$ <span class="token function">tar</span> -xvf da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/layer.tar
etc/
etc/apk/
etc/apk/world
lib/
lib/apk/
lib/apk/db/
lib/apk/db/installed
lib/apk/db/lock
lib/apk/db/scripts.tar
lib/apk/db/triggers
sbin/
sbin/su-exec
var/
var/cache/
var/cache/misc/
</code></pre> 
<h3><a id="8__525"></a>8. 创建空镜像</h3> 
<p>由于images只是一个tar文件，可以使用下面的命令创建空images</p> 
<pre><code class="prism language-bash">$ <span class="token function">tar</span> cv --files-from /dev/null <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - empty
sha256:ba14edd8949ad44677f1955e37b9a35f9978d2a687b3f8ab86711811d46e2c53
</code></pre> 
<p>通过导入tar，将创建额外的元数据。</p> 
<pre><code class="prism language-bash">$ <span class="token function">docker</span> images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
empty               latest              ba14edd8949a        <span class="token number">24</span> seconds ago      0B
redis               <span class="token number">3.2</span>.11-alpine       ca0b6709748d        <span class="token number">3</span> years ago         <span class="token number">20</span>.7MB
</code></pre> 
<p>但是，由于容器不包含任何内容，所以它不能启动进程。</p> 
<h3><a id="9_Dockerfile_542"></a>9. 不使用Dockerfile创建镜像</h3> 
<p>可以扩展前面导入Tar文件的想法，从零开始创建整个映像。<br> 首先，我们将使用BusyBox作为基础。这将为我们提供基本的linux命令。它被定义为rootfs。rootfs是……<br> Docker提供了一个脚本来下载BusyBox rootfs<br> <a href="https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static">https://github.com/moby/moby/blob/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static</a></p> 
<pre><code class="prism language-bash">$ <span class="token function">curl</span> -LO https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x busybox-static
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>   <span class="token number">782</span>  <span class="token number">100</span>   <span class="token number">782</span>    <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">2177</span>      <span class="token number">0</span> --:--:-- --:--:-- --:--:--  <span class="token number">2184</span>
$ 

$ ./busybox-static busybox
</code></pre> 
<p>运行该脚本将下载rootfs和主二进制文件。</p> 
<pre><code class="prism language-bash">$ <span class="token function">ls</span> -lha busybox
total 20K
drwxr-xr-x  <span class="token number">5</span> root root <span class="token number">4</span>.0K Sep <span class="token number">27</span> 09:43 <span class="token builtin class-name">.</span>
drwx------ <span class="token number">15</span> root root <span class="token number">4</span>.0K Sep <span class="token number">27</span> 09:43 <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4</span>.0K Sep <span class="token number">27</span> 09:43 bin
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4</span>.0K Sep <span class="token number">27</span> 09:43 sbin
drwxr-xr-x  <span class="token number">4</span> root root <span class="token number">4</span>.0K Sep <span class="token number">27</span> 09:43 usr
</code></pre> 
<p>默认的Busybox rootfs不包含任何版本信息，所以让我们创建一个文件。</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">echo</span> KatacodaPrivateBuild <span class="token operator">&gt;</span> busybox/release
</code></pre> 
<p>与前面一样，该目录可以转换为tar，并自动导入到Docker中作为映像。</p> 
<pre><code class="prism language-bash">$ <span class="token function">tar</span> -C busybox -c <span class="token builtin class-name">.</span> <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - busybox
sha256:73b25a6703da535db5cbc43073c2920b60f5f8a76db17de093e851f1a2d5f69c
</code></pre> 
<p>现在可以将其作为容器启动。</p> 
<pre><code class="prism language-c">$ docker run busybox cat <span class="token operator">/</span>release
KatacodaPrivateBuild
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71da44473dae2a9dffa9f4bc258f5aac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql传统主从配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bafac7aa0303ab9bb698d04160ff41ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">可靠协调系统Zookeeper</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>