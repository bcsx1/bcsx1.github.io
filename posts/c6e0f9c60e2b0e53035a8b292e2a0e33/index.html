<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QoS服务质量四QoS边界行为之流量监管 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QoS服务质量四QoS边界行为之流量监管" />
<meta property="og:description" content="QoS服务质量四QoS边界行为之流量监管 二、QoS域边界节点的功能和行为1、流分类1.1、简单流分类1.2、复杂流分类2、流量监管2.1、标记2.1.1、流量监管工具CAR2.1.1.1、CAR两个功能2.1.1.2、CAR的位置2.1.1.3、CAR的处理步骤:分类、评估和处置。2.1.1.4、CAR处置动作2.1.1.5、CAR的处理流程2.1.1.6、CAR令牌桶参数设置2.1.1.7、接口下配置流量管制2.1.2、QoS优先级映射2.1.2.1、CoS调度优先级PHB2.1.2.2、信任边界2.1.2.3、实际应用对应二层、三层优先级2.2.2、QoS优先级配置2.2.3、交换机优先级映射的配置 二、QoS域边界节点的功能和行为 基于 DiffServ 服务模型的 QoS 业 务可以分为以下几大类：
流分类和标记（Traffic classification and marking）：要实现差分服务，需要首先将 数据包分为不同的类别或者设置为不同的优先级。将数据包分为不同的类别，称为 流分类，流分类并不修改原来的数据包。将数据包设置为不同的优先级称为标记， 而标记会修改原来的数据包。流量监管和整形（Traffic Policing and Shaping）：是指将业务流量限制在特定的带 宽，当业务流量超过额定带宽时，超过的流量将被丢弃或缓存。其中，将超过的流量丢弃的技术称为流量监管，将超过的流量缓存的技术称为流量整形。拥塞管理和避免（Congestion Management and Avoidance）：拥塞管理在网络发生 拥塞时，将报文放入队列中缓存，并采取某种调度算法安排报文的转发次序。而拥 塞避免可以监督网络资源的使用情况，当发现拥塞有加剧的趋势时采取主动丢弃报 文的策略，通过调整流量来解除网络的过载。端口镜像和流镜像（Port Mirror and Traffic Mirror）：镜像是将指定端口的指定报 文复制一份到镜像目的端口，镜像目的端口会与数据监测设备相连，用户利用这些 数据监测设备来分析复制到目的端口的报文，进行网络监控和故障排除。 流分类和标记是实现差分服务的前提和基础；流量监管、流量整形、拥塞管理和拥塞避免从不同方面对网络流量及其分配的资源实施控制，是提供差分服务的具体体现。
各层设备的作用：
接入层业务识别：接入交换机LSW作为边界交换机，在接入侧需要担负数据流的识别、分类以及流标记的工作；在网络侧需要担负不同应用数据流的拥塞管理、拥塞避免、流量整形等工作。出方向应用流量监管，限制进入广域网的流量。
汇聚层/核心层提供差分服务：汇聚层和核心层设备端口信任基于接入层标识的QoS参数，通过队列调度、流量整形、拥塞避免等方式实施QoS策略，保证高优先级业务优先获得调度。
1、流分类 分类的目：的是将符合条件的数据流划分到相应的类别中，以便后续的QoS 机制做实施控制处理。
当报文在 DiffServ 域边界被分类之后，网络的中间节点就可以根据分类，对不同类别的流量给予差别服务。下游（downstream）节点可以选择使用上游（upstream）节点的分类结果，也可以按照自己的分类标准对数据流重新进行分类。
分类方法：
业务流进入DS域时，可以有多种方法对它进行分类，例如依据报文携带的Cos、IP precedence、DSCP或MPLS 报文的 EXP 等优先级标记对其划分类别；或根据 MAC、目的 MAC、内外层 Tag、源 IP 地址、源端口号、目的 IP 地址、目的端口号或应用程序的端口号等信息对流进行分类，也可以根据业务等级协议 SLA 规定的一些策略给每个数据包加上标记，从而对数据包进行分类。
根据不同的方法实现流分类的技术可以被分成“简单流分类（Behavior Aggregate Classifier）”与“复杂流分类（Multi-Field Classifier）”。
1.1、简单流分类 根据 IP 报文的 VLAN 报文的 802.1p 值，IP 报文 的 ToS 值、IPv6 报文的 TC 值、MPLS 报文的 EXP 域值，对报文进行粗略的分类，以识别出具有不同优先级或服务等级特征的流量，实现外部优先级和内部优先级之间的映射。即根据优先级映射表，将上行报文携带的 QoS 优先级统一映射到设备内部的服务等级和颜色，将下行报文的内部的服务等级和颜色映射成为 QoS 优先级。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c6e0f9c60e2b0e53035a8b292e2a0e33/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T13:23:06+08:00" />
<meta property="article:modified_time" content="2023-03-17T13:23:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QoS服务质量四QoS边界行为之流量监管</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>QoS服务质量四QoS边界行为之流量监管</h4> 
 <ul><li><a href="#QoS_1" rel="nofollow">二、QoS域边界节点的功能和行为</a></li><li><a href="#1_17" rel="nofollow">1、流分类</a></li><li><a href="#11_27" rel="nofollow">1.1、简单流分类</a></li><li><a href="#12_67" rel="nofollow">1.2、复杂流分类</a></li><li><a href="#2_101" rel="nofollow">2、流量监管</a></li><li><a href="#21_117" rel="nofollow">2.1、标记</a></li><li><a href="#211CAR_131" rel="nofollow">2.1.1、流量监管工具CAR</a></li><li><a href="#2111CAR_134" rel="nofollow">2.1.1.1、CAR两个功能</a></li><li><a href="#2112CAR_138" rel="nofollow">2.1.1.2、CAR的位置</a></li><li><a href="#2113CAR_143" rel="nofollow">2.1.1.3、CAR的处理步骤:分类、评估和处置。</a></li><li><a href="#2114CAR_148" rel="nofollow">2.1.1.4、CAR处置动作</a></li><li><a href="#2115CAR_153" rel="nofollow">2.1.1.5、CAR的处理流程</a></li><li><a href="#2116CAR_168" rel="nofollow">2.1.1.6、CAR令牌桶参数设置</a></li><li><a href="#2117_181" rel="nofollow">2.1.1.7、接口下配置流量管制</a></li><li><a href="#212QoS_193" rel="nofollow">2.1.2、QoS优先级映射</a></li><li><a href="#2121CoSPHB_219" rel="nofollow">2.1.2.1、CoS调度优先级PHB</a></li><li><a href="#2122_229" rel="nofollow">2.1.2.2、信任边界</a></li><li><a href="#2123_297" rel="nofollow">2.1.2.3、实际应用对应二层、三层优先级</a></li><li><a href="#222QoS_301" rel="nofollow">2.2.2、QoS优先级配置</a></li><li><a href="#223_411" rel="nofollow">2.2.3、交换机优先级映射的配置</a></li></ul> 
</div> 
<p></p> 
<h2><a id="QoS_1"></a>二、QoS域边界节点的功能和行为</h2> 
<p>基于 DiffServ 服务模型的 QoS 业 务可以分为以下几大类：</p> 
<ul><li>流分类和标记（Traffic classification and marking）：要实现差分服务，需要首先将 数据包分为不同的类别或者设置为不同的优先级。将数据包分为不同的类别，称为 流分类，流分类并不修改原来的数据包。将数据包设置为不同的优先级称为标记， 而标记会修改原来的数据包。</li><li>流量监管和整形（Traffic Policing and Shaping）：是指将业务流量限制在特定的带 宽，当业务流量超过额定带宽时，超过的流量将被丢弃或缓存。其中，将超过的流量丢弃的技术称为流量监管，将超过的流量缓存的技术称为流量整形。</li><li>拥塞管理和避免（Congestion Management and Avoidance）：拥塞管理在网络发生 拥塞时，将报文放入队列中缓存，并采取某种调度算法安排报文的转发次序。而拥 塞避免可以监督网络资源的使用情况，当发现拥塞有加剧的趋势时采取主动丢弃报 文的策略，通过调整流量来解除网络的过载。</li><li>端口镜像和流镜像（Port Mirror and Traffic Mirror）：镜像是将指定端口的指定报 文复制一份到镜像目的端口，镜像目的端口会与数据监测设备相连，用户利用这些 数据监测设备来分析复制到目的端口的报文，进行网络监控和故障排除。</li></ul> 
<p>流分类和标记是实现差分服务的前提和基础；流量监管、流量整形、拥塞管理和拥塞避免从不同方面对网络流量及其分配的资源实施控制，是提供差分服务的具体体现。</p> 
<p><img src="https://images2.imgbox.com/61/b3/64neC7ww_o.png" alt="各层设备的作用"></p> 
<p><strong>各层设备的作用</strong>：<br> <strong>接入层业务识别</strong>：接入交换机LSW作为边界交换机，在接入侧需要担负数据流的识别、分类以及流标记的工作；在网络侧需要担负不同应用数据流的拥塞管理、拥塞避免、流量整形等工作。出方向应用流量监管，限制进入广域网的流量。</p> 
<p><strong>汇聚层/核心层提供差分服务</strong>：汇聚层和核心层设备端口信任基于接入层标识的QoS参数，通过队列调度、流量整形、拥塞避免等方式实施QoS策略，保证高优先级业务优先获得调度。</p> 
<h2><a id="1_17"></a>1、流分类</h2> 
<p><strong>分类的目</strong>：的是将符合条件的数据流划分到相应的类别中，以便后续的QoS 机制做实施控制处理。</p> 
<p>当报文在 DiffServ 域边界被分类之后，网络的中间节点就可以根据分类，对不同类别的流量给予差别服务。下游（downstream）节点可以选择使用上游（upstream）节点的分类结果，也可以按照自己的分类标准对数据流重新进行分类。</p> 
<p><strong>分类方法</strong>：<br> 业务流进入DS域时，可以有多种方法对它进行分类，例如依据报文携带的Cos、IP precedence、DSCP或MPLS 报文的 EXP 等优先级标记对其划分类别；或根据 MAC、目的 MAC、内外层 Tag、源 IP 地址、源端口号、目的 IP 地址、目的端口号或应用程序的端口号等信息对流进行分类，也可以根据业务等级协议 SLA 规定的一些策略给每个数据包加上标记，从而对数据包进行分类。</p> 
<p>根据不同的方法实现流分类的技术可以被分成“简单流分类（Behavior Aggregate Classifier）”与“复杂流分类（Multi-Field Classifier）”。</p> 
<h2><a id="11_27"></a>1.1、简单流分类</h2> 
<p>根据 IP 报文的 VLAN 报文的 802.1p 值，IP 报文 的 ToS 值、IPv6 报文的 TC 值、MPLS 报文的 EXP 域值，对报文进行粗略的分类，以识别出具有不同优先级或服务等级特征的流量，实现外部优先级和内部优先级之间的映射。即根据优先级映射表，将上行报文携带的 QoS 优先级统一映射到设备内部的服务等级和颜色，将下行报文的内部的服务等级和颜色映射成为 QoS 优先级。</p> 
<p><img src="https://images2.imgbox.com/46/bd/lxCKHzGr_o.png" alt="DSC">DSCP和IP Precedence<br> <img src="https://images2.imgbox.com/3c/59/wFWGj3aH_o.png" alt="IPv6报文"><br> IPv6报文<br> <img src="https://images2.imgbox.com/b8/b8/2CFugQiY_o.png" alt="MPLS EXP"><br> MPLS EXP报文</p> 
<p><img src="https://images2.imgbox.com/03/04/KjHFg6ux_o.png" alt="802.1p"><br> 802.1Q报文</p> 
<p>好处：简单流分类的好处是直接查看前面的报头，而无需关心更高层的标识。</p> 
<p>IP precedence、MPLS EXP、802.1p字段与DSCP字段对应关系</p> 
<table><thead><tr><th align="center">IP precedence</th><th align="center">MPLS EXP</th><th align="center">802.1p</th><th align="center">DSCP</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">8</td></tr><tr><td align="center">2</td><td align="center">2</td><td align="center">2</td><td align="center">16</td></tr><tr><td align="center">3</td><td align="center">3</td><td align="center">3</td><td align="center">24</td></tr><tr><td align="center">4</td><td align="center">4</td><td align="center">4</td><td align="center">32</td></tr><tr><td align="center">5</td><td align="center">5</td><td align="center">5</td><td align="center">40</td></tr><tr><td align="center">6</td><td align="center">6</td><td align="center">6</td><td align="center">48</td></tr><tr><td align="center">7</td><td align="center">7</td><td align="center">7</td><td align="center">56</td></tr></tbody></table> 
<p>DSCP字段与IP precedence、MPLS EXP、802.1p字段对应关系</p> 
<table><thead><tr><th align="center">DSCP</th><th align="center">IP precedence</th><th align="center">MPLS EXP</th><th align="center">802.1p</th></tr></thead><tbody><tr><td align="center">0-7</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">8-15</td><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">16-23</td><td align="center">2</td><td align="center">2</td><td align="center">2</td></tr><tr><td align="center">24-31</td><td align="center">3</td><td align="center">3</td><td align="center">3</td></tr><tr><td align="center">32-39</td><td align="center">4</td><td align="center">4</td><td align="center">4</td></tr><tr><td align="center">40-47</td><td align="center">5</td><td align="center">5</td><td align="center">5</td></tr><tr><td align="center">48-55</td><td align="center">6</td><td align="center">6</td><td align="center">6</td></tr><tr><td align="center">56-63</td><td align="center">7</td><td align="center">7</td><td align="center">7</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/d6/64/C7R052mN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="12_67"></a>1.2、复杂流分类</h2> 
<p>多种业务流共享同一网络资源，简单的流分类措施很难满足要求。这样，就要求网络具备很强的业务感知能力，能进行深度报文分析，对报文任意层次和字段的全面解析。</p> 
<p>由报文的源 MAC、目的 MAC、内外层 Tag、源 IP 地址、源端口号、目的 IP 地址、目的端口号等对报文进行精细的分类。指根据五元组（源地址、目的地址、源端口、目的端口、协议号）行精细的分类。复杂流分类主要部署在网络的边缘节点。</p> 
<p><img src="https://images2.imgbox.com/9a/99/tBXDcL6N_o.png" alt="在这里插入图片描述"></p> 
<p>将这些流分类和对应可实施的 流行为关联，形成流策略，并将流策略与指定接口、VLAN 或者全局绑定，可实现丰富 的 QoS 流策略，这就是基于复杂流分类的 QoS 流策略（通常被称为“基于类的 QoS”）。</p> 
<p><strong>QoS实现工具MQC</strong><br> MQC(Modular QoS Command-Line，模块化QoS命令行)，又叫流策略，是指通过将某些具有相同特征的报文划分为一类，并为这一类报文提供相同服务的配置方法。通过配置流策略，用户可以定义报文分类规则匹配需要单独处理的流量，然后将匹配的流量进行相应处理，达到自己想要的效果。</p> 
<p>通过MQC配置可以实现流量监管、重标记优先级等QoS业务，也可以实现流量统计、策略路由等其他网络常用功能，功能强大，配置灵活。</p> 
<p>MQC是“模板化”的 QoS 配置方式。 “模板化”的最大优点是可以节省配置，支持批量修改。</p> 
<p>定义流分类<br> MQC分类方法丰富多样，常用的报文分类规则有如下几种：</p> 
<ul><li>MAC地址</li><li>VLAN ID</li><li>802.1p优先级</li><li>EXP优先级</li><li>ACL</li><li>DSCP优先级</li><li>IP优先级</li><li>所有报文</li><li>出接口或入接口</li></ul> 
<p>MQC配置流分类命令：<br> <strong>traffic classifier</strong> classifier-name [ operator { and | or } ] [ precedence precedence-value ]<br> 配置具体的规则：<br> if-match 匹配条件</p> 
<h2><a id="2_101"></a>2、流量监管</h2> 
<p><strong>限速</strong>是对流经设备接口的报文速度做限制，使流量超出指定阀值的那部分直接被丢弃，而低于阀值的部分则进入或离开设备。</p> 
<ul><li>流量监管：流量监管简单粗暴，如果流量超速，则对超出部分的流量进行“惩罚”，直接丢弃。流量监管一般用于入方向，就像高速路，只有在入口限制进入高速公路车辆的数量，才能保证高速公路不变成“龟速公路”。</li><li>流量整形：和流量监管相比，流量整形要温柔得多，流量整形是用于限制某个或某些队列的输出速率，超速的报文不是直接丢弃，而是暂时存在缓存里，等空闲了还是会输出，只有缓存满了之后才会丢弃。这样使流量输出比较平稳，从而解决下游设备的拥塞问题，所以流量整形一般用于出方向。</li></ul> 
<p>流量监管TP(Traffic Policing)对用户流量进行监督的能力，使其符合SLA，通过配置流量监管，设备对符合流分类规则的报文流量进行监督，对于超过规格的流量，可以采取丢弃、重标记颜色、重标记服务等级动作。</p> 
<p>运营商之间都签有服务水平协议(SLA)，其中包含每种业务流的承诺速率 CIR (Committed Information Rate)、峰值速率 PIR(Peak Information Rate)、承诺突发尺寸 CBS(Committed Burst Size)、峰值突发尺寸 PBS(Peak Burst Size)等流量参数，对超 出 SLA 约定的流量报文可指定给予 pass（通过）、drop（直接丢弃）或 markdown（降级） 等处理，此处降级是指降低服务等级（Class of Service），或者是提高丢弃等级（Color）， 即报文在网络拥塞时将被优先丢弃，从而保证在 SLA 约定范围之内的报文享受到 SLA 预定的服务。</p> 
<p>对应 于 SLA 预定的处理动作，流量监管动作包括：</p> 
<ul><li>转发（pass）：对测量结果不超过承诺速率（CIR）的报文通常处理为继续正常转发。</li><li>丢弃（discard）：对测量结果超过峰值速率（PIR）的报文通常进行丢弃。</li><li>重标记（remark）：对处于 CIR 与 PIR 之间的流量通常执行 Remark 动作，此时的报文不丢弃，而是通过 Remark 降低优先级进行尽力而为转发。</li></ul> 
<p><img src="https://images2.imgbox.com/26/b6/7NHO4P0X_o.png" alt="流量监管TP"></p> 
<h2><a id="21_117"></a>2.1、标记</h2> 
<p>标记是对分类的流量打上不同的<strong>标签</strong>，据此分级别对待不同的数据，称为<strong>优先级标记</strong>。根据优先级标记的作用，华为设备可分为设备内部优先级(又称为本地优先级)和报文优先级(又称外部优先级)。设备内部优先级是对进到设备内部的数据报文给予的一个内部优先级标记值，根据该值可在设备内部分配或优化资源分配，如选择队列。</p> 
<p>● 设备内部优先级是用于内部资源分配和调度使用的值，每个进到设备的报文一定都会得到一个值，该值根据入<strong>接口配置的信任或Remark功能</strong>而生成。</p> 
<p>● 报文优先级是<strong>报文本身所携带的OoS标记值</strong>。两层报文使用802.1p或EXP而三层报文多使用IP Precedence和DSCP。报文在离开设备时，报文优先级可能会被重写，把内部优先级作为报文优先级携带出去。</p> 
<p>一般在DS边界节点对报文进行标记，DS节点对标记进行识别并提供差分服务即可。比如语音电话、视频终端等设备一般发送的报文都是携带设备默认的优先级值。若想通过自定义值来提供差分服务可以通过remake操作对报文进行重新标记。在DS边界节点上对报文重新进行remark，为DS域提供一个可信任的标记值。DS域内节点可根据此标记值进行QoS调度服务。</p> 
<p>标记可以通过多种方式实现，下面主要有两种基本方式：<br> (1)、CAR：对符合监管条件的报文进行<strong>重标记</strong>(remark)，标记的内容可以是IP precedence、DSCP、ATM CLP、FR DE、CoS、MPLS EXP等。</p> 
<p>(2)、映射表(map-table)：也称为<strong>优先级映射表</strong>，是一组全局配置的各种优先级之间的对应关系表，可以根据报文的某一优先级查表来重标记(remark)，其他的优先级或者改写此优先级。</p> 
<h2><a id="211CAR_131"></a>2.1.1、流量监管工具CAR</h2> 
<p>CAR(Committed Access Rate，承诺访问速率)，是一种流量策略的分类和标记的方法，它基于IP 优先级、DSCP 值、MAC 地址或者访问控制列表来限制IP流量的速率。也就是<strong>区分报文类型</strong>，使用令牌桶技术对各类流量进行<strong>测量</strong>，测量后的报文采用多种操作，包括放行、丢弃、重标记、转入下一级监管等多种操作。</p> 
<h2><a id="2111CAR_134"></a>2.1.1.1、CAR两个功能</h2> 
<ul><li><strong>流分类</strong>：通过令牌桶算法对流量进行测量，根据测量结果给报文打上不同的流分类内部标记（包括服务等级与丢弃优先级）。</li><li><strong>流量速率限制</strong>：通过使用令牌桶对流经端口的报文进行度量，使得在特定时间内只有得到令牌的流量通过，从而实现限速功能。</li></ul> 
<h2><a id="2112CAR_138"></a>2.1.1.2、CAR的位置</h2> 
<p>在设备的入方向上，CAR的处理在转发模块之前，只有被CAR放行的报文才能进行转发。</p> 
<p>在设备的出方向上，当拥塞未发生时，被CAR放行的报文将直接进入出接口的发送队列进行转发；拥塞发生时，被CAR放行的报文将进入出接口的用户队列进行调度。</p> 
<h2><a id="2113CAR_143"></a>2.1.1.3、CAR的处理步骤:分类、评估和处置。</h2> 
<ul><li>分类：报文是否符合匹配条件，Y进行评估；N直接转发。</li><li>评估：送往令牌桶测量，根据测量结果对报文进行染色，报文会被染成green、yellow、red三种颜色。</li><li>处置：转发（pass）、丢弃（discard）、重标记（remark）。</li></ul> 
<h2><a id="2114CAR_148"></a>2.1.1.4、CAR处置动作</h2> 
<ul><li>转发（pass）：对测量结果不超过承诺速率(CIR)的报文通常处理为继续正常转发。</li><li>丢弃（discard）：对测量结果超过峰值速率(PIR)的报文通常进行丢弃。</li><li>重标记（remark）：对处于 CIR 与 PIR 之间的流量通常执行 Remark 动作，此时的报文不丢弃，而是通过 Remark 降低优先级进行尽力而为转发。修改报文内部优先级后再转发。</li></ul> 
<h2><a id="2115CAR_153"></a>2.1.1.5、CAR的处理流程</h2> 
<ul><li>流量速率限制：通过使用令牌桶对流经端口的报文进行度量，使得在特定时间内只有得到令牌的流量通过，从而实现限速功能。</li><li>流分类：通过令牌桶算法对流量进行测量，根据测量结果给报文打上不同的流分类内部标记（包括服务等级与丢弃优先级）。<br> <img src="https://images2.imgbox.com/a2/f8/RYHUByKW_o.png" alt="CAR的处理流程"><br> 上图中CAR的处理流程：<br> (1)、在入方向报文到来时，首先检查端口的匹配规则，如果匹配上了，则进行速率控制，报文进入令牌桶中进行流量速率评估。</li></ul> 
<p>(2)、令牌桶评估后，报文被标记为红、黄、绿三种颜色。红色表示报文速率过大，不符合规定；黄色表示虽然不符合规定但允许临时的突发，绿色表示符合规定。</p> 
<p>(3)、报文标为红色的直接丢弃，黄色则重新标记后转发，绿色则直接转发。</p> 
<p>CAR支持单速单桶、单速双桶、双速双桶的标记方式。单速单桶模式不允许流量突发，报文颜色绿色或红色；单速双桶模式允许流量突发，报文颜色绿色、黄色或红色；双速双桶模式允许流量速率突发，报文颜色绿色、黄色或红色。</p> 
<p>流量评估中三色模式，绿色表示通行，黄色表示警告，红色为禁止通行。令牌桶分为：色盲模式，即不关注报文之前的颜色；色敏模式，即关注报文之前的颜色。</p> 
<h2><a id="2116CAR_168"></a>2.1.1.6、CAR令牌桶参数设置</h2> 
<p>令牌桶算法的带宽参数设置取决于实际网络业务的限速需要。单速双桶模式中，若EBS等于0，则其效果和单速单桶模型是一样的；在双速双通模型中，若PIR=CIR，则效果和单速单桶是一样的。</p> 
<p>超额突发流量EBS，单位为 bit，如果不允许有突发流量的话，EBS只要设置成 0。要使令牌桶有扩展突发能力只要EBS设置的大于 0。EBS桶深是一个重要参数，具体该如何设置，则取决于具体的业务流量情况。原则上，桶深需要满足如下条件：</p> 
<ul><li>桶深≥MTU</li><li>桶深≥业务流量的正常突发</li></ul> 
<p>华为交换机总结的经验性公式:</p> 
<ul><li>带宽≤100Mbps 时，桶深(Bytes)=带宽(Kbps) * 1000(ms)/8</li><li>带宽&gt;100Mbps 时，桶深(Bytes)=100,000(Kbps) * 1000(ms)/8</li></ul> 
<p>突发流量速率 PIR 的设置也是方案使用和命令配置中不可避免的，在工程上 PIR 的速率一般定义为 CIR 的 1.5 倍，即PIR=CIRx1.5，过大的 PIR 会导致设备过高的负荷。</p> 
<h2><a id="2117_181"></a>2.1.1.7、接口下配置流量管制</h2> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">Huawei</span><span class="token punctuation">]</span><span class="token keyword">interface</span> s4<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token punctuation">[</span><span class="token class-name">Huawei</span><span class="token operator">-</span><span class="token class-name">Serial4</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span>qos car outbound acl <span class="token number">3999</span> cir <span class="token number">8000</span> pir <span class="token number">10000</span> cbs <span class="token number">1000000</span> pbs <span class="token number">1250000</span> green  pass  yellow  pass  red  discard
</code></pre> 
<p>在s4/0/0接口出方向配置了流量管制（限速），匹配acl3999的流量将会执行car限速管理，保证速率cir=8000kbps=8Mbps/s，允许最大速率pir=10Mbps/s，cbs桶大小=1000000byte=8000kbit，第二个令牌桶pbs桶大小 =1250000byte=10kbit（同样对应了pir的10Mbps/s），后面的green、yellow、red三种颜色分别对应了小于cbs桶的流量为允许、&gt;cbs＜pbs桶的流量为允许、大于pbs桶的流量为丢弃等动作，也可以自定义这些颜色的动作（是否丢弃、重新标记等）。</p> 
<p>注意：<br> cbs、pbs的大小可以不用配置，系统会根据定义的cir和pir的值自动计算，比如上面的命令等价于qos car outbound acl 3999 cir 8000 pir 10000）</p> 
<h2><a id="212QoS_193"></a>2.1.2、QoS优先级映射</h2> 
<p>优先级映射用来实现<strong>报文携带</strong>的QoS优先级与<strong>设备内部优先级</strong>（又称为本地优先级，是设备为报文分配的具有本地意义的优先级）之间的转换，从而使设备根据内部优先级为不同报文提供有差别的QoS服务质量。</p> 
<p>不同网络中的报文使用不同的优先级字段，例如二层网络中的报文使用802.1p优先级，三层网络中的报文使用DSCP优先级。报文在进入设备时，设备将<strong>报文携带的优先级映射到内部服务等级和颜色</strong>，再根据服务等级和颜色对报文进行不同的QoS服务。报文在出设备时，设备可以根据<strong>内部服务等级和颜色重标记报文优先级</strong>，以便后续网络根据报文优先级进行服务。</p> 
<p><img src="https://images2.imgbox.com/3e/ac/dkFBKqqL_o.png" alt="内部优先级"></p> 
<p>不同的报文使用不同的QOS优先级，例如VLAN报文使用802.1p，IP报文使用DSCP，MPLS报文使用EXP。当报文经过不同网络，为了保持报文的优先级，需要在连接不同网络的网关处配置这些优先级标记的映射关系。</p> 
<p>而在DiffServ模型中，不同DS域允许有不同的PHB映射关系，以实现不同的服务提供策略，因此设备需要允许管理员定义DS域并针对不同的DS域设定不同的优先级关系。</p> 
<p><img src="https://images2.imgbox.com/3a/8e/8oq7TIVL_o.png" alt="不同的DS域优先级关系"><br> 信任边界不信任任何外部网络进来的报文优先级。</p> 
<p><img src="https://images2.imgbox.com/0b/ff/GcXmRI0Z_o.png" alt="QoS优先级映射"></p> 
<p>上行方向：不同的报文使用不同的 QoS 优先级，例如以太报文使用 802.1p，IP 报文使用 DSCP或者IP precedence， MPLS 报文使用 EXP。</p> 
<p>在报文进设备时，为了保证不同报文的服务质量，需要将报文携带的QoS优先级统一映射到设备内部的服务等级<strong>Class of Service</strong>（也叫做调度优先级PHB）和丢弃优先级（也叫颜色Color），在设备内部，根据报文的服务等级进行拥塞管理，根据报文的颜色进行拥塞避免；在报文出设备时，需要将内部的服务等级和颜色映射为QoS优先级，以便后续网络设备能够根据QoS优先级提供相应的服务质量。</p> 
<p><img src="https://images2.imgbox.com/6f/32/lJe7d0CS_o.png" alt="服务等级和颜色映射为QoS优先级"></p> 
<p>下行方向：将 QoS 优先级映射到服务等级和颜色是在报文上行方向进行，而服务等级和颜色映射为 QoS 优先级则是在下行方向进行。</p> 
<h2><a id="2121CoSPHB_219"></a>2.1.2.1、CoS调度优先级PHB</h2> 
<p>CoS （Class of Service，服务等级）是指报文在设备内部的服务等级，支持 8 种取值，优先级从高到低依次为 CS7、CS6、EF、AF4、AF3、AF2、AF1、BE。<br> <img src="https://images2.imgbox.com/08/38/dIZGcK1T_o.png" alt="CoS调度优先级 PHB"></p> 
<p><strong>Color</strong></p> 
<p>Color是指报文在设备内部的丢弃优先级，用于实现同一个队列内部，当队列发生拥塞时报文丢弃顺序。Color支持3种取值，IEEE定义的优先级从低到高依次为Green、Yellow、Red。</p> 
<p>丢弃优先级的高低实际取决于对应参数的配置，例如：配置Green最大只能使用50%缓存，Red最大可以使用100%缓存，则Green的丢弃优先级比Red高。</p> 
<h2><a id="2122_229"></a>2.1.2.2、信任边界</h2> 
<p>设备内部优先级是用于内部资源分配和调度使用的值，每个进到设备的报文一定都会得到一个值，该值根据入接口配置的信任或Remark功能而生成。根据接口配置的信任状态决定设备内部的优先级。</p> 
<p><strong>1、优先级不信任模式</strong><br> 第三方设备或外部网络或终端等设备所代表的区域称为非信任域。服务质量工程师在设计QoS时会在接入层交换机或企业边缘设备入口上设置不信任状态。</p> 
<p><strong>2、优先级信任模式</strong><br> 在网络中间设备上重新标记报文优先级。我们把信任报文优先级的设备所组成的网络区域称为信任域。对于不同设备，都有不同的优先级信任模式，下游节点可以选择使用上游节点的分类结果，也可以按照自己的分类标准对数据流重新进行分类。信任（trust）从连接上游节点的端口接收的报文所携带的QoS标记。通常路由交换设备通常有四种信任模式：</p> 
<p>①信任报文的802.1p优先级：配置信任802.1p优先级时，设备根据报文的802.1p优先级对报文进行分类并进行后续的优先级映射，得到报文映射后的802.1p优先级，IP优先级，或DSCP优先级。缺省情况下，端口信任报文的802.1p优先级。</p> 
<p><strong>映射表</strong>也称为优先级映射表，是一组全局配置的各种优先级之间的对应关系表。</p> 
<p>802.1p优先级映射表</p> 
<table><thead><tr><th align="left">802.1p优先级</th><th align="left">PHB</th><th align="left">Color</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">BE</td><td align="left">Green</td></tr><tr><td align="left">1</td><td align="left">AF1</td><td align="left">Green</td></tr><tr><td align="left">2</td><td align="left">AF2</td><td align="left">Green</td></tr><tr><td align="left">3</td><td align="left">AF3</td><td align="left">Green</td></tr><tr><td align="left">4</td><td align="left">AF4</td><td align="left">Green</td></tr><tr><td align="left">5</td><td align="left">EF</td><td align="left">Green</td></tr><tr><td align="left">6</td><td align="left">CS6</td><td align="left">Green</td></tr><tr><td align="left">7</td><td align="left">CS7</td><td align="left">Green</td></tr></tbody></table> 
<p>②信任报文的DSCP优先级：配置信任DSCP优先级时，设备根据报文的DSCP优先级对报文进行分类并进行后续的优先级映射，得到报文映射后的802.1p优先级，或DSCP优先级，或丢弃优先级（只有支持DSCP优先级的IP报文才可映射丢弃优先级，因为只有这类报文才有这样的数据位。）</p> 
<p>DSCP优先级对应PHB：<br> <img src="https://images2.imgbox.com/2c/c5/bq6lL78O_o.png" alt="DSCP优先级映射表"></p> 
<p>DSCP优先级与其他优先级的映射</p> 
<table><thead><tr><th align="center">Input DSCP</th><th align="center">Output IP precedence</th><th align="center">Output MPLS EXP</th><th align="center">Output 802.1p</th></tr></thead><tbody><tr><td align="center">0-7</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">8-15</td><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">16-23</td><td align="center">2</td><td align="center">2</td><td align="center">2</td></tr><tr><td align="center">24-31</td><td align="center">3</td><td align="center">3</td><td align="center">3</td></tr><tr><td align="center">32-39</td><td align="center">4</td><td align="center">4</td><td align="center">4</td></tr><tr><td align="center">40-47</td><td align="center">5</td><td align="center">5</td><td align="center">5</td></tr><tr><td align="center">48-55</td><td align="center">6</td><td align="center">6</td><td align="center">6</td></tr><tr><td align="center">56-63</td><td align="center">7</td><td align="center">7</td><td align="center">7</td></tr></tbody></table> 
<p>③信任报文的IP优先级：配置交换机端口信任IP优先级，此时将按照报文中所携带的IP优先级查找对应的IP优先级映射表，得到报文映射后的802.1p优先级或IP优先级。</p> 
<p>IP优先级映射表</p> 
<table><thead><tr><th align="left">IP precedence</th><th align="left">PHB</th><th align="left">Color</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">BE</td><td align="left">Green</td></tr><tr><td align="left">1</td><td align="left">AF1</td><td align="left">Green</td></tr><tr><td align="left">2</td><td align="left">AF2</td><td align="left">Green</td></tr><tr><td align="left">3</td><td align="left">AF3</td><td align="left">Green</td></tr><tr><td align="left">4</td><td align="left">AF4</td><td align="left">Green</td></tr><tr><td align="left">5</td><td align="left">EF</td><td align="left">Green</td></tr><tr><td align="left">6</td><td align="left">CS6</td><td align="left">Green</td></tr><tr><td align="left">7</td><td align="left">CS7</td><td align="left">Green</td></tr></tbody></table> 
<p>④信任报文的MPLS EXP优先级：此时将按照报文中所携带的IP优先级查找对应的MPLS EXP优先级映射表，得到报文映射后的802.1p优先级或IP优先级。</p> 
<table><thead><tr><th align="left">MPLS EXP</th><th align="left">PHB</th><th align="left">Color</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">BE</td><td align="left">Green</td></tr><tr><td align="left">1</td><td align="left">AF1</td><td align="left">Green</td></tr><tr><td align="left">2</td><td align="left">AF2</td><td align="left">Green</td></tr><tr><td align="left">3</td><td align="left">AF3</td><td align="left">Green</td></tr><tr><td align="left">4</td><td align="left">AF4</td><td align="left">Green</td></tr><tr><td align="left">5</td><td align="left">EF</td><td align="left">Green</td></tr><tr><td align="left">6</td><td align="left">CS6</td><td align="left">Green</td></tr><tr><td align="left">7</td><td align="left">CS7</td><td align="left">Green</td></tr></tbody></table> 
<h2><a id="2123_297"></a>2.1.2.3、实际应用对应二层、三层优先级</h2> 
<p><img src="https://images2.imgbox.com/fd/cd/UXOZHrFK_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="222QoS_301"></a>2.2.2、QoS优先级配置</h2> 
<p>1、配置对应的全局映射表<br> #配置优先级映射关系</p> 
<p>报文的802.1优先级查找DSCP映射表，生成内部优先级。802.1优先级到DSCP的映射。</p> 
<pre><code class="prism language-java"> <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> qos map<span class="token operator">-</span>table dot1p<span class="token operator">-</span>dscp       <span class="token comment">//map-table映射802.1p到DSCP映射表</span>
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span>maptbl<span class="token operator">-</span>dot1p<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">3</span> output <span class="token number">26</span>     <span class="token comment">//802.1p优先级3对应DSCP优先级26</span>
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span>maptbl<span class="token operator">-</span>dot1p<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">5</span> output <span class="token number">46</span>    <span class="token comment">//802.1p优先级5对应DSCP优先级46</span>
</code></pre> 
<p>设备按照报文携带的DSCP值查找DSCP优先级映射表，生成内部优先级。默认情况下，报文的DSCP优先级和内部优先级是一一对应的关系，可以使用命令qos map-tab1e dscp-dscp进行修改。</p> 
<pre><code class="prism language-java">#配置优先级映射关系，修改默认映射表
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> qos map<span class="token operator">-</span>table dscp<span class="token operator">-</span>dscp
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span>maptbl<span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">24</span> output <span class="token number">26</span>  <span class="token comment">//DSCP优先级24对应内部优先级26</span>
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span>maptbl<span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">40</span> output <span class="token number">46</span>  <span class="token comment">//DSCP优先级40对应内部优先级46</span>
</code></pre> 
<p>2、入接口上配置报文信任模式：<br> (1)、信任报文的802.1p优先级——trust 8021p</p> 
<ul><li>对于<strong>带VLAN Tag</strong>的报文，设备根据报文携带的802.1p优先级查找优先级映射表，<strong>生成内部优先级</strong>，确定报文进入的队列，并修改报文的优先级值。</li><li>对于<strong>不带VLAN Tag</strong>的报文，设备将使用端口优先级作为802.1p 优先级，查找优先级映射表，确定报文进入的队列，并<strong>可以</strong>修改报文的优先级值。</li><li>建议LAN中使用信任802.1p生成内部优先级。</li><li>进到设备的802.1p为3的报文,在设备内部使用内部优先级AF31。同理, 802.1p为5的报文。在设备内部分配内部优先级EF。</li><li>当报文从出口离开设备时，报文优先级没有被改写。</li></ul> 
<p>配置案例：<br> #配置Eth2/0/0和Eth2/0/1接口信任报文的802.1p优先级</p> 
<pre><code class="prism language-java"> <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> ethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> trust <span class="token number">8021</span>p
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> quit
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> ethermnet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust <span class="token number">8021</span>p
 <span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>(2)、信任的报文的DSCP优先级一一trust dscp</p> 
<pre><code class="prism language-java">#配置<span class="token class-name">Eth2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>和<span class="token class-name">Eth2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>接口信任报文的dscp优先级
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> ethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">]</span> quit

<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> ethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>(3)、信任的报文的exp优先级一一trust exp<br> 设备按照报文携带的exp值查找DSCP优先级映射表，生成内部优先级。eNSP模拟器上不能设置，实际使用是可以设置的。</p> 
<p>注意：<br> 配置override关键词后，离开设备的报文的802.1p值、DSCP值均被修改成内部优先级。</p> 
<p>端口处于不信任状态时，即没有配置任何Trust 命令，所有报文都将根据端口优先级进入一个队列，无法实现差分服务。</p> 
<p>(4)、上行映射（BA）<br> 报文一进入设备，如果入接口配置了trust upstream命令，则设备上行单板（接口入方向）会根据报文优先级，对照入映射表来重新设置&lt;Service-class, color&gt;，这一过程称为“上行映射（BA）”。<br> <img src="https://images2.imgbox.com/ab/af/IVP9Vdfw_o.png" alt="在这里插入图片描述"></p> 
<p>1、如果对报文配置remark，或者car后remark动作，则设备上行单板会直接去修改报文的&lt;Service-class(服务等级)，color&gt;。</p> 
<p>2、上一步完成后，设备根据&lt;Service-class, color&gt;来对报文进行队列调度等一系列QoS动作。</p> 
<p>3、这些QoS动作做完之后，设备下行单板（接口出方向）还要做出一个决定：是否根据内部优先级修改报文优先级，因为有些场景是不希望改变报文优先级的。根据内部优先级修改报文优先级的过程称为“下行反映射（PHB）”。</p> 
<p>BA和PHB开关，默认情况下，BA开关为关闭状态，PHB开关为关闭状态。<br> 只有两个开关同时打开，才会做反映射动作。</p> 
<p>接口运行trust upstream命令同时打开开关</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> ethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">RouterA</span><span class="token operator">-</span><span class="token class-name">Ethernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust upstream   <span class="token comment">//上行单板会执行BA，下行单板会执行PHB。</span>
</code></pre> 
<p>PHB动作的控制：</p> 
<ul><li>打开"BA"开关的方法：接口入方向配置"trust upstream"、“remark”、"service-class"命令。</li><li>关闭"BA"开关的方法：接口入方向配置service-class class-value color color-value no-remark命令，或者移除上述3条命令的配置。</li><li>打开"PHB"开关的方法：接口出方向配置"trust upstream"或者"qos phb enable"命令。</li><li>关闭"PHB"开关的方法：接口出方向配置"qos phb disable"命令或者删除"trust upstream"命令。</li></ul> 
<p>报文入接口的配置trust upstream命令:</p> 
<table><thead><tr><th align="left">TCP/IP模型</th><th align="left">报文类型</th><th align="left">被信任优先级</th></tr></thead><tbody><tr><td align="left">三层</td><td align="left">IPoE、IPoVLAN、IPoQinQ</td><td align="left">DSCP</td></tr><tr><td align="left">三层</td><td align="left">IPoPPP、IPoHDLC、IPoFR</td><td align="left">DSCP</td></tr><tr><td align="left">三层</td><td align="left">MPLS</td><td align="left">DSCP</td></tr><tr><td align="left">三层</td><td align="left">其他类型报文</td><td align="left">设备能识别出的报文被映射到&lt;CS6,Green&gt;，无法识别的报文，则被映射到&lt;BE,Green&gt;。</td></tr><tr><td align="left">二层</td><td align="left">VLAN</td><td align="left">802.1p</td></tr><tr><td align="left">二层</td><td align="left">QinQ</td><td align="left">外层TAG的802.1p</td></tr><tr><td align="left">二层</td><td align="left">非VLAN也非QinQ</td><td align="left">不信任任何字段。报文被映射到&lt;BE,Green&gt;。</td></tr></tbody></table> 
<p>注意：三层其他类型报文中可识别报文为协议报文，例如IS-IS报文、ARP报文、PPPoE报文等，因此映射到高优先级队列CS6。设备无法识别的报文，则被映射到&lt;BE,Green&gt;。通常这类报文为错误报文，因此映射到BE队列。</p> 
<p>出接口配置trust upstreamt、trust 8021p命令修改的优先级:</p> 
<table><thead><tr><th align="left">trust upstream命令</th><th align="left">trust 8021p命令</th><th align="left">反映射动作中修改的优先级</th></tr></thead><tbody><tr><td align="left">不配置</td><td align="left">配置</td><td align="left">不修改报文优先级</td></tr><tr><td align="left">配置</td><td align="left">不配置</td><td align="left">MPLS报文：仅修改外层标签的EXP；非MPLS报文：仅修改DSCP</td></tr><tr><td align="left">配置</td><td align="left">配置</td><td align="left">仅修改外层802.1p</td></tr></tbody></table> 
<h2><a id="223_411"></a>2.2.3、交换机优先级映射的配置</h2> 
<p>应用场景：不同网络中的报文使用不同的优先级字段，例如二层网络中的报文使用802.1p优先级，三层网络中的报文使用DSCP优先级。报文在<strong>进入设备</strong>时，设备将报文携带的优先级映射到<strong>内部服务等级和颜色</strong>，再根据服务等级和颜色对报文进行不同的QoS服务。报文在出设备时，设备可以根据内部服务等级和颜色重标记报文优先级，以便后续网络根据报文优先级进行服务。</p> 
<p>1、配置端口优先级<br> [SW2] <strong>interface</strong> <em>interface-type interface-number</em><br> 配置端口优先级。<br> [SW2-GigabitEthernet0/0/0] <strong>port priority</strong> priority-value //缺省情况下，端口优先级为0。<br> 当接口通过undo portswitch切换到三层模式后，不能配置端口优先级值，端口优先级值均为0。<br> 2、配置DiffServ域<br> 创建DiffServ域并进入DiffServ域视图。<br> [SW2] <strong>diffserv domain</strong> { <strong>default</strong> | ds-domain-name }<br> 在接口入方向，将VLAN报文的802.1p优先级映射为PHB行为，并为报文着色<br> [SW2-dsdomain-ds1] <strong>8021p-inbound</strong> 8021p-value <strong>phb</strong> service-class [ green | yellow | red ]</p> 
<p>在接口出方向，将PHB行为/颜色映射为VLAN报文的802.1p优先级<br> [SW2-dsdomain-ds1] <strong>8021p-outbound</strong> service-class { green | yellow | red } <strong>map</strong> 8021p-value</p> 
<p>在接口入方向，将IP报文的DSCP优先级映射为PHB行为，并为报文着色<br> [SW2-dsdomain-ds1] <strong>ip-dscp-inbound</strong> dscp-value <strong>phb</strong> service-class [ green | yellow | red ]<br> 在接口出方向，将PHB行为/颜色映射为IP报文的DSCP优先级<br> [SW2-dsdomain-ds1] <strong>ip-dscp-outbound</strong> service-class { green | yellow | red } <strong>map</strong> dscp-value</p> 
<p>在接口入方向，将MPLS报文的EXP优先级映射为PHB行为，并为报文着色<br> [SW2-dsdomain-ds1] <strong>mpls-exp-inbound</strong> exp-value <strong>phb</strong> service-class [ color ]<br> 在接口出方向，将PHB行为/颜色映射为MPLS报文的EXP优先级<br> [SW2-dsdomain-ds1] <strong>mpls-exp-outbound</strong> service-class color <strong>map</strong> exp-value</p> 
<p>3、应用DiffServ域<br> [SW2] <strong>interface</strong> <em>interface-type interface-number</em><br> 在接口上绑定DiffServ域<br> [SW2-GigabitEthernet0/0/0] <strong>trust upstream</strong> { ds-domain-name | <strong>default</strong> | none } //none不做优先级映射<br> 取消对接口出方向的报文进行PHB映射<br> [SW2-GigabitEthernet0/0/1] undo qos phb marking enable</p> 
<p>4、内部优先级和队列之间的映射<br> 配置内部优先级和队列之间的映射关系。<br> [SW2] <strong>qos local-precedence-queue-map</strong> local-precedence queue-index</p> 
<p>5、检查优先级映射配置结果<br> 查看DiffServ域的配置信息。<br> [SW2] <strong>display diffserv domain</strong> [ all | name ds-domain-name ]</p> 
<p>综合案例：<br> 企业部门1的服务等级高，需要得到更好的QoS保证。来自企业部门1和2的报文802.1p值均为0，通过定义DiffServ域，将来自企业部门1的数据报文优先级映射为4，将来自企业部门2的数据报文优先级映射为2，以提供差分服务。<br> <img src="https://images2.imgbox.com/09/41/Ue5nAkq0_o.png" alt="在这里插入图片描述"><br> 配置思路：</p> 
<ul><li>创建VLAN，并配置各接口，企业部门1和企业部门2都能够通过Switch访问网络。</li><li>创建DiffServ域，将802.1p优先级映射为PHB行为和颜色。</li><li>在Switch入接口GE1/0/1和GE1/0/2上绑定DiffServ域。</li></ul> 
<p>具体配置：<br> 创建VLAN 100和VLAN 200。</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>HUAWEI<span class="token punctuation">&gt;</span></span> system<span class="token operator">-</span>view
<span class="token punctuation">[</span>HUAWEI<span class="token punctuation">]</span> sysname <span class="token class-name">Switch</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> vlan batch <span class="token number">100</span> <span class="token number">200</span>
</code></pre> 
<p>配置VLAN与具体接口</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">100</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">200</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port link<span class="token operator">-</span>type trunk
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> port trunk allow<span class="token operator">-</span>pass vlan <span class="token number">100</span> <span class="token number">200</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet2</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>创建并配置DiffServ域，配置将部门1和部门2的802.1p优先级映射到本地优先级。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> diffserv domain ds1
<span class="token comment">//802.1p优先级为0的报文。根据8021p-inbound 0 phb af4 green命令，将其PHB映射成AF4。报文进入队列4。</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span>dsdomain<span class="token operator">-</span>ds1<span class="token punctuation">]</span> <span class="token number">8021</span>p<span class="token operator">-</span>inbound <span class="token number">0</span> phb af4 green
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span>dsdomain<span class="token operator">-</span>ds1<span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> diffserv domain ds2
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span>dsdomain<span class="token operator">-</span>ds2<span class="token punctuation">]</span> <span class="token number">8021</span>p<span class="token operator">-</span>inbound <span class="token number">0</span> phb af2 green
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span>dsdomain<span class="token operator">-</span>ds2<span class="token punctuation">]</span> quit
</code></pre> 
<p>将DiffServ域绑定到接口</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust upstream ds1
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> trust upstream ds2
<span class="token punctuation">[</span><span class="token class-name">Switch</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>Switch上接口GE1/0/3队列4的显示信息。<br> [Switch] display qos queue statistics interface GigabitEthernet 1/0/3</p> 
<p><strong>qos map-table模型：</strong><br> SwitchC与路由器互连，部门1和部门2可经由SwitchA和SwitchB访问网络。部门1和部门2分别属于VLAN 100和VLAN 200。部门1需要得到更好的QoS保证，因此将来自部门1的数据报文DSCP优先级映射为45，将来自部门2的数据报文DSCP优先级映射为30。设备信任报文的DSCP优先级。当拥塞发生时，优先处理DSCP优先级高的报文。</p> 
<p>配置思路：</p> 
<ul><li>创建VLAN，并配置各接口，使企业都能够访问网络。</li><li>配置优先级映射，将来自部门1的数据报文DSCP优先级映射为45，将来自部门2的数据报文DSCP优先级映射为30。</li></ul> 
<p>SwitchA上的配置<br> 配置接口信任报文的DSCP优先级。</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>配置优先级映射</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token punctuation">]</span> qos map<span class="token operator">-</span>table dscp<span class="token operator">-</span>dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">63</span> output <span class="token number">45</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchA</span><span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> quit
</code></pre> 
<p>SwitchB上的配置</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span> quit
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token punctuation">]</span> <span class="token keyword">interface</span> gigabitethernet <span class="token number">0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> trust dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span><span class="token class-name">GigabitEthernet0</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> quit
</code></pre> 
<p>配置优先级映射</p> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token punctuation">]</span> qos map<span class="token operator">-</span>table dscp<span class="token operator">-</span>dscp
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> input <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">63</span> output <span class="token number">30</span>
<span class="token punctuation">[</span><span class="token class-name">SwitchB</span><span class="token operator">-</span>dscp<span class="token operator">-</span>dscp<span class="token punctuation">]</span> quit
</code></pre> 
<p>配置完成后可以通过命令display qos map-table dscp-dscp查看配置的映射关系表。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/32a6bc4ef26532309cabf480db502ff1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">BUUCTF MISC 41-60</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57c35ca9c07bc1d822ceadcbfe7f66bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">QoS服务质量五QoS边界行为之流量整形</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>