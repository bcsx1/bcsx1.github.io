<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 中 logging 模块的基本用法 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python 中 logging 模块的基本用法" />
<meta property="og:description" content="文章目录 日志记录的重要性日志记录的流程框架为什么要使用日志日志记录的基本信息 日志等级日志字段信与格式 日志logging和print进行比较logging模块的使用方式 两种记录日志方式使用logging提供的模块级别函数详细说明使用logging日志系统的四大组件 日志器 - Logger处理器 - Handler过滤器 - filters格式化器 - Formatter组件之间的关系 代码的实现与具体应用 使用python代码实现日志配置使用配置文件和fileConfig()函数实现日志配置使用dict配置信息和dictConfig()函数实现日志配置 崔庆才相关教程 LevelHandlerFormatter捕获 Traceback配置共享文件配置日志记录使用常见误区 项目日志使用参考文献 日志记录的重要性 在开发过程中，如果程序运行出现了问题，我们是可以使用我们自己的 Debug 工具来检测到到底是哪一步出现了问题，如果出现了问题的话，是很容易排查的。但程序开发完成之后，我们会将它部署到生产环境中去，这时候代码相当于是在一个黑盒环境下运行的，我们只能看到其运行的效果，是不能直接看到代码运行过程中每一步的状态的。在这个环境下，运行过程中难免会在某个地方出现问题，甚至这个问题可能是我们开发过程中未曾遇到的问题，碰到这种情况应该怎么办？ 如果我们现在只能得知当前问题的现象，而没有其他任何信息的话，如果我们想要解决掉这个问题的话，那么只能根据问题的现象来试图复现一下，然后再一步步去调试，这恐怕是很难的，很大的概率上我们是无法精准地复现这个问题的，而且 Debug 的过程也会耗费巨多的时间，这样一旦生产环境上出现了问题，修复就会变得非常棘手。但这如果我们当时有做日志记录的话，不论是正常运行还是出现报错，都有相关的时间记录，状态记录，错误记录等，那么这样我们就可以方便地追踪到在当时的运行过程中出现了怎样的状况，从而可以快速排查问题。 因此，日志记录是非常有必要的，任何一款软件如果没有标准的日志记录，都不能算作一个合格的软件。作为开发者，我们需要重视并做好日志记录过程。
日志记录的流程框架 那么在 Python 中，怎样才能算作一个比较标准的日志记录过程呢？或许很多人会使用 print 语句输出一些运行信息，然后再在控制台观察，运行的时候再将输出重定向到文件输出流保存到文件中，这样其实是非常不规范的，在 Python 中有一个标准的 logging 模块，我们可以使用它来进行标注的日志记录，利用它我们可以更方便地进行日志记录，同时还可以做更方便的级别区分以及一些额外日志信息的记录，如时间、运行模块信息等。 接下来我们先了解一下日志记录流程的整体框架。
整个日志记录的框架可以分为这么几个部分：
Logger：即 Logger Main Class，是我们进行日志记录时创建的对象，我们可以调用它的方法传入日志模板和信息，来生成一条条日志记录，称作 Log Record。
&#39;loggers&#39;: { &#39;main.core&#39;: { &#39;level&#39;: &#39;DEBUG&#39;, &#39;handlers&#39;: [&#39;console&#39;, &#39;file&#39;, &#39;error&#39;] } }, Log Record：就代指生成的一条条日志记录。
Handler：即用来处理日志记录的类，它可以将 Log Record 输出到我们指定的日志位置和存储形式等，如我们可以指定将日志通过 FTP 协议记录到远程的服务器上，Handler 就会帮我们完成这些事情。
&#39;handlers&#39;: { &#39;console&#39;: { &#39;class&#39;: &#39;logging." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b1fd103d49f7e2f3ed3d0268ddb959f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-07T16:51:16+08:00" />
<meta property="article:modified_time" content="2022-07-07T16:51:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 中 logging 模块的基本用法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div id="article_content" class="article_content clearfix"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <svg xmlns="http://www.w3.org/2000/svg"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block"></path> 
  </svg> 
  <p></p> 
  <div class="toc"> 
   <h4>文章目录</h4> 
   <ul><li> 
     <ul><li> 
       <ul><li><a href="#_1" rel="nofollow noopener noreferrer" target="_self">日志记录的重要性</a></li><li><a href="#_5" rel="nofollow noopener noreferrer" target="_self">日志记录的流程框架</a></li><li><a href="#_71" rel="nofollow noopener noreferrer" target="_self">为什么要使用日志</a></li><li><a href="#_75" rel="nofollow noopener noreferrer" target="_self">日志记录的基本信息</a></li><li> 
         <ul><li><a href="#_77" rel="nofollow noopener noreferrer" target="_self">日志等级</a></li><li><a href="#_91" rel="nofollow noopener noreferrer" target="_self">日志字段信与格式</a></li></ul> </li><li><a href="#loggingprint_102" rel="nofollow noopener noreferrer" target="_self">日志logging和print进行比较</a></li><li><a href="#logging_109" rel="nofollow noopener noreferrer" target="_self">logging模块的使用方式</a></li><li> 
         <ul><li><a href="#_111" rel="nofollow noopener noreferrer" target="_self">两种记录日志方式</a></li><li><a href="#logging_116" rel="nofollow noopener noreferrer" target="_self">使用logging提供的模块级别函数详细说明</a></li><li><a href="#logging_130" rel="nofollow noopener noreferrer" target="_self">使用logging日志系统的四大组件</a></li><li> 
           <ul><li><a href="#__Logger_141" rel="nofollow noopener noreferrer" target="_self">日志器 - Logger</a></li><li><a href="#__Handler_159" rel="nofollow noopener noreferrer" target="_self">处理器 - Handler</a></li><li><a href="#__filters_184" rel="nofollow noopener noreferrer" target="_self">过滤器 - filters</a></li><li><a href="#__Formatter_196" rel="nofollow noopener noreferrer" target="_self">格式化器 - Formatter</a></li><li><a href="#_207" rel="nofollow noopener noreferrer" target="_self">组件之间的关系</a></li></ul> </li></ul> </li><li><a href="#_219" rel="nofollow noopener noreferrer" target="_self">代码的实现与具体应用</a></li><li> 
         <ul><li><a href="#python_223" rel="nofollow noopener noreferrer" target="_self">使用python代码实现日志配置</a></li><li><a href="#fileConfig_259" rel="nofollow noopener noreferrer" target="_self">使用配置文件和fileConfig()函数实现日志配置</a></li><li><a href="#dictdictConfig_320" rel="nofollow noopener noreferrer" target="_self">使用dict配置信息和dictConfig()函数实现日志配置</a></li></ul> </li><li><a href="#_377" rel="nofollow noopener noreferrer" target="_self">崔庆才相关教程</a></li><li> 
         <ul><li><a href="#Level_480" rel="nofollow noopener noreferrer" target="_self">Level</a></li><li><a href="#Handler_521" rel="nofollow noopener noreferrer" target="_self">Handler</a></li><li><a href="#Formatter_618" rel="nofollow noopener noreferrer" target="_self">Formatter</a></li><li><a href="#_Traceback_648" rel="nofollow noopener noreferrer" target="_self">捕获 Traceback</a></li><li><a href="#_698" rel="nofollow noopener noreferrer" target="_self">配置共享</a></li><li><a href="#_746" rel="nofollow noopener noreferrer" target="_self">文件配置</a></li><li><a href="#_852" rel="nofollow noopener noreferrer" target="_self">日志记录使用常见误区</a></li></ul> </li><li><a href="#_909" rel="nofollow noopener noreferrer" target="_self">项目日志使用</a></li><li><a href="#_1278" rel="nofollow noopener noreferrer" target="_self">参考文献</a></li></ul> </li></ul> </li></ul> 
  </div> 
  <p></p> 
  <h4><a id="_1"></a>日志记录的重要性</h4> 
  <p>在开发过程中，如果程序运行出现了问题，我们是可以使用我们自己的 Debug 工具来检测到到底是哪一步出现了问题，如果出现了问题的话，是很容易排查的。但程序开发完成之后，我们会将它部署到生产环境中去，这时候代码相当于是在一个黑盒环境下运行的，我们只能看到其运行的效果，是不能直接看到代码运行过程中每一步的状态的。在这个环境下，运行过程中难免会在某个地方出现问题，甚至这个问题可能是我们开发过程中未曾遇到的问题，碰到这种情况应该怎么办？ 如果我们现在只能得知当前问题的现象，而没有其他任何信息的话，如果我们想要解决掉这个问题的话，那么只能根据问题的现象来试图复现一下，然后再一步步去调试，这恐怕是很难的，很大的概率上我们是无法精准地复现这个问题的，而且 Debug 的过程也会耗费巨多的时间，这样一旦生产环境上出现了问题，修复就会变得非常棘手。但这如果我们当时有做日志记录的话，不论是正常运行还是出现报错，都有相关的时间记录，状态记录，错误记录等，那么这样我们就可以方便地追踪到在当时的运行过程中出现了怎样的状况，从而可以快速排查问题。 因此，日志记录是非常有必要的，任何一款软件如果没有标准的日志记录，都不能算作一个合格的软件。作为开发者，我们需要重视并做好日志记录过程。</p> 
  <h4><a id="_5"></a>日志记录的流程框架</h4> 
  <p>那么在 Python 中，怎样才能算作一个比较标准的日志记录过程呢？或许很多人会使用 print 语句输出一些运行信息，然后再在控制台观察，运行的时候再将输出重定向到文件输出流保存到文件中，这样其实是非常不规范的，在 Python 中有一个标准的 <code>logging</code> 模块，我们可以使用它来进行标注的日志记录，利用它我们可以更方便地进行日志记录，同时还可以做更方便的级别区分以及一些额外日志信息的记录，如时间、运行模块信息等。 接下来我们先了解一下日志记录流程的整体框架。</p> 
  <p>整个日志记录的框架可以分为这么几个部分：</p> 
  <ul><li> <p><code>Logger</code>：即 Logger Main Class，是我们进行日志记录时创建的对象，我们可以调用它的方法传入日志模板和信息，来生成一条条日志记录，称作 Log Record。</p> <pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string">'main.core'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
			<span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code>
     
     <div class="hljs-button {2}"></div>
     
     </pre><ul class="pre-numbering"></ul> </li><li> <p><code>Log Record</code>：就代指生成的一条条日志记录。</p> </li><li> <p><code>Handler</code>：即用来处理日志记录的类，它可以将 Log Record 输出到我们<strong>指定的日志位置和存储形式</strong>等，如我们可以指定将日志通过 FTP 协议记录到远程的服务器上，<a href="https://so.csdn.net/so/search?q=Handler&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">Handler</a> 就会帮我们完成这些事情。</p> <pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string">'console'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
			<span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'brief'</span><span class="token punctuation">,</span>
			<span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
			<span class="token string">'stream'</span><span class="token punctuation">:</span> <span class="token string">'ext://sys.stdout'</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.FileHandler'</span><span class="token punctuation">,</span>
			<span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
			<span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
			<span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'debug.log'</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.handlers.RotatingFileHandler'</span><span class="token punctuation">,</span>
			<span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span>
			<span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
			<span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'error.log'</span><span class="token punctuation">,</span>
			<span class="token string">'maxBytes'</span><span class="token punctuation">:</span> <span class="token number">10485760</span><span class="token punctuation">,</span>
			<span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
			<span class="token string">'encoding'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code>
     
     <div class="hljs-button {2}"></div>
     
     </pre><ul class="pre-numbering"></ul> </li><li> <p><code>Formatter</code>：实际上生成的 Log Record 也是一个个对象，那么我们想要把它们保存成一条条我们想要的日志文本的话，就需要有一个格式化的过程，那么这个过程就由 Formatter 来完成，返回的就是日志字符串，然后传回给 Handler 来处理。</p> <pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token string">'formatters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string">'brief'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s - %(message)s'</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">'simple'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code>
     
     <div class="hljs-button {2}"></div>
     
     </pre><ul class="pre-numbering"><li><p><code>Filter</code>：另外保存日志的时候我们可能不需要全部保存，我们可能只需要保存我们想要的部分就可以了，所以保存前还需要进行一下过滤，留下我们想要的日志，如只保存某个级别的日志，或只保存包含某个关键字的日志等，那么这个过滤过程就交给 <code>Filter</code> 来完成。</p> 
     
     </li></ul></li><li> <p>Parent Handler：Handler 之间可以存在分层关系，以使得不同 Handler 之间共享相同功能的代码。</p> </li></ul> 
  <p>以上就是整个 logging 模块的基本架构和对象功能，了解了之后我们详细来了解一下 logging 模块的用法。</p> 
  <h4><a id="_71"></a>为什么要使用日志</h4> 
  <p>在开发项目时，我们不可能将所有的信息都打印在控制台中。我们可以使用Python标准库提供的logging API来处理。相比print，logging模块提供了许多强大而灵活的功能。比如：可以通过设置不同的日志等级，只输出重要信息，而不必显示大量的调式信息；print将所有信息都输出到标准输出中，严重影响开发者从标准输出中查看其他数据，而logging则可以由开发者决定将信息输出到什么地方，以及怎么输出。</p> 
  <h4><a id="_75"></a>日志记录的基本信息</h4> 
  <h5><a id="_77"></a>日志等级</h5> 
  <ul><li> <p>logging函数默认定义了5个日志等级，它允许开发人员自定义日志等级，但是并不推荐。</p> 
    <div class="table-box"> 
     <table><thead><tr><th>日志等级(level)</th><th>描述</th></tr></thead><tbody><tr><td>DEBUG</td><td>最详细的日志信息，典型应用场景是 问题诊断</td></tr><tr><td>INFO</td><td>信息详细程度仅次于DEBUG，通常只记录关键节点信息，用于确认一切都是按照我们预期的那样进行工作</td></tr><tr><td>WARNING</td><td>当某些不期望的事情发生时记录的信息（如，磁盘可用空间较低），但是此时应用程序还是正常运行的</td></tr><tr><td>ERROR</td><td>由于一个更严重的问题导致某些功能不能正常运行时记录的信息</td></tr><tr><td>CRITICAL</td><td>当发生严重错误，导致应用程序不能继续运行时记录的信息</td></tr></tbody></table> 
    </div></li></ul> 
  <p>​ <strong>注</strong>：日志等级从上到下依次升高 DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL，而日志信息依次减少；当指定一个日志级别之后，会记录大于或等于这个日志级别的日志信息，小于的将会被丢弃；默认打印的日志等级是 WARNING ，当日志等级设置为 WARNING 或之上时才被跟踪。</p> 
  <h5><a id="_91"></a>日志字段信与格式</h5> 
  <p>一条日志信息对应的是一个事件的发生，而一个事件通常需要包括以下几个内容：</p> 
  <ul><li>事件发生时间</li><li>事件发生位置</li><li>事件的严重程度</li><li>日志级别、事件内容等其他内容</li></ul> 
  <p><strong>注</strong>：输出一条日志时，<font color="red">日志内容和日志级别是需要开发人员明确指定的</font>；对于而其它字段信息，只需要是否显示在日志中就可以了。</p> 
  <h4><a id="loggingprint_102"></a>日志logging和print进行比较</h4> 
  <ul><li>可以在 logging 模块中<font color="red">设置日志等级</font>，在不同的版本（如开发环境、生产环境）上通过设置不同的输出等级来记录对应的日志，非常灵活。</li></ul> 
  <ul><li>print 的输出信息都会输出到标准输出流中，而 logging 模块就更加灵活，可以设置<font color="red">输出到任意位置</font>，如写入文件、写入远程服务器等。</li><li>logging 模块具有<font color="red">灵活的配置和格式化功能</font>，如配置输出当前模块信息、运行时间等，相比 print 的字符串格式化更加方便易用。</li></ul> 
  <h4><a id="logging_109"></a>logging模块的使用方式</h4> 
  <h5><a id="_111"></a>两种记录日志方式</h5> 
  <ul><li>使用logging提供的模块级别函数</li><li>使用logging日志系统的四大组件</li></ul> 
  <h5><a id="logging_116"></a>使用logging提供的模块级别函数详细说明</h5> 
  <div class="table-box"> 
   <table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>logging.debug(msg, args, *kwargs)</td><td>创建一条严重级别为DEBUG的日志记录</td></tr><tr><td>logging.info(msg, args, *kwargs)</td><td>创建一条严重级别INFO的日志记录</td></tr><tr><td>logging.warning(msg, args, *kwargs)</td><td>创建一条严重级别为WARNING的日志记录</td></tr><tr><td>logging.error(msg, args, *kwargs)</td><td>创建一条严重级别为ERROR的日志记录</td></tr><tr><td>logging.critical(msg, args, *kwargs)</td><td>创建一条严重级别为CRITICAL的日志记录</td></tr><tr><td>logging.log(level, args, *kwargs)</td><td>创建一条严重级别为level的日志记录</td></tr><tr><td>logging.basicConfig(**kwargs)</td><td>对root logger进行一次性配置</td></tr></tbody></table> 
  </div> 
  <p><strong>注</strong>：其中logging.basicConfig(**kwargs)函数用于指定“要记录的日志级别”、“日志格式”、 “日志输出位置”、“日志文件的打开模式”等信息，其他几个都是用于记录各个级别日志的函数。</p> 
  <h5><a id="logging_130"></a>使用logging日志系统的四大组件</h5> 
  <p>组件描述：</p> 
  <div class="table-box"> 
   <table><thead><tr><th>组件名称</th><th>类名</th><th>描述</th></tr></thead><tbody><tr><td>日志器</td><td>loggers</td><td>提供应用程序代码直接使用的接口</td></tr><tr><td>处理器</td><td>handlers</td><td>用于将日志记录发送到指定的目的位置</td></tr><tr><td>过滤器</td><td>filters</td><td>提供更细粒度的日志过滤功能，用于决定哪些日志记录将会被输出(其他的日志记录将会被忽略)</td></tr><tr><td>格式器</td><td>formatters</td><td>用于控制日志信息的最终输出格式</td></tr></tbody></table> 
  </div> 
  <h6><a id="__Logger_141"></a>日志器 - Logger</h6> 
  <p>Logger是一个树形层级结构，在使用接口debug、info、warning、error、critical之前必须创建Logger实例；</p> 
  <p>创建方式</p> 
  <pre class="prettyprint"><code class="prism language-python has-numbering">logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>logger_name<span class="token punctuation">)</span>
</code></pre> 
 </div> 
</div> 
<p>创建Logger实例后，可以使用以下方法进行日志级别设置，增加处理器Handler：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token comment"># 设置日志级别为 ERROR，即只有日志级别大于等于 ERROR 的日志才会输出</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler_name<span class="token punctuation">)</span> <span class="token comment"># 为Logger实例增加一个处理器</span>
logger<span class="token punctuation">.</span>removeHandler<span class="token punctuation">(</span>handler_name<span class="token punctuation">)</span> <span class="token comment"># 为 Logger 实例删除一个处理器</span>
</code></pre> 
<h6><a id="__Handler_159"></a>处理器 - Handler</h6> 
<p>Handler 处理器类型有很多种，比较常用的有三个：StreamHandler、FileHandler、NullHandler.</p> 
<p>创建方式：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token comment"># StreamHandler创建方式</span>
sh <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span>stream<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<p><span class="token comment"># FileHandler创建方式</span><br> <span class="token comment"># fh = logging.FileHandler(filename, mode=‘a’, encoding=None, delay=False)</span></p> 
<p><span class="token comment"># NullHandler：NullHandler类位于核心logging包，不做任何的格式化或者输出。本质上它是个“什么都不做”的handler，由库开发者使用。 </span></p> 
<p>创建 StreamHandler 之后，可以通过使用以下方法设置日志级别，设置格式化器 Formatter，增加或删除过滤器 Filter。</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">sh<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>WARN<span class="token punctuation">)</span> <span class="token comment"># 指定日志级别，低于WARN级别的日志将被忽略</span>
sh<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter_name<span class="token punctuation">)</span> <span class="token comment"># 设置一个格式化器formatter</span>
sh<span class="token punctuation">.</span>addFilter<span class="token punctuation">(</span>filter_name<span class="token punctuation">)</span> <span class="token comment"># 增加一个过滤器，可以增加多个</span>
sh<span class="token punctuation">.</span>removeFilter<span class="token punctuation">(</span>filter_name<span class="token punctuation">)</span> <span class="token comment"># 删除一个过滤器</span>
</code></pre> 
<h6><a id="__filters_184"></a>过滤器 - filters</h6> 
<p>Filter过滤器基类，它只允许某个logger层级下的日志事件通过过滤。</p> 
<p>一条日志信息被输出要经过以下几次过滤：<strong>日志器等级过滤、日志器的过滤器过滤、日志器的处理器等级过滤、日志器的处理器的过滤器过滤</strong>。</p> 
<p>创建方式：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token builtin">filter</span> <span class="token operator">=</span> logging<span class="token punctuation">.</span>Filter<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="__Formatter_196"></a>格式化器 - Formatter</h6> 
<p>使用Formatter对象设置日志信息最后的规则、结构和内容，默认的时间格式为%Y-%m-%d %H:%M:%S。</p> 
<p>创建方法:</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>fmt<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> datefmt<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token comment"># fmt是消息的格式化字符串，datefmt是日期字符串。如果不指明fmt，将使用'%(message)s'。如果不指明datefmt，将使用ISO8601日期格式。</span>
</code></pre> 
<h6><a id="_207"></a>组件之间的关系</h6> 
<ul><li> <p>日志器（logger）需要通过处理器（handler）将日志信息输出到目标位置，不同的处理器（handler）可以将日志输出到不同的位置。</p> </li><li> <p>日志器（logger）可以设置多个处理器（handler）将同一条日志记录输出到不同的位置。</p> </li><li> <p>每个处理器（handler）都可以设置自己的过滤器（filter）实现日志过滤，从而只保留感兴趣的日志。</p> </li><li> <p>每个处理器（handler）都可以设置自己的格式器（formatter）实现同一条日志以不同的格式输出到不同的地方。</p> </li></ul> 
<p><strong>总结以上内容</strong>：Logger 可以包含一个或多个 Handler 和 Filter，即：LoggerFilter，即：Logger 与 Handler 或 Fitler 是一对多的关系；一个 Logger 实例可以新增多个 Handler，一个 Handler 可以新增多个格式化器或多个过滤器，而且日志级别将会继承。</p> 
<h4><a id="_219"></a>代码的实现与具体应用</h4> 
<p>可以通过以下3种方法来配置logging：使用python代码创建loggers，handlers和formatters并分别调用它们的配置函数，创建一个日志配置文件，然后使用<code>fileConfig()</code>函数来读取该文件的内容，创建一个包含配置信息的dict，然后把它传递给<code>dictConfig()</code>函数；</p> 
<h5><a id="python_223"></a>使用python代码实现日志配置</h5> 
<p>Python代码展示：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging
<span class="token keyword">import</span> sys
<span class="token comment"># 创建日志器logger并将其日志级别设置为DEBUG</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"python_config_logger"</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
<span class="token comment"># 创建一个流处理器handler并将其日志级别设置为DEBUG</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
<span class="token comment"># 创建一个格式化器formatter并将其添加到处理器handler中</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
<span class="token comment"># 为日志器logger添加上面创建好的处理器handler</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
<span class="token comment"># 将日志打印在控制台</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'打印日志级别：debug'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'打印日志级别：info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'打印日志级别：warning'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'打印日志级别：error'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>critical<span class="token punctuation">(</span><span class="token string">'打印日志级别：critical'</span><span class="token punctuation">)</span> 
</code></pre> 
<p>实际结果：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">644</span> <span class="token operator">-</span> python_config_logger <span class="token operator">-</span> DEBUG <span class="token operator">-</span> 打印日志级别：debug
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">644</span> <span class="token operator">-</span> python_config_logger <span class="token operator">-</span> INFO <span class="token operator">-</span> 打印日志级别：info
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">644</span> <span class="token operator">-</span> python_config_logger <span class="token operator">-</span> WARNING <span class="token operator">-</span> 打印日志级别：warning
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">645</span> <span class="token operator">-</span> python_config_logger <span class="token operator">-</span> ERROR <span class="token operator">-</span> 打印日志级别：error
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">645</span> <span class="token operator">-</span> python_config_logger <span class="token operator">-</span> CRITICAL <span class="token operator">-</span> 打印日志级别：critical
</code></pre> 
<h5><a id="fileConfig_259"></a>使用配置文件和fileConfig()函数实现日志配置</h5> 
<p>Python代码展示：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging<span class="token punctuation">.</span>config
<span class="token comment"># 读取日志配置文件内容</span>
logging<span class="token punctuation">.</span>config<span class="token punctuation">.</span>fileConfig<span class="token punctuation">(</span><span class="token string">'logging.conf'</span><span class="token punctuation">)</span>
<span class="token comment"># 创建一个日志器logger</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'simpleExample'</span><span class="token punctuation">)</span>
<span class="token comment"># 将日志打印在控制台</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'打印日志级别：debug'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'打印日志级别：info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'打印日志级别：warning'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'打印日志级别：error'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>critical<span class="token punctuation">(</span><span class="token string">'打印日志级别：critical'</span><span class="token punctuation">)</span>
</code></pre> 
<p>logging.conf配置文件内容：</p> 
<pre class="prettyprint"><code class="prism language-yaml has-numbering"><span class="token punctuation">[</span>loggers<span class="token punctuation">]</span>
keys=root<span class="token punctuation">,</span>simpleExample
<span class="token comment"># 测试</span>
<span class="token punctuation">[</span>handlers<span class="token punctuation">]</span>
keys=fileHandler<span class="token punctuation">,</span>consoleHandler
<span class="token punctuation">[</span>formatters<span class="token punctuation">]</span>
keys=simpleFormatter
<span class="token punctuation">[</span>logger_root<span class="token punctuation">]</span>
level=DEBUG
handlers=fileHandler
<span class="token punctuation">[</span>logger_simpleExample<span class="token punctuation">]</span>
level=DEBUG
handlers=consoleHandler
qualname=simpleExample
propagate=0
<span class="token punctuation">[</span>handler_consoleHandler<span class="token punctuation">]</span>
class=StreamHandler
args=(sys.stdout<span class="token punctuation">,</span>)
level=DEBUG
formatter=simpleFormatter
<span class="token punctuation">[</span>handler_fileHandler<span class="token punctuation">]</span>
class=FileHandler
args=('logging.log'<span class="token punctuation">,</span> 'a')
level=ERROR
formatter=simpleFormatter
<span class="token punctuation">[</span>formatter_simpleFormatter<span class="token punctuation">]</span>
format=%(asctime)s <span class="token punctuation">-</span> %(name)s <span class="token punctuation">-</span> %(levelname)s <span class="token punctuation">-</span> %(message)s
datefmt=
</code></pre> 
<p>实际结果：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">644</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> DEBUG <span class="token operator">-</span> 打印日志级别：debug
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">646</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> INFO <span class="token operator">-</span> 打印日志级别：info
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">646</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> WARNING <span class="token operator">-</span> 打印日志级别：warning
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">646</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> ERROR <span class="token operator">-</span> 打印日志级别：error
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">646</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> CRITICAL <span class="token operator">-</span> 打印日志级别：critical
</code></pre> 
<h5><a id="dictdictConfig_320"></a>使用dict配置信息和dictConfig()函数实现日志配置</h5> 
<p>Python代码展示：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging<span class="token punctuation">.</span>config
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> yaml
</code></pre> 
<p><span class="token comment"># 读取日志配置文件内容</span><br> <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">‘logging.yml’</span><span class="token punctuation">,</span> <span class="token string">‘r’</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file_logging<span class="token punctuation">:</span><br> dict_conf <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>file_logging<span class="token punctuation">,</span> Loader<span class="token operator">=</span>yaml<span class="token punctuation">.</span>FullLoader<span class="token punctuation">)</span><br> logging<span class="token punctuation">.</span>config<span class="token punctuation">.</span>dictConfig<span class="token punctuation">(</span>dict_conf<span class="token punctuation">)</span><br> <span class="token comment"># 创建一个日志器logger</span><br> logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">‘simpleExample’</span><span class="token punctuation">)</span><br> <span class="token comment"># 将日志打印在控制台</span><br> logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">‘打印日志级别：debug’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">‘打印日志级别：info’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">‘打印日志级别：warning’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">‘打印日志级别：error’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>critical<span class="token punctuation">(</span><span class="token string">‘打印日志级别：critical’</span><span class="token punctuation">)</span></p> 
<p>logging.yml配置文件内容：</p> 
<pre class="prettyprint"><code class="prism language-yaml has-numbering"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">formatters</span><span class="token punctuation">:</span>
  <span class="token key atrule">simple</span><span class="token punctuation">:</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>
<span class="token key atrule">handlers</span><span class="token punctuation">:</span>
  <span class="token key atrule">console</span><span class="token punctuation">:</span>
    <span class="token key atrule">class</span><span class="token punctuation">:</span> logging.StreamHandler
    <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
    <span class="token key atrule">formatter</span><span class="token punctuation">:</span> simple
<span class="token key atrule">loggers</span><span class="token punctuation">:</span>
  <span class="token key atrule">simpleExample</span><span class="token punctuation">:</span>
    <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
    <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">]</span>
    <span class="token key atrule">propagate</span><span class="token punctuation">:</span> no
<span class="token key atrule">root</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">]</span>
</code></pre> 
<p>实际结果：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">822</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> DEBUG <span class="token operator">-</span> 打印日志级别：debug
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">822</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> INFO <span class="token operator">-</span> 打印日志级别：info
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">822</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> WARNING <span class="token operator">-</span> 打印日志级别：warning
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">822</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> ERROR <span class="token operator">-</span> 打印日志级别：error
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">823</span> <span class="token operator">-</span> simpleExample <span class="token operator">-</span> CRITICAL <span class="token operator">-</span> 打印日志级别：critical
</code></pre> 
<p>上面只是简单的介绍了python中logging模块的基本使用方法，下面是一些比较详细的介绍。</p> 
<h4><a id="_377"></a>崔庆才相关教程</h4> 
<p>下面我们初步来了解下 logging 模块的基本用法，先用一个实例来感受一下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging
</code></pre> 
<p>logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">‘%(asctime)s - %(name)s - %(levelname)s - %(message)s’</span><span class="token punctuation">)</span><br> logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><strong>name</strong><span class="token punctuation">)</span></p> 
<p>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">‘this is a log info’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">‘Debugging’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">‘Warning exists’</span><span class="token punctuation">)</span><br> logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">‘Finish’</span><span class="token punctuation">)</span></p> 
<p>在这里我们首先引入了 <code>logging</code> 模块，然后进行了一下基本的配置，这里通过 <code>basicConfig</code> 配置了 <code>level</code> 信息和 <code>format</code> 信息，这里 level 配置为 <code>INFO </code>信息，即只输出 <code>INFO</code> 级别的信息，另外这里指定了 <code>format </code>格式的字符串，包括 asctime、name、levelname、message 四个内容，分别代表运行时间、模块名称、日志级别、日志内容，这样输出内容便是这四者组合而成的内容了，这就是 logging 的全局配置。</p> 
<p>接下来声明了一个 <code>Logger</code> 对象，它就是日志输出的主类，调用对象的 info () 方法就可以输出 INFO 级别的日志信息，调用 debug () 方法就可以输出 DEBUG 级别的日志信息，非常方便。</p> 
<p>在初始化的时候我们传入了模块的名称，这里直接使用 <strong>name</strong> 来代替了，就是模块的名称，如果直接运行这个脚本的话就是 <strong>main</strong>，如果是 import 的模块的话就是被引入模块的名称，这个变量在不同的模块中的名字是不同的，所以一般使用 <strong>name</strong> 来表示就好了，再接下来输出了四条日志信息，其中有两条 INFO、一条 WARNING、一条 DEBUG 信息，我们看下输出结果：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">857</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> this <span class="token keyword">is</span> a log info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">857</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Warning exists
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">857</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Finish
</code></pre> 
<p>可以看到输出结果一共有三条日志信息，每条日志都是对应了指定的格式化内容，另外我们发现 DEBUG 的信息是没有输出的，这是因为我们在全局配置的时候设置了输出为 INFO 级别，所以 DEBUG 级别的信息就被过滤掉了。 这时如果我们将输出的日志级别设置为 DEBUG，就可以看到 DEBUG 级别的日志输出了：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>
</code></pre> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">119</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> this <span class="token keyword">is</span> a log info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">119</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> DEBUG <span class="token operator">-</span> Debugging
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">119</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Warning exists
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">119</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Finish

</code><p>由此可见，相比 print 来说，通过刚才的代码，我们既可以输出时间、模块名称，又可以输出不同级别的日志信息作区分并加以过滤，是不是灵活多了？ 当然这只是 logging 模块的一小部分功能，接下来我们首先来全面了解一下 <code>basicConfig</code> 的参数都有哪些：</p> 

 
 </pre><ul><li> <p><code>filename</code>：即日志输出的文件名，如果指定了这个信息之后，实际上会启用 FileHandler，而不再是 StreamHandler，这样日志信息便会输出到文件中了。</p> </li><li> <p><code>filemode</code>：这个是指定日志文件的写入方式，有两种形式，一种是 w，一种是 a，分别代表清除后写入和追加写入。</p> </li><li> <p><code>format</code>：指定日志信息的输出格式，即上文示例所示的参数，详细参数可以参考：</p> <p>部分参数如下所示：</p> 
  
   
   <ul><li>%(levelno) s：打印日志级别的数值。</li><li>%(levelname) s：打印日志级别的名称。</li><li>%(pathname) s：打印当前执行程序的路径，其实就是 sys.argv [0]。</li><li>%(filename) s：打印当前执行程序名。</li><li>%(funcName) s：打印日志的当前函数。</li><li>%(lineno) d：打印日志的当前行号。</li><li>%(asctime) s：打印日志的时间。</li><li>%(thread) d：打印线程 ID。</li><li>%(threadName) s：打印线程名称。</li><li>%(process) d：打印进程 ID。</li><li>%(processName) s：打印线程名称。</li><li>%(module) s：打印模块名称。</li><li>%(message) s：打印日志信息。</li></ul> </li><li> <p><code>datefmt</code>：指定时间的输出格式。</p> </li><li> <p><code>style</code>：如果 format 参数指定了，这个参数就可以指定格式化时的占位符风格，如 %、{、$ 等。</p> </li><li> <p><code>level</code>：指定日志输出的类别，程序会输出大于等于此级别的信息。</p> </li><li> <p><code>stream</code>：在没有指定 filename 的时候会默认使用 StreamHandler，这时 stream 可以指定初始化的文件流。</p> </li><li> <p><code>handlers</code>：可以指定日志处理时所使用的 Handlers，必须是可迭代的。</p> </li></ul> 
<p>下面我们再用一个实例来感受一下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span>
                    filename<span class="token operator">=</span><span class="token string">'output.log'</span><span class="token punctuation">,</span>
                    datefmt<span class="token operator">=</span><span class="token string">'%Y/%m/%d %H:%M:%S'</span><span class="token punctuation">,</span>
                    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(lineno)d - %(module)s - %(message)s'</span><span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'This is a log info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Debugging'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Warning exists'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Finish'</span><span class="token punctuation">)</span>

</code><p>这里我们指定了输出文件的名称为 output.log，另外指定了日期的输出格式，其中年月日的格式变成了 % Y/% m/% d，另外输出的 format 格式增加了 lineno、module 这两个信息，运行之后便会生成一个 output.log 的文件，内容如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> <span class="token number">9</span> <span class="token operator">-</span> test <span class="token operator">-</span> This <span class="token keyword">is</span> a log info
<span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> DEBUG <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">-</span> test <span class="token operator">-</span> Debugging
<span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> <span class="token number">11</span> <span class="token operator">-</span> test <span class="token operator">-</span> Warning exists
<span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">20</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> <span class="token number">12</span> <span class="token operator">-</span> test <span class="token operator">-</span> Finish

</code><p>可以看到日志便会输出到文件中，同时输出了行号、模块名称等信息。 以上我们通过 basicConfig 来进行了一些全局的配置，我们同样可以使用 Formatter、Handler 进行更灵活的处理，下面我们来了解一下。</p> 
<h5><a id="Level_480"></a>Level</h5> 
<p>首先我们来了解一下输出日志的等级信息，logging 模块共提供了如下等级，每个等级其实都对应了一个数值，列表如下：</p> 

   
   <div class="table-box">
    
    <table><thead><tr><th>等级</th><th>数值</th></tr></thead><tbody><tr><td>CRITICAL</td><td>50</td></tr><tr><td>FATAL</td><td>50</td></tr><tr><td>ERROR</td><td>40</td></tr><tr><td>WARNING</td><td>30</td></tr><tr><td>WARN</td><td>30</td></tr><tr><td>INFO</td><td>20</td></tr><tr><td>DEBUG</td><td>10</td></tr><tr><td>NOTSET</td><td>0</td></tr></tbody></table>
   
   </div>
<p>这里最高的等级是 CRITICAL 和 FATAL，两个对应的数值都是 50，另外对于 WARNING 还提供了简写形式 WARN，两个对应的数值都是 30。 我们设置了输出 level，系统便只会输出 level 数值大于或等于该 level 的的日志结果，例如我们设置了输出日志 level 为 INFO，那么输出级别大于等于 INFO 的日志，如 WARNING、ERROR 等，DEBUG 和 NOSET 级别的不会输出。</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>WARN<span class="token punctuation">)</span>

<span class="token comment"># Log</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Debugging'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>critical<span class="token punctuation">(</span><span class="token string">'Critical Something'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Error Occurred'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Warning exists'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Finished'</span><span class="token punctuation">)</span>

</code><p>这里我们设置了输出级别为 WARN，然后对应输出了五种不同级别的日志信息，运行结果如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">Critical Something
Error Occurred
Warning exists

</code><p>可以看到只有 CRITICAL、ERROR、WARNING 信息输出了，DEBUG、INFO 信息没有输出。</p> 
<h5><a id="Handler_521"></a>Handler</h5> 
<p>下面我们先来了解一下 Handler 的用法，看下面的实例：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>FileHandler<span class="token punctuation">(</span><span class="token string">'output.log'</span><span class="token punctuation">)</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'This is a log info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Debugging'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Warning exists'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Finish'</span><span class="token punctuation">)</span>
 
</code><p>这里我们没有再使用 basicConfig 全局配置，而是先声明了一个 Logger 对象，然后指定了其对应的 Handler 为 <code>FileHandler</code> 对象，然后 Handler 对象还单独指定了 Formatter 对象单独配置输出格式，最后给 Logger 对象添加对应的 Handler 即可，最后可以发现日志就会被输出到 output.log 中，内容如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span><span class="token number">269</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> This <span class="token keyword">is</span> a log info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span><span class="token number">269</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Warning exists
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span><span class="token number">269</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Finish
 
</code><p>另外我们还可以使用其他的 Handler 进行日志的输出，logging 模块提供的 Handler 有：</p> 

       
       </pre></pre></pre></pre></pre></pre><ul><li>StreamHandler：<code>logging.StreamHandler</code>；日志输出到流，可以是 sys.stderr，sys.stdout 或者文件。</li><li>FileHandler：<code>logging.FileHandler</code>；日志输出到文件。</li><li>BaseRotatingHandler：<code>logging.handlers.BaseRotatingHandler</code>；基本的日志回滚方式。</li><li>RotatingHandler：<code>logging.handlers.RotatingHandler</code>；日志回滚方式，支持日志文件最大数量和日志文件回滚。</li><li>TimeRotatingHandler：<code>logging.handlers.TimeRotatingHandler</code>；日志回滚方式，在一定时间区域内回滚日志文件。</li><li>SocketHandler：<code>logging.handlers.SocketHandler</code>；远程输出日志到 TCP/IP sockets。</li><li>DatagramHandler：<code>logging.handlers.DatagramHandler</code>；远程输出日志到 UDP sockets。</li><li>SMTPHandler：<code>logging.handlers.SMTPHandler</code>；远程输出日志到邮件地址。</li><li>SysLogHandler：<code>logging.handlers.SysLogHandler</code>；日志输出到 syslog。</li><li>NTEventLogHandler：<code>logging.handlers.NTEventLogHandler</code>；远程输出日志到 Windows NT/2000/XP 的事件日志。</li><li>MemoryHandler：<code>logging.handlers.MemoryHandler</code>；日志输出到内存中的指定 buffer。</li><li>HTTPHandler：<code>logging.handlers.HTTPHandler</code>；通过”GET” 或者”POST” 远程输出到 HTTP 服务器。</li></ul> 
<p>下面我们使用三个 Handler 来实现日志同时输出到控制台、文件、HTTP 服务器：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging
<span class="token keyword">from</span> logging<span class="token punctuation">.</span>handlers <span class="token keyword">import</span> HTTPHandler
<span class="token keyword">import</span> sys

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>

<span class="token comment"># StreamHandler  日志输出到流</span>
stream_handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
stream_handler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>stream_handler<span class="token punctuation">)</span>

<span class="token comment"># FileHandler 日志输出到文件</span>
file_handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>FileHandler<span class="token punctuation">(</span><span class="token string">'output.log'</span><span class="token punctuation">)</span>
file_handler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>
file_handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>file_handler<span class="token punctuation">)</span>

<span class="token comment"># HTTPHandler  通过”GET” 或者”POST” 远程输出到 HTTP 服务器</span>
http_handler <span class="token operator">=</span> HTTPHandler<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost:8001'</span><span class="token punctuation">,</span> url<span class="token operator">=</span><span class="token string">'log'</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>http_handler<span class="token punctuation">)</span>

<span class="token comment"># Log</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'This is a log info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Debugging'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Warning exists'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Finish'</span><span class="token punctuation">)</span>

</code><p>运行之前我们需要先启动 HTTP Server，并运行在 8001 端口，其中 log 接口是用来接收日志的接口。 运行之后控制台输出会输出如下内容：</p> 
<p>python -m http.server 8001</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering">This <span class="token keyword">is</span> a log info
Debugging
Warning exists
Finish

</code><p>output.log 文件会写入如下内容：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">895</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> This <span class="token keyword">is</span> a log info
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">947</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Warning exists
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">949</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Finish

</code><p>HTTP Server 会收到控制台输出的信息。 这样一来，我们就通过设置多个 Handler 来控制了日志的多目标输出。 另外值得注意的是，在这里 StreamHandler 对象我们没有设置 Formatter，因此控制台只输出了日志的内容，而没有包含时间、模块等信息，而 FileHandler 我们通过 setFormatter () 方法设置了一个 Formatter 对象，因此输出的内容便是格式化后的日志信息。 另外每个 Handler 还可以设置 level 信息，最终输出结果的 level 信息会取 Logger 对象的 level 和 Handler 对象的 level 的交集。</p> 
<h5><a id="Formatter_618"></a>Formatter</h5> 
<p>在进行日志格式化输出的时候，我们可以不借助于 basicConfig 来全局配置格式化输出内容，可以借助于 Formatter 来完成，下面我们再来单独看下 Formatter 的用法：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>WARN<span class="token punctuation">)</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>fmt<span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">,</span> datefmt<span class="token operator">=</span><span class="token string">'%Y/%m/%d %H:%M:%S'</span><span class="token punctuation">)</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

<span class="token comment"># Log</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Debugging'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>critical<span class="token punctuation">(</span><span class="token string">'Critical Something'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Error Occurred'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Warning exists'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Finished'</span><span class="token punctuation">)</span>

</code><p>在这里我们指定了一个 Formatter，并传入了 fmt 和 datefmt 参数，这样就指定了日志结果的输出格式和时间格式，然后 handler 通过 setFormatter () 方法设置此 Formatter 对象即可，输出结果如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">37</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> CRITICAL <span class="token operator">-</span> Critical Something
<span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">37</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> ERROR <span class="token operator">-</span> Error Occurred
<span class="token number">2022</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">37</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Warning exists

</code><h5><a id="_Traceback_648"></a>捕获 Traceback</h5> 
<p>如果遇到错误，我们更希望报错时出现的详细 Traceback 信息，便于调试，利用 logging 模块我们可以非常方便地实现这个记录，我们用一个实例来感受一下：</p> 
<pre class="prettyprint"><code class="has-numbering">import logging

logger = logging.getLogger(__name__)
logger.setLevel(level=logging.DEBUG)

# Formatter
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')

# FileHandler 日志输出到文件
file_handler = logging.FileHandler('result.log')
file_handler.setFormatter(formatter)
logger.addHandler(file_handler)

# StreamHandler 日志输出到流
stream_handler = logging.StreamHandler()
stream_handler.setFormatter(formatter)
logger.addHandler(stream_handler)

# Log
logger.info('Start')
logger.warning('Something maybe fail.')
try:
    result = 10 / 0
except Exception:
    logger.error('Faild to get result', exc_info=True)
logger.info('Finished')

</code><p>这里我们在 error () 方法中添加了一个参数，将 <code>exc_info</code> 设置为了 True，这样我们就可以输出执行过程中的信息了，即完整的 Traceback 信息。 运行结果如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">576</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Start
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">577</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> WARNING <span class="token operator">-</span> Something maybe fail<span class="token punctuation">.</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">577</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> ERROR <span class="token operator">-</span> Faild to get result
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"D:/pycharm/project/test/test.py"</span><span class="token punctuation">,</span> line <span class="token number">23</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    result <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">577</span> <span class="token operator">-</span> __main__ <span class="token operator">-</span> INFO <span class="token operator">-</span> Finished

Process finished <span class="token keyword">with</span> exit code <span class="token number">0</span>

</code><p>可以看到这样我们就非常方便地记录下来了报错的信息，一旦出现了错误，我们也能非常方便地排查。</p> 
<h5><a id="_698"></a>配置共享</h5> 
<p>在写项目的时候，我们肯定会将许多配置放置在许多模块下面，这时如果我们每个文件都来配置 logging 配置那就太繁琐了，logging 模块提供了父子模块共享配置的机制，会根据 Logger 的名称来自动加载父模块的配置。 例如我们这里首先定义一个 test.py 文件：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging
<span class="token keyword">import</span> core

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>

<span class="token comment"># Handler</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>FileHandler<span class="token punctuation">(</span><span class="token string">'result.log'</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Main Info'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Main Debug'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Main Error'</span><span class="token punctuation">)</span>
core<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code><p>这里我们配置了日志的输出格式和文件路径，同时定义了 Logger 的名称为 test，然后引入了另外一个模块 core，最后调用了 core 的 run () 方法。 接下来我们定义 core.py，内容如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'test.core'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Core Info'</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Core Debug'</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Core Error'</span><span class="token punctuation">)</span>

</code><p>这里我们定义了 Logger 的名称为 test.core，注意这里开头是 test，即刚才我们在 test.py 里面的 Logger 的名称，这样 core.py 里面的 Logger 就会复用 test.py 里面的 Logger 配置，而不用再去配置一次了。 运行之后会生成一个 result.log 文件，内容如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">718</span> <span class="token operator">-</span> test <span class="token operator">-</span> INFO <span class="token operator">-</span> Main Info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">718</span> <span class="token operator">-</span> test <span class="token operator">-</span> ERROR <span class="token operator">-</span> Main Error
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">718</span> <span class="token operator">-</span> test<span class="token punctuation">.</span>core <span class="token operator">-</span> INFO <span class="token operator">-</span> Core Info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">718</span> <span class="token operator">-</span> test<span class="token punctuation">.</span>core <span class="token operator">-</span> ERROR <span class="token operator">-</span> Core Error
</code><p>可以看到父子模块都使用了同样的输出配置。 如此一来，我们只要在入口文件里面定义好 logging 模块的输出配置，子模块只需要在定义 Logger 对象时名称使用父模块的名称开头即可共享配置，非常方便。</p> 
<h5><a id="_746"></a>文件配置</h5> 
<p>在开发过程中，将配置在代码里面写死并不是一个好的习惯，更好的做法是将配置写在配置文件里面，我们可以将配置写入到配置文件，然后运行时读取配置文件里面的配置，这样是更方便管理和维护的，下面我们以一个实例来说明一下，首先我们定义一个 config.yaml 配置文件：</p> 
<pre class="prettyprint"><code class="prism language-yaml has-numbering"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">formatters</span><span class="token punctuation">:</span>
  <span class="token key atrule">brief</span><span class="token punctuation">:</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span> <span class="token string">"%(asctime)s - %(message)s"</span>
  <span class="token key atrule">simple</span><span class="token punctuation">:</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span> <span class="token string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span>
<span class="token key atrule">handlers</span><span class="token punctuation">:</span>
  <span class="token key atrule">console</span><span class="token punctuation">:</span>
    <span class="token key atrule">class</span> <span class="token punctuation">:</span> logging.StreamHandler
    <span class="token key atrule">formatter</span><span class="token punctuation">:</span> brief
    <span class="token key atrule">level</span>   <span class="token punctuation">:</span> INFO
    <span class="token key atrule">stream</span>  <span class="token punctuation">:</span> ext<span class="token punctuation">:</span>//sys.stdout
  <span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token key atrule">class</span> <span class="token punctuation">:</span> logging.FileHandler
    <span class="token key atrule">formatter</span><span class="token punctuation">:</span> simple
    <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
    <span class="token key atrule">filename</span><span class="token punctuation">:</span> debug.log
  <span class="token key atrule">error</span><span class="token punctuation">:</span>
    <span class="token key atrule">class</span><span class="token punctuation">:</span> logging.handlers.RotatingFileHandler
    <span class="token key atrule">level</span><span class="token punctuation">:</span> ERROR
    <span class="token key atrule">formatter</span><span class="token punctuation">:</span> simple
    <span class="token key atrule">filename</span><span class="token punctuation">:</span> error.log
    <span class="token key atrule">maxBytes</span><span class="token punctuation">:</span> <span class="token number">10485760</span>
    <span class="token key atrule">backupCount</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">encoding</span><span class="token punctuation">:</span> utf8
<span class="token key atrule">loggers</span><span class="token punctuation">:</span>
  <span class="token key atrule">main.core</span><span class="token punctuation">:</span>
    <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
    <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">,</span> file<span class="token punctuation">,</span> error<span class="token punctuation">]</span>
<span class="token key atrule">root</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">]</span>

</code><p>这里我们定义了 formatters、handlers、loggers、root 等模块，实际上对应的就是各个 Formatter、Handler、Logger 的配置，参数和它们的构造方法都是相同的。 接下来我们定义一个主入口文件，main.py，内容如下：</p> 
<pre class="prettyprint"><code class="has-numbering">import logging
import core
import yaml
import logging.config
import os


def setup_logging(default_path='config.yaml', default_level=logging.INFO):
    path = default_path
    if os.path.exists(path):
        with open(path, 'r', encoding='utf-8') as f:
            config = yaml.load(f)
            logging.config.dictConfig(config)
    else:
        logging.basicConfig(level=default_level)


def log():
    logging.debug('Start')
    logging.info('Exec')
    logging.info('Finished')


if __name__ == '__main__':
    yaml_path = 'config.yaml'
    setup_logging(yaml_path)
    log()
    core.run()

</code><p>这里我们定义了一个 setup_logging () 方法，里面读取了 yaml 文件的配置，然后通过 dictConfig () 方法将配置项传给了 logging 模块进行全局初始化。 另外这个模块还引入了另外一个模块 core，所以我们定义 core.py 如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'main.core'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Core Info'</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Core Debug'</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Core Error'</span><span class="token punctuation">)</span>

</code><p>这个文件的内容和上文是没有什么变化的。 观察配置文件，主入口文件 main.py 实际上对应的是 root 一项配置，它指定了 handlers 是 console，即只输出到控制台。另外在 loggers 一项配置里面，我们定义了 main.core 模块，handlers 是 console、file、error 三项，即输出到控制台、输出到普通文件和回滚文件。 这样运行之后，我们便可以看到所有的运行结果输出到了控制台：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Exec
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Finished
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Core Info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Core Info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Core Error
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">014</span> <span class="token operator">-</span> Core Error

</code><p>在 debug.log 文件中则包含了 core.py 的运行结果：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">901</span> <span class="token operator">-</span> test<span class="token punctuation">.</span>core <span class="token operator">-</span> INFO <span class="token operator">-</span> Core Info
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">901</span> <span class="token operator">-</span> test<span class="token punctuation">.</span>core <span class="token operator">-</span> DEBUG <span class="token operator">-</span> Core Debug
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">901</span> <span class="token operator">-</span> test<span class="token punctuation">.</span>core <span class="token operator">-</span> ERROR <span class="token operator">-</span> Core Error

</code><p>可以看到，通过配置文件，我们可以非常灵活地定义 Handler、Formatter、Logger 等配置，同时也显得非常直观，也非常容易维护，在实际项目中，推荐使用此种方式进行配置。 以上便是 logging 模块的基本使用方法，有了它，我们可以方便地进行日志管理和维护，会给我们的工作带来极大的方便。</p> 
<h5><a id="_852"></a>日志记录使用常见误区</h5> 
<p>在日志输出的时候经常我们会用到字符串拼接的形式，很多情况下我们可能会使用字符串的 format () 来构造一个字符串，但这其实并不是一个好的方法，因为还有更好的方法，下面我们对比两个例子：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token comment"># bad</span>
logging<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Hello {0}, {1}!'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'Congratulations'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># good</span>
logging<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Hello %s, %s!'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'Congratulations'</span><span class="token punctuation">)</span>

</code><p>这里有两种打印 Log 的方法，第一种使用了字符串的 format () 的方法进行构造，传给 logging 的只用到了第一个参数，实际上 logging 模块提供了字符串格式化的方法，我们只需要在第一个参数写上要打印输出的模板，占位符用 % s、% d 等表示即可，然后在后续参数添加对应的值就可以了，推荐使用这种方法。 运行结果如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">,</span><span class="token number">766</span> <span class="token operator">-</span> root <span class="token operator">-</span> DEBUG <span class="token operator">-</span> Hello World<span class="token punctuation">,</span> Congratulations!
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">35</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">,</span><span class="token number">766</span> <span class="token operator">-</span> root <span class="token operator">-</span> DEBUG <span class="token operator">-</span> Hello World<span class="token punctuation">,</span> Congratulations!

</code><p>另外在进行异常处理的时候，通常我们会直接将异常进行字符串格式化，但其实可以直接指定一个参数将 traceback 打印出来，示例如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">import</span> logging

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">0</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token comment"># bad</span>
    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Error: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token comment"># good</span>
    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> exc_info<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># good</span>
    logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>

</code><p>如果我们直接使用字符串格式化的方法将错误输出的话，是不会包含 Traceback 信息的，但如果我们加上 exc_info 参数或者直接使用 exception () 方法打印的话，那就会输出 Traceback 信息了。 运行结果如下：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">927</span> <span class="token operator">-</span> root <span class="token operator">-</span> ERROR <span class="token operator">-</span> Error<span class="token punctuation">:</span> division by zero
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">927</span> <span class="token operator">-</span> root <span class="token operator">-</span> ERROR <span class="token operator">-</span> Error
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"/private/var/books/aicodes/loggingtest/demo9.py"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    result <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">0</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">928</span> <span class="token operator">-</span> root <span class="token operator">-</span> ERROR <span class="token operator">-</span> Error
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"/private/var/books/aicodes/loggingtest/demo9.py"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    result <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">0</span>
ZeroDivisionError<span class="token punctuation">:</span> division by zero

</code><p>以上便是整个对 logging 模块的介绍。</p> 
<h4><a id="_909"></a>项目日志使用</h4> 
<p>首先配置日志</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token triple-quoted-string string">"""
@file: log_config
@time: 2021-05-05
@desc:日志配置
"""</span>

<span class="token keyword">import</span> logging<span class="token punctuation">.</span>config
<span class="token keyword">from</span> app<span class="token punctuation">.</span>config <span class="token keyword">import</span> LOGGER_PATH<span class="token punctuation">,</span> SEND_LOG_IP<span class="token punctuation">,</span> SEND_LOG_PORT<span class="token punctuation">,</span> SOCKE_LOG
<span class="token keyword">import</span> os

<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">)</span>

ip <span class="token operator">=</span> SEND_LOG_IP
port <span class="token operator">=</span> SEND_LOG_PORT

LOGGING_CONFIG <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">'formatters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'verbose'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">"[%(asctime)s] %(levelname)s [%(filename)s:%(lineno)s] %(message)s"</span><span class="token punctuation">,</span>
            <span class="token string">'datefmt'</span><span class="token punctuation">:</span> <span class="token string">"%Y-%m-%d %H:%M:%S"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'simple'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'%(message)s'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'console'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.StreamHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'verbose'</span><span class="token punctuation">,</span>
            <span class="token string">'stream'</span><span class="token punctuation">:</span> <span class="token string">'ext://sys.stdout'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'run'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'concurrent_log_handler.ConcurrentRotatingFileHandler'</span><span class="token punctuation">,</span>  <span class="token comment"># 这里是重点</span>
            <span class="token string">'maxBytes'</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token string">'encoding'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">'delay'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">,</span> <span class="token string">'run.log'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'verbose'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'concurrent_log_handler.ConcurrentRotatingFileHandler'</span><span class="token punctuation">,</span>  <span class="token comment"># 这里是重点</span>
            <span class="token string">'maxBytes'</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token string">'encoding'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">'delay'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">,</span> <span class="token string">'error.log'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'verbose'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'statis'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'INFO'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'concurrent_log_handler.ConcurrentRotatingFileHandler'</span><span class="token punctuation">,</span>  <span class="token comment"># 这里是重点</span>
            <span class="token string">'maxBytes'</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token string">'encoding'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
            <span class="token string">'backupCount'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">'delay'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">,</span> <span class="token string">'statis.log'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'formatter'</span><span class="token punctuation">:</span> <span class="token string">'simple'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'socket'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.handlers.SocketHandler'</span><span class="token punctuation">,</span> <span class="token comment">#远程输出日志到 TCP/IP sockets</span>
            <span class="token string">'host'</span><span class="token punctuation">:</span> ip<span class="token punctuation">,</span>
            <span class="token string">'port'</span><span class="token punctuation">:</span> port<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token string">'run'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'socket'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'socket'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'socket_statis'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> 
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'socket'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'file_statis'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token string">'statis'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

logging<span class="token punctuation">.</span>config<span class="token punctuation">.</span>dictConfig<span class="token punctuation">(</span>LOGGING_CONFIG<span class="token punctuation">)</span>

file_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>
<span class="token comment">#file_logger.debug('打印日志级别：debug')</span>
<span class="token comment">#file_logger.info('打印日志级别：info')</span>
<span class="token comment"># file_logger.warning('打印日志级别：warning')</span>
<span class="token comment"># file_logger.error('打印日志级别：error')</span>
<span class="token comment"># file_logger.critical('打印日志级别：critical')</span>


<span class="token comment"># 参考 client和server</span>
socket_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'socket'</span><span class="token punctuation">)</span>
<span class="token comment"># socket_logger.warning('打印日志级别：warning')</span>


statis_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'file_statis'</span><span class="token punctuation">)</span>  <span class="token comment"># file</span>
<span class="token comment"># statis_logger.debug('打印日志级别：debug')</span>
<span class="token comment"># statis_logger.info('打印日志级别：info')</span>
<span class="token comment"># statis_logger.warning('打印日志级别：warning')</span>
<span class="token comment"># statis_logger.error('打印日志级别：error')</span>
<span class="token comment"># statis_logger.critical('打印日志级别：critical')</span>

<span class="token comment"># 是否使用网络日志</span>
<span class="token keyword">if</span> SOCKE_LOG<span class="token punctuation">:</span>
    socket_statis_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'socket_statis'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    socket_statis_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>

</code><p>定义日志适配器，客户端</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token triple-quoted-string string">"""
@file: log_adapter
@time: 2021-05-05
"""</span>
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> logging
<span class="token keyword">from</span> app <span class="token keyword">import</span> logs_config <span class="token keyword">as</span> log_c
<span class="token keyword">from</span> app<span class="token punctuation">.</span>config <span class="token keyword">import</span> SOCKE_LOG

<span class="token keyword">def</span> <span class="token function">get_host_ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    查询本机ip地址
    :return: ip
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'8.8.8.8'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ip <span class="token operator">=</span> s<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ip


<span class="token keyword">class</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># super().__init__()</span>
        <span class="token comment"># if func:</span>
        <span class="token comment">#     self.set = types.MethodType(func, self)</span>
        <span class="token comment"># self.set()  # 赋值</span>
        self<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 没有生成task时的日志</span>
        self<span class="token punctuation">.</span>subtaskid <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>subtaskname <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>taskid <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">set_task</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> taskid<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 生成task时的日志</span>
        self<span class="token punctuation">.</span>taskid <span class="token operator">=</span> taskid
        self<span class="token punctuation">.</span>subtaskname <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>subtaskid <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">set_subtask</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> subtaskid<span class="token punctuation">,</span> subtaskname<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 在子任务时的日志</span>
        <span class="token comment"># self.__ip = self.get_host_ip()</span>
        self<span class="token punctuation">.</span>subtaskid <span class="token operator">=</span> subtaskid
        self<span class="token punctuation">.</span>subtaskname <span class="token operator">=</span> subtaskname



<span class="token keyword">class</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span>logging<span class="token punctuation">.</span>LoggerAdapter<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># return '[%s] [%s] %s' % (self.extra['taskid'], self.extra['ip'], msg), kwargs</span>
        task <span class="token operator">=</span> self<span class="token punctuation">.</span>extra<span class="token punctuation">[</span><span class="token string">'task'</span><span class="token punctuation">]</span>  <span class="token comment"># task对象</span>
        ip <span class="token operator">=</span> self<span class="token punctuation">.</span>extra<span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token string">'ip:{},taskid:{},subtaskid:{},subtaskname:{} {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> task<span class="token punctuation">.</span>taskid<span class="token punctuation">,</span> task<span class="token punctuation">.</span>subtaskid<span class="token punctuation">,</span>
                                                                       task<span class="token punctuation">.</span>subtaskname<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">,</span> kwargs

<span class="token keyword">global</span> task
task <span class="token operator">=</span> Task<span class="token punctuation">(</span><span class="token punctuation">)</span>
ip <span class="token operator">=</span> get_host_ip<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 是否启用网络日志</span>
<span class="token keyword">if</span> SOCKE_LOG<span class="token punctuation">:</span>
    socket_Adapter <span class="token operator">=</span> Adapter<span class="token punctuation">(</span>log_c<span class="token punctuation">.</span>socket_logger<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'ip'</span><span class="token punctuation">:</span> ip<span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> task<span class="token punctuation">}</span><span class="token punctuation">)</span>
    socket_Adapter<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    socket_Adapter <span class="token operator">=</span> Adapter<span class="token punctuation">(</span>log_c<span class="token punctuation">.</span>file_logger<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'ip'</span><span class="token punctuation">:</span> ip<span class="token punctuation">,</span> <span class="token string">'task'</span><span class="token punctuation">:</span> task<span class="token punctuation">}</span><span class="token punctuation">)</span>
    socket_Adapter<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

</code><p>日志socket 服务端，这里需要注意ip和port需要保持一致</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token comment"># coding=utf-8</span>
<span class="token triple-quoted-string string">"""
@file: log_server
@time: 2021-05-05
@desc: socket日志接收
"""</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> logging<span class="token punctuation">.</span>handlers
<span class="token keyword">import</span> socketserver
<span class="token keyword">import</span> struct
<span class="token keyword">import</span> logging<span class="token punctuation">.</span>config
<span class="token keyword">from</span> app <span class="token keyword">import</span> logs_config <span class="token keyword">as</span> log_c
<span class="token keyword">from</span> app<span class="token punctuation">.</span>config <span class="token keyword">import</span> RE_LOG_IP<span class="token punctuation">,</span> RE_LOG_PORT<span class="token punctuation">,</span>SEND_LOG_PORT

sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"/wfd_batch_cloud"</span><span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"/data/NJ_test/alone_env/wfd_batch_cloud"</span><span class="token punctuation">)</span>  <span class="token comment"># todo 这个路径什么用途</span>


<span class="token keyword">class</span> <span class="token class-name">LogRecordStreamHandler</span><span class="token punctuation">(</span>socketserver<span class="token punctuation">.</span>StreamRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Handler for a streaming logging request.

    This basically logs the record using whatever logging policy is
    configured locally.
    """</span>

    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Handle multiple requests - each expected to be a 4-byte length,
        followed by the LogRecord in pickle format. Logs the record
        according to whatever policy is configured locally.
        """</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            chunk <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            slen <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'&gt;L'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            chunk <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>slen<span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">&lt;</span> slen<span class="token punctuation">:</span>
                chunk <span class="token operator">=</span> chunk <span class="token operator">+</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>slen <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
            obj <span class="token operator">=</span> self<span class="token punctuation">.</span>unPickle<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
            record <span class="token operator">=</span> logging<span class="token punctuation">.</span>makeLogRecord<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>handleLogRecord<span class="token punctuation">(</span>record<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">unPickle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">handleLogRecord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># if a name is specified, we use the named logger rather than the one</span>
        <span class="token comment"># implied by the record.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>logname <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>logname
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> record<span class="token punctuation">.</span>name
        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token comment"># logger = logging.getLogger(name)</span>
        <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'socket_statis'</span><span class="token punctuation">:</span>
            logger <span class="token operator">=</span> log_c<span class="token punctuation">.</span>statis_logger
            logger<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>record<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 'socket'</span>
            logger <span class="token operator">=</span> log_c<span class="token punctuation">.</span>file_logger
            <span class="token comment"># N.B. EVERY record gets logged. This is because Logger.handle</span>
            <span class="token comment"># is normally callded AFTER logger-level filtering. If you want</span>
            <span class="token comment"># to do filtering, do it at the client end to save wasting</span>
            <span class="token comment"># cycles and network bandwidth!</span>
            logger<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>record<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">LogRecordSocketReceiver</span><span class="token punctuation">(</span>socketserver<span class="token punctuation">.</span>ThreadingTCPServer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Simple TCP socket-based logging receiver suitable for testing.
    """</span>

    allow_reuse_address <span class="token operator">=</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token operator">=</span>RE_LOG_IP<span class="token punctuation">,</span>
                 port<span class="token operator">=</span>SEND_LOG_PORT<span class="token punctuation">,</span>
                 handler<span class="token operator">=</span>LogRecordStreamHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
        socketserver<span class="token punctuation">.</span>ThreadingTCPServer<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>abort <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>logname <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">serve_until_stopped</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">import</span> select
        abort <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> <span class="token keyword">not</span> abort<span class="token punctuation">:</span>
            rd<span class="token punctuation">,</span> wr<span class="token punctuation">,</span> ex <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                       <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                       self<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
            <span class="token keyword">if</span> rd<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>handle_request<span class="token punctuation">(</span><span class="token punctuation">)</span>
            abort <span class="token operator">=</span> self<span class="token punctuation">.</span>abort


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tcpserver <span class="token operator">=</span> LogRecordSocketReceiver<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'About to start TCP server...'</span><span class="token punctuation">)</span>
    tcpserver<span class="token punctuation">.</span>serve_until_stopped<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
</code><p>开启uvicorn也可以监听日志信息</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token comment"># -*- encoding: utf-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> app<span class="token punctuation">.</span>config <span class="token keyword">import</span> LOGGER_PATH

<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
uvicorn服务器日志配置
"""</span>
UVICORN_LOGGING_CONFIG <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">"disable_existing_loggers"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token string">"formatters"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"()"</span><span class="token punctuation">:</span> <span class="token string">"uvicorn.logging.DefaultFormatter"</span><span class="token punctuation">,</span>
            <span class="token string">"fmt"</span><span class="token punctuation">:</span> <span class="token string">"%(levelprefix)s %(message)s"</span><span class="token punctuation">,</span>
            <span class="token string">"use_colors"</span><span class="token punctuation">:</span> <span class="token boolean">None</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"access"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"()"</span><span class="token punctuation">:</span> <span class="token string">"uvicorn.logging.AccessFormatter"</span><span class="token punctuation">,</span>
            <span class="token string">"fmt"</span><span class="token punctuation">:</span> <span class="token string">"[%(asctime)s]  %(levelprefix)s %(client_addr)s - \"%(request_line)s\" %(status_code)s"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"handlers"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"formatter"</span><span class="token punctuation">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
            <span class="token string">"class"</span><span class="token punctuation">:</span> <span class="token string">"logging.StreamHandler"</span><span class="token punctuation">,</span>
            <span class="token string">"stream"</span><span class="token punctuation">:</span> <span class="token string">"ext://sys.stderr"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"access"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"level"</span><span class="token punctuation">:</span> <span class="token string">"INFO"</span><span class="token punctuation">,</span>
            <span class="token string">"class"</span><span class="token punctuation">:</span> <span class="token string">"concurrent_log_handler.ConcurrentRotatingFileHandler"</span><span class="token punctuation">,</span>
            <span class="token string">"maxBytes"</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span>  <span class="token comment"># 50MB</span>
            <span class="token string">"encoding"</span><span class="token punctuation">:</span> <span class="token string">"utf-8"</span><span class="token punctuation">,</span>
            <span class="token string">"backupCount"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">"delay"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            <span class="token string">"filename"</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>LOGGER_PATH<span class="token punctuation">,</span> <span class="token string">"uvicorn.log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"formatter"</span><span class="token punctuation">:</span> <span class="token string">"access"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"loggers"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"uvicorn"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"handlers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"default"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"level"</span><span class="token punctuation">:</span> <span class="token string">"INFO"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"uvicorn.error"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"level"</span><span class="token punctuation">:</span> <span class="token string">"INFO"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"uvicorn.access"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"handlers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"access"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"level"</span><span class="token punctuation">:</span> <span class="token string">"INFO"</span><span class="token punctuation">,</span> <span class="token string">"propagate"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code><pre class="prettyprint"><code class="prism language-python has-numbering"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> uvicorn
    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span>
        app<span class="token operator">=</span><span class="token string">"main:app"</span><span class="token punctuation">,</span>
        host<span class="token operator">=</span>HOST<span class="token punctuation">,</span>
        port<span class="token operator">=</span>PORT<span class="token punctuation">,</span>
        log_config<span class="token operator">=</span>UVICORN_LOGGING_CONFIG<span class="token punctuation">,</span>
        debug<span class="token operator">=</span>DEBUG<span class="token punctuation">)</span>

</code><h4><a id="_1278"></a>参考文献</h4> 

                               
                               </pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre><ul><li>https://cuiqingcai.com/6080.html</li><li>https://juejin.cn/post/6937240397424885796</li></ul>
                
                
                
        

                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e3917996f34c10b1c89c9a882fbbdc7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">einsum的本质理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ce05dbbf7cb0e529812525be9076ca23/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">清览云题库--数据可视化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>