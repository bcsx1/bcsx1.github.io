<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux （RHEL Apache、vsftpd、Samba服务）、 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux （RHEL Apache、vsftpd、Samba服务）、" />
<meta property="og:description" content="九、使用Apache服务部署静态网站 本章讲解 Web 服务程序以及 Web 服务程序的用处，然后通过对比当前主流的 Web 服务程序来使读者更好地理解其各自的优势及特点，最后通过对 httpd 服务程序中“全局配置参数”“区域配置参数”及“注释信息”的理论讲解和实战部署 。 以及SELinux 服务的作用、 3 种工作模式以及策略管理方法，SELinux 域和 SELinux 安全上下文的配置方法，完成多个基于 httpd 服务程序的实用功能的部署实验，其中包括 httpd 服务程序的基本部署、个人用户主页功能和密码加密认证方式的实现，以及分别基于 IP 地址、主机名（域名）、端口号部署虚拟主机网站功能。 1.网站服务程序 Web 网络服务，一般是指允许用户通过浏览器访问互联网中各种资源的服务，Web 网络服务是一种被动访问的服务程序，即只有接收到互联网中其他主机发出的请求后才会响应，最终用于提供服务程序的 Web 服务器会通过 HTTP （超文本传输协议）或 HTTPS（安全超文本传输协议）把请求的内容传送给用户。 目前能够提供 Web 网络服务的程序有 IIS 、 Nginx 和 Apache 等。其中， IIS （Internet Information Service ，互联网信息服务）是 Windows 系统中默认的 Web 服务程序，这是一款图形化的网站管理工具，不仅可以提供 Web 网站服务，还可以提供 FTP 、 NMTP 、 SMTP 等服务。 2004 年 10 月 4 日，为俄罗斯知名门户站点而开发的 Web 服务程序 Nginx 横空出世。Nginx程序作为一款轻量级的网站服务软件，因其稳定性和丰富的功能而快速占领服务器市场，但Nginx 最被认可的还是其系统资源消耗低且并发能力强的特性，因此得到了国内诸如新浪、网易、腾讯等门户网站的青睐。 Apache 程序是目前拥有很高市场占有率的 Web 服务程序之一，其跨平台和安全性广泛被 认可且拥有快速、可靠、简单的 API 扩展。 它的名字取自美国印第安人的土著语，寓意为“拥有高超的作战策略和无穷的耐性”。Apache 服务程序可以运行在 Linux 系统、 UNIX 系统甚至是 Windows 系统中，它支持基于 IP、域名及端口号的虚拟主机功能，支持多种认证方式，集成有代理服务器模块、安全 Socket 层（ SSL），能够实时监视服务状态与定制日志消息，并支持各类丰富的模块。 第1步：动手安装 Apache 服务程序，在使用 dnf 命令进行安装时，跟在命令后面的 Apache 服务的软件包名称为 httpd： 第2步：启用 httpd 服务程序并将其加入到开机启动项中，使其能够随系统开机而运行，从而持续为用户提供 Web 服务。 在浏览器（这里以 Firefox 浏览器为例）的地址栏中输入 http://127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/5e70944957efaedd2514652184e994fd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-03T13:09:03+08:00" />
<meta property="article:modified_time" content="2023-11-03T13:09:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux （RHEL Apache、vsftpd、Samba服务）、</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <h2>九、使用Apache服务部署静态网站</h2> 
 <div></div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">本章讲解</span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务程序以及 </span> 
  <span style="color:#000000;">Web 服务程序的用处，然后通过对比当前主流的 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务程序来使读者更好地理解其各自的优势及特点，最后通过对 </span> 
  <span style="color:#000000;">httpd 服务程序中“全局配置参数”“区域配置参数”及“注释信息”的理论讲解和实战部署</span> 
  <span style="color:#000000;">。 以及SELinux </span> 
  <span style="color:#000000;">服务的作用、</span> 
  <span style="color:#000000;">3 种工作模式以及策略管理方法，SELinux </span> 
  <span style="color:#000000;">域和 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">安全上下文的配置方法，完成多个基于 </span> 
  <span style="color:#000000;">httpd 服务程序的实用功能的部署实验，其中包括 </span> 
  <span style="color:#000000;">httpd 服务程序的基本部署、个人用户主页功能和密码加密认证方式的实现，以及分别基于 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址、主机名（域名）、端口号部署虚拟主机网站功能。 </span> 
 </div> 
</div> 
<h3>1.网站服务程序</h3> 
<div> 
 <div> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">网络服务，一般是指允许用户通过浏览器访问互联网中各种资源的服务，Web 网络服务是一种被动访问的服务程序，即只有接收到互联网中其他主机发出的请求后才会响应，最终用于提供服务程序的 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务器会通过 </span> 
  <span style="color:#000000;">HTTP</span> 
  <span style="color:#000000;">（超文本传输协议）或 </span> 
  <span style="color:#000000;">HTTPS（安全超文本传输协议）把请求的内容传送给用户。 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">目前能够提供 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">网络服务的程序有 </span> 
  <span style="color:#000000;">IIS</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">Nginx </span> 
  <span style="color:#000000;">和 </span> 
  <span style="color:#000000;">Apache </span> 
  <span style="color:#000000;">等。其中，</span> 
  <span style="color:#000000;">IIS</span> 
  <span style="color:#000000;">（Internet Information Service</span> 
  <span style="color:#000000;">，互联网信息服务）是 </span> 
  <span style="color:#000000;">Windows </span> 
  <span style="color:#000000;">系统中默认的 </span> 
  <span style="color:#000000;">Web 服务程序，这是一款图形化的网站管理工具，不仅可以提供 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">网站服务，还可以提供 </span> 
  <span style="color:#000000;">FTP</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">NMTP</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">SMTP </span> 
  <span style="color:#000000;">等服务。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="130" src="https://images2.imgbox.com/1c/63/WQAi6j4V_o.png" width="547"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">2004 </span> 
  <span style="color:#000000;">年 </span> 
  <span style="color:#000000;">10 </span> 
  <span style="color:#000000;">月 </span> 
  <span style="color:#000000;">4 </span> 
  <span style="color:#000000;">日，为俄罗斯知名门户站点而开发的 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务程序 </span> 
  <span style="color:#000000;">Nginx 横空出世。Nginx程序作为一款轻量级的网站服务软件，因其稳定性和丰富的功能而快速占领服务器市场，但Nginx 最被认可的还是其系统资源消耗低且并发能力强的特性，因此得到了国内诸如新浪、网易、腾讯等门户网站的青睐。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">Apache </span> 
  <span style="color:#000000;">程序是目前拥有很高市场占有率的 </span> 
  <span style="color:#000000;">Web 服务程序之一，其跨平台和安全性广泛被 认可且拥有快速、可靠、简单的 </span> 
  <span style="color:#000000;">API </span> 
  <span style="color:#000000;">扩展。</span> 
  <span style="color:#000000;">它的名字取自美国印第安人的土著语，寓意为“拥有高超的作战策略和无穷的耐性”。Apache 服务程序可以运行在 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统、</span> 
  <span style="color:#000000;">UNIX </span> 
  <span style="color:#000000;">系统甚至是 </span> 
  <span style="color:#000000;">Windows </span> 
  <span style="color:#000000;">系统中，它支持基于 </span> 
  <span style="color:#000000;">IP、域名及端口号的虚拟主机功能，支持多种认证方式，集成有代理服务器模块、安全 </span> 
  <span style="color:#000000;">Socket </span> 
  <span style="color:#000000;">层（</span> 
  <span style="color:#000000;">SSL），能够实时监视服务状态与定制日志消息，并支持各类丰富的模块。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="98" src="https://images2.imgbox.com/fe/a6/Qv3lBxOj_o.png" width="375"> 
</div> 
<div> 
 <span style="color:#000000;">第1步：动手安装 </span> 
 <span style="color:#000000;">Apache 服务程序，</span>在使用 dnf 命令进行安装时，跟在命令后面的 Apache 服务的软件包名称为 httpd： 
</div> 
<div> 
 <img alt="" height="185" src="https://images2.imgbox.com/34/26/BMHN5arb_o.png" width="841"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">第2步：启用 </span> 
  <span style="color:#000000;">httpd 服务程序并将其加入到开机启动项中，使其能够随系统开机而运行，从而持续为用户提供 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务。 </span> 
 </div> 
 <img alt="" height="79" src="https://images2.imgbox.com/d1/f6/4z5XQPe5_o.png" width="919"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在浏览器（这里以 </span> 
  <span style="color:#000000;">Firefox </span> 
  <span style="color:#000000;">浏览器为例）的地址栏中输入 </span> 
  <span style="color:#000000;">http://127.0.0.1 并按回车键，就可以看到用于提供 </span> 
  <span style="color:#000000;">Web </span> 
  <span style="color:#000000;">服务的默认页面了：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="32" src="https://images2.imgbox.com/40/98/Eq1VHlFz_o.png" width="905"> 
</div> 
<div> 
 <img alt="" height="710" src="https://images2.imgbox.com/ab/40/7Vv1mrPN_o.png" width="1200"> 
</div> 
<h3>2.配置服务文件参数</h3> 
<div> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">Linux 系统中配置服务，其实就是修改服务的配置文件。因此，还需要知道这些配置文件的所在位置以及用途。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统中的配置文件：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="202" src="https://images2.imgbox.com/2f/c1/7oyjRFuG_o.png" width="845"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">主配置文件中保存的是最重要的服务参数，一般会被保存到</span> 
  <span style="color:#000000;">/etc 目录中以软件名称命名的一个文件夹之中，名字为“服务名称</span> 
  <span style="color:#000000;">.conf</span> 
  <span style="color:#000000;">”，例如这里的“</span> 
  <span style="color:#000000;">/etc/httpd/conf/httpd.conf</span> 
  <span style="color:#000000;">”。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序的主配置文件中，存在 </span> 
  <span style="color:#000000;">3 种类型的信息：注释行信息、全局配置、区域配置：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="259" src="https://images2.imgbox.com/c3/e8/T1nWcboD_o.png" width="397"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">全局配置参数就是一种全局性的配置参数，可作用于所有的子站点，既保证了子站点的正常访问，也有效降低了频繁写入重复参数的工作量。区域配置参数则是单独针对每个独立的子站点进行设置的。就像在大学食堂里面打饭，食堂负责打饭的阿姨先给每位同学来一碗标准大小的米饭（全局配置），然后再根据每位同学的具体要求盛放他们想吃的菜（区域配置）</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">配置 </span> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序时最常用的参数以及用途描述：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="202" src="https://images2.imgbox.com/0e/03/6MScodc8_o.png" width="843"> 
</div> 
<div> 
 <img alt="" height="199" src="https://images2.imgbox.com/aa/c4/bVNUq16S_o.png" width="842"> 
</div> 
<div> 
 <div> 
  <div> 
   <span style="color:#000000;">DocumentRoot 参数用于定义网站数据的保存路径，其参数的默认值是</span> 
   <span style="color:#000000;">/var/www/html（即把网站数据存放到这个目录中）；而当前网站普遍的首页面名称是index.html</span> 
   <span style="color:#000000;">，因此可以向</span> 
   <span style="color:#000000;">/var/www/html/index.html </span> 
   <span style="color:#000000;">文件中写入一段内容，替换掉 </span> 
   <span style="color:#000000;">httpd 服务程序的默认首页面。该操作会立即生效。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="46" src="https://images2.imgbox.com/13/c3/qqyOlK1K_o.png" width="853"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在 </span> 
   <span style="color:#000000;">Firefox </span> 
   <span style="color:#000000;">浏览器中刷新 </span> 
   <span style="color:#000000;">httpd 服务程序，可以看到该程序的首页面内容已经发生了改变：</span> 
  </div> 
 </div> 
</div> 
<div> 
 <img alt="" height="192" src="https://images2.imgbox.com/8a/82/OjdCprPo_o.png" width="1200"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在默认情况下，网站数据保存在/var/www/html </span> 
  <span style="color:#000000;">目录中，如果想把保存网站数据的目录修改为</span> 
  <span style="color:#000000;">/home/wwwroot </span> 
  <span style="color:#000000;">目录需要如下操作：</span> 
 </div> 
</div> 
<div> 
 <strong>第一步：</strong>建立网站数据的保存目录，并创建首页文件： 
</div> 
<div> 
 <img alt="" height="46" src="https://images2.imgbox.com/84/e3/6ieEd3KK_o.png" width="900"> 
</div> 
<div> 
 <strong>第二步：</strong>打开 httpd 服务程序的主配置文件，将约第 122 行用于定义网站数据保存路径的参数 DocumentRoot 修改为/home/wwwroot，同时还需要将约第 127 行与第 134 行用于定义目录权限的参数 Directory 后面的路径也修改为/home/wwwroot。配置文件修改完毕后即可保存并退出： 
</div> 
<div> 
 <img alt="" height="25" src="https://images2.imgbox.com/a5/0f/vJxU04YJ_o.png" width="855"> 
</div> 
<div> 
 <img alt="" height="257" src="https://images2.imgbox.com/43/5b/7RYEwxAK_o.png" width="890"> 
</div> 
<div> 
 <strong>第三步：</strong> 
 <span style="color:#000000;">重新启动 </span> 
 <span style="color:#000000;">httpd 服务程序并验证效果，浏览器刷新页面后，提示权限不足：</span> 
</div> 
<div> 
 <img alt="" height="42" src="https://images2.imgbox.com/2d/ac/ojmdOiLI_o.png" width="768"> 
</div> 
<div> 
 <img alt="" height="184" src="https://images2.imgbox.com/42/5a/8JMi96Ro_o.png" width="987"> 
</div> 
<h3>3.SELinux安全子系统</h3> 
<div> 
 <div> 
  <span style="color:#000000;">SELinux</span> 
  <span style="color:#000000;">（</span> 
  <span style="color:#000000;">Security-Enhanced Linux</span> 
  <span style="color:#000000;">）是美国国家安全局在 </span> 
  <span style="color:#000000;">Linux 开源社区的帮助下开发的一个强制访问控制（</span> 
  <span style="color:#000000;">MAC</span> 
  <span style="color:#000000;">，</span> 
  <span style="color:#000000;">Mandatory Access Control</span> 
  <span style="color:#000000;">）的安全子系统。</span> 
  <span style="color:#000000;">Linux</span> 
  <span style="color:#000000;">系统使用SELinux技术的目的是为了让各个服务进程都受到约束，使其仅获取到本应获取的资源。 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">例如，您在自己的电脑上下载了一个美图软件，正全神贯注地使用它给照片进行美颜的时候，它却在后台默默监听着浏览器中输入的密码信息，而这显然不应该是它应做的事情（哪怕是访问电脑中的图片资源，都情有可原）。</span> 
  <span style="color:#000000;">SELinux 安全子系统就是为了杜绝此类情况而设计的，它能够从多方面监控违法行为：对服务程序的功能进行限制（</span> 
  <span style="color:#000000;">SELinux 域限制可以确保服务程序做不了出格的事情）；对文件资源的访问进行限制（</span> 
  <span style="color:#000000;">SELinux 安全上下文确保文件资源只能被其所属的服务程序进行访问）。 </span> 
 </div> 
</div> 
<div> 
 <span style="color:#000000;">SELinux </span> 
 <span style="color:#000000;">域和 </span> 
 <span style="color:#000000;">SELinux </span> 
 <span style="color:#000000;">安全上下文称为 </span> 
 <span style="color:#000000;">Linux 系统中的双保险，系统</span>内的服务程序只能规规矩矩地拿到自己所应该获取的资源，这样即便黑客入侵了系统，也无法利用系统内的服务程序进行越权操作。 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">服务有 </span> 
  <span style="color:#000000;">3 </span> 
  <span style="color:#000000;">种配置模式，具体如下：</span> 
 </div> 
</div> 
<div> 
 <strong>enforcing：</strong> 
 <span style="color:#000000;">强制启用安全策略模式，将拦截服务的不合法请求。</span> 
</div> 
<div> 
 <strong>permissive：</strong> 
 <span style="color:#000000;">遇到服务越权访问时，只发出警告而不强制拦截。 </span> 
</div> 
<div> 
 <strong>disabled：</strong> 
 <span style="color:#000000;">对于越权的行为不警告也不拦截。</span> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">本书中所有的实验都是在强制启用安全策略模式下进行的，虽然在禁用 SELinux 服务后确实能够减少报错几率，但这在生产环境中相当不推荐。查看 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">服务主配置文件中定义的默认状态。如果是 </span> 
  <span style="color:#000000;">permissive </span> 
  <span style="color:#000000;">或 </span> 
  <span style="color:#000000;">disabled，建议赶紧修改为 </span> 
  <span style="color:#000000;">enforcing</span> 
  <span style="color:#000000;">。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="31" src="https://images2.imgbox.com/37/bf/8WrRWvqK_o.png" width="669"> 
</div> 
<div> 
 <img alt="" height="257" src="https://images2.imgbox.com/55/ae/GBIssE4x_o.png" width="811"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">服务的主配置文件中，定义的是 </span> 
  <span style="color:#000000;">SELinux 的默认运行状态，可以将其理解为系统重启后的状态，因此它不会在更改后立即生效。可以使用 </span> 
  <strong><span style="color:#000000;">getenforce </span></strong> 
  <span style="color:#000000;"><strong>命令</strong>获得当前 SELinux服务的运行模式： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="40" src="https://images2.imgbox.com/fe/67/9lDGSTx6_o.png" width="690"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">为了确认浏览器</span> 
  <span style="color:#000000;">的结果是因为 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">而导致的，可以用 </span> 
  <span style="color:#000000;">setenforce [0|1]命令修改SELinux </span> 
  <span style="color:#000000;">当前的运行模式（</span> 
  <span style="color:#000000;">0 </span> 
  <span style="color:#000000;">为禁用，</span> 
  <span style="color:#000000;">1 为启用）。注意，这种修改只是临时的，在系统重启后就会失效：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="59" src="https://images2.imgbox.com/91/21/NRwgfDDt_o.png" width="699"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">再次刷新网页，就会看到正常的网页内容了</span> 
  <span style="color:#000000;">。可见，问题是出在了 SELinux服务上。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="151" src="https://images2.imgbox.com/3a/3d/aM2dmfAV_o.png" width="971"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序的功能是允许用户访问网站内容，因此 </span> 
  <span style="color:#000000;">SELinux 肯定会默认放行用户对网站的请求操作。但是，我们将网站数据的默认保存目录修改为</span> 
  <span style="color:#000000;">/home/wwwroot，这就产生问题了。</span> 
  <span style="color:#000000;">/home 目录是用来存放普通用户的家目录数据的，而现在，httpd </span> 
  <span style="color:#000000;">提供的网站服务却要去获取普通用户家目录中的数据，这显然违反了 </span> 
  <span style="color:#000000;">SELinux 的监管原则。 </span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">现在，把 </span> 
  <span style="color:#000000;">SELinux 服务恢复到强制启用安全策略模式，然后分别查看原始网站数据的保存目录与当前网站数据的保存目录是否拥有不同的 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">安全上下文值。</span> 
 </div> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">ls </span> 
  <span style="color:#000000;">命令中，</span> 
  <span style="color:#000000;">-Z </span> 
  <span style="color:#000000;">参数用于查看文件的安全上下文值，</span> 
  <span style="color:#000000;">-d </span> 
  <span style="color:#000000;">参数代表对象是个文件夹。 </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="97" src="https://images2.imgbox.com/cf/41/XnkU3C7r_o.png" width="717"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在文件上设置的 </span> 
  <span style="color:#000000;">SELinux 安全上下文是由用户段、角色段以及类型段等多个信息项共同组成的。其中，用户段 </span> 
  <span style="color:#000000;">system</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">u </span> 
  <span style="color:#000000;">代表系统进程的身份，角色段 </span> 
  <span style="color:#000000;">object</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">r 代表文件目录的角色，类型段 </span> 
  <span style="color:#000000;">httpd</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">sys</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">content</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">t </span> 
  <span style="color:#000000;">代表网站服务的系统文件。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">针对当前这种情况，我们只需要使用<strong> </strong></span> 
  <strong><span style="color:#000000;">semanage </span></strong> 
  <span style="color:#000000;"><strong>命令</strong>，将当前网站目录</span> 
  <span style="color:#000000;">/home/wwwroot </span> 
  <span style="color:#000000;">的 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">安全上下文修改为跟原始网站目录的一样就行了。</span> 
 </div> 
</div> 
<h4>semanage命令</h4> 
<div> 
 <div> 
  <span style="color:#000000;">semanage </span> 
  <span style="color:#000000;">命令用于管理 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">的策略，英文全称为“</span> 
  <span style="color:#000000;">SELinux manage”，语法格式为 “</span> 
  <span style="color:#000000;">semanage [</span> 
  <span style="color:#000000;">参数</span> 
  <span style="color:#000000;">] [</span> 
  <span style="color:#000000;">文件</span> 
  <span style="color:#000000;">]</span> 
  <span style="color:#000000;">”。 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">服务极大地提升了 </span> 
  <span style="color:#000000;">Linux 系统的安全性，将用户权限牢牢地锁在笼子里。semanage </span> 
  <span style="color:#000000;">命令不仅能够像传统的 </span> 
  <span style="color:#000000;">chcon 命令那样设置文件、目录的策略，还能够管理网络端口、消息接口（这些新特性将在本章后文中涵盖）。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">semanage </span> 
  <span style="color:#000000;">命令中的常用参数以及作：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="102" src="https://images2.imgbox.com/bc/d7/1MKu8axR_o.png" width="842"> 
</div> 
<div> 
 <img alt="" height="68" src="https://images2.imgbox.com/dc/7b/9JaeIE1o_o.png" width="844"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">例如，向新的网站数据目录中新添加一条 </span> 
  <span style="color:#000000;">SELinux 安全上下文，让这个目录以及里面的所有文件能够被 </span> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序访问到： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="42" src="https://images2.imgbox.com/88/85/zopy22hx_o.png" width="938"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在执行上述设置之后，还无法立即访问网站，还需要使用 </span> 
  <span style="color:#000000;"><strong>restorecon 命令</strong>将设置好的 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">安全上下文立即生效。在使用 </span> 
  <span style="color:#000000;">restorecon </span> 
  <span style="color:#000000;">命令时，可以加上</span> 
  <span style="color:#000000;">-Rv 参数对指定的目录进行递归操作，以及显示 </span> 
  <span style="color:#000000;">SELinux 安全上下文的修改过程。最后，再次刷新页面，就可以正常看到网页内容了</span> 
 </div> 
 <div> 
  <img alt="" height="115" src="https://images2.imgbox.com/05/8d/073T6Asn_o.png" width="961"> 
 </div> 
</div> 
<div> 
 <img alt="" height="149" src="https://images2.imgbox.com/8c/02/77Jf1pHm_o.png" width="1183"> 
</div> 
<h3>4.个人用户主页功能</h3> 
<div> 
 <div> 
  <span style="color:#000000;">如果想在系统中为每位用户建立一个独立的网站，通常的方法是基于虚拟网站主机功能来部署多个网站。但这个工作会让管理员苦不堪言（尤其是用户数量很庞大时），而且在用户自行管理网站时，还会碰到各种权限限制，需要为此做很多额外的工作。其实，httpd 服务程序提供的个人用户主页功能完全可以胜任这个工作。该功能可以让系统内所有的用户在自己的家目录中管理个人的网站，而且访问起来也非常容易。 </span> 
 </div> 
</div> 
<div> 
 <strong>第1步：</strong> 
 <span style="color:#000000;">在 </span> 
 <span style="color:#000000;">httpd 服务程序中，默认没有开启个人用户主页功能。为此，我们需要编辑下</span>面的配置文件，然后在第 17 行的 UserDir disabled 参数前面加上井号（#），表示让 httpd 服务程序开启个人用户主页功能；同时再把第 24 行的 UserDir public_html 参数前面的井号（#）去掉（UserDir 参数表示网站数据在用户家目录中的保存目录名称，即 public_html 目录）。最后，在修改完毕后记得保存：/etc/httpd/conf.d/userdir.conf 
</div> 
<div> 
 <img alt="" height="257" src="https://images2.imgbox.com/bc/31/l5NcX4KV_o.png" width="710"> 
</div> 
<div> 
 <strong>第2步：</strong>在用户家目录中建立用于保存网站数据的目录及首页面文件。另外，还需要把家目录的权限修改为 755，保证其他人也有权限读取里面的内容。 
</div> 
<div> 
 <img alt="" height="78" src="https://images2.imgbox.com/4c/5a/gpSBbwKw_o.png" width="998"> 
</div> 
<div> 
 <strong>第3步：</strong> 
 <span style="color:#000000;">重新启动 </span> 
 <span style="color:#000000;">httpd </span> 
 <span style="color:#000000;">服务程序，在浏览器的地址栏中输入网址，其格式为“网址</span> 
 <span style="color:#000000;">/～</span>用户名”（其中的波浪号是必需的，而且网址、波浪号、用户名之间没有空格）。从理论上来讲，现在就可以看到用户的个人网站了。出乎意料的是，系统显示报错页面 
</div> 
<div> 
 <img alt="" height="33" src="https://images2.imgbox.com/2c/68/fT9LYnqn_o.png" width="804"> 
</div> 
<div> 
 <img alt="" height="217" src="https://images2.imgbox.com/f9/48/VHxs95Jh_o.png" width="757"> 
</div> 
<div> 
 <strong>第4步：</strong>httpd 服务程序在提供个人用户主页功能时，该用户的网站数据目录本身就应该是存放到与这位用户对应的家目录中的，所以应该不需要修改家目录的 SELinux 安全上下文。但是，前文还讲到了 SELinux 域的概念。SELinux 域确保服务程序不能执行违规的操作，只能本本分分地为用户提供服务。 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">接下来使用 </span> 
  <strong><span style="color:#000000;">getsebool </span></strong> 
  <span style="color:#000000;"><strong>命令</strong>查询并过滤出所有与 </span> 
  <span style="color:#000000;">HTTP </span> 
  <span style="color:#000000;">协议相关的安全策略。其中，off 为禁止状态，</span> 
  <span style="color:#000000;">on </span> 
  <span style="color:#000000;">为允许状态。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="404" src="https://images2.imgbox.com/9e/e8/GPvKzTB1_o.png" width="1002"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">想要开启 </span> 
  <span style="color:#000000;">httpd 服务的个人用户主页功能，那么用到的 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">域安全策略应该是</span> 
  <span style="color:#000000;">httpd</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">enable</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">homedirs 吧？大致确定后就可以用setsebool </span> 
  <span style="color:#000000;">命令来修改 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">策略中各条规则的布尔值了。大家一定要记得在 </span> 
  <span style="color:#000000;">setsebool 命令后面加上</span> 
  <span style="color:#000000;">-P </span> 
  <span style="color:#000000;">参数，让修改后的 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">策略规则永久生效且立即生效。随后刷新网页</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="29" src="https://images2.imgbox.com/0f/59/l134p5Lg_o.png" width="785"> 
</div> 
<div> 
 <img alt="" height="165" src="https://images2.imgbox.com/2f/3e/e8fBO96s_o.png" width="772"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">有时，网站的拥有者并不希望直接将网页内容显示出来，而只想让通过身份验证的用户看到里面的内容，这时就可以在网站中添加密码功能了。 </span> 
 </div> 
</div> 
<div> 
 <strong>第一步：</strong>先使用 htpasswd 命令生成密码数据库。-c 参数表示第一次生成；后面再分别添加密码数据库的存放文件，以及验证要用到的用户名称（该用户不必是系统中已有的本地账户）。 
</div> 
<div> 
 <img alt="" height="79" src="https://images2.imgbox.com/ec/2d/RvYzhvOa_o.png" width="843"> 
</div> 
<div> 
 <strong>第二步：</strong> 
 <span style="color:#000000;">继续编辑个人用户主页功能的配置文件。把第 </span> 
 <span style="color:#000000;">31</span> 
 <span style="color:#000000;">～</span> 
 <span style="color:#000000;">37 行的参数信息修改成下列</span>内容，其中以井号（#）开头的内容为添加的注释信息，可将其忽略。随后保存并退出配置文件，重启 httpd 服务程序即可生效。 
</div> 
<div> 
 <img alt="" height="228" src="https://images2.imgbox.com/4e/7a/zNGlPehW_o.png" width="725"> 
</div> 
<div> 
 <div> 
  <img alt="" height="45" src="https://images2.imgbox.com/4d/98/LvCK2F36_o.png" width="615"> 
 </div> 
 <div> 
  <span style="color:#000000;">此后，当用户再想访问某个用户的个人网站时，就必须输入账户和密码才能正常访问了。另外，验证时使用的账户和密码是用 </span> 
  <span style="color:#000000;">htpasswd 命令生成的专门用于网站登录的账户和密码，而不是系统中的账户和密码</span> 
 </div> 
 <div> 
  <img alt="" height="336" src="https://images2.imgbox.com/b5/25/UvZNyaVW_o.png" width="786"> 
 </div> 
</div> 
<div> 
 <img alt="" height="150" src="https://images2.imgbox.com/74/d1/B9vxqRQX_o.png" width="785"> 
</div> 
<h3>5.虚拟主机功能</h3> 
<div> 
 <div> 
  <span style="color:#000000;">在虚拟专用服务器（</span> 
  <span style="color:#000000;">Virtual Private Server</span> 
  <span style="color:#000000;">，</span> 
  <span style="color:#000000;">VPS</span> 
  <span style="color:#000000;">）与云计算技术诞生以前，</span> 
  <span style="color:#000000;">IDC 服务供应商为了能够更充分地利用服务器资源，同时也为了降低购买门槛，纷纷启用了虚拟主机功能。 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">利用虚拟主机功能，可以把一台处于运行状态的物理服务器分割成多个“虚拟的服务器”。但是，该技术无法实现目前云主机技术的硬件资源隔离，而只能让这些虚拟的服务器共同使用物理服务器的硬件资源，供应商只能限制硬盘的使用空间大小。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">Apache </span> 
  <span style="color:#000000;">的虚拟主机功能是服务器基于用户请求的不同 </span> 
  <span style="color:#000000;">IP 地址、主机域名或端口号，提供多个网站同时为外部提供访问服务的技术。</span> 
  <span style="color:#000000;">用户请求的资源不同，最终获取到的网页内容也各不相同</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="352" src="https://images2.imgbox.com/6d/7f/QuYD2iCX_o.png" width="818"> 
</div> 
<h4>1.基于IP地址</h4> 
<div> 
 <div> 
  <span style="color:#000000;">如果一台服务器有多个 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址，而且每个 </span> 
  <span style="color:#000000;">IP 地址与服务器上部署的每个网站一一对应，这样当用户请求访问不同的 </span> 
  <span style="color:#000000;">IP 地址时，会访问到不同网站的页面资源。而且，每个网站都有一个独立的 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址，这对搜索引擎优化也大有裨益。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">需要配置的 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址，</span> 
  <span style="color:#000000;">在配置完毕并重启网络服务之后，记得检查网络的连通性，确保 </span> 
  <span style="color:#000000;">3 </span> 
  <span style="color:#000000;">个 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址均可正常访问</span> 
 </div> 
 <div> 
  <img alt="" height="387" src="https://images2.imgbox.com/74/20/ItvKjYiw_o.png" width="681"> 
 </div> 
</div> 
<div> 
 <img alt="" height="60" src="https://images2.imgbox.com/8e/76/BMBHIi1B_o.png" width="876"> 
</div> 
<div> 
 <img alt="" height="206" src="https://images2.imgbox.com/41/28/Bt6a4qG9_o.png" width="428"> 
</div> 
<div> 
 <strong>第一步：</strong>分别在/home/wwwroot 中创建用于保存不同网站数据的 3 个目录，并向其中分别写入网站的首页文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果。 
</div> 
<div> 
 <img alt="" height="114" src="https://images2.imgbox.com/fe/37/fQY6WV7u_o.png" width="887"> 
</div> 
<div> 
 <strong>第二步：</strong>从 httpd 服务的配置文件中大约第 132 行处开始，分别追加写入 3 个基于 IP 地址的虚拟主机网站参数，然后保存并退出。需要重启 httpd 服务 
</div> 
<div> 
 <img alt="" height="462" src="https://images2.imgbox.com/de/7f/Y5NG6tqy_o.png" width="884"> 
</div> 
<div> 
 <img alt="" height="41" src="https://images2.imgbox.com/bc/b8/OvYgHHx5_o.png" width="741"> 
</div> 
<div> 
 <strong>第三步：</strong>由于当前的/home/wwwroot 目录及里面的网站数据目录的 SELinux 安全上下文与网站服务不吻合，因此 httpd 服务程序无法获取到这些网站数据目录。我们需要手动把新的网站数据目录的 SELinux 安全上下文设置正确（见前文的实验），并使用 restorecon 命令让新设置的 SELinux 安全上下文立即生效，这样就可以立即看到网站的访问效果了 
</div> 
<div> 
 <img alt="" height="294" src="https://images2.imgbox.com/77/63/oQjNQDjc_o.png" width="1200"> 
</div> 
<div> 
 <img alt="" height="451" src="https://images2.imgbox.com/f4/65/3SoXB4YE_o.png" width="1200"> 
</div> 
<h4>2.基于主机域名</h4> 
<div> 
 <div> 
  <span style="color:#000000;">当服务器无法为每个网站都分配一个独立 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址的时候，可以尝试让 Apache 自动识别用户请求的域名，从而根据不同的域名请求来传输不同的内容。在这种情况下的配置更加简单，只需要保证位于生产环境中的服务器上有一个可用的 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址（这里以 </span> 
  <span style="color:#000000;">192.168.10.10 为例）就可以了。</span> 
  <span style="color:#000000;">需要手动定义 </span> 
  <span style="color:#000000;">IP 地址与域名之间的对应关系。</span> 
  <span style="color:#000000;">/etc/hosts </span> 
  <span style="color:#000000;">是 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统中用于强制把某个主机域名解析到指定 </span> 
  <span style="color:#000000;">IP 地址的配置文件。简单来说，只要这个文件配置正确，即使网络参数中没有 </span> 
  <span style="color:#000000;">DNS 信息也依然能够将域名解析为某个 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址。 </span> 
 </div> 
</div> 
<div> 
 <strong>第1步：</strong>手动定义 IP 地址与域名之间对应关系的配置文件，保存并退出后会立即生效。可以通过分别 ping 这些域名来验证域名是否已经成功解析为 IP 地址。 
</div> 
<div> 
 <img alt="" height="28" src="https://images2.imgbox.com/0e/59/Z8vWtRto_o.png" width="698"> 
</div> 
<div> 
 <img alt="" height="105" src="https://images2.imgbox.com/82/3b/p1tnToRy_o.png" width="969"> 
</div> 
<div> 
 <img alt="" height="189" src="https://images2.imgbox.com/3d/6f/LBhG00rC_o.png" width="940"> 
</div> 
<div> 
 <strong>第2步：</strong>分别在/home/wwwroot 中创建用于保存不同网站数据的 3 个目录，并向其中分别写入网站的首页文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果。 
 <br> 
 <img alt="" height="117" src="https://images2.imgbox.com/17/a7/HEhNlfjn_o.png" width="975"> 
</div> 
<div> 
 <strong>第3步：</strong>从 httpd 服务的配置文件中大约第 132 行处开始，分别追加写入 3 个基于主机名的虚拟主机网站参数，然后保存并退出。记得需要重启 httpd 服务，这些配置才生效。 
</div> 
<div> 
 <img alt="" height="478" src="https://images2.imgbox.com/b1/97/QXxLLAxJ_o.png" width="1042"> 
</div> 
<div> 
 <img alt="" height="29" src="https://images2.imgbox.com/d5/e6/jpcdkTkk_o.png" width="771"> 
</div> 
<div> 
 <strong>第4步：</strong>因为当前的网站数据目录还是在/home/wwwroot 目录中，因此还是必须要正确设置网站数据目录文件的 SELinux 安全上下文，使其与网站服务功能相吻合。最后记得用restorecon 命令让新配置的 SELinux 安全上下文立即生效，这样就可以立即访问到虚拟主机网站了 
</div> 
<div> 
 <img alt="" height="399" src="https://images2.imgbox.com/48/c2/J8FqymFH_o.png" width="951"> 
</div> 
<div> 
 <img alt="" height="372" src="https://images2.imgbox.com/2c/5f/qZxJrdqE_o.png" width="1188"> 
</div> 
<h4>3.基于端口号</h4> 
<div> 
 <div> 
  <span style="color:#000000;">基于端口号的虚拟主机功能可以让用户通过指定的端口号来访问服务器上的网站资源。在使用 </span> 
  <span style="color:#000000;">Apache 配置虚拟网站主机功能时，基于端口号的配置方式是最复杂的。因此我们不仅要考虑 </span> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序的配置因素，还需要考虑到 </span> 
  <span style="color:#000000;">SELinux 服务对新开设端口的监控。一般来说，使用 </span> 
  <span style="color:#000000;">80</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">443</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">8080 等端口号来提供网站访问服务是比较合理的，如果使用其他端口号则会受到 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">服务的限制。</span> 
 </div> 
</div> 
<div> 
 <strong>第一步：</strong>分别在/home/wwwroot 中创建用于保存不同网站数据的 3 个目录，并向其中分别写入网站的首页文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果。 
</div> 
<div> 
 <img alt="" height="115" src="https://images2.imgbox.com/29/91/pRQzULmU_o.png" width="918"> 
</div> 
<div> 
 <strong>第二步：</strong>在 httpd 服务配置文件的第 46 行～48 行分别添加用于监听 6111、6222 和 6333端口的参数。 
</div> 
<div> 
 <img alt="" height="137" src="https://images2.imgbox.com/e9/d7/ZQ2vDeGP_o.png" width="848"> 
</div> 
<div> 
 <strong>第三步：</strong>从 httpd 服务的配置文件中大约第 134 行处开始，分别追加写入 3 个基于端口号的虚拟主机网站参数，然后保存并退出。记得需要重启 httpd 服务，这些配置才生效。 
</div> 
<div> 
 <img alt="" height="447" src="https://images2.imgbox.com/5d/cb/ZEvFJQm1_o.png" width="908"> 
</div> 
<div> 
 <strong>第四步：</strong>因为我们把网站数据目录存放在/home/wwwroot 目录中，因此还是必须要正确设置网站数据目录文件的 SELinux 安全上下文，使其与网站服务功能相吻合。最后记得用restorecon 命令让新配置的 SELinux 安全上下文立即生效。 
</div> 
<div> 
 <img alt="" height="132" src="https://images2.imgbox.com/60/27/Aq3WudsA_o.png" width="899"> 
</div> 
<div> 
 <strong>第五步：</strong>因为 SELinux 服务检测到 6111、6222 和 6333 端口原本不属于 Apache 服务应该需要的资源，但现在却以 httpd 服务程序的名义监听使用了，所以 SELinux 会拒绝使用Apache 服务使用这 3 个端口。可以使用 semanage 命令查询并过滤出所有与 HTTP 协议相关且SELinux 服务允许的端口列表。 
</div> 
<div> 
 <img alt="" height="111" src="https://images2.imgbox.com/3f/65/V2p1FR3w_o.png" width="928"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">允许的与 </span> 
  <span style="color:#000000;">HTTP </span> 
  <span style="color:#000000;">协议相关的端口号中默认没有包含 </span> 
  <span style="color:#000000;">6111</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">6222 </span> 
  <span style="color:#000000;">和 </span> 
  <span style="color:#000000;">6333，因此需要将这 </span> 
  <span style="color:#000000;">3 个端口号手动添加进去。该操作会立即生效，而且在系统重启过后依然有效。设置好后再重启 </span> 
  <span style="color:#000000;">httpd </span> 
  <span style="color:#000000;">服务程序，然后就可以看到网页内容了</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="194" src="https://images2.imgbox.com/77/22/rjcQzA7K_o.png" width="955"> 
</div> 
<div> 
 <img alt="" height="273" src="https://images2.imgbox.com/f8/e4/EH4sqWkS_o.png" width="997"> 
</div> 
<h3>6.Apache的访问控制</h3> 
<div> 
 <div> 
  <span style="color:#000000;">Apache </span> 
  <span style="color:#000000;">可以基于源主机名、源 </span> 
  <span style="color:#000000;">IP 地址或源主机上的浏览器特征等信息对网站上的资源进行访问控制。它通过 </span> 
  <span style="color:#000000;">Allow </span> 
  <span style="color:#000000;">指令允许某个主机访问服务器上的网站资源，通过 </span> 
  <span style="color:#000000;">Deny 指令实现禁止访问。在允许或禁止访问网站资源时，还会用到 </span> 
  <span style="color:#000000;">Order </span> 
  <span style="color:#000000;">指令，这个指令用来定义 Allow或 </span> 
  <span style="color:#000000;">Deny 指令起作用的顺序，其匹配原则是按照顺序进行匹配，若匹配成功则执行后面的默认指令。比如“</span> 
  <span style="color:#000000;">Order Allow, Deny”表示先将源主机与允许规则进行匹配，若匹配成功则允许访问请求，反之则拒绝访问请求。</span> 
 </div> 
</div> 
<div> 
 <strong>第一步：</strong>先在服务器上的网站数据目录中新建一个子目录，并在这个子目录中创建一个包含 Successful 单词的首页文件。 
</div> 
<div> 
 <img alt="" height="51" src="https://images2.imgbox.com/0b/4e/sIvDWo2I_o.png" width="834"> 
</div> 
<div> 
 <strong>第二步：</strong>打开 httpd 服务的配置文件，在第 161 行后面添加下述规则来限制源主机的访问。这段规则的含义是允许使用 Firefox 浏览器的主机访问服务器上的首页文件，除此之外的所有请求都将被拒绝。使用 Firefox 浏览器的访问效果 
</div> 
<div> 
 <img alt="" height="151" src="https://images2.imgbox.com/40/b2/hKshaMrX_o.png" width="807"> 
</div> 
<div> 
 <img alt="" height="196" src="https://images2.imgbox.com/bb/57/VMJU4jJZ_o.png" width="1087"> 
</div> 
<div> 
 <img alt="" height="88" src="https://images2.imgbox.com/cd/bb/8EAbf1zS_o.png" width="731"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">除了匹配源主机的浏览器特征之外，还可以通过匹配源主机的 </span> 
  <span style="color:#000000;">IP 地址进行访问控制。例如，我们只允许 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址为 </span> 
  <span style="color:#000000;">192.168.10.20 </span> 
  <span style="color:#000000;">的主机访问网站资源，那么就可以在 </span> 
  <span style="color:#000000;">httpd 服务配置文件的第 </span> 
  <span style="color:#000000;">161 </span> 
  <span style="color:#000000;">行后面添加下述规则。这样在重启 </span> 
  <span style="color:#000000;">httpd 服务程序后再用本机（即服务器，其 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址为 </span> 
  <span style="color:#000000;">192.168.10.10</span> 
  <span style="color:#000000;">）来访问网站的首页面时就会提示访问被拒绝了</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="101" src="https://images2.imgbox.com/49/95/kjxf4Air_o.png" width="599"> 
</div> 
<h2>十、使用vsftpd服务传输文件</h2> 
<div> 
 <div> 
  <span style="color:#000000;">文件传输协议（</span> 
  <span style="color:#000000;">File Transfer Protocol</span> 
  <span style="color:#000000;">，</span> 
  <span style="color:#000000;">FTP</span> 
  <span style="color:#000000;">），以及如何部署 </span> 
  <span style="color:#000000;">vsftpd 服务程序，然后深度剖析了 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">主配置文件中最常用的参数及其作用，并完整演示了 </span> 
  <span style="color:#000000;">vsftpd 服务程序 </span> 
  <span style="color:#000000;">3 种认证模式（匿名开放模式、本地用户模式、虚拟用户模式）的配置方法。本章还涵盖了可插拔认证模块</span> 
  <span style="color:#000000;">Pluggable Authentication Module</span> 
  <span style="color:#000000;">，</span> 
  <span style="color:#000000;">PAM</span> 
  <span style="color:#000000;">）的原理、作用以及实用的配置方法。 </span> 
 </div> 
</div> 
<h3>1.文件传输协议</h3> 
<div> 
 <div> 
  <span style="color:#000000;">文件传输是一种非常重要的获取资料的方式。</span> 
  <span style="color:#000000;">为了能够在如此复杂多样的设备之间解决文件传输的问题，文件传输协议（</span> 
  <span style="color:#000000;">FTP</span> 
  <span style="color:#000000;">）应运而生。 </span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">是一种在互联网中进行文件传输的协议，基于客户端</span> 
  <span style="color:#000000;">/</span> 
  <span style="color:#000000;">服务器模式，默认使用 </span> 
  <span style="color:#000000;">20</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">21 号端 口，其中端口</span> 
  <span style="color:#000000;">20 </span> 
  <span style="color:#000000;">用于进行数据传输，端口</span> 
  <span style="color:#000000;">21 </span> 
  <span style="color:#000000;">用于接受客户端发出的相关</span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">命令与参数。</span> 
  <span style="color:#000000;">FTP 服 务器普遍部署于内网中，具有容易搭建、方便管理的特点。而且有些 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">客户端工具还可以支持</span> 
 </div> 
 <div> 
  <span style="color:#000000;">件的多点下载以及断点续传技术，因此得到了广大用户的青睐</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="115" src="https://images2.imgbox.com/50/6c/Ul22yvfH_o.png" width="421"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务器是按照 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">协议在互联网上提供文件存储和访问服务的主机，</span> 
  <span style="color:#000000;">FTP 客户端则是向服务器发送连接请求，以建立数据传输链路的主机。</span> 
 </div> 
</div> 
<div> 
 <strong>主动模式：</strong> 
 <span style="color:#000000;">FTP </span> 
 <span style="color:#000000;">服务器主动向客户端发起连接请求。</span> 
</div> 
<div> 
 <strong>被动模式：</strong> 
 <span style="color:#000000;">FTP </span> 
 <span style="color:#000000;">服务器等待客户端发起连接请求（默认工作模式）。</span> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">防火墙一般是用于过滤从外网进入内网的流量，因此有些时候需要将 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">的工作模式设置为主动模式，才可以传输数据。 </span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">由于 </span> 
  <span style="color:#000000;">FTP</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">HTTP</span> 
  <span style="color:#000000;">、</span> 
  <span style="color:#000000;">Telnet 等协议的数据都是使用明文进行传输的，因此从设计上就是不可靠的。人们为了满足以密文方式传输文件的需求，发明了 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序。</span> 
  <span style="color:#000000;">vsftpd</span> 
  <span style="color:#000000;">（very secureftp daemon</span> 
  <span style="color:#000000;">，非常安全的 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">守护进程）是一款运行在 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">操作系统上的 FTP 服务程序，不仅完全开源而且免费。此外，它还具有很高的安全性、传输速度，以及支持虚拟用户验证等其他 </span> 
  <span style="color:#000000;">FTP 服务程序不具备的特点。在不影响使用的前提下，管理者可以自行决定客户端是采用匿名开放、本地用户还是虚拟用户的验证方式来登录 </span> 
  <span style="color:#000000;">vsftpd 服务器。这样即便黑客拿到了虚拟用户的账号密码，也不见得能成功登录 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务器。 </span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在配置妥当软件仓库之后，就可以安装 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序了。无论是使用 </span> 
  <span style="color:#000000;">yum </span> 
  <span style="color:#000000;">还是 </span> 
  <span style="color:#000000;">dnf 命令都可以安装</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="261" src="https://images2.imgbox.com/d3/7b/tFFLTid8_o.png" width="1014"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">tables </span> 
  <span style="color:#000000;">防火墙管理工具默认禁止了 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">协议的端口号，因此在正式配置 </span> 
  <span style="color:#000000;">vsftpd 服务程序之前，为了避免这些默认的防火墙策略“捣乱”，还需要清空 </span> 
  <span style="color:#000000;">iptables 防火墙的默认策略，并把当前已经被清理的防火墙策略状态保存下来：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="78" src="https://images2.imgbox.com/2a/8c/J81tZG2v_o.png" width="837"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">然后再把 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">协议添加到 </span> 
  <span style="color:#000000;">firewalld </span> 
  <span style="color:#000000;">服务的允许列表中（前期准备工作一定要做充足）： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="91" src="https://images2.imgbox.com/b8/64/98lMVB5x_o.png" width="923"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序的主配置文件（</span> 
  <span style="color:#000000;">/etc/vsftpd/vsftpd.conf</span> 
  <span style="color:#000000;">）内容总长度有 </span> 
  <span style="color:#000000;">127 行之多，但其 中大多数参数在开头都添加了井号（</span> 
  <span style="color:#000000;">#），从而成为注释信息，大家没有必要在注释信息上花费太多的时间。我们可以在 </span> 
  <span style="color:#000000;">grep </span> 
  <span style="color:#000000;">命令后面添加</span> 
  <span style="color:#000000;">-v </span> 
  <span style="color:#000000;">参数，过滤并反选出没有包含井号（#）的参数行（即过滤掉所有的注释信息），然后将过滤后的参数行通过输出重定向符写回原始的主配置文件中。</span> 
 </div> 
 <div> 
  <img alt="" height="29" src="https://images2.imgbox.com/7c/96/JIOeacqX_o.png" width="810"> 
 </div> 
</div> 
<div> 
 <img alt="" height="209" src="https://images2.imgbox.com/44/cd/VK1ipdCt_o.png" width="422"> 
</div> 
<div> 
 <img alt="" height="122" src="https://images2.imgbox.com/ae/2a/ZSJF6Um4_o.png" width="434"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序主配置文件中常用的参数以及作用</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="158" src="https://images2.imgbox.com/8e/b7/Z4dfDOXD_o.png" width="797"> 
</div> 
<div> 
 <img alt="" height="62" src="https://images2.imgbox.com/a8/72/xKWM9GaQ_o.png" width="798"> 
</div> 
<div> 
 <img alt="" height="525" src="https://images2.imgbox.com/6b/04/Tw53MHc1_o.png" width="797"> 
</div> 
<h3>2.vsftpd服务程序</h3> 
<div> 
 <div> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">作为更加安全的文件传输协议服务程序，允许用户以 </span> 
  <span style="color:#000000;">3 </span> 
  <span style="color:#000000;">种认证模式登录 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务器。 </span> 
 </div> 
</div> 
<div> 
 <strong>匿名开放模式：</strong>是最不安全的一种认证模式，任何人都可以无须密码验证而直接登录到 FTP 服务器。 
</div> 
<div> 
 <strong>本地用户模式：</strong>是通过 Linux 系统本地的账户密码信息进行认证的模式，相较于匿名开放模式更安全，而且配置起来也很简单。但是如果黑客破解了账户的信息，就可以畅通无阻地登录 FTP 服务器，从而完全控制整台服务器。 
</div> 
<div> 
 <strong>虚拟用户模式：</strong>更安全的一种认证模式，它需要为 FTP 服务单独建立用户数据库文件，虚拟出用来进行密码验证的账户信息，而这些账户信息在服务器系统中实际上是不存在的，仅供 FTP 服务程序进行认证使用。这样，即使黑客破解了账户信息也无法登录服务器，从而有效降低了破坏范围和影响。 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">ftp </span> 
  <span style="color:#000000;">是 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统中以命令行界面的方式来管理 </span> 
  <span style="color:#000000;">FTP 传输服务的客户端工具。我们首先手动安装这个 </span> 
  <span style="color:#000000;">ftp </span> 
  <span style="color:#000000;">客户端工具，以便在后续实验中查看结果。 </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="202" src="https://images2.imgbox.com/cb/e7/zjrsRaR0_o.png" width="993"> 
</div> 
<h4>1.匿名访问模式</h4> 
<div> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">vsftpd 服务程序中，匿名开放模式是最不安全的一种认证模式。任何人都可以无须密码验证而直接登录 </span> 
  <span style="color:#000000;">FTP 服务器。这种模式一般用来访问不重要的公开文件（在生产环境中尽量不要存放重要文件）。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">vsftpd 服务程序默认关闭了匿名开放模式，我 们需要做的就是开放匿名用户的上传、下载文件的权限，以及让匿名用户创建、删除、更名文件的权限。需要注意的是，针对匿名用户放开这些权限会带来潜在危险，我们只是为了在 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统中练习配置 </span> 
  <span style="color:#000000;">vsftpd 服务程序而放开了这些权限，不建议在生产环境中如此行事。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">向匿名用户开放的权限参数以及作用</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="188" src="https://images2.imgbox.com/2c/ea/u2dMHNIu_o.png" width="801"> 
</div> 
<div> 
 <img alt="" height="140" src="https://images2.imgbox.com/cd/9a/6NhQWYgS_o.png" width="879"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序的主配置文件中正确填写参数，然后保存并退出。还需要重启 vsftpd服务程序，让新的配置参数生效</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="72" src="https://images2.imgbox.com/20/6d/fFsMZgLb_o.png" width="1015"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">现在就可以在客户端执行 </span> 
  <span style="color:#000000;">ftp </span> 
  <span style="color:#000000;">命令连接到远程的 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务器了。在 </span> 
  <span style="color:#000000;">vsftpd 服务程序的匿名开放认证模式下，其账户统一为 </span> 
  <span style="color:#000000;">anonymous</span> 
  <span style="color:#000000;">，密码为空。而且在连接 </span> 
  <span style="color:#000000;">FTP 服务器后，默认访问的是</span> 
  <span style="color:#000000;">/var/ftp </span> 
  <span style="color:#000000;">目录。可以切换到该目录下的 </span> 
  <span style="color:#000000;">pub 目录中，然后尝试创建一个新的目录文件，以检验是否拥有写入权限： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="240" src="https://images2.imgbox.com/75/eb/TYLiaYtc_o.png" width="1006"> 
 <div> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序的匿名开放认证模式下，默认访问的是</span> 
  <span style="color:#000000;">/var/ftp 目录。查看该目录的权限得知，只有 </span> 
  <span style="color:#000000;">root 管理员才有写入权限。怪不得系统会拒绝操作呢！下面将目录的所有者身份改成系统账户 </span> 
  <span style="color:#000000;">ftp </span> 
  <span style="color:#000000;">即可</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="58" src="https://images2.imgbox.com/60/d2/TmRJtqB7_o.png" width="796"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">尽管在使用 </span> 
  <span style="color:#000000;">ftp </span> 
  <span style="color:#000000;">命令登入 </span> 
  <span style="color:#000000;">FTP 服务器后，在创建目录时系统依然提示操作失败，但是报错信息却发生了变化。在没有写入权限时，系统提示“权限拒绝”（Permissiondenied</span> 
  <span style="color:#000000;">），所以怀疑是权限的问题。但现在系统提示“创建目录的操作失败”（Createdirectory operation failed</span> 
  <span style="color:#000000;">），想必各位读者也应该意识到是 </span> 
  <span style="color:#000000;">SELinux 服务在“捣乱”了吧。</span> 
 </div> 
 <div> 
  <span style="color:#000000;">下面使用 </span> 
  <span style="color:#000000;">getsebool </span> 
  <span style="color:#000000;">命令查看与 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">相关的 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">域策略都有哪些： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="239" src="https://images2.imgbox.com/c2/8d/8Ngywmip_o.png" width="896"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">我们可以根据经验（需要长期培养，别无它法）和策略的名称判断出是 </span> 
  <span style="color:#000000;">ftpd</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">full</span> 
  <span style="color:#000000;">_access--&gt; off </span> 
  <span style="color:#000000;">策略规则导致了操作失败。接下来修改该策略规则，并且在设置时使用</span> 
  <span style="color:#000000;">-P 参数让修改过的策略永久生效，确保在服务器重启后依然能够顺利写入文件。</span> 
 </div> 
 <div> 
  <span style="color:#000000;">等 </span> 
  <span style="color:#000000;">SELinux </span> 
  <span style="color:#000000;">域策略修改完毕后，就能够顺利执行文件的创建、修改及删除等操作了：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="385" src="https://images2.imgbox.com/7a/05/MRrlzzUt_o.png" width="899"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在上面的操作中，由于权限不足，所以我们将</span> 
  <span style="color:#000000;">/var/ftp/pub </span> 
  <span style="color:#000000;">目录的所有者设置成 </span> 
  <span style="color:#000000;">ftp 用户本身。除了这种方法，也可以通过设置权限的方法让其他用户获取到写入权限（例如 </span> 
  <span style="color:#000000;">777 这样的权限）。但是，由于 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务自身带有安全保护机制，因此不要直接修改</span> 
  <span style="color:#000000;">/var/ftp 的权限，这有可能导致服务被“安全锁定”而不能登录。</span> 
 </div> 
</div> 
<h4>2.本地用户模式</h4> 
<div> 
 <div> 
  <span style="color:#000000;">相较于匿名开放模式，本地用户模式要更安全，而且配置起来也很简单。如果大家之前用的是匿名开放模式，现在就可以将它关了，然后开启本地用户模式。</span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">本地用户模式使用的权限参数以及作用</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="127" src="https://images2.imgbox.com/5c/d3/84iAHuNN_o.png" width="799"> 
</div> 
<div> 
 <img alt="" height="126" src="https://images2.imgbox.com/d0/1f/LFVv0JG5_o.png" width="798"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">默认情况下本地用户所需的参数都已经存在，不需要修改</span> 
  <span style="color:#000000;">unmask 一般被称为“权限掩码”或“权限补码”，能够直接影响到新建文件的权限值。例如在 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统中，新建的普通文件的权限是 </span> 
  <span style="color:#000000;">644，新建的目录的权限是 </span> 
  <span style="color:#000000;">755。</span> 
 </div> 
 <div> 
  <span style="color:#000000;">其实，普通文件的默认权限是 </span> 
  <span style="color:#000000;">666</span> 
  <span style="color:#000000;">，目录的默认权限是 </span> 
  <span style="color:#000000;">777，这都是写在系统配置文件中的。但默认值不等于最终权限值。</span> 
  <span style="color:#000000;">umask </span> 
  <span style="color:#000000;">参数的默认值是 </span> 
  <span style="color:#000000;">022</span> 
  <span style="color:#000000;">，根据公式“默认权限−umask＝实际权限”，所以普通文件的默认权限到手后就剩下 </span> 
  <span style="color:#000000;">644</span> 
  <span style="color:#000000;">，而目录文件就剩下 </span> 
  <span style="color:#000000;">755 </span> 
  <span style="color:#000000;">了。 </span> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">来配置本地用户的参数：</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="236" src="https://images2.imgbox.com/3a/12/FHLKgaJ7_o.png" width="947"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">需要重启 vsftpd 服务程序，让新的配置参数生效。在执行完上一个实验并还原虚拟机之后，还需要将配置好 的服务添加到开机启动项中，以便在系统重启自后依然可以正常使用 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务。 </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="40" src="https://images2.imgbox.com/7d/81/nbPUp9xr_o.png" width="744"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在使用 </span> 
  <span style="color:#000000;">root 管理员的身份登录后，系统提示如下的错误信息： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="127" src="https://images2.imgbox.com/43/aa/GwhInw9o_o.png" width="771"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">，在我们输入 </span> 
  <span style="color:#000000;">root </span> 
  <span style="color:#000000;">管理员的密码之前，就已经被系统拒绝访问了。这是因为 vsftpd服务程序所在的目录中默认存放着两个名为“用户名单”的文件（</span> 
  <span style="color:#000000;">ftpusers </span> 
  <span style="color:#000000;">和 </span> 
  <span style="color:#000000;">user</span> 
  <span style="color:#000000;">_list）。</span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序目录中的这两个文件只要里面写有某位用户的名字，就不再允许这位用户登录到 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务器上。</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="540" src="https://images2.imgbox.com/7d/50/ZDK9rsFA_o.png" width="949"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">服务程序为了保证服务器的安全性而默认禁止了 </span> 
  <span style="color:#000000;">root 管理员和大多数系统用户的登录行为，这样可以有效地避免黑客通过 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务对</span> 
  <span style="color:#000000;">root 管理员密码进行暴力破解。如果您确认在生产环境中使用</span> 
  <span style="color:#000000;">root </span> 
  <span style="color:#000000;">管理员不会对系统安全产生影响，只需按照上面的提示删除掉 </span> 
  <span style="color:#000000;">root 用户名即可。也可以选择</span> 
  <span style="color:#000000;">ftpusers </span> 
  <span style="color:#000000;">和</span> 
  <span style="color:#000000;">user</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">list </span> 
  <span style="color:#000000;">文件中不存在的一个普通用户尝试登录</span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">服务器： </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="178" src="https://images2.imgbox.com/d3/8a/c3UI6EPV_o.png" width="684"> 
</div> 
<div> 
 <div> 
  <div> 
   <span style="color:#000000;">在采用本地用户模式登录 FTP 服务器后，默认访问的是该用户的家目录，而且该目录的默认所有者、所属组都是该用户自己，因此不存在写入权限不足的情况。但是当前的操作仍然被拒绝，这是0因为我们刚才将虚拟机系统还原到最初的状态了。为此，需要再次开启 </span> 
   <span style="color:#000000;">SELinux </span> 
   <span style="color:#000000;">域中对 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">服务的允许策略： </span> 
  </div> 
 </div> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">在配置妥当后再使用本地用户尝试登录 </span> 
  <span style="color:#000000;">FTP 服务器，分别执行文件的创建、重命名及删除等命令。操作均成功！</span> 
 </div> 
</div> 
<div> 
 <img alt="" height="261" src="https://images2.imgbox.com/b5/db/S70lVriP_o.png" width="927"> 
</div> 
<h4>3.虚拟用户模式</h4> 
<div> 
 <div> 
  <span style="color:#000000;">专门创建出一个账 号来登录 </span> 
  <span style="color:#000000;">FTP </span> 
  <span style="color:#000000;">传输服务的，而且这个账号不能用于以 </span> 
  <span style="color:#000000;">SSH 方式登录服务器。当然，因为它的安全性较之于前面两种模式有了提升，所以配置流程也会稍微复杂一些。</span> 
 </div> 
</div> 
<div> 
 <strong>第一步：</strong>重新安装 vsftpd 服务。创建用于进行 FTP 认证的用户数据库文件，其中奇数行为账户名，偶数行为密码。例如，分别创建 zhangsan 和 lisi 两个用户，密码均为 redhat： 
</div> 
<div> 
 <img alt="" height="46" src="https://images2.imgbox.com/fe/28/kYYK6bq2_o.png" width="726"> 
</div> 
<div> 
 <img alt="" height="92" src="https://images2.imgbox.com/fc/6d/BAya0HIO_o.png" width="787"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">由于明文信息既不安全，也不符合让 </span> 
  <span style="color:#000000;">vsftpd 服务程序直接加载的格式，因此需要使用db</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">load </span> 
  <span style="color:#000000;">命令用哈希（</span> 
  <span style="color:#000000;">hash）算法将原始的明文信息文件转换成数据库文件，并且降低数据库文件的权限（避免其他人看到数据库文件的内容），然后再把原始的明文信息文件删除。 </span> 
 </div> 
 <div> 
  <img alt="" height="59" src="https://images2.imgbox.com/fa/45/d8fOGuKm_o.png" width="889"> 
 </div> 
</div> 
<div> 
 <strong>第二步：</strong>创建 vsftpd 服务程序用于存储文件的根目录以及用于虚拟用户映射的系统本地用户。vsftpd 服务用于存储文件的根目录指的是，当虚拟用户登录后所访问的默认位置。 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">由于 Linux 系统中的每一个文件都有所有者、所属组属性，例如使用虚拟账户“张三” 新建了一个文件，但是系统中找不到账户“张三”，就会导致这个文件的权限出现错误。为此，</span>需要再创建一个可以映射到虚拟用户的 
  <strong>系统本地用户</strong>。简单来说，就是让虚拟用户默认登录到与之有映射关系的这个系统本地用户的家目录中。虚拟用户创建的文件的属性也都归属于这个系统本地用户，从而避免 Linux 系统无法处理虚拟用户所创建文件的属性权限。 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">为了方便管理 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">服务器上的数据，可以把这个系统本地用户的家目录设置为/var 目录（该目录用来存放经常发生改变的数据）。并且为了安全起见，将这个系统本地用户设置为不允许登录 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">服务器，这不会影响虚拟用户登录，而且还能够避免黑客通过这个系统本地用户进行登录。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="27" src="https://images2.imgbox.com/4e/da/5uclc1Yn_o.png" width="847"> 
 </div> 
 <div> 
  <img alt="" height="62" src="https://images2.imgbox.com/65/8e/MMGW9J57_o.png" width="780"> 
 </div> 
</div> 
<div> 
 <strong>第三步：</strong> 
 <span style="color:#000000;">建立用于支持虚拟用户的 </span> 
 <span style="color:#000000;">PAM </span> 
 <span style="color:#000000;">文件。 </span> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">PAM</span> 
  <span style="color:#000000;">（可插拔认证模块）是一种认证机制，通过一些动态链接库和统一的 </span> 
  <span style="color:#000000;">API 把系统提供的服务与认证方式分开，使得系统管理员可以根据需求灵活调整服务程序的不同认证方式。</span> 
 </div> 
 <div>
   通俗来讲，PAM 是一组安全机制的模块，系统管理员可以用来轻易地调整服务程序的认 
  <span style="color:#000000;">证方式，而不必对应用程序进行任何修改。</span> 
  <span style="color:#000000;">PAM 采取了分层设计（应用程序层、应用接口层、 鉴别模块层）的思想</span> 
 </div> 
 <div> 
  <img alt="" height="241" src="https://images2.imgbox.com/00/17/wiP1jvmP_o.png" width="360"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">新建一个用于虚拟用户认证的 </span> 
   <span style="color:#000000;">PAM </span> 
   <span style="color:#000000;">文件 </span> 
   <span style="color:#000000;">vsftpd.vu</span> 
   <span style="color:#000000;">，其中 </span> 
   <span style="color:#000000;">PAM </span> 
   <span style="color:#000000;">文件内的“</span> 
   <span style="color:#000000;">db=”参数为使用db</span> 
   <span style="color:#000000;">_</span> 
   <span style="color:#000000;">load </span> 
   <span style="color:#000000;">命令生成的账户密码数据库文件的路径，但不用写数据库文件的后缀： </span> 
  </div> 
  <div> 
   <img alt="" height="30" src="https://images2.imgbox.com/ca/a4/wdGYYllW_o.png" width="823"> 
  </div> 
  <div> 
   <img alt="" height="164" src="https://images2.imgbox.com/5b/7b/ZuxFCoQj_o.png" width="968"> 
  </div> 
 </div> 
</div> 
<div> 
 <strong>第四步：</strong>在 vsftpd 服务程序的主配置文件中通过 pam_service_name 参数将 PAM 认证文件的名称修改为 vsftpd.vu。PAM 作为应用程序层与鉴别模块层的连接纽带，可以让应用程序根据需求灵活地在自身插入所需的鉴别功能模块。当应用程序需要 PAM 认证时，则需要在应用程序中定义负责认证的 PAM 配置文件，实现所需的认证功能。 
</div> 
<div> 
 <span style="color:#000000;">在 </span> 
 <span style="color:#000000;">vsftpd </span> 
 <span style="color:#000000;">服务程序的主配置文件中默认就带有参数 </span> 
 <span style="color:#000000;">pam</span> 
 <span style="color:#000000;">_</span> 
 <span style="color:#000000;">service</span> 
 <span style="color:#000000;">_</span> 
 <span style="color:#000000;">name=vsftpd，表</span>示登录 FTP 服务器时是根据/etc/pam.d/vsftpd 文件进行安全认证的。现在我们要做的就是把vsftpd 主配置文件中原有的 PAM 认证文件 vsftpd 修改为新建的 vsftpd.vu 文件即可。 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">利用 </span> 
  <span style="color:#000000;">PAM </span> 
  <span style="color:#000000;">文件进行认证时使用的参数以及作用 </span> 
 </div> 
</div> 
<div> 
 <img alt="" height="148" src="https://images2.imgbox.com/b8/6b/P9nCMQDD_o.png" width="477"> 
</div> 
<div> 
 <img alt="" height="155" src="https://images2.imgbox.com/81/55/pMurCpNv_o.png" width="473"> 
</div> 
<div> 
 <strong>第五步：</strong>为虚拟用户设置不同的权限。虽然账户 zhangsan 和 lisi 都是用于 vsftpd 服务程序认证的虚拟账户，但是我们依然想对这两人进行区别对待。比如，允许张三上传、创建、修改、查看、删除文件，只允许李四查看文件。这可以通过 vsftpd 服务程序来实现。只需新建一个目录，在里面分别创建两个以 zhangsan 和 lisi 命名的文件，其中在名为 zhangsan 的文件中写入允许的相关权限（使用匿名用户的参数）： 
</div> 
<div> 
 <img alt="" height="62" src="https://images2.imgbox.com/29/ea/imO7MVcy_o.png" width="716"> 
</div> 
<div> 
 <img alt="" height="26" src="https://images2.imgbox.com/aa/6b/423yuRl3_o.png" width="762"> 
</div> 
<div> 
 <img alt="" height="119" src="https://images2.imgbox.com/ad/60/QE0kuCgG_o.png" width="745"> 
</div> 
<div> 
 <div> 
  <span style="color:#000000;">然后再次修改 </span> 
  <span style="color:#000000;">vsftpd </span> 
  <span style="color:#000000;">主配置文件，通过添加 </span> 
  <span style="color:#000000;">user</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">config</span> 
  <span style="color:#000000;">_</span> 
  <span style="color:#000000;">dir 参数来定义这两个虚拟用户不同权限的配置文件所存放的路径。为了让修改后的参数立即生效，需要重启 </span> 
  <span style="color:#000000;">vsftpd 服务程序并将该服务添加到开机启动项中：</span> 
 </div> 
 <div> 
  <img alt="" height="99" src="https://images2.imgbox.com/a9/64/lVhYsa2K_o.png" width="829"> 
 </div> 
 <div> 
  <img alt="" height="59" src="https://images2.imgbox.com/13/db/Ke2PJnuY_o.png" width="917"> 
 </div> 
 <div> 
  <strong>第六步：</strong>设置 SELinux 域允许策略，然后使用虚拟用户模式登录 FTP 服务器。先按照前面实验中的步骤开启 SELinux 域的允许策略，以免再次出现操作失败的情况： 
 </div> 
 <div> 
  <img alt="" height="29" src="https://images2.imgbox.com/b6/ca/9yOixqJE_o.png" width="860"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">可以使用虚拟用户模式成功登录到 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">服务器，还可以分别使用账户 zhangsan和 </span> 
   <span style="color:#000000;">lisi </span> 
   <span style="color:#000000;">来检验他们的权限。李四只能登录，没有其他权限：</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="204" src="https://images2.imgbox.com/7d/e2/auMaEI1H_o.png" width="789"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">张三不仅可以登录，还可以创建、改名和删除文件，因此张三的权限是满的。当然，大家在生产环境中一定要根据真实需求来灵活配置参数，不要照搬这里的实验操作。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="171" src="https://images2.imgbox.com/b5/4d/dyeszWPx_o.png" width="448"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">使用不同方式登录后的所在的位置：</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="127" src="https://images2.imgbox.com/d1/80/sNt1gVg8_o.png" width="798"> 
 </div> 
 <h3>3.TFTP（简单文件传输协议）</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">简单文件传输协议（</span> 
   <span style="color:#000000;">Trivial File Transfer Protocol</span> 
   <span style="color:#000000;">，</span> 
   <span style="color:#000000;">TFTP</span> 
   <span style="color:#000000;">）是一种基于 UDP 协议在客户端和服务器之间进行简单文件传输的协议。顾名思义，它提供不复杂、开销不大的文件传输服务，可将其当作 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">协议的简化版本。 </span> 
  </div> 
  <div> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">的命令功能不如 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">服务强大，甚至不能遍历目录，在安全性方面也弱于 </span> 
   <span style="color:#000000;">FTP 服务。而且，由于 </span> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">在传输文件时采用的是 </span> 
   <span style="color:#000000;">UDP </span> 
   <span style="color:#000000;">协议，占用的端口号为 </span> 
   <span style="color:#000000;">69，因此文件的传输过程也不像 </span> 
   <span style="color:#000000;">FTP </span> 
   <span style="color:#000000;">协议那样可靠。但是，因为 </span> 
   <span style="color:#000000;">TFTP 不需要客户端的权限认证，也就减少了无谓的系统和网络带宽消耗，因此在传输琐碎（</span> 
   <span style="color:#000000;">trivial</span> 
   <span style="color:#000000;">）不大的文件时，效率更高。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">接下来在系统上安装相关的软件包，进行体验。其中，</span> 
   <span style="color:#000000;">tftp-server </span> 
   <span style="color:#000000;">是服务程序，</span> 
   <span style="color:#000000;">tftp 是用于连接测试的客户端工具，</span> 
   <span style="color:#000000;">xinetd </span> 
   <span style="color:#000000;">是管理服务</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="259" src="https://images2.imgbox.com/e2/07/Y2FEkOXW_o.png" width="979"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在 </span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">系统中，</span> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">服务是使用 </span> 
   <span style="color:#000000;">xinetd </span> 
   <span style="color:#000000;">服务程序来管理的。xinetd 服务可以用来管理多种轻量级的网络服务，而且具有强大的日志功能。它专门用于控制那些比较小的应用程序的开启与关闭，有点类似于带有独立开关的插线板（见图 </span> 
   <span style="color:#000000;">11-3），想开启那个服务，就编辑对应的 </span> 
   <span style="color:#000000;">xinetd </span> 
   <span style="color:#000000;">配置文件的开关参数。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">简单来说，在安装</span> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">软件包后，还需要在 </span> 
   <span style="color:#000000;">xinetd </span> 
   <span style="color:#000000;">服务程序中将其开启。在</span> 
   <span style="color:#000000;">RHEL 8 系统中， tftp </span> 
   <span style="color:#000000;">所对应的配置文件默认不存在，需要用户根据示例文件（</span> 
   <span style="color:#000000;">/usr/share/doc/xinetd/sample.conf）自行创建。可以直接将下面的内容复制到文件中，就可以使用了： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="300" src="https://images2.imgbox.com/63/c0/wGSaKtrk_o.png" width="825"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">重启 </span> 
   <span style="color:#000000;">xinetd </span> 
   <span style="color:#000000;">服务并将它添加到系统的开机启动项中，以确保 </span> 
   <span style="color:#000000;">TFTP 服务在系统重启后依然处于运行状态。考虑到有些系统的防火墙默认没有允许 </span> 
   <span style="color:#000000;">UDP </span> 
   <span style="color:#000000;">协议的 </span> 
   <span style="color:#000000;">69 端口，因此需要手动将该端口号加入到防火墙的允许策略中： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="191" src="https://images2.imgbox.com/91/3e/NdqFkoUR_o.png" width="958"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">的根目录为</span> 
   <span style="color:#000000;">/var/lib/tftpboot</span> 
   <span style="color:#000000;">。可以使用刚才安装好的 </span> 
   <span style="color:#000000;">tftp 命令尝试访问其中的文件，亲身体验 </span> 
   <span style="color:#000000;">TFTP </span> 
   <span style="color:#000000;">服务的文件传输过程。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">tftp </span> 
   <span style="color:#000000;">命令中可用的参数以及作用</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="315" src="https://images2.imgbox.com/97/51/XK57roqR_o.png" width="801"> 
 </div> 
 <div> 
  <img alt="" height="172" src="https://images2.imgbox.com/f0/07/XuBLrFxp_o.png" width="973"> 
 </div> 
 <h2>十一、使用Samba或NFS实现文件共享</h2> 
 <div> 
  <div> 
   <span style="color:#000000;">介绍 </span> 
   <span style="color:#000000;">SMB </span> 
   <span style="color:#000000;">协议与 </span> 
   <span style="color:#000000;">Samba 服务程序的起源和发展过程，然后通过实验的方式部署文件共享服务来深入了解 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务中相关参数的作用，并在实验最后分别使用 </span> 
   <span style="color:#000000;">Windows 系统和Linux </span> 
   <span style="color:#000000;">系统访问共享的文件资源</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">配置网络文件系统（</span> 
   <span style="color:#000000;">Network File System</span> 
   <span style="color:#000000;">，</span> 
   <span style="color:#000000;">NFS</span> 
   <span style="color:#000000;">）服务来简化 </span> 
   <span style="color:#000000;">Linux 系统之间的文件共享工作，以及通过部署 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">服务在多台 </span> 
   <span style="color:#000000;">Linux 系统之间挂载并使用资源。在管理设备挂载信息时，使用 </span> 
   <span style="color:#000000;">autofs 服务不仅可以正常满足设备挂载的使用需求，还能进一步提高服务器硬件资源和网络带宽的利用率。</span> 
  </div> 
 </div> 
 <h3>1.Samba文件共享服务</h3> 
 <div> 
  <span style="color:#000000;">1987 </span> 
  <span style="color:#000000;">年，微软公司和英特尔公司共同制定了 </span> 
  <span style="color:#000000;">SMB</span> 
  <span style="color:#000000;">（Server Messages Block，服务器消息块）协议，旨在解决局域网内的文件或打印机等资源的共享问题，这也使得在多个主机之间共享文件变得越来越简单。到了 </span> 
  <span style="color:#000000;">1991 </span> 
  <span style="color:#000000;">年，当时还在读大学的 </span> 
  <span style="color:#000000;">Tridgwell </span> 
  <span style="color:#000000;">为了解决 </span> 
  <span style="color:#000000;">Linux 系统与 </span> 
  <span style="color:#000000;">Windows </span> 
  <span style="color:#000000;">系统之间的文件共享问题，基于 </span> 
  <span style="color:#000000;">SMB </span> 
  <span style="color:#000000;">协议开发出了 </span> 
  <span style="color:#000000;">SMBServer 服务程序。这是一款开源的文件共享软件，经过简单配置就能够实现 </span> 
  <span style="color:#000000;">Linux </span> 
  <span style="color:#000000;">系统与 </span> 
  <span style="color:#000000;">Windows 系统之间的文件共享工作。当时，</span> 
  <span style="color:#000000;">Tridgwell </span> 
  <span style="color:#000000;">想把这款软件的名字 </span> 
  <span style="color:#000000;">SMBServer 注册成为商标，但却被商标局以“</span> 
  <span style="color:#000000;">SMB </span> 
  <span style="color:#000000;">是没有意义的字符”为由而拒绝了申请。后来 </span> 
  <span style="color:#000000;">Tridgwell 不断翻看词典，突然看到一个拉丁舞蹈的名字</span> 
  <span style="color:#000000;">—</span> 
  <span style="color:#000000;">Samba</span> 
  <span style="color:#000000;">，而且这个热情洋溢的舞蹈名字中又恰好包含了“</span> 
  <span style="color:#000000;">SMB”，于是</span>Samba 服务程序的名字由此诞生。Samba 服务程序现在已经成为在 Linux 系统与Windows 系统之间共享文件的最佳选择。 
 </div> 
 <div> 
  <img alt="" height="90" src="https://images2.imgbox.com/67/84/L37Q2TD9_o.png" width="188"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">Samba 服务程序的配置方法与之前讲解的很多服务的配置方法类似，首先需要先通过软件仓库来安装 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序（</span> 
   <span style="color:#000000;">Samba 服务程序的名字也恰巧是软件包的名字）。顺带再安装一个 </span> 
   <span style="color:#000000;">samba-client </span> 
   <span style="color:#000000;">软件包，这是一会儿用于测试共享目录的客户端程序： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="184" src="https://images2.imgbox.com/a5/2c/xn612TLJ_o.png" width="882"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">安装完毕后打开 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的主配置文件，只有 </span> 
   <span style="color:#000000;">37 </span> 
   <span style="color:#000000;">行。其中第 </span> 
   <span style="color:#000000;">17～ 22 行代表共享每位登录用户的家目录内容。虽然在某些情况下这可以更方便地共享文件，但这个默认操作着实有些危险，建议不要共享，将其删除掉。第 </span> 
   <span style="color:#000000;">24</span> 
   <span style="color:#000000;">～</span> 
   <span style="color:#000000;">29 </span> 
   <span style="color:#000000;">行是用 SMB 协议共享本地的打印机设备，方便局域网内的用户远程使用打印机设备。当前我们没有打印机设备，因此建议也将其删除掉，不共享。最后的第 </span> 
   <span style="color:#000000;">31</span> 
   <span style="color:#000000;">～</span> 
   <span style="color:#000000;">37 </span> 
   <span style="color:#000000;">行依然为共享打印机设备的参数，同样建议予以删除。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="266" src="https://images2.imgbox.com/b1/14/ETYb7BSS_o.png" width="796"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">。所剩不多的参数中，还能继续删除不需要的参数。例如，第 </span> 
   <span style="color:#000000;">5</span> 
   <span style="color:#000000;">～</span> 
   <span style="color:#000000;">8 </span> 
   <span style="color:#000000;">行参数中所提到的 cups的全称为 </span> 
   <span style="color:#000000;">Common UNIX Printing System</span> 
   <span style="color:#000000;">（通用 </span> 
   <span style="color:#000000;">UNIX 打印系统），依然是用于打印机或打印服务器的，继续予以删除。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序中的参数以及作用</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="656" src="https://images2.imgbox.com/26/8c/hbLb6pNa_o.png" width="450"> 
 </div> 
 <div> 
  <img alt="" height="57" src="https://images2.imgbox.com/cc/f6/hN3W972o_o.png" width="450"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">security </span> 
   <span style="color:#000000;">参数代表用户登录 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务时采用的验证方式。总共有 4种可用参数。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;"><strong>share</strong></span> 
   <span style="color:#000000;">：代表主机无须验证密码。这相当于 </span> 
   <span style="color:#000000;">vsftpd 服务的匿名公开访问模式，比较方便，但安全性很差。 </span> 
  </div> 
  <div> 
   <span style="color:#000000;"><strong>user</strong></span> 
   <span style="color:#000000;">：代表登录 </span> 
   <span style="color:#000000;">Samba 服务时需要使用账号密码进行验证，通过后才能获取到文件。这是默认的验证方式，最为常用。 </span> 
  </div> 
  <div> 
   <span style="color:#000000;"><strong>domain</strong></span> 
   <span style="color:#000000;">：代表通过域控制器进行身份验证，用来限制用户的来源域。 </span> 
  </div> 
  <div> 
   <span style="color:#000000;"><strong>server</strong>：代表使用独立主机验证来访用户提供的密码。这相当于集中管理账号，并不常用。 </span> 
  </div> 
 </div> 
 <h4>1.配置共享资源</h4> 
 <div> 
  <div> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的主配置文件与Apache 服务很相似，包括全局配置参数和区域配置参数。全局配置参数用于设置整体的资源共享环境，对里面的每一个独立的共享资源都有效。区域配置参数则用于设置单独的共享资源，且仅对该资源有效。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">用于设置 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的参数以及作用 ：</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="184" src="https://images2.imgbox.com/3b/d5/d4kujzom_o.png" width="677"> 
 </div> 
 <div> 
  <strong>第一步：</strong>创建用于访问共享资源的账户信息。在 RHEL 8 系统中，Samba 服务程序默认使用的是用户密码认证模式（user）。这种认证模式可以确保仅让有密码且受信任的用户访问共享资源，而且认证过程也十分简单。不过，只有建立账户信息数据库之后，才能使用用户密码认证模式。另外，Samba 服务程序的数据库要求账户必须在当前系统中已经存在，否则日后创建文件时将导致文件的权限属性混乱不堪，由此引发错误。 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">pdbedit </span> 
   <span style="color:#000000;">命令用于管理 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的账户信息数据库，格式为“</span> 
   <span style="color:#000000;">pdbedit [</span> 
   <span style="color:#000000;">选项] 账户”。在第一次把账户信息写入到数据库时需要使用</span> 
   <span style="color:#000000;">-a 参数，以后在执行修改密码、删除账户等操作时就不再需要该参数了。</span> 
  </div> 
  <div> 
   <span style="color:#000000;">pdbedit </span> 
   <span style="color:#000000;">命令中使用的参数以及作用</span> 
  </div> 
  <div> 
   <img alt="" height="133" src="https://images2.imgbox.com/0e/fb/DDNub0bq_o.png" width="674"> 
  </div> 
  <div> 
   <img alt="" height="236" src="https://images2.imgbox.com/45/ed/HGfOmyUE_o.png" width="752"> 
  </div> 
 </div> 
 <div> 
  <strong>第二步：</strong>创建用于共享资源的文件目录。在创建时，不仅要考虑到文件读写权限的问题，而且由于/home 目录是系统中普通用户的家目录，因此还需要考虑应用于该目录的 SELinux 安全上下文所带来的限制。在 Samba 的帮助手册中显示，正确的文件上下文值应该是 samba_share_t，所以只需要修改完毕后执行restorecon 命令，就能让应用于目录的新SELinux 安全上下文立即生效。 
 </div> 
 <div> 
  <img alt="" height="115" src="https://images2.imgbox.com/43/35/IAVkEUVX_o.png" width="888"> 
 </div> 
 <div> 
  <strong>第三步：</strong>设置 SELinux 服务与策略，使其允许通过 Samba 服务程序访问普通用户家目录。执行 getsebool 命令，筛选出所有与 Samba 服务程序相关的 SELinux 域策略，根据策略的名称（和经验）选择出正确的策略条目进行开启即可： 
 </div> 
 <div> 
  <img alt="" height="295" src="https://images2.imgbox.com/a8/8e/PYGBabls_o.png" width="853"> 
 </div> 
 <div> 
  <strong>第四步：</strong> 
  <span style="color:#000000;">在 </span> 
  <span style="color:#000000;">Samba </span> 
  <span style="color:#000000;">服务程序的主配置文件中，根据</span> 
  <span style="color:#000000;">所提到的格式写入共享信息。 </span> 
 </div> 
 <div> 
  <img alt="" height="286" src="https://images2.imgbox.com/93/35/tuAWcDO6_o.png" width="766"> 
 </div> 
 <div> 
  <strong>第五步：</strong>Samba 服务程序的配置工作基本完毕。Samba 服务程序在 Linux 系统中的名字为smb，所以重启 smb 服务并加入到启动项中，保证在重启服务器后依然能够为用户持续提供服务。 
 </div> 
 <div> 
  <img alt="" height="81" src="https://images2.imgbox.com/b8/17/NOAuLVYl_o.png" width="887"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">为了避免防火墙限制用户访问，这里将 </span> 
   <span style="color:#000000;">iptables </span> 
   <span style="color:#000000;">防火墙清空，再把 </span> 
   <span style="color:#000000;">Samba 服务添加到firewalld </span> 
   <span style="color:#000000;">防火墙中，确保万无一失。 </span> 
  </div> 
  <div> 
   <img alt="" height="42" src="https://images2.imgbox.com/78/be/X59Qrjiu_o.png" width="732"> 
  </div> 
  <div> 
   <img alt="" height="40" src="https://images2.imgbox.com/eb/56/JZqH7vtn_o.png" width="825"> 
  </div> 
  <div> 
   <img alt="" height="44" src="https://images2.imgbox.com/f6/78/mbelqeV3_o.png" width="780"> 
  </div> 
 </div> 
 <div> 
  <strong>第六步：</strong>可以使用“systemctl status smb”命令查看服务器是否启动了 Samba 服务。如果想进一步查看 Samba 服务都共享了哪些目录，则可以使用 smbclient 命令来查看共享详情；-U参数指定了用户名称（用哪位用户挂载了 Samba 服务，就用哪位用户的身份进行查看）；-L参数列出了共享清单。 
 </div> 
 <div> 
  <img alt="" height="313" src="https://images2.imgbox.com/4b/ad/fdmgIgnx_o.png" width="833"> 
 </div> 
 <h4>2.Windows挂载共享</h4> 
 <div> 
  <div> 
   <span style="color:#000000;">无论 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">共享服务是部署 </span> 
   <span style="color:#000000;">Windows </span> 
   <span style="color:#000000;">系统上还是部署在 </span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">系统上，通过 Windows系统进行访问时，其步骤和方法都是一样的。下面假设 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">共享服务部署在 </span> 
   <span style="color:#000000;">Linux 系统上，并通过 </span> 
   <span style="color:#000000;">Windows </span> 
   <span style="color:#000000;">系统来访问 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">要在 </span> 
   <span style="color:#000000;">Windows </span> 
   <span style="color:#000000;">系统中访问共享资源，只需要单击 </span> 
   <span style="color:#000000;">Windows 系统的“开始”按钮后输入两个反斜杠，然后再添加服务器的 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址即可</span> 
  </div> 
  <div>
    需要在虚拟机上设置NAT模式 
  </div> 
  <div> 
   <img alt="" height="275" src="https://images2.imgbox.com/df/44/dsyXgQhS_o.png" width="399"> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="302" src="https://images2.imgbox.com/dd/fe/VOziNf9H_o.png" width="414"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">现在应该就能看到 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">共享服务的登录界面了。刘遄老师在这里先使用 </span> 
   <span style="color:#000000;">linuxprobe 账户的系统本地密码尝试登录，结果出现了</span> 
   <span style="color:#000000;">报错信息。由此可以验证，在 RHEL8 </span> 
   <span style="color:#000000;">系统中，</span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序使用的是独立的账户信息数据库。所以，即便在 </span> 
   <span style="color:#000000;">Linux 系统中有一个 </span> 
   <span style="color:#000000;">linuxprobe </span> 
   <span style="color:#000000;">账户，</span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序使用的账户信息数据库中也有一个同名的 </span> 
   <span style="color:#000000;">linuxprobe 账户，大家一定要弄清楚它们各自所对应的密码，它们仅仅是名称相同而已。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在正确输入 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务数据库中的 </span> 
   <span style="color:#000000;">linuxprobe </span> 
   <span style="color:#000000;">账户名以及使用 </span> 
   <span style="color:#000000;">pdbedit 命令设置的密码后，就可以登录到 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的共享界面中了，如图 </span> 
   <span style="color:#000000;">12-4 所示。此时，可以尝试执行查看、写入、更名、删除文件等操作。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="397" src="https://images2.imgbox.com/f9/3d/p15nynf5_o.png" width="1077"> 
 </div> 
 <h4>3.Linux挂载共享</h4> 
 <div> 
  <div> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序还可以实现 </span> 
   <span style="color:#000000;">Linux 系统之间的文件共享。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在客户端安装支持文件共享服务的软件包（</span> 
   <span style="color:#000000;">cifs-utils</span> 
   <span style="color:#000000;">）。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="188" src="https://images2.imgbox.com/48/f7/8GTS4eWr_o.png" width="710"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">安装好软件包后，在 </span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">客户端创建一个用于挂载 </span> 
   <span style="color:#000000;">Samba 服务共享资源的目录。这个目录可以与服务器上的共享名称同名，以便于日后查找。</span> 
   <span style="color:#000000;">mount </span> 
   <span style="color:#000000;">命令中的</span> 
   <span style="color:#000000;">-t 参数用于指定协议类型，</span> 
   <span style="color:#000000;">-o </span> 
   <span style="color:#000000;">参数用于指定用户名和密码，最后追加上服务器 </span> 
   <span style="color:#000000;">IP 地址、共享名称和本地挂载目录即可。服务器 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址后面的共享名称指的是配置文件中</span> 
   <span style="color:#000000;">[database]的值，而不是服务器本地挂载的目录名称。虽然这两个值可能一样，但大家应该认出它们的区别。 </span> 
  </div> 
  <div> 
   <img alt="" height="28" src="https://images2.imgbox.com/1d/a6/AZzRq6fW_o.png" width="580"> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="266" src="https://images2.imgbox.com/c4/f3/F6uRe8YN_o.png" width="959"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">如果在每次重启电脑后都需要使用 </span> 
   <span style="color:#000000;">mount 命令手动挂载远程共享目录，是不是觉得很麻烦呢？其实可以按照 </span> 
   <span style="color:#000000;">Samba 服务的用户名、密码、共享域的顺序将相关信息写入一个认证文件中，然后让</span> 
   <span style="color:#000000;">/etc/fstab 文件和系统自动加载它。为了保证不被其他人随意看到，最后把这个认证文件的权限修改为仅 </span> 
   <span style="color:#000000;">root </span> 
   <span style="color:#000000;">管理员才能够读写： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="159" src="https://images2.imgbox.com/18/99/ucQttlTD_o.png" width="786"> 
 </div> 
 <div> 
  <img alt="" height="41" src="https://images2.imgbox.com/a4/38/VkoSYAPm_o.png" width="751"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">将挂载信息写入</span> 
   <span style="color:#000000;">/etc/fstab </span> 
   <span style="color:#000000;">文件中，以确保共享挂载信息在服务器重启后依然生效： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="107" src="https://images2.imgbox.com/a2/ba/ev8frZXd_o.png" width="905"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">客户端成功地挂载了 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务的共享资源。进入到挂载目录</span> 
   <span style="color:#000000;">/database 后就可以看到 </span> 
   <span style="color:#000000;">Windows </span> 
   <span style="color:#000000;">系统访问 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序时留下来的文件了（即文件 </span> 
   <span style="color:#000000;">Memo.txt）。当然，也可以对该文件进行读写操作并保存。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="49" src="https://images2.imgbox.com/66/6f/c9phJwhI_o.png" width="792"> 
 </div> 
 <h3>2.NFS（网络文件系统）</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">如果大家觉得 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务程序的配置太麻烦，而且恰巧需要共享文件的主机都是 Linux系统，此时非常推荐大家在客户端部署 </span> 
   <span style="color:#000000;">NFS</span> 
   <span style="color:#000000;">（网络文件系统）服务来共享文件。</span> 
   <span style="color:#000000;">NFS 服务可以将远程 </span> 
   <span style="color:#000000;">Linux 系统上的文件共享资源挂载到本地主机的目录上，从而使得本地主机（</span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">客户端）基于 </span> 
   <span style="color:#000000;">TCP/IP </span> 
   <span style="color:#000000;">协议，像使用本地主机上的资源那样读写远程 </span> 
   <span style="color:#000000;">Linux 系统上的共享文件。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">由于 </span> 
   <span style="color:#000000;">RHEL 8 </span> 
   <span style="color:#000000;">系统中默认已经安装了 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">服务，外加 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">服务的配置步骤也很简单，</span> 
   <span style="color:#000000;">首先请使用软件仓库检查自己的 </span> 
   <span style="color:#000000;">RHEL 8 </span> 
   <span style="color:#000000;">系统中是否已经安装了 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">软件包： </span> 
  </div> 
  <div> 
   <img alt="" height="128" src="https://images2.imgbox.com/6c/7d/V2cnVXsU_o.png" width="1013"> 
  </div> 
  <div> 
   <strong>第一步：</strong>为了检验 NFS 服务配置的效果，我们需要使用两台 Linux 主机（一台充当 NFS服务器，一台充当 NFS 客户端）， 
  </div> 
  <div> 
   <div> 
    <span style="color:#000000;">配置好防火墙，以免默认的防火墙策略禁止正常的 </span> 
    <span style="color:#000000;">NFS </span> 
    <span style="color:#000000;">共享服务。 </span> 
   </div> 
   <div> 
    <img alt="" height="41" src="https://images2.imgbox.com/b4/8e/w4ujkiLu_o.png" width="853"> 
   </div> 
   <div> 
    <img alt="" height="152" src="https://images2.imgbox.com/24/ad/aEc6Csm1_o.png" width="999"> 
   </div> 
  </div> 
  <div> 
   <strong>第二步：</strong>在 NFS 服务器上建立用于 NFS 文件共享的目录，并设置足够的权限确保其他人也有写入权限。 
  </div> 
  <div> 
   <img alt="" height="57" src="https://images2.imgbox.com/63/d3/pinVva1n_o.png" width="910"> 
  </div> 
  <div> 
   <strong>第三步：</strong>NFS 服务程序的配置文件为/etc/exports，默认情况下里面没有任何内容。我们可以按照“共享目录的路径 允许访问的 NFS 客户端（共享权限参数）”的格式，定义要共享的目录与相应的权限。 
  </div> 
  <div> 
   <div> 
    <span style="color:#000000;">如果想要把</span> 
    <span style="color:#000000;">/nfsfile </span> 
    <span style="color:#000000;">目录共享给 </span> 
    <span style="color:#000000;">192.168.10.0/24 网段内的所有主机，让这些主机都拥有读写权限，在将数据写入到 </span> 
    <span style="color:#000000;">NFS 服务器的硬盘中后才会结束操作，最大限度保证数据不丢失，以及把来访客户端 </span> 
    <span style="color:#000000;">root 管理员映射为本地的匿名用户等，则可以按照下面命令中的格式，将表 </span> 
    <span style="color:#000000;">12-7 </span> 
    <span style="color:#000000;">中的参数写到 </span> 
    <span style="color:#000000;">NFS </span> 
    <span style="color:#000000;">服务程序的配置文件中。</span> 
   </div> 
  </div> 
  <div> 
   <img alt="" height="238" src="https://images2.imgbox.com/16/59/4FVpvI2K_o.png" width="676"> 
  </div> 
  <div> 
   <img alt="" height="28" src="https://images2.imgbox.com/3d/da/GCfNf94S_o.png" width="734"> 
  </div> 
  <div> 
   <img alt="" height="155" src="https://images2.imgbox.com/03/5d/f3uhhJXS_o.png" width="921"> 
  </div> 
  <div> 
   <strong>第四步：</strong>启动和启用 NFS 服务程序。由于在使用 NFS 服务进行文件共享之前，需要使用 RPC（Remote Procedure Call，远程过程调用）服务将 NFS 服务器的 IP 地址和端口号等信息发送给客户端。因此，在启动 NFS 服务之前，还需要顺带重启并启用 rpcbind 服务程序，并将这两个服务一并加入开机启动项中。 
  </div> 
  <div> 
   <img alt="" height="117" src="https://images2.imgbox.com/4f/00/tgbP6msm_o.png" width="1040"> 
  </div> 
  <div>
    使用 showmount 命令查询 NFS 服务器的远程共享信息，其输出格式为“共享的目录名称 允许使用客户端地址”。 
  </div> 
 </div> 
 <div> 
  <img alt="" height="110" src="https://images2.imgbox.com/d2/59/lSZU1IUv_o.png" width="679"> 
 </div> 
 <div> 
  <img alt="" height="61" src="https://images2.imgbox.com/28/71/vtfWknCx_o.png" width="690"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">然后在 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">客户端创建一个挂载目录。使用 </span> 
   <span style="color:#000000;">mount </span> 
   <span style="color:#000000;">命令并结合</span> 
   <span style="color:#000000;">-t 参数，指定要挂载的文件系统的类型，并在命令后面写上服务器的 </span> 
   <span style="color:#000000;">IP 地址、服务器上的共享目录以及要挂载到本地系统（即客户端）的目录。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="278" src="https://images2.imgbox.com/2b/b4/VUtnxyM2_o.png" width="887"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">挂载成功后就应该能够顺利地看到在执行前面的操作时写入的文件内容了。如果希望 </span> 
  </div> 
  <div> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">文件共享服务能一直有效，则需要将其写入到 </span> 
   <span style="color:#000000;">fstab </span> 
   <span style="color:#000000;">文件中：</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="48" src="https://images2.imgbox.com/26/d5/19P0mVdF_o.png" width="720"> 
 </div> 
 <div> 
  <img alt="" height="126" src="https://images2.imgbox.com/17/a5/vSY7RlNa_o.png" width="870"> 
 </div> 
 <h3>3.autofs自动挂载服务</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">无论是 </span> 
   <span style="color:#000000;">Samba </span> 
   <span style="color:#000000;">服务还是 </span> 
   <span style="color:#000000;">NFS 服务，都要把挂载信息写入到/etc/fstab 中，这样远程共享资源就会自动随服务器开机而进行挂载。虽然这很方便，但是如果挂载的远程资源太多，则会给网络带宽和服务器的硬件资源带来很大负载。如果在资源挂载后长期不使用，也会造成服务器硬件资源的浪费。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">autofs </span> 
   <span style="color:#000000;">自动挂载服务可以帮我们解决这一问题。与 </span> 
   <span style="color:#000000;">mount </span> 
   <span style="color:#000000;">命令不同，</span> 
   <span style="color:#000000;">autofs 服务程序是一种 </span> 
   <span style="color:#000000;">Linux 系统守护进程，当检测到用户试图访问一个尚未挂载的文件系统时，将自动挂载该文件系统。换句话说，将挂载信息填入</span> 
   <span style="color:#000000;">/etc/fstab 文件后，系统在每次开机时都自动将其挂载，而 </span> 
   <span style="color:#000000;">autofs 服务程序则是在用户需要使用该文件系统时才去动态挂载，从而节约了网络资源和服务器的硬件资源。 </span> 
  </div> 
  <div> 
   <span style="color:#000000;">首先需要自行安装 </span> 
   <span style="color:#000000;">autofs </span> 
   <span style="color:#000000;">服务程序： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="227" src="https://images2.imgbox.com/10/50/P4xe1Juj_o.png" width="889"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在autofs服务程序的主配置文件中需要按照“挂载目录子配置文件”的格式进行填写。挂载目录是设备挂载位置的上一级目录。例如，光盘设备一般挂载到</span> 
   <span style="color:#000000;">/media/cdrom</span> 
   <span style="color:#000000;">目录中，那么挂载目录写成/media即可。对应的子配置文件则是对这个挂载目录内的挂载设备信息作进一步的说明。子配置文件需要用户自行定义，文件名字没有严格要求，但后缀建议以</span> 
   <span style="color:#000000;">.misc</span> 
   <span style="color:#000000;">结束。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="21" src="https://images2.imgbox.com/04/20/81JX5Rjz_o.png" width="765"> 
 </div> 
 <div> 
  <img alt="" height="120" src="https://images2.imgbox.com/0e/e9/50jpC9OY_o.png" width="741"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在子配置文件中，应按照“挂载目录挂载文件类型及权限</span> 
   <span style="color:#000000;">:设备名称”的格式进行填写。例如，要把光盘设备挂载到</span> 
   <span style="color:#000000;">/media/iso</span> 
   <span style="color:#000000;">目录中，可将挂载目录写为</span> 
   <span style="color:#000000;">iso</span> 
   <span style="color:#000000;">，而</span> 
   <span style="color:#000000;">-fstype为文件系统格式参数，</span> 
   <span style="color:#000000;">iso9660</span> 
   <span style="color:#000000;">为光盘设备格式，</span> 
   <span style="color:#000000;">ro</span> 
   <span style="color:#000000;">、</span> 
   <span style="color:#000000;">nosuid</span> 
   <span style="color:#000000;">及</span> 
   <span style="color:#000000;">nodev</span> 
   <span style="color:#000000;">为光盘设备具体的权限参数，/dev/cdrom则是定义要挂载的设备名称。配置完成后再顺手将</span> 
   <span style="color:#000000;">autofs</span> 
   <span style="color:#000000;">服务程序启动并加入到系统启动项中：</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="32" src="https://images2.imgbox.com/37/c6/sUCRUKTL_o.png" width="697"> 
 </div> 
 <div> 
  <img alt="" height="106" src="https://images2.imgbox.com/ae/ee/4KJeSkKB_o.png" width="762"> 
 </div> 
 <div> 
  <img alt="" height="82" src="https://images2.imgbox.com/2d/ae/VLUOhlBS_o.png" width="908"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">先查看当前的光盘设备挂载情况，确认光盘设备没有被挂载上，而且</span> 
   <span style="color:#000000;">/media </span> 
   <span style="color:#000000;">目录中根本就没有 </span> 
   <span style="color:#000000;">iso </span> 
   <span style="color:#000000;">子目录： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="25" src="https://images2.imgbox.com/38/5c/bCfA96yZ_o.png" width="514"> 
 </div> 
 <div> 
  <img alt="" height="189" src="https://images2.imgbox.com/ba/8a/SrZmYmjm_o.png" width="728"> 
 </div> 
 <div> 
  <img alt="" height="36" src="https://images2.imgbox.com/36/d8/A8z3gf0C_o.png" width="671"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">我们却可以使用 </span> 
   <span style="color:#000000;">cd </span> 
   <span style="color:#000000;">命令切换到这个 </span> 
   <span style="color:#000000;">iso 子目录中，而且光盘设备会被立即自动挂载上，然后也就能顺利查看光盘内的内容了。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="221" src="https://images2.imgbox.com/7c/9c/wbTJer90_o.png" width="744"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">首先把 </span> 
   <span style="color:#000000;">NFS </span> 
   <span style="color:#000000;">共享目录卸载掉。在 </span> 
   <span style="color:#000000;">autofs </span> 
   <span style="color:#000000;">服务程序的主配置文件中会有一个“/misc/etc/auto.misc</span> 
   <span style="color:#000000;">”参数，这个 </span> 
   <span style="color:#000000;">auto.misc 相当于自动挂载的参考文件，它默认就已经存在，所以这里不需要进行任何操作： </span> 
  </div> 
 </div> 
 <h2>十二、使用BIND提供域名解析服务</h2> 
 <div> 
  <div> 
   <span style="color:#000000;">DNS 域名解析服务的原理以及作用，介绍了域名查询功能中正向解析与反向解析的作用，并通过实验的方式演示了如何在 </span> 
   <span style="color:#000000;">DNS 主服务器上部署正、反解析工作模式，以便让大家深刻体会到 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">域名查询的便利以及强大。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">如何部署</span> 
   <span style="color:#000000;">DNS</span> 
   <span style="color:#000000;">从服务器以及</span> 
   <span style="color:#000000;">DNS 缓存服务器来提升用户的域名查询体验，以及如何使用 </span> 
   <span style="color:#000000;">chroot </span> 
   <span style="color:#000000;">牢笼机制插件来保障 </span> 
   <span style="color:#000000;">bind 服务程序的可靠性，并向大家演示如何在主服务器与从服务器之间部署 </span> 
   <span style="color:#000000;">TSIG 密钥加密功能，来进一步保障迭代查询中数据的安全性。最后，本章还从实战层面讲解了 </span> 
   <span style="color:#000000;">DNS 分离解析技术，让来自不同国家、不同地区的用户都能获得最优的网站访问体验。 </span> 
  </div> 
 </div> 
 <h3>1.DNS域名解析服务</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">为了降低用户访问网络资源的门槛，域名系统（</span> 
   <span style="color:#000000;">Domain Name System</span> 
   <span style="color:#000000;">，</span> 
   <span style="color:#000000;">DNS）技术应运而生。这是一项用于管理和解析域名与 </span> 
   <span style="color:#000000;">IP 地址对应关系的技术。简单来说，就是能够接受用户输入的域名或 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址，然后自动查找与之匹配（或者说具有映射关系）的 </span> 
   <span style="color:#000000;">IP 地址或域名，即将域名解析为 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址（正向解析），或将 IP 地址解析为域名（反向解析）。这样一来，只需要在浏览器中输入域名就能打开想要访问的网站了。DNS 域名解析技术的正向解析也是我们最常使用的一种工作模式。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">鉴于互联网中的域名和 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址对应关系数据库太过庞大，</span> 
   <span style="color:#000000;">DNS 域名解析服务采用了类似目录树的层次结构来记录域名与 </span> 
   <span style="color:#000000;">IP 地址之间的对应关系，从而形成了一个分布式的数据库系统，</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="280" src="https://images2.imgbox.com/e9/bb/UhLtUFPa_o.png" width="591"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">域名后缀一般分为国际域名和国内域名。原则上来讲，域名后缀都有严格的定义，但在实际使用时可以不必严格遵守。目前最常见的域名后缀有</span> 
   <span style="color:#000000;">.com</span> 
   <span style="color:#000000;">（商业组织）、</span> 
   <span style="color:#000000;">.org（非营利组织）、</span> 
   <span style="color:#000000;">.gov</span> 
   <span style="color:#000000;">（政府部门）、</span> 
   <span style="color:#000000;">.net</span> 
   <span style="color:#000000;">（网络服务商）、</span> 
   <span style="color:#000000;">.edu</span> 
   <span style="color:#000000;">（教育机构）、</span> 
   <span style="color:#000000;">.pub</span> 
   <span style="color:#000000;">（公共大众）、</span> 
   <span style="color:#000000;">.cn（中国国家顶级域名）等。</span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">DNS 技术作为互联网基础设施中重要的一环，为了为网民提供不间断、稳定且快速的域名查询服务，保证互联网的正常运转，提供了下面 </span> 
   <span style="color:#000000;">3 </span> 
   <span style="color:#000000;">种类型的服务器。 </span> 
  </div> 
 </div> 
 <div> 
  <strong>主服务器：</strong>在特定区域内具有唯一性，负责维护该区域内的域名与 IP 地址之间的对应关系。 
 </div> 
 <div> 
  <strong>从服务器：</strong>从主服务器中获得域名与 IP 地址的对应关系并进行维护，以防主服务器宕机等情况。 
 </div> 
 <div> 
  <strong>缓存服务器：</strong>通过向其他域名解析服务器查询获得域名与 IP 地址的对应关系，并将经常查询的域名信息保存到服务器本地，以此来提高重复查询时的效率。 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">简单来说，主服务器是用于管理域名和 IP 地址对应关系的真正服务器，从服务器帮助主服务器“打下手”，分散部署在各个国家、省市或地区，以便让用户就近查询域名，从而减轻主服务器的负载压力。缓存服务器不太常用，一般部署在企业内网的网关位置，用于加速用户的域名查询请求。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">DNS 域名解析服务采用分布式的数据结构来存放海量的“区域数据”信息，在执行用户发起的域名查询请求时，具有递归查询和迭代查询两种方式。所谓递归查询，是指 </span> 
   <span style="color:#000000;">DNS 服务器在收到用户发起的请求时，必须向用户返回一个准确的查询结果。如果 DNS 服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务器，并将返回的查询结果提交给用户。而迭代查询则是指，</span> 
   <span style="color:#000000;">DNS 服务器在收到用户发起的请求时，并不直接回复查询结果，而是告诉另一台DNS </span> 
   <span style="color:#000000;">服务器的地址，用户再向这台 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">服务器提交请求，这样依次反复，直到返回查询结果。 </span> 
  </div> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">当用户向就近的一台 </span> 
   <span style="color:#000000;">DNS 服务器发起对某个域名的查询请求之后（这里以www.linuxprobe.com </span> 
   <span style="color:#000000;">为例）</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="287" src="https://images2.imgbox.com/b9/73/Tn9XEcqC_o.png" width="656"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">当用户向网络指定的 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">服务器发起一个域名请求时，通常情况下会有本地 </span> 
   <span style="color:#000000;">DNS 服务器向上级的 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">服务器发送迭代查询请求；如果该 </span> 
   <span style="color:#000000;">DNS 服务器没有要查询的信息，则会进一步向上级 </span> 
   <span style="color:#000000;">DNS 服务器发送迭代查询请求，直到获得准确的查询结果为止。其中最高级、最权威的根 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">服务器总共有 </span> 
   <span style="color:#000000;">13 台，分布在世界各地，其管理单位、具体的地理位置，以及IP </span> 
   <span style="color:#000000;">地址</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="463" src="https://images2.imgbox.com/45/c9/kW9vjTRj_o.png" width="847"> 
 </div> 
 <h3>2.安装bind服务程序</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">BIND</span> 
   <span style="color:#000000;">（</span> 
   <span style="color:#000000;">Berkeley Internet Name Domain，伯克利因特网名称域）服务是全球范围内使用最广泛、最安全可靠且高效的域名解析服务程序。</span> 
   <span style="color:#000000;">DNS 域名解析服务作为互联网基础设施服务，其责任之重可想而知，因此建议大家在生产环境中安装部署 </span> 
   <span style="color:#000000;">bind </span> 
   <span style="color:#000000;">服务程序时加上 </span> 
   <span style="color:#000000;">chroot（俗称牢笼机制）扩展包，以便有效地限制 </span> 
   <span style="color:#000000;">bind 服务程序仅能对自身的配置文件进行操作，以确保整个服务器的安全。 </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="172" src="https://images2.imgbox.com/19/28/HBVuKUpt_o.png" width="866"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">bind </span> 
   <span style="color:#000000;">服务程序的配置并不简单，因为要想为用户提供健全的 </span> 
   <span style="color:#000000;">DNS 查询服务，要在本地保存相关的域名数据库，而如果把所有域名和 IP 地址的对应关系都写入到某个配置文件中，估计要有上千万条的参数，这样既不利于程序的执行效率，也不方便日后的修改和维护。因此在 </span> 
   <span style="color:#000000;">bind </span> 
   <span style="color:#000000;">服务程序中有下面这 </span> 
   <span style="color:#000000;">3 </span> 
   <span style="color:#000000;">个比较关键的文件。 </span> 
  </div> 
 </div> 
 <div> 
  <strong>主配置文件（/etc/named.conf）：</strong>只有 59 行，而且在去除注释信息和空行之后，实际有效的参数仅有 30 行左右，这些参数用来定义 bind 服务程序的运行。 
 </div> 
 <div> 
  <strong>区域配置文件（/etc/named.rfc1912.zones）:</strong>用来保存域名和 IP 地址对应关系的所在位置。类似于图书的目录，对应着每个域和相应 IP 地址所在的具体位置，当需要查看或修改时，可根据这个位置找到相关文件。 
 </div> 
 <div> 
  <strong>数据配置文件目录（/var/named）:</strong>该目录用来保存域名和 IP 地址真实对应关系的数据配置文件。 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在 </span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">系统中，</span> 
   <span style="color:#000000;">bind </span> 
   <span style="color:#000000;">服务程序的名称为 </span> 
   <span style="color:#000000;">named</span> 
   <span style="color:#000000;">。首先需要在</span> 
   <span style="color:#000000;">/etc 目录中找到该服务程序的主配置文件，然后把第 </span> 
   <span style="color:#000000;">11 </span> 
   <span style="color:#000000;">行和第 </span> 
   <span style="color:#000000;">19 </span> 
   <span style="color:#000000;">行的地址均修改为 </span> 
   <span style="color:#000000;">any</span> 
   <span style="color:#000000;">，分别表示服务器上的所有 IP地址均可提供 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">域名解析服务，以及允许所有人对本服务器发送 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">查询请求。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="27" src="https://images2.imgbox.com/8d/5b/S5X76aon_o.png" width="652"> 
 </div> 
 <div> 
  <img alt="" height="224" src="https://images2.imgbox.com/bc/39/jZYIPSKD_o.png" width="698"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">ind </span> 
   <span style="color:#000000;">服务程序的区域配置文件（</span> 
   <span style="color:#000000;">/etc/named.rfc1912.zones</span> 
   <span style="color:#000000;">）用来保存域名和 IP地址对应关系的所在位置。在这个文件中，定义了域名与 </span> 
   <span style="color:#000000;">IP 地址解析规则保存的文件位置以及服务类型等内容，而没有包含具体的域名、</span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址对应关系等信息。服务类型有 </span> 
   <span style="color:#000000;">3 种，分别为 </span> 
   <span style="color:#000000;">hint</span> 
   <span style="color:#000000;">（根区域）、</span> 
   <span style="color:#000000;">master</span> 
   <span style="color:#000000;">（主区域）、</span> 
   <span style="color:#000000;">slave</span> 
   <span style="color:#000000;">（辅助区域），其中常用的 </span> 
   <span style="color:#000000;">master </span> 
   <span style="color:#000000;">和 </span> 
   <span style="color:#000000;">slave 指的就是主服务器和从服务器。将域名解析为 </span> 
   <span style="color:#000000;">IP </span> 
   <span style="color:#000000;">地址的正向解析参数和将 </span> 
   <span style="color:#000000;">IP 地址解析为域名的反向解析参数</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="136" src="https://images2.imgbox.com/1c/4e/MrtX60Pu_o.png" width="631"> 
 </div> 
 <div> 
  <img alt="" height="129" src="https://images2.imgbox.com/d5/58/FSFCAuz3_o.png" width="591"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">下面的实验中会分别修改 </span> 
   <span style="color:#000000;">bind 服务程序的主配置文件、区域配置文件与数据配置文件。如果在实验中遇到了 </span> 
   <span style="color:#000000;">bind 服务程序启动失败的情况，而您认为这是由于参数写错而导致的，则可以执行 </span> 
   <span style="color:#000000;">named-checkconf </span> 
   <span style="color:#000000;">命令和 </span> 
   <span style="color:#000000;">named-checkzone 命令，分别检查主配置文件与数据配置文件中语法或参数的错误。 </span> 
  </div> 
 </div> 
 <h4>1.正向解析实验</h4> 
 <div> 
  <div> 
   <span style="color:#000000;">在 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">域名解析服务中，正向解析是指根据域名（主机名）查找到对应的 </span> 
   <span style="color:#000000;">IP 地址。也就是说，当用户输入了一个域名后，</span> 
   <span style="color:#000000;">bind </span> 
   <span style="color:#000000;">服务程序会自动进行查找，并将匹配到的 </span> 
   <span style="color:#000000;">IP 地址返给用户</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="55" src="https://images2.imgbox.com/e5/47/JRmTSKOp_o.png" width="456"> 
 </div> 
 <div> 
  <strong>第一步：</strong>编辑区域配置文件。该文件中默认已经有了一些无关紧要的解析参数，旨在让用户有一个参考。可以将下面的参数添加到区域配置文件的最下面。当然，也可以将该文件中的原有信息全部清空，而只保留自己的域名解析信息。 
 </div> 
 <div> 
  <img alt="" height="25" src="https://images2.imgbox.com/1a/0a/rWE4svUq_o.png" width="649"> 
 </div> 
 <div> 
  <img alt="" height="110" src="https://images2.imgbox.com/c4/a3/YJWqS2QB_o.png" width="831"> 
 </div> 
 <div> 
  <strong>第二步：</strong>编辑数据配置文件。可以从/var/named 目录中复制一份正向解析的模板文件（named.localhost），然后把域名和 IP 地址的对应数据填写数据配置文件中并保存。在复制时记得加上-a 参数，这可以保留原始文件的所有者、所属组、权限属性等信息，以便让 bind 服务程序顺利读取文件内容。 
 </div> 
 <div> 
  <img alt="" height="85" src="https://images2.imgbox.com/3a/8e/oHuKAQVG_o.png" width="845"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在保存并退出后文件后记得重启 named 服务程序，让新的解析数据生效。考虑到正向解析文件中的参数较多，而且相对都比较重要，刘遄老师在每个参数后面都作了简要的说明。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="226" src="https://images2.imgbox.com/e8/22/KfyiYXgU_o.png" width="863"> 
 </div> 
 <div> 
  <img alt="" height="34" src="https://images2.imgbox.com/22/7d/jLab58hh_o.png" width="732"> 
 </div> 
 <div> 
  <img alt="" height="73" src="https://images2.imgbox.com/cb/b0/2auuGXUK_o.png" width="931"> 
 </div> 
 <div> 
  <strong>第三步：</strong>检验解析结果。为了检验解析结果，一定要先把 Linux 系统网卡中的 DNS 地址参数修改成本机 IP 地址，这样就可以使用由本机提供的 DNS 查询服务了。nslookup命令用于检测能否从 DNS 服务器中查询到域名与 IP 地址的解析记录，进而更准确地检验 DNS服务器是否已经能够为用户提供服务。 
 </div> 
 <div> 
  <img alt="" height="293" src="https://images2.imgbox.com/9b/7b/8veZZOUi_o.png" width="776"> 
 </div> 
 <div> 
  <img alt="" height="131" src="https://images2.imgbox.com/93/db/854qM4SN_o.png" width="733"> 
 </div> 
 <h4>2.反向解析实验</h4> 
 <div> 
  <div> 
   <span style="color:#000000;">在 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">域名解析服务中，反向解析的作用是将用户提交的 </span> 
   <span style="color:#000000;">IP 地址解析为对应的域名信息，它一般用于对某个 </span> 
   <span style="color:#000000;">IP 地址上绑定的所有域名进行整体屏蔽，屏蔽由某些域名发送的垃圾邮件。它也可以针对某个 </span> 
   <span style="color:#000000;">IP 地址进行反向解析，大致判断出有多少个网站运行在上面。当购买虚拟主机时，可以使用这一功能验证虚拟主机提供商是否有严重的超售问题。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="54" src="https://images2.imgbox.com/62/19/nDrEu2vc_o.png" width="467"> 
 </div> 
 <div> 
  <strong>第一步：</strong>编辑区域配置文件。在编辑该文件时，除了不要写错格式之外，还需要记住此处定义的数据配置文件名称，因为一会儿还需要在/var/named 目录中建立与其对应的同名文件。反向解析是把 IP 地址解析成域名格式，因此在定义 zone（区域）时应该要把 IP 地址反写，比如原来是 192.168.10.0，反写后应该就是 10.168.192，而且只需写出 IP 地址的网络位即可。 
 </div> 
 <div> 
  <img alt="" height="24" src="https://images2.imgbox.com/f1/74/5z0axyFZ_o.png" width="891"> 
 </div> 
 <div> 
  <img alt="" height="201" src="https://images2.imgbox.com/fc/da/nqXZq4O1_o.png" width="638"> 
 </div> 
 <div> 
  <strong>第二步：</strong>编辑数据配置文件。首先从/var/named 目录中复制一份反向解析的模板文件（named.loopback），然后把下面的参数填写到文件中。其中，IP 地址仅需要写主机位 
 </div> 
 <div> 
  <img alt="" height="114" src="https://images2.imgbox.com/05/8d/XmmdHsiN_o.png" width="626"> 
 </div> 
 <div> 
  <img alt="" height="266" src="https://images2.imgbox.com/11/70/sroB9yGn_o.png" width="890"> 
 </div> 
 <div> 
  <img alt="" height="78" src="https://images2.imgbox.com/88/7a/YNbR9aYe_o.png" width="898"> 
 </div> 
 <div> 
  <strong>第三步：</strong>检验解析结果。在前面的正向解析实验中，已经把系统网卡中的 DNS 地址参数修改成了本机 IP 地址，因此可以直接使用 nslookup 命令来检验解析结果，仅需输入 IP 地址即可查询到对应的域名信息。 
 </div> 
 <div> 
  <img alt="" height="118" src="https://images2.imgbox.com/bc/7e/oJ2thqnP_o.png" width="849"> 
 </div> 
 <h3>3.部署从服务器</h3> 
 <div> 
  <div> 
   <span style="color:#000000;">作为重要的互联网基础设施服务，保证 </span> 
   <span style="color:#000000;">DNS 域名解析服务的正常运转至关重要，只有这样才能提供稳定、快速且不间断的域名查询服务。在 DNS 域名解析服务中，从服务器可以从主服务器上获取指定的区域数据文件，从而起到备份解析记录与负载均衡的作用。因此，通过部署从服务器不仅可以减轻主服务器的负载压力，还可以提升用户的查询效率。 </span> 
  </div> 
 </div> 
 <div>
   主服务器： 
 </div> 
 <div> 
  <img alt="" height="160" src="https://images2.imgbox.com/8e/55/fF2zFggt_o.png" width="436"> 
 </div> 
 <div>
   从服务器： 
 </div> 
 <div> 
  <img alt="" height="139" src="https://images2.imgbox.com/29/01/iTqpYAsi_o.png" width="444"> 
 </div> 
 <div> 
  <strong>第一步：</strong>在主服务器的区域配置文件中允许该从服务器的更新请求，即修改 allow-update{允许更新区域信息的主机地址;};参数，然后重启主服务器的 DNS 服务程序。 
 </div> 
 <div> 
  <img alt="" height="212" src="https://images2.imgbox.com/a2/1f/0ZQYycnC_o.png" width="838"> 
 </div> 
 <div> 
  <img alt="" height="45" src="https://images2.imgbox.com/08/ad/UJQOxPsk_o.png" width="759"> 
 </div> 
 <div> 
  <strong>第二步：</strong> 
  <span style="color:#000000;">在主服务器上配置防火墙放行规则，让 </span> 
  <span style="color:#000000;">DNS </span> 
  <span style="color:#000000;">协议流量可以被顺利传递。 </span> 
 </div> 
 <div> 
  <img alt="" height="41" src="https://images2.imgbox.com/29/99/Wa57xtl2_o.png" width="799"> 
 </div> 
 <div> 
  <img alt="" height="44" src="https://images2.imgbox.com/62/98/EkPzx9KG_o.png" width="803"> 
 </div> 
 <div> 
  <strong>第三步：</strong>在从服务器上安装 bind-chroot 软件包。修改配置文件，让从服务器也能够对外提供 DNS 服务，并且测试其与主服务器的网络连通性。 
 </div> 
 <div> 
  <img alt="" height="166" src="https://images2.imgbox.com/1a/52/jqBr0R6h_o.png" width="999"> 
 </div> 
 <div> 
  <img alt="" height="199" src="https://images2.imgbox.com/aa/1c/wKylbLUP_o.png" width="982"> 
 </div> 
 <div> 
  <img alt="" height="202" src="https://images2.imgbox.com/53/97/YRWGjIFL_o.png" width="1041"> 
 </div> 
 <div> 
  <strong>第四步：</strong>在从服务器中填写主服务器的 IP 地址与要抓取的区域信息，然后重启服务。注意此时的服务类型应该是 slave（从），而不再是 master（主）。masters 参数后面应该为主服务器的 IP 地址，而且 file 参数后面定义的是同步数据配置文件后要保存到的位置，稍后可以在该目录内看到同步的文件。 
 </div> 
 <div> 
  <img alt="" height="197" src="https://images2.imgbox.com/1f/5e/xxEj0Rdc_o.png" width="909"> 
 </div> 
 <div> 
  <img alt="" height="45" src="https://images2.imgbox.com/b6/18/oMu5x4x3_o.png" width="979"> 
 </div> 
 <div> 
  <strong>第五步：</strong> 
  <span style="color:#000000;">检验解析结果。当从服务器的 DNS 服务程序在重启后，一般就已经自动从主服务器上同步了数据配置文件，而且该文件默认会放置在区域配置文件中所定义的目录位置中。随后修改从服务器的网络参数，把 </span> 
  <span style="color:#000000;">DNS </span> 
  <span style="color:#000000;">地址参数修改成 </span> 
  <span style="color:#000000;">192.168.10.20，这样即可使用从服务器自身提供的 </span> 
  <span style="color:#000000;">DNS </span> 
  <span style="color:#000000;">域名解析服务。最后就可以使用 </span> 
  <span style="color:#000000;">nslookup </span> 
  <span style="color:#000000;">命令顺利看到解析结果了。 </span> 
 </div> 
 <div> 
  <div> 
   <img alt="" height="183" src="https://images2.imgbox.com/57/9e/Z4UlgumI_o.png" width="953"> 
  </div> 
  <div> 
   <img alt="" height="49" src="https://images2.imgbox.com/64/23/PhZlhHsz_o.png" width="727"> 
  </div> 
  <h3>4.安全的加密传输</h3> 
  <div> 
   <div> 
    <span style="color:#000000;">互联网中的绝大多数 </span> 
    <span style="color:#000000;">DNS </span> 
    <span style="color:#000000;">服务器（超过 </span> 
    <span style="color:#000000;">95%</span> 
    <span style="color:#000000;">）都是基于 </span> 
    <span style="color:#000000;">BIND 域名解析服务搭建的，而bind </span> 
    <span style="color:#000000;">服务程序为了提供安全的解析服务，已经对 </span> 
    <span style="color:#000000;">TSIG</span> 
    <span style="color:#000000;">（见 </span> 
    <span style="color:#000000;">RFC 2845）加密机制提供了支持。TSIG </span> 
    <span style="color:#000000;">主要是利用了密码编码的方式来保护区域信息的传输（</span> 
    <span style="color:#000000;">Zone Transfer</span> 
    <span style="color:#000000;">），即 </span> 
    <span style="color:#000000;">TSIG 加密机制保证了 </span> 
    <span style="color:#000000;">DNS </span> 
    <span style="color:#000000;">服务器之间传输域名区域信息的安全性。 </span> 
   </div> 
  </div> 
  <div> 
   <strong>第一步：</strong>在主服务器中生成密钥。dnssec-keygen 命令用于生成安全的 DNS 服务密钥，其格式为“dnssec-keygen [参数]” 
  </div> 
  <div> 
   <img alt="" height="109" src="https://images2.imgbox.com/61/17/9SWUVxYE_o.png" width="676"> 
  </div> 
  <div> 
   <div> 
    <span style="color:#000000;">使用下述命令生成一个主机名称为 </span> 
    <span style="color:#000000;">master-slave </span> 
    <span style="color:#000000;">的 </span> 
    <span style="color:#000000;">128 </span> 
    <span style="color:#000000;">位 </span> 
    <span style="color:#000000;">HMAC-MD5 算法的密钥文件。在执行该命令后默认会在当前目录中生成公钥和私钥文件，我们需要把私钥文件中 </span> 
    <span style="color:#000000;">Key 参数后面的值记录下来，一会儿要将其写入传输配置文件中。</span> 
   </div> 
  </div> 
  <div> 
   <img alt="" height="44" src="https://images2.imgbox.com/85/64/wfOW6rBt_o.png" width="824"> 
  </div> 
  <div> 
   <img alt="" height="204" src="https://images2.imgbox.com/37/15/cjNrDv00_o.png" width="852"> 
  </div> 
  <div> 
   <strong>第二步：</strong>在主服务器中创建密钥验证文件。进入 bind 服务程序用于保存配置文件的目录，把刚刚生成的密钥名称、加密算法和私钥加密字符串按照下面的格式写入 tansfer.key 传输配置文件中。为了安全起见，需要将文件的所属组修改成 named，并将文件权限设置得要小一点，然后设置该文件的一个硬链接，并指向/etc 目录。 
  </div> 
  <div> 
   <img alt="" height="139" src="https://images2.imgbox.com/9d/87/drITGeVd_o.png" width="768"> 
  </div> 
  <div> 
   <img alt="" height="98" src="https://images2.imgbox.com/06/9d/y1YlWeaf_o.png" width="822"> 
  </div> 
  <div> 
   <strong>第三步：</strong>开启并加载 bind 服务的密钥验证功能。首先需要在主服务器的主配置文件中加载密钥验证文件，然后进行设置，使得只允许带有 master-slave 密钥认证的 DNS 服务器同步数据配置文件 
  </div> 
  <div> 
   <img alt="" height="304" src="https://images2.imgbox.com/3d/5a/qmDMMyLo_o.png" width="930"> 
  </div> 
  <div> 
   <div> 
    <span style="color:#000000;">DNS </span> 
    <span style="color:#000000;">主服务器的 </span> 
    <span style="color:#000000;">TSIG </span> 
    <span style="color:#000000;">密钥加密传输功能就已经配置完成。然后清空 </span> 
    <span style="color:#000000;">DNS 从服务器同步目录中所有的数据配置文件，再次重启 </span> 
    <span style="color:#000000;">bind 服务程序。这时就已经不能像刚才那样自动获取到数据配置文件了。 </span> 
   </div> 
   <div> 
    <img alt="" height="65" src="https://images2.imgbox.com/88/bb/Y3FImD7v_o.png" width="997"> 
   </div> 
  </div> 
  <div> 
   <strong>第四步：</strong>配置从服务器，使其支持密钥验证。配置 DNS 从服务器和主服务器的方法大致相同，都需要在 bind 服务程序的配置文件目录中创建密钥认证文件，并设置相应的权限，然后设置该文件的一个硬链接，并指向/etc 目录。 
  </div> 
  <div> 
   <img alt="" height="45" src="https://images2.imgbox.com/0f/64/zn1M7swm_o.png" width="855"> 
  </div> 
  <div> 
   <img alt="" height="127" src="https://images2.imgbox.com/f2/0a/ipLc7gEC_o.png" width="937"> 
  </div> 
  <div> 
   <img alt="" height="68" src="https://images2.imgbox.com/b8/74/oghQctla_o.png" width="965"> 
  </div> 
  <div> 
   <strong>第五步：</strong>开启并加载从服务器的密钥验证功能。这一步的操作步骤也同样是在主配置文件中加载密钥认证文件，然后按照指定的格式写上主服务器的 IP 地址和密钥名称。注意，密钥名称等参数位置不要太靠前，大约在第 51 行比较合适，否则 bind 服务程序会因为没有加 
   <span style="color:#000000;">载完预设参数而报错： </span> 
  </div> 
  <div> 
   <img alt="" height="32" src="https://images2.imgbox.com/73/9e/4W81Kqdo_o.png" width="785"> 
  </div> 
  <div> 
   <img alt="" height="250" src="https://images2.imgbox.com/2e/a7/rqg0faG3_o.png" width="986"> 
  </div> 
  <div> 
   <img alt="" height="175" src="https://images2.imgbox.com/40/15/lyeqXZHD_o.png" width="958"> 
  </div> 
  <div> 
   <strong>第六步：</strong>DNS 从服务器同步域名区域数据。现在，两台服务器的 bind 服务程序都已经配置妥当，并匹配到了相同的密钥认证文件。接下来在从服务器上重启 bind 服务程序，可以发现又能顺利地同步到数据配置文件了。 
  </div> 
  <div> 
   <img alt="" height="39" src="https://images2.imgbox.com/28/92/G2JSvjyV_o.png" width="970"> 
  </div> 
  <div> 
   <strong>第七步：</strong>再次进行解析验证。功能正常。请大家注意观察，是由 192.168.10.20 从服务器进行解析的。 
  </div> 
  <div> 
   <img alt="" height="192" src="https://images2.imgbox.com/6b/bd/vikPPsUo_o.png" width="925"> 
  </div> 
  <h3 style="background-color:transparent;">5.部署缓存服务器</h3> 
  <div> 
   <div> 
    <span style="color:#000000;">DNS </span> 
    <span style="color:#000000;">缓存服务器是一种不负责域名数据维护的 </span> 
    <span style="color:#000000;">DNS 服务器。简单来说，缓存服务器就是把用户经常使用到的域名与 </span> 
    <span style="color:#000000;">IP 地址的解析记录保存在主机本地，从而提升下次解析的效率。DNS 缓存服务器一般用于经常访问某些固定站点而且对这些网站的访问速度有较高要求的企业内网中，但实际的应用并不广泛。而且，缓存服务器是否可以成功解析还与指定的上级 DNS服务器的允许策略有关，因此当前仅需了解</span> 
   </div> 
  </div> 
 </div> 
 <div> 
  <strong>第一步：</strong>配置系统的双网卡参数。前面讲到，缓存服务器一般用于企业内网，旨在降低内网用户查询 DNS 的时间消耗。因此，为了更加贴近真实的网络环境，实现外网查询功能，我们需要在缓存服务器中再添加一块网卡，并配置出两台 Linux 虚拟机系统 
 </div> 
 <div> 
  <img alt="" height="136" src="https://images2.imgbox.com/5d/27/5spMdvUN_o.png" width="688"> 
 </div> 
 <div> 
  <strong>第二步：</strong>还需要在虚拟机软件中将新添加的网卡设置为“桥接模式”，如图 13-10 所示。然后设置成与物理设备相同的网络参数（此处需要大家按照物理设备真实的网络参数来配置）。 
 </div> 
 <div> 
  <img alt="" height="432" src="https://images2.imgbox.com/46/11/QHsqBUZ5_o.png" width="852"> 
 </div> 
 <div> 
  <img alt="" height="330" src="https://images2.imgbox.com/c4/7b/Pnjk3k4r_o.png" width="732"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">新添加的网卡设备默认没有配置文件，需要自行输入网卡名称和类型。另外，记得让新的网卡参数生效： </span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="51" src="https://images2.imgbox.com/cd/d6/YducxNpZ_o.png" width="1046"> 
 </div> 
 <div> 
  <img alt="" height="375" src="https://images2.imgbox.com/74/82/f20RswT7_o.png" width="1045"> 
 </div> 
 <div> 
  <strong>第三步：</strong>在 bind 服务程序的主配置文件中添加缓存转发参数。在大约第 20 行处添加一行参数“forwarders { 上级 DNS 服务器地址; };”，上级 DNS 服务器地址指的是获取数据配置文件的服务器。考虑到查询速度、稳定性、安全性等因素， 
  <span style="color:#000000;">北京市</span>公共 DNS 服务器的地址 210.73.64.1。如果大家也使用该地址，请先测试是否可以 ping 通，以免导致 DNS 域名解析失败。 
 </div> 
 <div> 
  <img alt="" height="248" src="https://images2.imgbox.com/78/a4/yP5eAYh6_o.png" width="836"> 
 </div> 
 <div> 
  <img alt="" height="45" src="https://images2.imgbox.com/66/b5/CNyyuzjy_o.png" width="954"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">如果将虚拟机系统还原到了最初始的状态，记得把防火墙的放行规则一并设置完成： </span> 
  </div> 
  <div> 
   <img alt="" height="40" src="https://images2.imgbox.com/b9/6c/pVGhWbB3_o.png" width="898"> 
  </div> 
  <div> 
   <img alt="" height="98" src="https://images2.imgbox.com/78/f8/J2hPT5Bz_o.png" width="816"> 
  </div> 
  <div> 
   <strong>第四步：</strong>重启 DNS 服务，验证成果。把客户端主机的 DNS 服务器地址参数修改为 DNS缓存服务器的 IP 地址 192.168.10.10。这样即可让客户端使用本地 DNS 缓存服务器提供的域名查询解析服务。 
  </div> 
 </div> 
 <div> 
  <img alt="" height="241" src="https://images2.imgbox.com/f5/86/ceDg4XOV_o.png" width="815"> 
 </div> 
 <div> 
  <div> 
   <span style="color:#000000;">在将客户端主机的网络参数设置妥当后重启网络服务，即可使用 </span> 
   <span style="color:#000000;">nslookup 命令来验证实验结果（如果解析失败，请读者留意是否是上级 </span> 
   <span style="color:#000000;">DNS </span> 
   <span style="color:#000000;">服务器选择的问题）。其中，Server 参数为域名解析记录提供的服务器地址，因此可见是由本地 </span> 
   <span style="color:#000000;">DNS 缓存服务器提供的解析内容。</span> 
  </div> 
 </div> 
 <div> 
  <img alt="" height="135" src="https://images2.imgbox.com/74/3b/Byr1kYkh_o.png" width="862"> 
 </div> 
 <h3>6.分离解析技术</h3> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <div></div> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29ad16611604ba4fdf0481525d61b481/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【minio】Ubuntu安装MinIO文件服务器并通过C&#43;&#43;上传下载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d9d2484325ea5a64b9b7b8de95506325/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端新手小白，入职第一天，我都做了什么</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>