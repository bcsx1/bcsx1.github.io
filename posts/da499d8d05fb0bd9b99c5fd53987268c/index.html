<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【笔记】YOLOv3&#43;darknet实现目标识别 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【笔记】YOLOv3&#43;darknet实现目标识别" />
<meta property="og:description" content="目录 一、安装OPENCV3.41、安装配置相关工具及依赖库2、从官网下载源码3、安装过程（1）将zip文件解压到当前目录（2）进入解压后的文件夹（3）创建一个编译需要的临时文件夹build，并进入（4）cmake一下（5）进行make编译，需要很久，静静等待（6）进行make install安装 二、编译darknet1、首先要安装Darknet，拷贝他们的github：2、修改Makefile3、修改.weights文件保存时机4、然后进入` darknet/`文件夹进行编译：5、下载在ImageNet预训练过的网络参数weight，选择YOLOv3-tiny版本的：6、测试`darknet`，用`data/`文件夹里的测试图进行测试： 三、创建自定义数据集1、获取训练集样本2、利用LabelImg标记训练样本，获得每张图片对应的.txt文件(1）添加自己的类(2)打开工具，标记生成对应文件 3、汇总.txt文件 四、训练YOLOv3-tiny模型1、获取训练所必须的文件（1）`yolov3-tiny.conv.15`（2）`yolov3-tiny-bot.cfg`（3）`bot.data`（4）`bot.names` 2、开始训练3、输出日记解释 五、结果测试后记1、断点继续训练2、Nan3、训练日志可视化4、YOLOV3无法加载图片&#34;cannot load image&#34; 参考资料 本文中的YOLOv3是在Linux下进行测试的，如不需要OPENCV，可以不安装，Makefile中的对应选项也不用更改
一、安装OPENCV3.4 目前darknet c框架只支持opencv2.x和3.x。如果想要运行在opencv4.x上，需要首先修改Makefile来显性指定opencv版本为4.x，具体办法请自行百度，这里我们直接用OPENCV3.4.7
1、安装配置相关工具及依赖库 sudo apt-get install build-essential #必须的，gcc编译环境 sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev #必须的,包括cmake等工具 sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev #可选的，看个人需要，总共5M左右 如出现无法定位软件包：libjasper-dev，在代码中把这个删掉再执行
2、从官网下载源码 官网地址：https://opencv.org/releases.html
3、安装过程 这是官方的安装教程，但是执行的时候有些地方需要更改
（1）将zip文件解压到当前目录 unzip opencv-3.4.7.zip -d . （2）进入解压后的文件夹 cd opencv-3.4.7 （3）创建一个编译需要的临时文件夹build，并进入 mkdir build cd build/ （4）cmake一下 cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/da499d8d05fb0bd9b99c5fd53987268c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-04T03:18:25+08:00" />
<meta property="article:modified_time" content="2020-01-04T03:18:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【笔记】YOLOv3&#43;darknet实现目标识别</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#OPENCV34_3" rel="nofollow">一、安装OPENCV3.4</a></li><li><ul><li><a href="#1_6" rel="nofollow">1、安装配置相关工具及依赖库</a></li><li><a href="#2_23" rel="nofollow">2、从官网下载源码</a></li><li><a href="#3_26" rel="nofollow">3、安装过程</a></li><li><ul><li><a href="#1zip_28" rel="nofollow">（1）将zip文件解压到当前目录</a></li><li><a href="#2_34" rel="nofollow">（2）进入解压后的文件夹</a></li><li><a href="#3build_40" rel="nofollow">（3）创建一个编译需要的临时文件夹build，并进入</a></li><li><a href="#4cmake_48" rel="nofollow">（4）cmake一下</a></li><li><a href="#5make_56" rel="nofollow">（5）进行make编译，需要很久，静静等待</a></li><li><a href="#6make_install_62" rel="nofollow">（6）进行make install安装</a></li></ul> 
  </li></ul> 
  </li><li><a href="#darknet_79" rel="nofollow">二、编译darknet</a></li><li><ul><li><a href="#1Darknetgithub_80" rel="nofollow">1、首先要安装Darknet，拷贝他们的github：</a></li><li><a href="#2Makefile_86" rel="nofollow">2、修改Makefile</a></li><li><a href="#3weights_92" rel="nofollow">3、修改.weights文件保存时机</a></li><li><a href="#4_darknet_98" rel="nofollow">4、然后进入` darknet/`文件夹进行编译：</a></li><li><a href="#5ImageNetweightYOLOv3tiny_104" rel="nofollow">5、下载在ImageNet预训练过的网络参数weight，选择YOLOv3-tiny版本的：</a></li><li><a href="#6darknetdata_109" rel="nofollow">6、测试`darknet`，用`data/`文件夹里的测试图进行测试：</a></li></ul> 
  </li><li><a href="#_116" rel="nofollow">三、创建自定义数据集</a></li><li><ul><li><a href="#1_119" rel="nofollow">1、获取训练集样本</a></li><li><a href="#2LabelImgtxt_124" rel="nofollow">2、利用LabelImg标记训练样本，获得每张图片对应的.txt文件</a></li><li><ul><li><a href="#1_125" rel="nofollow">(1）添加自己的类</a></li><li><a href="#2_132" rel="nofollow">(2)打开工具，标记生成对应文件</a></li></ul> 
   </li><li><a href="#3txt_158" rel="nofollow">3、汇总.txt文件</a></li></ul> 
  </li><li><a href="#YOLOv3tiny_196" rel="nofollow">四、训练YOLOv3-tiny模型</a></li><li><ul><li><a href="#1_197" rel="nofollow">1、获取训练所必须的文件</a></li><li><ul><li><a href="#1yolov3tinyconv15_208" rel="nofollow">（1）`yolov3-tiny.conv.15`</a></li><li><a href="#2yolov3tinybotcfg_215" rel="nofollow">（2）`yolov3-tiny-bot.cfg`</a></li><li><a href="#3botdata_235" rel="nofollow">（3）`bot.data`</a></li><li><a href="#4botnames_248" rel="nofollow">（4）`bot.names`</a></li></ul> 
   </li><li><a href="#2_252" rel="nofollow">2、开始训练</a></li><li><a href="#3_262" rel="nofollow">3、输出日记解释</a></li></ul> 
  </li><li><a href="#_294" rel="nofollow">五、结果测试</a></li><li><a href="#_301" rel="nofollow">后记</a></li><li><ul><li><a href="#1_303" rel="nofollow">1、断点继续训练</a></li><li><a href="#2Nan_309" rel="nofollow">2、Nan</a></li><li><a href="#3_314" rel="nofollow">3、训练日志可视化</a></li><li><a href="#4YOLOV3cannot_load_image_431" rel="nofollow">4、YOLOV3无法加载图片"cannot load image"</a></li></ul> 
  </li><li><a href="#_440" rel="nofollow">参考资料</a></li></ul> 
</div> 
<p></p> 
<p>本文中的YOLOv3是在Linux下进行测试的，如不需要OPENCV，可以不安装，Makefile中的对应选项也不用更改</p> 
<h2><a id="OPENCV34_3"></a>一、安装OPENCV3.4</h2> 
<p>目前darknet c框架只支持opencv2.x和3.x。如果想要运行在opencv4.x上，需要首先修改Makefile来显性指定opencv版本为4.x，具体办法请自行百度，这里我们直接用OPENCV3.4.7</p> 
<h3><a id="1_6"></a>1、安装配置相关工具及依赖库</h3> 
<pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install build<span class="token operator">-</span>essential <span class="token comment">#必须的，gcc编译环境</span>
</code></pre> 
<pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install cmake git libgtk2<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>dev pkg<span class="token operator">-</span>config libavcodec<span class="token operator">-</span>dev libavformat<span class="token operator">-</span>dev libswscale<span class="token operator">-</span>dev <span class="token comment">#必须的,包括cmake等工具</span>
</code></pre> 
<pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install python<span class="token operator">-</span>dev python<span class="token operator">-</span>numpy libtbb2 libtbb<span class="token operator">-</span>dev libjpeg<span class="token operator">-</span>dev libpng<span class="token operator">-</span>dev libtiff<span class="token operator">-</span>dev libjasper<span class="token operator">-</span>dev libdc1394<span class="token operator">-</span><span class="token number">22</span><span class="token operator">-</span>dev
<span class="token comment">#可选的，看个人需要，总共5M左右</span>
</code></pre> 
<p>如出现无法定位软件包：<code>libjasper-dev</code>，在代码中把这个删掉再执行</p> 
<h3><a id="2_23"></a>2、从官网下载源码</h3> 
<p>官网地址：<a href="https://opencv.org/releases.html" rel="nofollow">https://opencv.org/releases.html</a></p> 
<h3><a id="3_26"></a>3、安装过程</h3> 
<p><a href="https://docs.opencv.org/3.4.9/d7/d9f/tutorial_linux_install.html" rel="nofollow">这是</a>官方的安装教程，但是执行的时候有些地方需要更改</p> 
<h4><a id="1zip_28"></a>（1）将zip文件解压到当前目录</h4> 
<pre><code class="prism language-python">unzip opencv<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.7</span><span class="token punctuation">.</span><span class="token builtin">zip</span> <span class="token operator">-</span>d <span class="token punctuation">.</span>
</code></pre> 
<h4><a id="2_34"></a>（2）进入解压后的文件夹</h4> 
<pre><code class="prism language-python">cd opencv<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.7</span>
</code></pre> 
<h4><a id="3build_40"></a>（3）创建一个编译需要的临时文件夹build，并进入</h4> 
<pre><code class="prism language-python">mkdir build
cd build<span class="token operator">/</span>
</code></pre> 
<h4><a id="4cmake_48"></a>（4）cmake一下</h4> 
<pre><code class="prism language-python">cmake <span class="token operator">-</span>D CMAKE_BUILD_TYPE<span class="token operator">=</span>Release <span class="token operator">-</span>D CMAKE_INSTALL_PREFIX<span class="token operator">=</span><span class="token operator">/</span>usr <span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>这里cmake命令执行会下载ippicv，需要等待比较长时间才能下载完成</p> 
<h4><a id="5make_56"></a>（5）进行make编译，需要很久，静静等待</h4> 
<pre><code class="prism language-python">make <span class="token operator">-</span>j7 	<span class="token comment"># runs 7 jobs in parallel</span>
</code></pre> 
<h4><a id="6make_install_62"></a>（6）进行make install安装</h4> 
<pre><code class="prism language-python">sudo make install
</code></pre> 
<p>安装完成后，可以用</p> 
<pre><code class="prism language-python">whereis opencv
</code></pre> 
<p>查看opencv的安装路径，如果没安装错的话，应该会返回</p> 
<pre><code class="prism language-python">opencv<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>include<span class="token operator">/</span>opencv
</code></pre> 
<h2><a id="darknet_79"></a>二、编译darknet</h2> 
<h3><a id="1Darknetgithub_80"></a>1、首先要安装Darknet，拷贝他们的github：</h3> 
<pre><code class="prism language-python">git clone https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>pjreddie<span class="token operator">/</span>darknet
</code></pre> 
<h3><a id="2Makefile_86"></a>2、修改Makefile</h3> 
<p>将<code>OPENCV=0</code>，<code>OPENMP=0</code>的值都改为1<br> <img src="https://images2.imgbox.com/52/44/7QdfXNkb_o.png" alt="在这里插入图片描述"><br> OpenMP是由OpenMP Architecture Review Board牵头提出的，并已被广泛接受，用于共享内存并行系统的多处理器程序设计的一套指导性编译处理方案(Compiler Directive)，把OPENMP的值改为1，实测训练速度会快一些,如不需要，可以不作更改，但每次更改，都需要重新Make一下darknet</p> 
<h3><a id="3weights_92"></a>3、修改.weights文件保存时机</h3> 
<p>原版的.weights文件是当训练次数小于1000时，每隔100次保存一次，大于1000是每10000次保存一次，这对于检测类别数较少或者数据集太少的情况是很难受的，那么可以修改源代码，使得每隔1000次保存一次。<br> 打开darknet/example/detector.c<br> 把第138行的if(i%10000== 0 || (i &lt; 1000 &amp;&amp; i%100 == 0))修改为if(i%1000==0)，就是每隔1000次迭代保存一次.weights文件了<br> <img src="https://images2.imgbox.com/cc/5d/nhVObGa4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_darknet_98"></a>4、然后进入<code>darknet/</code>文件夹进行编译：</h3> 
<pre><code class="prism language-python">cd darknet
make
</code></pre> 
<h3><a id="5ImageNetweightYOLOv3tiny_104"></a>5、下载在ImageNet预训练过的网络参数weight，选择YOLOv3-tiny版本的：</h3> 
<pre><code class="prism language-python">wget https<span class="token punctuation">:</span><span class="token operator">//</span>pjreddie<span class="token punctuation">.</span>com<span class="token operator">/</span>media<span class="token operator">/</span>files<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>weights
</code></pre> 
<h3><a id="6darknetdata_109"></a>6、测试<code>darknet</code>，用<code>data/</code>文件夹里的测试图进行测试：</h3> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detect cfg<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>cfg yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>weights data<span class="token operator">/</span>dog<span class="token punctuation">.</span>jpg
</code></pre> 
<p><img src="https://images2.imgbox.com/af/b7/EaE3Ze2N_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_116"></a>三、创建自定义数据集</h2> 
<p>基本上所有的机器学习方法的首要前提是需要提供数据集来训练我们的神经网络，要么是已经采集好而且开源的数据集（如手写数字MINST集、ImagNet数据集、COCO数据集等等…），要么就需要自己采集数据创建一个自己的训练集。<br> 使用图片标记工具<a href="https://github.com/tzutalin/labelImg">labelImg</a>可以帮助我们快速制作自己的数据集</p> 
<h3><a id="1_119"></a>1、获取训练集样本</h3> 
<p>在<code>darknet/</code>文件夹下创建<code>bot</code>文件夹，再创建一个用来存放数据集（图片）的文件夹<br> 我这里训练集只有一个类，共162张图片<br> <img src="https://images2.imgbox.com/b5/b5/dg4tNutL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2LabelImgtxt_124"></a>2、利用LabelImg标记训练样本，获得每张图片对应的.txt文件</h3> 
<h4><a id="1_125"></a>(1）添加自己的类</h4> 
<p>打开<code>labelImg-master\data\predefined_classes.txt</code><br> <img src="https://images2.imgbox.com/85/e2/rGIoJlQb_o.png" alt="在这里插入图片描述"></p> 
<p>修改为futuaner<br> <img src="https://images2.imgbox.com/7c/42/a60qT6Jj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_132"></a>(2)打开工具，标记生成对应文件</h4> 
<p><img src="https://images2.imgbox.com/20/d5/shTh52kf_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d2/b7/tb9dX4wH_o.png" alt="在这里插入图片描述"><br> 直接按快捷键W，标记目标区域<br> <img src="https://images2.imgbox.com/4c/27/fQENgpJM_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fd/d9/f60GgW1o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6a/f9/3XsSnCWy_o.png" alt="在这里插入图片描述"><br> 点击futuaner,然后点OK</p> 
<p><img src="https://images2.imgbox.com/3d/4c/Ldc8nTya_o.png" alt="在这里插入图片描述"><br> 修改保存格式，我们需要的是YOLO的格式</p> 
<p><img src="https://images2.imgbox.com/94/9e/37IorGeV_o.png" alt="在这里插入图片描述"><br> 然后点保存</p> 
<p><img src="https://images2.imgbox.com/fc/27/dEU4E8dR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/63/f3/4zknzDNM_o.png" alt="在这里插入图片描述"><br> 会生成一个与图片名字相同的txt文件<br> YOLO的格式：<br> [category number] [object center in X] [object center in Y] [object width in X] [object width in Y]<br> <img src="https://images2.imgbox.com/4e/81/1Bz3OScK_o.png" alt="在这里插入图片描述"></p> 
<p>之后按快捷键D到下一张，同样的操作<br> <img src="https://images2.imgbox.com/c7/3c/C5HM2m26_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3txt_158"></a>3、汇总.txt文件</h3> 
<p>每一张标记号的训练图片都会对应相同名字的.txt文件作为目标的label单独保存，所以我们还需要一个<code>train.txt</code>和<code>test.txt</code>来汇总这些单独的文件以便读取。我们可以直接用python来帮助我们生成这两个汇总文件，代码如下（参照了<a href="https://blog.csdn.net/weixin_45162417/article/details/90758526">这里</a>）：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> glob<span class="token punctuation">,</span> os

<span class="token comment"># Current directory</span>
current_dir <span class="token operator">=</span> r<span class="token string">'C:\Users\liuruimin\Desktop\腐团儿\bot\腐团儿'</span><span class="token comment">##这里改为训练集的绝对路径</span>

<span class="token comment"># Directory where the data will reside, relative to 'darknet.exe'</span>
path_data <span class="token operator">=</span> <span class="token string">'/home/liuruimin/桌面/腐团儿/bot/'</span>

<span class="token comment"># Percentage of images to be used for the test set</span>
percentage_test <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># Create and/or truncate train.txt and test.txt</span>
file_train <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'train.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  
file_test <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token comment"># Populate train.txt and test.txt</span>
counter <span class="token operator">=</span> <span class="token number">1</span>  
index_test <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">/</span> percentage_test<span class="token punctuation">)</span>  
<span class="token keyword">for</span> pathAndFilename <span class="token keyword">in</span> glob<span class="token punctuation">.</span>iglob<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>current_dir<span class="token punctuation">,</span> <span class="token string">"*.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    title<span class="token punctuation">,</span> ext <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>pathAndFilename<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> counter <span class="token operator">==</span> index_test<span class="token punctuation">:</span>
        counter <span class="token operator">=</span> <span class="token number">1</span>
        file_test<span class="token punctuation">.</span>write<span class="token punctuation">(</span>path_data <span class="token operator">+</span> <span class="token string">'腐团儿/'</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">'.jpg'</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        file_train<span class="token punctuation">.</span>write<span class="token punctuation">(</span>path_data <span class="token operator">+</span> <span class="token string">'腐团儿/'</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">'.jpg'</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
        counter <span class="token operator">=</span> counter <span class="token operator">+</span> <span class="token number">1</span>
</code></pre> 
<p>运行完这段代码以后，在当前文件夹会生成<code>train.tx</code>t和<code>test.txt</code>两个文件</p> 
<p><img src="https://images2.imgbox.com/63/54/DAhKhrJr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="YOLOv3tiny_196"></a>四、训练YOLOv3-tiny模型</h2> 
<h3><a id="1_197"></a>1、获取训练所必须的文件</h3> 
<p>要在Darknet框架下训练YOLO模型，我们总共需要以下文件：</p> 
<p><mark>yolov3-tiny.conv.15<br> yolov3-tiny-bot.cfg<br> bot.data<br> bot.names<br> train.txt<br> test.txt</mark></p> 
<p>我们统一将这些文件放到命名为bot/的文件夹里。</p> 
<h4><a id="1yolov3tinyconv15_208"></a>（1）<code>yolov3-tiny.conv.15</code></h4> 
<p>已经预训练过的网络可以使用迁移学习（Transfer Learning）来减少训练时间。简单来说我们只使用前面15层的卷积层来提取图像特征，这15层是不用训练的，我们着重训练后面几层全连接层来让我们自己的数据和对应的标签对接。我们可以用下面的代码来提取原先网络的前15层的参数weight，然后生成一个<code>yolov3-tiny.conv.15</code>文件：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet partial cfg<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>cfg yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>weights yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>conv<span class="token punctuation">.</span><span class="token number">15</span> <span class="token number">15</span>
</code></pre> 
<h4><a id="2yolov3tinybotcfg_215"></a>（2）<code>yolov3-tiny-bot.cfg</code></h4> 
<p>我们可以复制<code>cfg/</code>文件夹里原来的yolov3-tiny.cfg文件将其命名为yolov3-tiny-bot.cfg，在这个文件里的以下几行进行改动：</p> 
<p>第3行：<code>batch = 1</code><br> 第4行：<code>subdivision = 1</code><br> 第127行和第171行：<code>filters = 18</code><br> 第135行和第177行：<code>classes = 1</code></p> 
<p>我们对应我们的数据设定classes的数量为1，filters的值就为(classes+ 5)*3 = 18</p> 
<p><code>batch</code>，表示网络积累多少个样本后进行一次BP<br> <code>subdivision</code>，这个参数表示将一个batch的图片分sub次完成网络的前向传播<br> 例如：<br> <code>batch = 64</code><br> <code>subdivision = 16</code><br> 表示训练的过程中将一次性加载64张图片进内存，然后分16次完成前向传播，意思是每次4张，前向传播的循环过程中累加loss求平均，待64张图片都完成前向传播后，再一次性后传更新参数，即是在训练输出中，用来减轻内存占用的压力；通常情况下batch越大，训练效果越好，subdivision越大，占用内存压力越小</p> 
<p>sub一般设置16，不能太大或太小，且为8的倍数，其实也没啥硬性规定，看着舒服就好， batch的值可以根据显存占用情况动态调整，一次性加减sub大小即可，还需注意一点，在测试的时候batch和sub都设置为1，避免发生神秘错误</p> 
<p>我这里设置为<code>batch = 1</code>，<code>subdivision = 1</code>，实测训练可行</p> 
<h4><a id="3botdata_235"></a>（3）<code>bot.data</code></h4> 
<p>我们可以复制<code>cfg/</code>文件夹里原来的<code>voc.data</code>文件将其命名为<code>bot.data</code>，并做以下修改</p> 
<pre><code class="prism language-python">classes <span class="token operator">=</span> <span class="token number">1</span>  
train  <span class="token operator">=</span> <span class="token operator">/</span>home<span class="token operator">/</span>liuruimin<span class="token operator">/</span>桌面<span class="token operator">/</span>腐团儿<span class="token operator">/</span>bot<span class="token operator">/</span>train<span class="token punctuation">.</span>txt  
valid  <span class="token operator">=</span> <span class="token operator">/</span>home<span class="token operator">/</span>liuruimin<span class="token operator">/</span>桌面<span class="token operator">/</span>腐团儿<span class="token operator">/</span>bot<span class="token operator">/</span>test<span class="token punctuation">.</span>txt  
names <span class="token operator">=</span> bot<span class="token operator">/</span>bot<span class="token punctuation">.</span>names  
backup <span class="token operator">=</span> backup<span class="token operator">/</span>
</code></pre> 
<p><code>train.txt</code>和<code>test.txt</code>就是前面我们生成的两个汇总文件，而backup就是我们训练过的weight自动保存的路径</p> 
<h4><a id="4botnames_248"></a>（4）<code>bot.names</code></h4> 
<p>同样，我们可以复制<code>data/</code>文件夹里原来的voc.names文件将其命名为bot.names，并改为我们自己的class名称，与之前的<code>predefined_classes.txt</code>一样共1类，如果你是多个class，需要与之前的<code>predefined_classes.txt</code>文件中的class一一对应</p> 
<p><img src="https://images2.imgbox.com/d1/f7/mKAaqWcR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_252"></a>2、开始训练</h3> 
<p>所有这些文件都统一放到bot/文件夹以后，就可以开始我们的训练了，输入以下代码：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector train bot<span class="token operator">/</span>bot<span class="token punctuation">.</span>data bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>cfg bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>conv<span class="token punctuation">.</span><span class="token number">15</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2c/19/AEiAUrlN_o.png" alt="在这里插入图片描述"><br> 如果没有出错的话，训练就自动开始了。一般来讲训练的时间会取决于你的硬件配置以及你数据集的大小，正常的话你需要大概每个class至少有300个数据才可以有一个比较准确的结果。结果会显示在每个batch结束时，一般着重看averge loss也就是avg参数，avg值越小准确率就越高。Darknet不会自动停止训练，当你观察到avg值比较小时（比如0.3），你就可以手动停止训练了。训练时网络的参数weight会自动保存至backup设置的路径</p> 
<h3><a id="3_262"></a>3、输出日记解释</h3> 
<p>如上图<br> 一个批次有1*2条信息，每组包含2条信息，分别是：<br> Region 16 Avg IOU:<br> Region 23 Avg IOU:</p> 
<p>其中Region 16 行的参数意义如下：<br> Avg IOU:当前迭代中，预测的box与标注的box的平均交并比，越大越好，期望数值为1；<br> Class: 标注物体的分类准确率，越大越好，期望数值为1；<br> obj: 越大越好，期望数值为1；<br> No obj: 越小越好；<br> .5R: 以IOU=0.5为阈值时候的recall; recall = 检出的正样本/实际的正样本<br> .75R: 以IOU=0.75为阈值时候的recall;<br> count:正样本数目</p> 
<p>注：Region 23 行存在nan值说明该子批次没有预测到正样本，在训练开始时候有出现是正常现象（只要其中一个Region行是有输出的就行）</p> 
<p>每个批次最后都会有一个输出行</p> 
<pre><code class="prism language-python"><span class="token number">15006</span>：<span class="token number">0.054513</span>，<span class="token number">0.090221</span> avg，<span class="token number">0.001000</span> rate，<span class="token number">1.826643</span> seconds，<span class="token number">15006</span> images
</code></pre> 
<p>各部分代表意义如下：<br> 第几批次，总损失，平均损失，当前学习率，当前批次训练时间，目前为止参与训练的图片总数</p> 
<h2><a id="_294"></a>五、结果测试</h2> 
<p>另外找一张用于检测的图片，保存在<code>darknet/</code>的根目录下，运行以下代码即可进行测试</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector test bot<span class="token operator">/</span>bot<span class="token punctuation">.</span>data bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>cfg backup<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot_15000<span class="token punctuation">.</span>weights tset<span class="token punctuation">.</span>jpg
</code></pre> 
<p><img src="https://images2.imgbox.com/12/f0/UYtAcSOi_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_301"></a>后记</h2> 
<h3><a id="1_303"></a>1、断点继续训练</h3> 
<p>如果想继续训练，就要保证<code>backup</code>下的<code>yolov3-tiny-bot.backup</code>还在</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector train bot<span class="token operator">/</span>bot<span class="token punctuation">.</span>data bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>cfg backup<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>backup
</code></pre> 
<h3><a id="2Nan_309"></a>2、Nan</h3> 
<p>训练过程中<code>nan</code>的屏幕占比30%是正常的，如果太大，全是<code>nan</code>，那就是训练过程出了问题。<br> 减少<code>nan</code><br> (1)调高<code>darknet/bot/yolov3-tiny-bot.cfg</code>中的batch，注意得是32的整数倍。<br> (2)增加数据集规模，162张图片的训练集，有点小了，实在不行，就做数据增强，可以把数据集增加到原来的十几倍</p> 
<h3><a id="3_314"></a>3、训练日志可视化</h3> 
<p>前提是训练过程中保存了训练日志<code>xxx.log</code><br> 运行下面的脚本，会在同一目录下生成2个txt文件和显示2张图片</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detector train bot<span class="token operator">/</span>bot<span class="token punctuation">.</span>data bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>cfg bot<span class="token operator">/</span>yolov3<span class="token operator">-</span>tiny<span class="token punctuation">.</span>conv<span class="token punctuation">.</span><span class="token number">15</span>  <span class="token operator">|</span> tee bot<span class="token operator">/</span>训练可视化<span class="token operator">/</span>train_yolov3<span class="token operator">-</span>tiny<span class="token operator">-</span>bot<span class="token punctuation">.</span>log
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Time    : 2018/12/30 16:26</span>
<span class="token comment"># @Author  : lazerliu</span>
<span class="token comment"># @File    : vis_yolov3_log.py</span>
<span class="token comment"># @Func    :yolov3 训练日志可视化，把该脚本和日志文件放在同一目录下运行。</span>

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> os

<span class="token comment"># ==================可能需要修改的地方=====================================#</span>
g_log_path <span class="token operator">=</span> <span class="token string">"train_yolov3-tiny-bot.log"</span>  <span class="token comment"># 此处修改为你的训练日志文件名</span>
<span class="token comment"># ==========================================================================#</span>

<span class="token keyword">def</span> <span class="token function">extract_log</span><span class="token punctuation">(</span>log_file<span class="token punctuation">,</span> new_log_file<span class="token punctuation">,</span> key_word<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    :param log_file:日志文件
    :param new_log_file:挑选出可用信息的日志文件
    :param key_word:根据关键词提取日志信息
    :return:
    '''</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>log_file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>new_log_file<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> train_log<span class="token punctuation">:</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
                <span class="token comment"># 去除多gpu的同步log</span>
                <span class="token keyword">if</span> <span class="token string">"Syncing"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token comment"># 去除nan log</span>
                <span class="token keyword">if</span> <span class="token string">"nan"</span> <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> key_word <span class="token keyword">in</span> line<span class="token punctuation">:</span>
                    train_log<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    train_log<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">drawAvgLoss</span><span class="token punctuation">(</span>loss_log_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    :param loss_log_path: 提取到的loss日志信息文件
    :return: 画loss曲线图
    '''</span>
    line_cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> count<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>loss_log_path<span class="token punctuation">,</span> <span class="token string">"rU"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        line_cnt <span class="token operator">+=</span> <span class="token number">1</span>
    result <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>loss_log_path<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token punctuation">[</span>iter_num <span class="token keyword">for</span> iter_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>line_cnt<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>iter_num <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                         error_bad_lines<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                         names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">,</span> <span class="token string">"avg"</span><span class="token punctuation">,</span> <span class="token string">"rate"</span><span class="token punctuation">,</span> <span class="token string">"seconds"</span><span class="token punctuation">,</span> <span class="token string">"images"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    result<span class="token punctuation">[</span><span class="token string">"avg"</span><span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"avg"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    result<span class="token punctuation">[</span><span class="token string">"avg"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"avg"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"avg"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Avg Loss"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"#ff7043"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"best"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Avg Loss Curve"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Batches"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"Avg Loss"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">drawIOU</span><span class="token punctuation">(</span>iou_log_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    :param iou_log_path: 提取到的iou日志信息文件
    :return: 画iou曲线图
    '''</span>
    line_cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> count<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>iou_log_path<span class="token punctuation">,</span> <span class="token string">"rU"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        line_cnt <span class="token operator">+=</span> <span class="token number">1</span>
    result <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>iou_log_path<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>line_cnt<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">39</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                         error_bad_lines<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                         names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">,</span> <span class="token string">"Class"</span><span class="token punctuation">,</span> <span class="token string">"Obj"</span><span class="token punctuation">,</span> <span class="token string">"No Obj"</span><span class="token punctuation">,</span> <span class="token string">"Avg Recall"</span><span class="token punctuation">,</span> <span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    result<span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">": "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    result<span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    result_iou <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
    <span class="token comment"># 平滑iou曲线</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result_iou<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        iou <span class="token operator">=</span> result_iou<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        iou_next <span class="token operator">=</span> result_iou<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>iou <span class="token operator">-</span> iou_next<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.2</span><span class="token punctuation">:</span>
            result_iou<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>iou <span class="token operator">+</span> iou_next<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>result_iou<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Region Avg IOU"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"#ff7043"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"best"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Avg IOU Curve"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Batches"</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"Avg IOU"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    loss_log_path <span class="token operator">=</span> <span class="token string">"train_log_loss.txt"</span>
    iou_log_path <span class="token operator">=</span> <span class="token string">"train_log_iou.txt"</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>g_log_path<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>loss_log_path<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        extract_log<span class="token punctuation">(</span>g_log_path<span class="token punctuation">,</span> loss_log_path<span class="token punctuation">,</span> <span class="token string">"images"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>iou_log_path<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        extract_log<span class="token punctuation">(</span>g_log_path<span class="token punctuation">,</span> iou_log_path<span class="token punctuation">,</span> <span class="token string">"IOU"</span><span class="token punctuation">)</span>
    drawAvgLoss<span class="token punctuation">(</span>loss_log_path<span class="token punctuation">)</span>
    drawIOU<span class="token punctuation">(</span>iou_log_path<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/35/94/9NxBKioc_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4e/65/4WcckZ7S_o.png" alt="在这里插入图片描述"><br> 训练过程中，训练日志<code>xxx.log</code>是不断写入的，该脚本只能显示此时的图像信息，如果你需要看到最新的图像信息，需要删除生成的2个txt文件，再运行该脚本</p> 
<h3><a id="4YOLOV3cannot_load_image_431"></a>4、YOLOV3无法加载图片"cannot load image"</h3> 
<p>如果你是用Windows来汇总.txt文件的，有可能会出现这种情况<br> 解决办法：<br> 用Notepad++ 打开<code>train.txt</code><br> （1）视图→显示符号→显示所有符号；<br> <img src="https://images2.imgbox.com/9d/f8/zCdNBLh3_o.png" alt="在这里插入图片描述"><br> （2）编辑→文档格式转换→转换为Unix(LF)<br> <img src="https://images2.imgbox.com/5d/eb/bKQHQ5uh_o.png" alt="在这里插入图片描述"><br> 如果还是不行，出现<code>cannot open image</code>或权限不够的情况，建议在linux下汇总这些文件，这样就避免了这些问题</p> 
<h2><a id="_440"></a>参考资料</h2> 
<p>1、<a href="https://blog.csdn.net/weixin_45162417/article/details/90758526">基于YOLO目标检测及OpenCV实现的游戏代玩人工智能体(Auto Gaming Agent) [3]</a><br> 2、<a href="https://blog.csdn.net/csdn_zhishui/article/details/85397380">【笔记】YOLOv3训练自己的数据集(3)——小技巧和训练日志可视化</a><br> 3、<a href="https://www.cnblogs.com/hls91/p/10911997.html" rel="nofollow">YOLOV3中Darknet中cfg文件说明和理解</a><br> 4、<a href="https://blog.csdn.net/qq_34806812/article/details/81537842">YOLOV3无法加载图片"cannot load image"</a><br> 5、<a href="https://blog.csdn.net/weixin_43202256/article/details/83148788">yolo训练日志分析</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b4c9e9487c593a6f5632c5b0a6fa369/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# byte数组与16进制字符串相互转化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/008b458c77da58e2c6be1cae8385078e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是西安80坐标系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>