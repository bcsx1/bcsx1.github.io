<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Seata使用教程 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Seata使用教程" />
<meta property="og:description" content="文章目录 一、Seata简介1.Seata 概念介绍2.分布式事务3.Seata核心组件4.Seata 工作流程5.Seata四大模式二、Seata实战教程1.下载资源2.配置Seata-Server3.增加相关表结构4.代码配置三、常见报错解决 一、Seata简介 1.Seata 概念介绍 Seata 是一款阿里巴巴开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。
官方文档地址 http://seata.io/zh-cn/docs/overview/what-is-seata.html
2.分布式事务 我们可以将分布式事务理解成一个包含了若干个分支事务的全局事务。全局事务的职责是协调其管辖的各个分支事务达成一致，要么一起成功提交，要么一起失败回滚。通常分支事务本身就是一个满足 ACID 特性的本地事务。
分布式事务主要涉及以下概念：
事务：由一组操作构成的可靠、独立的工作单元，事务具备 ACID 的特性，即原子性、一致性、隔离性和持久性。
本地事务：本地事务由本地资源管理器（例如 MySQL、Oracle 等）管理，严格地支持 ACID 特性，高效可靠。本地事务不具备分布式事务的处理能力，只能对自己数据库的操作进行控制，对于其他数据库的操作则无能为力。
全局事务：全局事务指的是一次性操作多个资源管理器完成的事务，由一组分支事务组成。
分支事务：在分布式事务中，就是一个个受全局事务管辖和协调的本地事务。
3.Seata核心组件 (1)TC（Transaction Coordinator）：事务协调器，它是事务的协调者（这里指的是 Seata 服务器），主要负责维护全局事务和分支事务的状态，驱动全局事务提交或回滚。
(2)TM（Transaction Manager）：事务管理器，它是事务的发起者，负责定义全局事务的范围，并根据 TC 维护的全局事务和分支事务状态，做出开始事务、提交事务、回滚事务的决议。
(3)RM（Resource Manager）：资源管理器，它是资源的管理者（这里可以将其理解为各服务使用的数据库）。它负责管理分支事务上的资源，向 TC 注册分支事务，汇报分支事务状态，驱动分支事务的提交或回滚。
4.Seata 工作流程 Seata 对分布式事务的协调和控制，主要是通过 XID 和 3 个核心组件实现的。
XID:是全局事务的唯一标识，它可以在服务的调用链路中传递，绑定到服务的事务上下文中
工作流程：
(1)TM 向 TC 申请开启一个全局事务，全局事务创建成功后，TC 会针对这个全局事务生成一个全局唯一的 XID；
(2)XID 通过服务的调用链传递到其他服务;
(3)RM 向 TC 注册一个分支事务，并将其纳入 XID 对应全局事务的管辖；
(4)TM 根据 TC 收集的各个分支事务的执行结果，向 TC 发起全局事务提交或回滚决议；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/968d0298b00b14ff655b7dea171d442b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-29T16:58:55+08:00" />
<meta property="article:modified_time" content="2022-12-29T16:58:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Seata使用教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#Seata_2" rel="nofollow">一、Seata简介</a></li><li><a href="#1Seata__4" rel="nofollow">1.Seata 概念介绍</a></li><li><a href="#2_10" rel="nofollow">2.分布式事务</a></li><li><a href="#3Seata_19" rel="nofollow">3.Seata核心组件</a></li><li><a href="#4Seata__25" rel="nofollow">4.Seata 工作流程</a></li><li><a href="#5Seata_38" rel="nofollow">5.Seata四大模式</a></li><li><a href="#Seata_86" rel="nofollow">二、Seata实战教程</a></li><li><a href="#1_88" rel="nofollow">1.下载资源</a></li><li><a href="#2SeataServer_94" rel="nofollow">2.配置Seata-Server</a></li><li><a href="#3_306" rel="nofollow">3.增加相关表结构</a></li><li><a href="#4_399" rel="nofollow">4.代码配置</a></li><li><a href="#_686" rel="nofollow">三、常见报错解决</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Seata_2"></a>一、Seata简介</h3> 
<h3><a id="1Seata__4"></a>1.Seata 概念介绍</h3> 
<p>Seata 是一款阿里巴巴开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。</p> 
<p>官方文档地址 http://seata.io/zh-cn/docs/overview/what-is-seata.html</p> 
<h3><a id="2_10"></a>2.分布式事务</h3> 
<p>我们可以将分布式事务理解成一个包含了若干个分支事务的全局事务。全局事务的职责是协调其管辖的各个分支事务达成一致，要么一起成功提交，要么一起失败回滚。通常分支事务本身就是一个满足 ACID 特性的本地事务。<br> 分布式事务主要涉及以下概念：<br> 事务：由一组操作构成的可靠、独立的工作单元，事务具备 ACID 的特性，即原子性、一致性、隔离性和持久性。<br> 本地事务：本地事务由本地资源管理器（例如 MySQL、Oracle 等）管理，严格地支持 ACID 特性，高效可靠。本地事务不具备分布式事务的处理能力，只能对自己数据库的操作进行控制，对于其他数据库的操作则无能为力。<br> 全局事务：全局事务指的是一次性操作多个资源管理器完成的事务，由一组分支事务组成。<br> 分支事务：在分布式事务中，就是一个个受全局事务管辖和协调的本地事务。</p> 
<h3><a id="3Seata_19"></a>3.Seata核心组件</h3> 
<p>(1)TC（Transaction Coordinator）：事务协调器，它是事务的协调者（这里指的是 Seata 服务器），主要负责维护全局事务和分支事务的状态，驱动全局事务提交或回滚。<br> (2)TM（Transaction Manager）：事务管理器，它是事务的发起者，负责定义全局事务的范围，并根据 TC 维护的全局事务和分支事务状态，做出开始事务、提交事务、回滚事务的决议。<br> (3)RM（Resource Manager）：资源管理器，它是资源的管理者（这里可以将其理解为各服务使用的数据库）。它负责管理分支事务上的资源，向 TC 注册分支事务，汇报分支事务状态，驱动分支事务的提交或回滚。</p> 
<h3><a id="4Seata__25"></a>4.Seata 工作流程</h3> 
<p>Seata 对分布式事务的协调和控制，主要是通过 XID 和 3 个核心组件实现的。<br> XID:是全局事务的唯一标识，它可以在服务的调用链路中传递，绑定到服务的事务上下文中<br> 工作流程：<br> (1)TM 向 TC 申请开启一个全局事务，全局事务创建成功后，TC 会针对这个全局事务生成一个全局唯一的 XID；<br> (2)XID 通过服务的调用链传递到其他服务;<br> (3)RM 向 TC 注册一个分支事务，并将其纳入 XID 对应全局事务的管辖；<br> (4)TM 根据 TC 收集的各个分支事务的执行结果，向 TC 发起全局事务提交或回滚决议；<br> (5)TC 调度 XID 下管辖的所有分支事务完成提交或回滚操作。</p> 
<p>概况一下就是每个分支事务都会有一个XID,全局事务会通过TC调度将所有XID相同的分支事务提交或者回滚。</p> 
<h3><a id="5Seata_38"></a>5.Seata四大模式</h3> 
<p>四大模式分别是AT、TCC、SAGA 和 XA</p> 
<p>5.1 AT模式(最常用、无业务入侵)<br> (1)使用前提：<br> ①必须使用支持本地 ACID 事务特性的关系型数据库，例如 MySQL、Oracle 等；<br> ②应用程序必须是使用 JDBC 对数据库进行访问的 JAVA 应用。<br> ③创建一个 UNDO_LOG（回滚日志）表。（不同数据库建表语句不同，这里以mysql为例）<br> CREATE TABLE <code>undo_log</code> (<br> <code>id</code> bigint(20) NOT NULL AUTO_INCREMENT,<br> <code>branch_id</code> bigint(20) NOT NULL,<br> <code>xid</code> varchar(100) NOT NULL,<br> <code>context</code> varchar(128) NOT NULL,<br> <code>rollback_info</code> longblob NOT NULL,<br> <code>log_status</code> int(11) NOT NULL,<br> <code>log_created</code> datetime NOT NULL,<br> <code>log_modified</code> datetime NOT NULL,<br> PRIMARY KEY (<code>id</code>),<br> UNIQUE KEY <code>ux_undo_log</code> (<code>xid</code>,<code>branch_id</code>)<br> ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</p> 
<p>在后面提到的回滚日志中可以知道各个字段的作用</p> 
<p>(2)AT模式的实现流程：<br> ①获取 SQL 的基本信息，生成回滚日志，插入到 UNDO_LOG 表中，示例回滚日志如下。</p> 
<pre><code class="prism language-sql">{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.undo.BranchUndoLog"</span><span class="token punctuation">,</span>
<span class="token string">"xid"</span>:<span class="token string">"2.0.1.47:8091:5791972543984050625"</span><span class="token punctuation">,</span>
<span class="token string">"branchId"</span>:<span class="token number">5791972543984050628</span><span class="token punctuation">,</span>
<span class="token string">"sqlUndoLogs"</span>:<span class="token punctuation">[</span><span class="token string">"java.util.ArrayList"</span><span class="token punctuation">,</span><span class="token punctuation">[</span>{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.undo.SQLUndoLog"</span><span class="token punctuation">,</span><span class="token string">"sqlType"</span>:<span class="token string">"INSERT"</span><span class="token punctuation">,</span><span class="token string">"tableName"</span>:<span class="token string">"t00_user"</span><span class="token punctuation">,</span>
<span class="token string">"beforeImage"</span>:{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.sql.struct.TableRecords$EmptyTableRecords"</span><span class="token punctuation">,</span><span class="token string">"tableName"</span>:<span class="token string">"t00_user"</span><span class="token punctuation">,</span><span class="token string">"rows"</span>:<span class="token punctuation">[</span><span class="token string">"java.util.ArrayList"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span>}<span class="token punctuation">,</span>
<span class="token string">"afterImage"</span>:{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.sql.struct.TableRecords"</span><span class="token punctuation">,</span><span class="token string">"tableName"</span>:<span class="token string">"t00_user"</span><span class="token punctuation">,</span><span class="token string">"rows"</span>:<span class="token punctuation">[</span><span class="token string">"java.util.ArrayList"</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.sql.struct.Row"</span><span class="token punctuation">,</span>
<span class="token string">"fields"</span>:<span class="token punctuation">[</span><span class="token string">"java.util.ArrayList"</span><span class="token punctuation">[</span>{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.sql.struct.Field"</span><span class="token punctuation">,</span><span class="token string">"name"</span>:<span class="token string">"user_id"</span><span class="token punctuation">,</span><span class="token string">"keyType"</span>:<span class="token string">"PRIMARY_KEY"</span><span class="token punctuation">,</span><span class="token string">"type"</span>:<span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"value"</span>:<span class="token string">"338"</span>}<span class="token punctuation">,</span>{<!-- --><span class="token string">"@class"</span>:<span class="token string">"io.seata.rm.datasource.sql.struct.Field"</span><span class="token punctuation">,</span><span class="token string">"name"</span>:<span class="token string">"user_name"</span><span class="token punctuation">,</span><span class="token string">"keyType"</span>:<span class="token string">"NULL"</span><span class="token punctuation">,</span><span class="token string">"type"</span>:<span class="token number">12</span><span class="token punctuation">,</span><span class="token string">"value"</span>:<span class="token string">"灏忕帇"</span>}<span class="token punctuation">]</span><span class="token punctuation">]</span>}<span class="token punctuation">]</span><span class="token punctuation">]</span>}}<span class="token punctuation">]</span><span class="token punctuation">]</span>}
</code></pre> 
<p>②注册所有分支事务，生成行锁<br> ③提交或回滚<br> 提交：若所有分支事务都执行成功，TM 向 TC 发起全局事务的提交，并批量删除各个 RM 保存的 UNDO_LOG 记录和行锁，否则全局事务回滚；<br> 回滚：<br> a.通过 XID 和分支事务 ID（Branch ID） 查找所有的 UNDO_LOG 记录;<br> b.数据校验：将 UNDO_LOG 中的后镜像数据（afterImage）与当前数据进行比较，如果有不同，则说明数据被当前全局事务之外的动作所修改，需要人工对这些数据进行处理;<br> c.生成回滚语句：根据 UNDO_LOG 中的前镜像（beforeImage）和业务 SQL 的相关信息生成回滚语句;<br> d.还原数据：执行回滚语句，并将前镜像数据、后镜像数据以及行锁删除;<br> e.提交事务：提交本地事务，并把本地事务的执行结果（即分支事务回滚的结果）上报给 TC。</p> 
<h3><a id="Seata_86"></a>二、Seata实战教程</h3> 
<h3><a id="1_88"></a>1.下载资源</h3> 
<p>下载seata-server-XXX.zip和Srouce code<br> https://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.zip<br> https://github.com/seata/seata/archive/refs/tags/v1.4.2.zip</p> 
<h3><a id="2SeataServer_94"></a>2.配置Seata-Server</h3> 
<p>(1)将seata-1.4.2\script\config-center\config.txt 复制到 seata-server-1.4.2\ 目录下<br> 替换下面几行：<br> service.vgroupMapping.tx_service_default_group=default<br> store.mode=db<br> store.db.driverClassName=com.mysql.cj.jdbc.Driver<br> store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true<br> store.db.user=root<br> store.db.password=root</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">transport.type</span><span class="token operator">=</span>TCP
<span class="token assign-left variable">transport.server</span><span class="token operator">=</span>NIO
<span class="token assign-left variable">transport.heartbeat</span><span class="token operator">=</span>true
<span class="token assign-left variable">transport.enableClientBatchSendRequest</span><span class="token operator">=</span>false
<span class="token assign-left variable">transport.threadFactory.bossThreadPrefix</span><span class="token operator">=</span>NettyBoss
<span class="token assign-left variable">transport.threadFactory.workerThreadPrefix</span><span class="token operator">=</span>NettyServerNIOWorker
<span class="token assign-left variable">transport.threadFactory.serverExecutorThreadPrefix</span><span class="token operator">=</span>NettyServerBizHandler
<span class="token assign-left variable">transport.threadFactory.shareBossWorker</span><span class="token operator">=</span>false
<span class="token assign-left variable">transport.threadFactory.clientSelectorThreadPrefix</span><span class="token operator">=</span>NettyClientSelector
<span class="token assign-left variable">transport.threadFactory.clientSelectorThreadSize</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">transport.threadFactory.clientWorkerThreadPrefix</span><span class="token operator">=</span>NettyClientWorkerThread
<span class="token assign-left variable">transport.threadFactory.bossThreadSize</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">transport.threadFactory.workerThreadSize</span><span class="token operator">=</span>default
<span class="token assign-left variable">transport.shutdown.wait</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token assign-left variable">service.vgroupMapping.tx_service_default_group</span><span class="token operator">=</span>default
<span class="token assign-left variable">service.default.grouplist</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:8091
<span class="token assign-left variable">service.enableDegrade</span><span class="token operator">=</span>false
<span class="token assign-left variable">service.disableGlobalTransaction</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.rm.asyncCommitBufferLimit</span><span class="token operator">=</span><span class="token number">10000</span>
<span class="token assign-left variable">client.rm.lock.retryInterval</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">client.rm.lock.retryTimes</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token assign-left variable">client.rm.lock.retryPolicyBranchRollbackOnConflict</span><span class="token operator">=</span>true
<span class="token assign-left variable">client.rm.reportRetryCount</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">client.rm.tableMetaCheckEnable</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.rm.tableMetaCheckerInterval</span><span class="token operator">=</span><span class="token number">60000</span>
<span class="token assign-left variable">client.rm.sqlParserType</span><span class="token operator">=</span>druid
<span class="token assign-left variable">client.rm.reportSuccessEnable</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.rm.sagaBranchRegisterEnable</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.tm.commitRetryCount</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">client.tm.rollbackRetryCount</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">client.tm.defaultGlobalTransactionTimeout</span><span class="token operator">=</span><span class="token number">60000</span>
<span class="token assign-left variable">client.tm.degradeCheck</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.tm.degradeCheckAllowTimes</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">client.tm.degradeCheckPeriod</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token assign-left variable">store.mode</span><span class="token operator">=</span>db
<span class="token assign-left variable">store.publicKey</span><span class="token operator">=</span>
<span class="token assign-left variable">store.file.dir</span><span class="token operator">=</span>file_store/data
<span class="token assign-left variable">store.file.maxBranchSessionSize</span><span class="token operator">=</span><span class="token number">16384</span>
<span class="token assign-left variable">store.file.maxGlobalSessionSize</span><span class="token operator">=</span><span class="token number">512</span>
<span class="token assign-left variable">store.file.fileWriteBufferCacheSize</span><span class="token operator">=</span><span class="token number">16384</span>
<span class="token assign-left variable">store.file.flushDiskMode</span><span class="token operator">=</span>async
<span class="token assign-left variable">store.file.sessionReloadReadSize</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">store.db.datasource</span><span class="token operator">=</span>druid
<span class="token assign-left variable">store.db.dbType</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">store.db.driverClassName</span><span class="token operator">=</span>com.mysql.cj.jdbc.Driver
<span class="token assign-left variable">store.db.url</span><span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/seata?useUnicode<span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">rewriteBatchedStatements</span><span class="token operator">=</span>true
<span class="token assign-left variable">store.db.user</span><span class="token operator">=</span>root
<span class="token assign-left variable">store.db.password</span><span class="token operator">=</span>root
<span class="token assign-left variable">store.db.minConn</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">store.db.maxConn</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token assign-left variable">store.db.globalTable</span><span class="token operator">=</span>global_table
<span class="token assign-left variable">store.db.branchTable</span><span class="token operator">=</span>branch_table
<span class="token assign-left variable">store.db.queryLimit</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">store.db.lockTable</span><span class="token operator">=</span>lock_table
<span class="token assign-left variable">store.db.maxWait</span><span class="token operator">=</span><span class="token number">5000</span>
<span class="token assign-left variable">store.redis.mode</span><span class="token operator">=</span>single
<span class="token assign-left variable">store.redis.single.host</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">store.redis.single.port</span><span class="token operator">=</span><span class="token number">6379</span>
<span class="token assign-left variable">store.redis.sentinel.masterName</span><span class="token operator">=</span>
<span class="token assign-left variable">store.redis.sentinel.sentinelHosts</span><span class="token operator">=</span>
<span class="token assign-left variable">store.redis.maxConn</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">store.redis.minConn</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">store.redis.maxTotal</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">store.redis.database</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">store.redis.password</span><span class="token operator">=</span>
<span class="token assign-left variable">store.redis.queryLimit</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">server.recovery.committingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token assign-left variable">server.recovery.asynCommittingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token assign-left variable">server.recovery.rollbackingRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token assign-left variable">server.recovery.timeoutRetryPeriod</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token assign-left variable">server.maxCommitRetryTimeout</span><span class="token operator">=</span>-1
<span class="token assign-left variable">server.maxRollbackRetryTimeout</span><span class="token operator">=</span>-1
<span class="token assign-left variable">server.rollbackRetryTimeoutUnlockEnable</span><span class="token operator">=</span>false
<span class="token assign-left variable">client.undo.dataValidation</span><span class="token operator">=</span>true
<span class="token assign-left variable">client.undo.logSerialization</span><span class="token operator">=</span>jackson
<span class="token assign-left variable">client.undo.onlyCareUpdateColumns</span><span class="token operator">=</span>true
<span class="token assign-left variable">server.undo.logSaveDays</span><span class="token operator">=</span><span class="token number">7</span>
<span class="token assign-left variable">server.undo.logDeletePeriod</span><span class="token operator">=</span><span class="token number">86400000</span>
<span class="token assign-left variable">client.undo.logTable</span><span class="token operator">=</span>undo_log
<span class="token assign-left variable">client.undo.compress.enable</span><span class="token operator">=</span>true
<span class="token assign-left variable">client.undo.compress.type</span><span class="token operator">=</span>zip
<span class="token assign-left variable">client.undo.compress.threshold</span><span class="token operator">=</span>64k
<span class="token assign-left variable">log.exceptionRate</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">transport.serialization</span><span class="token operator">=</span>seata
<span class="token assign-left variable">transport.compressor</span><span class="token operator">=</span>none
<span class="token assign-left variable">metrics.enabled</span><span class="token operator">=</span>false
<span class="token assign-left variable">metrics.registryType</span><span class="token operator">=</span>compact
<span class="token assign-left variable">metrics.exporterList</span><span class="token operator">=</span>prometheus
<span class="token assign-left variable">metrics.exporterPrometheusPort</span><span class="token operator">=</span><span class="token number">9898</span>

</code></pre> 
<p>(2)将seata-1.4.2\script\config-center\nacos下文件复制到 seata-server-1.4.2\bin目录下<br> (3)修改seata-server-1.4.2\conf\file.conf</p> 
<pre><code class="prism language-bash"><span class="token comment">## transaction log store, only used in seata-server</span>
store <span class="token punctuation">{<!-- --></span>
  <span class="token comment">## store mode: file、db、redis</span>
  mode <span class="token operator">=</span> <span class="token string">"db"</span>
  <span class="token comment">## rsa decryption public key</span>
  publicKey <span class="token operator">=</span> <span class="token string">""</span>
  <span class="token comment">## file store property</span>
  <span class="token function">file</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">## store location dir</span>
    <span class="token function">dir</span> <span class="token operator">=</span> <span class="token string">"sessionStore"</span>
    <span class="token comment"># branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span>
    maxBranchSessionSize <span class="token operator">=</span> <span class="token number">16384</span>
    <span class="token comment"># globe session size , if exceeded throws exceptions</span>
    maxGlobalSessionSize <span class="token operator">=</span> <span class="token number">512</span>
    <span class="token comment"># file buffer size , if exceeded allocate new buffer</span>
    fileWriteBufferCacheSize <span class="token operator">=</span> <span class="token number">16384</span>
    <span class="token comment"># when recover batch read size</span>
    sessionReloadReadSize <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token comment"># async, sync</span>
    flushDiskMode <span class="token operator">=</span> async
  <span class="token punctuation">}</span>

  <span class="token comment">## database store property</span>
  db <span class="token punctuation">{<!-- --></span>
    <span class="token comment">## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.</span>
    datasource <span class="token operator">=</span> <span class="token string">"druid"</span>
    <span class="token comment">## mysql/oracle/postgresql/h2/oceanbase etc.</span>
    dbType <span class="token operator">=</span> <span class="token string">"mysql"</span>
    driverClassName <span class="token operator">=</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span>
    <span class="token comment">## if using mysql to store the data, recommend add rewriteBatchedStatements=true in jdbc connection param</span>
    url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://127.0.0.1:3306/seata?rewriteBatchedStatements=true&amp;serverTimezone=Asia/Shanghai"</span>
    user <span class="token operator">=</span> <span class="token string">"root"</span>
    password <span class="token operator">=</span> <span class="token string">"root"</span>
    minConn <span class="token operator">=</span> <span class="token number">5</span>
    maxConn <span class="token operator">=</span> <span class="token number">100</span>
    globalTable <span class="token operator">=</span> <span class="token string">"global_table"</span>
    branchTable <span class="token operator">=</span> <span class="token string">"branch_table"</span>
    lockTable <span class="token operator">=</span> <span class="token string">"lock_table"</span>
    queryLimit <span class="token operator">=</span> <span class="token number">100</span>
    maxWait <span class="token operator">=</span> <span class="token number">5000</span>
  <span class="token punctuation">}</span>

  <span class="token comment">## redis store property</span>
  redis <span class="token punctuation">{<!-- --></span>
    <span class="token comment">## redis mode: single、sentinel</span>
    mode <span class="token operator">=</span> <span class="token string">"single"</span>
    <span class="token comment">## single mode property</span>
    single <span class="token punctuation">{<!-- --></span>
      <span class="token function">host</span> <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
      port <span class="token operator">=</span> <span class="token string">"6379"</span>
    <span class="token punctuation">}</span>
    <span class="token comment">## sentinel mode property</span>
    sentinel <span class="token punctuation">{<!-- --></span>
      masterName <span class="token operator">=</span> <span class="token string">""</span>
      <span class="token comment">## such as "10.28.235.65:26379,10.28.235.65:26380,10.28.235.65:26381"</span>
      sentinelHosts <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
    password <span class="token operator">=</span> <span class="token string">""</span>
    database <span class="token operator">=</span> <span class="token string">"0"</span>
    minConn <span class="token operator">=</span> <span class="token number">1</span>
    maxConn <span class="token operator">=</span> <span class="token number">10</span>
    maxTotal <span class="token operator">=</span> <span class="token number">100</span>
    queryLimit <span class="token operator">=</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>(4)修改seata-server-1.4.2\conf\register.conf</p> 
<pre><code class="prism language-bash">registry <span class="token punctuation">{<!-- --></span>
  <span class="token comment"># file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span>
  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"nacos"</span>

  nacos <span class="token punctuation">{<!-- --></span>
    application <span class="token operator">=</span> <span class="token string">"seata-server"</span>
    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span>
    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span>
    namespace <span class="token operator">=</span> <span class="token string">""</span>
    cluster <span class="token operator">=</span> <span class="token string">"default"</span>
    username <span class="token operator">=</span> <span class="token string">"nacos"</span>
    password <span class="token operator">=</span> <span class="token string">"nacos"</span>
  <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>

config <span class="token punctuation">{<!-- --></span>
  <span class="token comment"># file、nacos 、apollo、zk、consul、etcd3</span>
  <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">"file"</span>

  nacos <span class="token punctuation">{<!-- --></span>
    serverAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:8848"</span>
    namespace <span class="token operator">=</span> <span class="token string">""</span>
    group <span class="token operator">=</span> <span class="token string">"SEATA_GROUP"</span>
    username <span class="token operator">=</span> <span class="token string">""</span>
    password <span class="token operator">=</span> <span class="token string">""</span>
    dataId <span class="token operator">=</span> <span class="token string">"seataServer.properties"</span>
  <span class="token punctuation">}</span>

  <span class="token function">file</span> <span class="token punctuation">{<!-- --></span>
    name <span class="token operator">=</span> <span class="token string">"file.conf"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>(5)启动nacos,运行seata-server.bat</p> 
<h3><a id="3_306"></a>3.增加相关表结构</h3> 
<p>其中t00_user是测试用的表结构</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">longblob</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
<span class="token comment">--全局事务表--</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span>
    <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>
 
<span class="token comment">-- 分支表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span>
    <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>
 
<span class="token comment">-- 锁定表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span>
    <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>
 
<span class="token comment">--seata新版本加的锁表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span>       <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>lock_value<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>expire<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>lock_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span>
    <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'AsyncCommitting'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'RetryCommitting'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'RetryRollbacking'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>distributed_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> lock_value<span class="token punctuation">,</span> expire<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'TxTimeoutCheck'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t00_user<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="4_399"></a>4.代码配置</h3> 
<p>我这里没有使用多个服务，简单的使用了单个服务看回滚能不能成功。<br> 项目结构如下：<br> <img src="https://images2.imgbox.com/e5/04/G7uFwCFE_o.png" alt="在这里插入图片描述"></p> 
<p>(1)pom.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--  seata依赖 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

       <span class="token comment">&lt;!-- &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
        &lt;/dependency&gt;--&gt;</span>

        <span class="token comment">&lt;!--mysql数据库驱动--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.31<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--mybatis--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>(2)bootstrap.yml</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment">#允许循环依赖</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span>
    <span class="token key atrule">allow-circular-references</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>service
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token comment">#不加allowPublicKeyRetrieval=true会报SQLNonTransientConnectionException</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/seata<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;rewriteBatchedStatements=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">application-id</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> tx_service_default_group
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span>
      <span class="token key atrule">tx_service_default_group</span><span class="token punctuation">:</span> default



<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token comment">#扫描mapper文件，Mapper文件一般放到resource下，如果放在java目录下，需要在pom文件的bulid标签下将.xml放到include下</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapping/<span class="token important">*Mapper.xml</span>

</code></pre> 
<p>(3)测试的相关代码<br> SeataController .java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/test"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Sentinel server"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/getUser"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/addUser"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        userService<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



<span class="token punctuation">}</span>





</code></pre> 
<p>UserDAO.java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDAO</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>User.java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> user_id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> user_name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> user_id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUser_id</span><span class="token punctuation">(</span><span class="token class-name">String</span> user_id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token operator">=</span> user_id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUser_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> user_name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUser_name</span><span class="token punctuation">(</span><span class="token class-name">String</span> user_name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user_name <span class="token operator">=</span> user_name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> user_id<span class="token punctuation">,</span> <span class="token class-name">String</span> user_name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token operator">=</span> user_id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>user_name <span class="token operator">=</span> user_name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>UserServiceImpl.java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserDAO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GlobalTransactional</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"338"</span><span class="token punctuation">,</span><span class="token string">"小王"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"339"</span><span class="token punctuation">,</span><span class="token string">"大力"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"339"</span><span class="token punctuation">,</span><span class="token string">"小毛"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDAO<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userDAO<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//加这一行是为了看undo_log，因为异常之后事务结束，undo_log会被删除</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        userDAO<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>UserService .java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>SeataApplication.java</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>seata</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span> <span class="token string">"com.example.seata.dao"</span><span class="token punctuation">)</span><span class="token comment">//使用MapperScan批量扫描所有的Mapper接口；</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        args <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>args<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"--spring.cloud.bootstrap.enabled=true"</span><span class="token punctuation">;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SeataApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>UserMapper.xml</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.seata.dao.UserDAO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.seata.entity.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * FROM t00_user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.seata.entity.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        INSERT INTO t00_user (user_id, user_name)
                        VALUES (
                           #{user_id,jdbcType=VARCHAR}, #{user_name,jdbcType=VARCHAR}
                      )
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>(4)启动项目<br> 进入http://localhost:8080/addUser<br> 发现报错，并且数据没有增加一条<br> 如果将UserServiceImpl中的@GlobalTransactional(rollbackFor = Exception.class)去掉，会发现数据新增了两条。<br> 说明注解使用成功，回归成功了<br> 我这里为了看undo_log,在代码抛出异常前加上了Sleep5秒的操作，在这五秒内可以看到undo_log的情况<br> <img src="https://images2.imgbox.com/9f/40/ZDn9Z4l2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_686"></a>三、常见报错解决</h3> 
<p>1.Failed to get available servers: endpoint format should like ip:port<br> config.txt的service.vgroupMapping.tx_service_default_group=default中tx_service_default_group<br> 与yml中的tx_service_default_group要一致<br> 2.seata启动闪退/报错<br> 修改seata-server.bat,这样就能看到报错信息了<br> if “%FORCE_EXIT_ON_ERROR%” == “on” (<br> if %ERROR_CODE% NEQ 0 exit %ERROR_CODE%<br> )<br> cmd<br> exit /B %ERROR_CODE%<br> 3.数据库连接不上<br> mysql5.+使用 driverClassName = “com.mysql.jdbc.Driver”<br> mysql8使用 driverClassName = “com.mysql.cj.jdbc.Driver”</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ea7ec2b2b0a34adbcb6bc4608f9df35b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">阿里内部热捧“Spring全线笔记”，不止是全家桶，太完整了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/620a8753db36d9e8557faf7aa5777191/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">51单片机DS18B20温度传感器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>