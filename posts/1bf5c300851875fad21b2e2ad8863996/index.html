<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>最实用的Modelsim初级使用教程 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="最实用的Modelsim初级使用教程" />
<meta property="og:description" content="今天给大侠带来最实用的Modelsim初级使用教程，话不多说，上货。
一、 Modelsim简介 Modelsim仿真工具是Model公司开发的。它支持Verilog、VHDL以及他们的混合仿真，它可以将整个程序分步执行，使设计者直接看到他的程序下一步要执行的语句，而且在程序执行的任何步骤任何时刻都可以查看任意变量的当前值，可以在Dataflow窗口查看某一单元或模块的输入输出的连续变化等，比quartus自带的仿真器功能强大的多，是目前业界最通用的仿真器之一。
对于初学者，modelsim自带的教程是一个很好的选择，在Help-&gt;SE PDF Documentation-&gt;Tutorial里面.它从简单到复杂、从低级到高级详细地讲述了modelsim的各项功能的使用，简单易懂。但是它也有缺点，就是它里面所有事例的初期准备工作都已经放在example文件夹里，直接将它们添加到modelsim就可以用，它假设使用者对当前操作的前期准备工作都已经很熟悉，所以初学者往往不知道如何做当前操作的前期准备。
二、 安装 同许多其他软件一样，Modelsim SE 同样需要合法的License,通常我们用Kengen产生license.dat。
1、解压安装工具包开始安装，安装时选择Full product安装。当出现Install Hardware Security Key Driver时选择否。当出现Add Modelsim To Path选择是。出现Modelsim License Wizard时选择Close。
2、在C盘根目录新建一个文件夹flexlm，用Keygen产生一个License.dat,然后复制到该文件夹下。若License通过，但是打开ModelSim仍出错，则将系统时间调到2008年之前，重新生成License，再将时间调回来即可。
3、修改系统的环境变量。右键点击桌面我的电脑图标，属性-&gt;高级-&gt;环境变量-&gt;（系统变量）新建。按下图所示内容填写，变量值内如果已经有别的路径了，请用&#34;;&#34;将其与要填的路径分开。LM_LICENSE_FILE = c:\flexlm\license.dat
4、安装完毕，可以运行。
注意：
1、电脑的用户名不能为中文； 2、安装路径不能出现中文和空格，只能有数字、英文字母和下划线&#34;_&#34;组成 3、若计算机还需要使用ModelSim-Altera 6.4a (Quartus II 9.0)，可不需做任何额外的设定，ModelSim SE 6.3g会自动抓到这个系统变量，并使用这个license file；反之亦然。
图1 设置modelsim所需环境变量（用户）
关联 Quartus II 和 modelsim 操作
① 完成上述工作之后需要在 Quartus II 中设置 modelsim 路径，Quartus II 菜单Tools ——&gt;General——&gt;EDA Tool Options，进行相关设置，如modelsim：C:\Modeltech_6.3g\win32 如图2所示。
图2 设置modelsim路径
② 在Quartus II建立工程时，设置 modelsim 作为仿真软件，或者是在Assignments——&gt;EDA Tool Settings进行设置。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1bf5c300851875fad21b2e2ad8863996/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-29T18:54:19+08:00" />
<meta property="article:modified_time" content="2020-05-29T18:54:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">最实用的Modelsim初级使用教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>今天给大侠带来最实用的Modelsim初级使用教程，话不多说，上货。</p> 
<p><img alt="" src="https://images2.imgbox.com/c9/7d/fr8jCxZN_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/85/a3/j0x27Vc3_o.png"></p> 
<p> </p> 
<h2><strong>一、 Modelsim简介</strong></h2> 
<p>Modelsim仿真工具是Model公司开发的。它支持Verilog、VHDL以及他们的混合仿真，它可以将整个程序分步执行，使设计者直接看到他的程序下一步要执行的语句，而且在程序执行的任何步骤任何时刻都可以查看任意变量的当前值，可以在Dataflow窗口查看某一单元或模块的输入输出的连续变化等，比quartus自带的仿真器功能强大的多，是目前业界最通用的仿真器之一。</p> 
<p>对于初学者，modelsim自带的教程是一个很好的选择，在Help-&gt;SE PDF Documentation-&gt;Tutorial里面.它从简单到复杂、从低级到高级详细地讲述了modelsim的各项功能的使用，简单易懂。但是它也有缺点，就是它里面所有事例的初期准备工作都已经放在example文件夹里，直接将它们添加到modelsim就可以用，它假设使用者对当前操作的前期准备工作都已经很熟悉，所以初学者往往不知道如何做当前操作的前期准备。</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/f7/c4/Y6jXKvn3_o.png"></p> 
<p> </p> 
<h2><strong>二、 安装</strong></h2> 
<p>同许多其他软件一样，Modelsim SE 同样需要合法的License,通常我们用Kengen产生license.dat。</p> 
<p>1、解压安装工具包开始安装，安装时选择Full product安装。当出现Install Hardware Security Key Driver时选择否。当出现Add Modelsim To Path选择是。出现Modelsim License Wizard时选择Close。</p> 
<p>2、在C盘根目录新建一个文件夹flexlm，用Keygen产生一个License.dat,然后复制到该文件夹下。若License通过，但是打开ModelSim仍出错，则将系统时间调到2008年之前，重新生成License，再将时间调回来即可。</p> 
<p>3、修改系统的环境变量。右键点击桌面我的电脑图标，属性-&gt;高级-&gt;环境变量-&gt;（系统变量）新建。按下图所示内容填写，变量值内如果已经有别的路径了，请用";"将其与要填的路径分开。LM_LICENSE_FILE = c:\flexlm\license.dat</p> 
<p>4、安装完毕，可以运行。</p> 
<p> </p> 
<p><strong>注意：</strong></p> 
<p>1、电脑的用户名不能为中文；       </p> 
<p>2、安装路径不能出现中文和空格，只能有数字、英文字母和下划线"_"组成      </p> 
<p>3、若计算机还需要使用ModelSim-Altera 6.4a (Quartus II 9.0)，可不需做任何额外的设定，ModelSim SE 6.3g会自动抓到这个系统变量，并使用这个license file；反之亦然。</p> 
<p><img alt="" src="https://images2.imgbox.com/2a/a9/68iJHCCW_o.png"></p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/25/fe/JCHaOlKW_o.png"></p> 
<p><strong>图1 设置modelsim所需环境变量（用户）</strong></p> 
<p> </p> 
<p><strong><strong>关联 </strong>Quartus II 和 modelsim 操作</strong></p> 
<p>①  完成上述工作之后需要在 Quartus II 中设置 modelsim 路径，Quartus II 菜单Tools ——&gt;General——&gt;EDA Tool Options，进行相关设置，如modelsim：C:\Modeltech_6.3g\win32  如图2所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/8b/43/SDLlM5nP_o.png"></p> 
<p><strong>图2 设置modelsim路径</strong></p> 
<p> </p> 
<p>② 在Quartus II建立工程时，设置 modelsim 作为仿真软件，或者是在Assignments——&gt;EDA Tool Settings进行设置。</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/f0/3f/6jfi95iq_o.png"></p> 
<h2><strong>三、 Modelsim仿真方法</strong></h2> 
<p>Modelsim的仿真分为前仿真和后仿真，下面先具体介绍一下两者的区别。</p> 
<h3><strong>3.1 前仿真</strong></h3> 
<p>前仿真也称为功能仿真，主旨在于验证电路的功能是否符合设计要求，其特点是不考虑电路门延迟与线延迟，主要是验证电路与理想情况是否一致。可综合FPGA代码是用RTL级代码语言描述的，其输入为RTL级代码与Testbench。</p> 
<p> </p> 
<h3><strong>3.2 后仿真</strong></h3> 
<p>后仿真也称为时序仿真或者布局布线后仿真，是指电路已经映射到特定的工艺环境以后，综合考虑电路的路径延迟与门延迟的影响，验证电路能否在一定时序条件下满足设计构想的过程，是否存在时序违规。其输入文件为从布局布线结果中抽象出来的门级网表、Testbench和扩展名为SDO或SDF的标准时延文件。SDO或SDF的标准时延文件不仅包含门延迟，还包括实际布线延迟，能较好地反映芯片的实际工作情况。一般来说后仿真是必选的，检查设计时序与实际的FPGA运行情况是否一致，确保设计的可靠性和稳定性。选定了器件分配引脚后在做后仿真。</p> 
<p> </p> 
<h3><strong>3.3 Modelsim仿真的基本步骤</strong></h3> 
<p>Modelsim的仿真主要有以下几个步骤：</p> 
<p>(1)建立库并映射库到物理目录；</p> 
<p>(2)编译原代码（包括 Testbench）；</p> 
<p>(3)执行仿真。</p> 
<p>上述3个步骤是大的框架，前仿真和后仿真均是按照这个框架进行的，建立modelsim工程对前后仿真来说都不是必须的。</p> 
<h4><strong>3.3.1建立库</strong></h4> 
<p>在执行一个仿真前先建立一个单独的文件夹，后面的操作都在此文件下进行，以防止文件间的误操作。然后启动Modelsim将当前路径修改到该文件夹下，修改的方法是点File-&gt;Change Directory选择刚刚新建的文件夹见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/39/4a/JUPHrcpa_o.png"></p> 
<p><strong>图3 新建文件夹</strong></p> 
<p> </p> 
<p>做前仿真的时候，推荐按上述建立新的文件夹。</p> 
<p>做后仿真的时候，在 Quartus II 工程文件夹下会出现一个文件夹：工程文件夹\simulation\modelsim，前提是正确编译 Quartus II 工程；因此，不必再建立新的文件夹了。</p> 
<p>仿真库是存储已编译设计单元的目录，modelsim 中有两类仿真库，一种是工作库，默认的库名为work,另一种是资源库。Work库下包含当前工程下所有已经编译过的文件。所以编译前一定要建一个work库，而且只能建一个work库。资源库存放work库中已经编译文件所要调用的资源，这样的资源可能有很多，它们被放在不同的资源库内。例如想要对综合在cyclone芯片中的设计做后仿真，就需要有一个名为cyclone_ver的资源库。</p> 
<p>映射库用于将已经预编译好的文件所在的目录映射为一个modelsim可识别的库，库内的文件应该是已经编译过的，在Workspace窗口内展开该库应该能看见这些文件，如果是没有编译过的文件在库内是看不见的。 </p> 
<p>建立仿真库的方法有两种。一种是在用户界面模式下，点File-&gt;New-&gt;Library出现下面的对话框，选择a new library and a logical mapping to it,在Library Name内输入要创建库的名称，然后OK，即可生成一个已经映射的新库。另一种方法是在Transcript窗口输入以下命令：</p> 
<p>vlib work</p> 
<p>vmap work work</p> 
<p><img alt="" src="https://images2.imgbox.com/2d/38/S1nhUY2k_o.png"></p> 
<p><strong>图4 建立仿真库</strong></p> 
<p> </p> 
<p>如果要删除某库，只需选中该库名，点右键选择Delete即可。</p> 
<p>需要注意的是不要在modelsim外部的系统盘内手动创建库或者添加文件到库里；也不要modelsim用到的路径名或文件名中使用汉字，因为modelsim可能无法识别汉字而导致莫名其妙的错误。</p> 
<h4><strong>3.3.2编写与编译测试文件</strong></h4> 
<p>在编写Testbench之前，最好先将要仿真的目标文件编译到工作库中，点Compile-&gt;Compile或 ，将出现下面的对话框。</p> 
<p><img alt="" src="https://images2.imgbox.com/71/48/BYmAESXC_o.png"></p> 
<p><strong>图5 编译目标文件</strong></p> 
<p> </p> 
<p>在Library中选择工作库，在查找范围内找到要仿真的目标文件(Library选择刚才建立的库，查找范围选择目标文件所在的文件夹)，然后点Compile和Done；或在命令行输入vlog Counter.v。此时目标文件已经编译到工作库中，在Library中展开work工作库会发现该文件。  </p> 
<p>当对要仿真的目标文件进行仿真时需要给文件中的各个输入变量提供激励源，并对输入波形进行的严格定义，这种对激励源定义的文件称为Testbench，即测试台文件。下面先讲一下Testbench的产生方法。</p> 
<p><strong>方法一：</strong>我们可以在modelsim内直接编写Testbench，而且modelsim还提供了常用的各种模板。具体步骤如下：</p> 
<p>⑴ 执行File-&gt;New-&gt;Source-&gt;verilog，或者直接点击工具栏上的新建图标，会出现一个verilog文档编辑页面，在此文档内设计者即可编辑测试台文件。需要说明的是在Quartus中许多不可综合的语句在此处都可以使用，而且testbench只是一个激励源产生文件，只要对输入波形进行定义以及显示一些必要信息即可，切记不要编的过于复杂，以免喧宾夺主。</p> 
<p>⑵ Modelsim提供了很多Testbench模板，我们直接拿过来用可以减少工作量。在verilog文档编辑页面的空白处右键点Show Language Templates然后会出现一个加载工程，接着你会发现在刚才的文档编辑窗口左边出现了一个Language Templates窗口，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/c9/d1/8wsopPLE_o.png"></p> 
<p><strong>图6 应用模板生成 Testbench文件</strong></p> 
<p> </p> 
<p>双击Creat Testbench会出现一个创建向导，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/dc/a3/hAyu9h2N_o.png"></p> 
<p> <strong>图7 创建向导</strong></p> 
<p> </p> 
<p>选择Specify Design Unit工作库下，work工作库下的目标文件，点Next,出现下面对话框：</p> 
<p><img alt="" src="https://images2.imgbox.com/75/0a/ATjjNWNi_o.png"></p> 
<p><strong>图8 设置Testbench向导</strong></p> 
<p> </p> 
<p>可以指定Testbench的名称以及要编译到的库等，此处我们使用默认设置直接点Finish。这时在Testbench内会出现对目标文件的各个端口的定义还有调用函数接下来，设计者可以自己往Testbench内添加内容了(有注释的为添加的内容)，然后保存为.v格式即可。按照前面的方法把Testbench文件也编译到工作库中。</p> 
<p><img alt="" src="https://images2.imgbox.com/37/a8/HVlaMnRu_o.png"></p> 
<p><strong>图9 生成及修改后的Testbench文件</strong></p> 
<p> </p> 
<p><strong>方法二：</strong>在 Quartus II 内编写并编译 Testbench ，之后将 Testbench 和目标文件放在同一个文件夹下，按照前面的方法把 Testbench 文件和目标文件都编译到工作库中之后。</p> 
<p>PS：如果在工作库中没有该文件(在Testbench文件没有端口的情况下)，则在Simulate——&gt;Start Simulate卡片中去掉优化选项，如下图所示。之后再重新编译，即可在工作库中找到该文件。 </p> 
<p><img alt="" src="https://images2.imgbox.com/49/76/NujNkgS1_o.png"></p> 
<p><strong>图10 去掉优化选项</strong></p> 
<h4> </h4> 
<h4><strong>3.3.3执行仿真</strong></h4> 
<h4>因为仿真分为前仿真和后仿真，下面分别说明如何操作。</h4> 
<p>⑴ 前仿真</p> 
<p>前仿真，相对来说是比较简单的。在上一步我们已经把需要的文件编译到工作库内了，现在我们只需点simulate-&gt;Start Simulation或快捷按钮 会出现start simulate对话框。点击Design标签选择Work库下的 Testbench 文件，然后点 OK 即可，也可以直接双击 Testbench文件Counter_tb.v，此时会出现下面的界面。</p> 
<p><img alt="" src="https://images2.imgbox.com/f6/cb/UEvEGyUQ_o.png"></p> 
<p><strong>图11 start simulate</strong></p> 
<p> </p> 
<p>在主界面中会多出来一个Objects窗口，里面显示 Testbench 里定义的所有信号引脚,在Workspace里也会多出来一个Sim标签。右键点击Counter_tb.v,选择Add-&gt;Add to Wave，如下图所示。然后将出现Wave窗口，现在就可以仿真了，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/bb/6a/qYSsIZc5_o.png"></p> 
<p><strong>图12 Wave窗口</strong></p> 
<p> </p> 
<p>窗口里面已经出现了待仿真的各个信号，点 将开始执行仿真到100ns,继续点仿真波形也将继续延伸，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/9e/26/KOL4a9LY_o.png"></p> 
<p><strong>图13 仿真波形</strong></p> 
<p> </p> 
<p>若点 ，则仿真一直执行，直到点 才停止仿真。</p> 
<p>也可以在命令行输入命令：run @1000</p> 
<p>则执行仿真到1000ns,后面的1000也可以是别的数值，设计者可以修改。在下一次运行该命令时将接着当前的波形继续往后仿真。至此，前仿真步骤完成。</p> 
<p>⑵ 后仿真</p> 
<p>这里是采用的Cyclone ii做的一个counter的例子。</p> 
<p>后仿真与前仿真的步骤大体相同，只不过中间需要添加仿真库(和所选器件及所有IP Core相关)、网表和延时文件的步骤。</p> 
<p>后仿真的前提是quartus已经对要仿真的目标文件进行编译，并生成modelsim仿真所需要的.vo文件(网表文件)和.sdo文件（时延文件），具体操作过程又有两种方法，一种是通过Quartus调用Modelsim，Quartus在编译之后自动把仿真需要的.vo文件以及需要的仿真库加到modelsim中，操作简单；一种是手动将需要的文件和库加入modelsim进行仿真，这种方法可以增加主观能动性，充分发挥modelsim的强大仿真功能。</p> 
<p>① 通过Quartus调用Modelsim</p> 
<p>使用这种方法时首先要对Quartus进行设置。先运行Quartus，打开要仿真的工程，点菜单栏的Assignments，点EDA Tool settings，选中左边Category中的Simulation.，在右边的Tool name中选ModelSim(Verilog),选中下面的Run Gate Level Simulation automatically after complication.见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/60/39/C0MWkGsT_o.png"></p> 
<p><strong>图14 对Quartus进行设置</strong></p> 
<p> </p> 
<p>Quartus中的工程准备好之后点击start complication按钮，此时modelsim会自动启动，而quartus处于等待状态（前提是系统环境变量中用户变量中PATH要设置好modelsim安装路径,如：D:\Modeltech_6.3\win32）。在打开的modelsim的Workspace窗口中你会发现多了工作库和资源库，而且work库中出现了需要仿真的文件。Modelsim自动将quartus生成的.vo文件编译到work库，并建立相应的资源库。如图所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/c5/08/EYKFXSEP_o.png"></p> 
<p><strong>图15 Quartus II 编译之后自启动modelsim</strong></p> 
<p> </p> 
<p>观察库，可以发现，多了verilog_libs库、gate_work库和work库，但是在"工程文件夹\simulation\modelsim"下，只有verilog_libs和gate_work文件夹，为什么库里面却多了一个work库呢？而且gate_work库和work库文件内容相同。</p> 
<p>gate_work 库是Quartus II 编译之后自动生成的，而work库是modelsim默认库。仔细观察二者路径，二者路径相同，均为gate_work文件夹，可知 modelsim 将 gate_work 库映射到 work 库。因此，在后续的工作中操作gate_work 库或者 work 库都能得到正确结果。</p> 
<p>编写测试台程序Counter_tb.v ，最好放在生成的.vo文件所在的目录，以方便在需要手动仿真时使用。点Compile在出现的对话框中选中Counter_tb.v文件，然后点Compile按钮,编译结束后点Done，这时在Work库中会出现测试台文件。如下图所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/0e/29/H0oJdttN_o.png"></p> 
<p><strong>图16 编译测试文件</strong></p> 
<p> </p> 
<p>点击simulate-&gt;Start Simulation或快捷按钮 会出现start simulate对话框。点击Design标签选择Work库下的Counter_tb.v文件，然后点击Libraries标签在Search Library中点击Add按钮，选择仿真所需要的资源库（如果不知道需要选择哪个库，可以先直接点Compile看出现的错误提示中说需要的库名，然后再重复上述步骤）见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/8a/9a/25TSYbRH_o.png"></p> 
<p><strong>图17 选择仿真所需要的资源库</strong></p> 
<p> </p> 
<p>再点start simulate对话框的SDF标签。在出现的对话框的SDF File框内加入.sdo时延文件路径。在Apply To Region框内有一个“/”， 在“/”的前面输入测试台文件名，即“Counter_tb”，在它的后面输入测试台程序中调用被测试程序时给被测试程序起的名称，本例中为“DUT”，见下图。然后点OK。后面观察波形与前仿真步骤相同。</p> 
<p><img alt="" src="https://images2.imgbox.com/b7/79/vNJqfelZ_o.png"></p> 
<p><strong>图18 添加.sdo文件</strong></p> 
<p> </p> 
<p>自动仿真和手动仿真的区别：</p> 
<p>① 自动仿真</p> 
<p>这种方法比较简单，因为Quartus II调用Modelsim ，所以除了生成自动生成了modelsim仿真所需要的.vo文件(网表文件)和.sdo文件（时延文件）外，还生成了gate_work文件夹、verilog_libs文件夹；gate_work文件夹(可以叫工作库，也可以叫编译库)下存放了已编译的文件，verilog_libs文件夹下存放了仿真所需要的资源库，上例是cycloneii_ver库(文件夹)。而手动仿真则需要自己添加这些文件和库。具体如下。</p> 
<p>② 手动仿真</p> 
<p>手动仿真需要自己添加文件和编译库，但可以充分发挥modelsim强大的仿真功能。操作时也要先对quartus进行设置，设置与前面相同只是不要选中Run Gate Level Simulation automatically after complication。然后启动modelsim，将当前路径改到"工程文件夹\simulation\modelsim"下。如下图所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/90/a5/eqsI3LxT_o.png"></p> 
<p><strong>图19 启动modelsim</strong></p> 
<p> </p> 
<p>相比①中，这里少了一些库(实际是verilog_libs库、gate_work库和work库)，因此下面要添加一个库。新建一个库，此处默认库名为work，此时，"工程文件夹\simulation\modelsim"文件夹下出现了一个work文件夹，work库下面没有目标文件和测试文件，即work文件夹下没有任何文件，建库的目的就是将编译的文件都放在该库里，即放在该文件夹下。编译之前，还需要添加仿真所需要的资源库cycloneii_atoms(用到EP2C8)，将D:\altera\90\quartus\eda\sim_lib目录下的cycloneii_atoms文件复制到.vo所在的目录，即"工程文件夹\simulation\modelsim"下。</p> 
<p>如果按照①中的方法编写testbench并同样放在.vo所在的目录，这时点Compile下的Compile或点 将会出现下面的对话框，将所选文件进行编译。</p> 
<p><img alt="" src="https://images2.imgbox.com/93/1d/Lix4Qe0a_o.png"></p> 
<p><strong>图20 编译所需文件和资源库</strong></p> 
<p> </p> 
<p>编译完成之后，work工作库下多了很多文件，同样work文件夹下也多了很多文件(夹)，建库的目的可见一斑，其中有Counter_tb测试文件和counter目标文件。点击simulate-&gt;Start Simulation或快捷按钮 会出现start simulate对话框。这里和①相比只有Libraries标签在Search Library时不一样，其余2项都一样。Libraries标签在Search Library的设置如下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/67/69/c18XVjpE_o.png"></p> 
<p><strong>图21 选择仿真所需要的资源库</strong></p> 
<p> </p> 
<p>后面的观察波形步骤跟前面一样。</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/38/a8/DqTx3YiI_o.png"></p> 
<h3> </h3> 
<h2><strong>四、观察波形的一些方法和技巧</strong></h2> 
<h3><strong>4.1 手动创建输入波形(待定)</strong></h3> 
<p>对于复杂的设计文件，最好是自己编写testbench文件，这样可以精确定义各信号以及各个信号之间的依赖关系等，提高仿真效率。</p> 
<p>对于一些简单的设计文件，也可以在波形窗口自己创建输入波形进行仿真。具体方法是鼠标右击work库里的目标仿真文件counter.v，然后点create wave，弹出wave default窗口。如下图所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/7c/09/q8XgaeLE_o.png"></p> 
<p><strong>图22 Add to Wave</strong></p> 
<p> </p> 
<p>在wave窗口中选中要创建波形的信号，如此例中的CLK，然后右键点击，选择Create/Modify/Wave项出现下面的窗口：</p> 
<p><img alt="" src="https://images2.imgbox.com/f3/38/m8LAdmk8_o.png"></p> 
<p><strong>图23 设置</strong><strong>输入波形</strong></p> 
<p> </p> 
<p>在Patterns中选择输入波形的类型，然后分别在右边的窗口中设定起始时间、终止时间以及单位，再点Next出现下面的窗口，我们把初始值的HiZ改为0，然后修改时钟周期和占空比，然后点Finish。</p> 
<p><img alt="" src="https://images2.imgbox.com/50/3e/wtK8S45Q_o.png"></p> 
<p><strong>图24 设置输入波形</strong></p> 
<p> </p> 
<p>接着继续添加其他输入波形，出现下面的结果。前面出现的红点表示该波形是可编辑的。后面的操作与用testbench文本仿真的方法相同 。</p> 
<p><img alt="" src="https://images2.imgbox.com/9a/d8/zOavuZKf_o.png"></p> 
<p><strong>图25 仿真波形</strong></p> 
<p> </p> 
<h3><strong>4.2 观察特定信号波形</strong></h3> 
<p>如果设计者只想查看指定信号的波形，可以先选中objects窗口中要观察的信号，然后点右键选择Add to Wave-&gt;Selected signals,见下图，那么在Wave窗口中只添加选中的信号。</p> 
<p><img alt="" src="https://images2.imgbox.com/34/1c/Zp6pomWh_o.png"></p> 
<p><strong>图26 查看特定信号波形</strong></p> 
<h3> </h3> 
<h3><strong>4.3 保存和导入波形文件(待定)</strong></h3> 
<p>如果要保存波形窗口当前信号的分配，可以点File-&gt;Save,在出现的对话框中设置保存路径及文件名，保存的格式为.do文件。</p> 
<p>如果是想导出自己创建的波形（在文章最后有详细的解释）可以选择File-&gt;Export Waveform在出现的对话框中选择EVCD File并进行相关设置即可。</p> 
<p>如果导入设计的波形选择File-&gt;Import ECVD即可。</p> 
<h3> </h3> 
<h3><strong>4.4 Dataflow窗口观察信号波形</strong></h3> 
<p>在主界面中点View-&gt;Dataflow可以看到会出现dataflow窗口，在objects窗口中拖一个信号到该窗口中，你会发现在dataflow窗口中出现你刚才选中信号所在的模块，如果双击模块的某一引脚，会出现与该引脚相连的别的模块或者引线，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/b1/1d/oZW2RJuX_o.png"></p> 
<p><strong>图27 Dataflow窗口</strong></p> 
<p> </p> 
<p>在dataflow窗口中点View-&gt;Show Wave，会在dataflow窗口中出现一个wave窗口，双击上面窗口中的某一模块，则在下面的wave窗口中出现与该模块相连的所有信号，如果已经执行过仿真，在wave窗口中还会出现对应的波形，见下图。</p> 
<p><img alt="" src="https://images2.imgbox.com/7b/fb/jWGqhT5e_o.png"></p> 
<p><strong>图28 Dataflow窗口观察仿真波形</strong></p> 
<p> </p> 
<p>在波形窗口中拖动游标，上面模块的引脚信号的值也会随着游标当前位置的改变而改变。</p> 
<p>如果要在modelsim中修改原设计文件，在文档页面点击右键，取消Read Only，即可修改，修改后继续仿真。如果想结束仿真可以点Simulate-&gt;End Simulation,或直接在命令行输入quit -sim，此时quartus也会显示结束所有编译过程。</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/23/73/PtlnxJFo_o.png"></p> 
<p> </p> 
<h2><strong>五、 一些说明</strong></h2> 
<p><strong>关于在testbench里使用`timescale的问题</strong></p> 
<p>`timescale 是编译器指令，用来定义时延精度和时延单位，命令格式如下：</p> 
<p>`timescale time_unit/time_precision</p> 
<p>其中time_unit定义时延单位，即后面模块中出现的时延数值的单位，time_precision定义时延精度。例如`timescale 1ns/100ps  表示时延单位为1ns，时延精度为100ps。如果后面有语句 #5.22 a=1;此时时延值5.22ns应该对应为5.2ns，因为精度为0.1ns。</p> 
<p>如果设计中多个模块带有自身的`timescale，编译时模拟器总是定义在所有模块的最小时延精度上，并且所有模块中的时延都自动地换算为到最小试验精度上。</p> 
<p> </p> 
<p><img alt="" src="https://images2.imgbox.com/2a/fe/0u12k5zo_o.png"></p> 
<p> </p> 
<h2><strong>附录：</strong></h2> 
<p><strong>Counter源代码：</strong></p> 
<pre><code>`timescale 1ns/100ps</code><code>​</code><code> module Counter (</code><code>                   input        CLK,</code><code>                   input        RST_N,</code><code>                   output [3:0] CNT            </code><code>                   );</code><code>​</code><code>     reg [3:0] cnt;</code><code>     assign CNT = cnt;</code><code>    </code><code>     always@(posedge CLK, negedge RST_N) begin</code><code>     if (!RST_N)</code><code>         cnt &lt;= #5 4'h0;</code><code>     else</code><code>         cnt &lt;= #0 cnt + 1'b1;</code><code>     end</code><code>    </code><code>endmodule</code></pre> 
<p> </p> 
<p><strong>Counter_tb源代码：</strong></p> 
<pre><code>`timescale 1ns/100ps</code><code>​</code><code>module Counter_tb  ; </code><code>​</code><code>    wire  [3:0]  CNT   ;</code><code>    reg    RST_N   ;</code><code>    reg    CLK   ;</code><code>    </code><code>    Counter DUT  (</code><code>                  .CNT (CNT ) ,</code><code>                  .RST_N (RST_N ) ,</code><code>                  .CLK (CLK ) </code><code>                  );</code><code>  </code><code>     initial begin</code><code>     #0 CLK   = 1'b0;</code><code>        RST_N = 1'b0;</code><code>     #5 RST_N = 1'b1;</code><code>     end</code><code>     // 50MHz</code><code>     always #10 CLK = ~CLK;</code><code>​</code><code>endmodule</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de2eaed62b9ed7866158afac8950b8a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">知识图谱用于推荐系统问题（MKR，KTUP，KGAT）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8792181138068a0a47f93bb974dbe7ab/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">操作系统的进程调度</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>