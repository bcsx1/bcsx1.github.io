<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用" />
<meta property="og:description" content="opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用 文章目录 opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用基础知识I——图像仿射变换基础知识II——图像插值算法1.为什么会有图像插值的概念？2.经典的图像插值算法最近邻插值（最简单的插值方法）双线性插值双三次插值 缩放变换——resize函数函数原型探究将一张图片缩小a倍，再将缩小后的图像放大a倍 平移变换——warpAffine函数函数原型实现一幅图像的平移 旋转变换——warpAffine函数原理推导情况1：绕原点旋转情况2：绕任意点旋转 函数原型实现一幅图像的旋转实现图像绕中心点无损旋转理论推导 仿射变换放射变换的变换矩阵推导函数原型实现仿射变换 透视变换——在车道线检测上的应用 基础知识I——图像仿射变换 仿射变换包括如下所有变换，以及这些变换任意次序次数的组合：
平移（translation）和旋转（rotation）顾名思义，两者的组合称之为欧式变换（Euclidean transformation）或刚体变换（rigid transformation）；
放缩（scaling）可进一步分为uniform scaling和non-uniform scaling，前者每个坐标轴放缩系数相同（各向同性），后者不同；如果放缩系数为负，则会叠加上反射（reflection）——reflection可以看成是特殊的scaling；
刚体变换&#43;uniform scaling 称之为，相似变换（similarity transformation），即平移&#43;旋转&#43;各向同性的放缩；
剪切变换（shear mapping）将所有点沿某一指定方向成比例地平移。
上述变换都可以通过矩阵操作进行：
没有平移或者平移量为0的所有仿射变换可以用如下变换矩阵描述：
为了增添平移这一变换，变换矩阵写为：
基础知识II——图像插值算法 1.为什么会有图像插值的概念？ 以小图像放大为大图像为例：
从上图可以看出，当一个小图像放大为大图像时，像素点的位置坐标随之变化，放大后的图像会存在像素缺失（图中橙色点所示），如果这些位置上的像素不做处理就会造成图像严重失真，为了解决这个问题，便有了图像内插问题的提出。
2.经典的图像插值算法 最近邻插值（Nearest）双线性插值（Bilinear）双三次插值（Bicubic） 最近邻插值（最简单的插值方法） 如上图所示，图2.1是原始图像，图2.2是图2.1放大2倍以后得到的图像，其像素点的横纵坐标均扩大为原来的两倍，那么会产生出其他位置的新像素，如图2.2中浅色圆圈所示。
最近邻插值是将图2.2中五个未知像素点横纵坐标缩小2倍，那么这5个像素点的位置一定落在图2.1中四个像素的四邻域内，对于一个未知像素的像素点来说，其像素值和离它最近的已知像素点的像素值相同。
最近邻插值简单便捷，其计算速度快，但是当一个图片需要放大较大倍数时，会出现马赛克现象。举个简单例子，当一个图像放大500倍时，此时两个原有像素点之间就存在499个待插值，那么必定会存在有连续位置上的像素值相同，这样就会出现马赛克现象。
双线性插值 双线性插值有前提假设：假设原图像的灰度是线性变化的。
如上图所示，假设代插点映射回原图的位置为 e ( u , v ) e(u,v) e(u,v), u u u , v v v显然都是非整数， A A A, B B B, C C C, D D D四点对应的灰度值分别为 I ( i , j ) I(i,j) I(i,j), I ( i , j &#43; 1 ) I(i,j&#43;1) I(i,j&#43;1), I ( i , j &#43; 1 ) I(i,j&#43;1) I(i,j&#43;1), I ( i &#43; 1 , j &#43; 1 ) I(i&#43;1,j&#43;1) I(i&#43;1,j&#43;1)。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c1880daf95142c09813477766b107c90/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T13:44:01+08:00" />
<meta property="article:modified_time" content="2023-10-24T13:44:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="opencv_0"></a>opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#opencv_0" rel="nofollow">opencv学习笔记（十）：图像缩放、平移、旋转变换理论推导及应用</a></li><li><ul><li><a href="#I_3" rel="nofollow">基础知识I——图像仿射变换</a></li><li><a href="#II_30" rel="nofollow">基础知识II——图像插值算法</a></li><li><ul><li><a href="#1_31" rel="nofollow">1.为什么会有图像插值的概念？</a></li><li><a href="#2_36" rel="nofollow">2.经典的图像插值算法</a></li><li><ul><li><a href="#_41" rel="nofollow">最近邻插值（最简单的插值方法）</a></li><li><a href="#_47" rel="nofollow">双线性插值</a></li><li><a href="#_56" rel="nofollow">双三次插值</a></li></ul> 
   </li></ul> 
   </li><li><a href="#resize_59" rel="nofollow">缩放变换——resize函数</a></li><li><ul><li><a href="#_72" rel="nofollow">函数原型</a></li><li><a href="#aa_141" rel="nofollow">探究将一张图片缩小a倍，再将缩小后的图像放大a倍</a></li></ul> 
   </li><li><a href="#warpAffine_163" rel="nofollow">平移变换——warpAffine函数</a></li><li><ul><li><a href="#_169" rel="nofollow">函数原型</a></li><li><a href="#_198" rel="nofollow">实现一幅图像的平移</a></li></ul> 
   </li><li><a href="#warpAffine_216" rel="nofollow">旋转变换——warpAffine函数</a></li><li><ul><li><a href="#_217" rel="nofollow">原理推导</a></li><li><ul><li><a href="#1_218" rel="nofollow">情况1：绕原点旋转</a></li><li><a href="#2_228" rel="nofollow">情况2：绕任意点旋转</a></li></ul> 
    </li><li><a href="#_265" rel="nofollow">函数原型</a></li><li><a href="#_275" rel="nofollow">实现一幅图像的旋转</a></li><li><a href="#_297" rel="nofollow">实现图像绕中心点无损旋转</a></li><li><ul><li><a href="#_299" rel="nofollow">理论推导</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_362" rel="nofollow">仿射变换</a></li><li><ul><li><a href="#_378" rel="nofollow">放射变换的变换矩阵推导</a></li><li><a href="#_384" rel="nofollow">函数原型</a></li><li><a href="#_395" rel="nofollow">实现仿射变换</a></li></ul> 
   </li><li><a href="#_424" rel="nofollow">透视变换——在车道线检测上的应用</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="I_3"></a>基础知识I——图像仿射变换</h3> 
<p><strong>仿射变换包括如下所有变换，以及这些变换任意次序次数的组合：</strong></p> 
<p><img src="https://images2.imgbox.com/38/37/60Lx8InV_o.png" alt=""></p> 
<p><strong>平移（translation）和旋转（rotation）顾名思义，两者的组合称之为欧式变换（Euclidean transformation）或刚体变换（rigid transformation）；</strong></p> 
<p><strong>放缩（scaling）可进一步分为uniform scaling和non-uniform scaling，前者每个坐标轴放缩系数相同（各向同性），后者不同；如果放缩系数为负，则会叠加上反射（reflection）——reflection可以看成是特殊的scaling；</strong></p> 
<p><strong>刚体变换+uniform scaling 称之为，相似变换（similarity transformation），即平移+旋转+各向同性的放缩；</strong><br> <strong>剪切变换（shear mapping）将所有点沿某一指定方向成比例地平移。</strong><br> <img src="https://images2.imgbox.com/c6/55/FmywsxVJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>上述变换都可以通过矩阵操作进行：</strong><br> <strong>没有平移或者平移量为0的所有仿射变换可以用如下变换矩阵描述：</strong></p> 
<p><img src="https://images2.imgbox.com/47/31/De3a0mSF_o.png" alt="在这里插入图片描述"></p> 
<p><strong>为了增添平移这一变换，变换矩阵写为：</strong></p> 
<p><img src="https://images2.imgbox.com/c8/f5/2lW661fq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="II_30"></a>基础知识II——图像插值算法</h3> 
<h4><a id="1_31"></a>1.为什么会有图像插值的概念？</h4> 
<p><strong>以小图像放大为大图像为例：</strong><br> <img src="https://images2.imgbox.com/9e/5f/h8Hc8mmE_o.png" alt="在这里插入图片描述"></p> 
<p><strong>从上图可以看出，当一个小图像放大为大图像时，像素点的位置坐标随之变化，放大后的图像会存在像素缺失（图中橙色点所示），如果这些位置上的像素不做处理就会造成图像严重失真，为了解决这个问题，便有了图像内插问题的提出。</strong></p> 
<h4><a id="2_36"></a>2.经典的图像插值算法</h4> 
<ul><li><strong>最近邻插值（Nearest）</strong></li><li><strong>双线性插值（Bilinear）</strong></li><li><strong>双三次插值（Bicubic）</strong></li></ul> 
<h5><a id="_41"></a>最近邻插值（最简单的插值方法）</h5> 
<p><img src="https://images2.imgbox.com/19/16/kRYuv4Cw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>如上图所示，图2.1是原始图像，图2.2是图2.1放大2倍以后得到的图像，其像素点的横纵坐标均扩大为原来的两倍，那么会产生出其他位置的新像素，如图2.2中浅色圆圈所示。</strong><br> <strong>最近邻插值是将图2.2中五个未知像素点横纵坐标缩小2倍，那么这5个像素点的位置一定落在图2.1中四个像素的四邻域内，对于一个未知像素的像素点来说，其像素值和离它最近的已知像素点的像素值相同。</strong><br> <strong>最近邻插值简单便捷，其计算速度快，但是当一个图片需要放大较大倍数时，会出现马赛克现象。举个简单例子，当一个图像放大500倍时，此时两个原有像素点之间就存在499个待插值，那么必定会存在有连续位置上的像素值相同，这样就会出现马赛克现象。</strong></p> 
<h5><a id="_47"></a>双线性插值</h5> 
<p><strong>双线性插值有前提假设：假设原图像的灰度是线性变化的。</strong><br> <img src="https://images2.imgbox.com/b5/e8/IsFOiOdi_o.png" alt="在这里插入图片描述"></p> 
<p><strong>如上图所示，假设代插点映射回原图的位置为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          e 
         
        
          ( 
         
        
          u 
         
        
          , 
         
        
          v 
         
        
          ) 
         
        
       
         e(u,v) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mclose">)</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          u 
         
        
       
         u 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span></span> ,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          v 
         
        
       
         v 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span></span></span></span></span>显然都是非整数，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
       
         A 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          B 
         
        
       
         B 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          C 
         
        
       
         C 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0715em;">C</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
       
         D 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span>四点对应的灰度值分别为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          ) 
         
        
       
         I(i,j) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
       
         I(i,j+1) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
       
         I(i,j+1) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          ( 
         
        
          i 
         
        
          + 
         
        
          1 
         
        
          , 
         
        
          j 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
       
         I(i+1,j+1) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>。</strong></p> 
<ul><li><strong>要求出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           e 
          
         
           ( 
          
         
           u 
          
         
           , 
          
         
           v 
          
         
           ) 
          
         
        
          e(u,v) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mclose">)</span></span></span></span></span>的像素值首先要求出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            1 
           
          
         
           ( 
          
         
           u 
          
         
           , 
          
         
           j 
          
         
           ) 
          
         
           = 
          
          
          
            e 
           
          
            1 
           
          
         
           ( 
          
         
           i 
          
         
           + 
          
          
          
            d 
           
          
            x 
           
          
         
           , 
          
         
           j 
          
         
           ) 
          
         
        
          e_{1}(u,j)=e_{1}(i+d_{x},j) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span></span></span></span></span>与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            2 
           
          
         
           ( 
          
         
           u 
          
         
           , 
          
         
           j 
          
         
           + 
          
         
           1 
          
         
           ) 
          
         
           = 
          
          
          
            e 
           
          
            2 
           
          
         
           ( 
          
         
           i 
          
         
           + 
          
          
          
            d 
           
          
            x 
           
          
         
           , 
          
         
           j 
          
         
           + 
          
          
          
            d 
           
          
            y 
           
          
         
           ) 
          
         
        
          e_{2}(u,j+1)=e_{2}(i+d_{x},j+d_{y}) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的像素值。</strong></li><li><strong>x轴的单线性插值：</strong> <strong>根据原图像灰度线性变化，可由<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           B 
          
         
        
          B 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span></span></span></span></span>两点的像素值以及它们之间的线性关系求出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            1 
           
          
         
        
          e_{1} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的像素值——<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            1 
           
          
         
           ( 
          
         
           u 
          
         
           , 
          
         
           j 
          
         
           ) 
          
         
           = 
          
          
          
            d 
           
          
            x 
           
          
         
           ( 
          
         
           I 
          
         
           ( 
          
         
           i 
          
         
           , 
          
         
           j 
          
         
           + 
          
         
           1 
          
         
           ) 
          
         
           − 
          
         
           I 
          
         
           ( 
          
         
           i 
          
         
           , 
          
         
           j 
          
         
           ) 
          
         
           ) 
          
         
           + 
          
         
           I 
          
         
           ( 
          
         
           i 
          
         
           , 
          
         
           j 
          
         
           ) 
          
         
        
          e_{1}(u,j)=d_{x}(I(i,j+1)-I(i,j))+I(i,j) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">))</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span></span></span></span></span>,同理可以求出<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            2 
           
          
         
        
          e_{2} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>。</strong></li><li><strong>y轴的单线性插值：</strong> <strong>根据<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            1 
           
          
         
        
          e_{1} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            e 
           
          
            2 
           
          
         
        
          e_{2} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>两点的插值再次求线性插值即可。</strong><br> <strong>根据上述推导，双线性插值法其实是利用待插像素点四个邻接像素点的灰度值在水平和垂直方向上作线性内插，它的运算量要比最近邻域法复杂些，但克服了灰度不连续的缺点，整体视觉效果较好。同时需要注意到，它具有⭐️低通滤波⭐️的性质（该方法没有考虑图像灰度变化率的情况，只是根据位置来确定插值的像素权重，若两个像素点像素值分别为0、255，跨越了整个8bit灰度级的灰度范围，放大后这两点之间的坐标上将会填充一系列渐变的像素值，导致0、255的视觉跨度降低，也就导致某些图片上边缘模糊），图像的高频分量会在此插值过程中受损，导致效果图中的轮廓有一定的模糊，细节不够突出。</strong></li></ul> 
<h5><a id="_56"></a>双三次插值</h5> 
<p><a href="https://en.wikipedia.org/wiki/Bicubic_interpolation" rel="nofollow" title="维基百科中对双三次插值的推导">维基百科中对双三次插值的推导</a></p> 
<hr> 
<h3><a id="resize_59"></a>缩放变换——resize函数</h3> 
<p><strong>先展示一张较大图片</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread <span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>显示效果如下：</strong><br> [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-md7uJpGj-1673570245578)(http://restar-xt.cn/wp-content/uploads/2023/01/Python显示过大图片.png)]<br> <strong>发现图片显示不全，那么可以通过缩放函数resize解决问题</strong></p> 
<h4><a id="_72"></a>函数原型</h4> 
<pre><code class="prism language-python">dst	<span class="token operator">=</span>	cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>	src<span class="token punctuation">,</span> dsize<span class="token punctuation">[</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token punctuation">,</span> fx<span class="token punctuation">[</span><span class="token punctuation">,</span> fy<span class="token punctuation">[</span><span class="token punctuation">,</span> interpolation<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>	<span class="token punctuation">)</span>
@参数：
src	  <span class="token builtin">input</span> image<span class="token punctuation">.</span>输入图像
dst	  output image<span class="token punctuation">;</span> it has the size dsize <span class="token punctuation">(</span>when it <span class="token keyword">is</span> non<span class="token operator">-</span>zero<span class="token punctuation">)</span> <span class="token keyword">or</span> the size computed <span class="token keyword">from</span> src<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fx<span class="token punctuation">,</span> <span class="token keyword">and</span> fy<span class="token punctuation">;</span> the <span class="token builtin">type</span> of dst <span class="token keyword">is</span> the same <span class="token keyword">as</span> of src<span class="token punctuation">.</span>输出图像
dsize	output image size<span class="token punctuation">;</span> <span class="token keyword">if</span> it equals zero<span class="token punctuation">,</span> it <span class="token keyword">is</span> computed <span class="token keyword">as</span><span class="token punctuation">:</span>
dsize <span class="token operator">=</span> Size<span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>fx<span class="token operator">*</span>src<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>fy<span class="token operator">*</span>src<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span>
Either dsize <span class="token keyword">or</span> both fx <span class="token keyword">and</span> fy must be non<span class="token operator">-</span>zero<span class="token punctuation">.</span>输出图像的大小
fx	scale factor along the horizontal axis<span class="token punctuation">;</span> when it equals <span class="token number">0</span><span class="token punctuation">,</span> it <span class="token keyword">is</span> computed <span class="token keyword">as</span>
<span class="token punctuation">(</span>double<span class="token punctuation">)</span>dsize<span class="token punctuation">.</span>width<span class="token operator">/</span>src<span class="token punctuation">.</span>cols  x轴缩放因子
fy	scale factor along the vertical axis<span class="token punctuation">;</span> when it equals <span class="token number">0</span><span class="token punctuation">,</span> it <span class="token keyword">is</span> computed <span class="token keyword">as</span>
<span class="token punctuation">(</span>double<span class="token punctuation">)</span>dsize<span class="token punctuation">.</span>height<span class="token operator">/</span>src<span class="token punctuation">.</span>rows  y轴缩放因子
interpolation	interpolation method<span class="token punctuation">,</span> see InterpolationFlags 插值方法
</code></pre> 
<p><strong>说明：对于插值方法，OpenCV提供了多种插值方法：</strong><br> <img src="https://images2.imgbox.com/36/67/GkYOAUgS_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>INTER_NEAREST</td><td>最近邻插值</td></tr><tr><td>INTER_LINEAR</td><td>双线性插值</td></tr><tr><td>INTER_CUBIC</td><td>双三次插值</td></tr><tr><td>INTER_AREA</td><td>区域插值</td></tr><tr><td>INTER_LANCZOS4</td><td>兰索斯插值</td></tr></tbody></table> 
<p><strong>接下来将之前展示的图片进行缩小：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread <span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span>
Img_1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_NEAREST<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Nearest Image'</span><span class="token punctuation">,</span>Img_1<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行结果如下：</strong><br> <img src="https://images2.imgbox.com/9e/87/aw7UgH3g_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c1/c9/apzppd17_o.png" alt="在这里插入图片描述"></p> 
<p><strong>在本文开头曾介绍了最近邻、双线性、双三次插值，为了更加清晰直观地说明三种插值方式的优劣性，以同样放大倍数放大同一图片进行观察：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread <span class="token punctuation">(</span><span class="token string">'lena.png'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span>
Img_1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_NEAREST<span class="token punctuation">)</span>
Img_2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
Img_3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Nearest Image'</span><span class="token punctuation">,</span>Img_1<span class="token punctuation">)</span><span class="token operator">//</span>最近邻插值
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Linear Image'</span><span class="token punctuation">,</span>Img_2<span class="token punctuation">)</span><span class="token operator">//</span>双线性插值
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Cubic Image'</span><span class="token punctuation">,</span>Img_3<span class="token punctuation">)</span><span class="token operator">//</span>双三次插值
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行结果如下：</strong><br> <img src="https://images2.imgbox.com/c2/cd/UAmpjhEo_o.png" alt="在这里插入图片描述"></p> 
<p><strong>可见左图（最近邻插值）方块（马赛克）情况严重，中图（双线性插值）与右图（双三次插值）在lena头发处对比明显，双三次插值放大的图像边缘更加平滑。</strong></p> 
<h4><a id="aa_141"></a>探究将一张图片缩小a倍，再将缩小后的图像放大a倍</h4> 
<p><strong>注意：进行缩小处理时常用区域插值，进行放大处理时常用双线性插值或双三次插值。</strong><br> <strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread <span class="token punctuation">(</span><span class="token string">'lena.png'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span>
Img_1<span class="token operator">=</span>cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
Img_2<span class="token operator">=</span>cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>Img_1<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Smaller Image'</span><span class="token punctuation">,</span>Img_2<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>运行结果如下：主要比较缩小再放大的图像与原图的区别。</strong><br> <img src="https://images2.imgbox.com/03/63/s5W1G7mR_o.png" alt="在这里插入图片描述"></p> 
<p><strong>从上图可看出，左图作为缩小后又放大的图像明显具有模糊（马赛克）效果，这是由于缩小时本身会损失一部分像素值，放大以后的图像这部分像素值缺失，是通过插值来填充的，为了解决缺失像素点恢复的问题可以通过图像金字塔等相关知识解决。</strong></p> 
<blockquote> 
 <p>写在前面：接下来的平移变换和旋转变换其实都属于仿射变换，它们可以用变换矩阵达到目的，故二者使用的核心函数都是warpAffine函数，只不过平移变换的变换矩阵很简单容易求出，而且平移变换只涉及水平、竖直两个方向；而旋转变换则涉及旋转中心、旋转角度等，其对应的变换矩阵无法一眼求出，需要借助相关函数，这就是二者在使用过程中的区别。</p> 
</blockquote> 
<h3><a id="warpAffine_163"></a>平移变换——warpAffine函数</h3> 
<p><strong>平移变换是矩阵操作，对图像进行矩阵操作主要有两步：</strong></p> 
<ul><li><strong>构建对应矩阵</strong></li><li><strong>进行矩阵乘法</strong></li></ul> 
<p><strong>一般使用Numpy模块来构建矩阵，矩阵数据类型为单精度浮点数float32（这是由OpenCV函数参数决定的）。</strong></p> 
<h4><a id="_169"></a>函数原型</h4> 
<pre><code class="prism language-python">dst	<span class="token operator">=</span>	cv<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>	src<span class="token punctuation">,</span> M<span class="token punctuation">,</span> dsize<span class="token punctuation">[</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">[</span><span class="token punctuation">,</span> borderMode<span class="token punctuation">[</span><span class="token punctuation">,</span> borderValue<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>	<span class="token punctuation">)</span>
@参数说明：
<span class="token decorator annotation punctuation">@src</span>	  <span class="token builtin">input</span> image<span class="token punctuation">.</span>输入图像
<span class="token decorator annotation punctuation">@dst</span>	  output image that has the size dsize <span class="token keyword">and</span> the same <span class="token builtin">type</span> <span class="token keyword">as</span> src <span class="token punctuation">.</span>输出图像
<span class="token decorator annotation punctuation">@M</span>	    <span class="token number">2</span>×<span class="token number">3</span> transformation matrix<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span>的矩阵
<span class="token decorator annotation punctuation">@dsize</span>	size of the output image<span class="token punctuation">.</span>输出图像大小
<span class="token decorator annotation punctuation">@flags</span>	combination of interpolation methods <span class="token punctuation">(</span>see InterpolationFlags<span class="token punctuation">)</span> <span class="token keyword">and</span> the optional flag WARP_INVERSE_MAP that means that M <span class="token keyword">is</span> the inverse transformation <span class="token punctuation">(</span> dst→src <span class="token punctuation">)</span><span class="token punctuation">.</span>插值方法，可选参数WARP_INVERSE_MAP表示图像逆变换——dst<span class="token operator">-</span><span class="token operator">&gt;</span>src
<span class="token decorator annotation punctuation">@borderMode</span>	pixel extrapolation method <span class="token punctuation">(</span>see BorderTypes<span class="token punctuation">)</span><span class="token punctuation">;</span> when borderMode<span class="token operator">=</span>BORDER_TRANSPARENT<span class="token punctuation">,</span> it means that the pixels <span class="token keyword">in</span> the destination image corresponding to the <span class="token string">"outliers"</span> <span class="token keyword">in</span> the source image are <span class="token keyword">not</span> modified by the function<span class="token punctuation">.</span>像素外推方法
<span class="token decorator annotation punctuation">@borderValue</span>	value used <span class="token keyword">in</span> <span class="token keyword">case</span> of a constant border<span class="token punctuation">;</span> by default<span class="token punctuation">,</span> it <span class="token keyword">is</span> <span class="token number">0.</span>固定边框
</code></pre> 
<p><strong>关于函数中M矩阵的推导，为什么是2*3矩阵?</strong><br> <strong>设图像中一个像素(像素坐标)的向量（矩阵）表示为:</strong></p> 
<p><img src="https://images2.imgbox.com/dd/f5/mUxyaMtN_o.png" alt="在这里插入图片描述"></p> 
<p><strong>变换矩阵为：</strong></p> 
<p><img src="https://images2.imgbox.com/cb/50/lcrrpr7N_o.png" alt="在这里插入图片描述"></p> 
<p><strong>两个矩阵相乘：</strong></p> 
<p><img src="https://images2.imgbox.com/8c/20/PPWrLKl1_o.png" alt="在这里插入图片描述"></p> 
<p><strong>这样就实现了像素点的平移，对原图像所有像素点做如此处理即可得到原图像平移。</strong></p> 
<h4><a id="_198"></a>实现一幅图像的平移</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'lena.png'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span><span class="token punctuation">;</span>
M<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#创造2*3矩阵，与上文推导对比可知，该矩阵可使图片沿x轴、y轴均平移50个单位长度</span>
ImgTranslation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>Img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'ImgTranslation'</span><span class="token punctuation">,</span>ImgTranslation<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Original'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行效果如下：</strong><br> <img src="https://images2.imgbox.com/21/ba/Xkx1gDaB_o.png" alt="在这里插入图片描述"></p> 
<p><strong>产生的黑色边框是由于平移后像素点填充为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          （ 
         
        
          0 
         
        
          , 
         
        
          0 
         
        
          , 
         
        
          0 
         
        
          ） 
         
        
       
         （0,0,0） 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord cjk_fallback">（</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">0</span><span class="mord cjk_fallback">）</span></span></span></span></span>造成的。</strong></p> 
<h3><a id="warpAffine_216"></a>旋转变换——warpAffine函数</h3> 
<h4><a id="_217"></a>原理推导</h4> 
<h5><a id="1_218"></a>情况1：绕原点旋转</h5> 
<p><img src="https://images2.imgbox.com/41/69/F5eHN3Op_o.png" alt="在这里插入图片描述"></p> 
<p><strong>设<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         P(x,y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mclose">)</span></span></span></span></span>是原始坐标，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Q 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          ) 
         
        
       
         Q(x,y) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mclose">)</span></span></span></span></span>是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
       
         P 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span>点旋转一定角度得到的点，先求<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Q 
         
        
       
         Q 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span></span>点由<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          P 
         
        
       
         P 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span>点坐标表出的坐标表示：</strong><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          , 
         
        
       
         = 
        
       
         D 
        
       
         cos 
        
       
         ⁡ 
        
        
        
          ( 
         
        
          α 
         
        
          + 
         
        
          β 
         
        
          ) 
         
        
       
         = 
        
       
         D 
        
       
         ( 
        
       
         cos 
        
       
         ⁡ 
        
       
         α 
        
       
         cos 
        
       
         ⁡ 
        
       
         β 
        
       
         − 
        
       
         sin 
        
       
         ⁡ 
        
       
         α 
        
       
         sin 
        
       
         ⁡ 
        
       
         β 
        
       
         ) 
        
       
         = 
        
       
         x 
        
       
         cos 
        
       
         ⁡ 
        
       
         β 
        
       
         − 
        
       
         y 
        
       
         sin 
        
       
         ⁡ 
        
       
         β 
        
       
      
        x^,=D\cos{(\alpha+\beta)}=D(\cos{\alpha}\cos{\beta}-\sin{\alpha}\sin{\beta})=x\cos{\beta}-y\sin{\beta} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4369em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.4369em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mpunct mtight">,</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="mclose">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          y 
         
        
          , 
         
        
       
         = 
        
       
         D 
        
       
         sin 
        
       
         ⁡ 
        
        
        
          ( 
         
        
          α 
         
        
          + 
         
        
          β 
         
        
          ) 
         
        
       
         = 
        
       
         D 
        
       
         ( 
        
       
         sin 
        
       
         ⁡ 
        
       
         α 
        
       
         cos 
        
       
         ⁡ 
        
       
         β 
        
       
         + 
        
       
         cos 
        
       
         ⁡ 
        
       
         α 
        
       
         sin 
        
       
         ⁡ 
        
       
         β 
        
       
         ) 
        
       
         = 
        
       
         y 
        
       
         cos 
        
       
         ⁡ 
        
       
         β 
        
       
         + 
        
       
         x 
        
       
         sin 
        
       
         ⁡ 
        
       
         β 
        
       
         = 
        
       
         x 
        
       
         sin 
        
       
         ⁡ 
        
       
         β 
        
       
         + 
        
       
         y 
        
       
         cos 
        
       
         ⁡ 
        
       
         β 
        
       
      
        y^,=D\sin{(\alpha+\beta)}=D(\sin{\alpha}\cos{\beta}+\cos{\alpha}\sin{\beta})=y\cos{\beta}+x\sin{\beta}=x\sin{\beta}+y\cos{\beta} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6313em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.4369em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mpunct mtight">,</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="mclose">)</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span></span></span></span></span><br> <strong>将上述两式用矩阵表示：</strong><br> <img src="https://images2.imgbox.com/0e/49/rjJyIRJY_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_228"></a>情况2：绕任意点旋转</h5> 
<p><strong>点绕任意中心位置旋转其实就是先将坐标系从原点位置平移后旋转再平移回来。<br> 该旋转矩阵较情况1来说复杂一些，但是OpenCV库内置了getRotationMatrix2D函数可以方便快捷地求出旋转矩阵。</strong></p> 
<p><strong>opencv的getRotationMatrix2D函数可以获取旋转变换矩阵。输入中心点坐标(centerX,centerY)，旋转角度θ，缩放比例，给出M变换矩阵：</strong></p> 
<p><img src="https://images2.imgbox.com/73/40/mA5w8cHw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>M变换矩阵推导如下：</strong></p> 
<ul><li><strong>首先用矩阵表示某一像素点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
        
          A(x,y) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mclose">)</span></span></span></span></span>：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/39/e2/gAFuhKww_o.png" alt=""></p> 
<ul><li><strong>围绕任意点旋转其实就是把原图原点先平移到任意点，旋转相应角度后再平移回来。</strong></li><li><strong>假设任意点坐标为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           B 
          
         
           ( 
          
         
           m 
          
         
           x 
          
         
           , 
          
         
           n 
          
         
           y 
          
         
           ) 
          
         
        
          B(mx,ny) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mclose">)</span></span></span></span></span>,将原点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           0 
          
         
           , 
          
         
           0 
          
         
           ) 
          
         
        
          (0,0) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span>平移到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           B 
          
         
        
          B 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span></span></span></span></span>点,其实相当于把<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           A 
          
         
        
          A 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span>点进行同样的平移操作：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/3f/79/r2SGufdM_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>此时旋转中心就是新的“原点”，下面将<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           M 
          
         
        
          M 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">M</span></span></span></span></span>矩阵做旋转变换：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/50/fe/gX0rAEMh_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>旋转操作完成后，即可将当前图像重新平移回去：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/2b/20/JIcDDiNG_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>化简<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Y 
          
         
        
          Y 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span></span></span></span></span>中的变换矩阵可得：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/56/8a/CB3rzG4z_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_265"></a>函数原型</h4> 
<p><strong>warpAffine函数的函数原型见上文。</strong><br> <strong>着重介绍getRotationMatrix2D函数的使用。</strong></p> 
<pre><code class="prism language-python">retval	<span class="token operator">=</span>	cv<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span>	center<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> scale	<span class="token punctuation">)</span>
@参数说明：
<span class="token decorator annotation punctuation">@center</span>	Center of the rotation <span class="token keyword">in</span> the source image<span class="token punctuation">.</span>选定的旋转中心
<span class="token decorator annotation punctuation">@angle</span>	Rotation angle <span class="token keyword">in</span> degrees<span class="token punctuation">.</span> Positive values mean counter<span class="token operator">-</span>clockwise rotation <span class="token punctuation">(</span>the coordinate origin <span class="token keyword">is</span> assumed to be the top<span class="token operator">-</span>left corner<span class="token punctuation">)</span><span class="token punctuation">.</span>旋转角度（正值意味着顺时针旋转）
<span class="token decorator annotation punctuation">@scale</span>	Isotropic scale factor<span class="token punctuation">.</span>比例各向同性比例因子。
</code></pre> 
<h4><a id="_275"></a>实现一幅图像的旋转</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2

Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'T.jpg'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span><span class="token punctuation">;</span>
M<span class="token operator">=</span>cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">145</span><span class="token punctuation">,</span><span class="token number">420</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
ImgRotation <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>Img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'ImgRotation'</span><span class="token punctuation">,</span>ImgRotation<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'ImgRotation'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>resizeWindow<span class="token punctuation">(</span><span class="token string">'ImgRotation'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span>Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Original'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>


</code></pre> 
<p><strong>运行效果如下：</strong><br> <img src="https://images2.imgbox.com/e7/c4/pCEf0TbF_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注意到平移和旋转处理后图像都没有完全地显示出来（有黑边），故以旋转为例，尝试写出一套实现图像无损旋转的算法。</p> 
</blockquote> 
<h4><a id="_297"></a>实现图像绕中心点无损旋转</h4> 
<h5><a id="_299"></a>理论推导</h5> 
<p><strong>由上文推导可知，变换矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Γ 
         
        
       
         \Gamma 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">Γ</span></span></span></span></span>如下：</strong></p> 
<p><img src="https://images2.imgbox.com/09/91/UBJuhMe3_o.png" alt="在这里插入图片描述"></p> 
<p><strong>现在假设存在一幅图像经过相应旋转变换，原图与旋转后的图相对位置关系如下图所示：</strong></p> 
<p><img src="https://images2.imgbox.com/85/41/s497gfpv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>要使新图像能够完全显示，那么画布的长一定大于等于两条蓝线长度之和，画布的宽一定大于等于两条红线长度之和，设原图像高为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          h 
         
        
          ( 
         
        
          r 
         
        
          o 
         
        
          w 
         
        
          s 
         
        
          ) 
         
        
       
         h(rows) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span>，宽为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          w 
         
        
          ( 
         
        
          c 
         
        
          o 
         
        
          l 
         
        
          s 
         
        
          ) 
         
        
       
         w(cols) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span>，则用数学公式表达有：</strong><br> <img src="https://images2.imgbox.com/9d/9a/QGzrVgzD_o.png" alt=""></p> 
<p><strong>上述两式中旋转角<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          β 
         
        
       
         \beta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span></span></span></span>均为弧度制，但在编程中，我们并非常常使用弧度制，故还有以下表达：</strong><br> <img src="https://images2.imgbox.com/d4/21/x4lDY10Z_o.png" alt=""></p> 
<blockquote> 
 <p><strong>注意：新的画布扩大是基于原图左上角点（原点）扩大，显示区域同样丢失了信息.</strong></p> 
</blockquote> 
<p><strong>下一步，需要将画布按照旋转点位置进行平移（类比上文中绕任意点旋转等于平移再旋转再逆平移的原理），如下图所示，要将画布从蓝色区域平移至红色区域，但OpenCV的画布没有办法平移，只是由输入图像的大小决定，因此我们可以通过将图像平移回原来的位置进行解决，可以更改矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          M 
         
        
       
         M 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">M</span></span></span></span></span>的平移决定值：</strong><br> <img src="https://images2.imgbox.com/80/15/S8zkzFiX_o.png" alt=""><br> <img src="https://images2.imgbox.com/46/b2/b0t54gh0_o.png" alt="在这里插入图片描述"></p> 
<p><strong>代码如下：</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> cmath
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">opencv_rotate</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">:</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    center <span class="token operator">=</span> <span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    scale <span class="token operator">=</span> <span class="token number">1.0</span>
    <span class="token comment"># 2.1获取M矩阵</span>
    M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span>center<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> scale<span class="token punctuation">)</span>
    <span class="token comment"># 2.2 新的宽高，radians(angle) 把角度转为弧度 sin(弧度)</span>
    new_H <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>w <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> h <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    new_W <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>h <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> w <span class="token operator">*</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.3 平移</span>
    M<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>new_W <span class="token operator">-</span> w<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    M<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>new_H <span class="token operator">-</span> h<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    rotate <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>new_W<span class="token punctuation">,</span> new_H<span class="token punctuation">)</span><span class="token punctuation">,</span>flags <span class="token operator">=</span> cv2<span class="token punctuation">.</span>INTER_CUBIC borderValue<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rotate

IMG <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'T.jpg'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span>
opencv_rotate<span class="token punctuation">(</span>IMG<span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Rotation'</span><span class="token punctuation">,</span>opencv_rotate<span class="token punctuation">(</span>IMG<span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>运行结果如下：</strong></p> 
<p><img src="https://images2.imgbox.com/ec/20/8rItQ8xm_o.png" alt="在这里插入图片描述"></p> 
<p><strong>图片旋转中也涉及到图像插值的问题（可参考冈萨雷斯《数字图像处理》（第三版）第二章图像旋转部分的例子展示），插值方式对旋转变换后图像直边缘的保持具有重要作用。以下图片从左到右依次是上述代码采用最近邻、双线性、双三次插值得到的"T"字母直边缘放大1000倍的图像：</strong></p> 
<p><img src="https://images2.imgbox.com/18/2e/56zqs6Mv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_362"></a>仿射变换</h3> 
<p><strong>仿射变换是在旋转变换以及平移变换的基础上得来的。</strong><br> <strong>旋转变换和平移变换不会改变输入图像的形状，即使可以通过调整缩放因子来控制输出图像的大小，但是最后的输出图像与输入图像之间没有形状上的差异，这种变换称为刚性变换。</strong><br> <strong>而仿射变换并非刚性变换，它会造成图像的改变，但是并非完全无规则的改变。有以下特征：</strong></p> 
<ul><li><strong>平直性：直线变换过后依然是直线。</strong></li><li><strong>平行性：二维图形之间的相对位置关系保持不变，平行线依然是平行线，且直线上点的位置顺序不变。</strong><br> <strong>仿射变换可以写成如下形式：</strong></li></ul> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          { 
         
         
          
           
            
             
             
                 
              
              
              
                x 
               
              
                , 
               
              
             
               = 
              
             
               a 
              
             
               x 
              
             
               + 
              
             
               b 
              
             
               y 
              
             
               + 
              
             
               m 
              
             
            
           
           
            
             
            
           
          
          
           
            
             
             
                 
              
              
              
                y 
               
              
                , 
               
              
             
               = 
              
             
               c 
              
             
               x 
              
             
               + 
              
             
               d 
              
             
               y 
              
             
               + 
              
             
               n 
              
             
            
           
          
         
        
       
         \begin{cases} \ x^,=ax+by+m&amp;\\ \ y^,=cx+dy+n \end{cases} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3em; vertical-align: -1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{<!-- --></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.4369em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mpunct mtight">,</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">m</span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.4369em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mpunct mtight">,</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.19em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 1em;"></span><span class="col-align-l"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"></span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p><strong>注意到上述方程组中含有6个未知数，需要6个方程构成齐次方程组进行求解，要使方程有唯一解，必须要求这三个点不在同一直线上！因此，常说三个点确定唯一的仿射变换。</strong></p> 
<h4><a id="_378"></a>放射变换的变换矩阵推导</h4> 
<p><strong>较简单，不再赘述：</strong></p> 
<p><img src="https://images2.imgbox.com/ad/8a/YMgdk4x7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_384"></a>函数原型</h4> 
<p><strong>这里介绍的函数是求解仿射变换变换矩阵的函数——cv2.getAffineTransform(src,dst)</strong></p> 
<pre><code class="prism language-python">retval	<span class="token operator">=</span>	cv<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>	src<span class="token punctuation">,</span> dst	<span class="token punctuation">)</span>
@参数说明：
<span class="token decorator annotation punctuation">@src</span>	Coordinates of triangle vertices <span class="token keyword">in</span> the source image<span class="token punctuation">.</span>源图像中三角形顶点的坐标。

<span class="token decorator annotation punctuation">@dst</span>	Coordinates of the corresponding triangle vertices <span class="token keyword">in</span> the destination image<span class="token punctuation">.</span>目标图像中相应三角形顶点的坐标。


</code></pre> 
<h4><a id="_395"></a>实现仿射变换</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token comment">#读取图片</span>
Img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'T.jpg'</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#获取图片大小</span>
rows <span class="token operator">=</span> Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
cols <span class="token operator">=</span> Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment">#创建原图三角点与目标图像三角点</span>
Oritriangle <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Afftriangle <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#计算变换矩阵</span>
M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>Oritriangle<span class="token punctuation">,</span>Afftriangle<span class="token punctuation">)</span>
<span class="token comment">#实现仿射变换</span>
Img_Aff <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>Img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">,</span>flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span>
<span class="token comment">#展示原图与变换后图像并对比</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Img_Aff'</span><span class="token punctuation">,</span>Img_Aff<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Img'</span><span class="token punctuation">,</span>Img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>运行结果如下：</strong></p> 
<p><img src="https://images2.imgbox.com/d8/f7/JVJjJIW6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_424"></a>透视变换——在车道线检测上的应用</h3> 
<p><strong>见下一次笔记</strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/316697837057182d1edc47587015630b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Antv G6入门之旅--combo图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cf1718e71a3e82ab4440384d80ec5a89/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决chrome浏览器netWork响应数据中文乱码的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>