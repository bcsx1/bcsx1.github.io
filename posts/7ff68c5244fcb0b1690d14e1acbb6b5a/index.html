<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何爬取天猫评论数据 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何爬取天猫评论数据" />
<meta property="og:description" content="一、原理 首先在浏览器地址栏中输入https://www.tmall.com/打开天猫商城，任意检索某一商品，以奶粉为例，搜索结果如下图所示：
任意点开其中的某个商品：
这是我们常见的网页，由文字、图片和排版组成。现在将屏幕向下翻，直到看到“累计评价”，即下图中红色矩形圈起来的东西：
到目前为止这个页面没有任何评价信息，当用鼠标点击“累计评价”后，评价信息才会显示出来。信息并不会凭空产生，那么，这些信息是从哪里来的？显然是从服务器而来。具体的讲便是：
浏览器发送请求到服务器，告诉服务器自己需要显示某某商品的评论信息；服务器接到请求，查询某某商品的评论信息；服务器将查询到的评论信息发送给浏览器；浏览器接收到评论信息，将其解析为符合人类阅读习惯的格式，显示在网页上。 现在来看看这一过程具体是如何实现的。需要用到流量监控工具，火狐浏览器按Ctrl&#43;Q或F12可调出此工具。在火狐浏览器中，其界面如下：
页面下方的部分便是流量监控工具，它可以实时的显示该网页与外界通讯的情况，即流量。当然只会监控打开它之后的流量。主流浏览器都内置了此工具，可能会有不同的名称，但功能都大同小异，调出它的快捷键可能不同，但大都为F12。当然也有独立的功能更强大的专业流量监控工具，如WireShark等，不过这次使用浏览器内置的工具足矣。
以下部分强烈建议读者实际操作。网页结构经常会发生巨大改变，若在实践中发现有与下述不符的部分，实属正常。网页在变，但其原理不变。
我们利用流量监控工具来查看浏览器和服务器之间的通讯是如何完成的。在打开流量监控工具的情况下，点击“累计评价”，点击完成后可以看到流量监控工具捕捉到了许多数据包，即下图中红框框起来的部分：
其中每一行都是一个完整的通讯过程，包括了浏览器向服务器发出的请求和服务器返回的数据。可以看到，点击“累计评价”后，浏览器总共发出了9个数据包，请求不同的信息，也接收到了9个数据包，获得了不同的信息。用鼠标选中某一数据包，右键单击，再在弹出菜单中点击”Open in new tab”，就可以看到该数据包返回的文件的具体内容了。
但逐个查看，会发现评论信息并不存在于任何一个数据包中。这是因为流量监控工具只会监控打开它之后的流量，而第一页的评论在我们打开流量监控工具之前就已经加载了。现在我们先点流量监控工具右下角的“Clear”（这样做是为了减少无用的数据包，便于以后分析，不点也可以），然后将屏幕向下翻，点击“下一页”，再次捕捉流量，观察浏览器与服务器之间的通讯：
这次只有两个数据包，而且其中一个是图片，对另一个”Open in new tab”，可以看到如下页图中所示的内容，确实是评论信息。这个文件的后缀虽然是.html，但实际上是一个不规范的Json文件（JavaScript Object Notation，一种轻量级的数据交换格式）。有许多现成的库可以解析该格式的数据。
对比网页中的评论：
可以看到两者是相符的。
分析第一个数据包，Method为GET，也就是说，它仅仅通过URL来告诉服务器自己需要什么商品的评论信息。来分析下它的URL，是下面长长的一串：
https://rate.tmall.com/list_detail_rate.htm?itemId=44090725053&amp;spuId=324363453&amp;sellerId=725677994&amp;order=3&amp;currentPage=2&amp;append=0&amp;content=1&amp;tagId=&amp;posi=&amp;picture=&amp;ua=251UW5TcyMNYQwiAiwTR3tCf0J%2FQnhEcUpkMmQ%3D|Um5OcktzSXdDdkhxSnVMeS8%3D|U2xMHDJ%2BH2QJZwBxX39RaFF%2FX3E3VjBMPRNFEw%3D%3D|VGhXd1llXGReYFRhX2ZdYltuWWRGeEN5Q31EcEV7QnlMc01xSnNdCw%3D%3D|VWldfS0SMg41ASEbOxU5WDYSfg98UgRS|VmhIGCMaOAM4AzgDOgY5Bz8BOQU%2BHiMDPwA6BiYaJx8hGzsHOA0wECoVKAg0Cz4DIxkkHUsd|V2xMHDIcPAA6GicHPAI4bjg%3D|WGNDEz0TMw80FCgIMwk1YzU%3D|WWJCEjwSMgkzEysLMQsyZDI%3D|WmNDEz0TMws1Dy8bIRU1DDAMMGYw|W2JCEjwSMgs3Dy8bJhk5DDQONmA2|XGVFFTsVNQ8xCCgUKRAtDTkGOAxaDA%3D%3D|XWREFDoUNAg1DzQUKBUtEzMPMgY%2FBlAG|XmVFFTsVNQkzEy4OMg46DzpsOg%3D%3D|X2REFDoUNAgzEy8PMw87DzttOw%3D%3D|QHtbCyULKxAqCjISLhEtEil%2FKQ%3D%3D|QXhYCCYIKBArFzcDOgAgHCMYLBdBFw%3D%3D|QntbCyULKxIpETEEPAEhHSUcIBhOGA%3D%3D|Q3paCiRPKE4zXjhFa0t2VmlWaEh0T3VKfyl%2F|RH1dDSMNLRUuGjoGOwQ4GCYeJBsncSc%3D|RXxcDCIMLBUuEzMGPwcnGSIdIB1LHQ%3D%3D|Rn5eDiAOLn5HekBgVWtSBCQZORc5GSccJh0pfyk%3D|R35eDiAOLhcrFzcCPAgoFiwXKBZAFg%3D%3D|SHBQAC4AIHBEfUdnWGNcZ0dzT3ZWalJpS3BLcEtxTXdPcER7T3VVYFp6RHEnBzoaNBo6DjIKMQU7bTs%3D|SXBNcFBtTXJSbldrS3VNd1duTnBNbVJmRnlMbFZ2TW1VdUxsU21Nck1tUm5Oc1NyTm5PcFBxT29Od1duTm9UdEsd&amp;_ksTS=1457399262078_1440&amp;callback=jsonp1441 看上去很复杂，包含了很多参数。整理一下，按所含参数换行：
https://rate.tmall.com/list_detail_rate.htm ?itemId=44090725053 &amp;spuId=324363453 &amp;sellerId=725677994 &amp;order=3 &amp;currentPage=2 &amp;append=0 &amp;content=1 &amp;tagId= &amp;posi= &amp;picture= &amp;ua=251UW5TcyMNYQwiAiwTR3tCf0J/QnhEcUpkMmQ=|Um5OcktzSXdDdkhxSnVMeS8=|U2xMHDJ&#43;H2QJZwBxX39RaFF/X3E3VjBMPRNFEw==|VGhXd1llXGReYFRhX2ZdYltuWWRGeEN5Q31EcEV7QnlMc01xSnNdCw==|VWldfS0SMg41ASEbOxU5WDYSfg98UgRS|VmhIGCMaOAM4AzgDOgY5Bz8BOQU&#43;HiMDPwA6BiYaJx8hGzsHOA0wECoVKAg0Cz4DIxkkHUsd|V2xMHDIcPAA6GicHPAI4bjg=|WGNDEz0TMw80FCgIMwk1YzU=|WWJCEjwSMgkzEysLMQsyZDI=|WmNDEz0TMws1Dy8bIRU1DDAMMGYw|W2JCEjwSMgs3Dy8bJhk5DDQONmA2|XGVFFTsVNQ8xCCgUKRAtDTkGOAxaDA==|XWREFDoUNAg1DzQUKBUtEzMPMgY/BlAG|XmVFFTsVNQkzEy4OMg46DzpsOg==|X2REFDoUNAgzEy8PMw87DzttOw==|QHtbCyULKxAqCjISLhEtEil/KQ==|QXhYCCYIKBArFzcDOgAgHCMYLBdBFw==|QntbCyULKxIpETEEPAEhHSUcIBhOGA==|Q3paCiRPKE4zXjhFa0t2VmlWaEh0T3VKfyl/|RH1dDSMNLRUuGjoGOwQ4GCYeJBsncSc=|RXxcDCIMLBUuEzMGPwcnGSIdIB1LHQ==|Rn5eDiAOLn5HekBgVWtSBCQZORc5GSccJh0pfyk=|R35eDiAOLhcrFzcCPAgoFiwXKBZAFg==|SHBQAC4AIHBEfUdnWGNcZ0dzT3ZWalJpS3BLcEtxTXdPcER7T3VVYFp6RHEnBzoaNBo6DjIKMQU7bTs=|SXBNcFBtTXJSbldrS3VNd1duTnBNbVJmRnlMbFZ2TW1VdUxsU21Nck1tUm5Oc1NyTm5PcFBxT29Od1duTm9UdEsd &amp;_ksTS=1457399262078_1440 &amp;callback=jsonp1441 现在很清楚了，以下参数无疑是很关键的：
?itemId=44090725053 &amp;sellerId=725677994 &amp;currentPage=2 itemId是商品ID， sellerId 是卖家ID， currentPage是当前页码。基于此构造如下URL：
https://rate.tmall.com/list_detail_rate.htm? ItemId=44090725053 &amp;sellerId=725677994 &amp;currentPage=2 将其复制粘贴到浏览器地址栏后打开（当然先要去掉换行），可以看到同样的评论信息。把currentPage的值修改为1，便可以看到第1页的评论，修改为3，便可以看到第3页的评论。简单实验可知，可以看到前99页的评论（当然该商品得有这么多的评论），currentPage=100及以上时的内容与currentPage=99时相同。而若某商品评论较少，不足99页，例如只有45页，那么，currentPage=46及以上时的内容与currentPage=45时相同。
这样，只要知道某商品的itemId和sellerId就可以通过遍历currentPage获取该商品的所有的评论（前99页，人工不停地点“下一页”也最多只能翻到第99页）。 如何得知商品的itemId和sellerId呢？回到搜索“奶粉”后的界面（即第一张插图），把鼠标放在任意商品上，可以在浏览器左下角看到如下的URL：
查看网页源码：
放大后：
这个URL指向了商品详情页面，其中的id就是我们需要的itemId，user_id就是sellerId（可能对于天猫来说，卖家就是用户，所以叫user_id）。基于此，只要获取搜索结果页的各商品的URL就可以获得itemId和sellerId了。这件简单的事情用八爪鱼之类的数据采集器可以迅速完成。当然也可以自己写爬虫获取。
小结： 当我们在天猫商品详情页点“累计评价”时及查看评论翻页时，浏览器用如下的URL：
https://rate.tmall.com/list_detail_rate.htm? itemId=itemID&amp;sellerId=sellerID&amp;currentPage=N （省略了其他参数）来告诉服务器自己需要的是那个商品的第几页评论。服务器接到请求，查询该商品的特定评论并将查询结果返回给浏览器，浏览器解析并显示接收到评论信息。 经上面的试验已经知道，不打开天猫纷繁庞杂的电商网页，只发送申请评论信息的URL，产生很少的网络流量，也可以获得评论信息，这对爬取者和被爬取者来说都是一件好事。 以上便是爬取天猫评论信息的原理。总结一下：
打开https://www.tmall.com/；搜索某一商品名称；将搜索结果中的所有商品的url爬下来；从url中提取出itemId（id）和sellerId（user_id）；利用https://rate.tmall.com/list_detail_rate.htm?itemId=itemID&amp;sellerId=sellerID&amp;currentPage=N 遍历N（0 二、用Python实现的爬虫 基于以上原理用Python2.7写了一个以爬取千万级天猫评论数据为目标的爬虫，为避免文章过长，就不贴在这了，点 https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7ff68c5244fcb0b1690d14e1acbb6b5a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-25T15:21:14+08:00" />
<meta property="article:modified_time" content="2018-01-25T15:21:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何爬取天猫评论数据</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="一原理" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:2.15em; background-color:rgb(255,255,255)'> 一、原理</h3> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 首先在浏览器地址栏中输入<a target="_blank" href="https://www.tmall.com/" rel="nofollow noopener noreferrer" style="color:rgb(12,137,207)">https://www.tmall.com/</a>打开天猫商城，任意检索某一商品，以奶粉为例，搜索结果如下图所示：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/a6/7f/HgBBXNSi_o.jpg" alt="天猫奶粉搜索结果" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 任意点开其中的某个商品：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/2a/48/sPqsf9AE_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 这是我们常见的网页，由文字、图片和排版组成。现在将屏幕向下翻，直到看到“累计评价”，即下图中红色矩形圈起来的东西：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/19/d2/J28yb3W9_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 到目前为止这个页面没有任何评价信息，当用鼠标点击“累计评价”后，评价信息才会显示出来。信息并不会凭空产生，那么，这些信息是从哪里来的？显然是从服务器而来。具体的讲便是：</p> 
<ol style='line-height:27.2px; margin-bottom:1.7em; font-family:"microsoft yahei"; font-size:16px; background-color:rgb(255,255,255)'><li>浏览器发送请求到服务器，告诉服务器自己需要显示某某商品的评论信息；</li><li>服务器接到请求，查询某某商品的评论信息；</li><li>服务器将查询到的评论信息发送给浏览器；</li><li>浏览器接收到评论信息，将其解析为符合人类阅读习惯的格式，显示在网页上。</li></ol> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 现在来看看这一过程具体是如何实现的。需要用到流量监控工具，火狐浏览器按Ctrl+Q或F12可调出此工具。在火狐浏览器中，其界面如下：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/9c/35/ZTpCvEC5_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 页面下方的部分便是流量监控工具，它可以实时的显示该网页与外界通讯的情况，即流量。当然只会监控打开它之后的流量。主流浏览器都内置了此工具，可能会有不同的名称，但功能都大同小异，调出它的快捷键可能不同，但大都为F12。当然也有独立的功能更强大的专业流量监控工具，如WireShark等，不过这次使用浏览器内置的工具足矣。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 以下部分强烈建议读者实际操作。网页结构经常会发生巨大改变，若在实践中发现有与下述不符的部分，实属正常。网页在变，但其原理不变。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 我们利用流量监控工具来查看浏览器和服务器之间的通讯是如何完成的。在打开流量监控工具的情况下，点击“累计评价”，点击完成后可以看到流量监控工具捕捉到了许多数据包，即下图中红框框起来的部分：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/7b/d1/dSErySqo_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 其中每一行都是一个完整的通讯过程，包括了浏览器向服务器发出的请求和服务器返回的数据。可以看到，点击“累计评价”后，浏览器总共发出了9个数据包，请求不同的信息，也接收到了9个数据包，获得了不同的信息。用鼠标选中某一数据包，右键单击，再在弹出菜单中点击”Open in new tab”，就可以看到该数据包返回的文件的具体内容了。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 但逐个查看，会发现评论信息并不存在于任何一个数据包中。这是因为流量监控工具只会监控打开它之后的流量，而第一页的评论在我们打开流量监控工具之前就已经加载了。现在我们先点流量监控工具右下角的“Clear”（这样做是为了减少无用的数据包，便于以后分析，不点也可以），然后将屏幕向下翻，点击“下一页”，再次捕捉流量，观察浏览器与服务器之间的通讯：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/7f/44/j4npxYKz_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 这次只有两个数据包，而且其中一个是图片，对另一个”Open in new tab”，可以看到如下页图中所示的内容，确实是评论信息。这个文件的后缀虽然是.html，但实际上是一个不规范的Json文件（JavaScript Object Notation，一种轻量级的数据交换格式）。有许多现成的库可以解析该格式的数据。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/14/c3/pfMsaCSg_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 对比网页中的评论：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/89/a6/bKifXta3_o.jpg" alt="这里写图片描述" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 可以看到两者是相符的。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 分析第一个数据包，Method为GET，也就是说，它仅仅通过URL来告诉服务器自己需要什么商品的评论信息。来分析下它的URL，是下面长长的一串：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">https://rate.tmall.com/list_detail_rate.htm?itemId=44090725053&amp;spuId=324363453&amp;sellerId=725677994&amp;order=3&amp;currentPage=2&amp;append=0&amp;content=1&amp;tagId=&amp;posi=&amp;picture=&amp;ua=251UW5TcyMNYQwiAiwTR3tCf0J%2FQnhEcUpkMmQ%3D|Um5OcktzSXdDdkhxSnVMeS8%3D|U2xMHDJ%2BH2QJZwBxX39RaFF%2FX3E3VjBMPRNFEw%3D%3D|VGhXd1llXGReYFRhX2ZdYltuWWRGeEN5Q31EcEV7QnlMc01xSnNdCw%3D%3D|VWldfS0SMg41ASEbOxU5WDYSfg98UgRS|VmhIGCMaOAM4AzgDOgY5Bz8BOQU%2BHiMDPwA6BiYaJx8hGzsHOA0wECoVKAg0Cz4DIxkkHUsd|V2xMHDIcPAA6GicHPAI4bjg%3D|WGNDEz0TMw80FCgIMwk1YzU%3D|WWJCEjwSMgkzEysLMQsyZDI%3D|WmNDEz0TMws1Dy8bIRU1DDAMMGYw|W2JCEjwSMgs3Dy8bJhk5DDQONmA2|XGVFFTsVNQ8xCCgUKRAtDTkGOAxaDA%3D%3D|XWREFDoUNAg1DzQUKBUtEzMPMgY%2FBlAG|XmVFFTsVNQkzEy4OMg46DzpsOg%3D%3D|X2REFDoUNAgzEy8PMw87DzttOw%3D%3D|QHtbCyULKxAqCjISLhEtEil%2FKQ%3D%3D|QXhYCCYIKBArFzcDOgAgHCMYLBdBFw%3D%3D|QntbCyULKxIpETEEPAEhHSUcIBhOGA%3D%3D|Q3paCiRPKE4zXjhFa0t2VmlWaEh0T3VKfyl%2F|RH1dDSMNLRUuGjoGOwQ4GCYeJBsncSc%3D|RXxcDCIMLBUuEzMGPwcnGSIdIB1LHQ%3D%3D|Rn5eDiAOLn5HekBgVWtSBCQZORc5GSccJh0pfyk%3D|R35eDiAOLhcrFzcCPAgoFiwXKBZAFg%3D%3D|SHBQAC4AIHBEfUdnWGNcZ0dzT3ZWalJpS3BLcEtxTXdPcER7T3VVYFp6RHEnBzoaNBo6DjIKMQU7bTs%3D|SXBNcFBtTXJSbldrS3VNd1duTnBNbVJmRnlMbFZ2TW1VdUxsU21Nck1tUm5Oc1NyTm5PcFBxT29Od1duTm9UdEsd&amp;_ksTS=1457399262078_1440&amp;callback=jsonp1441
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 看上去很复杂，包含了很多参数。整理一下，按所含参数换行：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">https://rate.tmall.com/list_detail_rate.htm
?itemId=44090725053
&amp;spuId=324363453
&amp;sellerId=725677994
&amp;order=3
&amp;currentPage=2
&amp;append=0
&amp;content=1
&amp;tagId=
&amp;posi=
&amp;picture=
&amp;ua=251UW5TcyMNYQwiAiwTR3tCf0J/QnhEcUpkMmQ=|Um5OcktzSXdDdkhxSnVMeS8=|U2xMHDJ+H2QJZwBxX39RaFF/X3E3VjBMPRNFEw==|VGhXd1llXGReYFRhX2ZdYltuWWRGeEN5Q31EcEV7QnlMc01xSnNdCw==|VWldfS0SMg41ASEbOxU5WDYSfg98UgRS|VmhIGCMaOAM4AzgDOgY5Bz8BOQU+HiMDPwA6BiYaJx8hGzsHOA0wECoVKAg0Cz4DIxkkHUsd|V2xMHDIcPAA6GicHPAI4bjg=|WGNDEz0TMw80FCgIMwk1YzU=|WWJCEjwSMgkzEysLMQsyZDI=|WmNDEz0TMws1Dy8bIRU1DDAMMGYw|W2JCEjwSMgs3Dy8bJhk5DDQONmA2|XGVFFTsVNQ8xCCgUKRAtDTkGOAxaDA==|XWREFDoUNAg1DzQUKBUtEzMPMgY/BlAG|XmVFFTsVNQkzEy4OMg46DzpsOg==|X2REFDoUNAgzEy8PMw87DzttOw==|QHtbCyULKxAqCjISLhEtEil/KQ==|QXhYCCYIKBArFzcDOgAgHCMYLBdBFw==|QntbCyULKxIpETEEPAEhHSUcIBhOGA==|Q3paCiRPKE4zXjhFa0t2VmlWaEh0T3VKfyl/|RH1dDSMNLRUuGjoGOwQ4GCYeJBsncSc=|RXxcDCIMLBUuEzMGPwcnGSIdIB1LHQ==|Rn5eDiAOLn5HekBgVWtSBCQZORc5GSccJh0pfyk=|R35eDiAOLhcrFzcCPAgoFiwXKBZAFg==|SHBQAC4AIHBEfUdnWGNcZ0dzT3ZWalJpS3BLcEtxTXdPcER7T3VVYFp6RHEnBzoaNBo6DjIKMQU7bTs=|SXBNcFBtTXJSbldrS3VNd1duTnBNbVJmRnlMbFZ2TW1VdUxsU21Nck1tUm5Oc1NyTm5PcFBxT29Od1duTm9UdEsd
&amp;_ksTS=1457399262078_1440
&amp;callback=jsonp1441
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 现在很清楚了，以下参数无疑是很关键的：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">?itemId=44090725053
&amp;sellerId=725677994
&amp;currentPage=2
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> itemId是商品ID， sellerId 是卖家ID， currentPage是当前页码。基于此构造如下URL：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">https://rate.tmall.com/list_detail_rate.htm?
ItemId=44090725053
&amp;sellerId=725677994
&amp;currentPage=2
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 将其复制粘贴到浏览器地址栏后打开（当然先要去掉换行），可以看到同样的评论信息。把currentPage的值修改为1，便可以看到第1页的评论，修改为3，便可以看到第3页的评论。简单实验可知，可以看到前99页的评论（当然该商品得有这么多的评论），currentPage=100及以上时的内容与currentPage=99时相同。而若某商品评论较少，不足99页，例如只有45页，那么，currentPage=46及以上时的内容与currentPage=45时相同。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 这样，只要知道某商品的itemId和sellerId就可以通过遍历currentPage获取该商品的所有的评论（前99页，人工不停地点“下一页”也最多只能翻到第99页）。 <br> 如何得知商品的itemId和sellerId呢？回到搜索“奶粉”后的界面（即第一张插图），把鼠标放在任意商品上，可以在浏览器左下角看到如下的URL：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/93/5d/wVasLVi6_o.jpg" alt="左下角可以看到URL" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 查看网页源码：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/cf/94/WZ630HMY_o.jpg" alt="HTML中查看URL" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 放大后：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> <img src="https://images2.imgbox.com/c5/31/Exta26gW_o.jpg" alt="放大后的URL" title="" style="border:none; margin-top:15px; margin-bottom:15px; max-width:602px; max-height:100%; height:auto"></p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 这个URL指向了商品详情页面，其中的id就是我们需要的itemId，user_id就是sellerId（可能对于天猫来说，卖家就是用户，所以叫user_id）。基于此，只要获取搜索结果页的各商品的URL就可以获得itemId和sellerId了。这件简单的事情用<a target="_blank" href="http://www.bazhuayu.com/" rel="nofollow noopener noreferrer" style="color:rgb(12,137,207)">八爪鱼</a>之类的数据采集器可以迅速完成。当然也可以自己写爬虫获取。</p> 
<h5 id="小结" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t1" style="color:rgb(12,137,207)"></a>小结：</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 当我们在天猫商品详情页点“累计评价”时及查看评论翻页时，浏览器用如下的URL：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">https://rate.tmall.com/list_detail_rate.htm?
itemId=itemID&amp;sellerId=sellerID&amp;currentPage=N
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> （省略了其他参数）来告诉服务器自己需要的是那个商品的第几页评论。服务器接到请求，查询该商品的特定评论并将查询结果返回给浏览器，浏览器解析并显示接收到评论信息。 <br> 经上面的试验已经知道，不打开天猫纷繁庞杂的电商网页，只发送申请评论信息的URL，产生很少的网络流量，也可以获得评论信息，这对爬取者和被爬取者来说都是一件好事。 <br> 以上便是爬取天猫评论信息的原理。总结一下：</p> 
<ol style='line-height:27.2px; margin-bottom:1.7em; font-family:"microsoft yahei"; font-size:16px; background-color:rgb(255,255,255)'><li>打开<a target="_blank" href="https://www.tmall.com/" rel="nofollow noopener noreferrer" style="color:rgb(12,137,207)">https://www.tmall.com/</a>；</li><li>搜索某一商品名称；</li><li>将搜索结果中的所有商品的url爬下来；</li><li>从url中提取出itemId（id）和sellerId（user_id）；</li><li>利用<a target="_blank" href="https://rate.tmall.com/list_detail_rate.htm?itemId=itemID&amp;sellerId=sellerID&amp;currentPage=N" rel="nofollow noopener noreferrer" style="color:rgb(12,137,207)">https://rate.tmall.com/list_detail_rate.htm?itemId=itemID&amp;sellerId=sellerID&amp;currentPage=N</a> <br> 遍历N（0</li></ol> 
<h3 id="二用python实现的爬虫" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:2.15em; background-color:rgb(255,255,255)'> <a target="_blank" name="t2" style="color:rgb(12,137,207)"></a>二、用Python实现的爬虫</h3> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 基于以上原理用Python2.7写了一个以爬取千万级天猫评论数据为目标的爬虫，为避免文章过长，就不贴在这了，点 <br> <a target="_blank" href="https://github.com/Tian-Yu/Python-box/blob/master/rateList.py" style="color:rgb(12,137,207)" rel="noopener noreferrer">https://github.com/Tian-Yu/Python-box/blob/master/rateList.py</a> <br> 可以看到。只是初学者的水平，仅供参考。一下是几点说明：</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 这个程序会对每个商品产生一个日志文件，并且会在爬取完一个商品的评论信息时，删除上上一个商品的日志文件。这样做就避免了爬取1G的数据，产生1G多的日志，而其中有用的往往只是最后几百行。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 用到了Python的库pandas来解析Json。而引入正则库re的原因则是发送HTTP请求后接收到的数据并不是标准的Json，需要加工，去掉多余的部分，以使Json可以被正确的解析。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 文件itemId.txt 和sellerId.txt 中分别存放itemId和sellerId，一行一个相对应。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 考虑到爬虫程序往往会被部署到云主机运行，所以添加了邮件预警机制，即程序意外中断后会发送含有错误报告的邮件到指定的邮箱。在这里使用了配置较为简单的163邮箱作为发件邮箱，收件邮箱可以是任意的有效邮箱。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 若想使用该程序，请进行如下操作：</p> 
<h5 id="1配置邮箱" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t3" style="color:rgb(12,137,207)"></a>1.配置邮箱</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 修改在程序开头处的管理员邮箱，这个邮箱会接收程序运行的错误信息和完成信息：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">receiver = ["xxx@xxx.xxx",] 
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 正确配置函数 send163mail中的作为发件邮箱的163邮箱：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">sender = '************@163.com'  #设置发件邮箱，一定要自己注册的邮箱
pwd = '************'  #设置发件邮箱的密码，等会登陆会用到
</code></pre> 
<h5 id="2配置数据库" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t4" style="color:rgb(12,137,207)"></a>2.配置数据库</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 首先修改数据库配置部分：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">#在此处设置数据库连接信息
db_config = {
    "hostname": "localhost",#主机名
    "username": "root",#数据库用户名
    "password": "root",#数据库密码
    "databasename": "test",#要存入数据的数据库名
    }
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 然后进入Mysql执行一下语句创建数据库：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">CREATE DATABASE test DEFAULT charACTER SET utf8 COLLATE utf8_general_ci;
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 数据库名test可以随意修改，但两处要相同。</p> 
<h5 id="3准备itemidtxt-和selleridtxt" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t5" style="color:rgb(12,137,207)"></a>3.准备itemId.txt 和sellerId.txt</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 需要准备好各商品的itemId.txt 和sellerId.txt，同一类商品的itemId和sellerId分别存放在同一个文件中并放在以商品类别名命名的文件夹中，如下所示：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal"> . 
├── abc 
│   ├── itemId.txt 
│   └── sellerId.txt 
├── def 
│   ├── itemId.txt 
│   └── sellerId.txt 
├── ghi 
│   ├── itemId.txt 
│   └── sellerId.txt 
└── rateList.py 
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 采用如上所示的文件目录结构最后生成的数据库会是这样的：</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">mysql&gt; show tables; 
+----------------+ 
| Tables_in_test | 
+----------------+ 
| abc            | 
| def            | 
| ghi            | 
+----------------+ 
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 表abc中的数据是根据目录abc下的sellerId.txt 和itemId.txt 文件采集的。</p> 
<h5 id="4关于失效" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t6" style="color:rgb(12,137,207)"></a>4.关于失效</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 网页结构常常发生变化，使得爬虫程序常常失效。若失效了，请研究HTTP请求返回的原网页，尝试修改</p> 
<pre style="margin-right:0px; margin-bottom:10.5px; margin-left:0px; line-height:1.45; padding:10px; word-break:break-all; color:rgb(51,51,51); border-width:1px; border-style:solid"><code style="padding:0px; font-size:12.6px; color:inherit; background-color:transparent; white-space:pre; overflow-x:auto; word-wrap:normal">newjson = ''.join(re.findall(r'\"rateList\":(\[.*?\])\,\"searchinfo\"',response))
</code></pre> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 使正则匹配能顺利完成。当然改变太大了就只好大规模重写代码了。</p> 
<h5 id="5其他提示" style='margin-top:0.8em; margin-bottom:0.8em; padding:0px; font-family:"microsoft yahei"; font-weight:300; line-height:1.1; color:rgb(63,63,63); font-size:1.25em; background-color:rgb(255,255,255)'> <a target="_blank" name="t7" style="color:rgb(12,137,207)"></a>5.其他提示</h5> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> 在远程主机使用nohup python2 rateList.py &amp;命令（执行后若无命令提示符可按回车）可以确保退出ssh后爬虫程序继续运行。 <br> 用ls命令查看日志文件的文件名就可以知道爬取进度。使用tail命令查看日志文件的最后几行，可以方便的追踪日志。</p> 
<p style='margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; text-align:start; background-color:rgb(255,255,255)'> （PS: 欢迎访问我的独立博客：远山曲 <a target="_blank" href="https://blog.werner.wiki/" rel="nofollow noopener noreferrer" style="color:rgb(12,137,207)">https://blog.werner.wiki/</a>）</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc9733ea4a688790d51e14aca55140cf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Activity和Fragment之间的常规通信方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0b6520c9b450431db60db12da4f3671/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GFM 是 Github 拓展的基于 Markdown 的一种纯文本的书写格式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>