<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SDRAM contreoller控制器自刷新模块 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SDRAM contreoller控制器自刷新模块" />
<meta property="og:description" content="sdram controller 自刷新模块
首先明白为什么SDRAM需要自刷新模块，数据断电易失性，所以需要不断刷新来保持数据的有效性。
其次刷新周期为多少如下图所示：64ms/8192=7.8us=390CLK，即执行刷新命令时，至多需要间隔这么多个周期。
仲裁刷新可用状态机来表示：毕竟后面需要读写模块，利用状态机逻辑结构更加清楚明了。这里Flag_init_end还需要传送到自刷新模块，以生成刷新请求；
最后刷新时序如下所示：
1、送A0-A12给物理地址端口，送precharge命令到物理命令端口；
2、等待20ns（一个CLK）送AUTOREFRESH命令到物理命令端口；
3、根据时序图要执行两个自刷新命令，但是实际可以只执行一个也没问题；
调试过程：
仿真测试图：运行到初始化到205us程序正常，即初始化程序正常；
进行自刷新时报错，报错如下
装载寄存器出错；
查错：
1、可以发现仲裁器给自刷新模块的ref_en信号拉高后并没有拉低，导致自刷新模块在执行自刷新命令后，自刷新模块没有等待7.8us发出ref_req请求的情况下马上执行执行自刷新命令。
2、改正 1 的错误后又报错，可以发现没有cmd_reg 寄存器在执行自刷新模块时指令一直都是nop，而自刷新模块aref_cmd会改变，原因可能是顶层状态机模块对指令的赋值出错了；
顶层状态机地址赋值出错，修改后成功自刷新成功：
下面给出代码：
1、tb模块
`timescale 1ns/1ns module tb_sdram_top(); reg sclk; reg s_rstn; wire sdram_clk; wire sdram_cke; wire sdram_cs_n; wire sdram_cas_n; wire sdram_ras_n; wire sdram_we_n; wire [1:0] sdram_bank; wire [11:0] sdram_addr; wire [1:0] sdram_dqm; wire [15:0] sdram_dq; initial begin sclk&lt;=1; s_rstn&lt;=0; #100; s_rstn&lt;=1; end always #10 sclk=~sclk; sdram_top sdram_top_inst1( .sclk (sclk), ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/91d5d5f6d999aff4d9410ff6ed1011a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-11T23:08:38+08:00" />
<meta property="article:modified_time" content="2022-04-11T23:08:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SDRAM contreoller控制器自刷新模块</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>sdram controller 自刷新模块</p> 
<p>首先明白为什么SDRAM需要自刷新模块，数据断电易失性，所以需要不断刷新来保持数据的有效性。</p> 
<p>其次刷新周期为多少如下图所示：64ms/8192=7.8us=390CLK，即执行刷新命令时，至多需要间隔这么多个周期。</p> 
<p><img src="https://images2.imgbox.com/69/bf/GLVlO4kf_o.png" alt="在这里插入图片描述"><br> 仲裁刷新可用状态机来表示：毕竟后面需要读写模块，利用状态机逻辑结构更加清楚明了。这里Flag_init_end还需要传送到自刷新模块，以生成刷新请求；<br> <img src="https://images2.imgbox.com/91/21/63yWlvQp_o.png" alt="在这里插入图片描述"></p> 
<p>最后刷新时序如下所示：<br> 1、送A0-A12给物理地址端口，送precharge命令到物理命令端口；<br> 2、等待20ns（一个CLK）送AUTOREFRESH命令到物理命令端口；<br> 3、根据时序图要执行两个自刷新命令，但是实际可以只执行一个也没问题；<br> <img src="https://images2.imgbox.com/9b/ba/H3C1ppll_o.png" alt="在这里插入图片描述"><br> 调试过程：</p> 
<p>仿真测试图：运行到初始化到205us程序正常，即初始化程序正常；<br> <img src="https://images2.imgbox.com/fe/b7/40IGtNwq_o.png" alt="在这里插入图片描述"><br> 进行自刷新时报错，报错如下<br> <img src="https://images2.imgbox.com/79/cc/xp6xmIjc_o.png" alt="在这里插入图片描述"><br> 装载寄存器出错；<br> 查错：<br> 1、可以发现仲裁器给自刷新模块的ref_en信号拉高后并没有拉低，导致自刷新模块在执行自刷新命令后，自刷新模块没有等待7.8us发出ref_req请求的情况下马上执行执行自刷新命令。<br> <img src="https://images2.imgbox.com/c4/43/IVCm7Oal_o.png" alt="在这里插入图片描述"><br> 2、改正 1 的错误后又报错，可以发现没有cmd_reg 寄存器在执行自刷新模块时指令一直都是nop，而自刷新模块aref_cmd会改变，原因可能是顶层状态机模块对指令的赋值出错了；<br> <img src="https://images2.imgbox.com/9d/b7/GpFlqy3a_o.png" alt="在这里插入图片描述"><br> 顶层状态机地址赋值出错，修改后成功自刷新成功：<br> <img src="https://images2.imgbox.com/ed/01/Ly1IfIeW_o.png" alt="在这里插入图片描述"><br> 下面给出代码：<br> 1、tb模块</p> 
<pre><code class="prism language-bash">`timescale 1ns/1ns

module tb_sdram_top<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reg sclk<span class="token punctuation">;</span>
reg s_rstn<span class="token punctuation">;</span>


wire sdram_clk<span class="token punctuation">;</span>
wire sdram_cke<span class="token punctuation">;</span>
wire sdram_cs_n<span class="token punctuation">;</span>
wire sdram_cas_n<span class="token punctuation">;</span>
wire sdram_ras_n<span class="token punctuation">;</span>
wire sdram_we_n<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">1</span>:0<span class="token punctuation">]</span> sdram_bank<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">11</span>:0<span class="token punctuation">]</span> sdram_addr<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">1</span>:0<span class="token punctuation">]</span> sdram_dqm<span class="token punctuation">;</span>
wire <span class="token punctuation">[</span><span class="token number">15</span>:0<span class="token punctuation">]</span> sdram_dq<span class="token punctuation">;</span>



initial begin
	sclk<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
	s_rstn<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">#100;</span>
	s_rstn<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
end
always <span class="token comment">#10 sclk=~sclk;</span>




sdram_top sdram_top_inst1<span class="token punctuation">(</span>
	.sclk             <span class="token punctuation">(</span>sclk<span class="token punctuation">)</span>,
	.s_rstn           <span class="token punctuation">(</span>s_rstn<span class="token punctuation">)</span>,
	.sdram_clk        <span class="token punctuation">(</span>sdram_clk          <span class="token punctuation">)</span>,
	.sdram_cke        <span class="token punctuation">(</span>sdram_cke          <span class="token punctuation">)</span>,
	.sdram_cs_n       <span class="token punctuation">(</span>sdram_cs_n         <span class="token punctuation">)</span>,
	.sdram_cas_n      <span class="token punctuation">(</span>sdram_cas_n        <span class="token punctuation">)</span>,
	.sdram_ras_n      <span class="token punctuation">(</span>sdram_ras_n        <span class="token punctuation">)</span>,
	.sdram_we_n       <span class="token punctuation">(</span>sdram_we_n         <span class="token punctuation">)</span>,
	.sdram_bank       <span class="token punctuation">(</span>sdram_bank         <span class="token punctuation">)</span>,
	.sdram_addr       <span class="token punctuation">(</span>sdram_addr         <span class="token punctuation">)</span>,
	.sdram_dqm        <span class="token punctuation">(</span>sdram_dqm          <span class="token punctuation">)</span>,
	.sdram_dq         <span class="token punctuation">(</span>sdram_dq           <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>




sdram_model_plus sdram_model_plus_inst<span class="token punctuation">(</span>
	.Dq<span class="token punctuation">(</span>sdram_dq<span class="token punctuation">)</span>,
	.Addr<span class="token punctuation">(</span>sdram_addr<span class="token punctuation">)</span>,
	.Ba<span class="token punctuation">(</span>sdram_bank<span class="token punctuation">)</span>, 
	.Clk<span class="token punctuation">(</span>sdram_clk<span class="token punctuation">)</span>, 
	.Cke<span class="token punctuation">(</span>sdram_cke          <span class="token punctuation">)</span>, 
	.Cs_n<span class="token punctuation">(</span>sdram_cs_n         <span class="token punctuation">)</span>, 
	.Ras_n<span class="token punctuation">(</span>sdram_ras_n        <span class="token punctuation">)</span>, 
	.Cas_n<span class="token punctuation">(</span>sdram_cas_n        <span class="token punctuation">)</span>, 
	.We_n<span class="token punctuation">(</span>sdram_we_n         <span class="token punctuation">)</span>, 
	.Dqm<span class="token punctuation">(</span>sdram_dqm          <span class="token punctuation">)</span>,
	.Debug<span class="token punctuation">(</span><span class="token number">1</span>'b1<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

endmodule
</code></pre> 
<p>2、顶层模块</p> 
<pre><code class="prism language-bash">module sdram_top<span class="token punctuation">(</span>
	input sclk,
	input s_rstn,
	//sdram_interface
	output wire sdram_clk,
	output wire sdram_cke,
	output wire sdram_cs_n,
	output wire sdram_cas_n,
	output wire sdram_ras_n,
	output wire sdram_we_n,
	output wire <span class="token punctuation">[</span><span class="token number">1</span>:0<span class="token punctuation">]</span> sdram_bank,
	output wire <span class="token punctuation">[</span><span class="token number">11</span>:0<span class="token punctuation">]</span> sdram_addr,
	output wire <span class="token punctuation">[</span><span class="token number">1</span>:0<span class="token punctuation">]</span> sdram_dqm,
	inout  wire <span class="token punctuation">[</span><span class="token number">15</span>:0<span class="token punctuation">]</span> sdram_dq
<span class="token punctuation">)</span><span class="token punctuation">;</span>

localparam <span class="token assign-left variable">IDLE</span><span class="token operator">=</span><span class="token number">5</span><span class="token string">'b00_0001;
localparam ARBIT=5'</span>b00_0010<span class="token punctuation">;</span>
localparam <span class="token assign-left variable">AREF</span><span class="token operator">=</span><span class="token number">5</span><span class="token string">'b00_0100;

zhoong cai shua xin mo kuai
reg [4:0] state,next_state;
wire ref_req;
reg ref_en; 
wire flag_aref_end;
wire [3:0] ref_cmd;
wire [11:0] ref_addr;


wire flag_init_end;
wire [3:0] init_cmd;
wire [12:0] init_addr;

assign sdram_dqm=2'</span>b00<span class="token punctuation">;</span>
assign <span class="token assign-left variable">sdram_clk</span><span class="token operator">=~</span>sclk<span class="token punctuation">;</span>
assign <span class="token assign-left variable">sdram_cke</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>


//ZHONGCAI
always@<span class="token punctuation">(</span>posedge sclk or negedge s_rstn<span class="token punctuation">)</span> begin
	if<span class="token punctuation">(</span>~s_rstn<span class="token punctuation">)</span>
		state<span class="token operator">&lt;=</span>IDLE<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		state<span class="token operator">&lt;=</span>next_state<span class="token punctuation">;</span>
end

always @<span class="token punctuation">(</span>*<span class="token punctuation">)</span> begin
	<span class="token keyword">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> 
		IDLE:begin
			if<span class="token punctuation">(</span>flag_init_end<span class="token punctuation">)</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>ARBIT<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>IDLE<span class="token punctuation">;</span>
		end
		ARBIT:begin
			if<span class="token punctuation">(</span>ref_en<span class="token punctuation">)</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>AREF<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>ARBIT<span class="token punctuation">;</span>
		end
		AREF:begin
			if<span class="token punctuation">(</span>flag_aref_end<span class="token punctuation">)</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>ARBIT<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				<span class="token assign-left variable">next_state</span><span class="token operator">=</span>AREF<span class="token punctuation">;</span>
		end
		default:next_state<span class="token operator">=</span>IDLE<span class="token punctuation">;</span>
	endcase
end

//assign <span class="token punctuation">{<!-- --></span>sdram_cs_n,sdram_ras_n,sdram_cas_n,sdram_we_n<span class="token punctuation">}</span><span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">==</span>IDLE<span class="token punctuation">)</span>?init_cmd:ref_addr<span class="token punctuation">;</span>
//assign <span class="token punctuation">{<!-- --></span>sdram_cs_n,sdram_ras_n,sdram_cas_n,sdram_we_n<span class="token punctuation">}</span><span class="token operator">=</span> init_cmd<span class="token punctuation">;</span>
//assign <span class="token assign-left variable">sdram_addr</span><span class="token operator">=</span><span class="token punctuation">(</span>state<span class="token operator">==</span>IDLE<span class="token punctuation">)</span>?init_addr:ref_addr<span class="token punctuation">;</span>
//assign <span class="token assign-left variable">sdram_addr</span><span class="token operator">=</span>init_addr<span class="token punctuation">;</span>
reg sdram_cs_n_r,sdram_ras_n_r,sdram_cas_n_r,sdram_we_n_r<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">12</span>:0<span class="token punctuation">]</span> sdram_addr_r<span class="token punctuation">;</span>

always @<span class="token punctuation">(</span>*<span class="token punctuation">)</span> begin
	<span class="token keyword">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> 
		IDLE:begin
			<span class="token punctuation">{<!-- --></span>sdram_cs_n_r,sdram_ras_n_r,sdram_cas_n_r,sdram_we_n_r<span class="token punctuation">}</span><span class="token operator">=</span> init_cmd<span class="token punctuation">;</span>
			 <span class="token assign-left variable">sdram_addr_r</span><span class="token operator">=</span>init_addr<span class="token punctuation">;</span>
		end
		ARBIT:begin

		end
		AREF:begin
			<span class="token punctuation">{<!-- --></span>sdram_cs_n_r,sdram_ras_n_r,sdram_cas_n_r,sdram_we_n_r<span class="token punctuation">}</span><span class="token operator">=</span> ref_cmd<span class="token punctuation">;</span>
			 <span class="token assign-left variable">sdram_addr_r</span><span class="token operator">=</span>ref_addr<span class="token punctuation">;</span>
		end
		default:<span class="token punctuation">;</span>
	endcase
end

assign <span class="token punctuation">{<!-- --></span>sdram_cs_n,sdram_ras_n,sdram_cas_n,sdram_we_n<span class="token punctuation">}</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span>sdram_cs_n_r,sdram_ras_n_r,sdram_cas_n_r,sdram_we_n_r<span class="token punctuation">}</span><span class="token punctuation">;</span>
assign <span class="token assign-left variable">sdram_addr</span><span class="token operator">=</span>sdram_addr_r<span class="token punctuation">;</span>


always @<span class="token punctuation">(</span>posedge sclk or negedge s_rstn<span class="token punctuation">)</span> begin
	if<span class="token punctuation">(</span>~s_rstn<span class="token punctuation">)</span>
		ref_en<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token string">'b0;
	else if(state==ARBIT)
		ref_en&lt;=1'</span>b1<span class="token punctuation">;</span>
	<span class="token keyword">else</span> 
		ref_en<span class="token operator">&lt;=</span><span class="token number">1</span>'b0<span class="token punctuation">;</span>
end




sdram_init sdram_init_inst<span class="token punctuation">(</span>
.sclk<span class="token punctuation">(</span>sclk<span class="token punctuation">)</span>,
.s_rstn<span class="token punctuation">(</span>s_rstn<span class="token punctuation">)</span>,
.cmd_reg<span class="token punctuation">(</span>init_cmd<span class="token punctuation">)</span>,
.sdram_addr<span class="token punctuation">(</span>init_addr<span class="token punctuation">)</span>,
.flag_init_end<span class="token punctuation">(</span>flag_init_end<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>



sdram_aref sdram_aref_inst<span class="token punctuation">(</span>
    .sclk<span class="token punctuation">(</span>sclk<span class="token punctuation">)</span>,
    .s_rstn<span class="token punctuation">(</span>s_rstn<span class="token punctuation">)</span>,

    .ref_en<span class="token punctuation">(</span>ref_en<span class="token punctuation">)</span>,
    .ref_req<span class="token punctuation">(</span>ref_req<span class="token punctuation">)</span>,
    .flag_aref_end<span class="token punctuation">(</span>flag_aref_end<span class="token punctuation">)</span>,
    
    .aref_cmd<span class="token punctuation">(</span>ref_cmd<span class="token punctuation">)</span>,
    .sdram_addr<span class="token punctuation">(</span>ref_addr<span class="token punctuation">)</span>,
    .flag_init_end<span class="token punctuation">(</span>flag_init_end<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
endmodule
</code></pre> 
<p>3、初始化模块</p> 
<pre><code class="prism language-bash">module sdram_init <span class="token punctuation">(</span>
    input  wire sclk,
    input  wire s_rstn,
    output reg <span class="token punctuation">[</span><span class="token number">3</span>:0<span class="token punctuation">]</span> cmd_reg,
    output wire <span class="token punctuation">[</span><span class="token number">12</span>:0<span class="token punctuation">]</span>sdram_addr,
    output wire flag_init_end
    
<span class="token punctuation">)</span><span class="token punctuation">;</span>
//cs ras cas we
localparam <span class="token assign-left variable">DELAY_200US</span><span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">;</span>
localparam <span class="token assign-left variable">NOP</span><span class="token operator">=</span><span class="token number">4</span><span class="token string">'b0111;
localparam PREC=4'</span>b0010<span class="token punctuation">;</span>
localparam <span class="token assign-left variable">AREF</span><span class="token operator">=</span><span class="token number">4</span><span class="token string">'b0001;
localparam modset=4'</span>b0000<span class="token punctuation">;</span>
//localparam <span class="token assign-left variable">active</span><span class="token operator">=</span><span class="token number">4</span><span class="token string">'b1000;


reg [13:0] cnt_200us;
wire 	   flag_200us;
reg [3:0]  cnt_cmd;

//200us����
always @(posedge sclk or negedge s_rstn) begin
	if(~s_rstn)
		cnt_200us&lt;='</span>b0<span class="token punctuation">;</span>
	<span class="token keyword">else</span> if<span class="token punctuation">(</span>~flag_200us<span class="token punctuation">)</span>
		cnt_200us<span class="token operator">&lt;=</span>cnt_200us+1<span class="token string">'b1;
	else if(flag_200us)
		cnt_200us&lt;=cnt_200us;
end


always @(posedge sclk or negedge s_rstn) begin
	if(~s_rstn)
		cnt_cmd&lt;='</span>b0<span class="token punctuation">;</span>
	<span class="token keyword">else</span> if<span class="token punctuation">(</span>flag_200us <span class="token operator">&amp;</span> ~flag_init_end<span class="token punctuation">)</span>
		cnt_cmd<span class="token operator">&lt;=</span>cnt_cmd+1<span class="token string">'b1;
	//else if(flag_init_end)
	//	cnt_cmd&lt;='</span>b0<span class="token punctuation">;</span>
end

always @<span class="token punctuation">(</span>posedge sclk or negedge s_rstn<span class="token punctuation">)</span> begin
	if<span class="token punctuation">(</span>~s_rstn<span class="token punctuation">)</span>
		cmd_reg<span class="token operator">&lt;=</span>NOP<span class="token punctuation">;</span>
	//else if<span class="token punctuation">(</span>flag_200us <span class="token operator">&amp;&amp;</span> ~flag_init_end<span class="token punctuation">)</span> begin
	<span class="token keyword">else</span> if<span class="token punctuation">(</span>flag_200us<span class="token punctuation">)</span> begin
		case<span class="token punctuation">(</span>cnt_cmd<span class="token punctuation">)</span>
			<span class="token string">'d0:cmd_reg&lt;=PREC;//cmd_reg&lt;=NOP;
			'</span>d1:cmd_reg<span class="token operator">&lt;=</span>AREF<span class="token punctuation">;</span>
			<span class="token string">'d2:cmd_reg&lt;=NOP;
			'</span>d5:cmd_reg<span class="token operator">&lt;=</span>AREF<span class="token punctuation">;</span>
			<span class="token string">'d6:cmd_reg&lt;=NOP;
			'</span>d10:cmd_reg<span class="token operator">&lt;=</span>modset<span class="token punctuation">;</span>
			//<span class="token string">'d10:cmd_reg&lt;=NOP;
			//'</span>d11:cmd_reg<span class="token operator">&lt;=</span>active<span class="token punctuation">;</span>
			default:cmd_reg<span class="token operator">&lt;=</span>NOP<span class="token punctuation">;</span>
		endcase
	end
end
assign <span class="token assign-left variable">sdram_addr</span><span class="token operator">=</span><span class="token punctuation">(</span>cmd_reg<span class="token operator">==</span>modset<span class="token punctuation">)</span>？13<span class="token string">'b0_0000_0011_0010:13'</span>b0_0100_0000_0000<span class="token punctuation">;</span>
assign  <span class="token assign-left variable">flag_init_end</span><span class="token operator">=</span><span class="token punctuation">(</span>cnt_cmd<span class="token operator">&gt;=</span><span class="token string">'d11)?1'</span>b1:1<span class="token string">'b0;
assign flag_200us=(cnt_200us&gt;=DELAY_200US)?1'</span>b1:1'b0<span class="token punctuation">;</span>
endmodule
</code></pre> 
<p>4、自刷新模块</p> 
<pre><code class="prism language-bash">module sdram_aref<span class="token punctuation">(</span>
    input sclk,
    input s_rstn,

    input ref_en,
    output wire ref_req,
    output wire flag_aref_end,
    
    output reg <span class="token punctuation">[</span><span class="token number">3</span>:0<span class="token punctuation">]</span> aref_cmd,
    output wire <span class="token punctuation">[</span><span class="token number">12</span>:0<span class="token punctuation">]</span> sdram_addr,

    input flag_init_end

<span class="token punctuation">)</span><span class="token punctuation">;</span>

localparam <span class="token assign-left variable">DELAY_78US</span><span class="token operator">=</span><span class="token number">390</span><span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">3</span>:0<span class="token punctuation">]</span> cmd_cnt<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">9</span>:0<span class="token punctuation">]</span> ref_cnt<span class="token punctuation">;</span>
reg       flag_ref<span class="token punctuation">;</span>


localparam <span class="token assign-left variable">cmd_aref</span><span class="token operator">=</span><span class="token number">4</span><span class="token string">'b0001;
localparam cmd_nop=4'</span>b0111<span class="token punctuation">;</span>
localparam <span class="token assign-left variable">cmd_pre</span><span class="token operator">=</span><span class="token number">4</span><span class="token string">'b0010;



always @(posedge sclk or negedge s_rstn) begin
    if(~s_rstn)
        ref_cnt&lt;='</span>b0<span class="token punctuation">;</span>
    <span class="token keyword">else</span> if<span class="token punctuation">(</span>ref_cnt<span class="token operator">==</span>DELAY_78US-1<span class="token punctuation">)</span>
        ref_cnt<span class="token operator">&lt;=</span><span class="token string">'b0;
    else if(flag_init_end)
        ref_cnt&lt;=ref_cnt+1'</span>b1<span class="token punctuation">;</span>
end


always @<span class="token punctuation">(</span>posedge sclk or negedge s_rstn<span class="token punctuation">)</span> begin
    if<span class="token punctuation">(</span>~s_rstn<span class="token punctuation">)</span>
        flag_ref<span class="token operator">&lt;=</span><span class="token string">'b0;
    else if(flag_aref_end)
        flag_ref&lt;=1'</span>b0<span class="token punctuation">;</span>
	<span class="token keyword">else</span> if<span class="token punctuation">(</span>ref_en<span class="token punctuation">)</span>
        flag_ref<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token string">'b1;
end

always @(posedge sclk or negedge s_rstn) begin
    if(~s_rstn)
        cmd_cnt&lt;='</span>b0<span class="token punctuation">;</span>
    <span class="token keyword">else</span> if<span class="token punctuation">(</span>flag_ref<span class="token punctuation">)</span>
        cmd_cnt<span class="token operator">&lt;=</span>cmd_cnt+1<span class="token string">'b1;
    else 
        cmd_cnt&lt;='</span>b0<span class="token punctuation">;</span>
end



always @<span class="token punctuation">(</span>posedge sclk or negedge s_rstn<span class="token punctuation">)</span> begin
    if<span class="token punctuation">(</span>~s_rstn<span class="token punctuation">)</span>
        aref_cmd<span class="token operator">&lt;=</span>cmd_nop<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>flag_ref<span class="token punctuation">)</span>begin
        case<span class="token punctuation">(</span>cmd_cnt<span class="token punctuation">)</span>
            <span class="token number">1</span>:aref_cmd<span class="token operator">&lt;=</span>cmd_pre<span class="token punctuation">;</span>
            <span class="token number">2</span>:aref_cmd<span class="token operator">&lt;=</span>cmd_aref<span class="token punctuation">;</span>
            <span class="token number">7</span>:aref_cmd<span class="token operator">&lt;=</span>cmd_aref<span class="token punctuation">;</span>
            default:aref_cmd<span class="token operator">&lt;=</span>cmd_nop<span class="token punctuation">;</span>
        endcase
    end
    <span class="token keyword">else</span> begin
        aref_cmd<span class="token operator">&lt;=</span>cmd_nop<span class="token punctuation">;</span>
    end
end


assign <span class="token assign-left variable">sdram_addr</span><span class="token operator">=</span><span class="token number">13</span><span class="token string">'b0_0100_0000_0000;
assign ref_req=(ref_cnt==DELAY_78US-1)?1'</span>b1:1<span class="token string">'b0;
assign flag_aref_end=(cmd_cnt&gt;='</span>d7<span class="token punctuation">)</span>?1<span class="token string">'b1:1'</span>b0<span class="token punctuation">;</span>
endmodule
</code></pre> 
<p>5、SDRAM模型文件</p> 
<pre><code class="prism language-c"><span class="token comment">/**************************************************************************************
 ���ߣ�    ����
 2003-08-27    V0.1    ���� 
  
  �����ڴ�ģ�鵹�չ��ܣ����ⲿ��Ҫ�����¼���sdram_r ,��SDRAM�����ݽ��ᰴBank ˳��damp out ���ļ�
  sdram_data.txt ��
 ������������������������������������������������������������������������������������������������������������������������������������������������������������������������������*/</span>
 <span class="token comment">//2004-03-04    ���˿�    �޸�ԭ�����н�BANK������ת����TXT�ļ��ĸ�ʽ</span>
 <span class="token comment">//2004-03-16    ���˿�    �޸�SDRAM �ĳ�ʼ������</span>
 <span class="token comment">//2004/04/06    ���˿�    ��SDRAM�Ĳ����������ַ���ʽ��ʾ���Ա���MODELSIM����</span>
 <span class="token comment">//2004/04/19    ���˿�    �޸Ĳ��� parameter tAC  =   8;</span>
 <span class="token comment">//2010/09/17    ����    �޸�sdram�Ĵ�С������λ����dqm����;</span>
 <span class="token comment">/****************************************************************************************
 *
 *    File Name:  sdram_model.V  
 *      Version:  0.0f
 *         Date:  July 8th, 1999
 *        Model:  BUS Functional
 *    Simulator:  Model Technology (PC version 5.2e PE)
 *
 * Dependencies:  None
 *
 *       Author:  Son P. Huynh
 *        Email:  sphuynh@micron.com
 *        Phone:  (208) 368-3825
 *      Company:  Micron Technology, Inc.
 *        Model:  sdram_model (1Meg x 16 x 4 Banks)
 *
 *  Description:  64Mb SDRAM Verilog model
 *
 *   Limitation:  - Doesn't check for 4096 cycle refresh
 *
 *         Note:  - Set simulator resolution to "ps" accuracy
 *                - Set Debug = 0 to disable $display messages
 *
 *   Disclaimer:  THESE DESIGNS ARE PROVIDED "AS IS" WITH NO WARRANTY 
 *                WHATSOEVER AND MICRON SPECIFICALLY DISCLAIMS ANY 
 *                IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR
 *                A PARTICULAR PURPOSE, OR AGAINST INFRINGEMENT.
 *
 *                Copyright ?1998 Micron Semiconductor Products, Inc.
 *                All rights researved
 *
 * Rev   Author          Phone         Date        Changes
 * ----  ----------------------------  ----------  ---------------------------------------
 * 0.0f  Son Huynh       208-368-3825  07/08/1999  - Fix tWR = 1 Clk + 7.5 ns (Auto)
 *       Micron Technology Inc.                    - Fix tWR = 15 ns (Manual)
 *                                                 - Fix tRP (Autoprecharge to AutoRefresh)
 *
 * 0.0a  Son Huynh       208-368-3825  05/13/1998  - First Release (from 64Mb rev 0.0e)
 *       Micron Technology Inc.
 ****************************************************************************************/</span>
 
 `timescale <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">100</span>ps
 
 module <span class="token function">sdram_model_plus</span> <span class="token punctuation">(</span>Dq<span class="token punctuation">,</span> Addr<span class="token punctuation">,</span> Ba<span class="token punctuation">,</span> Clk<span class="token punctuation">,</span> Cke<span class="token punctuation">,</span> Cs_n<span class="token punctuation">,</span> Ras_n<span class="token punctuation">,</span> Cas_n<span class="token punctuation">,</span> We_n<span class="token punctuation">,</span> Dqm<span class="token punctuation">,</span>Debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
     parameter addr_bits <span class="token operator">=</span>    <span class="token number">13</span><span class="token punctuation">;</span>
     parameter data_bits <span class="token operator">=</span>     <span class="token number">16</span><span class="token punctuation">;</span>
     parameter col_bits  <span class="token operator">=</span>    <span class="token number">9</span><span class="token punctuation">;</span>
     parameter mem_sizes <span class="token operator">=</span>    <span class="token number">4</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//1 Meg </span>
 
     inout     <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Dq<span class="token punctuation">;</span>
     input     <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Addr<span class="token punctuation">;</span>
     input                 <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Ba<span class="token punctuation">;</span>
     input                         Clk<span class="token punctuation">;</span>
     input                         Cke<span class="token punctuation">;</span>
     input                         Cs_n<span class="token punctuation">;</span>
     input                         Ras_n<span class="token punctuation">;</span>
     input                         Cas_n<span class="token punctuation">;</span>
     input                         We_n<span class="token punctuation">;</span>
     input                 <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Dqm<span class="token punctuation">;</span>          <span class="token comment">//�ߵ͸�8bit</span>
     <span class="token comment">//added by xzli</span>
     input              Debug<span class="token punctuation">;</span>
 
     reg       <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank0 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> mem_sizes<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//�洢����������</span>
     reg       <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank1 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> mem_sizes<span class="token punctuation">]</span><span class="token punctuation">;</span>
     reg       <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank2 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> mem_sizes<span class="token punctuation">]</span><span class="token punctuation">;</span>
     reg       <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank3 <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> mem_sizes<span class="token punctuation">]</span><span class="token punctuation">;</span>
 
     reg                   <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank_addr <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// Bank Address Pipeline</span>
     reg        <span class="token punctuation">[</span>col_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Col_addr <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                 <span class="token comment">// Column Address Pipeline</span>
     reg                   <span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Command <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                  <span class="token comment">// Command Operation Pipeline</span>
     reg                   <span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Dqm_reg0<span class="token punctuation">,</span> Dqm_reg1<span class="token punctuation">;</span>               <span class="token comment">// DQM Operation Pipeline</span>
     reg       <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> B0_row_addr<span class="token punctuation">,</span> B1_row_addr<span class="token punctuation">,</span> B2_row_addr<span class="token punctuation">,</span> B3_row_addr<span class="token punctuation">;</span>
 
     reg       <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Mode_reg<span class="token punctuation">;</span>
     reg       <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Dq_reg<span class="token punctuation">,</span> Dq_dqm<span class="token punctuation">;</span>
     reg       <span class="token punctuation">[</span>col_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Col_temp<span class="token punctuation">,</span> Burst_counter<span class="token punctuation">;</span>
 
     reg                           Act_b0<span class="token punctuation">,</span> Act_b1<span class="token punctuation">,</span> Act_b2<span class="token punctuation">,</span> Act_b3<span class="token punctuation">;</span>   <span class="token comment">// Bank Activate</span>
     reg                           Pc_b0<span class="token punctuation">,</span> Pc_b1<span class="token punctuation">,</span> Pc_b2<span class="token punctuation">,</span> Pc_b3<span class="token punctuation">;</span>       <span class="token comment">// Bank Precharge</span>
 
     reg                   <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank_precharge     <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// Precharge Command</span>
     reg                           A10_precharge      <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// Addr[10] = 1 (All banks)</span>
     reg                           Auto_precharge     <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// RW AutoPrecharge (Bank)</span>
     reg                           Read_precharge     <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// R  AutoPrecharge</span>
     reg                           Write_precharge    <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">//  W AutoPrecharge</span>
     integer                       Count_precharge    <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// RW AutoPrecharge (Counter)</span>
     reg                           RW_interrupt_read  <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// RW Interrupt Read with Auto Precharge</span>
     reg                           RW_interrupt_write <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// RW Interrupt Write with Auto Precharge</span>
 
     reg                           Data_in_enable<span class="token punctuation">;</span>
     reg                           Data_out_enable<span class="token punctuation">;</span>
 
     reg                   <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Bank<span class="token punctuation">,</span> Previous_bank<span class="token punctuation">;</span>
     reg       <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Row<span class="token punctuation">;</span>
     reg        <span class="token punctuation">[</span>col_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> Col<span class="token punctuation">,</span> Col_brst<span class="token punctuation">;</span>
 
     <span class="token comment">// Internal system clock</span>
     reg                           CkeZ<span class="token punctuation">,</span> Sys_clk<span class="token punctuation">;</span>
 
     reg    <span class="token punctuation">[</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    dd<span class="token punctuation">;</span>
     
     <span class="token comment">// Commands Decode</span>
     wire      Active_enable    <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Ras_n <span class="token operator">&amp;</span>  Cas_n <span class="token operator">&amp;</span>  We_n<span class="token punctuation">;</span>
     wire      Aref_enable      <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Ras_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Cas_n <span class="token operator">&amp;</span>  We_n<span class="token punctuation">;</span>
     wire      Burst_term       <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span>  Ras_n <span class="token operator">&amp;</span>  Cas_n <span class="token operator">&amp;</span> <span class="token operator">~</span>We_n<span class="token punctuation">;</span>
     wire      Mode_reg_enable  <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Ras_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Cas_n <span class="token operator">&amp;</span> <span class="token operator">~</span>We_n<span class="token punctuation">;</span>
     wire      Prech_enable     <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Ras_n <span class="token operator">&amp;</span>  Cas_n <span class="token operator">&amp;</span> <span class="token operator">~</span>We_n<span class="token punctuation">;</span>
     wire      Read_enable      <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span>  Ras_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Cas_n <span class="token operator">&amp;</span>  We_n<span class="token punctuation">;</span>
     wire      Write_enable     <span class="token operator">=</span> <span class="token operator">~</span>Cs_n <span class="token operator">&amp;</span>  Ras_n <span class="token operator">&amp;</span> <span class="token operator">~</span>Cas_n <span class="token operator">&amp;</span> <span class="token operator">~</span>We_n<span class="token punctuation">;</span>
 
     <span class="token comment">// Burst Length Decode</span>
     wire      Burst_length_1   <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     wire      Burst_length_2   <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     wire      Burst_length_4   <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     wire      Burst_length_8   <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
     <span class="token comment">// CAS Latency Decode</span>
     wire      Cas_latency_2    <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     wire      Cas_latency_3    <span class="token operator">=</span> <span class="token operator">~</span>Mode_reg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>  Mode_reg<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
     <span class="token comment">// Write Burst Mode</span>
     wire      Write_burst_mode <span class="token operator">=</span> Mode_reg<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
     wire      Debug<span class="token punctuation">;</span>        <span class="token comment">// Debug messages : 1 = On; 0 = Off</span>
     wire      Dq_chk           <span class="token operator">=</span> Sys_clk <span class="token operator">&amp;</span> Data_in_enable<span class="token punctuation">;</span>      <span class="token comment">// Check setup/hold time for DQ</span>
 
     reg        <span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    mem_d<span class="token punctuation">;</span>
     
     event    sdram_r<span class="token punctuation">,</span>sdram_w<span class="token punctuation">,</span>compare<span class="token punctuation">;</span>
     
     
    
    
     assign    Dq               <span class="token operator">=</span> Dq_reg<span class="token punctuation">;</span>                        <span class="token comment">// DQ buffer</span>
 
     <span class="token comment">// Commands Operation</span>
     `define   ACT       <span class="token number">0</span>
     `define   NOP       <span class="token number">1</span>
     `define   READ      <span class="token number">2</span>
     `define   READ_A    <span class="token number">3</span>
     `define   WRITE     <span class="token number">4</span>
     `define   WRITE_A   <span class="token number">5</span>
     `define   PRECH     <span class="token number">6</span>
     `define   A_REF     <span class="token number">7</span>
     `define   BST       <span class="token number">8</span>
     `define   LMR       <span class="token number">9</span>
 
 <span class="token comment">//    // Timing Parameters for -75 (PC133) and CAS Latency = 2</span>
 <span class="token comment">//    parameter tAC  =   8;    //test 6.5</span>
 <span class="token comment">//    parameter tHZ  =   7.0;</span>
 <span class="token comment">//    parameter tOH  =   2.7;</span>
 <span class="token comment">//    parameter tMRD =   2.0;     // 2 Clk Cycles</span>
 <span class="token comment">//    parameter tRAS =  44.0;</span>
 <span class="token comment">//    parameter tRC  =  66.0;</span>
 <span class="token comment">//    parameter tRCD =  20.0;</span>
 <span class="token comment">//    parameter tRP  =  20.0;</span>
 <span class="token comment">//    parameter tRRD =  15.0;</span>
 <span class="token comment">//    parameter tWRa =   7.5;     // A2 Version - Auto precharge mode only (1 Clk + 7.5 ns)</span>
 <span class="token comment">//    parameter tWRp =  0.0;     // A2 Version - Precharge mode only (15 ns)</span>
 
     <span class="token comment">// Timing Parameters for -7 (PC143) and CAS Latency = 3</span>
     parameter tAC  <span class="token operator">=</span>   <span class="token number">6.5</span><span class="token punctuation">;</span>    <span class="token comment">//test 6.5</span>
     parameter tHZ  <span class="token operator">=</span>   <span class="token number">5.5</span><span class="token punctuation">;</span>
     parameter tOH  <span class="token operator">=</span>   <span class="token number">2</span><span class="token punctuation">;</span>
     parameter tMRD <span class="token operator">=</span>   <span class="token number">2.0</span><span class="token punctuation">;</span>     <span class="token comment">// 2 Clk Cycles</span>
     parameter tRAS <span class="token operator">=</span>  <span class="token number">48.0</span><span class="token punctuation">;</span>
     parameter tRC  <span class="token operator">=</span>  <span class="token number">70.0</span><span class="token punctuation">;</span>
     parameter tRCD <span class="token operator">=</span>  <span class="token number">20.0</span><span class="token punctuation">;</span>
     parameter tRP  <span class="token operator">=</span>  <span class="token number">20.0</span><span class="token punctuation">;</span>
     parameter tRRD <span class="token operator">=</span>  <span class="token number">14.0</span><span class="token punctuation">;</span>
     parameter tWRa <span class="token operator">=</span>   <span class="token number">7.5</span><span class="token punctuation">;</span>     <span class="token comment">// A2 Version - Auto precharge mode only (1 Clk + 7.5 ns)</span>
     parameter tWRp <span class="token operator">=</span>  <span class="token number">0.0</span><span class="token punctuation">;</span>     <span class="token comment">// A2 Version - Precharge mode only (15 ns)</span>
     
     <span class="token comment">// Timing Check variable</span>
     integer   MRD_chk<span class="token punctuation">;</span>
     integer   WR_counter <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     time      WR_chk <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     time      RC_chk<span class="token punctuation">,</span> RRD_chk<span class="token punctuation">;</span>
     time      RAS_chk0<span class="token punctuation">,</span> RAS_chk1<span class="token punctuation">,</span> RAS_chk2<span class="token punctuation">,</span> RAS_chk3<span class="token punctuation">;</span>
     time      RCD_chk0<span class="token punctuation">,</span> RCD_chk1<span class="token punctuation">,</span> RCD_chk2<span class="token punctuation">,</span> RCD_chk3<span class="token punctuation">;</span>
     time      RP_chk0<span class="token punctuation">,</span> RP_chk1<span class="token punctuation">,</span> RP_chk2<span class="token punctuation">,</span> RP_chk3<span class="token punctuation">;</span>
 
     integer    test_file<span class="token punctuation">;</span>
     
     <span class="token comment">//*****display the command of the sdram**************************************</span>
     
     parameter    Mode_Reg_Set    <span class="token operator">=</span><span class="token number">4</span>'b0000<span class="token punctuation">;</span>
     parameter    Auto_Refresh    <span class="token operator">=</span><span class="token number">4</span>'b0001<span class="token punctuation">;</span>
     parameter    Row_Active    <span class="token operator">=</span><span class="token number">4</span>'b0011<span class="token punctuation">;</span>
     parameter    Pre_Charge    <span class="token operator">=</span><span class="token number">4</span>'b0010<span class="token punctuation">;</span>
     parameter    PreCharge_All    <span class="token operator">=</span><span class="token number">4</span>'b0010<span class="token punctuation">;</span>
     parameter    Write        <span class="token operator">=</span><span class="token number">4</span>'b0100<span class="token punctuation">;</span>
     parameter    Write_Pre    <span class="token operator">=</span><span class="token number">4</span>'b0100<span class="token punctuation">;</span>
     parameter    Read        <span class="token operator">=</span><span class="token number">4</span>'b0101<span class="token punctuation">;</span>
     parameter    Read_Pre    <span class="token operator">=</span><span class="token number">4</span>'b0101<span class="token punctuation">;</span>
     parameter    Burst_Stop    <span class="token operator">=</span><span class="token number">4</span>'b0110<span class="token punctuation">;</span>
     parameter    Nop        <span class="token operator">=</span><span class="token number">4</span>'b0111<span class="token punctuation">;</span>
     parameter    Dsel        <span class="token operator">=</span><span class="token number">4</span>'b1111<span class="token punctuation">;</span>
 
     wire    <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    sdram_control<span class="token punctuation">;</span>
     reg            cke_temp<span class="token punctuation">;</span>
     reg        <span class="token punctuation">[</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">13</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span>    sdram_command<span class="token punctuation">;</span>
    
     always@<span class="token punctuation">(</span>posedge Clk<span class="token punctuation">)</span>
     cke_temp<span class="token operator">&lt;=</span>Cke<span class="token punctuation">;</span>
 
     assign    sdram_control<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>Cs_n<span class="token punctuation">,</span>Ras_n<span class="token punctuation">,</span>Cas_n<span class="token punctuation">,</span>We_n<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
     always@<span class="token punctuation">(</span>sdram_control or cke_temp<span class="token punctuation">)</span>
     begin
         <span class="token keyword">case</span><span class="token punctuation">(</span>sdram_control<span class="token punctuation">)</span>
             Mode_Reg_Set<span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Mode_Reg_Set"</span><span class="token punctuation">;</span>
             Auto_Refresh<span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Auto_Refresh"</span><span class="token punctuation">;</span>
             Row_Active<span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Row_Active"</span><span class="token punctuation">;</span>
             Pre_Charge<span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Pre_Charge"</span><span class="token punctuation">;</span>
             Burst_Stop<span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Burst_Stop"</span><span class="token punctuation">;</span>
             Dsel<span class="token operator">:</span>        sdram_command<span class="token operator">&lt;=</span><span class="token string">"Dsel"</span><span class="token punctuation">;</span>
 
             Write<span class="token operator">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>cke_temp<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Write"</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Write_suspend"</span><span class="token punctuation">;</span>
                         
             Read<span class="token operator">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>cke_temp<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Read"</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Read_suspend"</span><span class="token punctuation">;</span>
                         
             Nop<span class="token operator">:</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>cke_temp<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Nop"</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         sdram_command<span class="token operator">&lt;=</span><span class="token string">"Self_refresh"</span><span class="token punctuation">;</span>
                         
             <span class="token keyword">default</span><span class="token operator">:</span>    sdram_command<span class="token operator">&lt;=</span><span class="token string">"Power_down"</span><span class="token punctuation">;</span>
         endcase
     end
 
     <span class="token comment">//*****************************************************</span>
     
     initial 
         begin
         <span class="token comment">//test_file=$fopen("test_file.txt");</span>
     end
 
     initial 
         begin
         Dq_reg <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>data_bits<span class="token punctuation">{<!-- --></span><span class="token number">1</span>'bz<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>Data_in_enable<span class="token punctuation">,</span> Data_out_enable<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>Act_b0<span class="token punctuation">,</span> Act_b1<span class="token punctuation">,</span> Act_b2<span class="token punctuation">,</span> Act_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>Pc_b0<span class="token punctuation">,</span> Pc_b1<span class="token punctuation">,</span> Pc_b2<span class="token punctuation">,</span> Pc_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>WR_chk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_chk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_chk<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_chk<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>WR_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> WR_counter<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>RW_interrupt_read<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_read<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_read<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>RW_interrupt_write<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_write<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_write<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> RW_interrupt_write<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>MRD_chk<span class="token punctuation">,</span> RC_chk<span class="token punctuation">,</span> RRD_chk<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>RAS_chk0<span class="token punctuation">,</span> RAS_chk1<span class="token punctuation">,</span> RAS_chk2<span class="token punctuation">,</span> RAS_chk3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>RCD_chk0<span class="token punctuation">,</span> RCD_chk1<span class="token punctuation">,</span> RCD_chk2<span class="token punctuation">,</span> RCD_chk3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">{<!-- --></span>RP_chk0<span class="token punctuation">,</span> RP_chk1<span class="token punctuation">,</span> RP_chk2<span class="token punctuation">,</span> RP_chk3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         $<span class="token function">timeformat</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">" ns"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//$readmemh("bank0.txt", Bank0);</span>
         <span class="token comment">//$readmemh("bank1.txt", Bank1);</span>
         <span class="token comment">//$readmemh("bank2.txt", Bank2);</span>
         <span class="token comment">//$readmemh("bank3.txt", Bank3);</span>
 <span class="token comment">/*      
        for(dd=0;dd&lt;=mem_sizes;dd=dd+1)
             begin
                 Bank0[dd]=dd[data_bits - 1 : 0];
                 Bank1[dd]=dd[data_bits - 1 : 0]+1;
                 Bank2[dd]=dd[data_bits - 1 : 0]+2;
                 Bank3[dd]=dd[data_bits - 1 : 0]+3;
             end
 */</span>            
       <span class="token function">initial_sdram</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       end
  
         task    initial_sdram<span class="token punctuation">;</span> 
  
          input        data_sign<span class="token punctuation">;</span>
          reg    <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    data_sign<span class="token punctuation">;</span>
           
                <span class="token keyword">for</span><span class="token punctuation">(</span>dd<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>dd<span class="token operator">&lt;=</span>mem_sizes<span class="token punctuation">;</span>dd<span class="token operator">=</span>dd<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
             begin
                 mem_d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">,</span>data_sign<span class="token punctuation">}</span><span class="token punctuation">;</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>data_bits<span class="token operator">==</span><span class="token number">16</span><span class="token punctuation">)</span>
                     begin
                         Bank0<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank1<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank2<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank3<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                     end
                 <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data_bits<span class="token operator">==</span><span class="token number">32</span><span class="token punctuation">)</span>
                     begin
                         Bank0<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank1<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank2<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                         Bank3<span class="token punctuation">[</span>dd<span class="token punctuation">]</span><span class="token operator">=</span>mem_d<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                     end
             end    
           
                endtask
 
     <span class="token comment">// System clock generator</span>
     always
         begin
                @<span class="token punctuation">(</span>posedge Clk<span class="token punctuation">)</span>
                    begin
                         Sys_clk <span class="token operator">=</span> CkeZ<span class="token punctuation">;</span>
                         CkeZ <span class="token operator">=</span> Cke<span class="token punctuation">;</span>
                 end
             @<span class="token punctuation">(</span>negedge Clk<span class="token punctuation">)</span> 
                 begin
                         Sys_clk <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
         end
 
     always @ <span class="token punctuation">(</span>posedge Sys_clk<span class="token punctuation">)</span> begin
         <span class="token comment">// Internal Commamd Pipelined</span>
         Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Command<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Command<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> `NOP<span class="token punctuation">;</span>
 
         Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Col_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Col_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Col_addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>col_bits<span class="token punctuation">{<!-- --></span><span class="token number">1</span>'b0<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
         Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>'b0<span class="token punctuation">;</span>
 
         Bank_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         Bank_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>'b0<span class="token punctuation">;</span>
 
         A10_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> A10_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         A10_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> A10_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         A10_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> A10_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         A10_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
 
         <span class="token comment">// Dqm pipeline for Read</span>
         Dqm_reg0 <span class="token operator">=</span> Dqm_reg1<span class="token punctuation">;</span>
         Dqm_reg1 <span class="token operator">=</span> Dqm<span class="token punctuation">;</span>
 
         <span class="token comment">// Read or Write with Auto Precharge Counter</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         end
 
         <span class="token comment">// tMRD Counter</span>
         MRD_chk <span class="token operator">=</span> MRD_chk <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
 
         <span class="token comment">// tWR Counter for Write</span>
         WR_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> WR_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         WR_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> WR_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         WR_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> WR_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         WR_counter<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> WR_counter<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
 
         <span class="token comment">// Auto Refresh</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Aref_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t AREF : Auto Refresh"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// Auto Refresh to Auto Refresh</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RC_chk <span class="token operator">&lt;</span> tRC<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>Debug<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRC violation during Auto Refresh"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Precharge to Auto Refresh</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RP_chk0 <span class="token operator">&lt;</span> tRP <span class="token operator">||</span> $time <span class="token operator">-</span> RP_chk1 <span class="token operator">&lt;</span> tRP <span class="token operator">||</span> $time <span class="token operator">-</span> RP_chk2 <span class="token operator">&lt;</span> tRP <span class="token operator">||</span> $time <span class="token operator">-</span> RP_chk3 <span class="token operator">&lt;</span> tRP<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>Debug<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRP violation during Auto Refresh"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Precharge to Refresh</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Pc_b0 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b0 || Pc_b1 == 1'</span>b0 <span class="token operator">||</span> Pc_b2 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b0 || Pc_b3 == 1'</span>b0<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: All banks must be Precharge before Auto Refresh"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Record Current tRC time</span>
             RC_chk <span class="token operator">=</span> $time<span class="token punctuation">;</span>
         end
         
         <span class="token comment">// Load Mode Register</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Mode_reg_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             <span class="token comment">// Decode CAS Latency, Burst Length, Burst Type, and Write Burst Mode</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Pc_b0 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 &amp;&amp; Pc_b1 == 1'</span>b1 <span class="token operator">&amp;&amp;</span> Pc_b2 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 &amp;&amp; Pc_b3 == 1'</span>b1<span class="token punctuation">)</span> begin
                 Mode_reg <span class="token operator">=</span> Addr<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t LMR  : Load Mode Register"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// CAS Latency</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b010<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            CAS Latency      = 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b011<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            CAS Latency      = 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            CAS Latency      = Reserved"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Burst Length</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b000<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b001<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b010<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>'b011<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = 8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span>'b0111<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = Full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Length     = Reserved"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Burst Type</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Type       = Sequential"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Type       = Interleaved"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Burst Type       = Reserved"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Write Burst Mode</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Write Burst Mode = Programmed Burst Length"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Write Burst Mode = Single Location Access"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">else</span>
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"                            Write Burst Mode = Reserved"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: all banks must be Precharge before Load Mode Register"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// REF to LMR</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RC_chk <span class="token operator">&lt;</span> tRC<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRC violation during Load Mode Register"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// LMR to LMR</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>MRD_chk <span class="token operator">&lt;</span> tMRD<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tMRD violation during Load Mode Register"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             MRD_chk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         end
         
         <span class="token comment">// Active Block (Latch Bank Address and Row Address)</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Active_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b00 &amp;&amp; Pc_b0 == 1'</span>b1<span class="token punctuation">)</span> begin
                 <span class="token punctuation">{<!-- --></span>Act_b0<span class="token punctuation">,</span> Pc_b0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                 B0_row_addr <span class="token operator">=</span> Addr <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 RCD_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RAS_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ACT  : Bank = 0 Row = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Precharge to Activate Bank 0</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RP_chk0 <span class="token operator">&lt;</span> tRP<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRP violation during Activate bank 0"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b01 &amp;&amp; Pc_b1 == 1'</span>b1<span class="token punctuation">)</span> begin
                 <span class="token punctuation">{<!-- --></span>Act_b1<span class="token punctuation">,</span> Pc_b1<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                 B1_row_addr <span class="token operator">=</span> Addr <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 RCD_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RAS_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ACT  : Bank = 1 Row = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Precharge to Activate Bank 1</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RP_chk1 <span class="token operator">&lt;</span> tRP<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRP violation during Activate bank 1"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b10 &amp;&amp; Pc_b2 == 1'</span>b1<span class="token punctuation">)</span> begin
                 <span class="token punctuation">{<!-- --></span>Act_b2<span class="token punctuation">,</span> Pc_b2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                 B2_row_addr <span class="token operator">=</span> Addr <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 RCD_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RAS_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ACT  : Bank = 2 Row = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Precharge to Activate Bank 2</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RP_chk2 <span class="token operator">&lt;</span> tRP<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRP violation during Activate bank 2"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b11 &amp;&amp; Pc_b3 == 1'</span>b1<span class="token punctuation">)</span> begin
                 <span class="token punctuation">{<!-- --></span>Act_b3<span class="token punctuation">,</span> Pc_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                 B3_row_addr <span class="token operator">=</span> Addr <span class="token punctuation">[</span>addr_bits <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 RCD_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RAS_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ACT  : Bank = 3 Row = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Precharge to Activate Bank 3</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RP_chk3 <span class="token operator">&lt;</span> tRP<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRP violation during Activate bank 3"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b00 &amp;&amp; Pc_b0 == 1'</span>b0<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: Bank 0 is not Precharged."</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b01 &amp;&amp; Pc_b1 == 1'</span>b0<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: Bank 1 is not Precharged."</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b10 &amp;&amp; Pc_b2 == 1'</span>b0<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: Bank 2 is not Precharged."</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b11 &amp;&amp; Pc_b3 == 1'</span>b0<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: Bank 3 is not Precharged."</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Active Bank A to Active Bank B</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Previous_bank <span class="token operator">!=</span> Ba<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RRD_chk <span class="token operator">&lt;</span> tRRD<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRRD violation during Activate bank = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Load Mode Register to Active</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>MRD_chk <span class="token operator">&lt;</span> tMRD <span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tMRD violation during Activate bank = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Auto Refresh to Activate</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RC_chk <span class="token operator">&lt;</span> tRC<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>Debug<span class="token punctuation">)</span> begin
                 $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRC violation during Activate bank = %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Record variables for checking violation</span>
             RRD_chk <span class="token operator">=</span> $time<span class="token punctuation">;</span>
             Previous_bank <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
         end
         
         <span class="token comment">// Precharge Block</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Prech_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token punctuation">{<!-- --></span>Pc_b0<span class="token punctuation">,</span> Pc_b1<span class="token punctuation">,</span> Pc_b2<span class="token punctuation">,</span> Pc_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b1111<span class="token punctuation">;</span>
                 <span class="token punctuation">{<!-- --></span>Act_b0<span class="token punctuation">,</span> Act_b1<span class="token punctuation">,</span> Act_b2<span class="token punctuation">,</span> Act_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">4</span>'b0000<span class="token punctuation">;</span>
                 RP_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RP_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RP_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 RP_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t PRE  : Bank = ALL"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Activate to Precharge all banks</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk0 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk1 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> <span class="token operator">||</span>
                     <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk2 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk3 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRAS violation during Precharge all bank"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
                 <span class="token comment">// tWR violation check for write</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> WR_chk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> tWRp<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> WR_chk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> tWRp<span class="token punctuation">)</span> <span class="token operator">||</span>
                     <span class="token punctuation">(</span>$time <span class="token operator">-</span> WR_chk<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> tWRp<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> WR_chk<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> tWRp<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tWR violation during Precharge all bank"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> begin
                     <span class="token punctuation">{<!-- --></span>Pc_b0<span class="token punctuation">,</span> Act_b0<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                     RP_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t PRE  : Bank = 0"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Activate to Precharge Bank 0</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk0 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> begin
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRAS violation during Precharge bank 0"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     end
                 end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> begin
                     <span class="token punctuation">{<!-- --></span>Pc_b1<span class="token punctuation">,</span> Act_b1<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                     RP_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t PRE  : Bank = 1"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Activate to Precharge Bank 1</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk1 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> begin
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRAS violation during Precharge bank 1"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     end
                 end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> begin
                     <span class="token punctuation">{<!-- --></span>Pc_b2<span class="token punctuation">,</span> Act_b2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                     RP_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t PRE  : Bank = 2"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Activate to Precharge Bank 2</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk2 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> begin
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRAS violation during Precharge bank 2"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     end
                 end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> begin
                     <span class="token punctuation">{<!-- --></span>Pc_b3<span class="token punctuation">,</span> Act_b3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">2</span>'b10<span class="token punctuation">;</span>
                     RP_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t PRE  : Bank = 3"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">// Activate to Precharge Bank 3</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk3 <span class="token operator">&lt;</span> tRAS<span class="token punctuation">)</span> begin
                         $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRAS violation during Precharge bank 3"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     end
                 end
                 <span class="token comment">// tWR violation check for write</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> WR_chk<span class="token punctuation">[</span>Ba<span class="token punctuation">]</span> <span class="token operator">&lt;</span> tWRp<span class="token punctuation">)</span> begin
                     $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tWR violation during Precharge bank %d"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 end
             end
             <span class="token comment">// Terminate a Write Immediately (if same bank or all banks)</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_in_enable <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> Ba <span class="token operator">||</span> Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                 Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
             end
             <span class="token comment">// Precharge Command Pipeline for Read</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_3 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> `PRECH<span class="token punctuation">;</span>
                 Bank_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
                 A10_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_2 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> `PRECH<span class="token punctuation">;</span>
                 Bank_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
                 A10_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end
         end
         
         <span class="token comment">// Burst terminate</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_term <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
             <span class="token comment">// Terminate a Write Immediately</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_in_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
             end
             <span class="token comment">// Terminate a Read Depend on CAS Latency</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_3 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> `BST<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_2 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> `BST<span class="token punctuation">;</span>
             end
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t BST  : Burst Terminate"</span><span class="token punctuation">,</span>$time<span class="token punctuation">)</span><span class="token punctuation">;</span>
         end
         
         <span class="token comment">// Read, Write, Column Latch</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Read_enable <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 || Write_enable == 1'</span>b1<span class="token punctuation">)</span> begin
             <span class="token comment">// Check to see if bank is open (ACT)</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b00 &amp;&amp; Pc_b0 == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b01 &amp;&amp; Pc_b1 == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">||</span>
                 <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b10 &amp;&amp; Pc_b2 == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b11 &amp;&amp; Pc_b3 == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t ERROR: Cannot Read or Write - Bank %d is not Activated"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Activate to Read or Write</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RCD_chk0 <span class="token operator">&lt;</span> tRCD<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRCD violation during Read or Write to Bank 0"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RCD_chk1 <span class="token operator">&lt;</span> tRCD<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRCD violation during Read or Write to Bank 1"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RCD_chk2 <span class="token operator">&lt;</span> tRCD<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRCD violation during Read or Write to Bank 2"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Ba <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>$time <span class="token operator">-</span> RCD_chk3 <span class="token operator">&lt;</span> tRCD<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t ERROR: tRCD violation during Read or Write to Bank 3"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// Read Command</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Read_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token comment">// CAS Latency pipeline</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_3 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                         Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> `READ_A<span class="token punctuation">;</span>
                     end <span class="token keyword">else</span> begin
                         Command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> `READ<span class="token punctuation">;</span>
                     end
                     Col_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Addr<span class="token punctuation">;</span>
                     Bank_addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
                 end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Cas_latency_2 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                         Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> `READ_A<span class="token punctuation">;</span>
                     end <span class="token keyword">else</span> begin
                         Command<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> `READ<span class="token punctuation">;</span>
                     end
                     Col_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Addr<span class="token punctuation">;</span>
                     Bank_addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
                 end
 
                 <span class="token comment">// Read interrupt Write (terminate Write immediately)</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_in_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
 
             <span class="token comment">// Write Command</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Write_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> `WRITE_A<span class="token punctuation">;</span>
                 end <span class="token keyword">else</span> begin
                     Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> `WRITE<span class="token punctuation">;</span>
                 end
                 Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Addr<span class="token punctuation">;</span>
                 Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Ba<span class="token punctuation">;</span>
 
                 <span class="token comment">// Write interrupt Write (terminate Write immediately)</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_in_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
 
                 <span class="token comment">// Write interrupt Read (terminate Read immediately)</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_out_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end
 
             <span class="token comment">// Interrupting a Write with Autoprecharge</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 &amp;&amp; Write_precharge[Bank] == 1'</span>b1<span class="token punctuation">)</span> begin
                 RW_interrupt_write<span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Read/Write Bank %d interrupt Write Bank %d with Autoprecharge"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">,</span> Bank<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
 
             <span class="token comment">// Interrupting a Read with Autoprecharge</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 &amp;&amp; Read_precharge[Bank] == 1'</span>b1<span class="token punctuation">)</span> begin
                 RW_interrupt_read<span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Read/Write Bank %d interrupt Read Bank %d with Autoprecharge"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Ba<span class="token punctuation">,</span> Bank<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
 
             <span class="token comment">// Read or Write with Auto Precharge</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Addr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Auto_precharge<span class="token punctuation">[</span>Ba<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                 Count_precharge<span class="token punctuation">[</span>Ba<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Read_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Read_precharge<span class="token punctuation">[</span>Ba<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                 end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Write_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Write_precharge<span class="token punctuation">[</span>Ba<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                 end
             end
         end
 
         <span class="token comment">//  Read with Auto Precharge Calculation</span>
         <span class="token comment">//      The device start internal precharge:</span>
         <span class="token comment">//          1.  CAS Latency - 1 cycles before last burst</span>
         <span class="token comment">//      and 2.  Meet minimum tRAS requirement</span>
         <span class="token comment">//       or 3.  Interrupt by a Read or Write (with or without AutoPrecharge)</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Read_precharge[0] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk0 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                                                      <span class="token comment">// Case 2</span>
                 <span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span>                             <span class="token comment">// Case 1</span>
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_read<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin                                              <span class="token comment">// Case 3</span>
                     Pc_b0 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b0 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Read_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_read<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 0"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Read_precharge[1] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk1 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                 <span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Pc_b1 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b1 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Read_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_read<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 1"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Read_precharge[2] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk2 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                 <span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_read<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Pc_b2 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b2 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Read_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_read<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 2"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Read_precharge[3] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk3 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                 <span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_read<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Pc_b3 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b3 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Read_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_read<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 3"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
 
         <span class="token comment">// Internal Precharge or Bst</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `PRECH<span class="token punctuation">)</span> begin                         <span class="token comment">// Precharge terminate a read with same bank or all banks</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> Bank <span class="token operator">||</span> A10_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_out_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end
         end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `BST<span class="token punctuation">)</span> begin                  <span class="token comment">// BST terminate a read to current bank</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_out_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
             end
         end
 
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_out_enable <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span> begin
             Dq_reg <span class="token operator">&lt;=</span> #tOH <span class="token punctuation">{<!-- --></span>data_bits<span class="token punctuation">{<!-- --></span><span class="token number">1</span>'bz<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
         end
 
         <span class="token comment">// Detect Read or Write command</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `READ <span class="token operator">||</span> Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `READ_A<span class="token punctuation">)</span> begin
             Bank <span class="token operator">=</span> Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             Col <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             Col_brst <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B0_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B1_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B2_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B3_row_addr<span class="token punctuation">;</span>
             end
             Burst_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
             Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
             Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
         end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `WRITE <span class="token operator">||</span> Command<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> `WRITE_A<span class="token punctuation">)</span> begin
             Bank <span class="token operator">=</span> Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             Col <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             Col_brst <span class="token operator">=</span> Col_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B0_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B1_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B2_row_addr<span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank_addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> begin
                 Row <span class="token operator">=</span> B3_row_addr<span class="token punctuation">;</span>
             end
             Burst_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
             Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
             Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
         end
 
         <span class="token comment">// DQ buffer (Driver/Receiver)</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_in_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin                                   <span class="token comment">// Writing Data to Memory</span>
             <span class="token comment">// Array buffer</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank0 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank1 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank2 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank3 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token comment">// Dqm operation</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span> <span class="token number">7</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq <span class="token punctuation">[</span> <span class="token number">7</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq <span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token comment">//if (Dqm[2] == 1'b0) Dq_dqm [23 : 16] = Dq [23 : 16];</span>
            <span class="token comment">// if (Dqm[3] == 1'b0) Dq_dqm [31 : 24] = Dq [31 : 24];</span>
             <span class="token comment">// Write to memory</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> Bank0 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> Bank1 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> Bank2 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> Bank3 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span><span class="token char">'b11 &amp;&amp; Row==10'</span>h3 <span class="token operator">&amp;&amp;</span> Col<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">4</span>'h4<span class="token punctuation">)</span>
                 $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t WRITE: Bank = %d Row = %d, Col = %d, Data = Hi-Z due to DQM"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Bank<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//$fdisplay(test_file,"bank:%h    row:%h    col:%h    write:%h",Bank,Row,Col,Dq_dqm);</span>
             <span class="token comment">// Output result</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm <span class="token operator">==</span> <span class="token number">4</span>'b1111<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t WRITE: Bank = %d Row = %d, Col = %d, Data = Hi-Z due to DQM"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Bank<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t WRITE: Bank = %d Row = %d, Col = %d, Data = %d, Dqm = %b"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Bank<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">,</span> Dq_dqm<span class="token punctuation">,</span> Dqm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// Record tWR time and reset counter</span>
                 WR_chk <span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                 WR_counter <span class="token punctuation">[</span>Bank<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Advance burst counter subroutine</span>
             <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">t</span><span class="token expression">HZ Burst<span class="token punctuation">;</span></span></span>
         end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Data_out_enable <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin                         <span class="token comment">// Reading Data from Memory</span>
             <span class="token comment">//$display("%h    ,    %h,    %h",Bank0,Row,Col);</span>
             <span class="token comment">// Array buffer</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b00<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank0 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b01<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank1 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b10<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank2 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Bank <span class="token operator">==</span> <span class="token number">2</span>'b11<span class="token punctuation">)</span> Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Bank3 <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> Col<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 
             <span class="token comment">// Dqm operation</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm_reg0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) Dq_dqm [ 7 : 0] = 8'</span>bz<span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm_reg0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) Dq_dqm [15 : 8] = 8'</span>bz<span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm_reg0<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) Dq_dqm [23 : 16] = 8'</span>bz<span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm_reg0<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) Dq_dqm [31 : 24] = 8'</span>bz<span class="token punctuation">;</span>
             <span class="token comment">// Display result</span>
             Dq_reg <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> #tAC Dq_dqm <span class="token punctuation">[</span>data_bits <span class="token operator">-</span> <span class="token number">1</span>  <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Dqm_reg0 <span class="token operator">==</span> <span class="token number">4</span>'b1111<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t READ : Bank = %d Row = %d, Col = %d, Data = Hi-Z due to DQM"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Bank<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"at time %t READ : Bank = %d Row = %d, Col = %d, Data = %d, Dqm = %b"</span><span class="token punctuation">,</span> $time<span class="token punctuation">,</span> Bank<span class="token punctuation">,</span> Row<span class="token punctuation">,</span> Col<span class="token punctuation">,</span> Dq_reg<span class="token punctuation">,</span> Dqm_reg0<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
             <span class="token comment">// Advance burst counter subroutine</span>
             Burst<span class="token punctuation">;</span>
         end
     end
 
     <span class="token comment">//  Write with Auto Precharge Calculation</span>
     <span class="token comment">//      The device start internal precharge:</span>
     <span class="token comment">//          1.  tWR Clock after last burst</span>
     <span class="token comment">//      and 2.  Meet minimum tRAS requirement</span>
     <span class="token comment">//       or 3.  Interrupt by a Read or Write (with or without AutoPrecharge)</span>
     always @ <span class="token punctuation">(</span>WR_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> begin
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Write_precharge[0] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk0 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                                                          <span class="token comment">// Case 2</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 || Write_burst_mode == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span>   <span class="token comment">// Case 1</span>
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_write<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> WR_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> begin                           <span class="token comment">// Case 3 (stop count when interrupt)</span>
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Write_precharge<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_write<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">t</span><span class="token expression">WRa<span class="token punctuation">;</span>                          </span><span class="token comment">// Wait for tWR</span></span>
                     Pc_b0 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b0 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk0 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 0"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
     end
     always @ <span class="token punctuation">(</span>WR_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> begin
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Write_precharge[1] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk1 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 || Write_burst_mode == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_write<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> WR_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Write_precharge<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_write<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">t</span><span class="token expression">WRa<span class="token punctuation">;</span>                          </span><span class="token comment">// Wait for tWR</span></span>
                     Pc_b1 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b1 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk1 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 1"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
     end
     always @ <span class="token punctuation">(</span>WR_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> begin
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Write_precharge[2] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk2 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 || Write_burst_mode == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_write<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> WR_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Write_precharge<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_write<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">t</span><span class="token expression">WRa<span class="token punctuation">;</span>                          </span><span class="token comment">// Wait for tWR</span></span>
                     Pc_b2 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b2 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk2 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 2"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
     end
     always @ <span class="token punctuation">(</span>WR_counter<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> begin
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Auto_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1) &amp;&amp; (Write_precharge[3] == 1'</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>$time <span class="token operator">-</span> RAS_chk3 <span class="token operator">&gt;=</span> tRAS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span><span class="token char">'b1 || Write_burst_mode == 1'</span>b1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
                  <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> Count_precharge <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                  <span class="token punctuation">(</span>RW_interrupt_write<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1 <span class="token operator">&amp;&amp;</span> WR_counter<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> begin
                     Auto_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Write_precharge<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RW_interrupt_write<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">t</span><span class="token expression">WRa<span class="token punctuation">;</span>                          </span><span class="token comment">// Wait for tWR</span></span>
                     Pc_b3 <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
                     Act_b3 <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     RP_chk3 <span class="token operator">=</span> $time<span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>Debug<span class="token punctuation">)</span> $<span class="token function">display</span> <span class="token punctuation">(</span><span class="token string">"at time %t NOTE : Start Internal Auto Precharge for Bank 3"</span><span class="token punctuation">,</span> $time<span class="token punctuation">)</span><span class="token punctuation">;</span>
             end
         end
     end
 
     task Burst<span class="token punctuation">;</span>
         begin
             <span class="token comment">// Advance Burst Counter</span>
             Burst_counter <span class="token operator">=</span> Burst_counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
 
             <span class="token comment">// Burst Type</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Mode_reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b0<span class="token punctuation">)</span> begin                                  <span class="token comment">// Sequential Burst</span>
                 Col_temp <span class="token operator">=</span> Col <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Mode_reg<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin                         <span class="token comment">// Interleaved Burst</span>
                 Col_temp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Burst_counter<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span>  Col_brst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 Col_temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Burst_counter<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span>  Col_brst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 Col_temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span>  Burst_counter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span>  Col_brst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end
 
             <span class="token comment">// Burst Length</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_2<span class="token punctuation">)</span> begin                                       <span class="token comment">// Burst Length = 2</span>
                 Col <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_temp <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_4<span class="token punctuation">)</span> begin                              <span class="token comment">// Burst Length = 4</span>
                 Col <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_temp <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_8<span class="token punctuation">)</span> begin                              <span class="token comment">// Burst Length = 8</span>
                 Col <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Col_temp <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             end <span class="token keyword">else</span> begin                                                  <span class="token comment">// Burst Length = FULL</span>
                 Col <span class="token operator">=</span> Col_temp<span class="token punctuation">;</span>
             end
 
             <span class="token comment">// Burst Read Single Write            </span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Write_burst_mode <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
             end
 
             <span class="token comment">// Data Counter</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_1 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_counter <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_2 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_counter <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_4 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_counter <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_length_8 <span class="token operator">==</span> <span class="token number">1</span>'b1<span class="token punctuation">)</span> begin
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>Burst_counter <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> begin
                     Data_in_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                     Data_out_enable <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
                 end
             end
         end
     endtask
     
     <span class="token comment">//**********************��SDRAM�ڵ�����ֱ��������ⲿ�ļ�*******************************//</span>
 
 <span class="token comment">/*    
    integer    sdram_data,ind;
 
 
     always@(sdram_r)
     begin
            sdram_data=$fopen("sdram_data.txt");
            $display("Sdram dampout begin ",sdram_data);
 //           $fdisplay(sdram_data,"Bank0��");
            for(ind=0;ind&lt;=mem_sizes;ind=ind+1)
                     $fdisplay(sdram_data,"%h    %b",ind,Bank0[ind]);
 //           $fdisplay(sdram_data,"Bank1��");
            for(ind=0;ind&lt;=mem_sizes;ind=ind+1)
                     $fdisplay(sdram_data,"%h    %b",ind,Bank1[ind]);
 //           $fdisplay(sdram_data,"Bank2��");
            for(ind=0;ind&lt;=mem_sizes;ind=ind+1)
                     $fdisplay(sdram_data,"%h    %b",ind,Bank2[ind]);
 //               $fdisplay(sdram_data,"Bank3��");
            for(ind=0;ind&lt;=mem_sizes;ind=ind+1)
                     $fdisplay(sdram_data,"%h    %b",ind,Bank3[ind]);
                                       
           $fclose("sdram_data.txt");        
       //-&gt;compare;
       end        
 */</span>
     integer    sdram_data<span class="token punctuation">,</span>sdram_mem<span class="token punctuation">;</span>
     reg    <span class="token punctuation">[</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    aa<span class="token punctuation">,</span>cc<span class="token punctuation">;</span>
     reg    <span class="token punctuation">[</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>    bb<span class="token punctuation">,</span>ee<span class="token punctuation">;</span>
     
     always@<span class="token punctuation">(</span>sdram_r<span class="token punctuation">)</span>
     begin
            $<span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"Sdram dampout begin "</span><span class="token punctuation">,</span>$realtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sdram_data<span class="token operator">=</span>$<span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"sdram_data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>aa<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>aa<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span><span class="token punctuation">(</span>mem_sizes<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>aa<span class="token operator">=</span>aa<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                begin
                bb<span class="token operator">=</span>aa<span class="token punctuation">[</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>aa<span class="token operator">&lt;=</span>mem_sizes<span class="token punctuation">)</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_data<span class="token punctuation">,</span><span class="token string">"%0d    %0h"</span><span class="token punctuation">,</span>aa<span class="token punctuation">,</span>Bank0<span class="token punctuation">[</span>bb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>aa<span class="token operator">&lt;=</span><span class="token number">2</span><span class="token operator">*</span>mem_sizes<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                         $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_data<span class="token punctuation">,</span><span class="token string">"%0d    %0h"</span><span class="token punctuation">,</span>aa<span class="token punctuation">,</span>Bank1<span class="token punctuation">[</span>bb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>aa<span class="token operator">&lt;=</span><span class="token number">3</span><span class="token operator">*</span>mem_sizes<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_data<span class="token punctuation">,</span><span class="token string">"%0d    %0h"</span><span class="token punctuation">,</span>aa<span class="token punctuation">,</span>Bank2<span class="token punctuation">[</span>bb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_data<span class="token punctuation">,</span><span class="token string">"%0d    %0h"</span><span class="token punctuation">,</span>aa<span class="token punctuation">,</span>Bank3<span class="token punctuation">[</span>bb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               end                        
           $<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token string">"sdram_data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
           
           sdram_mem<span class="token operator">=</span>$<span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"sdram_mem.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span><span class="token punctuation">(</span>cc<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>cc<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span><span class="token punctuation">(</span>mem_sizes<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cc<span class="token operator">=</span>cc<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
               begin
                ee<span class="token operator">=</span>cc<span class="token punctuation">[</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>cc<span class="token operator">&lt;=</span>mem_sizes<span class="token punctuation">)</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_mem<span class="token punctuation">,</span><span class="token string">"%0h"</span><span class="token punctuation">,</span>Bank0<span class="token punctuation">[</span>ee<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cc<span class="token operator">&lt;=</span><span class="token number">2</span><span class="token operator">*</span>mem_sizes<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                         $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_mem<span class="token punctuation">,</span><span class="token string">"%0h"</span><span class="token punctuation">,</span>Bank1<span class="token punctuation">[</span>ee<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cc<span class="token operator">&lt;=</span><span class="token number">3</span><span class="token operator">*</span>mem_sizes<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_mem<span class="token punctuation">,</span><span class="token string">"%0h"</span><span class="token punctuation">,</span>Bank2<span class="token punctuation">[</span>ee<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span>
                 $<span class="token function">fdisplay</span><span class="token punctuation">(</span>sdram_mem<span class="token punctuation">,</span><span class="token string">"%0h"</span><span class="token punctuation">,</span>Bank3<span class="token punctuation">[</span>ee<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               end                        
           $<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token string">"sdram_mem.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
      
       end        
 
 
 
 <span class="token comment">//    // Timing Parameters for -75 (PC133) and CAS Latency = 2</span>
 <span class="token comment">//    specify</span>
 <span class="token comment">//        specparam</span>
 <span class="token comment">                    tAH  =  0.8,                                        // Addr, Ba Hold Time</span>
 <span class="token comment">                    tAS  =  1.5,                                        // Addr, Ba Setup Time</span>
 <span class="token comment">                    tCH  =  2.5,                                        // Clock High-Level Width</span>
 <span class="token comment">                    tCL  =  2.5,                                        // Clock Low-Level Width</span>
 <span class="token comment">//                    tCK  = 10.0,                                       // Clock Cycle Time  100mhz</span>
 <span class="token comment">//                    tCK  = 7.5,                        // Clock Cycle Time  133mhz</span>
 <span class="token comment">                    tCK  =  7,                                // Clock Cycle Time  143mhz</span>
 <span class="token comment">                    tDH  =  0.8,                                        // Data-in Hold Time</span>
 <span class="token comment">                    tDS  =  1.5,                                        // Data-in Setup Time</span>
 <span class="token comment">                    tCKH =  0.8,                                        // CKE Hold  Time</span>
 <span class="token comment">                    tCKS =  1.5,                                        // CKE Setup Time</span>
 <span class="token comment">                    tCMH =  0.8,                                        // CS#, RAS#, CAS#, WE#, DQM# Hold  Time</span>
 <span class="token comment">                    tCMS =  1.5;                                        // CS#, RAS#, CAS#, WE#, DQM# Setup Time</span>
 <span class="token comment">//                    tAH  =  1,                                        // Addr, Ba Hold Time</span>
 <span class="token comment">//                    tAS  =  1.5,                                        // Addr, Ba Setup Time</span>
 <span class="token comment">//                    tCH  =  1,                                        // Clock High-Level Width</span>
 <span class="token comment">//                    tCL  =  3,                                        // Clock Low-Level Width</span>
 <span class="token comment">                    tCK  = 10.0,                                       // Clock Cycle Time  100mhz</span>
 <span class="token comment">                    tCK  = 7.5,                        // Clock Cycle Time  133mhz</span>
 <span class="token comment">//                    tCK  =  7,                                // Clock Cycle Time  143mhz</span>
 <span class="token comment">//                    tDH  =  1,                                        // Data-in Hold Time</span>
 <span class="token comment">//                    tDS  =  2,                                        // Data-in Setup Time</span>
 <span class="token comment">//                    tCKH =  1,                                        // CKE Hold  Time</span>
 <span class="token comment">//                    tCKS =  2,                                        // CKE Setup Time</span>
 <span class="token comment">//                    tCMH =  0.8,                                        // CS#, RAS#, CAS#, WE#, DQM# Hold  Time</span>
 <span class="token comment">//                    tCMS =  1.5;                                        // CS#, RAS#, CAS#, WE#, DQM# Setup Time</span>
 <span class="token comment">//        $width    (posedge Clk,           tCH);</span>
 <span class="token comment">//        $width    (negedge Clk,           tCL);</span>
 <span class="token comment">//        $period   (negedge Clk,           tCK);</span>
 <span class="token comment">//        $period   (posedge Clk,           tCK);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Cke,   tCKS, tCKH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Cs_n,  tCMS, tCMH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Cas_n, tCMS, tCMH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Ras_n, tCMS, tCMH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    We_n,  tCMS, tCMH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Addr,  tAS,  tAH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Ba,    tAS,  tAH);</span>
 <span class="token comment">//        $setuphold(posedge Clk,    Dqm,   tCMS, tCMH);</span>
 <span class="token comment">//        $setuphold(posedge Dq_chk, Dq,    tDS,  tDH);</span>
 <span class="token comment">//    endspecify</span>
 
 endmodule

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd13e147f1aa399b93e01625f15d4b73/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux-4.4.72内核（uaf-tty_struct-babydriver）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f293fc387ff791d4fdca8fed4eacd3f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">phpstudy中MySQL无法启动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>