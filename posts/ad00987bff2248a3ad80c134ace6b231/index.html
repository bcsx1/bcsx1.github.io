<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬取电影信息 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="爬取电影信息" />
<meta property="og:description" content="之前爬取过基于html跳转的豆瓣TOP250网页，还有基于ajax跳转的美团评论网页，这次将介绍如何爬取基于html和ajax两种跳转方式且含有反爬虫程序和异常值的电影信息网页
电影信息网页链接：
http://movie.mtime.com/boxoffice/#CN/2019
爬取电影信息 1.分析网页(1)爬取目标(2)分析2018年的电影信息(3)分析点击2018年时10个页面的json文件(4)请求并筛取信息 2.提取信息(1)提取电影名及电影排名(2)提取首日票房数字(3)提取导演名字及模糊匹配(4)提取演员名字(5)字符串拼接(6)提取内容在同一字符串输出 3.代码异常处理及汇总(1)替换提取内容中的信息(2)代码汇总及保存 4.爬取2020年的电影信息(1)爬取2020年第一页电影信息(2)爬取2020年10页的电影信息(3)跳过错误继续爬取(4)记录代码运行时间 1.分析网页 (1)爬取目标 (2)分析2018年的电影信息 可以看出网页左边，电影年度可以分为2018,2019,2020年三个部分，我们先针对2018年时的网页进行分析并爬取
分析点击2018年时，第一页的网页链接：
切换到2018年时第二页的网页为：
分析结果：
据以上结果可看出，当点击选择到2018年的电影信息，并进行切换时，链接都为
http://movie.mtime.com/boxoffice/#CN/2018
切换网页时链接没有发生改变，说明在2018年的电影信息这个部分,网页是基于ajax跳转的，可利用抓包技术对网页进行爬取 (3)分析点击2018年时10个页面的json文件 寻找json文件方法：
找到页面json文件后复制链接的方法：
2018年时第一个页面的json文件链接为：
http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1586871242566&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json 2018年时第二个页面的json文件链接为：
http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=1&amp;display=list&amp;timestamp=1586871698868&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json 2018年时第十个页面的json文件链接为：
http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=9&amp;display=list&amp;timestamp=1586871775520&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json 对以上三个链接进行分析可得出，有以下两个个地方不一样：
第一个不同的地方：
因为我们找的是第一页，第二页和第十页的链接，所以此处的0,1,9表示的是第一页，第二页和第十页
第二个不同的地方：
此处的timestamp是时间戳
(4)请求并筛取信息 导入接下来要用的库 # 导入需要的库 import csv,requests,time from lxml import etree 设置浏览器代理，构造字典，向服务器请求json文件 # 导入需要的库 import csv,requests,time from lxml import etree # 设置浏览器代理，构造字典 headers={ &#39;User-Agent&#39;:&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36&#39; } #此处的url暂时放入的是page=0时，2018年的电影信息第一页 url=&#34;http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587124108705&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json&#34; requests." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ad00987bff2248a3ad80c134ace6b231/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-18T10:46:48+08:00" />
<meta property="article:modified_time" content="2020-04-18T10:46:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬取电影信息</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>之前爬取过基于html跳转的豆瓣TOP250网页，还有基于ajax跳转的美团评论网页，这次将介绍如何爬取基于html和ajax两种跳转方式且含有反爬虫程序和异常值的电影信息网页</p> 
</blockquote> 
<p>电影信息网页链接：<br> <code>http://movie.mtime.com/boxoffice/#CN/2019</code><br> </p> 
<div class="toc"> 
 <h4>爬取电影信息</h4> 
 <ul><li><ul><li><ul><li><ul><li><a href="#1_5" rel="nofollow">1.分析网页</a></li><li><ul><li><a href="#1_6" rel="nofollow">(1)爬取目标</a></li><li><a href="#22018_8" rel="nofollow">(2)分析2018年的电影信息</a></li><li><a href="#3201810json_17" rel="nofollow">(3)分析点击2018年时10个页面的json文件</a></li><li><a href="#4_46" rel="nofollow">(4)请求并筛取信息</a></li></ul> 
     </li><li><a href="#2_142" rel="nofollow">2.提取信息</a></li><li><ul><li><a href="#1_143" rel="nofollow">(1)提取电影名及电影排名</a></li><li><a href="#2_234" rel="nofollow">(2)提取首日票房数字</a></li><li><a href="#3_258" rel="nofollow">(3)提取导演名字及模糊匹配</a></li><li><a href="#4_311" rel="nofollow">(4)提取演员名字</a></li><li><a href="#5_357" rel="nofollow">(5)字符串拼接</a></li><li><a href="#6_369" rel="nofollow">(6)提取内容在同一字符串输出</a></li></ul> 
     </li><li><a href="#3_393" rel="nofollow">3.代码异常处理及汇总</a></li><li><ul><li><a href="#1_394" rel="nofollow">(1)替换提取内容中的信息</a></li><li><a href="#2_445" rel="nofollow">(2)代码汇总及保存</a></li></ul> 
     </li><li><a href="#42020_509" rel="nofollow">4.爬取2020年的电影信息</a></li><li><ul><li><a href="#12020_510" rel="nofollow">(1)爬取2020年第一页电影信息</a></li><li><a href="#2202010_566" rel="nofollow">(2)爬取2020年10页的电影信息</a></li><li><a href="#3_613" rel="nofollow">(3)跳过错误继续爬取</a></li><li><a href="#4_682" rel="nofollow">(4)记录代码运行时间</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h5><a id="1_5"></a>1.分析网页</h5> 
<h6><a id="1_6"></a>(1)爬取目标</h6> 
<p><img src="https://images2.imgbox.com/10/1d/X0bew9b5_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="22018_8"></a>(2)分析2018年的电影信息</h6> 
<p>可以看出网页左边，电影年度可以分为2018,2019,2020年三个部分，我们先针对2018年时的网页进行分析并爬取</p> 
<ul><li>分析点击2018年时，第一页的网页链接：<br> <img src="https://images2.imgbox.com/a2/d3/lDE9tOmG_o.png" alt="在这里插入图片描述">切换到2018年时第二页的网页为：<br> <img src="https://images2.imgbox.com/28/cf/Y15kQTQC_o.png" alt="在这里插入图片描述">分析结果：<br> 据以上结果可看出，当点击选择到2018年的电影信息，并进行切换时，链接都为<br> <code>http://movie.mtime.com/boxoffice/#CN/2018</code><br> 切换网页时链接没有发生改变，说明在2018年的电影信息这个部分,网页是基于<code>ajax</code>跳转的，可利用抓包技术对网页进行爬取</li></ul> 
<h6><a id="3201810json_17"></a>(3)分析点击2018年时10个页面的json文件</h6> 
<ul><li>寻找<code>json</code>文件方法：<br> <img src="https://images2.imgbox.com/8d/71/ccy73GR2_o.png" alt="在这里插入图片描述"></li><li>找到页面<code>json</code>文件后复制链接的方法：<br> <img src="https://images2.imgbox.com/89/99/faN2F49Q_o.png" alt="在这里插入图片描述"></li></ul> 
<p>2018年时第一个页面的<code>json</code>文件链接为：</p> 
<pre><code class="prism language-python">http<span class="token punctuation">:</span><span class="token operator">//</span>movie<span class="token punctuation">.</span>mtime<span class="token punctuation">.</span>com<span class="token operator">/</span>boxoffice<span class="token operator">/</span>?year<span class="token operator">=</span><span class="token number">2018</span><span class="token operator">&amp;</span>area<span class="token operator">=</span>china<span class="token operator">&amp;</span><span class="token builtin">type</span><span class="token operator">=</span>MovieRankingYear<span class="token operator">&amp;</span>category<span class="token operator">=</span><span class="token builtin">all</span><span class="token operator">&amp;</span>page<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>display<span class="token operator">=</span><span class="token builtin">list</span><span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1586871242566</span><span class="token operator">&amp;</span>version<span class="token operator">=</span><span class="token number">07bb781100018dd58eafc3b35d42686804c6df8d</span><span class="token operator">&amp;</span>dataType<span class="token operator">=</span>json
</code></pre> 
<p>2018年时第二个页面的<code>json</code>文件链接为：</p> 
<pre><code class="prism language-python">http<span class="token punctuation">:</span><span class="token operator">//</span>movie<span class="token punctuation">.</span>mtime<span class="token punctuation">.</span>com<span class="token operator">/</span>boxoffice<span class="token operator">/</span>?year<span class="token operator">=</span><span class="token number">2018</span><span class="token operator">&amp;</span>area<span class="token operator">=</span>china<span class="token operator">&amp;</span><span class="token builtin">type</span><span class="token operator">=</span>MovieRankingYear<span class="token operator">&amp;</span>category<span class="token operator">=</span><span class="token builtin">all</span><span class="token operator">&amp;</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>display<span class="token operator">=</span><span class="token builtin">list</span><span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1586871698868</span><span class="token operator">&amp;</span>version<span class="token operator">=</span><span class="token number">07bb781100018dd58eafc3b35d42686804c6df8d</span><span class="token operator">&amp;</span>dataType<span class="token operator">=</span>json
</code></pre> 
<p>2018年时第十个页面的<code>json</code>文件链接为：</p> 
<pre><code class="prism language-python">http<span class="token punctuation">:</span><span class="token operator">//</span>movie<span class="token punctuation">.</span>mtime<span class="token punctuation">.</span>com<span class="token operator">/</span>boxoffice<span class="token operator">/</span>?year<span class="token operator">=</span><span class="token number">2018</span><span class="token operator">&amp;</span>area<span class="token operator">=</span>china<span class="token operator">&amp;</span><span class="token builtin">type</span><span class="token operator">=</span>MovieRankingYear<span class="token operator">&amp;</span>category<span class="token operator">=</span><span class="token builtin">all</span><span class="token operator">&amp;</span>page<span class="token operator">=</span><span class="token number">9</span><span class="token operator">&amp;</span>display<span class="token operator">=</span><span class="token builtin">list</span><span class="token operator">&amp;</span>timestamp<span class="token operator">=</span><span class="token number">1586871775520</span><span class="token operator">&amp;</span>version<span class="token operator">=</span><span class="token number">07bb781100018dd58eafc3b35d42686804c6df8d</span><span class="token operator">&amp;</span>dataType<span class="token operator">=</span>json
</code></pre> 
<ul><li> <p>对以上三个链接进行分析可得出，有以下两个个地方不一样：<br> 第一个不同的地方：<br> <img src="https://images2.imgbox.com/d2/fe/iNzY93Ec_o.png" alt="在这里插入图片描述"><br> 因为我们找的是第一页，第二页和第十页的链接，所以此处的0,1,9表示的是第一页，第二页和第十页</p> <p>第二个不同的地方：<br> <img src="https://images2.imgbox.com/03/30/RxTfMvYO_o.png" alt="在这里插入图片描述"><br> 此处的<code>timestamp</code>是<strong>时间戳</strong></p> </li></ul> 
<h6><a id="4_46"></a>(4)请求并筛取信息</h6> 
<ul><li>导入接下来要用的库</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
</code></pre> 
<ul><li>设置浏览器代理，构造字典，向服务器请求<code>json</code>文件</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># 设置浏览器代理，构造字典</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
<span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>
    
<span class="token punctuation">}</span>
<span class="token comment">#此处的url暂时放入的是page=0时，2018年的电影信息第一页</span>
url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587124108705&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p>因为遇到了反爬虫程序，所以请求的<code>json</code>文件内容为乱码，运行结果为：<br> <img src="https://images2.imgbox.com/f1/98/th6fCT2b_o.png" alt="在这里插入图片描述">将<code>.text</code>去掉，再次运行：</p> 
<pre><code class="prism language-python"><span class="token comment"># 导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># 设置浏览器代理，构造字典</span>
<span class="token comment">#同时构造多个字典时，字典之间要用逗号隔开（不是在最后一个字典结尾加）</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
   <span class="token string">"Cookie"</span><span class="token punctuation">:</span><span class="token string">"userId=0; defaultCity=%25E5%258C%2597%25E4%25BA%25AC%257C290; _tt_=D9331474480AD125C85AB3E287E95970; __utmz=221034756.1586868641.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _userCode_=20204162141329; _userIdentity_=20204162141328735; _movies_=240425; _ydclearance=04675d66f1c55a48a22c96aa-331d-4098-8bbe-985e4209326e-1587128407; Hm_lvt_6dd1e3b818c756974fb222f0eae5512e=1586868641,1586911472,1587042989,1587121484; __utmc=221034756; __utma=221034756.607018261.1586868641.1587121484.1587123654.6; __utmt=1; __utmt_~1=1; Hm_lpvt_6dd1e3b818c756974fb222f0eae5512e=1587123708; __utmb=221034756.4.10.1587123654"</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>
    
<span class="token punctuation">}</span>
<span class="token comment">#此处的url暂时放入的是page=0时，2018年的电影信息第一页</span>
url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587124108705&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>  <span class="token comment">#向服务器请求内容，返回200代表成功不加.text时</span>
  <span class="token comment">#给返回的json文件内容赋值</span>
response
</code></pre> 
<p>运行结果为：<br> <img src="https://images2.imgbox.com/1f/f8/dyPugWJn_o.png" alt="在这里插入图片描述"></p> 
<ul><li>利用<code>cookie</code>解决请求<code>json</code>源代码时返回乱码的问题<br> 什么是<code>cookie</code>？<br> 相当于一个能够成功访问网页内容的钥匙，有了这个钥匙，在面对反爬虫程序时，我们就能成功破解反爬虫程序，使得请求源代码时成功返回内容，而不再返回乱码<br> 怎么找<code>cookie</code>值？<br> <img src="https://images2.imgbox.com/8f/26/9yrT4qd1_o.png" alt="在这里插入图片描述">将<code>cookie</code>值构造为字典：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># 设置浏览器代理，构造字典</span>
<span class="token comment">#同时构造多个字典时，字典之间要用逗号隔开（不是在最后一个字典结尾加）</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">"Cookie"</span><span class="token punctuation">:</span><span class="token string">"userId=0; defaultCity=%25E5%258C%2597%25E4%25BA%25AC%257C290; _tt_=D9331474480AD125C85AB3E287E95970; __utmz=221034756.1586868641.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _userCode_=20204162141329; _userIdentity_=20204162141328735; _movies_=240425; _ydclearance=04675d66f1c55a48a22c96aa-331d-4098-8bbe-985e4209326e-1587128407; Hm_lvt_6dd1e3b818c756974fb222f0eae5512e=1586868641,1586911472,1587042989,1587121484; __utmc=221034756; __utma=221034756.607018261.1586868641.1587121484.1587123654.6; __utmt=1; __utmt_~1=1; Hm_lpvt_6dd1e3b818c756974fb222f0eae5512e=1587123708; __utmb=221034756.4.10.1587123654"</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>
    
<span class="token punctuation">}</span>
<span class="token comment">#此处的url暂时放入的是page=0时，2018年的电影信息第一页</span>
url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1586871775520&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>

requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text   <span class="token comment">#向服务器请求内容，返回200代表成功 </span>
</code></pre> 
<p>运行结果为：<br> <img src="https://images2.imgbox.com/77/0c/YxdODFmB_o.png" alt="在这里插入图片描述"><br> 从结果可以看出，使用了<code>cookie</code>以后，向网页请求源代码时，成功返回了内容，不再是乱码</p> 
<p>在要返回值的后面加<code>.text</code>可以直接看到返回的内容，若不加，就会返回下面的结果，返回<code>200</code>表示请求成功，加或者不加<code>.text</code>都可以，可根据自己的需求来定<br> <img src="https://images2.imgbox.com/f0/25/Dd7N5E8U_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>另外还要注意一点，<code>cookie</code>值会根据时间变化，如头一天运行代码时所用的<code>cookie</code>值第二天来再次运行就会出现网页返回<code>json</code>文件内容仍然是乱码的情况，此时重新复制网页上的<code>cookie</code>值即可<br> 前后间隔一天的两个<code>cookie</code>值对比后发现，很多地方都发生了变化，说明<code>cookie</code>值这把钥匙具有时效性</p> </li><li> <p>从成功返回的<code>json</code>文件源代码中提取<code>html</code>文件<br> 将成功返回的<code>json</code>文件源代码放到<code>json</code>在线解析中进行解析：<br> 解析出的结果和在<code>jupyter</code>上成功返回的内容一样，如下：<br> <img src="https://images2.imgbox.com/24/d6/Y8J9jAP4_o.png" alt="在这里插入图片描述"><br> 可以看到其中有我们需要的<code>html</code>的内容，将它从<code>json</code>文件中提取出来：<br> 提取语句为：<code>response.json()["html"]</code><br> 提取后运行结果为：<br> <img src="https://images2.imgbox.com/90/ab/xgqywoTs_o.png" alt="在这里插入图片描述"><br> 与上一张运行结果相比，这张的运行结果缩小到了<code>html</code>中的内容，即从返回的<code>json</code>文件源代码中成功提取<code>html</code>文件</p> </li><li> <p>对从返回的<code>json</code>文件源代码中成功提取<code>html</code>文件网页信息进行解析，筛取</p> </li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行后无结果，也无错误，说明筛取信息成功</p> 
<h5><a id="2_142"></a>2.提取信息</h5> 
<h6><a id="1_143"></a>(1)提取电影名及电影排名</h6> 
<p>提取信息关键语句：<br> <code>html_etree.xpath('')</code>括号内为自己根据网页中要提取的内容的<code>html</code>语句而构造的查找提取信息的路径</p> 
<ul><li>怎么构造上述语句中的路径？(以提取2018年度第一页上的第一个电影“红海行动”为例)<br> <img src="https://images2.imgbox.com/22/93/8bi2TqOf_o.png" alt="在这里插入图片描述">按上述操作复制得到的<code>xpath</code>链接为：<br> <code>/html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/h3/a</code><br> <strong>这个链接是我们要提取的"红海行动"在整个<code>html</code>中的定位，而我们可以用另一种基于<code>html</code>标签的定位方式，来查找到这个信息的所在位置并提取，但这种基于<code>html</code>标签的定位方式需要我们自己根据网页中的<code>html</code>标签来构造路径</strong><br> 例如在爬取另外一个网页时，我们曾用过这样一个语句：<br> <img src="https://images2.imgbox.com/47/02/ELTnkAAH_o.png" alt="在这里插入图片描述">其中，<code>//*</code>表示在所有内容中查找，<code>[@id="content"]</code>表示在所有内容中要查找的目标信息，后缀的一系列链接为当时爬取网页的所有链接的共同部分<br> 基于以上例子，我们构造出提取"红海行动"时的路径为：</li></ul> 
<pre><code class="prism language-python"><span class="token operator">//</span>div<span class="token punctuation">[</span>@<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"boxofficelist"</span><span class="token punctuation">]</span><span class="token operator">/</span>div<span class="token operator">/</span>dd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>div<span class="token operator">/</span>div<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span>h3<span class="token operator">/</span>a
</code></pre> 
<p>各部分的标签含义、路径与标签间的对应关系如下：<br> <img src="https://images2.imgbox.com/b4/29/Aq9vxJiw_o.png" alt="在这里插入图片描述">其中，第一个<code>div</code>标签表示从<code>div</code>标签中查找<code>class="boxofficelist"</code>的部分以及路径后面的标签，层层推进，最终找到我们所要的目标信息，<code>dd[1]</code>表示"红海行动"所在的位置是第一个，即"红海行动"是该页面的第一个电影名，可以通过改动<code>dd[1]</code>中的数字来获取该页面的其他电影名，代码及运行结果如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token comment">#路径最后加了一个/text()表示将返回内容显示为文本</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/2e/f1/ijPCKyis_o.png" alt="在这里插入图片描述"><br> 目标提取信息“红海行动”提取成功</p> 
<p>获取该页面的最后一个电影名“前任3：再见前任”（改动<code>dd[1]</code>中的数字即可）：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd[10]/div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/94/14/0qJHYCcZ_o.png" alt="在这里插入图片描述"><br> <strong>要注意一点，此处<code>dd[1]</code>中的数字是按正常的从1开始排列的，并不是从0开始</strong></p> 
<ul><li>提取第一个页面中的所有电影名称</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment"># 自己构造的提取“红海行动”链接为：</span>
<span class="token comment">#//div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span> <span class="token comment">#循环该页面的十个电影名的链接</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"name="</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果为：<br> <img src="https://images2.imgbox.com/e0/59/AKkRP8AC_o.png" alt="在这里插入图片描述"><br> 构造循环链接时，与自己构造的提取“红海行动”链接之间的关系为：<br> <img src="https://images2.imgbox.com/9b/9c/i87DQa3I_o.png" alt="在这里插入图片描述"></p> 
<ul><li>提取第一个页面中的所有电影排名<br> 电影排名的链接为：<br> <code>/html/body/div[3]/div[2]/div[1]/div[2]/div/dd[10]/div/div[1]/i</code><br> 我们只要<code>dd[]</code>标签后面的部分<code>/div/div[1]/i</code>，将其写到循环体中，并另命名即可</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/7d/cf/lcIpqJKP_o.png" alt="在这里插入图片描述"></p> 
<ul><li>还可以在<code>rank=item.xpath('./div/div[1]/i/text()')</code>语句后添加一个<code>[0]</code>,就可使输出的结果的中括号和单引号去掉，其他输出结果同样适用，以下不再赘述此功能<br> <img src="https://images2.imgbox.com/7f/4f/lSxEiiF8_o.png" alt="在这里插入图片描述">此外，还有另外一种输出多个值的方法：<br> <code>print(rank,name)</code>可写为<code>print(rank+name)</code>，保存时需要以数组的形式保存到<code>csv</code>文件中，这样把所有提取输出的值放到一个数组中，便于保存<br> 运行结果为：<br> <img src="https://images2.imgbox.com/1d/a0/ebG2g87k_o.png" alt="在这里插入图片描述"><br> 例：</li></ul> 
<pre><code class="prism language-python">a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">]</span>
b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"c"</span><span class="token punctuation">,</span><span class="token string">"d"</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/d4/02/fH356pou_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2_234"></a>(2)提取首日票房数字</h6> 
<ul><li>选中票房数字，右击检查，选择<code>elements</code>,在票房数字处右击，选择<code>copy</code>，<code>copy xpath</code><br> <img src="https://images2.imgbox.com/be/62/cZ1syUfq_o.png" alt="在这里插入图片描述">代码及运行结果如下：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token punctuation">)</span>
    
<span class="token comment">#  首日票房人数的html路径 </span>
<span class="token comment"># /html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/p[1]/strong[1]</span>
<span class="token comment">#放到day中的只要dd[1]后面的部分</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/13/43/hgfeQrN6_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3_258"></a>(3)提取导演名字及模糊匹配</h6> 
<ul><li>按照以上的方法进行路径的拼接时，得到以下代码及运行结果：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#此时没有打印day的信息</span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/b/p[1]/a/text()'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token punctuation">)</span>    
<span class="token comment">#  导演名字的html路径 </span>
<span class="token comment">#/html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/b/p[1]/a，</span>
<span class="token comment">#放到director中的只要dd[1]后面的部分</span>
</code></pre> 
<p>运行结果为：<br> <img src="https://images2.imgbox.com/df/28/GfVMz2Xo_o.png" alt="在这里插入图片描述"><br> 可以发现，导演名字的输出信息为一个空的中括号，使用构造<code>html</code>的方法去查找导演名字这个信息并没有成功</p> 
<ul><li>没有输出导演名字的原因是<br> <img src="https://images2.imgbox.com/6e/ef/gT7BtbVU_o.png" alt="在这里插入图片描述"><br> 中的<code>b</code>标签查找时查找不了，故我们将使用模糊查询的方式，将<code>b</code>标签删去，即为：<br> <code>director=item.xpath('./div/div[2]//p[1]/a/text()')</code>但此时运行结果仍然如上图，输出不了导演名</li><li>上述将<code>b</code>标签删去仍输出不了的原因是<br> <img src="https://images2.imgbox.com/5d/66/AmmROcKP_o.png" alt="在这里插入图片描述"><br> <code>p[1]</code>标签中的数字(数字从1开始排列)不对，应为<code>p[3]</code>，分析如下图：<br> <img src="https://images2.imgbox.com/37/e7/yDuVMUr9_o.png" alt="在这里插入图片描述">所以提取导演名时应写为<code>p[3]</code></li><li>此时的运行代码及结果为：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#此时没有打印day的信息</span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token punctuation">)</span>
<span class="token comment">#  导演名字的html路径 /html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/b/p[1]/a，放到director中的只要dd[1]后面的部分</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/cd/db/KC6Y9Ewp_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="4_311"></a>(4)提取演员名字</h6> 
<ul><li>按之前提取电影名时自己构造路径的方式来提取时</li></ul> 
<pre><code class="prism language-python"> actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/b/p[2]/a[1]/text()'</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果为：<br> <img src="https://images2.imgbox.com/e2/b0/aCcPU0EL_o.png" alt="在这里插入图片描述"><br> 此时仍为<code>b</code>标签的问题，需要将<code>b</code>标签删去，并定位<code>p</code>标签中的数字序号</p> 
<ul><li>定位<code>p</code>标签中的数字序号：<br> <img src="https://images2.imgbox.com/09/d1/s2PSMzid_o.png" alt="在这里插入图片描述">根据图中标识的，提取演员名字时<code>p</code>标签中的数字序号为4</li><li>此时代码语句及运行结果为：</li></ul> 
<pre><code class="prism language-python"> actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a[1]/text()'</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/51/33/P00oXEb8_o.png" alt="在这里插入图片描述"><br> 因为复制的只是第一个演员的<code>html</code>语句，故只输出电影中的第一个演员名字，而一个电影中可能有多个演员的情况，再据下图：<br> <img src="https://images2.imgbox.com/6d/b7/ASlg6EGa_o.png" alt="在这里插入图片描述">图中演员名字在<code>a</code>标签中，<br> <code>actor=item.xpath('./div/div[2]//p[4]/a[1]/text()')</code>中，<code>a</code>标签中的数字表示第几个演员，以第一个电影红海行动为例，当<code>a[1]</code>时输出的是第一个演员的名字：张译，当我们改为<code>a[2]</code>时，输出的便是第二个演员的名字：黄景瑜，如下图：<br> <img src="https://images2.imgbox.com/be/b7/cWQPIcK6_o.png" alt="在这里插入图片描述"></p> 
<ul><li>而我们若想输出电影中的所有演员名字，写成<code>a</code>即可</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#首日票房数量 </span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#导演名字  </span>
    actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#所有演员名字</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span> <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token punctuation">)</span>
    
<span class="token comment">#  演员名字的html路径 /html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/b/p[2]/a[1]，放到actor中的只要dd[1]后面的部分</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/8f/95/NidsLdPy_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="5_357"></a>(5)字符串拼接</h6> 
<ul><li>例如将一个电影中的演员名字进行拼接<br> 语句<code>act="、".join(actor)</code>，<code>act</code> 为自己命名，<code>""</code>中的是拼接时的连接符，<code>.join</code>为拼接固定语法，<code>.join（）</code>括号中为要拼接的内容<br> 未拼接前演员名输出格式为：<br> <img src="https://images2.imgbox.com/93/19/gNDEyHtW_o.png" alt="在这里插入图片描述"><br> 拼接后演员名输出格式为：<br> <img src="https://images2.imgbox.com/b9/b3/0Ew630Br_o.png" alt="在这里插入图片描述"></li><li>若将拼接语句改为：<code>act="&amp;".join(actor)</code>，输出结果为：<br> <img src="https://images2.imgbox.com/a3/93/3jdI4wg2_o.png" alt="在这里插入图片描述"><br> 注意，以上拼接方式使用后，原输出结果的连接方式发生了改变，且<code>[]</code>也去掉了，但为了保存时方便，我们要把拼接后的内容转化为字符串，语句为：<code>act=[act]</code>,运行后拼接内容又加上了<code>[]</code>，变为了字符串：<br> 运行结果：<br> <img src="https://images2.imgbox.com/43/bf/EII2uDRn_o.png" alt="在这里插入图片描述"></li></ul> 
<h6><a id="6_369"></a>(6)提取内容在同一字符串输出</h6> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 筛取信息</span>
<span class="token comment">#  自己构造的提取“红海行动”链接为：</span>
<span class="token comment"># //div[@class="boxofficelist"]/div/dd[1]/div/div[2]/h3/a</span>

dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#首日票房数量</span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#导演名字</span>
    actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a/text()'</span><span class="token punctuation">)</span>       <span class="token comment">#所有演员名字</span>
    act<span class="token operator">=</span><span class="token string">"、"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>actor<span class="token punctuation">)</span>                            <span class="token comment">#拼接演员名字</span>
    act<span class="token operator">=</span><span class="token punctuation">[</span>act<span class="token punctuation">]</span>                                         <span class="token comment">#将拼接后的演员名转化为方便存储的字符串</span>
<span class="token comment">#     print(act)</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token punctuation">)</span>
    
<span class="token comment">#  演员名字的html路径 /html/body/div[3]/div[2]/div[1]/div[2]/div/dd[1]/div/div[2]/b/p[2]/a[1]，放到actor中的只要dd[1]后面的部分</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/c3/3c/bot5Mha9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_393"></a>3.代码异常处理及汇总</h5> 
<h6><a id="1_394"></a>(1)替换提取内容中的信息</h6> 
<ul><li>先使用构造路径的方法提取出每个电影中<strong>有多少人评分</strong>这个信息</li></ul> 
<pre><code class="prism language-python">score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span>
<span class="token comment">#提取电影中有多少人评分</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/3e/80/0ZmAIckB_o.png" alt="在这里插入图片描述">现在我们只想要评分人数，而不想要<strong>人评分</strong>三个字，可以使用之前介绍的正则表达式<code>re</code>,也可以使用专门提取数字的函数，这里我们将介绍替换表达式<code>.replace</code>来将不需要的内容替换成其他符号或内容</p> 
<ul><li>将"人评分"替换为&amp;符号</li></ul> 
<pre><code class="prism language-python">score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> 
<span class="token comment">#提取电影中有多少人评分</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         
     <span class="token comment">#将"人评分"替换为&amp;符号</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/9d/84/N7yoQ2mX_o.png" alt="在这里插入图片描述"></p> 
<ul><li>将"人评分"替换为空白，即<code>.replace</code>中第二个双引号中不写东西</li></ul> 
<pre><code class="prism language-python">score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> 
<span class="token comment">#提取电影中有多少人评分</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         
     <span class="token comment">#将"人评分"替换为空白</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/5d/6a/fo3OO3Ow_o.png" alt="在这里插入图片描述"></p> 
<ul><li>若此时将替换后的内容和上面一系列输出值一起输出</li></ul> 
<pre><code class="prism language-python">score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#提取电影中有多少人评分</span>
<span class="token comment">#     print(score[0].replace("人评分",""))          #将"人评分"替换为&amp;符号</span>
 score<span class="token operator">=</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span> 
 <span class="token comment"># #将替换后的评分人数赋值给score  ，方便和其他值一起输出   </span>
 <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span><span class="token comment">#同时输出多个值</span>
</code></pre> 
<p>可以发现，提示替换后的<code>score</code>是一个列表，无法和其他的值一起输出，因为其他值都是字符串，运行结果为：<br> <img src="https://images2.imgbox.com/cc/9f/EsCzHO0k_o.png" alt="在这里插入图片描述">所以我们要使用中括号，将替换后的<code>score</code>从列表转化为数组，才能和其他值一起输出，如下：</p> 
<pre><code class="prism language-python">    score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#提取电影中有多少人评分</span>
<span class="token comment">#     print(score[0].replace("人评分",""))          #将"人评分"替换为&amp;符号</span>
    score<span class="token operator">=</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token comment">#将替换后的评分人数赋值给score  </span>
    score<span class="token operator">=</span><span class="token punctuation">[</span>score<span class="token punctuation">]</span>                        <span class="token comment">#将替换后的评分人数转化为方便存储的字符串</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span><span class="token comment">#同时输出多个值</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/c2/57/31CsH4Kf_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2_445"></a>(2)代码汇总及保存</h6> 
<pre><code class="prism language-python"><span class="token comment">#代码汇总</span>
<span class="token comment">#1.导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time<span class="token punctuation">,</span>re
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment">#2.记录起始时间</span>
startTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment">#3.复制要爬取的链接，此处为2018年时的第一页</span>
url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2018&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587166514122&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>

<span class="token comment">#4. 设置浏览器代理，构造字典同时构造多个字典时，字典之间要用逗号隔开（不是在最后一个字典结尾加）</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
   <span class="token string">"Cookie"</span><span class="token punctuation">:</span><span class="token string">"userId=0; defaultCity=%25E5%258C%2597%25E4%25BA%25AC%257C290; _tt_=D9331474480AD125C85AB3E287E95970; __utmz=221034756.1586868641.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _userCode_=20204162141329; _userIdentity_=20204162141328735; _movies_=240425; _ydclearance=922e9e8dfb4eeebbcee69966-e21c-4f5b-b085-d0b3a7bd4307-1587173387; __utma=221034756.607018261.1586868641.1587126283.1587166460.8; __utmc=221034756; __utmt=1; __utmt_~1=1; __utmb=221034756.2.10.1587166460; Hm_lvt_6dd1e3b818c756974fb222f0eae5512e=1586911472,1587042989,1587121484,1587166460; Hm_lpvt_6dd1e3b818c756974fb222f0eae5512e=1587166460"</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>   
<span class="token punctuation">}</span>

<span class="token comment">#5.向服务器请求内容，返回200代表成功不加.text时</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> 

html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 6.筛取信息</span>


<span class="token comment">#7.提取信息</span>
dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#首日票房数量</span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#导演名字</span>
    actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a/text()'</span><span class="token punctuation">)</span>       <span class="token comment">#所有演员名字</span>
    act<span class="token operator">=</span><span class="token string">"、"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>actor<span class="token punctuation">)</span>                            <span class="token comment">#拼接演员名字</span>
    act<span class="token operator">=</span><span class="token punctuation">[</span>act<span class="token punctuation">]</span>                                         <span class="token comment">#将拼接后的演员名转化为方便存储的字符串</span>
    score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#提取电影中有多少人评分</span>
<span class="token comment">#     print(score[0].replace("人评分",""))          #将"人评分"替换为&amp;符号</span>
    score<span class="token operator">=</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token comment">#将替换后的评分人数赋值给score  </span>
    score<span class="token operator">=</span><span class="token punctuation">[</span>score<span class="token punctuation">]</span>                        <span class="token comment">#将替换后的评分人数转化为方便存储的字符串</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影名</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>    <span class="token comment">#同时输出多个值</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/18/20/YcLvS71i_o.png" alt="在这里插入图片描述"></p> 
<ul><li>代码保存为<code>csv</code>文件<br> 保存的核心代码，在第四步 设置浏览器代理下加：</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#创建文件并打开</span>
fp<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./电影信息2018.csv"</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8-sig'</span><span class="token punctuation">)</span>
writer<span class="token operator">=</span>csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>        <span class="token comment">#写入文件</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"电影排名"</span><span class="token punctuation">,</span><span class="token string">"电影名字"</span><span class="token punctuation">,</span><span class="token string">"导演"</span><span class="token punctuation">,</span><span class="token string">"演员"</span><span class="token punctuation">,</span><span class="token string">"首日票房"</span><span class="token punctuation">,</span><span class="token string">"评论人数"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#在文件中写入表头</span>
</code></pre> 
<p>把输出值那行改为：</p> 
<pre><code class="prism language-python"> result<span class="token operator">=</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>    <span class="token comment">#同时输出多个值</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment">#提取内容写入文件</span>
fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">#关闭文件</span>
</code></pre> 
<p>在控制台打开处查看,多出了一个我们新建的文件<strong>电影信息2018.csv</strong>：<br> <img src="https://images2.imgbox.com/39/98/EMk6WbsM_o.png" alt="在这里插入图片描述">打开文件查看：<br> <img src="https://images2.imgbox.com/0b/c4/jta3sR4r_o.png" alt="在这里插入图片描述">写入<code>csv</code>文件并保存成功</p> 
<h5><a id="42020_509"></a>4.爬取2020年的电影信息</h5> 
<h6><a id="12020_510"></a>(1)爬取2020年第一页电影信息</h6> 
<p>爬取2020年电影信息时可以直接将<code>url</code>中的<code>year=2018</code>改为<code>year=2020</code>，再把保存时的文件改为<code>电影信息2020.csv</code>即可<br> 代码及运行结果为：</p> 
<pre><code class="prism language-python"><span class="token comment">#代码汇总</span>
<span class="token comment">#1.导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time<span class="token punctuation">,</span>re
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment">#2.记录起始时间</span>
startTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment">#3.复制要爬取的链接，此处为2020年时的第一页</span>
url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2020&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587166514122&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>

<span class="token comment">#4. 设置浏览器代理，构造字典同时构造多个字典时，字典之间要用逗号隔开（不是在最后一个字典结尾加）</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
   <span class="token string">"Cookie"</span><span class="token punctuation">:</span><span class="token string">"userId=0; defaultCity=%25E5%258C%2597%25E4%25BA%25AC%257C290; _tt_=D9331474480AD125C85AB3E287E95970; __utmz=221034756.1586868641.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _userCode_=20204162141329; _userIdentity_=20204162141328735; _movies_=240425; _ydclearance=922e9e8dfb4eeebbcee69966-e21c-4f5b-b085-d0b3a7bd4307-1587173387; __utma=221034756.607018261.1586868641.1587126283.1587166460.8; __utmc=221034756; __utmt=1; __utmt_~1=1; __utmb=221034756.2.10.1587166460; Hm_lvt_6dd1e3b818c756974fb222f0eae5512e=1586911472,1587042989,1587121484,1587166460; Hm_lpvt_6dd1e3b818c756974fb222f0eae5512e=1587166460"</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>   
<span class="token punctuation">}</span>

<span class="token comment">#创建文件并打开</span>
fp<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./电影信息2020.csv"</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8-sig'</span><span class="token punctuation">)</span>
writer<span class="token operator">=</span>csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>        <span class="token comment">#写入文件</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"电影排名"</span><span class="token punctuation">,</span><span class="token string">"电影名字"</span><span class="token punctuation">,</span><span class="token string">"导演"</span><span class="token punctuation">,</span><span class="token string">"演员"</span><span class="token punctuation">,</span><span class="token string">"首日票房"</span><span class="token punctuation">,</span><span class="token string">"评论人数"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#在文件中写入表头</span>


<span class="token comment">#5.向服务器请求内容，返回200代表成功不加.text时</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> 

html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 6.筛取信息</span>


<span class="token comment">#7.提取信息</span>
dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
    day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#首日票房数量</span>
    director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#导演名字</span>
    actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a/text()'</span><span class="token punctuation">)</span>       <span class="token comment">#所有演员名字</span>
    act<span class="token operator">=</span><span class="token string">"、"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>actor<span class="token punctuation">)</span>                            <span class="token comment">#拼接演员名字</span>
    act<span class="token operator">=</span><span class="token punctuation">[</span>act<span class="token punctuation">]</span>                                         <span class="token comment">#将拼接后的演员名转化为方便存储的字符串</span>
    score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#提取电影中有多少人评分</span>
<span class="token comment">#     print(score[0].replace("人评分",""))          #将"人评分"替换为&amp;符号</span>
    score<span class="token operator">=</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token comment">#将替换后的评分人数赋值给score  </span>
    score<span class="token operator">=</span><span class="token punctuation">[</span>score<span class="token punctuation">]</span>                        <span class="token comment">#将替换后的评分人数转化为方便存储的字符串</span>
    name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影名</span>
    result<span class="token operator">=</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>    <span class="token comment">#同时输出多个值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/18/32/DfJW5VJM_o.png" alt="在这里插入图片描述">查看保存文件及其内容：<br> <img src="https://images2.imgbox.com/65/6d/QZtoS7CN_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/0a/82/MWDtoFc4_o.png" alt="在这里插入图片描述">此处通过只改动两个地方，成功将2020年的第一页电影信息爬取并保存了下来，但很多时候由于<code>cookie</code>具有时效性，所以经常会出现我们头一天写好并运行成功的代码，第二天却出错了，这时就需要我们重新复制<code>url</code>链接和<code>cookie</code></p> 
<h6><a id="2202010_566"></a>(2)爬取2020年10页的电影信息</h6> 
<p>在以上代码的基础上，设置一个函数来循环10个链接：<br> 此处熟悉循环中的两种形式：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
</code></pre> 
<p>这两个循环形式意义相同，即括号中都表示从0开始，循环到10，每次增加1，运行结果如下：<br> <img src="https://images2.imgbox.com/da/12/eL2LNNhy_o.png" alt="在这里插入图片描述"><br> 除此之外，还要把<code>url</code>中放入循环（<code>page=%s</code>,并在最后追加一个<code>%page</code>），如：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在爬取第%s页……"</span><span class="token operator">%</span>page<span class="token punctuation">)</span>
    url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2020&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=%s&amp;display=list&amp;timestamp=1587166514122&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span><span class="token operator">%</span>page

</code></pre> 
<p><strong>接下来要开始爬取10页的代码，注意先将上一步保存的文件删除或将接下来要保存的10页内容的文件夹另命名</strong></p> 
<ul><li>将循环放入代码中：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在爬取第%s页……"</span><span class="token operator">%</span>page<span class="token punctuation">)</span>
    url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2020&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=%s&amp;display=list&amp;timestamp=1587166514122&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span><span class="token operator">%</span>page
</code></pre> 
<p>此时运行并保存但并没有成功，因为网页中在2020年的电影中，存在有些电影并没有评论人数，所以运行时出现了错误，我们现在要做的就是让它在爬取时，遇到这种没有人评论，不存在评论人数的电影时，就直接跳过<strong>评论人数</strong>这个数据，继续往下爬，此时要用到一个<code>try</code>函数<br> 例：</p> 
<pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"dhyitj"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">234</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>        <span class="token comment">#此处为错误内容，因为a没有定义赋予任何内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2389</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"上面报错了"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/24/f1/LgmzAc53_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3_613"></a>(3)跳过错误继续爬取</h6> 
<p>利用以上说的<code>try</code>函数：</p> 
<pre><code class="prism language-python"><span class="token comment">#代码汇总</span>
<span class="token comment">#1.导入需要的库</span>
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>requests<span class="token punctuation">,</span>time<span class="token punctuation">,</span>re
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment">#2.记录起始时间</span>
startTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment">#3.复制要爬取的链接，此处为2020年时的第一页</span>
<span class="token comment"># url="http://movie.mtime.com/boxoffice/?year=2020&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=0&amp;display=list&amp;timestamp=1587175636279&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span>

<span class="token comment">#4. 设置浏览器代理，构造字典同时构造多个字典时，字典之间要用逗号隔开（不是在最后一个字典结尾加）</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
   <span class="token string">"Cookie"</span><span class="token punctuation">:</span><span class="token string">"userId=0; defaultCity=%25E5%258C%2597%25E4%25BA%25AC%257C290; _tt_=D9331474480AD125C85AB3E287E95970; __utmz=221034756.1586868641.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _userCode_=20204162141329; _userIdentity_=20204162141328735; _movies_=240425; __utmc=221034756; Hm_lvt_6dd1e3b818c756974fb222f0eae5512e=1586911472,1587042989,1587121484,1587166460; Hm_lpvt_6dd1e3b818c756974fb222f0eae5512e=1587175073; __utma=221034756.607018261.1586868641.1587171362.1587175074.10; __utmt=1; __utmt_~1=1; __utmb=221034756.2.10.1587175074; _ydclearance=1cb35a98f9a5c352597862dc-c116-4bb7-b947-43ec68299a3d-1587182827"</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.92 Safari/537.36'</span>   
<span class="token punctuation">}</span>


<span class="token comment">#创建文件并打开</span>
fp<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./电影信息2020.csv"</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8-sig'</span><span class="token punctuation">)</span>
writer<span class="token operator">=</span>csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>        <span class="token comment">#写入文件</span>
writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"电影排名"</span><span class="token punctuation">,</span><span class="token string">"电影名字"</span><span class="token punctuation">,</span><span class="token string">"导演"</span><span class="token punctuation">,</span><span class="token string">"演员"</span><span class="token punctuation">,</span><span class="token string">"首日票房"</span><span class="token punctuation">,</span><span class="token string">"评论人数"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#在文件中写入表头</span>


<span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在爬取第%s页……"</span><span class="token operator">%</span>page<span class="token punctuation">)</span>
    url<span class="token operator">=</span><span class="token string">"http://movie.mtime.com/boxoffice/?year=2020&amp;area=china&amp;type=MovieRankingYear&amp;category=all&amp;page=%s&amp;display=list&amp;timestamp=1587175636279&amp;version=07bb781100018dd58eafc3b35d42686804c6df8d&amp;dataType=json"</span><span class="token operator">%</span>page


<span class="token comment">#5.向服务器请求内容，返回200代表成功不加.text时</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> 

html_etree<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"html"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 6.筛取信息</span>


<span class="token comment">#7.提取信息</span>
dd<span class="token operator">=</span>html_etree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="boxofficelist"]/div/dd'</span><span class="token punctuation">)</span>   <span class="token comment">#从html中标签中提取信息（需自己按标签的包含关系构造路径）</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> dd<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        rank<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/i/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影排名</span>
        day<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/p[1]/strong[1]/text()'</span><span class="token punctuation">)</span>  <span class="token comment">#首日票房数量</span>
        director<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[3]/a/text()'</span><span class="token punctuation">)</span>   <span class="token comment">#导演名字</span>
        actor<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]//p[4]/a/text()'</span><span class="token punctuation">)</span>       <span class="token comment">#所有演员名字</span>
        act<span class="token operator">=</span><span class="token string">"、"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>actor<span class="token punctuation">)</span>                            <span class="token comment">#拼接演员名字</span>
        act<span class="token operator">=</span><span class="token punctuation">[</span>act<span class="token punctuation">]</span>                                         <span class="token comment">#将拼接后的演员名转化为方便存储的字符串</span>
        score<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[3]/p[2]/text()'</span><span class="token punctuation">)</span> <span class="token comment">#提取电影中有多少人评分</span>
<span class="token comment">#     print(score[0].replace("人评分",""))          #将"人评分"替换为&amp;符号</span>
        score<span class="token operator">=</span>score<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"人评分"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token comment">#将替换后的评分人数赋值给score  </span>
        score<span class="token operator">=</span><span class="token punctuation">[</span>score<span class="token punctuation">]</span>                        <span class="token comment">#将替换后的评分人数转化为方便存储的字符串</span>
        name<span class="token operator">=</span>item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/h3/a/text()'</span><span class="token punctuation">)</span>    <span class="token comment">#电影名</span>
        result<span class="token operator">=</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>    <span class="token comment">#同时输出多个值</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>rank<span class="token operator">+</span>name<span class="token operator">+</span>director<span class="token operator">+</span>act<span class="token operator">+</span>day<span class="token operator">+</span>score<span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这里报错了"</span><span class="token punctuation">)</span>
fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
endTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">#记录结束时间</span>
useTime<span class="token operator">=</span><span class="token punctuation">(</span>endTime<span class="token operator">-</span>startTime<span class="token punctuation">)</span>             <span class="token comment">#此处还可以/60，就变成记录时间单位为分钟</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"该次所获的信息一共使用%s秒"</span><span class="token operator">%</span>useTime<span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：<br> <img src="https://images2.imgbox.com/92/ca/gV5L44bI_o.png" alt="在这里插入图片描述">此处因为前面部分有不满足条件的部分，所以直接跳到了最后一页，<code>csv</code>文件中也只保存了这个部分，这是<code>try</code>函数的特点，不满足条件的就直接跳过了，对于要爬取所有信息的初衷来说，<code>try</code>函数的这个特点不是太友好，谨慎使用</p> 
<ul><li>为了可以显示出所有内容，我们可以把评分人数这项代码注释掉，以获得其他大部分信息</li></ul> 
<h6><a id="4_682"></a>(4)记录代码运行时间</h6> 
<pre><code class="prism language-python"><span class="token comment">#2.记录起始时间</span>
startTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">endTime<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">#记录结束时间</span>
useTime<span class="token operator">=</span><span class="token punctuation">(</span>endTime<span class="token operator">-</span>startTime<span class="token punctuation">)</span>             <span class="token comment">#此处还可以/60，就变成记录时间单位为分钟</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"该次所获的信息一共使用%s秒"</span><span class="token operator">%</span>useTime<span class="token punctuation">)</span>
</code></pre> 
<p>运行后可看到：<br> <img src="https://images2.imgbox.com/f5/88/B0aoEC3j_o.png" alt="在这里插入图片描述"><br> 到此，爬取2020年电影信息结束！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ffa7fd006110115bf8cfd814bd84c78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">慕测平台的使用—— 在eclipse上安装mooctest插件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/477144388317d4ab88b9af3bf5ef525d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">宏定义中的#</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>