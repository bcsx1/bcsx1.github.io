<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图像评价之计算PSNR、SSIM、MSE、LPIPS和NIQE评价指标 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图像评价之计算PSNR、SSIM、MSE、LPIPS和NIQE评价指标" />
<meta property="og:description" content="文章目录 链接说明代码峰值信噪比结构相似性均方误差学习感知图像块相似性自然图像质量评估器 链接 GitHub 仓库
如果代码对你的研究有所帮助，请为该仓库点上小星星。
说明 PSNR、SSIM、MSE和LPIPS是有监督指标，计算时必须是两对图像参与；NIQE是无监督指标，计算时只需要单个图像。 代码 峰值信噪比 import numpy as np from utils import to_y_channel def calculate_psnr(img1, img2, test_y_channel=False): &#34;&#34;&#34;Calculate PSNR (Peak Signal-to-Noise Ratio). Ref: https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio Args: img1 (ndarray): Images with range [0, 255]. img2 (ndarray): Images with range [0, 255]. test_y_channel (bool): Test on Y channel of YCbCr. Default: False. Returns: float: psnr result. &#34;&#34;&#34; assert img1.shape == img2.shape, (f&#39;Image shapes are differnet: {img1.shape}, {img2.shape}.&#39;) assert img1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1be21ccf3c158d50c1bd394d28b1b575/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-24T08:52:53+08:00" />
<meta property="article:modified_time" content="2023-11-24T08:52:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图像评价之计算PSNR、SSIM、MSE、LPIPS和NIQE评价指标</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_1" rel="nofollow">链接</a></li><li><a href="#_5" rel="nofollow">说明</a></li><li><a href="#_10" rel="nofollow">代码</a></li><li><ul><li><a href="#_11" rel="nofollow">峰值信噪比</a></li><li><a href="#_46" rel="nofollow">结构相似性</a></li><li><a href="#_124" rel="nofollow">均方误差</a></li><li><a href="#_145" rel="nofollow">学习感知图像块相似性</a></li><li><a href="#_154" rel="nofollow">自然图像质量评估器</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_1"></a>链接</h4> 
<p><a href="https://github.com/chdwyb/calculate-metrics">GitHub 仓库</a><br> 如果代码对你的研究有所帮助，请为该仓库点上小星星。</p> 
<h4><a id="_5"></a>说明</h4> 
<ol><li>PSNR、SSIM、MSE和LPIPS是有监督指标，计算时必须是两对图像参与；</li><li>NIQE是无监督指标，计算时只需要单个图像。</li></ol> 
<h4><a id="_10"></a>代码</h4> 
<h5><a id="_11"></a>峰值信噪比</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> utils <span class="token keyword">import</span> to_y_channel


<span class="token keyword">def</span> <span class="token function">calculate_psnr</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> test_y_channel<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate PSNR (Peak Signal-to-Noise Ratio).

    Ref: https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio

    Args:
        img1 (ndarray): Images with range [0, 255].
        img2 (ndarray): Images with range [0, 255].
        test_y_channel (bool): Test on Y channel of YCbCr. Default: False.

    Returns:
        float: psnr result.
    """</span>

    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape <span class="token operator">==</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Image shapes are differnet: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img2<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">.'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>
    img1 <span class="token operator">=</span> img1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
    img2 <span class="token operator">=</span> img2<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

    <span class="token keyword">if</span> test_y_channel<span class="token punctuation">:</span>
        img1 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img1<span class="token punctuation">)</span>
        img2 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img2<span class="token punctuation">)</span>

    mse <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>img1 <span class="token operator">-</span> img2<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> mse <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">20.</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log10<span class="token punctuation">(</span><span class="token number">255.</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>mse<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_46"></a>结构相似性</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> utils <span class="token keyword">import</span> to_y_channel


<span class="token keyword">def</span> <span class="token function">_ssim</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate SSIM (structural similarity) for one channel images.

    It is called by func:`calculate_ssim`.

    Args:
        img1 (ndarray): Images with range [0, 255] with order 'HWC'.
        img2 (ndarray): Images with range [0, 255] with order 'HWC'.

    Returns:
        float: ssim result.
    """</span>

    C1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.01</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
    C2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.03</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>

    img1 <span class="token operator">=</span> img1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
    img2 <span class="token operator">=</span> img2<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
    kernel <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getGaussianKernel<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
    window <span class="token operator">=</span> np<span class="token punctuation">.</span>outer<span class="token punctuation">(</span>kernel<span class="token punctuation">,</span> kernel<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    mu1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
    mu2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
    mu1_sq <span class="token operator">=</span> mu1 <span class="token operator">**</span> <span class="token number">2</span>
    mu2_sq <span class="token operator">=</span> mu2 <span class="token operator">**</span> <span class="token number">2</span>
    mu1_mu2 <span class="token operator">=</span> mu1 <span class="token operator">*</span> mu2
    sigma1_sq <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>img1 <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> mu1_sq
    sigma2_sq <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>img2 <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> mu2_sq
    sigma12 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>filter2D<span class="token punctuation">(</span>img1 <span class="token operator">*</span> img2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> mu1_mu2

    ssim_map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> mu1_mu2 <span class="token operator">+</span> C1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> sigma12 <span class="token operator">+</span> C2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mu1_sq <span class="token operator">+</span> mu2_sq <span class="token operator">+</span> C1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>sigma1_sq <span class="token operator">+</span> sigma2_sq <span class="token operator">+</span> C2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ssim_map<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">calculate_ssim</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> test_y_channel<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate SSIM (structural similarity).

    Ref:
    Image quality assessment: From error visibility to structural similarity

    The results are the same as that of the official released MATLAB code in
    https://ece.uwaterloo.ca/~z70wang/research/ssim/.

    For three-channel images, SSIM is calculated for each channel and then
    averaged.

    Args:
        img1 (ndarray): Images with range [0, 255].
        img2 (ndarray): Images with range [0, 255].
        test_y_channel (bool): Test on Y channel of YCbCr. Default: False.

    Returns:
        float: ssim result.
    """</span>

    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape <span class="token operator">==</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Image shapes are differnet: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img2<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">.'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>
    img1 <span class="token operator">=</span> img1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
    img2 <span class="token operator">=</span> img2<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

    <span class="token keyword">if</span> test_y_channel<span class="token punctuation">:</span>
        img1 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img1<span class="token punctuation">)</span>
        img2 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img2<span class="token punctuation">)</span>

    ssims <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ssims<span class="token punctuation">.</span>append<span class="token punctuation">(</span>_ssim<span class="token punctuation">(</span>img1<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">,</span> img2<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ssims<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_124"></a>均方误差</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> utils <span class="token keyword">import</span> to_y_channel


<span class="token keyword">def</span> <span class="token function">calculate_mse</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> test_y_channel<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape <span class="token operator">==</span> img2<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Image shapes are differnet: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img1<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img2<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">.'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> img1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span>
    img1 <span class="token operator">=</span> img1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
    img2 <span class="token operator">=</span> img2<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>

    <span class="token keyword">if</span> test_y_channel<span class="token punctuation">:</span>
        img1 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img1<span class="token punctuation">)</span>
        img2 <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img2<span class="token punctuation">)</span>

    <span class="token keyword">return</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>img1 <span class="token operator">-</span> img2<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_145"></a>学习感知图像块相似性</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> lpips

device <span class="token operator">=</span> <span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span>
calculate_lpips <span class="token operator">=</span> lpips<span class="token punctuation">.</span>LPIPS<span class="token punctuation">(</span>net<span class="token operator">=</span><span class="token string">'alex'</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_154"></a>自然图像质量评估器</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> math
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>special <span class="token keyword">import</span> gamma
<span class="token keyword">from</span> utils <span class="token keyword">import</span> to_y_channel
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>ndimage<span class="token punctuation">.</span>filters <span class="token keyword">import</span> convolve


<span class="token keyword">def</span> <span class="token function">reorder_image</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> input_order<span class="token operator">=</span><span class="token string">'HWC'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Reorder images to 'HWC' order.

    If the input_order is (h, w), return (h, w, 1);
    If the input_order is (c, h, w), return (h, w, c);
    If the input_order is (h, w, c), return as it is.

    Args:
        img (ndarray): Input image.
        input_order (str): Whether the input order is 'HWC' or 'CHW'.
            If the input image shape is (h, w), input_order will not have
            effects. Default: 'HWC'.

    Returns:
        ndarray: reordered image.
    """</span>

    <span class="token keyword">if</span> input_order <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'HWC'</span><span class="token punctuation">,</span> <span class="token string">'CHW'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f'Wrong input_order </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>input_order<span class="token punctuation">}</span></span><span class="token string">. Supported input_orders are '</span></span>
            <span class="token string">"'HWC' and 'CHW'"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> input_order <span class="token operator">==</span> <span class="token string">'CHW'</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> img<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> img


<span class="token keyword">def</span> <span class="token function">estimate_aggd_param</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Estimate AGGD (Asymmetric Generalized Gaussian Distribution) paramters.

    Args:
        block (ndarray): 2D Image block.

    Returns:
        tuple: alpha (float), beta_l (float) and beta_r (float) for the AGGD
            distribution (Estimating the parames in Equation 7 in the paper).
    """</span>
    block <span class="token operator">=</span> block<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>
    gam <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">10.001</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># len = 9801</span>
    gam_reciprocal <span class="token operator">=</span> np<span class="token punctuation">.</span>reciprocal<span class="token punctuation">(</span>gam<span class="token punctuation">)</span>
    r_gam <span class="token operator">=</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>gamma<span class="token punctuation">(</span>gam_reciprocal <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>
        gamma<span class="token punctuation">(</span>gam_reciprocal<span class="token punctuation">)</span> <span class="token operator">*</span> gamma<span class="token punctuation">(</span>gam_reciprocal <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    left_std <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>block<span class="token punctuation">[</span>block <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    right_std <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>block<span class="token punctuation">[</span>block <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gammahat <span class="token operator">=</span> left_std <span class="token operator">/</span> right_std
    rhat <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>block<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    rhatnorm <span class="token operator">=</span> <span class="token punctuation">(</span>rhat <span class="token operator">*</span> <span class="token punctuation">(</span>gammahat<span class="token operator">**</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span>
                <span class="token punctuation">(</span>gammahat <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>gammahat<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    array_position <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span><span class="token punctuation">(</span>r_gam <span class="token operator">-</span> rhatnorm<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

    alpha <span class="token operator">=</span> gam<span class="token punctuation">[</span>array_position<span class="token punctuation">]</span>
    beta_l <span class="token operator">=</span> left_std <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>gamma<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span> <span class="token operator">/</span> gamma<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>
    beta_r <span class="token operator">=</span> right_std <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>gamma<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span> <span class="token operator">/</span> gamma<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> beta_l<span class="token punctuation">,</span> beta_r<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">compute_feature</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Compute features.

    Args:
        block (ndarray): 2D Image block.

    Returns:
        list: Features with length of 18.
    """</span>
    feat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    alpha<span class="token punctuation">,</span> beta_l<span class="token punctuation">,</span> beta_r <span class="token operator">=</span> estimate_aggd_param<span class="token punctuation">(</span>block<span class="token punctuation">)</span>
    feat<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span>alpha<span class="token punctuation">,</span> <span class="token punctuation">(</span>beta_l <span class="token operator">+</span> beta_r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    shifts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>shifts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        shifted_block <span class="token operator">=</span> np<span class="token punctuation">.</span>roll<span class="token punctuation">(</span>block<span class="token punctuation">,</span> shifts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        alpha<span class="token punctuation">,</span> beta_l<span class="token punctuation">,</span> beta_r <span class="token operator">=</span> estimate_aggd_param<span class="token punctuation">(</span>block <span class="token operator">*</span> shifted_block<span class="token punctuation">)</span>
        <span class="token comment"># Eq. 8</span>
        mean <span class="token operator">=</span> <span class="token punctuation">(</span>beta_r <span class="token operator">-</span> beta_l<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>gamma<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span> <span class="token operator">/</span> gamma<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>
        feat<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span>alpha<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> beta_l<span class="token punctuation">,</span> beta_r<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> feat


<span class="token keyword">def</span> <span class="token function">niqe</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>
         mu_pris_param<span class="token punctuation">,</span>
         cov_pris_param<span class="token punctuation">,</span>
         gaussian_window<span class="token punctuation">,</span>
         block_size_h<span class="token operator">=</span><span class="token number">96</span><span class="token punctuation">,</span>
         block_size_w<span class="token operator">=</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate NIQE (Natural Image Quality Evaluator) metric.

    Ref: Making a "Completely Blind" Image Quality Analyzer.
    This implementation could produce almost the same results as the official
    MATLAB codes: http://live.ece.utexas.edu/research/quality/niqe_release.zip

    Note that we do not include block overlap height and width, since they are
    always 0 in the official implementation.

    For good performance, it is advisable by the official implemtation to
    divide the distorted image in to the same size patched as used for the
    construction of multivariate Gaussian model.

    Args:
        img (ndarray): Input image whose quality needs to be computed. The
            image must be a gray or Y (of YCbCr) image with shape (h, w).
            Range [0, 255] with float type.
        mu_pris_param (ndarray): Mean of a pre-defined multivariate Gaussian
            model calculated on the pristine dataset.
        cov_pris_param (ndarray): Covariance of a pre-defined multivariate
            Gaussian model calculated on the pristine dataset.
        gaussian_window (ndarray): A 7x7 Gaussian window used for smoothing the
            image.
        block_size_h (int): Height of the blocks in to which image is divided.
            Default: 96 (the official recommended value).
        block_size_w (int): Width of the blocks in to which image is divided.
            Default: 96 (the official recommended value).
    """</span>
    <span class="token keyword">assert</span> img<span class="token punctuation">.</span>ndim <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
        <span class="token string">'Input image must be a gray or Y (of YCbCr) image with shape (h, w).'</span><span class="token punctuation">)</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape
    num_block_h <span class="token operator">=</span> math<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>h <span class="token operator">/</span> block_size_h<span class="token punctuation">)</span>
    num_block_w <span class="token operator">=</span> math<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>w <span class="token operator">/</span> block_size_w<span class="token punctuation">)</span>
    img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>num_block_h <span class="token operator">*</span> block_size_h<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>num_block_w <span class="token operator">*</span> block_size_w<span class="token punctuation">]</span>

    distparam <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> scale <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        mu <span class="token operator">=</span> convolve<span class="token punctuation">(</span>img<span class="token punctuation">,</span> gaussian_window<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">)</span>
        sigma <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>
            np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>
                convolve<span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> gaussian_window<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">)</span> <span class="token operator">-</span>
                np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>mu<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        img_nomalized <span class="token operator">=</span> <span class="token punctuation">(</span>img <span class="token operator">-</span> mu<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>sigma <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        feat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx_w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_block_w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> idx_h <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_block_h<span class="token punctuation">)</span><span class="token punctuation">:</span>
                block <span class="token operator">=</span> img_nomalized<span class="token punctuation">[</span>idx_h <span class="token operator">*</span> block_size_h <span class="token operator">//</span>
                                      scale<span class="token punctuation">:</span><span class="token punctuation">(</span>idx_h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> block_size_h <span class="token operator">//</span>
                                      scale<span class="token punctuation">,</span> idx_w <span class="token operator">*</span> block_size_w <span class="token operator">//</span>
                                      scale<span class="token punctuation">:</span><span class="token punctuation">(</span>idx_w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> block_size_w <span class="token operator">//</span>
                                      scale<span class="token punctuation">]</span>
                feat<span class="token punctuation">.</span>append<span class="token punctuation">(</span>compute_feature<span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span>

        distparam<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feat<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> scale <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape
            img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>
                img <span class="token operator">/</span> <span class="token number">255.</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
            img <span class="token operator">=</span> img <span class="token operator">*</span> <span class="token number">255.</span>

    distparam <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span>distparam<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    mu_distparam <span class="token operator">=</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>distparam<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    distparam_no_nan <span class="token operator">=</span> distparam<span class="token punctuation">[</span><span class="token operator">~</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span>distparam<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    cov_distparam <span class="token operator">=</span> np<span class="token punctuation">.</span>cov<span class="token punctuation">(</span>distparam_no_nan<span class="token punctuation">,</span> rowvar<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    invcov_param <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>pinv<span class="token punctuation">(</span><span class="token punctuation">(</span>cov_pris_param <span class="token operator">+</span> cov_distparam<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    quality <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>
        np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">(</span>mu_pris_param <span class="token operator">-</span> mu_distparam<span class="token punctuation">)</span><span class="token punctuation">,</span> invcov_param<span class="token punctuation">)</span><span class="token punctuation">,</span>
        np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">(</span>mu_pris_param <span class="token operator">-</span> mu_distparam<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    quality <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>quality<span class="token punctuation">)</span>

    <span class="token keyword">return</span> quality


<span class="token keyword">def</span> <span class="token function">calculate_niqe</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> crop_border<span class="token punctuation">,</span> input_order<span class="token operator">=</span><span class="token string">'HWC'</span><span class="token punctuation">,</span> convert_to<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate NIQE (Natural Image Quality Evaluator) metric.

    Ref: Making a "Completely Blind" Image Quality Analyzer.
    This implementation could produce almost the same results as the official
    MATLAB codes: http://live.ece.utexas.edu/research/quality/niqe_release.zip

    We use the official params estimated from the pristine dataset.
    We use the recommended block size (96, 96) without overlaps.

    Args:
        img (ndarray): Input image whose quality needs to be computed.
            The input image must be in range [0, 255] with float/int type.
            The input_order of image can be 'HW' or 'HWC' or 'CHW'. (BGR order)
            If the input order is 'HWC' or 'CHW', it will be converted to gray
            or Y (of YCbCr) image according to the ``convert_to`` argument.
        crop_border (int): Cropped pixels in each edge of an image. These
            pixels are not involved in the metric calculation.
        input_order (str): Whether the input order is 'HW', 'HWC' or 'CHW'.
            Default: 'HWC'.
        convert_to (str): Whether coverted to 'y' (of MATLAB YCbCr) or 'gray'.
            Default: 'y'.

    Returns:
        float: NIQE result.
    """</span>

    niqe_pris_params <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./niqe_pris_params.npz'</span><span class="token punctuation">)</span>
    mu_pris_param <span class="token operator">=</span> niqe_pris_params<span class="token punctuation">[</span><span class="token string">'mu_pris_param'</span><span class="token punctuation">]</span>
    cov_pris_param <span class="token operator">=</span> niqe_pris_params<span class="token punctuation">[</span><span class="token string">'cov_pris_param'</span><span class="token punctuation">]</span>
    gaussian_window <span class="token operator">=</span> niqe_pris_params<span class="token punctuation">[</span><span class="token string">'gaussian_window'</span><span class="token punctuation">]</span>

    img <span class="token operator">=</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token keyword">if</span> input_order <span class="token operator">!=</span> <span class="token string">'HW'</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> reorder_image<span class="token punctuation">(</span>img<span class="token punctuation">,</span> input_order<span class="token operator">=</span>input_order<span class="token punctuation">)</span>
        <span class="token keyword">if</span> convert_to <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> to_y_channel<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> convert_to <span class="token operator">==</span> <span class="token string">'gray'</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img <span class="token operator">/</span> <span class="token number">255.</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255.</span>
        img <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>img<span class="token punctuation">)</span>

    <span class="token keyword">if</span> crop_border <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> img<span class="token punctuation">[</span>crop_border<span class="token punctuation">:</span><span class="token operator">-</span>crop_border<span class="token punctuation">,</span> crop_border<span class="token punctuation">:</span><span class="token operator">-</span>crop_border<span class="token punctuation">]</span>

    niqe_result <span class="token operator">=</span> niqe<span class="token punctuation">(</span>img<span class="token punctuation">,</span> mu_pris_param<span class="token punctuation">,</span> cov_pris_param<span class="token punctuation">,</span> gaussian_window<span class="token punctuation">)</span>

    <span class="token keyword">return</span> niqe_result
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f142fec081cb6ce58dbd61de4df0f70a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【全网最全】2023亚太赛C题前四问完整代码&#43;配套数据&#43;3种保奖思路&#43;高清结果运行图&#43;通用代码包等（后续会更新）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4b5b55588135f15b0b2f4a1747ba17e9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Qt框架学习(1)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>