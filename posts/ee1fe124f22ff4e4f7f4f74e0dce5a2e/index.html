<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>制造企业产品成本核算功能设计实例 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="制造企业产品成本核算功能设计实例" />
<meta property="og:description" content="制造企业产品成本核算是成长控制、成本决策、销售决策的基础。如何快速、准确地完成成本核算，是企业应用中的高级部分，是在存货管理已经正常进行，已经做到账实一致、及时反映、信息完善的前提下才能进行的，还要有及时的会计总账核算结果（期间费用等），在充分 满足一些基础条件后，就可以开展成长核算的业务处理了。本例基于存货总线概念，是整套ERP系统中的一个组成部分，核算结果可直接用于成本控制和成本决策。本文讲述业务逻辑及后台编程。
一、确定成本核算对象：成本核算单 1、成本核算单需要填制、审核、登记。成本核算单是成本核算目标对象，可以直接填制所有成本核算单，不必等到前面的核算完成再填制后面的。
2、成本核算单主要核算对象包括：外协物料、半成品物料、产成品物料。
3、本例分为四个阶段：外协品、初级半成品（机箱）、二级半成品（祼机）、产成品。
4、其中，外协品只分配发出的材料（直接材料）。不分配人工及制造费用。
5、初级半成品分配直接材料、直接人工、制造费用（钣金车间）。
6、二级半成品分配直接材料、直接人工、制造费用（组装车间）。
7、产成品分配直接材料、直接人工、制造费用（检测车间）、管理费用。
8、本例共填制四张成本核算单，来自于委外入库数据和三个车间的完工入库数据。
9、产品入库时，已经按计划价格入库，因此在查询时是可以看到价格的，成本核算时将替换原有一价格，核算不正确时，可以重复进行，直到正确为止。
10、下面内容是要边归集边分配边核算。即必需是前面的分配并核算完成后，再分配核算后面的，因为后面的归集数据来自于前面的分配核算结果。成本核算单可一次全部填制完成，归集单要等到上一步核算完成后才能填制。
11、会计核算要将制造费用内容核算完毕。
二、成本归集与核算：成本归集单 成本归集、分配、核算要按产品层次依次进行，实际应用中，根据真实的层次确定核算的层次，就是说要前一层次核算产生结果后，用于后面层次的计算。
（一）、外协品成本核算 1、成本归集，只有一张单据，来源是委外出库单数据。填制、审核、登记。
2、成本分配（业务处理）。成本分配的结果被存储在djcbgjs表中，并在单据头中加上是否分配的标记。
3、成本核算。将分配结果更新到成本核算单，再由成本核算单更新到入库单。成本核算时自动存货核算，不需要单独操作。
4、成本分配与成本核算可以重复进行。
5、成本归集单允许反登记。
6、成本核算单允许反登记。反登记将清除原有分配的结果。但更新到入库单上的入库金额将无法恢复，直到重新计算出正确的结果后再更新。当然可以在后台用语句或建立业务处理功能，将其他恢复为计划成本价格。
7、使用成本账项查询功能，查询并核对核算结果的正确性。
8、查询核算后的入库单。
9、查询存货账项。
（二）、初级半成品成本核算 1、核算钣金车间生产的机箱的入库成本。
2、成本归集：直接材料、直接人工、制造费用。审核登记。
3、需要先行在会计核算中核算制造费用，因此我们回到会计核算。
4、成本分配。
5、成本核算。
6、单据查询：成本归集单、成本核算单。
7、账项查询：成本类账项。核实分配结果的正确性。
（三）、次级半成品成本核算 1、核算组装车间生产的祼机的入库成本。
2、成本归集：直接材料、直接人工、制造费用。审核登记。
3、成本分配。
4、成本核算。
5、单据查询：成本归集单、成本核算单。
6、账项查询：成本类账项。核实分配结果的正确性。
（四）产成品成本核算 1、核算检测车间生产的产成品的入库成本。
2、成本归集：直接材料、直接人工、制造费用、管理费用。审核登记。
3、成本分配。
4、成本核算。
5、单据查询：成本归集单、成本核算单。
三、成本核算原则 1、决策导向。分配标准以不影响销售决策为准。即售价较高的产品可以多摊成本，反之少摊成本。
2、订单决策。以订单决策为目标，而不是单一产品决策。即只要某一订单满足毛利指标要求即可，不求其中每一种产品都是满足要求的。
3、及时完成。在没有实际成本时，以标准成本或计划成本为依据完成计算。
4、本期完工的成本核算对象承担间接成本和期间费用。
5、完全成本。期间费用分配到产成品成本，不分配给半成品。
四、主要数据表结构 -- 成本核算单单据头 djcbhso字段列表： oid varchar 30	单据号 textread	djmc varchar 60	单据名称 textread	ny bpchar 6	年月 textread	dqbz varchar 40	当前步骤 textread	rq date 0	日期 dateedit	yyyy-MM-dd scbm varchar 100	生产部门 textedit	hslb varchar 40	核算类别 comboedit	edit bz varchar 300	备注 textedit	tzr varchar 20	填制人 textedit	shr varchar 20	审核人 textedit	djr varchar 20	登记人 textedit	sfhs bool 0	是否核算 checkedit	-- 成本核算单单据体,存储成本核算对象和核算结果 djcbhsm字段列表： mid int4 32	序号 textread	oid varchar 30	单据号 textread	djmc varchar 60	单据名称 textread	ny bpchar 6	年月 textread	dqbz varchar 40	当前步骤 textread	chxh varchar 20	货号 buttonedit	chdh varchar 30	存货代号 notenter	chmc varchar 100	存货名称 notenter	xh1 varchar 100	型号 textread	xh2 varchar 100	规格 textread	xh3 varchar 400	参数 textedit	gg1 varchar 200	颜色 textedit	gg2 varchar 200	材质 textread	gg3 varchar 200	图号 textread	jldw varchar 20	单位 notenter	scbm varchar 100	生产部门 textedit	wldw varchar 100	往来单位 textedit	hssl numeric 16	核算数量 textedit	n2 xsje numeric 16	销售金额 textedit	n2 dwcb numeric 16	单位成本 textedit	n2 cpcb numeric 16	产品成本 textedit	n2 dwml numeric 16	单位毛利 textedit	n2 cpml numeric 16	产品毛利 textedit	n2 bz varchar 100	备注 textedit	mhh int4 32	行号 textedit	zjcl numeric 16	直接材料 textedit	n2 zjrg numeric 16	直接人工 textedit	n2 jjcl numeric 16	间接材料 textedit	n2 jjrg numeric 16	间接人工 textedit	n2 zzfy numeric 16	制造费用 textedit	n2 glfy numeric 16	管理费用 textedit	n2 sfsh bool 0	是否审核 checkedit	sfdj bool 0	是否登记 checkedit	-- 成本归集单单据头 djcbgjo字段列表： oid varchar 30	单据号 textread	djmc varchar 60	单据名称 textread	ny bpchar 8	年月 textread	dqbz varchar 40	当前步骤 textread	rq date 0	日期 dateedit	yyyy-MM-dd scbm varchar 100	生产部门 textedit	xmdh varchar 12	项目代号 buttonedit	xmmc varchar 100	项目名称 textread	xmlx varchar 60	项目类型 comboedit	fpfw varchar 500	分配范围 buttontextedit	bz varchar 300	备注 textedit	tzr varchar 20	填制人 textedit	shr varchar 20	审核人 textedit	djr varchar 20	登记人 textedit	sffp bool 0	是否分配 checkedit	-- 成本归集单单据体 djcbgjm字段列表： mid int4 32	序号 textread	oid varchar 30	单据号 textread	djmc varchar 60	单据名称 textread	ny bpchar 6	年月 textread	dqbz varchar 40	当前步骤 textread	cbmc varchar 150	成本名称 buttonedit	jldw varchar 12	单位 textread	select gjsl numeric 16	归集数量 textedit	n2 cbdj numeric 16	成本单价 textedit	n2 cbje numeric 16	成本金额 textedit	n2 fpje numeric 16	分配金额 textedit	n2 cbyt varchar 20	成本用途 textedit	00000 scbm varchar 100	生产部门 listedit	wldw varchar 200	往来单位 textedit	lyxh varchar 20	来源货号 textedit	bz varchar 100	备注 textedit	mhh int4 32	行号 textedit	sfsh bool 0	是否审核 checkedit	sfdj bool 0	是否登记 checkedit	sffp bool 0	是否分配 checkedit	-- 成本归集单分配结果 djcbgjs字段列表： id int4 32	键号 textedit	ny bpchar 6	年月 textread	djmc varchar 60	单据名称 textread	oid varchar 30	单据号 textread	mid int4 32	序号 textread	cbmc varchar 100	成本名称 textedit	jldw varchar 12	单位 buttonedit	gjsl numeric 16	归集数量 textedit	n2 cbdj numeric 16	成本单价 textedit	n2 cbje numeric 16	成本金额 textedit	n2 cbyt varchar 20	成本用途 textedit	hsoid varchar 30	textedit	bz varchar 100	备注 textedit	xmdh varchar 12	项目代号 buttonedit	xmmc varchar 100	项目名称 textread	xmlx varchar 20	项目类型 comboedit	scbm varchar 100	生产部门 listedit	wldw varchar 200	往来单位 buttonedit	sfdj bool 0	是否登记 checkread	五、关键代码 本例使用plpgsql语言编写。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ee1fe124f22ff4e4f7f4f74e0dce5a2e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-11T11:47:17+08:00" />
<meta property="article:modified_time" content="2023-02-11T11:47:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">制造企业产品成本核算功能设计实例</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>制造企业产品成本核算是成长控制、成本决策、销售决策的基础。如何快速、准确地完成成本核算，是企业应用中的高级部分，是在存货管理已经正常进行，已经做到账实一致、及时反映、信息完善的前提下才能进行的，还要有及时的会计总账核算结果（期间费用等），在充分 满足一些基础条件后，就可以开展成长核算的业务处理了。本例基于存货总线概念，是整套ERP系统中的一个组成部分，核算结果可直接用于成本控制和成本决策。本文讲述业务逻辑及后台编程。</p> 
<h2><a id="_1"></a>一、确定成本核算对象：成本核算单</h2> 
<p>1、成本核算单需要填制、审核、登记。成本核算单是成本核算目标对象，可以直接填制所有成本核算单，不必等到前面的核算完成再填制后面的。<br> 2、成本核算单主要核算对象包括：外协物料、半成品物料、产成品物料。<br> 3、本例分为四个阶段：外协品、初级半成品（机箱）、二级半成品（祼机）、产成品。<br> 4、其中，外协品只分配发出的材料（直接材料）。不分配人工及制造费用。<br> 5、初级半成品分配直接材料、直接人工、制造费用（钣金车间）。<br> 6、二级半成品分配直接材料、直接人工、制造费用（组装车间）。<br> 7、产成品分配直接材料、直接人工、制造费用（检测车间）、管理费用。<br> 8、本例共填制四张成本核算单，来自于委外入库数据和三个车间的完工入库数据。<br> 9、产品入库时，已经按计划价格入库，因此在查询时是可以看到价格的，成本核算时将替换原有一价格，核算不正确时，可以重复进行，直到正确为止。<br> 10、下面内容是要边归集边分配边核算。即必需是前面的分配并核算完成后，再分配核算后面的，因为后面的归集数据来自于前面的分配核算结果。成本核算单可一次全部填制完成，归集单要等到上一步核算完成后才能填制。<br> 11、会计核算要将制造费用内容核算完毕。</p> 
<h2><a id="_13"></a>二、成本归集与核算：成本归集单</h2> 
<p>成本归集、分配、核算要按产品层次依次进行，实际应用中，根据真实的层次确定核算的层次，就是说要前一层次核算产生结果后，用于后面层次的计算。</p> 
<h3><a id="_15"></a>（一）、外协品成本核算</h3> 
<p>1、成本归集，只有一张单据，来源是委外出库单数据。填制、审核、登记。<br> 2、成本分配（业务处理）。成本分配的结果被存储在djcbgjs表中，并在单据头中加上是否分配的标记。<br> 3、成本核算。将分配结果更新到成本核算单，再由成本核算单更新到入库单。成本核算时自动存货核算，不需要单独操作。<br> 4、成本分配与成本核算可以重复进行。<br> 5、成本归集单允许反登记。<br> 6、成本核算单允许反登记。反登记将清除原有分配的结果。但更新到入库单上的入库金额将无法恢复，直到重新计算出正确的结果后再更新。当然可以在后台用语句或建立业务处理功能，将其他恢复为计划成本价格。<br> 7、使用成本账项查询功能，查询并核对核算结果的正确性。<br> 8、查询核算后的入库单。<br> 9、查询存货账项。</p> 
<h3><a id="_25"></a>（二）、初级半成品成本核算</h3> 
<p>1、核算钣金车间生产的机箱的入库成本。<br> 2、成本归集：直接材料、直接人工、制造费用。审核登记。<br> 3、需要先行在会计核算中核算制造费用，因此我们回到会计核算。<br> 4、成本分配。<br> 5、成本核算。<br> 6、单据查询：成本归集单、成本核算单。<br> 7、账项查询：成本类账项。核实分配结果的正确性。</p> 
<h3><a id="_33"></a>（三）、次级半成品成本核算</h3> 
<p>1、核算组装车间生产的祼机的入库成本。<br> 2、成本归集：直接材料、直接人工、制造费用。审核登记。<br> 3、成本分配。<br> 4、成本核算。<br> 5、单据查询：成本归集单、成本核算单。<br> 6、账项查询：成本类账项。核实分配结果的正确性。</p> 
<h3><a id="_40"></a>（四）产成品成本核算</h3> 
<p>1、核算检测车间生产的产成品的入库成本。<br> 2、成本归集：直接材料、直接人工、制造费用、管理费用。审核登记。<br> 3、成本分配。<br> 4、成本核算。<br> 5、单据查询：成本归集单、成本核算单。</p> 
<h2><a id="_46"></a>三、成本核算原则</h2> 
<p>1、决策导向。分配标准以不影响销售决策为准。即售价较高的产品可以多摊成本，反之少摊成本。<br> 2、订单决策。以订单决策为目标，而不是单一产品决策。即只要某一订单满足毛利指标要求即可，不求其中每一种产品都是满足要求的。<br> 3、及时完成。在没有实际成本时，以标准成本或计划成本为依据完成计算。<br> 4、本期完工的成本核算对象承担间接成本和期间费用。<br> 5、完全成本。期间费用分配到产成品成本，不分配给半成品。</p> 
<h2><a id="_52"></a>四、主要数据表结构</h2> 
<pre><code class="prism language-sql"><span class="token comment">-- 成本核算单单据头</span>
djcbhso字段列表：
oid     	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	单据号         	textread	        
djmc    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	单据名称        	textread	        
ny      	bpchar  	    <span class="token number">6</span>	年月          	textread	        
dqbz    	<span class="token keyword">varchar</span> 	   <span class="token number">40</span>	当前步骤        	textread	        
rq      	<span class="token keyword">date</span>    	    <span class="token number">0</span>	日期          	dateedit	yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd
scbm    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	生产部门        	textedit	        
hslb    	<span class="token keyword">varchar</span> 	   <span class="token number">40</span>	核算类别        	comboedit	    edit
bz      	<span class="token keyword">varchar</span> 	  <span class="token number">300</span>	备注          	textedit	        
tzr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	填制人         	textedit	        
shr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	审核人         	textedit	        
djr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	登记人         	textedit	        
sfhs    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否核算        	checkedit	        
<span class="token comment">-- 成本核算单单据体,存储成本核算对象和核算结果</span>
djcbhsm字段列表：
mid     	int4    	   <span class="token number">32</span>	序号          	textread	        
oid     	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	单据号         	textread	        
djmc    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	单据名称        	textread	        
ny      	bpchar  	    <span class="token number">6</span>	年月          	textread	        
dqbz    	<span class="token keyword">varchar</span> 	   <span class="token number">40</span>	当前步骤        	textread	        
chxh    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	货号          	buttonedit	        
chdh    	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	存货代号        	notenter	        
chmc    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	存货名称        	notenter	        
xh1     	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	型号          	textread	        
xh2     	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	规格          	textread	        
xh3     	<span class="token keyword">varchar</span> 	  <span class="token number">400</span>	参数          	textedit	        
gg1     	<span class="token keyword">varchar</span> 	  <span class="token number">200</span>	颜色          	textedit	        
gg2     	<span class="token keyword">varchar</span> 	  <span class="token number">200</span>	材质          	textread	        
gg3     	<span class="token keyword">varchar</span> 	  <span class="token number">200</span>	图号          	textread	        
jldw    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	单位          	notenter	        
scbm    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	生产部门        	textedit	        
wldw    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	往来单位        	textedit	        
hssl    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	核算数量        	textedit	      n2
xsje    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	销售金额        	textedit	      n2
dwcb    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	单位成本        	textedit	      n2
cpcb    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	产品成本        	textedit	      n2
dwml    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	单位毛利        	textedit	      n2
cpml    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	产品毛利        	textedit	      n2
bz      	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	备注          	textedit	        
mhh     	int4    	   <span class="token number">32</span>	行号          	textedit	        
zjcl    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	直接材料        	textedit	      n2
zjrg    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	直接人工        	textedit	      n2
jjcl    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	间接材料        	textedit	      n2
jjrg    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	间接人工        	textedit	      n2
zzfy    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	制造费用        	textedit	      n2
glfy    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	管理费用        	textedit	      n2
sfsh    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否审核        	checkedit	        
sfdj    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否登记        	checkedit	        
<span class="token comment">-- 成本归集单单据头</span>
djcbgjo字段列表：
oid     	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	单据号         	textread	        
djmc    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	单据名称        	textread	        
ny      	bpchar  	    <span class="token number">8</span>	年月          	textread	        
dqbz    	<span class="token keyword">varchar</span> 	   <span class="token number">40</span>	当前步骤        	textread	        
rq      	<span class="token keyword">date</span>    	    <span class="token number">0</span>	日期          	dateedit	yyyy<span class="token operator">-</span>MM<span class="token operator">-</span>dd
scbm    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	生产部门        	textedit	        
xmdh    	<span class="token keyword">varchar</span> 	   <span class="token number">12</span>	项目代号        	buttonedit	        
xmmc    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	项目名称        	textread	        
xmlx    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	项目类型        	comboedit	        
fpfw    	<span class="token keyword">varchar</span> 	  <span class="token number">500</span>	分配范围        	buttontextedit	        
bz      	<span class="token keyword">varchar</span> 	  <span class="token number">300</span>	备注          	textedit	        
tzr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	填制人         	textedit	        
shr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	审核人         	textedit	        
djr     	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	登记人         	textedit	        
sffp    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否分配        	checkedit	        
<span class="token comment">-- 成本归集单单据体</span>
djcbgjm字段列表：
mid     	int4    	   <span class="token number">32</span>	序号          	textread	        
oid     	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	单据号         	textread	        
djmc    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	单据名称        	textread	        
ny      	bpchar  	    <span class="token number">6</span>	年月          	textread	        
dqbz    	<span class="token keyword">varchar</span> 	   <span class="token number">40</span>	当前步骤        	textread	        
cbmc    	<span class="token keyword">varchar</span> 	  <span class="token number">150</span>	成本名称        	buttonedit	        
jldw    	<span class="token keyword">varchar</span> 	   <span class="token number">12</span>	单位          	textread	  <span class="token keyword">select</span>
gjsl    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	归集数量        	textedit	      n2
cbdj    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	成本单价        	textedit	      n2
cbje    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	成本金额        	textedit	      n2
fpje    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	分配金额        	textedit	      n2
cbyt    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	成本用途        	textedit	   <span class="token number">00000</span>
scbm    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	生产部门        	listedit	        
wldw    	<span class="token keyword">varchar</span> 	  <span class="token number">200</span>	往来单位        	textedit	        
lyxh    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	来源货号        	textedit	        
bz      	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	备注          	textedit	        
mhh     	int4    	   <span class="token number">32</span>	行号          	textedit	        
sfsh    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否审核        	checkedit	        
sfdj    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否登记        	checkedit	        
sffp    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否分配        	checkedit	        
<span class="token comment">-- 成本归集单分配结果</span>
djcbgjs字段列表：
id      	int4    	   <span class="token number">32</span>	键号          	textedit	        
ny      	bpchar  	    <span class="token number">6</span>	年月          	textread	        
djmc    	<span class="token keyword">varchar</span> 	   <span class="token number">60</span>	单据名称        	textread	        
oid     	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	单据号         	textread	        
mid     	int4    	   <span class="token number">32</span>	序号          	textread	        
cbmc    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	成本名称        	textedit	        
jldw    	<span class="token keyword">varchar</span> 	   <span class="token number">12</span>	单位          	buttonedit	        
gjsl    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	归集数量        	textedit	      n2
cbdj    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	成本单价        	textedit	      n2
cbje    	<span class="token keyword">numeric</span> 	   <span class="token number">16</span>	成本金额        	textedit	      n2
cbyt    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	成本用途        	textedit	        
hsoid   	<span class="token keyword">varchar</span> 	   <span class="token number">30</span>	            	textedit	        
bz      	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	备注          	textedit	        
xmdh    	<span class="token keyword">varchar</span> 	   <span class="token number">12</span>	项目代号        	buttonedit	        
xmmc    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	项目名称        	textread	        
xmlx    	<span class="token keyword">varchar</span> 	   <span class="token number">20</span>	项目类型        	comboedit	        
scbm    	<span class="token keyword">varchar</span> 	  <span class="token number">100</span>	生产部门        	listedit	        
wldw    	<span class="token keyword">varchar</span> 	  <span class="token number">200</span>	往来单位        	buttonedit	        
sfdj    	<span class="token keyword">bool</span>    	    <span class="token number">0</span>	是否登记        	checkread	        
</code></pre> 
<h2><a id="_164"></a>五、关键代码</h2> 
<p>本例使用plpgsql语言编写。</p> 
<h3><a id="_166"></a>（一）、成本分配</h3> 
<p>将归集好的成本，分配到具体的成本核算对像。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">public</span><span class="token punctuation">.</span>x9_cbfp_gj<span class="token punctuation">(</span>
	dqyh <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">,</span>
	djoid <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">)</span>
    <span class="token keyword">RETURNS</span> <span class="token keyword">boolean</span>
    <span class="token keyword">LANGUAGE</span> <span class="token string">'plpgsql'</span>
    COST <span class="token number">100</span>
    VOLATILE PARALLEL UNSAFE
<span class="token keyword">AS</span> $BODY$
   <span class="token comment">-- Description:	成本分配 登记当前归集单（一张）</span>
<span class="token keyword">DECLARE</span>
   ssmsg <span class="token keyword">text</span><span class="token punctuation">;</span>ssdet <span class="token keyword">text</span><span class="token punctuation">;</span>sstname <span class="token keyword">text</span><span class="token punctuation">;</span>sshint <span class="token keyword">text</span><span class="token punctuation">;</span>ssctt <span class="token keyword">text</span><span class="token punctuation">;</span> <span class="token comment">--错误处理</span>
	rs <span class="token keyword">boolean</span><span class="token punctuation">;</span>
	ssfpny <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ssfpfw <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		   <span class="token comment">-- 年月</span>
   ssxmdh <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ssxmmc <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ssxmlx <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ssfpblsl <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">-- 分配比率数量</span>
   ssfpblje <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">-- 分配比率金额</span>
   sshjfpje <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">-- 合计分配金额</span>
   sshjsl <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">-- 合计产品数量 成本核算单中符合条件的行</span>
   ssmaxid <span class="token keyword">INT</span><span class="token punctuation">;</span> 					<span class="token comment">-- 数量最大的分配行</span>
   ssqdchxh <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ssqdcpxh <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	rd record<span class="token punctuation">;</span>						<span class="token comment">--记录</span>
   cs_gj <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>
		<span class="token keyword">SELECT</span> mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">,</span>lyxh
		<span class="token keyword">FROM</span> djcbgjm	<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
	rs:<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> ny<span class="token punctuation">,</span>fpfw <span class="token keyword">INTO</span> ssfpny<span class="token punctuation">,</span>ssfpfw <span class="token keyword">FROM</span> djcbgjo <span class="token keyword">WHERE</span> oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">UPDATE</span> djcbgjo <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token keyword">WHERE</span> oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token comment">-- 成本项目</span>
	<span class="token keyword">SELECT</span> xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx <span class="token keyword">INTO</span> ssxmdh<span class="token punctuation">,</span>ssxmmc<span class="token punctuation">,</span>ssxmlx <span class="token keyword">FROM</span> djcbgjo <span class="token keyword">WHERE</span> oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">OPEN</span> cs_gj<span class="token punctuation">;</span>
	<span class="token keyword">LOOP</span>
		<span class="token keyword">FETCH</span> cs_gj <span class="token keyword">INTO</span> rd<span class="token punctuation">;</span>
		<span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> <span class="token operator">NOT</span> FOUND<span class="token punctuation">;</span>
		<span class="token keyword">IF</span> ssxmlx <span class="token operator">=</span> <span class="token string">'直接材料'</span> <span class="token keyword">THEN</span>
			<span class="token keyword">IF</span> rd<span class="token punctuation">.</span>cbyt <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token keyword">THEN</span>
				<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hssl<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjsl
					<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
					<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpfw <span class="token operator">LIKE</span> <span class="token string">'%'</span> <span class="token operator">||</span> o<span class="token punctuation">.</span>oid <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token operator">OR</span> ssfpfw <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbyt
							<span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">-- 本例根据物料清单定额数量进行分配</span>
				<span class="token keyword">SELECT</span> chxh<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>cpchxh<span class="token punctuation">)</span> <span class="token keyword">INTO</span> ssqdchxh<span class="token punctuation">,</span>ssqdcpxh <span class="token keyword">FROM</span> mlqd
					<span class="token keyword">WHERE</span> chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbyt <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> chxh<span class="token punctuation">;</span>
				<span class="token keyword">WITH</span> cpqd <span class="token punctuation">(</span>cpchxh<span class="token punctuation">,</span>chxh<span class="token punctuation">,</span>jgdh<span class="token punctuation">,</span>jc<span class="token punctuation">)</span> <span class="token keyword">AS</span>
					<span class="token punctuation">(</span><span class="token keyword">SELECT</span> cpchxh<span class="token punctuation">,</span>chxh<span class="token punctuation">,</span>jgdh<span class="token punctuation">,</span>jc <span class="token keyword">FROM</span> mlqd <span class="token keyword">WHERE</span> cpchxh <span class="token operator">=</span> ssqdcpxh <span class="token operator">AND</span> chxh <span class="token operator">=</span> ssqdchxh<span class="token punctuation">)</span>
				<span class="token keyword">SELECT</span> <span class="token function">round</span><span class="token punctuation">(</span>cl<span class="token punctuation">.</span>desl <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>cl<span class="token punctuation">.</span>desh <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> ssfpblsl <span class="token keyword">FROM</span>
					cpqd <span class="token keyword">AS</span> cp <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> mlqd cl <span class="token keyword">ON</span> cp<span class="token punctuation">.</span>cpchxh <span class="token operator">=</span> cl<span class="token punctuation">.</span>cpchxh <span class="token operator">AND</span> cp<span class="token punctuation">.</span>jc <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> cl<span class="token punctuation">.</span>jc
						<span class="token operator">AND</span> cl<span class="token punctuation">.</span>jgdh <span class="token operator">LIKE</span> cp<span class="token punctuation">.</span>jgdh <span class="token operator">||</span> <span class="token string">'%'</span>
					<span class="token keyword">WHERE</span> cl<span class="token punctuation">.</span>cpchxh <span class="token operator">=</span> ssqdcpxh <span class="token operator">AND</span> cl<span class="token punctuation">.</span>chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>lyxh<span class="token punctuation">;</span>
				 ssfpblje:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>ssfpblsl <span class="token operator">*</span> rd<span class="token punctuation">.</span>cbdj<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">IF</span> sshjsl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpblsl <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpblje <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
					<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> djcbgjs<span class="token punctuation">(</span>ny<span class="token punctuation">,</span>oid<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>hsoid<span class="token punctuation">,</span>xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">)</span>
						<span class="token keyword">SELECT</span> o<span class="token punctuation">.</span>ny <span class="token keyword">AS</span> ny<span class="token punctuation">,</span>$<span class="token number">2</span> <span class="token keyword">AS</span> oid<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>mid <span class="token keyword">AS</span> id<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>cbmc <span class="token keyword">AS</span> cbmc<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>jldw <span class="token keyword">AS</span> jldw<span class="token punctuation">,</span>
							m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblsl <span class="token keyword">AS</span> gjsl<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>cbdj <span class="token keyword">AS</span> cbdj<span class="token punctuation">,</span>m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblje <span class="token keyword">AS</span> cbje<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>cbyt <span class="token keyword">AS</span> cbyt<span class="token punctuation">,</span>o<span class="token punctuation">.</span>oid<span class="token punctuation">,</span>
							ssxmdh <span class="token keyword">AS</span> xmdh<span class="token punctuation">,</span> ssxmmc <span class="token keyword">AS</span> xmmc<span class="token punctuation">,</span> ssxmlx <span class="token keyword">AS</span> xmlx<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>scbm<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>wldw
						<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
						<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> 
						<span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpfw <span class="token operator">LIKE</span> <span class="token string">'%'</span> <span class="token operator">||</span> o<span class="token punctuation">.</span>oid <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token operator">OR</span> ssfpfw <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbyt
						<span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjfpje <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> sshjfpje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
					<span class="token keyword">IF</span> <span class="token punctuation">(</span>sshjfpje <span class="token operator">-</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">)</span> <span class="token operator">/</span> rd<span class="token punctuation">.</span>cbje <span class="token operator">&lt;</span> <span class="token number">0.005</span> <span class="token keyword">THEN</span>
							<span class="token keyword">SELECT</span> id <span class="token keyword">INTO</span> ssmaxid <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span>
								<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cbje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
							<span class="token keyword">UPDATE</span> djcbgjs <span class="token keyword">SET</span> cbje <span class="token operator">=</span> cbje <span class="token operator">+</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">-</span> sshjfpje<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token operator">AND</span> id <span class="token operator">=</span> ssmaxid<span class="token punctuation">;</span>
							<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
					<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
				<span class="token keyword">ELSE</span>
					<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,未找到货号'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,请指定货号'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">IF</span> ssxmlx <span class="token operator">=</span> <span class="token string">'直接人工'</span> <span class="token keyword">THEN</span>
			<span class="token keyword">IF</span> rd<span class="token punctuation">.</span>cbyt <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token keyword">THEN</span>
				<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hssl<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjsl
					<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
					<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpfw <span class="token operator">LIKE</span> <span class="token string">'%'</span> <span class="token operator">||</span> o<span class="token punctuation">.</span>oid <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token operator">OR</span> ssfpfw <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbyt
							<span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
				<span class="token keyword">IF</span> sshjsl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
					ssfpblsl:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>gjsl <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					ssfpblje:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> djcbgjs<span class="token punctuation">(</span>ny<span class="token punctuation">,</span>oid<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>hsoid<span class="token punctuation">,</span>xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">)</span>
						<span class="token keyword">SELECT</span> o<span class="token punctuation">.</span>ny <span class="token keyword">AS</span> ny<span class="token punctuation">,</span> $<span class="token number">2</span> <span class="token keyword">AS</span> oid<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>mid <span class="token keyword">AS</span> id<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbmc <span class="token keyword">AS</span> cbmc<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>jldw <span class="token keyword">AS</span> jldw<span class="token punctuation">,</span>
							m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblsl <span class="token keyword">AS</span> gjsl<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbdj <span class="token keyword">AS</span> cbdj<span class="token punctuation">,</span> m<span class="token punctuation">.</span>mid <span class="token operator">*</span> ssfpblje <span class="token keyword">AS</span> cbje<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbyt <span class="token keyword">AS</span> cbyt<span class="token punctuation">,</span>o<span class="token punctuation">.</span>oid<span class="token punctuation">,</span>
							ssxmdh <span class="token keyword">AS</span> xmdh<span class="token punctuation">,</span> ssxmmc <span class="token keyword">AS</span> xmmc<span class="token punctuation">,</span> ssxmlx <span class="token keyword">AS</span> xmlx<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>scbm<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>wldw
						<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
						<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> 
						<span class="token operator">AND</span> <span class="token punctuation">(</span>ssfpfw <span class="token operator">LIKE</span> <span class="token string">'%'</span> <span class="token operator">||</span> o<span class="token punctuation">.</span>oid <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token operator">OR</span> ssfpfw <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbyt
						<span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
					<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjfpje <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">IF</span> sshjfpje <span class="token operator">-</span> rd<span class="token punctuation">.</span>cbje <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
							<span class="token keyword">SELECT</span> id <span class="token keyword">INTO</span> ssmaxid  <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span>
								<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cbje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
							<span class="token keyword">UPDATE</span> djcbgjs <span class="token keyword">SET</span> cbje <span class="token operator">=</span> cbje <span class="token operator">+</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">-</span> sshjfpje<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token operator">AND</span> id <span class="token operator">=</span> ssmaxid<span class="token punctuation">;</span>
					<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
					<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
				<span class="token keyword">ELSE</span>
					<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,未找到货号'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,请指定货号'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">IF</span> ssxmlx <span class="token operator">=</span> <span class="token string">'间接材料'</span> <span class="token operator">OR</span> ssxmlx <span class="token operator">=</span> <span class="token string">'间接人工'</span> <span class="token keyword">THEN</span>
			<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hssl<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjsl  <span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
				<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
			<span class="token keyword">IF</span> sshjsl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
				ssfpblsl:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>gjsl <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ssfpblje:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> djcbgjs <span class="token punctuation">(</span>ny<span class="token punctuation">,</span>oid<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>hsoid<span class="token punctuation">,</span>xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">)</span>
				<span class="token keyword">SELECT</span> ssfpny <span class="token keyword">AS</span> ny<span class="token punctuation">,</span>$<span class="token number">2</span> <span class="token keyword">AS</span> oid<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>mid <span class="token keyword">AS</span> id<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>cbmc <span class="token keyword">AS</span> cbmc<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>jldw <span class="token keyword">AS</span> jldw<span class="token punctuation">,</span>
					m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblsl <span class="token keyword">AS</span> gjsl<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbdj <span class="token keyword">AS</span> cbdj<span class="token punctuation">,</span> m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblje <span class="token keyword">AS</span> cbje<span class="token punctuation">,</span>
					m<span class="token punctuation">.</span>chxh <span class="token keyword">AS</span> cbyt<span class="token punctuation">,</span>o<span class="token punctuation">.</span>oid<span class="token punctuation">,</span> ssxmdh <span class="token keyword">AS</span> xmdh<span class="token punctuation">,</span> ssxmmc <span class="token keyword">AS</span> xmmc<span class="token punctuation">,</span> ssxmlx <span class="token keyword">AS</span> xmlx<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>scbm<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>wldw
				<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
				<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
				<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjfpje <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">IF</span> sshjfpje <span class="token operator">-</span> rd<span class="token punctuation">.</span>cbje <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
					<span class="token keyword">SELECT</span> id <span class="token keyword">INTO</span> ssmaxid  <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cbje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token keyword">UPDATE</span> djcbgjs <span class="token keyword">SET</span> cbje <span class="token operator">=</span> cbje <span class="token operator">+</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">-</span> sshjfpje<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token operator">AND</span> id <span class="token operator">=</span> ssmaxid<span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,没有符合条件的产品'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">IF</span> ssxmlx <span class="token operator">=</span> <span class="token string">'制造费用'</span> <span class="token keyword">THEN</span>
			<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hssl<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjsl
				<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
				<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
			<span class="token keyword">IF</span> sshjsl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
				ssfpblsl :<span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>gjsl <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ssfpblje :<span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> djcbgjs <span class="token punctuation">(</span>ny<span class="token punctuation">,</span>oid<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>hsoid<span class="token punctuation">,</span>xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">)</span>
					<span class="token keyword">SELECT</span> ssfpny <span class="token keyword">AS</span> ny<span class="token punctuation">,</span> $<span class="token number">2</span> <span class="token keyword">AS</span> oid<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>mid <span class="token keyword">AS</span> id<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbmc <span class="token keyword">AS</span> cbmc<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>jldw <span class="token keyword">AS</span> jldw<span class="token punctuation">,</span>
						m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblsl <span class="token keyword">AS</span> gjsl<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbdj <span class="token keyword">AS</span> dj<span class="token punctuation">,</span> m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblje <span class="token keyword">AS</span> cbje<span class="token punctuation">,</span>
						m<span class="token punctuation">.</span>chxh <span class="token keyword">AS</span> cbyt<span class="token punctuation">,</span>o<span class="token punctuation">.</span>oid<span class="token punctuation">,</span> ssxmdh <span class="token keyword">AS</span> xmdh<span class="token punctuation">,</span> ssxmmc <span class="token keyword">AS</span> xmmc<span class="token punctuation">,</span> ssxmlx <span class="token keyword">AS</span> xmlx<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>scbm<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>wldw
					<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
					<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> 
					<span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>scbm <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>wldw <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">OR</span> m<span class="token punctuation">.</span>wldw <span class="token operator">=</span> rd<span class="token punctuation">.</span>wldw<span class="token punctuation">)</span> <span class="token punctuation">;</span>
				<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjfpje <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">IF</span> sshjfpje <span class="token operator">-</span> rd<span class="token punctuation">.</span>cbje <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
						<span class="token keyword">SELECT</span> id <span class="token keyword">INTO</span> ssmaxid  <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cbje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
						<span class="token keyword">UPDATE</span> djcbgjs <span class="token keyword">SET</span> cbje <span class="token operator">=</span> cbje <span class="token operator">+</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">-</span> sshjfpje<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token operator">AND</span> id <span class="token operator">=</span> ssmaxid<span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span> <span class="token punctuation">;</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,没有符合条件的产品'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
			<span class="token comment">-- 管理费用直接分配到检测车间入库的产品中	，直接在代码中加工作中心名称进行限制</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">IF</span> ssxmlx <span class="token operator">=</span> <span class="token string">'管理费用'</span> <span class="token keyword">THEN</span>
			rd<span class="token punctuation">.</span>scbm:<span class="token operator">=</span><span class="token string">'检测车间'</span><span class="token punctuation">;</span>
         <span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hssl<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjsl
				<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
				<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">;</span>
			<span class="token keyword">IF</span> sshjsl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
				ssfpblsl:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>gjsl <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				ssfpblje:<span class="token operator">=</span><span class="token function">round</span><span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">/</span> sshjsl<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> djcbgjs <span class="token punctuation">(</span>ny<span class="token punctuation">,</span>oid<span class="token punctuation">,</span>mid<span class="token punctuation">,</span>cbmc<span class="token punctuation">,</span>jldw<span class="token punctuation">,</span>gjsl<span class="token punctuation">,</span>cbdj<span class="token punctuation">,</span>cbje<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>hsoid<span class="token punctuation">,</span>xmdh<span class="token punctuation">,</span>xmmc<span class="token punctuation">,</span>xmlx<span class="token punctuation">,</span>scbm<span class="token punctuation">,</span>wldw<span class="token punctuation">)</span>
					<span class="token keyword">SELECT</span> ssfpny <span class="token keyword">AS</span> ny<span class="token punctuation">,</span> $<span class="token number">2</span> <span class="token keyword">AS</span> oid<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>mid <span class="token keyword">AS</span> id<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbmc <span class="token keyword">AS</span> cbmc<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>jldw <span class="token keyword">AS</span> jldw<span class="token punctuation">,</span>
						m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblsl <span class="token keyword">AS</span> gjsl<span class="token punctuation">,</span> rd<span class="token punctuation">.</span>cbdj <span class="token keyword">AS</span> dj<span class="token punctuation">,</span> m<span class="token punctuation">.</span>hssl <span class="token operator">*</span> ssfpblje <span class="token keyword">AS</span> cbje<span class="token punctuation">,</span>
						m<span class="token punctuation">.</span>chxh <span class="token keyword">AS</span> cbyt<span class="token punctuation">,</span> o<span class="token punctuation">.</span>oid<span class="token punctuation">,</span>
						ssxmdh <span class="token keyword">AS</span> xmdh<span class="token punctuation">,</span> ssxmmc <span class="token keyword">AS</span> xmmc<span class="token punctuation">,</span> ssxmlx <span class="token keyword">AS</span> xmlx<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>scbm <span class="token keyword">as</span> scbm<span class="token punctuation">,</span>rd<span class="token punctuation">.</span>wldw
					<span class="token keyword">FROM</span> djcbhso o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhsm m <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
					<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> ssfpny <span class="token operator">AND</span> o<span class="token punctuation">.</span>djr <span class="token operator">&lt;&gt;</span> <span class="token string">''</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>xsje <span class="token operator">&gt;</span> <span class="token number">0</span>
						<span class="token operator">AND</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> rd<span class="token punctuation">.</span>scbm<span class="token punctuation">;</span>
				<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjfpje <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">IF</span> sshjfpje <span class="token operator">-</span> rd<span class="token punctuation">.</span>cbje <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
					<span class="token keyword">SELECT</span> id <span class="token keyword">INTO</span> ssmaxid  <span class="token keyword">FROM</span> djcbgjs <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cbje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
					<span class="token keyword">UPDATE</span> djcbgjs <span class="token keyword">SET</span> cbje <span class="token operator">=</span> cbje <span class="token operator">+</span> <span class="token punctuation">(</span>rd<span class="token punctuation">.</span>cbje <span class="token operator">-</span> sshjfpje<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">)</span> <span class="token operator">AND</span> id <span class="token operator">=</span> ssmaxid<span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> fpje <span class="token operator">=</span> rd<span class="token punctuation">.</span>cbje<span class="token punctuation">,</span>sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">''</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				<span class="token keyword">UPDATE</span> djcbgjm <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>bz <span class="token operator">=</span> <span class="token string">'未能分配,没有符合条件的产品'</span> <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> rd<span class="token punctuation">.</span>mid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
	<span class="token keyword">CLOSE</span> cs_gj<span class="token punctuation">;</span>
   <span class="token comment">-- 归集单标记为已分配</span>
	<span class="token keyword">UPDATE</span> djcbgjo <span class="token keyword">SET</span> sffp <span class="token operator">=</span> <span class="token boolean">TRUE</span> <span class="token keyword">WHERE</span> oid <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span>
	rs:<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">RETURN</span> rs<span class="token punctuation">;</span>
   EXCEPTION <span class="token keyword">WHEN</span> others <span class="token keyword">THEN</span>
      GET stacked DIAGNOSTICS ssmsg <span class="token operator">=</span> MESSAGE_TEXT<span class="token punctuation">,</span>ssdet <span class="token operator">=</span> pg_exception_detail<span class="token punctuation">,</span>
         sstname <span class="token operator">=</span> TABLE_NAME<span class="token punctuation">,</span> sshint <span class="token operator">=</span> pg_exception_hint<span class="token punctuation">,</span> ssctt <span class="token operator">=</span> pg_exception_context<span class="token punctuation">;</span>
      <span class="token keyword">CALL</span> x9_jlproc<span class="token punctuation">(</span>ssmsg<span class="token punctuation">,</span> ssdet<span class="token punctuation">,</span> sstname<span class="token punctuation">,</span> sshint<span class="token punctuation">,</span> ssctt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
$BODY$<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">public</span><span class="token punctuation">.</span>x9_cbfp_gj<span class="token punctuation">(</span><span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">,</span> <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">)</span>
    OWNER <span class="token keyword">TO</span> postgres<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_366"></a>（二）、成本核算</h3> 
<p>将分配好的数据，汇总更新到成本核算单。<br> 成本核算单的结果再更新到入库单中，通过存货核算程序，再将入库成本重新更新的存货总账中。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">public</span><span class="token punctuation">.</span>x9_cbhs<span class="token punctuation">(</span>
	ssdqyh <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">,</span>
	sshsny <span class="token keyword">character</span><span class="token punctuation">,</span>
	ssscbm <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">)</span>
    <span class="token keyword">RETURNS</span> <span class="token keyword">character</span> <span class="token keyword">varying</span>
    <span class="token keyword">LANGUAGE</span> <span class="token string">'plpgsql'</span>
    COST <span class="token number">100</span>
    VOLATILE PARALLEL UNSAFE
<span class="token keyword">AS</span> $BODY$
   <span class="token comment">-- description:	成本分配之后，更新成本核算单</span>
<span class="token keyword">DECLARE</span>
   ssmsg <span class="token keyword">text</span><span class="token punctuation">;</span>ssdet <span class="token keyword">text</span><span class="token punctuation">;</span>sstname <span class="token keyword">text</span><span class="token punctuation">;</span>sshint <span class="token keyword">text</span><span class="token punctuation">;</span>ssctt <span class="token keyword">text</span><span class="token punctuation">;</span> <span class="token comment">--错误处理</span>
	rs <span class="token keyword">varchar</span><span class="token punctuation">;</span>
	rd record<span class="token punctuation">;</span>
	sshjcb <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sscbce <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ssrkid <span class="token keyword">int</span><span class="token punctuation">;</span>
	cs_cbhs refcursor<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">WITH</span> cbgj <span class="token punctuation">(</span>hsoid<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span>cpcb<span class="token punctuation">,</span>zjcl<span class="token punctuation">,</span>jjcl<span class="token punctuation">,</span>zjrg<span class="token punctuation">,</span>jjrg<span class="token punctuation">,</span>zzfy<span class="token punctuation">,</span>glfy<span class="token punctuation">)</span> <span class="token keyword">AS</span>
		<span class="token punctuation">(</span><span class="token keyword">SELECT</span> hsoid<span class="token punctuation">,</span>cbyt<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>cbje<span class="token punctuation">)</span> <span class="token keyword">AS</span> cpcb<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'直接材料'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> zjcl<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'间接材料'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> jjcl<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'直接人工'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> zjrg<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'间接人工'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> jjrg<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'制造费用'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> zzfy<span class="token punctuation">,</span>
		  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> xmlx <span class="token keyword">WHEN</span> <span class="token string">'管理费用'</span> <span class="token keyword">THEN</span> cbje <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> glfy
		<span class="token keyword">FROM</span> djcbgjs
		<span class="token keyword">WHERE</span> ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> scbm <span class="token operator">=</span> $<span class="token number">3</span>
		<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> hsoid<span class="token punctuation">,</span> cbyt<span class="token punctuation">)</span>
	<span class="token keyword">UPDATE</span> djcbhsm m <span class="token keyword">SET</span> cpcb <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>cpcb<span class="token punctuation">,</span>zjcl <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>zjcl<span class="token punctuation">,</span>zjrg <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>zjrg<span class="token punctuation">,</span>jjcl <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>jjcl<span class="token punctuation">,</span>
			jjrg <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>jjrg<span class="token punctuation">,</span>zzfy <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>zzfy<span class="token punctuation">,</span>glfy <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>glfy
		<span class="token keyword">FROM</span> cbgj <span class="token keyword">where</span> m<span class="token punctuation">.</span>oid <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>hsoid <span class="token operator">AND</span> m<span class="token punctuation">.</span>chxh <span class="token operator">=</span> cbgj<span class="token punctuation">.</span>cbyt <span class="token operator">and</span> 
		   <span class="token punctuation">(</span>m<span class="token punctuation">.</span>ny <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">AND</span> m<span class="token punctuation">.</span>scbm <span class="token operator">=</span> $<span class="token number">3</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>sfdj <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">UPDATE</span> djcbhsm <span class="token keyword">SET</span> cpml <span class="token operator">=</span> xsje <span class="token operator">-</span> cpcb <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>ny <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">AND</span> scbm <span class="token operator">=</span> $<span class="token number">3</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>sfdj <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">UPDATE</span> djcbhsm <span class="token keyword">SET</span> dwcb <span class="token operator">=</span> cpcb <span class="token operator">/</span> hssl<span class="token punctuation">,</span>dwml <span class="token operator">=</span> cpml <span class="token operator">/</span> hssl
		<span class="token keyword">WHERE</span> hssl <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>ny <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">AND</span> scbm <span class="token operator">=</span> $<span class="token number">3</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>sfdj <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">--更新入库成本</span>
   <span class="token keyword">OPEN</span> cs_cbhs <span class="token keyword">FOR</span>
		<span class="token keyword">SELECT</span> m<span class="token punctuation">.</span>chxh<span class="token punctuation">,</span>m<span class="token punctuation">.</span>dwcb<span class="token punctuation">,</span>m<span class="token punctuation">.</span>cpcb<span class="token punctuation">,</span>o<span class="token punctuation">.</span>hslb <span class="token keyword">FROM</span> djcbhsm m <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> djcbhso o <span class="token keyword">ON</span> o<span class="token punctuation">.</span>oid <span class="token operator">=</span> m<span class="token punctuation">.</span>oid
			<span class="token keyword">WHERE</span> o<span class="token punctuation">.</span>ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> o<span class="token punctuation">.</span>scbm <span class="token operator">=</span> $<span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">LOOP</span>
		<span class="token keyword">FETCH</span> cs_cbhs <span class="token keyword">INTO</span> rd<span class="token punctuation">;</span>
		<span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> <span class="token operator">NOT</span> FOUND<span class="token punctuation">;</span>
		<span class="token keyword">UPDATE</span> djchm <span class="token keyword">SET</span> rkdj <span class="token operator">=</span> rd<span class="token punctuation">.</span>dwcb<span class="token punctuation">,</span>rkje <span class="token operator">=</span> rd<span class="token punctuation">.</span>dwcb <span class="token operator">*</span> rksl
			<span class="token keyword">WHERE</span> ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>chxh <span class="token operator">AND</span> djmc <span class="token operator">=</span> rd<span class="token punctuation">.</span>hslb<span class="token punctuation">;</span>
		<span class="token keyword">SELECT</span>  <span class="token function">sum</span><span class="token punctuation">(</span>rkje<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sshjcb  <span class="token keyword">FROM</span> djchm <span class="token keyword">WHERE</span> ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>chxh <span class="token punctuation">;</span>
		sscbce:<span class="token operator">=</span>rd<span class="token punctuation">.</span>cpcb <span class="token operator">-</span> sshjcb<span class="token punctuation">;</span>
		<span class="token keyword">IF</span> sscbce <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
			ssrkid <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">SELECT</span>  mid <span class="token keyword">INTO</span> ssrkid  <span class="token keyword">FROM</span> djchm
				<span class="token keyword">WHERE</span> ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>chxh <span class="token operator">AND</span> djmc <span class="token operator">=</span> rd<span class="token punctuation">.</span>hslb <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> rkje <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">IF</span> ssrkid <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">THEN</span>
				<span class="token keyword">UPDATE</span> djchm <span class="token keyword">SET</span> rkje <span class="token operator">=</span> rkje <span class="token operator">+</span> sscbce <span class="token keyword">WHERE</span> mid <span class="token operator">=</span> ssrkid<span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	   <span class="token comment">-- 更新委外入库单</span>
      <span class="token keyword">IF</span> $<span class="token number">3</span> <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">AND</span> rd<span class="token punctuation">.</span>hslb <span class="token operator">=</span> <span class="token string">'委外入库单'</span> <span class="token keyword">THEN</span>
         <span class="token keyword">UPDATE</span> djchm <span class="token keyword">SET</span> rkje <span class="token operator">=</span> rkje <span class="token operator">+</span> jgje<span class="token punctuation">,</span>rkdj <span class="token operator">=</span> <span class="token punctuation">(</span>rkje <span class="token operator">+</span> jgje<span class="token punctuation">)</span> <span class="token operator">/</span> rksl
            <span class="token keyword">WHERE</span> ny <span class="token operator">=</span> $<span class="token number">2</span> <span class="token operator">AND</span> chxh <span class="token operator">=</span> rd<span class="token punctuation">.</span>chxh <span class="token operator">AND</span> djmc <span class="token operator">=</span> rd<span class="token punctuation">.</span>hslb <span class="token operator">and</span> sfdj<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
      <span class="token comment">-- into rd.chxh,rd.dwcb,rd.cpcb,rd.hslb ;</span>
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
	<span class="token keyword">CLOSE</span> cs_cbhs<span class="token punctuation">;</span>
	<span class="token comment">-- 存货核算</span>
	rs:<span class="token operator">=</span>x9_hsch<span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">IF</span> position<span class="token punctuation">(</span><span class="token string">'存货核算完成'</span> <span class="token operator">in</span> rs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span>
      <span class="token keyword">RETURN</span> <span class="token string">'成本核算完成！'</span><span class="token punctuation">;</span>
   <span class="token keyword">ELSE</span>
      <span class="token keyword">RETURN</span> rs<span class="token punctuation">;</span>
   <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>   
   EXCEPTION <span class="token keyword">WHEN</span> others <span class="token keyword">THEN</span>
      GET stacked DIAGNOSTICS ssmsg <span class="token operator">=</span> MESSAGE_TEXT<span class="token punctuation">,</span>ssdet <span class="token operator">=</span> pg_exception_detail<span class="token punctuation">,</span>
         sstname <span class="token operator">=</span> TABLE_NAME<span class="token punctuation">,</span> sshint <span class="token operator">=</span> pg_exception_hint<span class="token punctuation">,</span> ssctt <span class="token operator">=</span> pg_exception_context<span class="token punctuation">;</span>
      <span class="token keyword">CALL</span> x9_jlproc<span class="token punctuation">(</span>ssmsg<span class="token punctuation">,</span> ssdet<span class="token punctuation">,</span> sstname<span class="token punctuation">,</span> sshint<span class="token punctuation">,</span> ssctt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> ssmsg<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
$BODY$<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">public</span><span class="token punctuation">.</span>x9_cbhs<span class="token punctuation">(</span><span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">,</span> <span class="token keyword">character</span><span class="token punctuation">,</span> <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">)</span>
    OWNER <span class="token keyword">TO</span> postgres<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_451"></a>六、结果输出</h2> 
<p>1、成本总账<br> <img src="https://images2.imgbox.com/4d/f2/ZVULPVFK_o.png" alt="在这里插入图片描述"><br> 2、成本明细账<br> <img src="https://images2.imgbox.com/fb/62/yb1B9Pvx_o.png" alt="在这里插入图片描述"><br> 3、成本因素分析<br> <img src="https://images2.imgbox.com/84/a1/ccZMKWIq_o.png" alt="在这里插入图片描述"><br> 4、成本利润分析<br> <img src="https://images2.imgbox.com/84/f4/KvGhHV1x_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_460"></a>七、总结</h2> 
<p>综上所述，完成了自制品和外协品的入库成本的核算。<br> 在当今激烈的市场竞争环境中，能够做到这些还是很重要的。在实际业务中，可以将核算结果或预测结果应用到订单编辑中和其他业务环节中，成为重要的参考信息。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b1a96a098bdebcbaefd48f06ea8b378/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">调试webapck源码方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eafdf51a38fd4cf3cabf1f4bdf9bf1ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Visual Studio和VS Code的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>