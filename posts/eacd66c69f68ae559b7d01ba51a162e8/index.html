<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ceph存储 性能测试常见问题 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ceph存储 性能测试常见问题" />
<meta property="og:description" content="目录
名词解释
性能测试FAQ
1. 性能测试的基本过程是什么？
2. 如何准备测试环境？
3. 准备环境时，由于条件限制，机器系统硬件环境可能不同，机器硬件的cpu主频，单双核，硬盘转速等对性能测试的影响情况如何，在准备测试中哪些因素可以较少考虑或者忽略？
4. 我们的机器本身会启很多自动服务，其对性能的影响如何？
5. 测试过程中应该收集哪些数据？应该怎么获得？
6. 是否打开cache，对性能测试有什么影响？
7. 系统缓存对性能测试有什么影响，如何减少这种影响？
8. 如何选择压力工具？
9. 如何准备压力词表？
10. 压力测试中，每组压力执行多长时间合适？
11. 如何配置压力？
12. 什么是极限，怎么知道已经到了极限？
13. vmstat 和 iostat 各项指标有什么含义，怎么用于分析？
14. 如何评估测试结果的正确性和合理性？
15. 网卡带宽对压力测试有什么影响？
16. timewait 对服务极限压力有何影响？
性能测试Tips (来自于大家的经验收集)
1．测试前需要对测试结果进行预估
2. 测试过程中对测试环境，以及测试数据的记录应该清晰统一。
3. 当对要测试的模块或者系统不熟悉时，应该提前做一些背景了解。
性能测试实例
附
性能测试常用工具简介
起压工具
数据采集工具
其他工具
性能测试FAQ
1. 性能测试的基本过程是什么？
2. 如何准备测试环境？
3. 准备环境时，由于条件限制，机器系统硬件环境可能不同，机器硬件的cpu主频，单双核，硬盘转速等对性能测试的影响情况如何，在准备测试中哪些因素可以较少考虑或者忽略？
4. 我们的机器本身会启很多自动服务，其对性能的影响如何？
5. 测试过程中应该收集哪些数据？应该怎么获得？
6. 是否打开cache，对性能测试有什么影响？
7. 系统缓存对性能测试有什么影响，如何减少这种影响？
8. 如何选择压力工具？" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/eacd66c69f68ae559b7d01ba51a162e8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-09-12T15:50:19+08:00" />
<meta property="article:modified_time" content="2018-09-12T15:50:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ceph存储 性能测试常见问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A-toc" style="margin-left:40px;"><a href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A" rel="nofollow">名词解释</a></p> 
<p id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95FAQ-toc" style="margin-left:40px;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95FAQ" rel="nofollow">性能测试FAQ</a></p> 
<p id="1.%C2%A0%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%BF%87%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F-toc" style="margin-left:80px;"><a href="#1.%C2%A0%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%BF%87%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" rel="nofollow">1. 性能测试的基本过程是什么？</a></p> 
<p id="2.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%9F-toc" style="margin-left:80px;"><a href="#2.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%9F" rel="nofollow">2. 如何准备测试环境？</a></p> 
<p id="3.%C2%A0%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E6%97%B6%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%9D%A1%E4%BB%B6%E9%99%90%E5%88%B6%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E5%8F%AF%E8%83%BD%E4%B8%8D%E5%90%8C%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%9A%84cpu%E4%B8%BB%E9%A2%91%EF%BC%8C%E5%8D%95%E5%8F%8C%E6%A0%B8%EF%BC%8C%E7%A1%AC%E7%9B%98%E8%BD%AC%E9%80%9F%E7%AD%89%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BD%B1%E5%93%8D%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%EF%BC%8C%E5%9C%A8%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E5%8F%AF%E4%BB%A5%E8%BE%83%E5%B0%91%E8%80%83%E8%99%91%E6%88%96%E8%80%85%E5%BF%BD%E7%95%A5%EF%BC%9F-toc" style="margin-left:80px;"><a href="#3.%C2%A0%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E6%97%B6%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%9D%A1%E4%BB%B6%E9%99%90%E5%88%B6%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E5%8F%AF%E8%83%BD%E4%B8%8D%E5%90%8C%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%9A%84cpu%E4%B8%BB%E9%A2%91%EF%BC%8C%E5%8D%95%E5%8F%8C%E6%A0%B8%EF%BC%8C%E7%A1%AC%E7%9B%98%E8%BD%AC%E9%80%9F%E7%AD%89%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BD%B1%E5%93%8D%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%EF%BC%8C%E5%9C%A8%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E5%8F%AF%E4%BB%A5%E8%BE%83%E5%B0%91%E8%80%83%E8%99%91%E6%88%96%E8%80%85%E5%BF%BD%E7%95%A5%EF%BC%9F" rel="nofollow">3. 准备环境时，由于条件限制，机器系统硬件环境可能不同，机器硬件的cpu主频，单双核，硬盘转速等对性能测试的影响情况如何，在准备测试中哪些因素可以较少考虑或者忽略？</a></p> 
<p id="4.%C2%A0%E6%88%91%E4%BB%AC%E7%9A%84%E6%9C%BA%E5%99%A8%E6%9C%AC%E8%BA%AB%E4%BC%9A%E5%90%AF%E5%BE%88%E5%A4%9A%E8%87%AA%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%85%B6%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D%E5%A6%82%E4%BD%95%EF%BC%9F-toc" style="margin-left:80px;"><a href="#4.%C2%A0%E6%88%91%E4%BB%AC%E7%9A%84%E6%9C%BA%E5%99%A8%E6%9C%AC%E8%BA%AB%E4%BC%9A%E5%90%AF%E5%BE%88%E5%A4%9A%E8%87%AA%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%85%B6%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D%E5%A6%82%E4%BD%95%EF%BC%9F" rel="nofollow">4. 我们的机器本身会启很多自动服务，其对性能的影响如何？</a></p> 
<p id="5.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%BA%94%E8%AF%A5%E6%94%B6%E9%9B%86%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%EF%BC%9F%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E8%8E%B7%E5%BE%97%EF%BC%9F-toc" style="margin-left:80px;"><a href="#5.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%BA%94%E8%AF%A5%E6%94%B6%E9%9B%86%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%EF%BC%9F%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E8%8E%B7%E5%BE%97%EF%BC%9F" rel="nofollow">5. 测试过程中应该收集哪些数据？应该怎么获得？</a></p> 
<p id="6.%C2%A0%E6%98%AF%E5%90%A6%E6%89%93%E5%BC%80cache%EF%BC%8C%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F-toc" style="margin-left:80px;"><a href="#6.%C2%A0%E6%98%AF%E5%90%A6%E6%89%93%E5%BC%80cache%EF%BC%8C%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F" rel="nofollow">6. 是否打开cache，对性能测试有什么影响？</a></p> 
<p id="7.%C2%A0%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%8C%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E8%BF%99%E7%A7%8D%E5%BD%B1%E5%93%8D%EF%BC%9F-toc" style="margin-left:80px;"><a href="#7.%C2%A0%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%8C%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E8%BF%99%E7%A7%8D%E5%BD%B1%E5%93%8D%EF%BC%9F" rel="nofollow">7. 系统缓存对性能测试有什么影响，如何减少这种影响？</a></p> 
<p id="8.%C2%A0%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%8E%8B%E5%8A%9B%E5%B7%A5%E5%85%B7%EF%BC%9F-toc" style="margin-left:80px;"><a href="#8.%C2%A0%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%8E%8B%E5%8A%9B%E5%B7%A5%E5%85%B7%EF%BC%9F" rel="nofollow">8. 如何选择压力工具？</a></p> 
<p id="9.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E5%8E%8B%E5%8A%9B%E8%AF%8D%E8%A1%A8%EF%BC%9F-toc" style="margin-left:80px;"><a href="#9.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E5%8E%8B%E5%8A%9B%E8%AF%8D%E8%A1%A8%EF%BC%9F" rel="nofollow">9. 如何准备压力词表？</a></p> 
<p id="10.%C2%A0%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E4%B8%AD%EF%BC%8C%E6%AF%8F%E7%BB%84%E5%8E%8B%E5%8A%9B%E6%89%A7%E8%A1%8C%E5%A4%9A%E9%95%BF%E6%97%B6%E9%97%B4%E5%90%88%E9%80%82%EF%BC%9F-toc" style="margin-left:80px;"><a href="#10.%C2%A0%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E4%B8%AD%EF%BC%8C%E6%AF%8F%E7%BB%84%E5%8E%8B%E5%8A%9B%E6%89%A7%E8%A1%8C%E5%A4%9A%E9%95%BF%E6%97%B6%E9%97%B4%E5%90%88%E9%80%82%EF%BC%9F" rel="nofollow">10. 压力测试中，每组压力执行多长时间合适？</a></p> 
<p id="11.%C2%A0%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%8E%8B%E5%8A%9B%EF%BC%9F-toc" style="margin-left:80px;"><a href="#11.%C2%A0%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%8E%8B%E5%8A%9B%EF%BC%9F" rel="nofollow">11. 如何配置压力？</a></p> 
<p id="12.%C2%A0%E4%BB%80%E4%B9%88%E6%98%AF%E6%9E%81%E9%99%90%EF%BC%8C%E6%80%8E%E4%B9%88%E7%9F%A5%E9%81%93%E5%B7%B2%E7%BB%8F%E5%88%B0%E4%BA%86%E6%9E%81%E9%99%90%EF%BC%9F-toc" style="margin-left:80px;"><a href="#12.%C2%A0%E4%BB%80%E4%B9%88%E6%98%AF%E6%9E%81%E9%99%90%EF%BC%8C%E6%80%8E%E4%B9%88%E7%9F%A5%E9%81%93%E5%B7%B2%E7%BB%8F%E5%88%B0%E4%BA%86%E6%9E%81%E9%99%90%EF%BC%9F" rel="nofollow">12. 什么是极限，怎么知道已经到了极限？</a></p> 
<p id="13.%20vmstat%C2%A0%E5%92%8C%C2%A0iostat%C2%A0%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87%E6%9C%89%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89%EF%BC%8C%E6%80%8E%E4%B9%88%E7%94%A8%E4%BA%8E%E5%88%86%E6%9E%90%EF%BC%9F-toc" style="margin-left:80px;"><a href="#13.%20vmstat%C2%A0%E5%92%8C%C2%A0iostat%C2%A0%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87%E6%9C%89%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89%EF%BC%8C%E6%80%8E%E4%B9%88%E7%94%A8%E4%BA%8E%E5%88%86%E6%9E%90%EF%BC%9F" rel="nofollow">13. vmstat 和 iostat 各项指标有什么含义，怎么用于分析？</a></p> 
<p id="14.%C2%A0%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%A7%E5%92%8C%E5%90%88%E7%90%86%E6%80%A7%EF%BC%9F-toc" style="margin-left:80px;"><a href="#14.%C2%A0%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%A7%E5%92%8C%E5%90%88%E7%90%86%E6%80%A7%EF%BC%9F" rel="nofollow">14. 如何评估测试结果的正确性和合理性？</a></p> 
<p id="15.%C2%A0%E7%BD%91%E5%8D%A1%E5%B8%A6%E5%AE%BD%E5%AF%B9%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F-toc" style="margin-left:80px;"><a href="#15.%C2%A0%E7%BD%91%E5%8D%A1%E5%B8%A6%E5%AE%BD%E5%AF%B9%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F" rel="nofollow">15. 网卡带宽对压力测试有什么影响？</a></p> 
<p id="16.%20timewait%C2%A0%E5%AF%B9%E6%9C%8D%E5%8A%A1%E6%9E%81%E9%99%90%E5%8E%8B%E5%8A%9B%E6%9C%89%E4%BD%95%E5%BD%B1%E5%93%8D%EF%BC%9F-toc" style="margin-left:80px;"><a href="#16.%20timewait%C2%A0%E5%AF%B9%E6%9C%8D%E5%8A%A1%E6%9E%81%E9%99%90%E5%8E%8B%E5%8A%9B%E6%9C%89%E4%BD%95%E5%BD%B1%E5%93%8D%EF%BC%9F" rel="nofollow">16. timewait 对服务极限压力有何影响？</a></p> 
<p id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95Tips%20(%E6%9D%A5%E8%87%AA%E4%BA%8E%E5%A4%A7%E5%AE%B6%E7%9A%84%E7%BB%8F%E9%AA%8C%E6%94%B6%E9%9B%86)-toc" style="margin-left:40px;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95Tips%20%28%E6%9D%A5%E8%87%AA%E4%BA%8E%E5%A4%A7%E5%AE%B6%E7%9A%84%E7%BB%8F%E9%AA%8C%E6%94%B6%E9%9B%86%29" rel="nofollow">性能测试Tips (来自于大家的经验收集)</a></p> 
<p id="1%EF%BC%8E%E6%B5%8B%E8%AF%95%E5%89%8D%E9%9C%80%E8%A6%81%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E9%A2%84%E4%BC%B0-toc" style="margin-left:80px;"><a href="#1%EF%BC%8E%E6%B5%8B%E8%AF%95%E5%89%8D%E9%9C%80%E8%A6%81%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E9%A2%84%E4%BC%B0" rel="nofollow">1．测试前需要对测试结果进行预估</a></p> 
<p id="2.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AE%B0%E5%BD%95%E5%BA%94%E8%AF%A5%E6%B8%85%E6%99%B0%E7%BB%9F%E4%B8%80%E3%80%82-toc" style="margin-left:80px;"><a href="#2.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AE%B0%E5%BD%95%E5%BA%94%E8%AF%A5%E6%B8%85%E6%99%B0%E7%BB%9F%E4%B8%80%E3%80%82" rel="nofollow">2. 测试过程中对测试环境，以及测试数据的记录应该清晰统一。</a></p> 
<p id="3.%C2%A0%E5%BD%93%E5%AF%B9%E8%A6%81%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A8%A1%E5%9D%97%E6%88%96%E8%80%85%E7%B3%BB%E7%BB%9F%E4%B8%8D%E7%86%9F%E6%82%89%E6%97%B6%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%8F%90%E5%89%8D%E5%81%9A%E4%B8%80%E4%BA%9B%E8%83%8C%E6%99%AF%E4%BA%86%E8%A7%A3%E3%80%82-toc" style="margin-left:80px;"><a href="#3.%C2%A0%E5%BD%93%E5%AF%B9%E8%A6%81%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A8%A1%E5%9D%97%E6%88%96%E8%80%85%E7%B3%BB%E7%BB%9F%E4%B8%8D%E7%86%9F%E6%82%89%E6%97%B6%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%8F%90%E5%89%8D%E5%81%9A%E4%B8%80%E4%BA%9B%E8%83%8C%E6%99%AF%E4%BA%86%E8%A7%A3%E3%80%82" rel="nofollow">3. 当对要测试的模块或者系统不熟悉时，应该提前做一些背景了解。</a></p> 
<p id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B" rel="nofollow">性能测试实例</a></p> 
<p id="%E9%99%84-toc" style="margin-left:0px;"><a href="#%E9%99%84" rel="nofollow">附</a></p> 
<p id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px;"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B" rel="nofollow">性能测试常用工具简介</a></p> 
<p id="%E8%B5%B7%E5%8E%8B%E5%B7%A5%E5%85%B7-toc" style="margin-left:80px;"><a href="#%E8%B5%B7%E5%8E%8B%E5%B7%A5%E5%85%B7" rel="nofollow">起压工具</a></p> 
<p id="%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B7%A5%E5%85%B7-toc" style="margin-left:80px;"><a href="#%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B7%A5%E5%85%B7" rel="nofollow">数据采集工具</a></p> 
<p id="%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7-toc" style="margin-left:80px;"><a href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7" rel="nofollow">其他工具</a></p> 
<hr id="hr-toc"> 
<p>性能测试FAQ</p> 
<p> </p> 
<p>1. 性能测试的基本过程是什么？</p> 
<p> </p> 
<p>2. 如何准备测试环境？</p> 
<p> </p> 
<p>3. 准备环境时，由于条件限制，机器系统硬件环境可能不同，机器硬件的cpu主频，单双核，硬盘转速等对性能测试的影响情况如何，在准备测试中哪些因素可以较少考虑或者忽略？</p> 
<p> </p> 
<p>4. 我们的机器本身会启很多自动服务，其对性能的影响如何？</p> 
<p> </p> 
<p>5. 测试过程中应该收集哪些数据？应该怎么获得？</p> 
<p> </p> 
<p>6. 是否打开cache，对性能测试有什么影响？</p> 
<p> </p> 
<p>7. 系统缓存对性能测试有什么影响，如何减少这种影响？</p> 
<p> </p> 
<p>8. 如何选择压力工具？</p> 
<p> </p> 
<p>9. 如何准备压力词表？</p> 
<p> </p> 
<p>10. 压力测试中，每组压力执行多长时间合适？</p> 
<p> </p> 
<p>11. 如何配置压力？</p> 
<p> </p> 
<p>12. 什么是极限，怎么知道已经到了极限？</p> 
<p> </p> 
<p>13. vmstat 和 iostat 各项指标有什么含义，怎么用于分析？</p> 
<p> </p> 
<p>14. 如何评估测试结果的正确性和合理性？</p> 
<p> </p> 
<p>15. 网卡带宽对压力测试有什么影响？</p> 
<p> </p> 
<p>16. timewait 对服务极限压力有何影响？</p> 
<p> </p> 
<p>性能测试Tips (来自于大家的经验收集)</p> 
<p> </p> 
<p>1．测试前需要对测试结果进行预估</p> 
<p> </p> 
<p>2. 测试过程中对测试环境，以及测试数据的记录应该清晰统一。</p> 
<p> </p> 
<p>3. 当对要测试的模块或者系统不熟悉时，应该提前做一些背景了解。</p> 
<p> </p> 
<p>性能测试实例</p> 
<p> </p> 
<p>附</p> 
<p> </p> 
<p>性能测试常用工具简介</p> 
<p> </p> 
<p>起压工具</p> 
<p> </p> 
<p>数据采集工具</p> 
<p> </p> 
<p>其他工具</p> 
<p> </p> 
<p>相关文章</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p><strong> </strong></p> 
<p> </p> 
<h3 id="%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><a name="%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"></a>名词解释</h3> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>用户态数据：指从模块角度看到的反映系统性能的一些数据，如平均响应时间等。通常使用用户态数据直接衡量模块和集群的极限压力。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>系统态数据：指从系统角度看到反映系统性能的一些数据，比如cpu占用率等。通常系统态数据来衡量系统负载和分析性能瓶颈，不直接用它来作为评估极限性能的标准。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h3 id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95FAQ"><a name="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95FAQ_AN1"></a>性能测试FAQ</h3> 
<p> </p> 
<h4 id="1.%C2%A0%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%BF%87%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">1. 性能测试的基本过程是什么？</h4> 
<p> </p> 
<p>性能测试，大概分为以下过程：</p> 
<p> </p> 
<p>l  测试计划制定</p> 
<p> </p> 
<p>确定性能测试的目标，采用的测试方法等。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>通常性能测试可能有以下目标：</p> 
<p> </p> 
<p>                        i.              对架构升级，或者性能升级进行评估测试，摸清极限压力。通常这类测试更加关注用户态的数据。</p> 
<p> </p> 
<p>                      ii.              性能升级前或升级进行中的调研，旨在摸清模块性能方面存在的问题，寻找优化的的切入点。通常这类测试更加关注系统态的数据。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>当然这里提到的是两个主要的方向，实际的性能测试，可能有特性化的需求，比如测试某个模块的 并发性。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>对于测试方法，确定时大概需要考虑以下几个方面：</p> 
<p> </p> 
<p>1.       测试目标</p> 
<p> </p> 
<p>性能测试的目标决定了性能测试的方方面面，比如是测单机，单模块的极限性能，还是测一个子系统的极限性能。这决定了采用测试方法，以及机器的准备，一个子系统的测试，理想情况，需要按照线上的部署方式，完成各各模块在测试环境的部署。而单机，单模块的测试，则对环境要求没有那么严格，但需要考虑测试机器CPU，内存，以及机器上运行的其他程序，对测试的影响。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>2.       环境设计</p> 
<p> </p> 
<p>包括以下几个方面：</p> 
<p> </p> 
<p>1.       需要几台机器，各各模块如何部署。</p> 
<p> </p> 
<p>2.       对机器的硬件(CPU, 内存)，系统(内核，其他软件)要求。</p> 
<p> </p> 
<p>3.       使用的测试方法和准备收集的数据。</p> 
<p> </p> 
<p>关于测试方法，以及数据采集，针对不同的性能测试需求，都有不同的方法。后面会有针对性的说明。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>l  测试实施</p> 
<p> </p> 
<p>按照测试计划完成性能测试。并收集重要的数据以供后续的数据分析。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>l  测试数据分析</p> 
<p> </p> 
<p>对测试过程得到的数据进行分析。得到 模块 或者 系统 在性能方面的指标，或者发现 模块 或 系统 在性能方面的问题。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>l  完成测试报告</p> 
<p> </p> 
<p>通过测试报告，可以清晰的说明性能测试的情况，可用作评审，以及其他相关测试工作的参考。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="2.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%9F">2. 如何准备测试环境？</h4> 
<p> </p> 
<p>       根据测试类型的不同，测试环境的准备也会有一些不同。</p> 
<p> </p> 
<p>一般的极限压力测试，要求测试环境与线上环境尽可能一样，包括软硬件环境。硬件环境主要指机型（dell还是hp）与配置（内存，cpu）应该相当；软件环境包括 基础库，线上与该模块一起部署在一台机器的其他模块，以及这些模块应有的压力。</p> 
<p> </p> 
<p>       进行单模块的性能测试一般则要求环境里面影响因素极可能少，一般只运行被测试程序。</p> 
<p> </p> 
<p>       进行对比测试，一般是相同硬件，不同程序实现的测试，或者相同程序，不同硬件的测试。则要求两个对比环境中，除了需要对比的因素，其他条件尽可能相同，词表和测试方法，也应该保持一致。</p> 
<p> </p> 
<h4 id="3.%C2%A0%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83%E6%97%B6%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%9D%A1%E4%BB%B6%E9%99%90%E5%88%B6%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E5%8F%AF%E8%83%BD%E4%B8%8D%E5%90%8C%EF%BC%8C%E6%9C%BA%E5%99%A8%E7%A1%AC%E4%BB%B6%E7%9A%84cpu%E4%B8%BB%E9%A2%91%EF%BC%8C%E5%8D%95%E5%8F%8C%E6%A0%B8%EF%BC%8C%E7%A1%AC%E7%9B%98%E8%BD%AC%E9%80%9F%E7%AD%89%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BD%B1%E5%93%8D%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%EF%BC%8C%E5%9C%A8%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%93%AA%E4%BA%9B%E5%9B%A0%E7%B4%A0%E5%8F%AF%E4%BB%A5%E8%BE%83%E5%B0%91%E8%80%83%E8%99%91%E6%88%96%E8%80%85%E5%BF%BD%E7%95%A5%EF%BC%9F">3. 准备环境时，由于条件限制，机器系统硬件环境可能不同，机器硬件的cpu主频，单双核，硬盘转速等对性能测试的影响情况如何，在准备测试中哪些因素可以较少考虑或者忽略？</h4> 
<p> </p> 
<p>   机器环境中常见的一些因素以及影响情况如下：</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>Ø    <strong>CPU</strong><strong>主频及单双核</strong></p> 
<p> </p> 
<p>CPU主频及单双核主要影响CPU密集型的业务的性能。同等压力下，较高主频的CPU一般处理请求的时间短，而较低主频的CPU处理请求的时间长。</p> 
<p> </p> 
<p>目前机器的主流CPU 双路双核和双路四核 根据主频可以分为Xeon3.0G  2.8G</p> 
<p> </p> 
<p>Ø  <strong>内存大小</strong></p> 
<p> </p> 
<p>内存大小对业务性能影响较为明显，大内存的机器，其系统可用cache较大，可加载到内存中的数据较多，可以明显减少系统I/O，大大缩短响应时间。</p> 
<p> </p> 
<p>目前单条容量2G的内存比较多，机器总内存8G和16G居多。测试前可以通过free命令查看</p> 
<p> </p> 
<p>Ø  <strong>磁盘转数</strong></p> 
<p> </p> 
<p>我们现有磁盘的转速基本都是10k/min，15k/min的磁盘较少，除非特殊情况，一般可以忽略该配置。</p> 
<p> </p> 
<p>Ø  <strong>磁盘容量</strong></p> 
<p> </p> 
<p>常见的磁盘容量有73GB、146GB、300GB。较大的磁盘容量单盘片数据密度较高，磁头寻道时间较短，磁盘性能较好。</p> 
<p> </p> 
<p>Ø  <strong>磁盘接口</strong></p> 
<p> </p> 
<p>常见磁盘接口有SCSI、SATA、SAS，其中以SAS接口的磁盘性能最好。</p> 
<p> </p> 
<p>Ø  <strong>预读RA</strong><strong>值</strong></p> 
<p> </p> 
<p>系统预读，对于随即读为主的业务，由于读取的数据存储较为分散，建议调小该预读值；相反以顺序读为主的业务，应该调大该值。</p> 
<p> </p> 
<p>在随机度为主的业务中，调小该值可以明显看到iostat统计到的r/s值明显降低，vmstat统计到的bi值同时降低。</p> 
<p> </p> 
<p>Ø  <strong>RAID</strong><strong>级别</strong></p> 
<p> </p> 
<p>现有机器的RAID级别只有两种：RAID1+0和RAID5，RAID1+0的I/O性能好于RAID5</p> 
<p> </p> 
<p>Ø  <strong>RAID</strong><strong>读写比率</strong></p> 
<p> </p> 
<p>只有HP的RAID卡有读写比率的概念，Dell的RAID卡没有这个概念。</p> 
<p> </p> 
<p>Ø  <strong>Swap</strong><strong>分区</strong></p> 
<p> </p> 
<p>Swap分区对系统性能影响较小，可以忽略。大小可以通过free查看</p> 
<p> </p> 
<p>Ø  <strong>磁盘碎片</strong></p> 
<p> </p> 
<p>       对于ext2文件系统来说，磁盘块的分配会根据一定的算法尽量使得同一目录下的文件放在同一块组，即尽量保持连续性。多线程的随机读写会导致文件在磁盘上的存放连续性较低。磁盘连续性越低，导致磁盘寻道频繁，降低了系统的I/O性能。磁盘连续性可以通过plblk工具查看。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="4.%C2%A0%E6%88%91%E4%BB%AC%E7%9A%84%E6%9C%BA%E5%99%A8%E6%9C%AC%E8%BA%AB%E4%BC%9A%E5%90%AF%E5%BE%88%E5%A4%9A%E8%87%AA%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%85%B6%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D%E5%A6%82%E4%BD%95%EF%BC%9F">4. 我们的机器本身会启很多自动服务，其对性能的影响如何？</h4> 
<p> </p> 
<p>机器上启动的服务如下面所列：</p> 
<p> </p> 
<p>hwinfo: 硬件信息插件 每天一次 ，cpu计算型服务</p> 
<p> </p> 
<p>update: 自更新插件 触发式    （插件网络下载）</p> 
<p> </p> 
<p>system-mon: 系统信息插件（包括vmstat和iostat） 每10分钟一次 ，cpu计算型服务、由于会写日志，所以会有少量IO。</p> 
<p> </p> 
<p>mysql-mon: 数据库监控插件（只有几个产品线部署了） 每10分钟一次 ，读取内存中的一些信息，有一些写日志的操作，可能会有少量IO。</p> 
<p> </p> 
<p>sys_agent.sh:  sa的获取资产信息的程序，启动时运行一下。</p> 
<p> </p> 
<p>磁盘监控:  大概每半小时上线上服务器df一下（其它服务器上）</p> 
<p> </p> 
<p>core监控:  大概每半天，上线上find core一下（会制定home下的工作目录，其它服务器上）</p> 
<p> </p> 
<p>服务监控: 每20秒会向模块发出一次监控请求（其它服务器上）</p> 
<p> </p> 
<h4 id="5.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%BA%94%E8%AF%A5%E6%94%B6%E9%9B%86%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%EF%BC%9F%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E8%8E%B7%E5%BE%97%EF%BC%9F">5. 测试过程中应该收集哪些数据？应该怎么获得？</h4> 
<p> </p> 
<p>一般而言，需要收集的数据分为两类：用户态数据和系统态数据。用户态数据直接衡量模块和集群的极限压力；而系统态数据来衡量系统负载和分析性能瓶颈。</p> 
<p> </p> 
<p>用户态关心的数据包括：</p> 
<p> </p> 
<p>A.     请求平均响应时间</p> 
<p> </p> 
<p>B.      最大响应时间</p> 
<p> </p> 
<p>C.      Overflow数或超时数</p> 
<p> </p> 
<p>D.     N倍平均响应时间请求比例</p> 
<p> </p> 
<p>其中， n倍平均响应时间比例是指在所有请求中响应时间超过n倍平均响应时间的请求比例有多大，这个参数比最大响应时间能更好的描述响应时间的分布状态，因为最大响应时间受某一次特殊状态的影响很大。n的取值可以按照所测试系统的不同选择3倍、5倍或者更多。请求超时数也是一个关键的指标，一般认为出现超时情况，即认为性能达到瓶颈，不能稳定服务。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>一般而言，用户态的数据都可以从程序的输出log中得到。一些压力工具的日志也可以作为参考。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>系统态数据</p> 
<p> </p> 
<p>系统态数据主要用来衡量系统负载和分析性能瓶颈，不直接用它来作为评估极限性能的标准，一般我们比较关心的常见系统态指标分为CPU相关，I/O相关，网络相关等。</p> 
<p> </p> 
<p>       CPU相关： us sys id wa等</p> 
<p> </p> 
<p>       I/O相关：  bi bo r/s w/s await等</p> 
<p> </p> 
<p>       网络相关： rxpackets txpackets rxbytes txbytes等。</p> 
<p> </p> 
<p>      </p> 
<p> </p> 
<p>系统态参数一般可以通过linux自带的工具可以获取。如cpu、io相关参数可以通过vmstat、iostat命令观察到，其中iostat的util%表示io请求队列非空的时间的比例，当达到100%时，系统的io就已经达到饱和。网络相关参数可以通过sar -n DEV 1 10命令获取，后面两个数字 1 表示统计的时间间隔，10表示统计次数。这几个命令基本上可以满足对系统态参数的观察，具体使用方法参考man手册（具体含义请参考 <a href="http://wiki.babel.baidu.com/twiki/bin/view/Ecmp/tiebadev/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#_13._vmstat_%E5%92%8C_iostat%20%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87%E6%9C%89%E4" rel="nofollow">条目</a><a href="http://wiki.babel.baidu.com/twiki/bin/view/Ecmp/tiebadev/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#_13._vmstat_%E5%92%8C_iostat%20%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87%E6%9C%89%E4" rel="nofollow">13</a>）。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="6.%C2%A0%E6%98%AF%E5%90%A6%E6%89%93%E5%BC%80cache%EF%BC%8C%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F">6. 是否打开cache，对性能测试有什么影响？</h4> 
<p> </p> 
<p>我们目前的系统中通常都有cache模块。在后端是IO型的服务，前端有cache的模式下，前端cache 打开与否，命中率都会对后端IO型服务得到的测试指标有影响。以 BS 的测试为例，AS 通常都会对BS 的结果有一定的cache，在测试中会发现，AS cache开启的情况的到BS的极限压力会低于开启AS Cache时得到的BS极限压力。造成这种差异的原因主要为：as端cache的引入，使落到bs的请求更为的随机，而对系统cache的利用更加低效，从而极限压力也受到影响。</p> 
<p> </p> 
<p>所以，如果仅仅是想针对bs进行基础性能回归，或者bs进行性能调优过程中的测试，可以暂时不考虑as cache带来的影响，而在进行bs 极限性能的测试，则必须考虑as cache的影响，因为极限性能的指标将直接作为线上服务部署的依据。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="7.%C2%A0%E7%B3%BB%E7%BB%9F%E7%BC%93%E5%AD%98%E5%AF%B9%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%8C%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E8%BF%99%E7%A7%8D%E5%BD%B1%E5%93%8D%EF%BC%9F">7. 系统缓存对性能测试有什么影响，如何减少这种影响？</h4> 
<p> </p> 
<p>   系统缓存指操作系统使用一部分未分配内存用来对IO操作进行缓存，从而优化IO。操作系统的这种行为对 数据量较小，访问存在一定的连续性 的IO型服务有非常大的影响，可能导致性能测试的数据不准确，通常是测试结果优于实际结果。为了减少这种影响，需要注意：</p> 
<p> </p> 
<p>       1. 词表的选取应该有一定的数量，现有的压力工具通常都会循环压力，压力词表太小，在循环之后，基本上都重磁盘cache，性能远远高于正常需要磁盘IO的访问。 而词表的顺序上，应该尽量模拟线上服务的访问特性，过于连续，则得到的性能测试结果相对真实情况偏好；过于随机，则得到的性能测试结果相对真实情况偏差。</p> 
<p> </p> 
<p>       2. 对数据量较小的服务，相同的数据压过多次后，也受磁盘cache的影响比较大，每次新起压力应对磁盘cache进行清理。 清理的方法有：重启系统， 拷贝大文件，使用系统组提供的工具。</p> 
<p> </p> 
<h4 id="8.%C2%A0%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%8E%8B%E5%8A%9B%E5%B7%A5%E5%85%B7%EF%BC%9F">8. 如何选择压力工具？</h4> 
<p> </p> 
<p>对于直接对web server起压力进行的测试，目前公司常用的压力工具有myab, myabc, http_load 等。myab在baidu的qa部门被广泛使用，但在测试过程中发现myab在压力较高的情况下（500次每秒以上），不能稳定地输出压力。http_load在baidu也有所应用，它能输出的压力最高有1000次每秒，且相对很稳定。而http_load是将要发送的http请求全部加载到内存后，随机选择请求进行发送，而myab是按照词表文件顺序依次发生请求。因此myab用来测cache命中率较准，而http_load的cache命中率相对会低一些，因为随机发送和线上的实际情况并不一样。</p> 
<p> </p> 
<p>另外，对于直接发向web server 的性能测试，需要注意配置请求头的接受压缩——是否进行压缩对前端机器的性能影响比较大。</p> 
<p> </p> 
<p>      </p> 
<p> </p> 
<p>对于直接对某个模块起压力，可以使用 CerBerus，该工具为模块级的压力工具，可以模拟模块之间的网络请求，支持并发，大压力和灵活的构造请求数据。而stl 提供的pfmtest 也可以对模块进行压力测试，它支持比较灵活的压力控制，但需要根据不同的模块实现接口函数。</p> 
<p> </p> 
<h4 id="9.%C2%A0%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E5%8E%8B%E5%8A%9B%E8%AF%8D%E8%A1%A8%EF%BC%9F">9. 如何准备压力词表？</h4> 
<p> </p> 
<p>压力词表一般而言，希望尽可能模拟线上用户请求的访问特性，所以通常从线上日志(Web Server) 获得。针对的具体的不同的测试，也可以构造一些压力词表。例如comdb的测试中，由于数据量大，访问离散，测试即采用随机数据ID进行。</p> 
<p> </p> 
<h4 id="10.%C2%A0%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E4%B8%AD%EF%BC%8C%E6%AF%8F%E7%BB%84%E5%8E%8B%E5%8A%9B%E6%89%A7%E8%A1%8C%E5%A4%9A%E9%95%BF%E6%97%B6%E9%97%B4%E5%90%88%E9%80%82%EF%BC%9F">10. 压力测试中，每组压力执行多长时间合适？</h4> 
<p> </p> 
<p>       每组压力执行时间并没有严格的规定，通常是只要足以得到 <strong>稳定 </strong>的性能表现记录即可。也不宜进行的太久，否则整个测试时间较长，影响效率。</p> 
<p> </p> 
<p>       以BS的测试为例，一般习惯，进行30分钟左右的压力测试，看系统是否稳定，然后统计稳定后15分钟的数据。</p> 
<p> </p> 
<h4 id="11.%C2%A0%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%8E%8B%E5%8A%9B%EF%BC%9F">11. 如何配置压力？</h4> 
<p> </p> 
<p>       压力的配置可以参考该模块历史的测试情况，新模块可以根据设计的性能指标，或者其他类似模块的性能情况。 对于升压测试而言，一开始压力可以不用太大，逐步递增，最后获得模块或者系统能能够承受的最大压力。</p> 
<p> </p> 
<h4 id="12.%C2%A0%E4%BB%80%E4%B9%88%E6%98%AF%E6%9E%81%E9%99%90%EF%BC%8C%E6%80%8E%E4%B9%88%E7%9F%A5%E9%81%93%E5%B7%B2%E7%BB%8F%E5%88%B0%E4%BA%86%E6%9E%81%E9%99%90%EF%BC%9F">12. 什么是极限，怎么知道已经到了极限？</h4> 
<p> </p> 
<p>STL对极限压力有一个抽象的标准：正常线上服务不受影响。意义为，超过这个压力，服务就开始出现一些异常，比如出现一定数量的 超时，拒绝连接等。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="13.%20vmstat%C2%A0%E5%92%8C%C2%A0iostat%C2%A0%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87%E6%9C%89%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89%EF%BC%8C%E6%80%8E%E4%B9%88%E7%94%A8%E4%BA%8E%E5%88%86%E6%9E%90%EF%BC%9F">13. vmstat 和 iostat 各项指标有什么含义，怎么用于分析？</h4> 
<p> </p> 
<p>vmstat 主要关注r b bi bo id wa几个指标。</p> 
<p> </p> 
<p><strong>r</strong>  ready的进程数，也就是还没有得到cpu的进程数，一旦得到cpu，那么该进程马上可以执行，如果该值过大（是否过大的标准是以你的程序会起几个进程为准，没有一个固定的值），那说明你的程序起的进程太多，建议一下降低进程个数，过多的进程切换是造成性能下降的原因之一。</p> 
<p> </p> 
<p><strong>b</strong> block的进程数，对于IO操作而言，主要是等待IO完成而被block的进程数，该值同样没有一个固定的标准值，相对于你的程序，这个值也不要太大。</p> 
<p> </p> 
<p><strong>bi</strong> 读的速度，单位是KB/s，顺序读情况下hp在160MB/s左右，dell在200MB/s左右。随机读两者相差不大。</p> 
<p> </p> 
<p><strong>bo</strong> 写的速度，单位是KB/s，顺序写时，hp的机器在不同的raid卡cache读写比率下正常值是不同的（bi值不受raid卡cache读写比率的影响），read/write在25/75时最好，写的速度可以到150~160MB/s；0/100时与25/75差别不大，也能到150~160左右；50/50速度在 100~120MB/s； 75/25 在100MB/s一下；100/0则在30~50MB/s之间。dell的机器一般都在180MB/s以上，最高可以到200MB/s以上。</p> 
<p> </p> 
<p><strong>id</strong> 是当前cpu处于idle的时间比例，这个也没有一个固定的标准值，该值过高说明当前cpu没有利用完全，还有继续压榨的能力</p> 
<p> </p> 
<p><strong>wa</strong> 当前cpu处于等待IO的时间比例，该值同样没有固定的标准值，如果这个值太高，比方说超过60%，那就要看看当前系统中是不是存在IO拥塞现象。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>iostat主要关注r/s w/s rkB/s wkB/s avgrq-sz avgqu-sz await %util指标。</p> 
<p> </p> 
<p><strong>r/s</strong> 每秒读请求次数，这个值通常会跟avgrq-sz一起观察，avgrq-sz大则有可能r/s比较小</p> 
<p> </p> 
<p><strong>w/s</strong> 每秒写请求次数，这个值通常会跟avgrq-sz一起观察，avgrq-sz大则有可能w/s比较小</p> 
<p> </p> 
<p><strong>rkB/s</strong> 这个指标跟vmstat的bi值通常应该是很接近的</p> 
<p> </p> 
<p><strong>wkB/s</strong> 这个指标跟vmstat的bo值通常应该是很接近的</p> 
<p> </p> 
<p><strong>avgrq-sz</strong> 每个请求平均大小，单位是扇区数，一般在200~400之间算是正常和理想的状态，如果这个值比较小，比方说只在100左右，说明太多的IO请求没有被合并，或者大的IO请求被“打散”，在写操作时，过多小的请求会造成磁盘磁头的频繁移动，降低IO性能。</p> 
<p> </p> 
<p><strong>avgqu-sz</strong> 平均请求队列长度，这个值在正常的系统中不应超过113太多，如果在200左右，甚至上千那说明发生了IO拥塞，而系统还在向IO请求队列中放请求（有一个例外是在执行sync,fsync操作时，该值到达最大值8192是正常的）</p> 
<p> </p> 
<p><strong>await</strong> 单位是毫秒，不应超过两位数，几百甚至上千都是不可接受的。</p> 
<p> </p> 
<p><strong>%util</strong> 尽可能的让该值达到100%，否则说明IO能力没有完全被利用。</p> 
<p> </p> 
<h4 id="14.%C2%A0%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%A7%E5%92%8C%E5%90%88%E7%90%86%E6%80%A7%EF%BC%9F">14. 如何评估测试结果的正确性和合理性？</h4> 
<p> </p> 
<p>       在测试前，应该对测试结果有一个初步的估计，比如，性能（IO/CPU）应该是提升，还是降低，大概幅度会有多少。这样当测试结果与预估偏差极远时，很可能测试的过程或者方法是有问题的。</p> 
<p> </p> 
<p>       如果是已有模块，可以参考改模块历史的测试数据。看变化是否合理。</p> 
<p> </p> 
<p>       如果是新模块，可以参考类似模块的性能测试数据。</p> 
<p> </p> 
<p>       对数据本身，可以做一些逻辑上的相互验证，比如：一般而言，idle应该随压力增加而降低，压力升高，idle反而变高，有可能是大部分的请求都命中了系统cache，此时测试数据已经不准确。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="15.%C2%A0%E7%BD%91%E5%8D%A1%E5%B8%A6%E5%AE%BD%E5%AF%B9%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%BD%B1%E5%93%8D%EF%BC%9F">15. 网卡带宽对压力测试有什么影响？</h4> 
<p> </p> 
<p>对于压力较大，或者数据流量较大的服务，比如空间图片服务，可能会出现由于网卡跑满，而压力上不去的现象，此时机器负载较为正常，但压力上不去。这对于测试环境，这是一个比较容易的现象。 比如 zjm机房的出口是百兆的，很容易压满。此时需要根据情况，将压力分布开。</p> 
<p> </p> 
<p>当然也有一些模块，网卡本身就是瓶颈。了解网卡带宽对压力的影响，也有助于在分析时得出正确的判断。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="16.%20timewait%C2%A0%E5%AF%B9%E6%9C%8D%E5%8A%A1%E6%9E%81%E9%99%90%E5%8E%8B%E5%8A%9B%E6%9C%89%E4%BD%95%E5%BD%B1%E5%93%8D%EF%BC%9F">16. timewait 对服务极限压力有何影响？</h4> 
<p> </p> 
<p>对于常见的CS关系的网络交互服务，当client 主动close，会进入timewait 状态，但此时socket 仍然被占用，无法回收，这一请情况可能会影响 <strong>短</strong>链接的并发压力，因为大量的socket处于timewait 状态会使client 句柄耗尽。 一般情况，短连接压倒 400~500 就已经不稳定了。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>缓解这一问题的，一般而言，有下面四种：</p> 
<p> </p> 
<p>1. 逻辑实现上，尽量 server 端主动关闭。</p> 
<p> </p> 
<p>2. 设置 SO_LINGER close.</p> 
<p> </p> 
<p>    这是一种不太体面的做法， 因为它触发的不是一个正常的结束。并且抹杀了TIME_WAIT 状态存在的意义： 网络上可能还有数据在传送，若此socket的替身出现，会收不到该收的包。</p> 
<p> </p> 
<p>3. 打开端口复用和快速回收</p> 
<p> </p> 
<p>4. 修改系统timewait 时间</p> 
<p> </p> 
<p>       上面三个是应用层的方法，这是一个需要修改系统kernel的方法。</p> 
<p> </p> 
<h3 id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95Tips%20(%E6%9D%A5%E8%87%AA%E4%BA%8E%E5%A4%A7%E5%AE%B6%E7%9A%84%E7%BB%8F%E9%AA%8C%E6%94%B6%E9%9B%86)">性能测试Tips (来自于大家的经验收集)</h3> 
<p> </p> 
<h4 id="1%EF%BC%8E%E6%B5%8B%E8%AF%95%E5%89%8D%E9%9C%80%E8%A6%81%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E9%A2%84%E4%BC%B0"><a name="1%EF%BC%8E%E6%B5%8B%E8%AF%95%E5%89%8D%E9%9C%80%E8%A6%81%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%BB%93%EF%BF%BD"></a>1．测试前需要对测试结果进行预估</h4> 
<p> </p> 
<p>进行测试前，最好能对测试的结果有一个大概的预估。这样才测试结果出来后，可以有一个大概的对比参考，有助于对测试结果的验证，可以较早的发现一些由于测试方不合理导致的问题。 预估可以根据 机器的特性； 如果是已经存在的模块，可以参考该模块已有的测试结果；如果是新模块，可以参考相似特性的模块的性能测试结果。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="2.%C2%A0%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AE%B0%E5%BD%95%E5%BA%94%E8%AF%A5%E6%B8%85%E6%99%B0%E7%BB%9F%E4%B8%80%E3%80%82">2. 测试过程中对测试环境，以及测试数据的记录应该清晰统一。</h4> 
<p> </p> 
<p>重视测试数据的记录，注意记录测试环境、测试过程，可以采用统一的测试报</p> 
<p> </p> 
<p>告模板；不然最后会搞得很混乱，事后分析数据时不清楚当时的情况了</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="3.%C2%A0%E5%BD%93%E5%AF%B9%E8%A6%81%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A8%A1%E5%9D%97%E6%88%96%E8%80%85%E7%B3%BB%E7%BB%9F%E4%B8%8D%E7%86%9F%E6%82%89%E6%97%B6%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%8F%90%E5%89%8D%E5%81%9A%E4%B8%80%E4%BA%9B%E8%83%8C%E6%99%AF%E4%BA%86%E8%A7%A3%E3%80%82">3. 当对要测试的模块或者系统不熟悉时，应该提前做一些背景了解。</h4> 
<p> </p> 
<p>比如这个模块（或者某个系统， 比如MySQL）的性能特性，是IO型，还是CPU性，历史的测试情况，测试方法。测试中应该注意的一些问题，可以向有相关经验的工程师了解，能够很大程度上帮助测试的顺利进行。</p> 
<p> </p> 
<h3 id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"><a name="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"></a>性能测试实例</h3> 
<p> </p> 
<p>下面将以几个性能测试的实例，说明性能测试的基本过程。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>1. Image BS 性能升级测试</p> 
<p> </p> 
<p>       需求场景：</p> 
<p> </p> 
<p>       对Image BS模块进行性能优化升级，需要测试了解新BS的极限性能，并同时得出性能升级后的整个系统能够承担的流量。</p> 
<p> </p> 
<p>      </p> 
<p> </p> 
<p>首先，准备测试环境。 由于要测试BS模块的极限性能，希望BS的测试环境能够尽可能的与线上环境类似，在这次测试中，主要考虑两个问题：</p> 
<p> </p> 
<p>       A. 机型&amp;配置&amp;软件部署</p> 
<p> </p> 
<p>         由于测试重点在于 bs的性能，所以测试环境的设计上，要求bs模块部署的环境与线上完全相同：</p> 
<p> </p> 
<p>l  硬件方面包括：</p> 
<p> </p> 
<p>机型(CPU)，内存，硬盘，Raid。</p> 
<p> </p> 
<p>l  软件方面包括：</p> 
<p> </p> 
<p>BS的部署方式， 在本例中，假设一台服务器部署两个BS，两个DI。 应用层cache等配置与线上保持一致。</p> 
<p> </p> 
<p>l  数据部署：</p> 
<p> </p> 
<p>由于BS属于IO型服务，受数据量的影响很大，因而测试环境的数据需要保证和线上数据量一致。本例两个BS，DI 加载线上一层数据。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>       B. 测试环境架构</p> 
<p> </p> 
<p>       由于Image BS在线上运行在一个集群之上，通常集群的均衡冗余策略，以及包含cache模块的存在，往往会影响数据的访问情况，从而影响线下测试的准确性。 由于线下的资源优先，通常我们不可能在线下搭建与线上一样的集群，这就要求我们在线下搭建测试环境时，充分考虑集群部署对测试带来的影响。</p> 
<p> </p> 
<p>       假设线上前端se机器（部署UI，AS）有8台，BS/DI 机器有 6层*5列。最终的测试环境选择 使用一台机器部署UI，AS； 一台机器部署BS/DI，做这样的环境设计包含了两个前提：</p> 
<p> </p> 
<p>       1. AS 向BS 发请求的方式是 一个query每层都需要发检索请求，也即BS的多层本身对BS的访问特性并无影响。</p> 
<p> </p> 
<p>       2. 单BS/DI 机器对DI的访问特性带来了较大的影响。包括两方面：</p> 
<p> </p> 
<p>              I．在多层的环境下，DI请求将根据数据分布落到各层的DI上，单层的环境下，只会落到一个这一层的DI上。</p> 
<p> </p> 
<p>              II．AS对DI的均衡策略为，根据di_id 在层内做hash均衡，然后每DI都可能有一些di的请求。在这种策略下，如果列数减少，意味着DI每次请求需要读取的DI数据变多。</p> 
<p> </p> 
<p>              综合上面两中情况，总得来说，每个DI每次需要读取的DI个数变多。 再经过测试后，确认这一情况将会使线下的测试数据表现低于线上真实的表现（也即和我们保守估计的原则一致），并且影响程度在可接受的范围内。认为可以接受。</p> 
<p> </p> 
<p>       当然，在资源允许的情况下，最好还是能够按照一层多列的架构进行测试。</p> 
<p> </p> 
<p>      </p> 
<p> </p> 
<p>       测试环境准备好，可以进行压力测试，在这个环节，主要考虑下面几个问题：</p> 
<p> </p> 
<p>       A．测试词表准备</p> 
<p> </p> 
<p>              测试词表通常反映了用户的访问特性，所以在极限测试的中，为了尽可能模拟线上的真实情况，尽量使用线上的日志做测试词表。根据压力直接作用的模块不同，可以选取不同的模块的日志。 这里的测试词表从UI日志中取出，但直接作用到Web Server，因为UI与AS为长连接，一对一的关系，所以UI的日志可以认为和AS的日志反映的用户访问特性是一致的。</p> 
<p> </p> 
<p>       B．压力方法</p> 
<p> </p> 
<p>              做极限性能测试，通常采用升压测试的方法。 压力的设定要考虑测试的目标模块，以及相关模块已知的极限压力。在本次测试中，压力的计算大概按照以下方式：</p> 
<p> </p> 
<p>              假设 线上单个 bs 平均压力为 20，那么可以以20为基准， 按照as cache穿透率80%，以及一台机器部署两个bs，反推as 端的压力应该为 200。那么以200为基准，按照一定的步长，比如50，增压，做升压测试，直到得到系统的极限。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>       C．摒除cache干扰</p> 
<p> </p> 
<p>              在本测试中，cache的影响包含两方面：</p> 
<p> </p> 
<p>              1. AS端应用层cache的影响。</p> 
<p> </p> 
<p>                     实际线上as cache的命中率平均85%，而as cache的存在会影响到落到bs的请求的访问特性，从而影响bs端的极限压力与真实可支持的极限压力的差异，举例而言，打开cache的情况下，bs能够支持的极限压力也许是打开as cache下测试结果的两倍，因为as cache的存在使bs的访问更加的随机。</p> 
<p> </p> 
<p>                     为了避免as cache的影响，在压力词表的选择上，更加需要注意与线上日志的一致程度，以保证as cache的命中率在一个比较正常的值。这是一个需要根据情况调整的过程，也许根据实际测试数据量的差异，还需要对as cache的配置作一定的更改。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>              2. BS端系统cache的影响。</p> 
<p> </p> 
<p>                     由于进行升压测试，每一小段压力进行完后，需要清除系统cache，或者新的词表，以消除系统cache对测试的影响。 系统cache会使测试值远远优于真实值，很可能出现，压力越高，反而系统反应出来的负载比低压力还低的情况。</p> 
<p> </p> 
<p>                     清除系统cache的方法有：拷贝大文件，使用系统组提供的工具，重启机器。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>       D．注意数据记录</p> 
<p> </p> 
<p>              升压测试的过程中需要做多轮压力，中间需要记录用户态数据，以及系统态数据。在本测试中，用户态数据主要从各各模块的日志中体现，而系统态数据则有专门的工具获得，详见数据获取工具介绍。 需要特别注意的时，由于升压测试需要做多轮测试，多轮测试中产生的日志等记录数据需要妥善保存，并相互区分，以免测试记录相互覆盖，混杂，增加后面做数据分析的困难。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>       在测试过程完成后，即对测试数据进行分析。关于极限性能的得到，主要是关注用户态数据，具体而言，在本测试中，即as 对bs读超时的情况，as两次读失败的情况，以及整个检索反应出来的响应时间。得到BS的极限性能之后，由于我们在测试架构的设计上就考虑了对线上系统的模拟，因而，得到线上整个系统能够承受的极限压力也就相对较为容易获得，比如在本测试中，对线上极限压力的反推公式为： (bs极限压力/0.2)*2*线上列数。</p> 
<p> </p> 
<h2 id="%E9%99%84"><a name="%E9%99%84"></a>附</h2> 
<p> </p> 
<h3 id="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B"><a name="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B"></a>性能测试常用工具简介</h3> 
<p> </p> 
<h4 id="%E8%B5%B7%E5%8E%8B%E5%B7%A5%E5%85%B7"><a name="%E8%B5%B7%E5%8E%8B%E5%B7%A5%E5%85%B7"></a>起压工具</h4> 
<p> </p> 
<p>1.       myab系列</p> 
<p> </p> 
<p>web server端的负载工具，多线程，根据词表将压力压到apache 等web server。 其中myabc是 myab的增强版，可以通过xml词表定义http请求头中的各个字段。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>2.       CerBerus</p> 
<p> </p> 
<p><a href="http://com.baidu.com/twiki/bin/view/Main/CerBerus" rel="nofollow">Cerberus</a> 是一款可模拟任意socket接口的模块级测试工具，可用于模块的性能压力测试，也可用于构造边界输入、进行单元测试。</p> 
<p> </p> 
<p>cerberus 根据xml描述的配置文件构造请求数据包的二进制格式，根据xml描述的数据文件构造请求数据包的具体内容。</p> 
<p> </p> 
<p><strong>目标用户</strong> ：做单元测试的RD，做模块级测试、接口测试的QA</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>详情请见：</p> 
<p> </p> 
<p><a href="http://com.baidu.com/twiki/bin/view/Main/CerBerus" rel="nofollow">http://com.baidu.com/twiki/bin/view/Main/CerBerus</a></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>3.       pmftest</p> 
<p> </p> 
<p>pmftest 为 STL开发的压力测试框架。socket接口，在框架上实现与待测试模块的交互接口后，即可对待测模块进行压力测试。 压力控制方面，支持：</p> 
<p> </p> 
<p>l  控制在指定压力</p> 
<p> </p> 
<p>l  维持在指定超时时间</p> 
<p> </p> 
<p>l  维持在指定平均响应时间</p> 
<p> </p> 
<p>等多种压力控制模式， 配合stable.sh 脚本，可以一次性测试各种不同压力情况下模块的性能，并统计此期间I/O CPU 等指标。 比较适合做极限压力测试。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>详见pfmtest 说明文档 &lt;pfmtest_info.doc&gt;</p> 
<p> </p> 
<h4 id="%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B7%A5%E5%85%B7"><a name="%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B7%A5%E5%85%B7"></a>数据采集工具</h4> 
<p> </p> 
<p>用户态数据可以通过压力工具日志（例如pfmtest）日志 或者 模块日志进行。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>系统态数据可以通过下面的一些工具：</p> 
<p> </p> 
<p>1. sysinfo.pl</p> 
<p> </p> 
<p>       综合记录 vmstat， iostat， mpstat， sar 等数据</p> 
<p> </p> 
<p>2. vmstatstat.sh</p> 
<p> </p> 
<p>记录 vmstat 信息</p> 
<p> </p> 
<p>3. iostatstat.sh</p> 
<p> </p> 
<p>记录 iostat 信息</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<h4 id="%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"><a name="%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"></a>其他工具</h4> 
<p> </p> 
<p>1. clearcache</p> 
<p> </p> 
<p>清空系统缓存的工具，在做受系统缓存干扰大的IO性能测试时，很有用。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a7590add5bfd94b41267885e52226de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">android 6.0权限，onRequestPermissionsResult回调不执行问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d8ff5220fd90a9a846b640cdf17e2542/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">推荐系统遇上深度学习系列</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>