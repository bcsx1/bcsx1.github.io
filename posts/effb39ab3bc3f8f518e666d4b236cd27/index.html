<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€Linuxç½‘ç»œï¼ˆC&#43;&#43;)ã€‘â€”â€”ç½‘ç»œå¥—æ¥å­—ï¼ˆTCP/UDPç¼–ç¨‹æ¨¡å‹ï¼‰å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœåŠ¡å™¨å¼€å‘ï¼ˆç”»å›¾è§£æï¼‰ - ç¼–ç¨‹éšæƒ³</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ã€Linuxç½‘ç»œï¼ˆC&#43;&#43;)ã€‘â€”â€”ç½‘ç»œå¥—æ¥å­—ï¼ˆTCP/UDPç¼–ç¨‹æ¨¡å‹ï¼‰å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœåŠ¡å™¨å¼€å‘ï¼ˆç”»å›¾è§£æï¼‰" />
<meta property="og:description" content="ç›®å½•
ä¸€. å¥—æ¥å­—åŸºæœ¬æ¦‚å¿µ
ğŸ“šÂ IPåœ°å€
ğŸ“šÂ TCPå’ŒUDPåè®®Â ğŸ“šÂ ç«¯å£å·
ğŸ“šÂ ç«¯å£å·vs è¿›ç¨‹pid
ğŸ“šÂ ç½‘ç»œå­—èŠ‚åº
æœ¬åœ°å­—èŠ‚åºè½¬æ¢æˆç½‘ç»œå­—èŠ‚åº
ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºæœ¬åœ°å­—èŠ‚åº
äºŒ. å¥—æ¥å­—çš„åŸºæœ¬æ“ä½œ
ğŸ“šÂ socketçš„åˆ›å»º
åŸŸ(domain)
ç±»å‹ï¼ˆtypeï¼‰
åè®®ï¼ˆProtcolï¼‰
è¿”å›å€¼
ğŸ“šÂ struct socketaddråœ°å€ç»“æ„
struct sockaddrÂ ç»“æ„
struct sockaddr_in ç»“æ„
ğŸ“šÂ socketç»‘å®šåœ°å€ï¼ˆbindå‡½æ•°ï¼‰
ğŸ“šÂ Socketç›‘å¬è¿æ¥ï¼ˆlistenå‡½æ•°ï¼‰
ğŸ“šÂ Socketè¯·æ±‚è¿æ¥(connectå‡½æ•°ï¼‰
ğŸ“šÂ Socketæ¥å—è¿æ¥ï¼ˆacceptå‡½æ•°ï¼‰
ğŸ“šÂ Socketæ¥å—æ•°æ® ï¼ˆrecvfromå‡½æ•°ï¼‰
ğŸ“šÂ Socketå‘é€æ•°æ®ï¼ˆsendtoå‡½æ•°ï¼‰
ğŸ“šÂ Socketå…³é—­
ä¸‰. UDPç¼–ç¨‹æ¨¡å‹
å››. Tcpç¼–ç¨‹æ¨¡å‹
å¤šè¿›ç¨‹æœåŠ¡å™¨
å¤šçº¿ç¨‹æœåŠ¡å™¨
çº¿ç¨‹æ± æœåŠ¡å™¨
äº”. netstateå‘½ä»¤
ä¸€. å¥—æ¥å­—åŸºæœ¬æ¦‚å¿µ æ‰€è°“å¥—æ¥å­—(Socket)ï¼Œå°±æ˜¯å¯¹ç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹çš„æŠ½è±¡ï¼Œä¸€ä¸ªå¥—æ¥å­—å°±æ˜¯ç½‘ç»œä¸Šè¿›ç¨‹é€šä¿¡çš„ä¸€ç«¯ï¼Œæä¾›äº†åº”ç”¨å±‚è¿›ç¨‹åˆ©ç”¨ç½‘ç»œåè®®äº¤æ¢æ•°æ®çš„æœºåˆ¶
ğŸ“šÂ IPåœ°å€ IPåœ°å€æ˜¯åœ¨IPåè®®ä¸­ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç”¨æ¥æ ‡è¯†ç½‘ç»œä¸Šä¸åŒä¸»æœºçš„åœ°å€ã€‚
IPåœ°å€æ˜¯ç”±32ä½ç»„æˆï¼Œä¸»è¦ç”±ä¸‰éƒ¨åˆ†ï¼šåœ°å€ç±»åˆ«ï¼Œç½‘ç»œå·å’Œä¸»æœºå·ï¼š
ğŸ“šÂ TCPå’ŒUDPåè®®Â TCP/IPåè®®ä¼ è¾“å±‚ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸¤ä¸ªåè®®åˆ†åˆ«æ˜¯TCPåè®®å’ŒUDPåè®®ï¼ŒUDPå¥—æ¥å£æ˜¯æ•°æ®æŠ¥å¥—æ¥å­—çš„ä¸€ç§ï¼Œè€ŒTCPå¥—æ¥å£æ˜¯å­—èŠ‚æµå¥—æ¥å­—çš„ä¸€ç§ã€‚
TCP/IPåè®®ä¼ è¾“å±‚çš„ ä¸»è¦ä»»åŠ¡æ˜¯å‘ä½äºä¸åŒçš„ï¼ˆæœ‰æ—¶å€™ä½äºåŒä¸€ä¸»æœºï¼‰ä¸Šçš„åº”ç”¨ç¨‹åºæä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼Œä¸ºäº†åŒºåˆ†åº”ç”¨ç¨‹åºï¼ŒTCPå’ŒUDPå¼•å…¥äº†ç«¯å£å·çš„æ¦‚å¿µï¼Œç«¯å£æœ¬è´¨æ˜¯ä¸€ä¸ª16ä½çš„æ•´æ•°" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/effb39ab3bc3f8f518e666d4b236cd27/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-22T11:24:29+08:00" />
<meta property="article:modified_time" content="2022-02-22T11:24:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹éšæƒ³" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹éšæƒ³</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€Linuxç½‘ç»œï¼ˆC&#43;&#43;)ã€‘â€”â€”ç½‘ç»œå¥—æ¥å­—ï¼ˆTCP/UDPç¼–ç¨‹æ¨¡å‹ï¼‰å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœåŠ¡å™¨å¼€å‘ï¼ˆç”»å›¾è§£æï¼‰</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-toc" style="margin-left:0px;"><a href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" rel="nofollow">ä¸€. å¥—æ¥å­—åŸºæœ¬æ¦‚å¿µ</a></p> 
<p id="%C2%A0IP%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#%C2%A0IP%E5%9C%B0%E5%9D%80" rel="nofollow">ğŸ“šÂ Â IPåœ°å€</a></p> 
<p id="TCP%E5%92%8CUDP%E5%8D%8F%E8%AE%AE%C2%A0-toc" style="margin-left:40px;"><a href="#TCP%E5%92%8CUDP%E5%8D%8F%E8%AE%AE%C2%A0" rel="nofollow">ğŸ“šÂ TCPå’ŒUDPåè®®Â </a></p> 
<p id="%E7%AB%AF%E5%8F%A3%E5%8F%B7-toc" style="margin-left:40px;"><a href="#%E7%AB%AF%E5%8F%A3%E5%8F%B7" rel="nofollow">ğŸ“šÂ ç«¯å£å·</a></p> 
<p id="%E7%AB%AF%E5%8F%A3%E5%8F%B7vs%20%E8%BF%9B%E7%A8%8Bpid-toc" style="margin-left:40px;"><a href="#%E7%AB%AF%E5%8F%A3%E5%8F%B7vs%20%E8%BF%9B%E7%A8%8Bpid" rel="nofollow">Â ğŸ“šÂ ç«¯å£å·vs è¿›ç¨‹pid</a></p> 
<p id="%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F-toc" style="margin-left:40px;"><a href="#%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F" rel="nofollow">ğŸ“šÂ ç½‘ç»œå­—èŠ‚åº</a></p> 
<p id="%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E6%88%90%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F-toc" style="margin-left:80px;"><a href="#%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E6%88%90%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F" rel="nofollow">æœ¬åœ°å­—èŠ‚åºè½¬æ¢æˆç½‘ç»œå­—èŠ‚åº</a></p> 
<p id="%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F-toc" style="margin-left:80px;"><a href="#%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F" rel="nofollow">ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºæœ¬åœ°å­—èŠ‚åº</a></p> 
<p id="%E4%BA%8C.%20%E5%A5%97%E6%8E%A5%E5%AD%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.%20%E5%A5%97%E6%8E%A5%E5%AD%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C" rel="nofollow">äºŒ. å¥—æ¥å­—çš„åŸºæœ¬æ“ä½œ</a></p> 
<p id="socket%E7%9A%84%E5%88%9B%E5%BB%BA-toc" style="margin-left:40px;"><a href="#socket%E7%9A%84%E5%88%9B%E5%BB%BA" rel="nofollow">ğŸ“šÂ socketçš„åˆ›å»º</a></p> 
<p id="%E5%9F%9F(domain)-toc" style="margin-left:80px;"><a href="#%E5%9F%9F%28domain%29" rel="nofollow">åŸŸ(domain)</a></p> 
<p id="%E7%B1%BB%E5%9E%8B%EF%BC%88type%EF%BC%89-toc" style="margin-left:80px;"><a href="#%E7%B1%BB%E5%9E%8B%EF%BC%88type%EF%BC%89" rel="nofollow">ç±»å‹ï¼ˆtypeï¼‰</a></p> 
<p id="%C2%A0%E5%8D%8F%E8%AE%AE%EF%BC%88Protcol%EF%BC%89-toc" style="margin-left:80px;"><a href="#%C2%A0%E5%8D%8F%E8%AE%AE%EF%BC%88Protcol%EF%BC%89" rel="nofollow">Â åè®®ï¼ˆProtcolï¼‰</a></p> 
<p id="%E8%BF%94%E5%9B%9E%E5%80%BC-toc" style="margin-left:80px;"><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC" rel="nofollow">è¿”å›å€¼</a></p> 
<p id="struct%20socketaddr%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#struct%20socketaddr%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84" rel="nofollow">ğŸ“šÂ struct socketaddråœ°å€ç»“æ„</a></p> 
<p id="struct%20sockaddr%C2%A0%20%E7%BB%93%E6%9E%84-toc" style="margin-left:80px;"><a href="#struct%20sockaddr%C2%A0%20%E7%BB%93%E6%9E%84" rel="nofollow">struct sockaddrÂ  ç»“æ„</a></p> 
<p id="%C2%A0struct%20sockaddr_in%20%E7%BB%93%E6%9E%84-toc" style="margin-left:80px;"><a href="#%C2%A0struct%20sockaddr_in%20%E7%BB%93%E6%9E%84" rel="nofollow">Â struct sockaddr_in ç»“æ„</a></p> 
<p id="socket%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80%EF%BC%88bind%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#socket%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80%EF%BC%88bind%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">ğŸ“šÂ socketç»‘å®šåœ°å€ï¼ˆbindå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E7%9B%91%E5%90%AC%E8%BF%9E%E6%8E%A5%EF%BC%88listen%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#Socket%E7%9B%91%E5%90%AC%E8%BF%9E%E6%8E%A5%EF%BC%88listen%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">ğŸ“šÂ Socketç›‘å¬è¿æ¥ï¼ˆlistenå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E8%AF%B7%E6%B1%82%E8%BF%9E%E6%8E%A5(connect%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#Socket%E8%AF%B7%E6%B1%82%E8%BF%9E%E6%8E%A5%28connect%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">Â ğŸ“šÂ Socketè¯·æ±‚è¿æ¥(connectå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E6%8E%A5%E5%8F%97%E8%BF%9E%E6%8E%A5%EF%BC%88accept%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#Socket%E6%8E%A5%E5%8F%97%E8%BF%9E%E6%8E%A5%EF%BC%88accept%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">ğŸ“šÂ Socketæ¥å—è¿æ¥ï¼ˆacceptå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E6%8E%A5%E5%8F%97%E6%95%B0%E6%8D%AE%20%EF%BC%88recvfrom%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#Socket%E6%8E%A5%E5%8F%97%E6%95%B0%E6%8D%AE%20%EF%BC%88recvfrom%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">ğŸ“šÂ Socketæ¥å—æ•°æ® ï¼ˆrecvfromå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%EF%BC%88sendto%E5%87%BD%E6%95%B0%EF%BC%89-toc" style="margin-left:40px;"><a href="#Socket%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%EF%BC%88sendto%E5%87%BD%E6%95%B0%EF%BC%89" rel="nofollow">ğŸ“šÂ Socketå‘é€æ•°æ®ï¼ˆsendtoå‡½æ•°ï¼‰</a></p> 
<p id="Socket%E5%85%B3%E9%97%AD-toc" style="margin-left:40px;"><a href="#Socket%E5%85%B3%E9%97%AD" rel="nofollow">ğŸ“šÂ Socketå…³é—­</a></p> 
<p id="UDP%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B-toc" style="margin-left:0px;"><a href="#UDP%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B" rel="nofollow">ä¸‰. UDPç¼–ç¨‹æ¨¡å‹</a></p> 
<p id="Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:0px;"><a href="#Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">å››. Tcpç¼–ç¨‹æ¨¡å‹</a></p> 
<p id="%C2%A0%E5%A4%9A%E8%BF%9B%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%C2%A0%E5%A4%9A%E8%BF%9B%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">Â å¤šè¿›ç¨‹æœåŠ¡å™¨</a></p> 
<p id="%C2%A0%E5%A4%9A%E7%BA%BF%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%C2%A0%E5%A4%9A%E7%BA%BF%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">Â å¤šçº¿ç¨‹æœåŠ¡å™¨</a></p> 
<p id="%E7%BA%BF%E7%A8%8B%E6%B1%A0Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">çº¿ç¨‹æ± æœåŠ¡å™¨</a></p> 
<p id="netstate%E5%91%BD%E4%BB%A4-toc" style="margin-left:0px;"><a href="#netstate%E5%91%BD%E4%BB%A4" rel="nofollow">äº”. netstateå‘½ä»¤</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<p></p> 
<h2 id="%E5%A5%97%E6%8E%A5%E5%AD%97%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">ä¸€. å¥—æ¥å­—åŸºæœ¬æ¦‚å¿µ</h2> 
<p></p> 
<blockquote> 
 <p>æ‰€è°“å¥—æ¥å­—(Socket)ï¼Œå°±æ˜¯å¯¹ç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹çš„æŠ½è±¡ï¼Œä¸€ä¸ªå¥—æ¥å­—å°±æ˜¯ç½‘ç»œä¸Š<a href="https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=60847&amp;ss_c=ssc.citiao.link" rel="nofollow" title="è¿›ç¨‹é€šä¿¡">è¿›ç¨‹é€šä¿¡</a>çš„ä¸€ç«¯ï¼Œæä¾›äº†<a href="https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=16954&amp;ss_c=ssc.citiao.link" rel="nofollow" title="åº”ç”¨å±‚">åº”ç”¨å±‚</a>è¿›ç¨‹åˆ©ç”¨ç½‘ç»œåè®®äº¤æ¢æ•°æ®çš„æœºåˆ¶</p> 
</blockquote> 
<h3 id="%C2%A0IP%E5%9C%B0%E5%9D%80"><strong>ğŸ“šÂ </strong>Â IPåœ°å€</h3> 
<p>IPåœ°å€æ˜¯åœ¨IPåè®®ä¸­ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç”¨æ¥æ ‡è¯†ç½‘ç»œä¸Šä¸åŒä¸»æœºçš„åœ°å€ã€‚</p> 
<p>IPåœ°å€æ˜¯ç”±32ä½ç»„æˆï¼Œä¸»è¦ç”±ä¸‰éƒ¨åˆ†ï¼šåœ°å€ç±»åˆ«ï¼Œç½‘ç»œå·å’Œä¸»æœºå·ï¼š</p> 
<p><img alt="" height="130" src="https://images2.imgbox.com/48/e5/vVD47uEW_o.png" width="732"></p> 
<h3 id="TCP%E5%92%8CUDP%E5%8D%8F%E8%AE%AE%C2%A0"><strong>ğŸ“šÂ </strong>TCPå’ŒUDPåè®®Â </h3> 
<p>TCP/IPåè®®ä¼ è¾“å±‚ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸¤ä¸ªåè®®åˆ†åˆ«æ˜¯TCPåè®®å’ŒUDPåè®®ï¼ŒUDPå¥—æ¥å£æ˜¯æ•°æ®æŠ¥å¥—æ¥å­—çš„ä¸€ç§ï¼Œè€ŒTCPå¥—æ¥å£æ˜¯å­—èŠ‚æµå¥—æ¥å­—çš„ä¸€ç§ã€‚</p> 
<p>TCP/IPåè®®ä¼ è¾“å±‚çš„ ä¸»è¦ä»»åŠ¡æ˜¯å‘ä½äºä¸åŒçš„ï¼ˆæœ‰æ—¶å€™ä½äºåŒä¸€ä¸»æœºï¼‰ä¸Šçš„åº”ç”¨ç¨‹åºæä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼Œä¸ºäº†åŒºåˆ†åº”ç”¨ç¨‹åºï¼ŒTCPå’ŒUDPå¼•å…¥äº†ç«¯å£å·çš„æ¦‚å¿µï¼Œç«¯å£æœ¬è´¨æ˜¯ä¸€ä¸ª16ä½çš„æ•´æ•°</p> 
<h3 id="%E7%AB%AF%E5%8F%A3%E5%8F%B7"><strong>ğŸ“šÂ </strong>ç«¯å£å·</h3> 
<p>ç«¯å£å·ï¼ˆportï¼‰æ˜¯ä¼ è¾“å±‚åè®®çš„å†…å®¹</p> 
<ul><li>æ˜¯ä¸€ä¸ª<strong>2å­—èŠ‚çš„16ä½æ•´æ•°</strong>ã€‚</li><li>ç«¯å£å·æ˜¯ç”¨æ¥è¡¨ç¤ºè¿›ç¨‹çš„ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼Œå½“å‰çš„æ•°æ®è¦äº¤ç»™å“ªä¸€ä¸ªè¿›ç¨‹å¤„ç†</li><li><strong>ipåœ°å€+ç«¯å£å·èƒ½å¤Ÿæ ‡è¯†ç½‘ç»œä¸Šä¸€å°ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ã€‚</strong></li><li>ä¸€ä¸ªç«¯å£å·åªèƒ½æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹</li></ul> 
<p>ä»»ä½•çš„ç½‘ç»œæœåŠ¡ä¸ç½‘ç»œå®¢æˆ·ç«¯ï¼Œå¦‚æœè¦è¿›è¡Œæ­£å¸¸çš„æ•°æ®é€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨ç«¯å£å·ï¼Œæ¥å”¯ä¸€æ ‡è¯†è¿›ç¨‹ã€‚</p> 
<p>å…¬ç½‘ipï¼šå”¯ä¸€çš„æ ‡è¯†å…¨ç½‘å”¯ä¸€çš„ä¸€å°ä¸»æœº</p> 
<p>socketé€šä¿¡ï¼Œæœ¬è´¨æ˜¯è¿›ç¨‹é—´é€šä¿¡ï¼Œè·¨ç½‘ç»œçš„è¿›ç¨‹è¿›é€šä¿¡ã€‚</p> 
<h3 id="%E7%AB%AF%E5%8F%A3%E5%8F%B7vs%20%E8%BF%9B%E7%A8%8Bpid">Â <strong>ğŸ“šÂ </strong>ç«¯å£å·vs è¿›ç¨‹pid</h3> 
<p>åœ¨linuxæ“ä½œç³»ç»Ÿå†…ï¼Œè¿›ç¨‹pidä¹Ÿæ˜¯å”¯ä¸€æ ‡è¯†è¿›ç¨‹ï¼Œç«¯å£å·è·Ÿè¿›ç¨‹pidä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š<br> åœ¨å›½å®¶çš„ç¤¾ä¼šä¸­ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªèº«ä»½è¯å·ç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªäººï¼Œåœ¨å¤§å­¦ä¸­ï¼Œæ¯ä¸ªå­¦ç”Ÿéƒ½æœ‰ä¸€ä¸ªå­¦ç”Ÿå·æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå­¦ç”Ÿï¼Œä¸ºä»€ä¹ˆå­¦æ ¡ä¸ç”¨èº«ä»½è¯å·æ¥å”¯ä¸€åŒºåˆ†ä¸€ä¸ªå­¦ç”Ÿå‘¢ï¼Ÿå› ä¸ºä½¿ç”¨èº«ä»½è¯å·çš„äººæ•°å¤šï¼Œæœ‰14äº¿å·¦å³ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½åœ¨è¿™ä¸ªå¤§å­¦ä¸­è¯»ä¹¦ï¼Œè€Œä¸€ä¸ªå¤§å­¦ä¸­åªæœ‰å‡ åƒä¸ªäººï¼Œé‚£ä¹ˆä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œå­¦æ ¡å†ä½¿ç”¨ä¸€ä¸ªå­¦å·æ¥å”¯ä¸€æ ‡è¯†å­¦æ ¡ä¸­å­¦ç”Ÿçš„èº«ä»½ã€‚</p> 
<p>è€Œè¿›ç¨‹pidå°±å¥½æ¯”è¿›ç¨‹çš„èº«ä»½è¯å·ï¼Œè€Œç«¯å£å·å°±å¥½æ¯”å­¦å·ï¼Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œå‡è®¾æœ‰50ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼Œä½†æ˜¯åªæœ‰5ä¸ªè¿›ç¨‹è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªè¦ç»™è¿™5ä¸ªè¿›ç¨‹åˆ†é…ç«¯å£å·å³å¯ã€‚</p> 
<h3 id="%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F"><strong>ğŸ“šÂ </strong>ç½‘ç»œå­—èŠ‚åº</h3> 
<p>Â  Â ç”±äº<strong>ä¸åŒè®¡ç®—æœºç³»ç»Ÿé‡‡ç”¨ä¸åŒçš„å­—èŠ‚åºå­˜å‚¨æ•°æ®</strong>ï¼ŒåŒæ ·ä¸€ä¸ª4å­—èŠ‚çš„32ä½æ•´æ•°åœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œè¿™ç§°ä¸ºæœ¬åœ°å­—èŠ‚åºã€‚å­—èŠ‚åºåˆ—åˆ†ä¸ºå¤§ç«¯å­—èŠ‚åºå’Œå°ç«¯å­—èŠ‚åºï¼ŒIntelå¤„ç†å™¨å¤§å¤šä½¿ç”¨å¤§ç«¯å­—èŠ‚åºï¼ŒMotoroå¤§å¤šä½¿ç”¨å°ç«¯å­—èŠ‚åºã€‚å°ç«¯å­—èŠ‚åºæ˜¯æŒ‡ä½ä½å­—èŠ‚å­˜æ”¾å†…å­˜çš„ä½åœ°å€å¤„ï¼Œå¤§ç«¯å­—èŠ‚åºæŒ‡çš„æ˜¯é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ã€‚</p> 
<p>Â  Â  Â å¦‚æœè¿›ç¨‹åªåœ¨å•æœºç¯å¢ƒä¸‹è¿è¡Œï¼Œå¹¶ä¸”ä¸å’Œå…¶ä»–è¿›ç¨‹æ‰“äº¤é“ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å¿½ç•¥å­—èŠ‚åºçš„å­˜åœ¨ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¿›ç¨‹éœ€è¦è·Ÿå…¶ä»–è®¡ç®—æœºä¸Šçš„è¿›ç¨‹è¿›è¡Œäº¤æ¢ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å­—èŠ‚åºçš„é—®é¢˜ã€‚</p> 
<p>Â  Â  1çš„å­—èŠ‚åºåˆ†åˆ«åœ¨å¤§ç«¯æœºå™¨å’Œå°ç«¯æœºå™¨å­˜å‚¨æƒ…å†µï¼Œå¦‚æœå¤§ç«¯æœºå™¨å°†å†…å­˜ä¸­çš„æ•°æ®é€šè¿‡ç½‘ç»œä¼ ç»™å°ç«¯æœºå™¨ï¼Œé‚£ä¹ˆå°ç«¯æœºå™¨ä»ç½‘ç»œè·å¾—çš„æ•°æ®æ”¾è¿›å†…å­˜ä¸­çš„æ•°æ®æ˜¯ç›¸åçš„ã€‚è¿™å°±æ˜¯ç½‘ç»œå­—èŠ‚åºé—®é¢˜ã€‚</p> 
<p><img alt="" height="452" src="https://images2.imgbox.com/07/5d/So1yAnu2_o.png" width="874"></p> 
<p>Â  Â  Â  TCP/IPåè®®è¿›è¡Œç½‘ç»œæ•°æ®ä¼ è¾“æ—¶ï¼Œè§„å®šä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå®ƒä¸å…·ä½“çš„cpuå’Œæ“ä½œç³»ç»Ÿæ— å…³ï¼Œä¿è¯äº†æ•°æ®åœ¨ä¸åŒä¸»æœºä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šï¼Œè¿™å°±æ˜¯ç½‘ç»œå­—èŠ‚åºï¼Œ<strong>ç½‘ç»œå­—èŠ‚åºç»Ÿä¸€é‡‡ç”¨å¤§ç«¯å­—èŠ‚åºã€‚Â </strong></p> 
<p>å› æ­¤ï¼Œå½“ä¸¤å°æœºå™¨è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¿…é¡»å…ˆå°†æœ¬åœ°å­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºè½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åºåœ¨è¿›è¡Œå‘é€ï¼Œå½“æ”¶åˆ°æ•°æ®ä¹‹åï¼Œåº”å½“å°†ç½‘ç»œå­—èŠ‚åºè½¬åŒ–ä¸ºæœ¬åœ°å­—èŠ‚åºå†è¿›è¡Œåç»­ä½¿ç”¨ã€‚</p> 
<h4 id="%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E6%88%90%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F">æœ¬åœ°å­—èŠ‚åºè½¬æ¢æˆç½‘ç»œå­—èŠ‚åº</h4> 
<pre><code class="language-cpp">       #include &lt;arpa/inet.h&gt;

       //å°†32ä½çš„æ•´å‹æ•°æ®ä»æœ¬åœ°è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº
       uint32_t htonl(uint32_t hostlong);
       //å°†16ä½çš„æ•´å½¢æ•°æ®ä»æœ¬åœ°è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº
       uint16_t htons(uint16_t hostshort);

</code></pre> 
<h4 id="%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%9C%AC%E5%9C%B0%E5%AD%97%E8%8A%82%E5%BA%8F">ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºæœ¬åœ°å­—èŠ‚åº</h4> 
<pre><code class="language-cpp">       #include &lt;arpa/inet.h&gt;

       //å°†32ä½çš„æ•´å½¢ç½‘ç»œåºåˆ—è½¬æ¢ä¸ºæœ¬åœ°åºåˆ—
       uint32_t ntohl(uint32_t netlong);
       //å°†16ä½çš„æ•´å½¢ç½‘ç»œåºåˆ—è½¬æ¢ä¸ºæœ¬åœ°åºåˆ—
       uint16_t ntohs(uint16_t netshort);
</code></pre> 
<h2 id="%E4%BA%8C.%20%E5%A5%97%E6%8E%A5%E5%AD%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">äºŒ. å¥—æ¥å­—çš„åŸºæœ¬æ“ä½œ</h2> 
<h3 id="socket%E7%9A%84%E5%88%9B%E5%BB%BA"><strong>ğŸ“šÂ </strong>socketçš„åˆ›å»º</h3> 
<pre><code class="language-cpp">       #include &lt;sys/types.h&gt;          /* See NOTES */
       #include &lt;sys/socket.h&gt;

       int socket(int domain, int type, int protocol);
</code></pre> 
<h4 id="%E5%9F%9F(domain)">åŸŸ(domain)</h4> 
<p>åŸŸæŒ‡å®šäº†Socketç¼–æˆæ¨¡å‹çš„åœ°å€æ—ï¼Œå…¶ç±»å‹ä¸ºint,å¸¸è§çš„å–å€¼å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š<br><img alt="" height="478" src="https://images2.imgbox.com/62/ea/0O0fcj61_o.png" width="715"></p> 
<p>Â ç½‘ç»œç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„socketåŸŸå–å€¼æ˜¯AF_INETå’ŒAF_INET6åè®®ï¼Œå…¶ä¸­AF_INET6åè®®æ˜¯ä¸‹ä¸€ä»£äº’è”ç½‘çš„åè®®ï¼Œå®¢æœç›®å‰IPv4å­˜åœ¨å¯ç”¨åœ°å€æœ‰é™çš„é—®é¢˜ï¼Œä½†AF_INET6åè®®è¿˜æ²¡æœ‰è¢«å®é™…è¿ç”¨ï¼Œåœ¨å†™ä»£ç æ—¶ä¸€èˆ¬ä½¿ç”¨AF_INET.</p> 
<h4 id="%E7%B1%BB%E5%9E%8B%EF%BC%88type%EF%BC%89"><br> ç±»å‹ï¼ˆtypeï¼‰</h4> 
<p>ç±»å‹ä¸»è¦æŒ‡å®šäº†é€šä¿¡åŒæ–¹çš„<strong>æ•°æ®ä¼ è¾“æ ¼å¼</strong>ï¼Œæ¯”è¾ƒå¸¸è§çš„æ•°æ®æ ¼å¼ç±»å‹æœ‰ä¸‰ç§:</p> 
<p><img alt="" height="433" src="https://images2.imgbox.com/c9/b7/DkPv4TJc_o.png" width="871"></p> 
<p></p> 
<h4 id="%C2%A0%E5%8D%8F%E8%AE%AE%EF%BC%88Protcol%EF%BC%89">Â åè®®ï¼ˆProtcolï¼‰</h4> 
<p>åè®®ä¸»è¦æŒ‡é€šä¿¡åŒæ–¹çš„çº¦å®šï¼Œå¦‚<strong>TCPåè®®</strong>å’Œ<strong>UDPåè®®</strong>ï¼Œä½†æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“<strong>åŒæ–¹çš„åŸŸï¼ˆdomainï¼‰å’Œé€šä¿¡æ•°æ®ç±»å‹ï¼ˆtypeï¼‰</strong>ç¡®å®šä»¥åï¼Œåè®®å°±ä¼šè¢«å”¯ä¸€ç¡®å®šlï¼Œä¼ 0è¡¨ç¤ºæ ¹æ®domainå’Œtypeç±»å‹æ¨å‡ºåè®®ã€‚æ‰€ä»¥è¯¥<strong>å‚æ•°ä¸€èˆ¬ä¼ 0å³å¯</strong>ã€‚</p> 
<h4 id="%E8%BF%94%E5%9B%9E%E5%80%BC"><strong>è¿”å›å€¼</strong></h4> 
<p>å‡½æ•°socket()çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¥—æ¥å­—çš„å»ºç«‹æœ¬è´¨æ˜¯ä¸€ä¸ªè¿›ç¨‹åœ¨å†…å­˜ä¸­æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®ä¸ç½‘å¡äº’ç›¸è¿æ¥ï¼Œç„¶åå°†æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™è¿›ç¨‹ï¼Œç„¶åè¿›ç¨‹å¯ä»¥å¯¹è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¿›è¡Œè¯»å†™æ•°æ®ã€‚</p> 
<p>æˆåŠŸè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆsocketæè¿°ç¬¦ï¼‰ï¼Œå¤±è´¥è¿”å›-1ï¼ŒåŒæ—¶errnoè¢«è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚</p> 
<p></p> 
<p><img alt="" height="670" src="https://images2.imgbox.com/28/90/vK76PVJL_o.png" width="1200"></p> 
<p><strong>Â åˆ›å»ºsocketæœ¬è´¨æ˜¯ä¸€ä¸ªè¿›ç¨‹åœ¨å†…å­˜ä¸­æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç¼“å†²åŒº</strong>ï¼Œç„¶åè¿™ä¸ªæ–‡ä»¶ç¼“å†²åŒºä¸ç½‘å¡è¿›è¡Œæ•°æ®äº¤äº’ã€‚</p> 
<h3 id="struct%20socketaddr%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84"><strong>ğŸ“šÂ </strong>struct socketaddråœ°å€ç»“æ„</h3> 
<p>åœ¨å„ç§åº•å±‚ç½‘ç»œåè®®ä¸­ï¼Œå¦‚IPv4å’ŒIPv6,ä»¥åŠUNIX DOMAIN socket,è¿™äº›åº•å±‚ç½‘ç»œåè®®åœ°å€æ ¼å¼ä¸åŒï¼Œæ‰€ä»¥ä¸ºäº†å…¼å®¹è¿™äº›åº•å±‚ç½‘ç»œåè®®ï¼ŒSocket APIå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„struct socketaddrï¼Œè¿™ä½¿å¾—ä¸åŒçš„åœ°å€ç»“æ„å¯ä»¥è¢«bind(),connect,revfrom,sendto()ç­‰å‡½æ•°è°ƒç”¨ã€‚</p> 
<h4 id="struct%20sockaddr%C2%A0%20%E7%BB%93%E6%9E%84">struct sockaddrÂ  ç»“æ„</h4> 
<pre><code class="language-cpp">          struct sockaddr {
               sa_family_t sa_family; //åœ°å€æ— 16ä½
               char        sa_data[14]; //14ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬ç›®æ ‡åœ°å€å’Œç«¯å£å·
           }
</code></pre> 
<h4 id="%C2%A0struct%20sockaddr_in%20%E7%BB%93%E6%9E%84">Â struct sockaddr_in ç»“æ„</h4> 
<pre><code class="language-cpp">struct sockaddr_in {    
  __kernel_sa_family_t  sin_family;   // åœ°å€æ— 16ä½
  __be16    sin_port;    //ç«¯å£å·ï¼Œ16ä½,å¯ä»¥çœ‹æˆä¸€ä¸ªintç±»å‹
  struct in_addr  sin_addr;  //ipåœ°å€ 32ä½
    
   //å¡«å……ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸éœ€è¦ç®¡
  unsigned char   __pad[__SOCK_SIZE__ - sizeof(short int) -    
      sizeof(unsigned short int) - sizeof(struct in_addr)];    
};  

//ä»¥æ•´æ•°çš„å½¢å¼æŒ‡å®šå¥—æ¥å­—çš„ç½‘ç»œåœ°å€
struct in_addr {
  __be32  s_addr; //å­˜æ”¾32ä½ipåœ°å€
};
</code></pre> 
<p>IPv4åœ°å€ä½¿ç”¨sockaddr_inç»“æ„ä½“è¡¨ç¤ºï¼ŒåŒ…æ‹¬16ä½åœ°å€ç±»å‹ï¼Œ16ä½ç«¯å£å·å’Œ32ä½ipåœ°å€ã€‚</p> 
<div> 
 <strong><span style="color:#777777;">IPv4</span><span style="color:#777777;">å’Œ</span><span style="color:#777777;">IPv6</span><span style="color:#777777;">çš„åœ°å€æ ¼å¼å®šä¹‰åœ¨</span><span style="color:#777777;">netinet/in.hå¤´æ–‡ä»¶</span></strong> 
 <span style="color:#777777;"><strong>ä¸­</strong>,IPv4åœ°å€ç”¨</span> 
 <span style="color:#777777;">sockaddr_in</span> 
 <span style="color:#777777;">ç»“æ„ä½“è¡¨ç¤º</span> 
 <span style="color:#777777;">,</span> 
 <span style="color:#777777;">åŒ…æ‹¬</span> 
 <span style="color:#777777;">16</span> 
 <span style="color:#777777;">ä½åœ°å€ç±»å‹</span> 
 <span style="color:#777777;">, 16 ä½ç«¯å£å·å’Œ32</span> 
 <span style="color:#777777;">ä½</span> 
 <span style="color:#777777;">IPåœ°å€.</span> 
</div> 
<p></p> 
<h3 id="socket%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80%EF%BC%88bind%E5%87%BD%E6%95%B0%EF%BC%89"><strong>ğŸ“šÂ </strong>socketç»‘å®šåœ°å€ï¼ˆbindå‡½æ•°ï¼‰</h3> 
<p>è‹¥è¦ä½¿socketä¹Ÿå¯ä»¥è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ï¼ŒæœåŠ¡å™¨å¿…é¡»ç»™socketç»‘å®š<strong>ipåœ°å€</strong>å’Œ<strong>ç«¯å£å·</strong>ã€‚</p> 
<pre><code class="language-cpp">       #include &lt;sys/types.h&gt;          /* See NOTES */
       #include &lt;sys/socket.h&gt;

       int bind(int sockfd, const struct sockaddr *addr,
                socklen_t addrlen);
</code></pre> 
<p>å‚æ•°sockfdä¸ºå¾…ç»‘å®šçš„socketæè¿°ç¬¦ï¼Œå‚æ•°addræ˜¯æœ¬åœ°sockaddråœ°å€ç»“æ„æŒ‡é’ˆï¼Œaddrlenä¸ºæœ¬åœ°sockaddråœ°å€ç»“æ„çš„å¤§å°ã€‚æ‰§è¡ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1.`</p> 
<blockquote> 
 <p>Â å¯¹äºç»‘å®šIP4å¥—æ¥å­—ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥å»åˆ›å»ºä¸€ä¸ªstruct sockaddrå˜é‡ï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰ä¸€ä¸ªstruct sockaddr_inå˜é‡ï¼Œç„¶åå°†ipåœ°å€å’Œç«¯å£å·å¡«å……è¿›struct sockaddr_inå˜é‡ä¸­ï¼Œæœ€ååœ¨ä¼ å‚çš„æ—¶å€™å°†struct sockaddr_in*å˜é‡å¼ºåˆ¶è½¬æ¢ä¸ºstruct sockaddr*ç±»å‹ï¼Œå…¶ä»–å¥—æ¥å­—ä¹Ÿæ˜¯ä¸€æ ·ã€‚Â Â </p> 
</blockquote> 
<p>ç»‘å®šIP4å¥—æ¥å­—è¿‡ç¨‹å¦‚ä¸‹ï¼šÂ </p> 
<pre><code class="language-cpp">          struct sockaddr_in s;      //åˆ›å»ºIP4ç½‘å¥—æ¥å­—åœ°å€æ•°æ®ç»“æ„
          memset(&amp;s,'\0',sizeof(s));   //å°†sç½®ä¸º0
          s.sin_family=AF_INET;      //è®¾ç½®TCP/IPåœ°å€æ—
          s.sin_port=htons(port);    //è®¾ç½®ç«¯å£å·
          s.sin_addr.s_addr=0;       //ç³»ç»Ÿè‡ªåŠ¨å¡«å…¥æœ¬æœºIPåœ°å€
          bind(fd,(struct sockaddr*)&amp;s,sizeof(s) //ç»‘å®šå¥—æ¥å­—</code></pre> 
<ul><li>åˆ›å»ºstruct soaddr_inå¯¹è±¡æ—¶ï¼Œé¦–å…ˆéœ€è¦ç”¨bzero()å‡½æ•°æˆ–memset()å‡½æ•°å°†å…¶ç½®ä¸º0.Â </li><li>åœ¨è°ƒç”¨bind()å‡½æ•°æ—¶ä¸€èˆ¬ä¸è¦å°†ç«¯å£å·è®¾ç½®ä¸ºå°äº1024çš„å€¼ï¼Œå› ä¸º1~1024æ˜¯ä¿ç•™ç«¯å£å·ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¤§äº1024ä¸­ä»»ä½•ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„ç«¯å£å·ã€‚</li><li>åœ¨ä½¿ç”¨bind(ï¼‰å‡½æ•°æ—¶ï¼Œéœ€è¦å°†sin_portè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œè€Œsin_addråˆ™ä¸éœ€è¦è½¬æ¢ã€‚</li><li>åœ¨ä¸»æœºä¸Šå®šä¹‰çš„IPåœ°å€ä¸€èˆ¬æ˜¯â€œ 112.233.111.111â€è¿™ç§ç‚¹åˆ†å¼å­—ç¬¦ä¸²IPï¼Œä½†æˆ‘ä»¬éœ€è¦å°†è¿™ç§å­—ç¬¦ä¸²IPè½¬æ¢ä¸ºæ•´æ•°IPå¡«å……è¿›in_addrå¯¹è±¡ä¸­çš„s_addrä¸­ã€‚IPè½¬æ¢å‡½æ•°å¦‚ä¸‹ï¼š</li></ul> 
<pre><code class="language-cpp">     //å°†å­—ç¬¦å‹IPè½¬æ¢ä¸º32ä½æ•´æ•°å‹ip
    in_addr_t inet_addr(const char *cp);
     
    //å°†ç½‘ç»œåœ°å€è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    char *inet_ntoa(struct in_addr in)
</code></pre> 
<p>Â  IPåœ°å€ä¹Ÿå¯ä»¥ä¸ç”¨ç›´æ¥å¡«å……ï¼Œä½¿ç”¨INADDR_ANYå˜é‡ï¼Œå¯ä»¥ç›´æ¥å¡«å…¥æœ¬æœºIPåœ°å€ï¼Œæ¨èä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬çš„äº‘æœåŠ¡å™¨ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨è¿™ç§æ“ä½œå¡«å……IPåœ°å€ï¼Œå› ä¸ºäº‘æœåŠ¡å™¨çš„IPæ˜¯ç”±äº‘å‚å•†æä¾›çš„ï¼Œè¿™ä¸ªäº‘æœåŠ¡å™¨IPä¸èƒ½ç›´æ¥è¢«ç»‘å®šã€‚</p> 
<pre><code class="language-cpp">
my_addr.sin_addr.s_addr=INADDR_ANY;   //å¡«å…¥æœ¬æœºIPåœ°å€</code></pre> 
<p>ä¸€èˆ¬åªæœ‰æœåŠ¡å™¨æ‰ä¼šå»ç»‘å®šIPåœ°å€å’Œç«¯å£å·Â ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ç»‘å®šIPåœ°å€å’Œç«¯å£å·ã€‚å› ä¸ºæœåŠ¡å™¨éœ€è¦ä¸æ–­çš„ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·å®ƒä¸å¯ä»¥ä¸€ç›´æ”¹å˜ï¼Œè€Œå®¢æˆ·ç«¯åœ¨è¿æ¥æœåŠ¡å™¨æˆ–è€…ç»™æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šç»™å®¢æˆ·ç«¯éšæœºåˆ†é…ä¸€ä¸ªç«¯å£ï¼Œè¿™ä¸ªç«¯å£å·å’Œipåœ°å€ä¼šå‘é€ç»™æœåŠ¡å™¨ï¼Œæ¥ä¸‹æ¥æœåŠ¡å™¨æ ¹æ®ipåœ°å€å’Œç«¯å£å·å°±å¯ä»¥ç»™å®¢æˆ·å›åº”æ¶ˆæ¯ã€‚</p> 
<h3 id="Socket%E7%9B%91%E5%90%AC%E8%BF%9E%E6%8E%A5%EF%BC%88listen%E5%87%BD%E6%95%B0%EF%BC%89"><strong>ğŸ“šÂ </strong>Socketç›‘å¬è¿æ¥ï¼ˆlistenå‡½æ•°ï¼‰</h3> 
<p>åœ¨æˆåŠŸå»ºç«‹Socketå¹¶å®Œæˆä¸æœ¬åœ°åœ°å€ç»‘å®šåã€‚ä½¿ç”¨listen()å‡½æ•°æ¥ç›‘å¬å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚è°ƒç”¨å‡½æ•°listen()å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œåœ¨å…¶ä¸­å­˜æ”¾æœªå¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">       #include &lt;sys/types.h&gt;          
       #include &lt;sys/socket.h&gt;

       int listen(int sockfd, int backlog);</code></pre> 
<p>Â å‚æ•°ä¸ºSocketæè¿°ç¬¦ï¼Œå‚æ•°ä¸ºbacklogä¸ºè¯·æ±‚é˜Ÿåˆ—ä¸­å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œç³»ç»Ÿé»˜è®¤ä¸º5ã€‚å‡½æ•°listen()æ‰§è¡ŒæˆåŠŸè¿”å›0ï¼Œè‹¥æ‰§è¡Œå¤±è´¥è¿”å›-1.åŒæ—¶errnoè¢«è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚</p> 
<h3 id="Socket%E8%AF%B7%E6%B1%82%E8%BF%9E%E6%8E%A5(connect%E5%87%BD%E6%95%B0%EF%BC%89">Â <strong>ğŸ“šÂ </strong>Socketè¯·æ±‚è¿æ¥(connectå‡½æ•°ï¼‰</h3> 
<p>Tcpåè®®ä¸­ï¼Œå‡½æ•°connect()ç”¨äºå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¿æ¥è¯·æ±‚ï¼›UDPåè®®æ˜¯é¢å‘æ— è¿æ¥çš„ï¼Œå› æ­¤æ— éœ€ä½¿ç”¨connect()ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š<br> Â Â Â Â Â Â Â Â </p> 
<pre><code class="language-cpp">       #include &lt;sys/types.h&gt;          /* See NOTES */
       #include &lt;sys/socket.h&gt;

       int connect(int sockfd, const struct sockaddr *addr,
                   socklen_t addrlen);
</code></pre> 
<p>sockfdä¸ºå¾…ç»‘å®šSocketçš„æè¿°ç¬¦ï¼šå‚æ•°addræ˜¯æœåŠ¡å™¨Socketåœ°å€ç»“æ„æŒ‡é’ˆï¼Œå‚æ•°addrlenä¸ºaddrçš„å¤§å°ã€‚</p> 
<p>Â  Â  å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼ŒåŒæ—¶errnoè¢«è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚Â </p> 
<h3 id="Socket%E6%8E%A5%E5%8F%97%E8%BF%9E%E6%8E%A5%EF%BC%88accept%E5%87%BD%E6%95%B0%EF%BC%89"><strong>ğŸ“šÂ </strong>Socketæ¥å—è¿æ¥ï¼ˆacceptå‡½æ•°ï¼‰</h3> 
<p>æœåŠ¡å™¨è¿›ç¨‹è°ƒç”¨å‡½æ•°listen()åˆ›å»ºç­‰å¾…é˜Ÿåˆ—ä¹‹åï¼Œè°ƒç”¨accept()å‡½æ•°ç­‰å¾…å¹¶æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå‡½æ•°accepté€šå¸¸ä»è¿æ¥ç­‰å¾…é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªæœªå¤„ç†çš„è¿æ¥è¯·æ±‚ï¼Œå…¶å‡½æ•°</p> 
<pre><code class="language-cpp">       #include &lt;sys/types.h&gt;          
       #include &lt;sys/socket.h&gt;

       int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
</code></pre> 
<p>å…¶ä¸­ï¼Œå‚æ•°sockfdä¸ºSocketçš„æè¿°ç¬¦ï¼›å‚æ•°addrä¸ºå­˜æ”¾å®¢æˆ·ç«¯Sockåœ°å€ç»“æ„æŒ‡é’ˆï¼Œå‚æ•°addrlenç”¨äºå­˜æ”¾å®¢æˆ·ç«¯Socketåœ°å€ç»“æ„æŒ‡é’ˆã€‚</p> 
<p>å‡½æ•°accept()æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›å®¢æˆ·ç«¯æ–°çš„å¥—æ¥å­—æè¿°ç¬¦ï¼›è‹¥æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›-1ï¼ŒåŒæ—¶errnoè¢«è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚Â </p> 
<h3 id="Socket%E6%8E%A5%E5%8F%97%E6%95%B0%E6%8D%AE%20%EF%BC%88recvfrom%E5%87%BD%E6%95%B0%EF%BC%89"><strong>ğŸ“šÂ </strong>Socketæ¥å—æ•°æ® ï¼ˆrecvfromå‡½æ•°ï¼‰</h3> 
<pre><code class="language-cpp">ssize_t recv(int sockfd, void *buf, size_t len, int flags);
ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags,
                        struct sockaddr *src_addr, socklen_t *addrlen);</code></pre> 
<p>å‚æ•°sockfdæ˜¯Socketæè¿°ç¬¦,bufæŒ‡å®šæ¥å—æ•°æ®å­˜æ”¾çš„ç¼“å†²åŒºï¼Œlenç”¨äºæŒ‡å®šæ¥å—æ•°æ®çš„å¤§å°ï¼Œå‚æ•°ç”¨äºæŒ‡å®šæ¥å—æ•°æ®çš„æ ‡å¿—ï¼Œä¸€èˆ¬è®¾ç½®ä¸º0.</p> 
<p>å‡½æ•°recvfromä¸­ï¼Œå‚æ•°src_addrç”¨äºå­˜æ”¾æ•°æ®å‘é€æ–¹çš„ç½‘ç»œåœ°å€ç»“æ„ï¼ˆip4æ˜¯ç”±sockaddr_inå¡«å……å¯¹è±¡å¼ºè½¬ä¸ºsockaddrç±»å‹ï¼‰ï¼Œå‚æ•°addrlenæ˜¯src_addrçš„å¤§å°ã€‚</p> 
<p>recvå’Œrecvfromæ‰§è¡ŒæˆåŠŸï¼Œè¿”å›å®é™…æ¥å—çš„å­—èŠ‚æ•°ï¼Œæ‰§è¡Œå¤±è´¥ï¼Œè¿”å›-1.</p> 
<h3 id="Socket%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%EF%BC%88sendto%E5%87%BD%E6%95%B0%EF%BC%89"><strong>ğŸ“šÂ </strong>Socketå‘é€æ•°æ®ï¼ˆsendtoå‡½æ•°ï¼‰</h3> 
<p>å‡½æ•°sendï¼ˆï¼‰å’Œsendtoï¼ˆï¼‰å‘socketè¿æ¥ä¸­å‘é€æ•°æ®ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">   ssize_t send(int sockfd, const void *buf, size_t len, int flags);

   ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,
                      const struct sockaddr *dest_addr, socklen_t addrlen);
</code></pre> 
<p>sockfdæ˜¯Socketæè¿°ç¬¦ï¼Œå‚æ•°bufç”¨äºæŒ‡å®šå‘é€æ•°æ®çš„ç¼“å†²åŒºï¼Œå‚æ•°lenæ˜¯æŒ‡å®šå‘é€æ•°æ®çš„å¤§å°ï¼Œå‚æ•°flagsç”¨äºæŒ‡å®šå‘é€æ•°æ®æ ‡å¿—ï¼Œä¸€èˆ¬è®¾ç½®ä¸º0.</p> 
<p>å‡½æ•°sendtoï¼ˆï¼‰ï¼Œdest_addrç”¨äºæŒ‡å®šæ¥å—æ–¹çš„ç½‘ç»œåœ°å€ç»“æ„ï¼ˆip4æ˜¯ç”±sockaddr_inå¡«å……å¯¹è±¡å¼ºè½¬ä¸ºsockaddrç±»å‹ï¼‰ï¼Œaddrlenæ˜¯dest_addrçš„å¤§å°ã€‚Â </p> 
<p>å‡½æ•°sendï¼ˆï¼‰å’Œsendto()å‘é€æ•°æ®æˆåŠŸï¼Œè¿”å›å®é™…å‘é€å‡ºæ•°æ®çš„å¤§å°ï¼Œå¤±è´¥è¿”å›-1.</p> 
<h3 id="Socket%E5%85%B3%E9%97%AD"><strong>ğŸ“šÂ </strong>Socketå…³é—­</h3> 
<p>å› ä¸ºsocketfdæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ç”¨æˆ·ä¹Ÿå¯ä»¥ç”¨closeï¼ˆï¼‰å‡½æ•°æ¥ç»ˆæ­¢æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„å¥—æ¥å­—çš„è¿æ¥ã€‚</p> 
<pre><code class="language-cpp">       #include &lt;unistd.h&gt;
       int close(int fd);
</code></pre> 
<p>closeå‡½æ•°æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›0ï¼Œå¤±è´¥è¿”å›-1.</p> 
<h2 id="UDP%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B">ä¸‰. UDPç¼–ç¨‹æ¨¡å‹</h2> 
<blockquote> 
 <p>UDPç¼–ç¨‹æ˜¯ä¸éœ€è¦è¿æ¥çš„ï¼Œå®ƒæ˜¯é¢å‘æ•°æ®æŠ¥ã€‚UDP socketæ˜¯ä¸å¯é çš„ï¼ŒæŠ¥æ–‡å¯èƒ½ä¼šä¸¢å¤±ï¼Œé‡å¤æˆ–è¾¾åˆ°çš„é¡ºåºä¸å®ƒå‘é€æ—¶çš„é¡ºåºä¸åŒï¼›ç¬¬äºŒï¼Œå½“UDPä¸Šçš„socketå¡«æ»¡çš„æ•°æ®æ—¶ï¼Œå†å‘é€æ•°æ®æ—¶åˆ™æŠ¥æ–‡ä¼šä¸¢å¼ƒã€‚</p> 
</blockquote> 
<p><img alt="" height="981" src="https://images2.imgbox.com/0d/b7/yRGZ7Iig_o.png" width="851"></p> 
<p>ä»£ç :</p> 
<p>server.hppæ–‡ä»¶</p> 
<pre><code class="language-cpp"> #include&lt;iostream&gt;
  #include&lt;string&gt;
  #include&lt;sys/types.h&gt;
  #include&lt;sys/socket.h&gt;
  #include&lt;netinet/in.h&gt;
  #include&lt;arpa/inet.h&gt;
  #include&lt;string.h&gt;
  using namespace std;
  
  class server                                                                                         
  {
    private:
      int port;
      string ip;
      int fd;
    public:
      server(string _ip,int _port)
W&gt;      :ip(_ip),port(_port)
      {}
  
      bool initUdpServer()
      {
          //åˆ›å»ºå¥—æ¥å­—
          fd=socket(AF_INET,SOCK_DGRAM,0);
          if(fd&lt;0)
          {
            cout&lt;&lt;"socket fail\n"&lt;&lt;endl;
            return false;
          }
          cout&lt;&lt;"socket success"&lt;&lt;endl;
          //ç»‘å®šå¥—æ¥å­—
          struct sockaddr_in s;
          memset(&amp;s,'\0',sizeof(s));
          s.sin_family=AF_INET;
          s.sin_port=htons(port);
          s.sin_addr.s_addr=0; 
          if(bind(fd,(struct sockaddr*)&amp;s,sizeof(s))&lt;0)
          {
              cerr&lt;&lt;"bind error"&lt;&lt;endl;
              return false;
          }
          cout&lt;&lt;"bind success"&lt;&lt;endl;
          return true;
      }
  
      void Start()
      {
        for(;;)
        {
  #define NUM 32
          char buf[NUM];
          struct sockaddr_in peer;
          socklen_t len=0;                                                                             
          ssize_t sz=recvfrom(fd,(void*)buf,sizeof(buf)-1,0,(struct sockaddr*)&amp;peer,&amp;len);
          if(sz&gt;0)
        {
             buf[sz]='\0';
             int _port=ntohs(peer.sin_port);
             string s=inet_ntoa(peer.sin_addr);
             cout&lt;&lt;s&lt;&lt;":"&lt;&lt; _port&lt;&lt;"#"&lt;&lt;buf&lt;&lt;endl;
          }
          else{
          cerr&lt;&lt;"recvfrom error"&lt;&lt;endl;
          }
        }
      }
  };                                                                                                   
 
</code></pre> 
<p>server.ccæ–‡ä»¶</p> 
<pre><code class="language-cpp">#include"server.hpp"    
#include&lt;stdlib.h&gt;    
int main(int argc,char* argv[])    
{    
  if(argc!=2)    
  {    
    cout&lt;&lt;"Usage :"&lt;&lt;argv[0]&lt;&lt; "port"&lt;&lt;endl;    
  }    
  string ip="127.0.1";//127.0.1è¡¨ç¤ºæœ¬åœ°ç¯å›    
  int port=atoi(argv[1]);    
  server* s=new server(ip,port);    
  s-&gt;initUdpServer();    
  s-&gt;Start();    
  return 0;                                                                                            
}    
</code></pre> 
<p>Â </p> 
<p>client.hppæ–‡ä»¶</p> 
<pre><code class="language-cpp">#include&lt;iostream&gt;                                                                                     
#include&lt;string&gt;    
#include&lt;sys/types.h&gt;    
#include&lt;sys/socket.h&gt;    
#include&lt;stdlib.h&gt;    
#include&lt;netinet/in.h&gt;    
#include&lt;string.h&gt;    
#include&lt;arpa/inet.h&gt;    
using namespace std;    
    
class client    
{    
  private:    
    int sockfd;    
    int sev_port;    
    string sev_ip;    
  public:    
    client(string _sev_ip,int _sev_port)    
      :sev_port(_sev_port)    
      ,sev_ip(_sev_ip)    
    {    
    
    }    
    
    bool InitClient()    
    {    
      sockfd=socket(AF_INET,SOCK_DGRAM,0);    
      if(sockfd&lt;0)    
      {    
        cout&lt;&lt;"socket error"&lt;&lt;endl;    
        return false;    
      }    
     return true;
    }

    void start()
    {
      struct sockaddr_in dest;
      memset(&amp;dest,'0',sizeof(dest));
      dest.sin_family=AF_INET;
      dest.sin_port=htons(sev_port);
      dest.sin_addr.s_addr=inet_addr(sev_ip.c_str());
      string buf;
      for(;;)
      {
        cout&lt;&lt;"Please Enter#"&lt;&lt;endl;
        cin&gt;&gt;buf;
        sendto(sockfd,(void*)buf.c_str(),(size_t)buf.size(),0,(struct sockaddr*)&amp;dest,sizeof(dest));
      }
    }
};        </code></pre> 
<p>client.ccæ–‡ä»¶</p> 
<pre><code class="language-cpp">#include"client.hpp"    
    
//./client "127.0.0.1" 8081    
int main(int argc,char* argv[])    
{    
  if(argc!=3)    
  {    
    cout&lt;&lt;"Usuage"&lt;&lt;"server_ip server_port"&lt;&lt;endl;    
    
  }    
  char* ip=argv[1];    
  int port=atoi(argv[2]);    
  client* c=new client(ip,port);    
  c-&gt;InitClient();    
  c-&gt;start();                                                                                          
  return 0;    
}  </code></pre> 
<p>Â </p> 
<h2 id="Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8">å››. Tcpç¼–ç¨‹æ¨¡å‹</h2> 
<p>Tcpåè®®å†ä¸¤ä¸ªç«¯ç‚¹ï¼ˆå³åº”ç”¨ç¨‹åºï¼‰ä¹‹é—´æä¾›äº†å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ï¼ŒåŒå‘å­—èŠ‚æµçš„é€šä¿¡ç®¡é“ã€‚</p> 
<p><img alt="" height="484" src="https://images2.imgbox.com/ea/74/cTC1pgCu_o.png" width="1200"></p> 
<p>Â </p> 
<p>Tcpåè®®æä¾›äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ã€‚Tcpå®¢æˆ·ç«¯é¦–å…ˆç»™æŸä¸ªå®šæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œç„¶åå†é€šè¿‡è¿æ¥ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œæœ€åç»ˆæ­¢è¿™ä¸ªè¿æ¥ã€‚</p> 
<p>Tcpåè®®ä¿è¯äº†æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼Œå½“Tcpä¸€ç«¯å‘å¦ä¸€ç«¯å‘é€æ•°æ®æ—¶ï¼Œå®ƒè¦æ±‚å¦ä¸€ç«¯è¿”å›ä¸€ä¸ªâ€œç¡®è®¤â€ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°â€œç¡®è®¤â€ï¼ŒTcpå°±ä¼šè‡ªåŠ¨å¤šæ¬¡ä¼ é€æ•°æ®ï¼Œåœ¨æ•°æ¬¡é‡ä¼ å¤±è´¥åæ‰ä¼šæ”¾å¼ƒã€‚</p> 
<p>Tcpåè®®æä¾›çš„<strong>è¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œè¿™æ„å‘³ç€åœ¨ä¸€ä¸ªç»™å®šçš„è¿æ¥ä¸Šï¼Œä¸€ä¸ªTcpç«¯ç‚¹å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»å‘é€æ•°æ®åˆæ¥å—æ•°æ®</strong>ã€‚</p> 
<p>Tcpåè®®</p> 
<ul><li>ä¼ è¾“å±‚åè®®</li><li>æœ‰é“¾æ¥</li><li>å¯é ä¼ è¾“</li><li>é¢å‘å­—èŠ‚æµ</li></ul> 
<p>TcpæœåŠ¡å™¨æ¨¡å‹</p> 
<p><img alt="" height="728" src="https://images2.imgbox.com/ce/fa/oc2P2ZjE_o.png" width="1200"></p> 
<p>TcpæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥æ”¶å’Œå‘é€æ•°æ®å¯ä»¥ç”¨readå’Œwriteï¼Œé¦–å…ˆï¼Œå‰é¢socketæè¿°ç¬¦æœ¬è´¨æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ–‡ä»¶çš„æ“ä½œæ¥å£ï¼ŒÂ å…¶æ¬¡ï¼ŒæœåŠ¡å™¨åœ¨accept()åè¿æ¥å®¢æˆ·ç«¯å°±å¯ä»¥æ‹¿åˆ°å®¢æˆ·ç«¯çš„IPå’Œç«¯å£å·ä¿¡æ¯ã€‚æ‰€ä»¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥æ”¶æ•°æ®å’Œå‘é€æ•°æ®æ­£å¸¸ä½¿ç”¨read()å‡½æ•°å’Œwrite()å‡½æ•°ã€‚</p> 
<p>read()å¦‚æœå¤§äº0ï¼Œè¯´æ˜è¯»åˆ°äº†ä¿¡æ¯ã€‚å¦‚æœç­‰äº0ï¼Œè¯´æ˜å¯¹ç«¯å·²å…³é—­ã€‚</p> 
<p id="makefile%E6%96%87%E4%BB%B6"><strong>makefileæ–‡ä»¶</strong></p> 
<pre><code class="language-cpp">.PHONY:all    
all:tcp_client tcp_server    
    
tcp_client:tcp_client.cc    
  g++ $^ -o $@    
    
tcp_server:tcp_server.cc    
  g++ $^ -o $@    
    
clean:                                                                             
  rm -f tcp_client tcp_server   </code></pre> 
<p id="%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%B4%E6%96%87%E4%BB%B6"><strong>æœåŠ¡å™¨å¤´æ–‡ä»¶</strong></p> 
<p>ä¸‹é¢æ˜¯å•çº¿ç¨‹å•è¿›ç¨‹çš„æœåŠ¡å™¨ï¼Œä¸€æ¬¡åªèƒ½è¿æ¥ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p> 
<p><img alt="" height="242" src="https://images2.imgbox.com/b9/42/hsp4Lj6d_o.png" width="976"></p> 
<p>Â </p> 
<p>Â </p> 
<pre><code class="language-cpp">#pragma once                                                                       
#include&lt;iostream&gt;
#include&lt;string.h&gt;
#include&lt;sys/socket.h&gt;
#include&lt;arpa/inet.h&gt;
#include&lt;sys/types.h&gt;
#include&lt;netinet/in.h&gt;
#include&lt;unistd.h&gt;
#include&lt;string&gt;
#include&lt;stdlib.h&gt;
class TcpServer
{
  private:
    int port;//ç«¯å£å·
    int listen_sock;//ç›‘å¬å¥—æ¥å­—æè¿°ç¬¦
  public:
    TcpServer(int _port=8081)
      :port(_port)
      ,listen_sock(-1)
    {

    }

    void InitServer()
    {
      listen_sock=socket(AF_INET,SOCK_STREAM,0);//åˆ›å»ºå¥—æ¥å­—
      if(listen_sock&lt;0)
      {
        std::cerr&lt;&lt;"socket fail"&lt;&lt;std::endl;
        return;
      }
      std::cout&lt;&lt;"socket success"&lt;&lt;std::endl;
      struct sockaddr_in s;
      memset(&amp;s,'\0',sizeof(s));
      s.sin_family=AF_INET;
      s.sin_port=htons(port);                                                      
      s.sin_addr.s_addr=INADDR_ANY;
      //ç»‘å®šå¥—æ¥å­—
      if(bind(listen_sock,(struct sockaddr*)&amp;s,sizeof(s))&lt;0)
      {
        std::cerr&lt;&lt;"bind failing"&lt;&lt;std::endl;
        return;
      }  
      //è®©å¥—æ¥å­—å»ç›‘å¬è¿æ¥
      if(listen(listen_sock,5)&lt;0)
      {
        std::cerr&lt;&lt;"listen failing"&lt;&lt;std::endl;
      }
    }

    void Loop()
    {
      struct sockaddr_in sockaddr;                                                 
      for(;;)
      {
        socklen_t len=sizeof(sockaddr); 
        //æ¥å—ç›‘å¬å¥—æ¥å­—å…¶ä¸­çš„ä¸€ä¸ªè¿æ¥ï¼Œç„¶ååœ¨åˆ›å»ºæ–°çš„å¥—æ¥å­—ç»™è¿™ä¸ªè¿æ¥
        //æ–°çš„å¥—æ¥å­—è¿›è¡Œæ•°æ®é€šä¿¡
        int sockfd=accept(listen_sock,(struct sockaddr*)&amp;sockaddr,&amp;len);
        if(sockfd&lt;0)
        {
          std::cerr&lt;&lt;"accept fail"&lt;&lt;std::endl;
          continue;
        }
 
        std::string ip=inet_ntoa(sockaddr.sin_addr);
        int port=ntohs(sockaddr.sin_port);
        std::cout&lt;&lt;"get new link..["&lt;&lt;ip&lt;&lt;"]:"&lt;&lt;port&lt;&lt;std::endl;
        //å¯¹æ–°çš„å¥—æ¥å­—è¿›è¡ŒæœåŠ¡
        Server(sockfd,ip,port);
      }         
    }

    void Server(int sock,std::string ip,int port)//æœåŠ¡åŠŸèƒ½
    {
      char buffer[1024];
      while(true)
      {
        ssize_t size=read(sock,buffer,sizeof(buffer)-1);
        if(size&gt;0)
        {
          buffer[size]='\0';
          std::cout&lt;&lt;ip&lt;&lt;":"&lt;&lt;port&lt;&lt;"#"&lt;&lt;buffer&lt;&lt;std::endl;
          write(sock,buffer,size);
        }
        else if(size==0)
        {             
          std::cout&lt;&lt;ip&lt;&lt;":"&lt;&lt;port&lt;&lt;"close"&lt;&lt;std::endl;
          break;
        }
        else{
          std::cout&lt;&lt;"port error!!"&lt;&lt;std::endl;
        }
      }
         //æ–°çš„å¥—æ¥å­—ä½¿ç”¨å®Œåï¼Œéœ€è¦å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œé˜²æ­¢æ–‡ä»¶æè¿°ç¬¦æ³„æ¼
        close(sock);
    }                                                                              
};
</code></pre> 
<p>æœåŠ¡å™¨.ccæ–‡ä»¶</p> 
<pre><code class="language-cpp">#include"tcp_server.hpp"    
using namespace std;    
//å¯åŠ¨æœåŠ¡å™¨çš„æ–¹å¼ï¼š./tcp_server port    
int main(int argv,char* argc[])    
{                                                                                  
  if(argv!=2)    
  {                    
    cout&lt;&lt;"Usage: tcp_server port"&lt;&lt;endl;    
    exit(-1);                                
  }                    
                       
  TcpServer* ts=new TcpServer(atoi(argc[1]));//åˆ›å»ºæœåŠ¡å™¨    
  ts-&gt;InitServer();//åˆå§‹åŒ–æœåŠ¡å™¨                                   
  ts-&gt;Loop();//å¯åŠ¨æœåŠ¡å™¨                                           
  return 0;                                                         
}         </code></pre> 
<p>å®¢æˆ·ç«¯å¤´æ–‡ä»¶</p> 
<pre><code class="language-cpp">#pragma once
#include&lt;iostream&gt;
#include&lt;netinet/in.h&gt;
#include&lt;arpa/inet.h&gt;
#include&lt;string.h&gt;
#include&lt;sys/types.h&gt;
#include&lt;string&gt;
#include&lt;sys/socket.h&gt;
#include&lt;unistd.h&gt;

class TcpClient
{
  private:
    int ser_port;//æœåŠ¡å™¨ç«¯å£å·
    std::string ser_ip;//æœåŠ¡å™¨çš„ipåœ°å€
    int sockfd;//æœ¬åœ°å¥—æ¥å­—æè¿°ç¬¦
  public:
    TcpClient(std::string _ser_ip,int _ser_port):
      ser_port(_ser_port)                                                          
      ,ser_ip(_ser_ip)
      ,sockfd(-1)
  {

  }

    void InitTcpClient()
    {
      sockfd=socket(AF_INET,SOCK_STREAM,0);//åˆ›å»ºå¥—æ¥å­—
      if(sockfd&lt;0)
      {
        std::cerr&lt;&lt;"socket failing"&lt;&lt;std::endl;
        return;
      }
    }

      void Start()
      {
          struct sockaddr_in peer;
          memset(&amp;peer,'\0',sizeof(peer));
          peer.sin_family=AF_INET;
          peer.sin_port=htons(ser_port);
          peer.sin_addr.s_addr=inet_addr(ser_ip.c_str());
          //æœ¬åœ°å¥—æ¥å­—å»è¿æ¥æœåŠ¡å™¨
          if(connect(sockfd,(struct sockaddr*)&amp;peer,sizeof(peer))==0)
          {
            //è¿æ¥æˆåŠŸï¼Œè¯·æ±‚æœåŠ¡
            std::cout&lt;&lt;"connect success..."&lt;&lt;std::endl;
            Request(sockfd);
          }
          else{
            //fail
            std::cout&lt;&lt;"connect fail"&lt;&lt;std::endl;
          }
      }
      //è¯·æ±‚æœåŠ¡ä»»åŠ¡æ¥å£
      void Request(int sockfd)
      {
        std::string message;
        char buffer[1024];
        while(true)
        {
          std::cout&lt;&lt;"Please Enter#";
          std::cin&gt;&gt;message;
          //å¾€å¥—æ¥å­—ä¸­è¾“å…¥æ•°æ®
          write(sockfd,message.c_str(),message.size());

          ssize_t size=read(sockfd,buffer,sizeof(buffer));
          if(size&gt;0)
          {
            buffer[size]='\0';
            std::cout&lt;&lt;"server # "&lt;&lt;buffer&lt;&lt;std::endl;
          }
        }
      }

      ~TcpClient()
      {                                                                            
        if(sockfd&gt;0)
          close(sockfd);
      }
};

</code></pre> 
<p>å®¢æˆ·ç«¯.ccæ–‡ä»¶</p> 
<pre><code class="language-cpp">#include"tcp_client.hpp"    
using namespace std;    
#include&lt;stdlib.h&gt;    
// å¯åŠ¨å®¢æˆ·ç«¯çš„æ–¹å¼ï¼š./tcp_client ip port    
    
int main(int argv,char* argc[])    
{    
  if(argv!=3)    
  {    
    cout&lt;&lt;"Usage : ./tcp_client ip port"&lt;&lt;endl;    
    exit(-1);    
  }    
      
  TcpClient* tc=new TcpClient(argc[1],atoi(argc[2]));    
  tc-&gt;InitTcpClient();    
  tc-&gt;Start();//å¼€å§‹è¿è¡ŒæœåŠ¡ç«¯                                                     
  return 0;                            
}  </code></pre> 
<p>Â è¿è¡Œç»“æœï¼š</p> 
<p>Â  Â Â <img alt="" height="207" src="https://images2.imgbox.com/50/15/u5vExu39_o.png" width="856"></p> 
<p>Â å› ä¸ºè¿™æ˜¯å•çº¿ç¨‹å•è¿›ç¨‹çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœåŠ¡å™¨æ¯æ¬¡åªèƒ½æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚Â Â Â Â Â Â Â Â </p> 
<p><img alt="" height="748" src="https://images2.imgbox.com/42/90/gCNrzUaq_o.png" width="1200"></p> 
<h3 id="%C2%A0%E5%A4%9A%E8%BF%9B%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8">Â å¤šè¿›ç¨‹æœåŠ¡å™¨</h3> 
<p><img alt="" height="642" src="https://images2.imgbox.com/cc/7e/V2MkaQu7_o.png" width="1200"></p> 
<p>Â </p> 
<p>å¤šè¿›ç¨‹æœåŠ¡å™¨åªéœ€è¦åœ¨server.hppæ–‡ä»¶æ”¹Loop()å‡½æ•°ï¼Œå…¶ä»–æ–‡ä»¶ä¸ç”¨æ”¹ã€‚Â Â  Â Â </p> 
<p>ä¸»çº¿ç¨‹æ˜¯çˆ·çˆ·è¿›ç¨‹ï¼Œçˆ·çˆ·è¿›ç¨‹ä¸æ–­çš„å»ç­‰å¾…é˜Ÿåˆ—ä¸­æ¥å—æ–°è¿æ¥ï¼Œæ¥å—åˆ°ä¸€ä¸ªæ–°è¿æ¥ï¼Œå°±å»åˆ›å»ºä¸€ä¸ªçˆ¸çˆ¸è¿›ç¨‹ï¼Œå†åˆ›å»ºä¸€ä¸ªå„¿å­è¿›ç¨‹å»æœåŠ¡å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå†é€€å‡ºçˆ¸çˆ¸è¿›ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªè¿æ¥ï¼Œçˆ·çˆ·è¿›ç¨‹å°±ä¼šåˆ›å»ºå¤šä¸ªå„¿å­è¿›ç¨‹å»æœåŠ¡å¤šä¸ªè¿æ¥ã€‚ä¸ºä»€ä¹ˆè¦åˆ›å»ºå„¿å­è¿›ç¨‹ï¼Ÿå¦‚æœåªåˆ›å»ºçˆ¸çˆ¸è¿›ç¨‹ï¼Œé‚£ä¹ˆçˆ¸çˆ¸è¿›ç¨‹å†é€€å‡ºå‰ï¼Œçˆ·çˆ·è¿›ç¨‹éœ€è¦å»å›æ”¶çˆ¸çˆ¸è¿›ç¨‹çš„èµ„æºï¼Œçˆ·çˆ·è¿›ç¨‹å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œå¦‚æœå†åˆ›å»ºä¸€ä¸ªå„¿å­è¿›ç¨‹ï¼Œå†é€€å‡ºçˆ¸çˆ¸è¿›ç¨‹ï¼Œé‚£ä¹ˆå„¿å­è¿›ç¨‹å°±ä¼šè¢«æ“ä½œç³»ç»Ÿç»™â€œé¢†å…»",å½“å„¿å­ç³»ç»Ÿé€€å‡ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾å„¿å­è¿›ç¨‹çš„èµ„æºï¼Œæ­¤æ—¶çˆ·çˆ·è¿›ç¨‹å°±ä¸ä¼šè¢«é˜»å¡ï¼Œç»§ç»­å»æ¥æ”¶æ–°çš„è¿æ¥ã€‚</p> 
<p><img alt="" height="736" src="https://images2.imgbox.com/05/1e/wQVsMwWO_o.png" width="817"></p> 
<p>Â </p> 
<p>Â Â Â Â Â Â Â Â Â </p> 
<p>Â å½“åˆ›å»ºå„¿å­è¿›ç¨‹å»æœåŠ¡æ–°é“¾æ¥åï¼Œ<strong>çˆ·çˆ·è¿›ç¨‹å°±éœ€è¦å…³é—­æ–°è¿æ¥çš„sockæè¿°ç¬¦</strong>ï¼Œé˜²æ­¢çˆ·çˆ·è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨æ³„æ¼ã€‚</p> 
<p>è¿è¡Œç»“æœ</p> 
<p><img alt="" height="683" src="https://images2.imgbox.com/b9/17/p9A6LFwd_o.png" width="1200"></p> 
<h3 id="%C2%A0%E5%A4%9A%E7%BA%BF%E7%A8%8Btcp%E6%9C%8D%E5%8A%A1%E5%99%A8">Â å¤šçº¿ç¨‹æœåŠ¡å™¨</h3> 
<p><img alt="" height="823" src="https://images2.imgbox.com/ea/e1/GbNzs0vf_o.png" width="1200"></p> 
<p>å¤šçº¿ç¨‹æœåŠ¡å™¨ä»£ç Â </p> 
<pre><code class="language-cpp"> class Pragma
  {
    public:
      int sockfd;
      std::string ip;
      int port;
    public:
      Pragma(int _sockfd,std::string _ip,int _port)
        :sockfd(_sockfd)
        ,ip(_ip)
        ,port(_port)
    { 
    }
  };
 class TcpServer
  {
    private:
      int port;
      int listen_sock;
    public:
      TcpServer(int _port)
        :port(_port)
        ,listen_sock(-1)
      {
  
      }
  
      void InitTcpServer()
      {
        listen_sock=socket(AF_INET,SOCK_STREAM,0);
        if(listen_sock&lt;0)
        {
          std::cerr&lt;&lt;"socket failing"&lt;&lt;std::endl;
          exit(2);
        }
       
        struct sockaddr_in lock;
        lock.sin_family=AF_INET;
        lock.sin_port=htons(port);
        lock.sin_addr.s_addr=INADDR_ANY;
       if(bind(listen_sock,(struct sockaddr*)&amp;lock,sizeof(lock))&lt;0)
        {
          std::cerr&lt;&lt;"bind failing"&lt;&lt;std::endl;
          exit(2);
        }
  
        if(listen(listen_sock,5)&lt;0)
        {
          std::cerr&lt;&lt;"listen failing"&lt;&lt;std::endl;
          exit(3);
        }
        std::cout&lt;&lt;"listen success....."&lt;&lt;std::endl;
      }
  
      void Loop()
      {
        struct sockaddr_in peer;
        socklen_t len=sizeof(peer);
        for(;;)
        {
          int sockfd=accept(listen_sock,(struct sockaddr*)&amp;peer,&amp;len);
          if(sockfd&lt;0)
          {                                                                                            
            continue;
          }
          std::string ip=inet_ntoa(peer.sin_addr);
          int port=ntohs(peer.sin_port);
          std::cout&lt;&lt;"get new link ["&lt;&lt;ip&lt;&lt;"] :"&lt;&lt;port&lt;&lt;std::endl;
          pthread_t id;
          Pragma* p=new Pragma(sockfd,ip,port);
          pthread_create(&amp;id,NULL,Routine,p);
        }
      }
  
      static void* Routine(void* arg)
      {
          Pragma* p=(Pragma*)arg;
          pthread_detach(pthread_self());
          Server(p-&gt;sockfd,p-&gt;ip,p-&gt;port);
          close(p-&gt;sockfd);
          delete p;
W&gt;    }                                                                                                
      static void Server(int sockfd,std::string ip,int port)
      {                                                     
        char buffer[1024];
        while(true)       
        {          
          buffer[0]='0';
        int sz=read(sockfd,buffer,sizeof(buffer)-1);
       if(sz&gt;0){
          buffer[sz]='\0';
          std::cout&lt;&lt;ip&lt;&lt;":"&lt;&lt;port&lt;&lt;"#"&lt;&lt;buffer&lt;&lt;std::endl;
        }
        else if(sz==0){
          std::cerr&lt;&lt;"client close"&lt;&lt;std::endl;
          break;
        }
        else{
          break;                                                                                       
        }
        }
        close(sockfd);
      }
      ~TcpServer()
          ~TcpServer()
      {
        if(listen_sock&gt;0)
          close(listen_sock);
      }
  };   


</code></pre> 
<p>Â </p> 
<p><img alt="" height="1134" src="https://images2.imgbox.com/a7/10/L8VcKViS_o.png" width="928"></p> 
<p>Â </p> 
<p>å¤šçº¿ç¨‹æœåŠ¡å™¨ï¼Œå½“ä¸»çº¿ç¨‹æ¥å—è¿æ¥å¤šå°‘ä¸ªå®¢æˆ·ç«¯æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»ºç›¸åº”çš„å­çº¿ç¨‹å»æœåŠ¡å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¸»çº¿ç¨‹å’Œå®¢æˆ·ç«¯ä¸èƒ½éšä¾¿å…³é—­socketæè¿°ç¬¦ï¼Œå› ä¸ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä½¿ç”¨çš„åŒä¸€æ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚Â </p> 
<h3 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0Tcp%E6%9C%8D%E5%8A%A1%E5%99%A8">çº¿ç¨‹æ± æœåŠ¡å™¨</h3> 
<p><strong>çº¿ç¨‹æ± TcpæœåŠ¡å™¨åœ¨æœåŠ¡å™¨å†…åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </strong>ï¼Œåˆå§‹åŒ–çº¿ç¨‹æ± åï¼ŒæœåŠ¡å™¨çš„ä¸»çº¿ç¨‹ä¸æ–­çš„å¾€çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­å¡è¿æ¥è¯·æ±‚ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸æ–­åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥è¯·æ±‚ä»»åŠ¡ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„å¥—æ¥å­—æè¿°ç¬¦ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å°±å¯ä»¥è·Ÿå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚</p> 
<p>çº¿ç¨‹æ± TcpæœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚çš„çº¿ç¨‹æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šéšç€è¿æ¥è¯·æ±‚çš„å¢å¤šè€Œå¯¼è‡´çº¿ç¨‹ä¸æ–­çš„å¢å¤šã€‚</p> 
<p><a class="link-info" href="https://blog.csdn.net/sjp11/article/details/122914857?spm=1001.2014.3001.5501" title="çº¿ç¨‹æ± çš„å®ç°">çº¿ç¨‹æ± çš„å®ç°</a></p> 
<p><img alt="" height="640" src="https://images2.imgbox.com/c3/75/kM0ELx3X_o.png" width="1200"></p> 
<p>Task.hppæ–‡ä»¶</p> 
<pre><code class="language-cpp">#pragma once
#include&lt;iostream&gt;
#include&lt;string&gt;
#include&lt;unistd.h&gt;

class Handler{
    public:
      Handler()
      {}
    void operator()(int sockfd,std::string ip,int port)
    {
      char buffer[1024];                                                                                  
      while(true)
      {
        buffer[0]='0';
      int sz=read(sockfd,buffer,sizeof(buffer)-1);
      if(sz&gt;0){
        buffer[sz]='\0';
        std::cout&lt;&lt;ip&lt;&lt;":"&lt;&lt;port&lt;&lt;"#"&lt;&lt;buffer&lt;&lt;std::endl;
      }
      else if(sz==0){
        std::cerr&lt;&lt;"client close"&lt;&lt;std::endl;
        break;
      }
      else{
        break;
      }
      }
      close(sockfd);
    }
};
</code></pre> 
<p>threadpool.hppå¤´æ–‡ä»¶ï¼ˆçº¿ç¨‹æ± ï¼‰Â </p> 
<pre><code class="language-cpp">#pragma once    
#include&lt;iostream&gt;    
#include&lt;queue&gt;    
#include&lt;pthread.h&gt;    
#include&lt;unistd.h&gt;    
using namespace std;    
     
#define NUM 2                                                                                             
template&lt;class T&gt;    
class ThreadPool    
{    
  private:    
    queue&lt;T&gt; q;//ä»»åŠ¡é˜Ÿåˆ—    
    int thread_num;//çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡    
    pthread_mutex_t lock;//äº’æ–¥é”    
    pthread_cond_t cond;//æ¡ä»¶å˜é‡    
  public:    
    ThreadPool(int num=NUM)//æ„é€ å‡½æ•°    
      :thread_num(num){    
        pthread_mutex_init(&amp;lock,NULL);    
        pthread_cond_init(&amp;cond,NULL);    
    }    
    
    bool Empty()    
    {    
      return q.size()==0?true:false;    
    }    

   static  void* Routine(void* arg)//çº¿ç¨‹æ‰§è¡Œæµ
    {
      pthread_detach(pthread_self());//çº¿ç¨‹åˆ†ç¦»
      ThreadPool* self=(ThreadPool*)arg;
      while(1)
      {
        self-&gt;LockQueue();
        while(self-&gt;Empty())//ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
        {
          self-&gt;Wait();
        }
        T data;
        self-&gt;Pop(data);//å–å‡ºä»»åŠ¡
        self-&gt;UnlockQueue();
        cout&lt;&lt;pthread_self()&lt;&lt;"# "; 
        //å¤„ç†ä»»åŠ¡
        data.Run();//å¤„ç†ä»»åŠ¡
        sleep(1);
      }
    }
   void ThreadPoolInit()
    {
      pthread_t tid;
      for(int i=0;i&lt;thread_num;i++)
      {
        pthread_create(&amp;tid,NULL,Routine,(void*)this);
      }
    }

    void Wait()
    {
      pthread_cond_wait(&amp;cond,&amp;lock);
    }

    void LockQueue()
    {
      pthread_mutex_lock(&amp;lock);
    }

    void UnlockQueue()
    {
      pthread_mutex_unlock(&amp;lock);
    }     
    void Push(const T&amp; in)//å°†ä»»åŠ¡æ¨è¿›ä»»åŠ¡é˜Ÿåˆ—ä¸­
    {                                           
      LockQueue();
      q.push(in); 
      UnlockQueue();
      SignalThread();
    }                
     
    void SignalThread()
    {                  
      pthread_cond_signal(&amp;cond);
    }                            
     
    void Pop( T&amp; out)//å°†ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­åˆ é™¤
    {                                    
      out=q.front();
      q.pop();      
    }         
     
    ~ThreadPool()
    {            
      pthread_mutex_destroy(&amp;lock);
      pthread_cond_destroy(&amp;cond); 
    }                             
};   
                                  
</code></pre> 
<p>Â tcp_server.hpp</p> 
<pre><code class="language-cpp"> #pragma once                                                                                            
  #include&lt;iostream&gt;    
  #include&lt;string.h&gt;    
  #include&lt;arpa/inet.h&gt;    
  #include&lt;netinet/in.h&gt;    
  #include&lt;sys/types.h&gt;    
  #include&lt;sys/socket.h&gt;    
  #include&lt;unistd.h&gt;    
  #include&lt;pthread.h&gt;    
  #include"threadpool.hpp"    
  #include"Task.hpp"    
  class TcpServer    
  {    
    private:    
      int port;    
      int listen_sock;    
      ThreadPool&lt;Task&gt;* pool;    
    public:    
      TcpServer(int _port)    
        :port(_port)    
        ,listen_sock(-1)    
        ,pool(nullptr)    
      {    
      
      }    

    void InitTcpServer()
    {
      listen_sock=socket(AF_INET,SOCK_STREAM,0);//åˆ›å»ºç›‘å¬å¥—æ¥å­—
      if(listen_sock&lt;0)
      {
        std::cerr&lt;&lt;"socket failing"&lt;&lt;std::endl;
        exit(2);
      }
      
      struct sockaddr_in lock;
      lock.sin_family=AF_INET;
      lock.sin_port=htons(port);
      lock.sin_addr.s_addr=INADDR_ANY;

      //ç»‘å®šç›‘å¬å¥—æ¥å­—
      if(bind(listen_sock,(struct sockaddr*)&amp;lock,sizeof(lock))&lt;0)
      {
        std::cerr&lt;&lt;"bind failing"&lt;&lt;std::endl;
        exit(2);
      }
      
      //ç›‘å¬è¿æ¥
      if(listen(listen_sock,5)&lt;0)
      {
        std::cerr&lt;&lt;"listen failing"&lt;&lt;std::endl;
        exit(3);                                                                                       
      }
     std::cout&lt;&lt;"listen success....."&lt;&lt;std::endl;
     pool= new ThreadPool&lt;Task&gt;();//åˆ›å»ºçº¿ç¨‹æ± 
    }

    void Loop()
    {
      pool-&gt;ThreadPoolInit();//åˆå§‹åŒ–çº¿ç¨‹æ± 
      struct sockaddr_in peer;
      socklen_t len=sizeof(peer);
      for(;;)
      {
        //ä¸»çº¿ç¨‹æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥
        int sockfd=accept(listen_sock,(struct sockaddr*)&amp;peer,&amp;len);
        if(sockfd&lt;0)
        {
          continue;
        }

        std::string ip=inet_ntoa(peer.sin_addr);
        int port=ntohs(peer.sin_port);
        std::cout&lt;&lt;"get new link ["&lt;&lt;ip&lt;&lt;"] :"&lt;&lt;port&lt;&lt;std::endl;
        Task t(sockfd,ip,port);//åˆ›å»ºä»»åŠ¡
        pool-&gt;Push(t);//å°†ä»»åŠ¡æ¨åˆ°çº¿ç¨‹æ± ä¸­
      }
    }

    ~TcpServer()
    {
      if(listen_sock&gt;0)                                                                                
        close(listen_sock);
    }
};

</code></pre> 
<h2 id="netstate%E5%91%BD%E4%BB%A4">äº”. netstateå‘½ä»¤</h2> 
<p>netstate å‘½ä»¤ç”¨äºæ˜¾ç¤ºå„ç§ç½‘ç»œç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç½‘ç»œè¿æ¥ï¼Œè·¯ç”±è¡¨ï¼Œæ¥å£çŠ¶æ€ (Interface Statistics)ï¼Œmasquerade è¿æ¥ï¼Œå¤šæ’­æˆå‘˜ (Multicast Memberships) ç­‰ç­‰ã€‚</p> 
<ul><li>-a:æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºLISTEN</li><li>-t(tcp)ï¼šä»…æ˜¾ç¤ºtcpç›¸å…³é€‰é¡¹</li><li>-u(udp):ä»…æ˜¾ç¤ºudpç›¸å…³é€‰é¡¹</li><li>-n:æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæˆæ•°å­—å°±æ˜¾ç¤ºæˆæ•°å­—</li><li>-p:æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå</li><li>-r:æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±è¡¨</li><li>-eï¼šæ˜¾ç¤ºæ‰©å±•ä¿¡æ¯</li><li>-s:æŒ‰å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡</li><li>-cï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæ‰§è¡Œè¯¥netstateå‘½ä»¤</li><li>-l:æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæˆæ•°å­—å°±æ˜¾ç¤ºæˆæ•°å­—</li></ul> 
<p>Â </p> 
<p>Â </p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad8f8eb0c92099516e4a88440aecc010/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Android DataUsage</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bdc84222ca1a2668de7de81e5dd20409/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">è½¬è½½ï¼šæ¨¡å§å³å°†å…³ç«™çš„è¯´æ˜</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 ç¼–ç¨‹éšæƒ³.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>