<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu 18.04配置ORB-SLAM2和ORB-SLAM3运行环境&#43;ROS实时运行ORB-SLAM2&#43;SLAM相关库的安装 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu 18.04配置ORB-SLAM2和ORB-SLAM3运行环境&#43;ROS实时运行ORB-SLAM2&#43;SLAM相关库的安装" />
<meta property="og:description" content="文章目录 一、换源二、安装三方库2.1 安装必要的依赖项2.2 安装Pangolin2.3 安装OpenCV32.4 安装Eigen3 三、安装ORB-SLAM2四、安装ORB-SLAM34.1 安装OpenCV44.2 安装ORB-SLAM3 五、安装ROS Melodic六、ROS安装摄像头驱动七、ROS实时运行ORB-SLAM27.1 相机标定7.2 编译ORB_SLAM2 ROS例子7.3 实时运行ORB-SLAM2 八、安装SLAM测评工具evo8.1 安装evo8.2 测试evo 九、安装PCL和Octomap十、安装优化库：G2O、GTSAM和Ceres十一、安装Sophus 在新安装的Ubuntu 18.04系统中配置ORB-SLAM2和ORB-SLAM3的运行环境，大部分内容与我的另一篇文章Ubuntu 20.04配置ORB-SLAM2和ORB-SLAM3运行环境&#43;ROS实时运行ORB-SLAM2&#43;Gazebo仿真运行ORB-SLAM2&#43;各种相关库的安装一样，本文为其拓展
一、换源 Ubuntu系统自带的源都是国外的网址，国内用户在使用的时候下载比较慢甚至无法获取，在安装各种库或软件时会深受其折磨！解决方案是直接替换成国内的镜像源
（1）备份源文件：
sudo cp /etc/apt/sources.list /etc/apt/sources.list.old
（2）打开文件：
sudo gedit /etc/apt/sources.list
（3）换源：推荐清华的源（根据自己的网去尝试，选择最快的一个，查看ubuntu版本命令：cat /etc/issue）：清华源地址，选择Ubuntu版本并复制源，覆盖sources.list文件原来的内容。
（4）换过源之后要更新：
sudo apt-get update
二、安装三方库 2.1 安装必要的依赖项 sudo apt-get update sudo apt-get install git gcc g&#43;&#43; vim make cmake 2.2 安装Pangolin 安装Pangolin 0.6(稳定版)（官网下载地址，不要下载最新master版，编译的时候可能有错误）
（1）安装依赖项
sudo apt-get install libglew-dev libboost-dev libboost-thread-dev libboost-filesystem-dev sudo apt-get install ffmpeg libavcodec-dev libavutil-dev libavformat-dev libswscale-dev libpng-dev （2）配置并编译" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9d675e1c4488d4e3e49f40a2d24437c0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-05T17:54:49+08:00" />
<meta property="article:modified_time" content="2023-05-05T17:54:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu 18.04配置ORB-SLAM2和ORB-SLAM3运行环境&#43;ROS实时运行ORB-SLAM2&#43;SLAM相关库的安装</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">一、换源</a></li><li><a href="#_21" rel="nofollow">二、安装三方库</a></li><li><ul><li><a href="#21__22" rel="nofollow">2.1 安装必要的依赖项</a></li><li><a href="#22_Pangolin_29" rel="nofollow">2.2 安装Pangolin</a></li><li><a href="#23_OpenCV3_61" rel="nofollow">2.3 安装OpenCV3</a></li><li><a href="#24_Eigen3_94" rel="nofollow">2.4 安装Eigen3</a></li></ul> 
  </li><li><a href="#ORBSLAM2_125" rel="nofollow">三、安装ORB-SLAM2</a></li><li><a href="#ORBSLAM3_170" rel="nofollow">四、安装ORB-SLAM3</a></li><li><ul><li><a href="#41_OpenCV4_171" rel="nofollow">4.1 安装OpenCV4</a></li><li><a href="#42_ORBSLAM3_200" rel="nofollow">4.2 安装ORB-SLAM3</a></li></ul> 
  </li><li><a href="#ROS_Melodic_253" rel="nofollow">五、安装ROS Melodic</a></li><li><a href="#ROS_351" rel="nofollow">六、ROS安装摄像头驱动</a></li><li><a href="#ROSORBSLAM2_442" rel="nofollow">七、ROS实时运行ORB-SLAM2</a></li><li><ul><li><a href="#71__443" rel="nofollow">7.1 相机标定</a></li><li><a href="#72_ORB_SLAM2_ROS_475" rel="nofollow">7.2 编译ORB_SLAM2 ROS例子</a></li><li><a href="#73_ORBSLAM2_517" rel="nofollow">7.3 实时运行ORB-SLAM2</a></li></ul> 
  </li><li><a href="#SLAMevo_526" rel="nofollow">八、安装SLAM测评工具evo</a></li><li><ul><li><a href="#81_evo_528" rel="nofollow">8.1 安装evo</a></li><li><a href="#82_evo_554" rel="nofollow">8.2 测试evo</a></li></ul> 
  </li><li><a href="#PCLOctomap_601" rel="nofollow">九、安装PCL和Octomap</a></li><li><a href="#G2OGTSAMCeres_624" rel="nofollow">十、安装优化库：G2O、GTSAM和Ceres</a></li><li><a href="#Sophus_665" rel="nofollow">十一、安装Sophus</a></li></ul> 
</div> 
<p></p> 
<hr> 
<p><em>在新安装的Ubuntu 18.04系统中配置ORB-SLAM2和ORB-SLAM3的运行环境，大部分内容与我的另一篇文章<a href="https://blog.csdn.net/zardforever123/article/details/125044004?spm=1001.2014.3001.5501">Ubuntu 20.04配置ORB-SLAM2和ORB-SLAM3运行环境+ROS实时运行ORB-SLAM2+Gazebo仿真运行ORB-SLAM2+各种相关库的安装</a>一样，本文为其拓展</em></p> 
<h2><a id="_5"></a>一、换源</h2> 
<p>Ubuntu系统自带的源都是国外的网址，国内用户在使用的时候下载比较慢甚至无法获取，在安装各种库或软件时会深受其折磨！解决方案是直接替换成国内的镜像源<br> （1）备份源文件：</p> 
<blockquote> 
 <p>sudo cp /etc/apt/sources.list /etc/apt/sources.list.old</p> 
</blockquote> 
<p>（2）打开文件：</p> 
<blockquote> 
 <p>sudo gedit /etc/apt/sources.list</p> 
</blockquote> 
<p>（3）换源：推荐清华的源（根据自己的网去尝试，选择最快的一个，查看ubuntu版本命令：cat /etc/issue）：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/" rel="nofollow">清华源地址</a>，选择Ubuntu版本并复制源，覆盖sources.list文件原来的内容。<br> （4）换过源之后要更新：</p> 
<blockquote> 
 <p>sudo apt-get update</p> 
</blockquote> 
<h2><a id="_21"></a>二、安装三方库</h2> 
<h3><a id="21__22"></a>2.1 安装必要的依赖项</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">git</span> gcc g++ <span class="token function">vim</span> <span class="token function">make</span> cmake
</code></pre> 
<h3><a id="22_Pangolin_29"></a>2.2 安装Pangolin</h3> 
<p>安装Pangolin 0.6(稳定版)（<a href="https://github.com/stevenlovegrove/Pangolin/archive/refs/tags/v0.6.zip">官网下载地址</a>，不要下载最新master版，编译的时候可能有错误）<br> （1）安装依赖项</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libglew-dev libboost-dev libboost-thread-dev libboost-filesystem-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ffmpeg libavcodec-dev libavutil-dev libavformat-dev libswscale-dev libpng-dev
</code></pre> 
<p>（2）配置并编译</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> Pangolin 
<span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake -DCPP11_NO_BOOST<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">..</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>（3） 验证</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/examples/HelloPangolin
<span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span>
./HelloPangolin
</code></pre> 
<p>若安装成功，则会弹出以下窗口：</p> 
<p><img src="https://images2.imgbox.com/da/14/dpZN7Veh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_OpenCV3_61"></a>2.3 安装OpenCV3</h3> 
<p>ORB-SLAM2要求至少 2.4.3，作者使用 OpenCV 2.4.11 和 OpenCV 3.2 测试。我测试OpenCV3.4.5和OpenCV3.2.0可行。安装OpenCV-3.4.5（OpenCV老版本可在Github仓库右侧的<a href="https://github.com/opencv/opencv/releases">Releases</a>里找），将文件解压到某个位置，在该文件下打开终端</p> 
<p>注：如果需要装ros melodic，请先装ros，它已经自带了OpenCV3.2.0，这里就不需要安装OpenCV3了，否则后面使用容易版本冲突<br> （1）安装依赖项</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> add-apt-repository <span class="token string">"deb http://security.ubuntu.com/ubuntu xenial-security main"</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential libgtk2.0-dev libavcodec-dev 
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libavformat-dev libjpeg.dev libtiff5.dev 
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libswscale-dev libjasper-dev 
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libcanberra-gtk-module libcanberra-gtk3-module 
<span class="token comment">#或者</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libcanberra-gtk*
</code></pre> 
<p>（2） 配置并编译</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build 
cmake -D <span class="token assign-left variable">CMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release -D <span class="token assign-left variable">CMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr/local <span class="token punctuation">..</span>
<span class="token comment">#电脑性能差可去掉-j4，性能很好可增加数字（线程）</span>
<span class="token function">make</span> -j4
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>（3）查询OpenCV版本、库以及头文件目录的三个命令来确保上面的OpenCV安装步骤都正常：</p> 
<pre><code class="prism language-bash">pkg-config --modversion opencv
pkg-config --cflags opencv
pkg-config --libs   opencv
</code></pre> 
<h3><a id="24_Eigen3_94"></a>2.4 安装Eigen3</h3> 
<p>Eigen3是一个纯头文件的库，这个特点让使用者省去了很多安装和环境配置的麻烦<br> 直接安装：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libeigen3-dev
</code></pre> 
<p>建议源码（<a href="https://github.com/eigenteam/eigen-git-mirror">地址</a>）安装：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> eigen3
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>安装后头文件在：</p> 
<pre><code class="prism language-bash">/usr/local/include/eigen3/
</code></pre> 
<p>移动头文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> -r /usr/local/include/eigen3/Eigen /usr/local/include
</code></pre> 
<h2><a id="ORBSLAM2_125"></a>三、安装ORB-SLAM2</h2> 
<p>（1）解压<a href="https://github.com/raulmur/ORB_SLAM2">源文件</a>，在该文件夹下打开终端：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ORB_SLAM2
<span class="token function">chmod</span> +x build.sh
./build.sh
</code></pre> 
<p>注意系统若硬件不行（线程少），将build.sh里的make -j（默认启用最大线程）修改为make，防止卡死，反之性能很好可增加数字（线程）：如make -j4/j8/jx</p> 
<ul><li>编译时如果有错误：</li></ul> 
<pre><code class="prism language-bash">error: ’usleep’ was not declared <span class="token keyword">in</span> this scope
</code></pre> 
<p>在对应的头文件中加上 ：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
</code></pre> 
<ul><li>出现错误：</li></ul> 
<pre><code class="prism language-bash">error: static assertion failed: std::map must have the same value_type as its allocator
</code></pre> 
<p>把ORB-SLAM2源码目录中include/LoopClosing.h文件中的</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> map<span class="token operator">&lt;</span>KeyFrame<span class="token operator">*</span><span class="token punctuation">,</span>g2o<span class="token double-colon punctuation">::</span>Sim3<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>less<span class="token operator">&lt;</span>KeyFrame<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        Eigen<span class="token double-colon punctuation">::</span>aligned_allocator<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">const</span> KeyFrame<span class="token operator">*</span><span class="token punctuation">,</span> g2o<span class="token double-colon punctuation">::</span>Sim3<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> <span class="token operator">&gt;</span> KeyFrameAndPose<span class="token punctuation">;</span>
</code></pre> 
<p>修改为：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> map<span class="token operator">&lt;</span>KeyFrame<span class="token operator">*</span><span class="token punctuation">,</span>g2o<span class="token double-colon punctuation">::</span>Sim3<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>less<span class="token operator">&lt;</span>KeyFrame<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        Eigen<span class="token double-colon punctuation">::</span>aligned_allocator<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>KeyFrame <span class="token operator">*</span><span class="token keyword">const</span><span class="token punctuation">,</span> g2o<span class="token double-colon punctuation">::</span>Sim3<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> <span class="token operator">&gt;</span> KeyFrameAndPose<span class="token punctuation">;</span>
</code></pre> 
<p>（2）运行单目例子（彩色是因为我修改了代码，源码黑白，不用在意）：</p> 
<blockquote> 
 <p>./Examples/Monocular/mono_tum Vocabulary/ORBvoc.txt Examples/Monocular/TUM2.yaml Data/rgbd_dataset_freburg2_desk</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/84/43/nrKjjtuc_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ORBSLAM3_170"></a>四、安装ORB-SLAM3</h2> 
<h3><a id="41_OpenCV4_171"></a>4.1 安装OpenCV4</h3> 
<p>与20.04不一样，上面如果没有安装OpenCV3而使用ros的，这里就正常安装，而且不用考虑与ros melodic自带的OpenCV3.2.0冲突，安装步骤都一样：<br> （1）安装依赖库：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential cmake <span class="token function">git</span> 
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libgtk2.0-dev pkg-config libavcodec-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libavformat-dev libswscale-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-dev python-numpy python3-dev python3-numpy
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libtbb2 libtbb-dev libjasper-dev libdc1394-22-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libjpeg-dev libpng-dev libtiff-dev
</code></pre> 
<p>（2）编译安装：</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build 
cmake -D <span class="token assign-left variable">CMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr/local -D <span class="token assign-left variable">CMAKE_BUILD_TYPE</span><span class="token operator">=</span><span class="token string">"Rlease"</span> -D <span class="token assign-left variable">OPENCV_GENERATE_PKGCONFIG</span><span class="token operator">=</span>ON <span class="token punctuation">..</span>
<span class="token function">make</span> -j4
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>（3）查询OpenCV版本、库以及头文件目录：</p> 
<pre><code class="prism language-bash">pkg-config --modversion opencv4
pkg-config --cflags opencv4
pkg-config --libs   opencv4
</code></pre> 
<h3><a id="42_ORBSLAM3_200"></a>4.2 安装ORB-SLAM3</h3> 
<p>（1）解压源文件修改CMakeLists.txt，调低make -j x，将find_package(Eigen3 3.1.0 REQUIRED)修改为：</p> 
<pre><code class="prism language-bash">find_package<span class="token punctuation">(</span>Eigen3 REQUIRED<span class="token punctuation">)</span>
</code></pre> 
<p>（2）安装python2.7：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libpython2.7-dev
</code></pre> 
<p>（3）在源文件夹下打开终端：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ORB_SLAM3
<span class="token function">chmod</span> +x build.sh
./build.sh
</code></pre> 
<ul><li>报opensll错误，缺少对应的库，需安装openssl-devel：</li></ul> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libssl-dev
</code></pre> 
<ul><li>报错：x3D=x3D_h.get_minor&lt;3,1&gt;(0,0)/x3D_h(3); error:no match for ’operator/’ ，应该是是重载了这个符号，但是这里直接这样写是不合格的，两个地方提示出错：</li></ul> 
<pre><code class="prism language-bash">/ORB_SLAM3/src/LocalMapping.cc:628:49: error: no match <span class="token keyword">for</span> ‘operator/’
 <span class="token punctuation">(</span>operand types are ‘cv::Matx<span class="token operator">&lt;</span>float, <span class="token number">3</span>, <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>’ and ‘float’<span class="token punctuation">)</span> x3D <span class="token operator">=</span> x3D_h.get_minor<span class="token operator">&lt;</span><span class="token number">3</span>,<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token punctuation">(</span><span class="token number">0,0</span><span class="token punctuation">)</span> / x3D_h<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
/ORB_SLAM3/src/CameraModels/KannalaBrandt8.cpp:534:41: error: no match <span class="token keyword">for</span> ‘operator/’ 
<span class="token punctuation">(</span>operand types are ‘cv::Matx<span class="token operator">&lt;</span>float, <span class="token number">3</span>, <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>’ and ‘float’<span class="token punctuation">)</span> x3D <span class="token operator">=</span> x3D_h.get_minor<span class="token operator">&lt;</span><span class="token number">3</span>,<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token punctuation">(</span><span class="token number">0,0</span><span class="token punctuation">)</span> / x3D_h<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在源码中的这两个地方，将x3D = x3D_h.get_minor&lt;3,1&gt;(0,0) / x3D_h(3)修改为：</p> 
<pre><code class="prism language-cpp">x3D <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Matx31f</span><span class="token punctuation">(</span>x3D_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get_minor</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">x3D_h</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x3D_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get_minor</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">x3D_h</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x3D_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get_minor</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">x3D_h</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>如果因内存不足中断编译进程：</li></ul> 
<pre><code class="prism language-bash">c++: fatal error: Killed signal terminated program cc1plus
</code></pre> 
<p>调大虚拟机内存/创建swap分区，调低make -j x</p> 
<p>（4）运行TUM corridor（Monocular-Inertial）例子：</p> 
<pre><code class="prism language-bash">./Monocular-Inertial/mono_inertial_tum_vi <span class="token punctuation">..</span>/Vocabulary/ORBvoc.txt Monocular-Inertial/TUM_512.yaml dataset-corridor1_512_16/mav0/cam0/data Monocular-Inertial/TUM_TimeStamps/dataset-corridor1_512.txt Monocular-Inertial/TUM_IMU/dataset-corridor1_512.txt dataset-corridor1_512_monoi
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/bf/YAjYhUqy_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ROS_Melodic_253"></a>五、安装ROS Melodic</h2> 
<p>参考文章 <a href="https://ismango.blog.csdn.net/article/details/106049992" rel="nofollow">Ubuntu18.04安装ROS Melodic（详细，亲测安装完成，有清晰的截图步骤）</a><br> （1）添加ROS软件源</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">sh</span> -c <span class="token string">'. /etc/lsb-release &amp;&amp; echo "deb http://mirrors.ustc.edu.cn/ros/ubuntu/ $DISTRIB_CODENAME main" &gt; /etc/apt/sources.list.d/ros-latest.list'</span>
</code></pre> 
<p>（2）添加密钥</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
</code></pre> 
<p>（3）更新软件源</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update
</code></pre> 
<p>出现错误<br> GPG error：http://mirrors.ustc.edu.cn/ros/ubuntu bionic InRelease: 由于没有公钥，无法验证下列签名： NO_PUBKEY F42ED6FBAB17C654</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F42ED6FBAB17C654
</code></pre> 
<p>（4）安装ROS melodic</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ros-melodic-desktop-full
</code></pre> 
<p>（5）初始化rosdep</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python-rosdep
<span class="token function">sudo</span> rosdep init
</code></pre> 
<ul><li>ERROR: cannot download default sources list from:https : //raw.githubusercontent.com/ros/rosdistro/master/rosdep/sources.list.d/20-default.listWebsite may be down.</li></ul> 
<pre><code class="prism language-bash">udo gedit /etc/hosts
</code></pre> 
<p>打开的hosts文件中添加如下的内容，然后保存退出</p> 
<blockquote> 
 <p>185.199.108.133 raw.githubusercontent.com</p> 
</blockquote> 
<p>如果出现ERROR: cannot download default sources list from:<br> https://raw.githubusercontent.com/ros/rosdistro/master/rosdep/sources.list.d/20-default.list<br> Website may be down.<br> 访问 <a href="https://www.ipaddress.com/" rel="nofollow">https://www.ipaddress.com/</a> 查询 raw.githubusercontent.com 的ip地址<br> <img src="https://images2.imgbox.com/67/e9/9IyfMM6v_o.png" alt="在这里插入图片描述"><br> 将199.232.28.133 raw.githubusercontent.com换为：</p> 
<blockquote> 
 <p>185.199.108.133 raw.githubusercontent.com</p> 
</blockquote> 
<ul><li>ERROR: default sources list file already exists: /etc/ros /rosdep/sources.list.d/20-default.listPlease delete if you wish to re-initialize</li></ul> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> /etc/ros/rosdep/sources.list.d/20-default.list
</code></pre> 
<p>然后</p> 
<pre><code class="prism language-bash">rosdep update
</code></pre> 
<p>出现错误ERROR: error loading sources list:(‘The read operation timed out’,)，是网络的问题，换个网好的反复执行rosdep update命令</p> 
<p>（6）安装rosinstall</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python-rosinstall python-rosinstall-generator python-wstool build-essential
</code></pre> 
<p>（7）设置环境变量</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit .bashrc
<span class="token comment"># 末尾添加</span>
<span class="token builtin class-name">source</span> /opt/ros/melodic/setup.bash
<span class="token comment">#保存退出</span>
<span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<p>（8）验证</p> 
<pre><code class="prism language-bash">roscore
</code></pre> 
<ul><li>Command ‘roscore’ not found, but can be installed with:sudo apt install python3-roslaunch，按照提示安装roslaunch</li><li>Resorce not found: roslaunch说明之前的安装没有安装全，继续安装</li></ul> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ros-melodic-desktop-full
</code></pre> 
<p>（9）测试ROS：</p> 
<pre><code class="prism language-bash">roecore
rosrun turtlesim turtlesim_node
rosrun turtlesim turtle_teleop_key
</code></pre> 
<p>激活第三个窗口的情况下，通过上下左右键控制小乌龟运动<br> <img src="https://images2.imgbox.com/1c/0d/SwrJFfkI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ROS_351"></a>六、ROS安装摄像头驱动</h2> 
<p>1）创建一个catkin工作空间：</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> -p ~/catkin_ws/src
</code></pre> 
<p>（2）编译工作空间：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ~/catkin_ws/
catkin_make
</code></pre> 
<p>（3）配置环境</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> ~/catkin_ws/devel/setup.bash
</code></pre> 
<p>（4）下载摄像头<a href="https://github.com/ros-drivers/usb_cam">功能包源码</a>，将功能包解压到~/catkin_ws/src下<br> （5）重新编译工作空间并配置环境<br> （6）测试usb摄像头<br> 打开新终端，，运行/catkin_ws/src/usb_cam-develop/launch下的launch文件usb_cam-test.launch：</p> 
<pre><code class="prism language-bash">roslaunch usb_cam usb_cam-test.launch
</code></pre> 
<p><img src="https://images2.imgbox.com/70/fa/IVH1yGqw_o.png" alt="在这里插入图片描述"></p> 
<p>再打开一个窗口输入rqt_graph查看消息，看到usb_cam节点向/usb_cam/image_raw发布了消息，image_view订阅了该消息，消息内容即为图像帧，由image_view显示</p> 
<ul><li>报错：</li></ul> 
<pre><code class="prism language-bash">RLException: <span class="token punctuation">[</span>usb_cam-test.launch<span class="token punctuation">]</span> is neither a launch <span class="token function">file</span> <span class="token keyword">in</span> package <span class="token punctuation">[</span>usb_cam<span class="token punctuation">]</span> nor is <span class="token punctuation">[</span>usb_cam<span class="token punctuation">]</span> a launch <span class="token function">file</span> name
The traceback <span class="token keyword">for</span> the exception was written to the log <span class="token function">file</span>
</code></pre> 
<p>未配置环境：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> ~/catkin_ws/devel/setup.bash
</code></pre> 
<p>为了省去每次配置，将这句添加到 ~/.bashrc 文件中</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit ~/.bashrc
</code></pre> 
<p>保存退出，执行：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<ul><li>摄像头图像花屏<br> 摄像头的默认像素格式是mjpeg格式的，launch文件中定义的像素格式是yuyv格式的（第六行），将其修改为mjpeg</li></ul> 
<p><img src="https://images2.imgbox.com/86/57/AY61mrhI_o.png" alt="在这里插入图片描述"></p> 
<p>但是此时终端中会提示警告</p> 
<pre><code class="prism language-bash">eprecated pixel <span class="token function">format</span> used, <span class="token function">make</span> sure you did <span class="token builtin class-name">set</span> range correctly
</code></pre> 
<p>然后在usb_cam-develop源码src文件中找到usb_cam.cpp文件447行，video_sws_ = sws_getContext…之前添加：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
    AVPixelFormat pixFormat<span class="token punctuation">;</span>
    switch <span class="token punctuation">(</span>avcodec_context_-<span class="token operator">&gt;</span>pix_fmt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> AV_PIX_FMT_YUVJ420P <span class="token builtin class-name">:</span>
        pixFormat <span class="token operator">=</span> AV_PIX_FMT_YUV420P<span class="token punctuation">;</span>
        <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> AV_PIX_FMT_YUVJ422P  <span class="token builtin class-name">:</span>
        pixFormat <span class="token operator">=</span> AV_PIX_FMT_YUV422P<span class="token punctuation">;</span>
        <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> AV_PIX_FMT_YUVJ444P   <span class="token builtin class-name">:</span>
        pixFormat <span class="token operator">=</span> AV_PIX_FMT_YUV444P<span class="token punctuation">;</span>
        <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> AV_PIX_FMT_YUVJ440P <span class="token builtin class-name">:</span>
        pixFormat <span class="token operator">=</span> AV_PIX_FMT_YUV440P<span class="token punctuation">;</span>
        <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    default:
        pixFormat <span class="token operator">=</span> avcodec_context_-<span class="token operator">&gt;</span>pix_fmt<span class="token punctuation">;</span>
        <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    avcodec_context_-<span class="token operator">&gt;</span>pix_fmt <span class="token operator">=</span> pixFormat<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>重新编译工作空间并配置环境</p> 
<h2><a id="ROSORBSLAM2_442"></a>七、ROS实时运行ORB-SLAM2</h2> 
<h3><a id="71__443"></a>7.1 相机标定</h3> 
<p>相机的标定可以使用MATLAB工具箱和其他工具包，或者我最常用的编写程序调用OpenCV标定，这里使用ros标定</p> 
<pre><code class="prism language-bash"><span class="token comment">#noetic摄像头标定工具安装</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ros-melodic-camera-calibration
<span class="token comment">#启动摄像头</span>
roslaunch usb_cam usb_cam-test.launch
<span class="token comment">#新开一个终端，开始标定</span>
rosrun camera_calibration cameracalibrator.py --size 10x7 --square <span class="token number">0.0085</span> image:<span class="token operator">=</span>/usb_cam/image_raw camera:<span class="token operator">=</span>/usb_cam --k-coefficients<span class="token operator">=</span><span class="token number">4</span>
</code></pre> 
<p>cameracalibrator.py 标定程序需要以下几个输入参数：<br> –size为棋盘格的规格（内部角点行列个数），<br> –square为棋盘格的大小（棋盘格的边长，单位是m），<br> image:=指定了图像的TOPIC，<br> –k-coefficients为畸变模型参数个数，<br> camera:=/usb_cam摄像头<br> –no-service-check禁用<br> set_camera_info检查服务</p> 
<p>按照x（左右）、y（上下）、size（前后）、skew（倾斜）等方式移动棋盘，直到x,y,size,skew的进度条都变成绿色位置。<br> 我这里用手机大致测了一下，–size 10x7 --square 0.0085，最好用正常的标定板</p> 
<p><img src="https://images2.imgbox.com/f4/8c/eBQAOXX0_o.png" alt="在这里插入图片描述"></p> 
<p>都变成绿色位置了就按下CALIBRATE按钮，等一段时间就可以完成标定。<br> 完成后点击SAVE保存标定使用的图像以及标定结果，会显示保存地址，可以打开查看，然后再COMMIT退出程序，标定完成。</p> 
<p><img src="https://images2.imgbox.com/03/a9/I1rvhR3D_o.png" alt="在这里插入图片描述"></p> 
<p>找到标定结果文件后，按照其数据修改Examples/ROS/ORB_SLAM2目录下Asus.yaml。</p> 
<h3><a id="72_ORB_SLAM2_ROS_475"></a>7.2 编译ORB_SLAM2 ROS例子</h3> 
<p>与20.04不同的是不需要考虑OpenCV版本，将ORB_SLAM2源码文件夹复制到~/catkin_ws/src文件夹下，在ORB_SLAM2文件夹下打开终端<br> （1）修改ros示例源文件<br> 为Examples/ROS/ORB_SLAM2/src路径下的所有.cc文件添加头文件</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
</code></pre> 
<p>将单目ros_mono.cc和ros_mono_ar.cc文件的订阅:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//单目</span>
ros<span class="token double-colon punctuation">::</span>Subscriber sub <span class="token operator">=</span> nodeHandler<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"/camera/image_raw"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ImageGrabber<span class="token double-colon punctuation">::</span>GrabImage<span class="token punctuation">,</span><span class="token operator">&amp;</span>igb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>替换为：</p> 
<pre><code class="prism language-cpp">ros<span class="token double-colon punctuation">::</span>Subscriber sub <span class="token operator">=</span> nodeHandler<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"/usb_cam/image_raw"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ImageGrabber<span class="token double-colon punctuation">::</span>GrabImage<span class="token punctuation">,</span><span class="token operator">&amp;</span>igb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（2）编译</p> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> +x build.sh build_ros.sh
./build.sh
</code></pre> 
<p>由于ORBSLAM2中设置了rosbuild_init()，因此，直接在~/.bashrc上配置环境：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:'</span><span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/Examples/ROS"</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
<span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<p>编译ros节点:</p> 
<pre><code class="prism language-bash">./build_ros.sh
</code></pre> 
<ul><li>遇到错误：<br> /usr/bin/ld: CMakeFiles/Stereo.dir/src/ros_stereo.cc.o: undefined reference to symbol ‘_ZN5boost6system15system_categoryEv’<br> 在ros的CMakeListst.txt链接的库中添加：-lboost_system<br> <img src="https://images2.imgbox.com/e7/44/PDFq5vrM_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="73_ORBSLAM2_517"></a>7.3 实时运行ORB-SLAM2</h3> 
<pre><code class="prism language-bash"><span class="token comment">#打开摄像头（可将launch文件的图像显示节点删除）</span>
roslaunch usb_cam usb_cam-test.launch
<span class="token comment">#ORB_SLAM2目录下打开终端，运行ORB-SLAM2，参数文件Asus.yaml是测试摄像头标定的</span>
rosrun ORB_SLAM2 Mono Vocabulary/ORBvoc.txt Examples/ROS/ORB_SLAM2/Asus.yaml
</code></pre> 
<p><img src="https://images2.imgbox.com/5f/fe/6r5ZlIw4_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="SLAMevo_526"></a>八、安装SLAM测评工具evo</h2> 
<p>evo是一个很好的测评工具，它可以根据时间戳将轨迹进行对齐，同时可以将不同尺度的轨迹按照你指定的标准轨迹进行拉伸对齐，并可以算出均方差等评定参数，用于测评slam算法性能</p> 
<h3><a id="81_evo_528"></a>8.1 安装evo</h3> 
<p>（1）安装pip：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python-pip
<span class="token comment">#or</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-pip
</code></pre> 
<p>（2）直接安装：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> evo --upgrade --no-binary evo --user
<span class="token comment">#或加速：</span>
pip <span class="token function">install</span> evo --upgrade --no-binary evo --user -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>（3）<a href="https://github.com/MichaelGrupp/evo">源码</a>安装：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> evo
pip <span class="token function">install</span> --editable <span class="token builtin class-name">.</span> --upgrade --no-binary evo --user
</code></pre> 
<p>这样会很慢，可以通过国内镜像加速，在pip 语句后面增加指定源路径，如下</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> --editable <span class="token builtin class-name">.</span> --upgrade --no-binary evo --user -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<h3><a id="82_evo_554"></a>8.2 测试evo</h3> 
<p>（1） 轨迹绘制evo_traj</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> test/data
evo_traj kitti KITTI_00_ORB.txt KITTI_00_SPTAM.txt --ref<span class="token operator">=</span>KITTI_00_gt.txt  -va -p --plot_mode<span class="token operator">=</span>xz --save_plot <span class="token punctuation">..</span>/data/image
</code></pre> 
<p>其中kitti是数据格式、ref是参考轨迹（可省）、-va是对齐后的详细信息，-v表示verbose mode，详细模式，-a表示采用SE(3) Umeyama对齐，不加-s表示默认尺度对齐参数为1.0，即不进行尺度对齐（可省）、-p是画出图像，也可以使用–plot_mode {xy,xz,yx,yz,zx,zy,xyz}来选择单独绘制某个平面的信息（可省）、–save_plot “保存的路径”+文件名 保存图片（可省）</p> 
<p>首次运行若遇到：evo_traj:command not found，重启电脑。</p> 
<p><img src="https://images2.imgbox.com/72/c5/UjU3gRDH_o.png" alt="在这里插入图片描述"></p> 
<p>（2）绝对位姿误差的计算evo_ape</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> results
evo_ape kitti KITTI_00_gt.txt KITTI_00_ORB.txt -va --plot --plot_mode<span class="token operator">=</span>xz --save_results results/ORB.zip
</code></pre> 
<p>使用ape的时候无需给出–ref 的文件，第一个文件即为标准文件， --save_results results/ORB.zip为保存结果及路径（可省）</p> 
<p><img src="https://images2.imgbox.com/66/a8/k1dcaPXt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/a7/kyz5wD3I_o.png" alt="在这里插入图片描述"></p> 
<p>（3）相对位姿误差的计算evo_rpe:其使用方法与ape基本一致<br> （4）处理一个指标的多个结果: evo_res可用于比较来自同样指标的多个结果文件, 包括打印信息和统计信息（默认），绘制结果，将统计信息保存在表中。将上面产生的压缩文件生成图表和表格</p> 
<pre><code class="prism language-bash">evo_ape kitti KITTI_00_gt.txt KITTI_00_SPTAM.txt -va --plot --plot_mode xz --save_results results/SPTAM.zip
evo_res results/*.zip -p --save_table results/table.csv
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/d1/9lqXqC9f_o.png" alt="在这里插入图片描述"></p> 
<p>（5）数据集格式转换</p> 
<pre><code class="prism language-bash">evo_traj euroc V102_groundtruth.csv --save_as_tum
evo_traj tum V102_groundtruth.tum --save_as_kitti
</code></pre> 
<p>将文件保存为其他类型的文件，可以使用如下句柄</p> 
<pre><code class="prism language-bash">--save_as_tum         save trajectories <span class="token keyword">in</span> TUM <span class="token function">format</span> <span class="token punctuation">(</span>as *.tum<span class="token punctuation">)</span>
--save_as_kitti          save poses <span class="token keyword">in</span> KITTI <span class="token function">format</span> <span class="token punctuation">(</span>as *.kitti<span class="token punctuation">)</span>
--save_as_bag         save trajectories <span class="token keyword">in</span> ROS bag as <span class="token operator">&lt;</span>date<span class="token operator">&gt;</span>.bag
</code></pre> 
<p>没有–save_as_euroc选项，因为EuRoC格式仅对EuRoC数据集的基本事实有意义</p> 
<h2><a id="PCLOctomap_601"></a>九、安装PCL和Octomap</h2> 
<p>在ubuntu18.04之后，安装pcl和octomap只需两行命令（若遇到问题，首先考虑是否已经换源）：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 这样安装的pcl版本为1.8.1</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libpcl-dev pcl-tools
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> liboctomap-dev octovis
</code></pre> 
<p>（1）使用pcl-tools命令pcl_viewer查看.pcd点云文件：</p> 
<pre><code class="prism language-bash">pcl_viewer map.pcd
</code></pre> 
<p><img src="https://images2.imgbox.com/af/69/XnuwV6fv_o.png" alt="在这里插入图片描述"></p> 
<p>（2）使用octovis查看八叉树点云文件：</p> 
<pre><code class="prism language-bash">octovis octomap.bt
</code></pre> 
<p><img src="https://images2.imgbox.com/84/be/swp79IXa_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="G2OGTSAMCeres_624"></a>十、安装优化库：G2O、GTSAM和Ceres</h2> 
<p>GTSAM和Ceres的安装参考<a href="https://blog.csdn.net/zardforever123/article/details/125570551?spm=1001.2014.3001.5501">Ubuntu20.04下运行LOAM系列：A-LOAM、LeGO_LOAM、LIO-SAM 和 LVI-SAM</a>，下面安装G2O，首先安装依赖：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libeigen3-dev libsuitesparse-dev qtdeclarative5-dev qt5-qmake
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libqglviewer-dev-qt5 libsuitesparse-dev
</code></pre> 
<p>下载源码：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/RainerKuemmerle/g2o.git
</code></pre> 
<p>编译安装：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> g2o
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>（1）如果报cmake版本问题，将cmake要求最小版本改为3.10<br> （2）如果Could NOT find QGLVIEWER (missing: QGLVIEWER_LIBRARY) ，修改g2o/cmake_modules里面的 FindQGLViewer.cmake文件，让cmake能够找到它。就是在find_library(QGLVIEWER_LIBRARY_RELEASE）和find_library(QGLVIEWER_LIBRARY_DEBUG)中添加下QGLViewer-qt5：</p> 
<p><img src="https://images2.imgbox.com/bb/54/docttFtP_o.png" alt="请添加图片描述"></p> 
<p>运行高翔十四讲例子：</p> 
<p><img src="https://images2.imgbox.com/bb/36/XZ2rQUuh_o.png" alt="在这里插入图片描述"></p> 
<p>（1）编译报错<br> /usr/local/include/g2o/core/base_fixed_sized_edge.h:38:10: fatal error: ceres/internal/fixed_array.h: No such file or directory<br> #include &lt;ceres/internal/fixed_array.h&gt;<br> 先安装Ceres<br> （2）error while loading shared libraries: libg2o_core.so: cannot open shared object file: No such file or directory<br> sudo gedit /etc/ld.so.conf打开配置文件，添加一行include /usr/local/lib，保存退出。然后输入sudo ldconfig回车使配置生效<br> （3）usr/local/include/g2o/core/base_fixed_sized_edge.h:174:32: error: ‘index_sequence’ is not a member of ‘std’<br> 174 | struct HessianTupleType&lt;std::index_sequence&lt;Ints…&gt;&gt;<br> 解决方法：在Cmakelists中更新至c++14</p> 
<h2><a id="Sophus_665"></a>十一、安装Sophus</h2> 
<p>安装基于模板的Sophus库，基于模板的Sophus库与Eigen一样仅含有头文件，并且Sophus库是在Eigen基础上开发的，继承了Eigen库中的定义的各个类。因此要先安装Eigen，这里基于上述安装的Eigen3.4.0</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/strasdat/Sophus.git
<span class="token builtin class-name">cd</span> Sophus
<span class="token function">mkdir</span> build 
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<ul><li>cmake错误：<br> Could not find a package configuration file provided by “fmt” with any of the following names： fmtConfig.cmake fmt-config.cmake<br> 解决办法，安装fmt库：</li></ul> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/fmtlib/fmt.git
<span class="token builtin class-name">cd</span> <span class="token function">fmt</span>
<span class="token function">mkdir</span> build 
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<ul><li>报错：</li></ul> 
<pre><code class="prism language-bash">error: implicitly-declared ‘Eigen::Map<span class="token operator">&lt;</span>Sophus::SO<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>double<span class="token operator">&gt;</span> <span class="token operator">&gt;</span>::Map<span class="token punctuation">(</span>const Eigen::Map<span class="token operator">&lt;</span>Sophus::SO<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>double<span class="token operator">&gt;</span> <span class="token operator">&gt;&amp;</span><span class="token punctuation">)</span>’ is deprecated <span class="token punctuation">[</span>-Werror<span class="token operator">=</span>deprecated-copy<span class="token punctuation">]</span>
   Eigen::Map<span class="token operator">&lt;</span>SO2Type<span class="token operator">&gt;</span> shallow_copy <span class="token operator">=</span> map_of_so2<span class="token punctuation">;</span>
</code></pre> 
<p>在CMakeLists.txt里# Add local path for finding packages, set the local version first之前加：</p> 
<pre><code class="prism language-bash">set<span class="token punctuation">(</span>CMAKE_CXX_FLAGS <span class="token string">"-Wno-error=deprecated-declarations -Wno-deprecated-declarations "</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行高翔十四讲例子：</p> 
<p><img src="https://images2.imgbox.com/17/e9/hf6HInHo_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/723802be469dff513136e5e6b803d3b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iis站点预加载-发布站点后，自动预热</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d375eb3144c41a1c3cdfd6e037c3ab32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio Unsupported Java</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>