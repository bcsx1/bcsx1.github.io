<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深聊性能测试，从入门到放弃之：Locust性能自动化(二)代码实战 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深聊性能测试，从入门到放弃之：Locust性能自动化(二)代码实战" />
<meta property="og:description" content="Locust代码实战 1. 引言2. Locust实例展示2.1 官网代码示例2.2 Locust 代码模板及执行顺序 3. Locust 类代码分析3.1 实例代码展示3.2 classTaskSet 用法及展示3.2.1 定义3.2.2 代码展示 4. Locust高级用法4.1 关联4.2 参数化4.2.1 聊一聊参数化4.2.2 三个场景认识参数化 4.3 检查点 5. Locust运行模式5.1 单进程运行模式5.1.1 定义及解析5.1.2 有Web UI模式5.1.3 无Web UI模式5.1.4 启动locust 5.2 多进程分布式运行5.2.1 master启动5.2.2 slave 启动 6. Locust 结果分析 1. 引言 在本章节，你可以学习到：
1、Locust代码实例展示及解读：
①官网代码示例
②demo模板代码
3、Loucst的高级用法：
①关联
②参数化
③检查点
4、Locust的运行模式：
①单进程运行模式
②多进程分布式运行
5、Locust界面展示及结果分析
2. Locust实例展示 2.1 官网代码示例 我们来看看官网的第一个例子，
很简单：
# -*- coding: utf-8 -*- &#34;&#34;&#34; @ auth : carl_DJ @ time : 2020-9-23 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/67ddd480abe89266601cb04d4402327f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-23T12:20:30+08:00" />
<meta property="article:modified_time" content="2020-09-23T12:20:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深聊性能测试，从入门到放弃之：Locust性能自动化(二)代码实战</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Locust代码实战</h4> 
 <ul><li><a href="#1__1" rel="nofollow">1. 引言</a></li><li><a href="#2_Locust_14" rel="nofollow">2. Locust实例展示</a></li><li><ul><li><a href="#21__15" rel="nofollow">2.1 官网代码示例</a></li><li><a href="#22_Locust__55" rel="nofollow">2.2 Locust 代码模板及执行顺序</a></li></ul> 
  </li><li><a href="#3_Locust__127" rel="nofollow">3. Locust 类代码分析</a></li><li><ul><li><a href="#31__128" rel="nofollow">3.1 实例代码展示</a></li><li><a href="#32_classTaskSet__199" rel="nofollow">3.2 classTaskSet 用法及展示</a></li><li><ul><li><a href="#321__200" rel="nofollow">3.2.1 定义</a></li><li><a href="#322__222" rel="nofollow">3.2.2 代码展示</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4_Locust_272" rel="nofollow">4. Locust高级用法</a></li><li><ul><li><a href="#41__273" rel="nofollow">4.1 关联</a></li><li><a href="#42__334" rel="nofollow">4.2 参数化</a></li><li><ul><li><a href="#421__335" rel="nofollow">4.2.1 聊一聊参数化</a></li><li><a href="#422__346" rel="nofollow">4.2.2 三个场景认识参数化</a></li></ul> 
   </li><li><a href="#43__488" rel="nofollow">4.3 检查点</a></li></ul> 
  </li><li><a href="#5_Locust_523" rel="nofollow">5. Locust运行模式</a></li><li><ul><li><a href="#51__526" rel="nofollow">5.1 单进程运行模式</a></li><li><ul><li><a href="#511__527" rel="nofollow">5.1.1 定义及解析</a></li><li><a href="#512__Web_UI_541" rel="nofollow">5.1.2 有Web UI模式</a></li><li><a href="#513__Web_UI_557" rel="nofollow">5.1.3 无Web UI模式</a></li><li><a href="#514__locust_570" rel="nofollow">5.1.4 启动locust</a></li></ul> 
   </li><li><a href="#52__582" rel="nofollow">5.2 多进程分布式运行</a></li><li><ul><li><a href="#521_master_584" rel="nofollow">5.2.1 master启动</a></li><li><a href="#522_slave__595" rel="nofollow">5.2.2 slave 启动</a></li></ul> 
  </li></ul> 
  </li><li><a href="#6_Locust__613" rel="nofollow">6. Locust 结果分析</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__1"></a>1. 引言</h2> 
<p>在本章节，你可以学习到：<br> 1、<strong>Locust代码实例展示及解读</strong>：<br> ①官网代码示例<br> ②demo模板代码<br> 3、<strong>Loucst的高级用法</strong>：<br> ①关联<br> ②参数化<br> ③检查点<br> 4、<strong>Locust的运行模式</strong>：<br> ①单进程运行模式<br> ②多进程分布式运行<br> 5、<strong>Locust界面展示及结果分析</strong></p> 
<h2><a id="2_Locust_14"></a>2. Locust实例展示</h2> 
<h3><a id="21__15"></a>2.1 官网代码示例</h3> 
<p>我们来看看官网的第一个例子，<br> 很简单：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>

<span class="token keyword">from</span> locust <span class="token keyword">import</span> HttpUser<span class="token punctuation">,</span> between<span class="token punctuation">,</span> task

<span class="token keyword">class</span> <span class="token class-name">WebsiteUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment">#设置等待时间间隔</span>
    wait_time <span class="token operator">=</span> between<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"test_user"</span><span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    @task
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/static/assets.js"</span><span class="token punctuation">)</span>
        
    @task
    <span class="token keyword">def</span> <span class="token function">about</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/about/"</span><span class="token punctuation">)</span>

</code></pre> 
<p>这里有几点说一下：<br> 1、<strong>between</strong>： 设置等待时间， 5s~15s；<br> 2、<strong>client.get/ client.post</strong>： 用法跟request是一样的。<br> 其他的就没有什么可以重点强调的！</p> 
<h3><a id="22_Locust__55"></a>2.2 Locust 代码模板及执行顺序</h3> 
<p>这段代码，小鱼展示<strong>两点</strong>：<br> <strong>1、locust demo模板；<br> 2、locust 代码执行顺序</strong>。</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> HttpUser<span class="token punctuation">,</span>TaskSet<span class="token punctuation">,</span>task
<span class="token triple-quoted-string string">'''
执行顺序：
Locust setup → TaskSet setup → TaskSet on_start → 
TaskSet tasks → TaskSet on_stop → TaskSet teardown → 
Locust teardown
'''</span>

<span class="token keyword">class</span> <span class="token class-name">UserBehavor</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#启动locust是运行setup方法</span>
    <span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'task setup'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">teardown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'task teardown'</span><span class="token punctuation">)</span>

    <span class="token comment">#虚拟用户启动task时运行</span>
    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>

    <span class="token comment">#虚拟用户结束task时运行</span>
    <span class="token keyword">def</span> <span class="token function">on_stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/profile'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">WebsitUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'locust setup'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">teardown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'locust teardown'</span><span class="token punctuation">)</span>

    host <span class="token operator">=</span> <span class="token string">'http://xxx.com'</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>UserBehavor<span class="token punctuation">)</span>
    min_wait <span class="token operator">=</span> <span class="token number">100</span>
    max_wait <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


</code></pre> 
<p>虽然小鱼展示了模板，可以直接使用，但是，里面的内容，需要各位大佬自己填充~~<br> 毕竟 业务不同，填充的内容也不一样！！</p> 
<p>小屌丝：鱼哥，感觉你在开车，但是没证据！！<br> 小鱼：都快一点了，你还不睡觉，白富美不香吗！！！<br> 小屌丝：…</p> 
<h2><a id="3_Locust__127"></a>3. Locust 类代码分析</h2> 
<h3><a id="31__128"></a>3.1 实例代码展示</h3> 
<p>关于locust类的详细讲解，放在了第一章节，因为<br> 小鱼觉得：先了解基础，再去看代码，这样就不至于看代码想看天书，至少遇到一个类，能有一个印象。</p> 
<p>这里，为了方便大家，点击下方<strong>带颜色的</strong>文字即可进入第一章节：</p> 
<p><a href="https://blog.csdn.net/wuyoudeyuer/article/details/108596264"><strong>《深聊性能测试，从入门到放弃之：Locust性能自动化(一)初识Locust》</strong></a></p> 
<p>回归正题，老规矩，先上代码，再逐层分析</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>

<span class="token keyword">from</span> locust <span class="token keyword">import</span> HttpUser<span class="token punctuation">,</span>task<span class="token punctuation">,</span>TaskSet
<span class="token triple-quoted-string string">'''
在版本10.1，已经不再使用HttpLocust 和Locust，
取而代之的是HttpUser 和User
'''</span>

<span class="token comment"># 定义ScriptTasks类，继承TaskSet类</span>
<span class="token keyword">class</span> <span class="token class-name">ScriptTasks</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#初始化，每个locust用户开始做的第一件事</span>
    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#放置 用户名和密码</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"carl_dj"</span><span class="token punctuation">,</span>
        <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">'111111'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">#@task()装饰的方法为一个事务，方法的参数用于指定该行为的执行权重，参数越大每次被虚拟用户执行的概率越高，默认为1</span>
    @task<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment">#创建index方法，</span>
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">about</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#self.client 属性使用python的request库的方法，调用和使用方法和request一样</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/demo'</span><span class="token punctuation">,</span> data <span class="token operator">=</span> payload<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>

<span class="token comment">#TaskSet类，该类定义用户任务信息(模拟用户信息)，</span>
<span class="token keyword">class</span> <span class="token class-name">WebsitUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#指向一个定义的用户行为</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>ScriptTasks<span class="token punctuation">)</span>
    <span class="token comment">#被测系统的host，</span>
    host <span class="token operator">=</span> <span class="token string">'http://www.xxxxxx.com'</span>
    <span class="token comment">#每个用户执行两个任务间隔时间最小值，单位是（毫秒，默认是1000ms）</span>
    min_wait <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token comment"># 每个用户执行两个任务间隔时间最大值，单位是（毫秒）</span>
    max_wait <span class="token operator">=</span> <span class="token number">5000</span>


</code></pre> 
<p>这里小鱼在强调一次：<br> 1、关于 <strong>HttpUser</strong> 和<strong>User</strong>的使用， 在版本10.1之后，就需要换成HttpUser 和 User，否则报错；<br> &gt;&gt;&gt;因为小鱼发现，很多网站的大佬都在使用HttpLocust 和Locust，如果你的Locust 版本是 9.x或者8.x，可以使用，不做强要求。</p> 
<h3><a id="32_classTaskSet__199"></a>3.2 classTaskSet 用法及展示</h3> 
<h4><a id="321__200"></a>3.2.1 定义</h4> 
<p>1、<strong>TaskSet类实现了虚拟用户所执行任务的调度算法</strong>，包括：<br> ①规划任务执行顺序：schedule_task；<br> ②挑选下一个任务：execute_next_task；<br> ③执行任务：execute_task；<br> ④休眠等待：wait；<br> ⑤中断控制：interrupt；</p> 
<p>2、在1的基础上，就可以<strong>在TaskSet子类中进行以下操作</strong>：<br> ①描述虚拟用户的业务测试场景；<br> ②对虚拟用户的所有行为进行组织和描述；<br> ③对不同任务的权重进行配置；</p> 
<p>3、 <strong>@task</strong><br> ①通过@task()装饰的方法为一个事务。<br> &gt;&gt;&gt;参数越大每次被虚拟用户执行的概率越高，默认是1。</p> 
<p>4、<strong>TaskSet子类中</strong>采用<strong>2</strong>种方式<strong>定义任务信息</strong>：<br> ① @task<br> ② tasks属性</p> 
<h4><a id="322__222"></a>3.2.2 代码展示</h4> 
<p>1、<strong>采用@task装饰器定义任务信息</strong>：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> task<span class="token punctuation">,</span>TaskSet
<span class="token keyword">class</span> <span class="token class-name">UserBehav</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @task<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_case1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/testcase1"</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_case2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/testcase2"</span><span class="token punctuation">)</span>
</code></pre> 
<p>2、<strong>采用tasks属性定义任务信息</strong>：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>

<span class="token keyword">from</span> locust <span class="token keyword">import</span> TaskSet

<span class="token keyword">def</span> <span class="token function">test_case1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/testcase1"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test_case2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/testcase2"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">UserBehav</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tasks <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>test_case1<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>test_case2<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">}</span>
    <span class="token comment">#另一种写法</span>
    <span class="token comment"># tasks = [(test_job1,1), (test_job1,3)]</span>

</code></pre> 
<p>上面的代码，没有什么难度，这里就不做解释。</p> 
<h2><a id="4_Locust_272"></a>4. Locust高级用法</h2> 
<h3><a id="41__273"></a>4.1 关联</h3> 
<p>做过接口或者爬虫的的大佬都知道，传参是必不可少的，<br> 而常见的场景有session_id。<br> 对于返回的html页面，可用采用lxml库来定位获取需要的参数。</p> 
<p>我们先上代码</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>

<span class="token keyword">from</span> locust <span class="token keyword">import</span> HttpUser<span class="token punctuation">,</span>task<span class="token punctuation">,</span>TaskSet
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token keyword">class</span> <span class="token class-name">WebsitTasks</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment">#获取session</span>
    <span class="token keyword">def</span> <span class="token function">get_session</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>html<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tags <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
        <span class="token keyword">return</span> tags<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"输入标签需要定位的到元素"</span><span class="token punctuation">)</span>
    <span class="token comment">#启动</span>
    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        html <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>
        session <span class="token operator">=</span> self<span class="token punctuation">.</span>get_session<span class="token punctuation">(</span>html<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token comment">#设置payload参数</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'carl_dj'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'111111'</span><span class="token punctuation">,</span>
            <span class="token string">'session'</span><span class="token punctuation">:</span>session

        <span class="token punctuation">}</span>
        <span class="token comment">#设置header参数</span>
        header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36"</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span>data <span class="token operator">=</span> payload<span class="token punctuation">,</span>headers <span class="token operator">=</span> header<span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>

    @task<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span>  <span class="token function">about</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>about<span class="token punctuation">(</span><span class="token string">'/about/'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">WebsiteUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 被测系统的host，在终端中启动locust时没有指定--host参数时才会用到</span>
    host     <span class="token operator">=</span> <span class="token string">"http://www.xxx.com/user/login"</span>
    <span class="token comment"># TaskSet类，该类定义用户任务信息，必填。这里就是:WebsiteTasks类名,因为该类继承TaskSet；</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>WebsiteTasks<span class="token punctuation">)</span>
    <span class="token comment"># 每个用户执行两个任务间隔时间的上下限（毫秒）,具体数值在上下限中随机取值，若不指定默认间隔时间固定为1秒</span>
    min_wait <span class="token operator">=</span> <span class="token number">5000</span>
    max_wait <span class="token operator">=</span> <span class="token number">15000</span>


</code></pre> 
<p>嗯，详细的内容都在代码中标注，这里就不再重新唠叨。</p> 
<h3><a id="42__334"></a>4.2 参数化</h3> 
<h4><a id="421__335"></a>4.2.1 聊一聊参数化</h4> 
<p>老话说的好：<strong>代码写死一时爽，框架重构火葬场</strong><br> 虽然大部分大佬还没有涉及到 设计框架的阶段，但是，只要稍微努努力…<br> 火葬场 迟早都是要去滴~ ~</p> 
<p>所以，就有了另一句老话：<strong>动态代码一时爽，一直动态一时爽</strong></p> 
<p>可见，参数化的作用，真的，很Nice!<br> 话说回来，参数化的作用是啥呢：<strong>循环取数据，数据可重复使用。</strong></p> 
<h4><a id="422__346"></a>4.2.2 三个场景认识参数化</h4> 
<p><strong>场景1：</strong><br> &gt;&gt; 模拟3个用户并发请求网页，共有100个URL地址，每个虚拟用户都会依次循环加载100个URL地址</p> 
<p><strong>代码展示</strong>：</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> TaskSet<span class="token punctuation">,</span> task<span class="token punctuation">,</span> HttpUser

<span class="token keyword">class</span> <span class="token class-name">UserBehav</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">on_start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span>

    @task
    <span class="token keyword">def</span> <span class="token function">test_visit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> self<span class="token punctuation">.</span>locust<span class="token punctuation">.</span>share_data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>index<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'visit url: %s'</span> <span class="token operator">%</span> url<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>locust<span class="token punctuation">.</span>share_data<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        
<span class="token keyword">class</span> <span class="token class-name">WebsiteUser</span><span class="token punctuation">(</span> HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    host <span class="token operator">=</span> <span class="token string">'http://www.xxx.com'</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>UserBehav<span class="token punctuation">)</span>
    share_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'url1'</span><span class="token punctuation">,</span> <span class="token string">'url2'</span><span class="token punctuation">,</span> <span class="token string">'url3'</span><span class="token punctuation">,</span> <span class="token string">'url4'</span><span class="token punctuation">,</span> <span class="token string">'url5'</span><span class="token punctuation">]</span>
    min_wait <span class="token operator">=</span> <span class="token number">1000</span>
    max_wait <span class="token operator">=</span> <span class="token number">15000</span>

</code></pre> 
<p><strong>场景2</strong><br> &gt;&gt;&gt;模拟3用户并发注册账号，共有9个账号，要求注册账号不重复，注册完毕后结束测试</p> 
<p><strong>概括：</strong><br> <strong>保证并发测试数据唯一性，不循环取数据</strong><br> &gt;&gt;&gt;所有并发虚拟用户共享同一份测试数据，并且保证虚拟用户使用的数据不重复；</p> 
<p><strong>代码</strong><br> 采用队列</p> 
<pre><code class="prism language-python">
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> TaskSet<span class="token punctuation">,</span> task<span class="token punctuation">,</span> HttpUser
<span class="token keyword">import</span> queue
<span class="token keyword">class</span> <span class="token class-name">UserBehav</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @task
    <span class="token keyword">def</span> <span class="token function">test_register</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> self<span class="token punctuation">.</span>locust<span class="token punctuation">.</span>user_data_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> queue<span class="token punctuation">.</span>Empty<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'account data run out, test ended.'</span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'register with user: {}, pwd: {}'</span>\
            <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>
        
<span class="token keyword">class</span> <span class="token class-name">WebsiteUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    host <span class="token operator">=</span> <span class="token string">'http://www.xxx.com'</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>UserBehav<span class="token punctuation">)</span> 
    user_data_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"test%04d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"pwd%04d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"test%04d@debugtalk.test"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"phone"</span><span class="token punctuation">:</span> <span class="token string">"186%08d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        user_data_queue<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    min_wait <span class="token operator">=</span> <span class="token number">1000</span>
    max_wait <span class="token operator">=</span> <span class="token number">15000</span>
</code></pre> 
<p><strong>场景3</strong><br> &gt;&gt;&gt;模拟3个用户并发登录账号，总共有9个账号，要求并发登录账号不相同，但数据可循环使用；</p> 
<p><strong>概括：</strong><br> <strong>保证并发测试数据唯一性，循环取数据</strong>；<br> &gt;&gt;&gt;所有并发虚拟用户共享同一份测试数据，保证并发虚拟用户使用的数据不重复，并且数据可循环重复使用。</p> 
<p><strong>代码展示</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> TaskSet<span class="token punctuation">,</span> task<span class="token punctuation">,</span> HttpUser
<span class="token keyword">import</span> queue
<span class="token keyword">class</span> <span class="token class-name">UserBehav</span><span class="token punctuation">(</span>TaskSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @task
    <span class="token keyword">def</span> <span class="token function">test_register</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> self<span class="token punctuation">.</span>locust<span class="token punctuation">.</span>user_data_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> queue<span class="token punctuation">.</span>Empty<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'account data run out, test ended'</span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'register with user: {0}, pwd: {1}'</span> <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>locust<span class="token punctuation">.</span>user_data_queue<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">WebsiteUser</span><span class="token punctuation">(</span>HttpUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    host <span class="token operator">=</span> <span class="token string">'http://www.xxx.com'</span>
    task_set <span class="token operator">=</span> task<span class="token punctuation">(</span>UserBehav<span class="token punctuation">)</span>
    user_data_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"test%04d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"pwd%04d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"test%04d@debugtalk.test"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
            <span class="token string">"phone"</span><span class="token punctuation">:</span> <span class="token string">"186%08d"</span> <span class="token operator">%</span> index<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        user_data_queue<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    min_wait <span class="token operator">=</span> <span class="token number">1000</span>
    max_wait <span class="token operator">=</span> <span class="token number">15000</span>
</code></pre> 
<h3><a id="43__488"></a>4.3 检查点</h3> 
<p>我们直接使用assert来进行断言操作。<br> 上代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-9-23
"""</span>


<span class="token keyword">from</span> locust <span class="token keyword">import</span> task

@task
<span class="token keyword">def</span> <span class="token function">test_interface</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment">#直接使用csdn的某一个api</span>
    <span class="token keyword">with</span>  self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://editor.csdn.net/md?articleId=108596407"</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'fileconfig'</span><span class="token punctuation">,</span>catch_response<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
    	<span class="token comment">#python断言对接口返回值中的max字段进行断言</span>
        <span class="token keyword">assert</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'rating'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'max'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">100</span>           
        <span class="token comment">#对http响应码是否200进行判断</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">:</span>                   
            response<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            response<span class="token punctuation">.</span>failure<span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span>

</code></pre> 
<p>这里说明一下：<br> 1、断言形式：<strong>with self.client.get(“url地址”,catch_response=True) as response</strong>；</p> 
<p>2、<strong>response.status_code</strong>获取http响应码进行判断，失败后会加到统计错误表中；<br> &gt;&gt;&gt;如果直接使用python自带assert，则不会进入到locust报表，</p> 
<p>3、默认不写参数<strong>catch_response=False</strong>断言无效，将catch_response=True才生效。</p> 
<h2><a id="5_Locust_523"></a>5. Locust运行模式</h2> 
<p>运行Locust时，通常会使用到两种运行模式：单进程运行和多进程分布式运行。</p> 
<h3><a id="51__526"></a>5.1 单进程运行模式</h3> 
<h4><a id="511__527"></a>5.1.1 定义及解析</h4> 
<p>1、Locust所有的虚拟并发用户均运行在单个Python进程中，<br> 由于<strong>单进程</strong>的原因，并<strong>不能完全发挥压力机所有处理器的能力</strong>，因此<strong>主要用于调试脚本和小并发压测</strong>的情况。</p> 
<p>2、<strong>当并发压力要求较高时，就需要用到Locust的多进程分布式运行模式</strong>。<br> &gt;&gt;&gt; 一旦单台计算机不足以模拟所需的用户数量，Locust就会支持运行分布在多台计算机上的负载测试。</p> 
<p>3、<strong>多进程分布运行情况：</strong><br> ①<strong>多台压力机同时运行</strong>，每台压力机分担负载一部分的压力生成；<br> ②<strong>同一台压力机上开启多个slave的情况。</strong><br> &gt;&gt;&gt;如果一台压力机有N个处理器内核，那么就在这台压力机上启动一个master，N个slave。<br> &gt;&gt;&gt;也可以启动N的倍数个slave。</p> 
<h4><a id="512__Web_UI_541"></a>5.1.2 有Web UI模式</h4> 
<p>Locust默认采用8089端口启动web；如果要使用其它端口，就可以使用如下参数进行指定。</p> 
<p><strong>参数说明</strong>：</p> 
<p>① <strong>-P, --port</strong>：指定web端口，默认为8089.<br> 终端中—&gt;进入到代码目录： locust -f locustfile.py --host = xxxxx.com<br> ② <strong>-f</strong>： 指定性能测试脚本文件<br> ③ <strong>-host</strong>： 被测试应用的URL地址【如果不填写，读取继承（HttpLocust）类中定义的host】</p> 
<p><strong>注意</strong><br> 1、如果Locust运行在本机，在浏览器中访问<strong>http://localhost:8089</strong>即可进入Locust的Web管理页面；</p> 
<p>2、如果Locust运行在其它机器上，那么在浏览器中访问<strong>http://locust_machine_ip:8089</strong>即可。</p> 
<h4><a id="513__Web_UI_557"></a>5.1.3 无Web UI模式</h4> 
<p>如果采用no_web形式，则需使用–no-web参数，并会用到如下几个参数。</p> 
<p><strong>参数说明</strong>：<br> ① <strong>-c, --clients</strong>：指定并发用户数；<br> ② <strong>-n, --num-request</strong>：指定总执行测试次数；<br> ③ <strong>-r, --hatch-rate</strong>：指定并发加压速率，默认值位1。</p> 
<p><strong>示例展示</strong>：</p> 
<pre><code class="prism language-powershell">$ locust <span class="token operator">-</span>f    locustfile<span class="token punctuation">.</span>py     <span class="token operator">--</span>host = xxxxx   <span class="token operator">--</span>no<span class="token operator">-</span>web <span class="token operator">-</span>c 1 <span class="token operator">-</span>n 2
</code></pre> 
<h4><a id="514__locust_570"></a>5.1.4 启动locust</h4> 
<p>在Pycharm的 的Terminal 中启动 locust,<br> 输入内容：</p> 
<pre><code class="prism language-powershell">locust  <span class="token operator">--</span>host =http:<span class="token operator">/</span><span class="token operator">/</span>localhost  <span class="token operator">-</span>f test_load<span class="token punctuation">.</span>py
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/e9/67yzFeE0_o.png" alt="在这里插入图片描述"></p> 
<p>也可以在 VScode、WindowsPowserShell中启动，这里我就是用 Pycharm演示一下</p> 
<h3><a id="52__582"></a>5.2 多进程分布式运行</h3> 
<p>不管是单机多进程，还是多机负载模式，运行方式都是一样的，都是<strong>先运行一个master，再启动多个slave</strong>。</p> 
<h4><a id="521_master_584"></a>5.2.1 master启动</h4> 
<p>1、<strong>启动master时，需要使用–master参数</strong><br> 2、<strong>如果要使用8089以外的端口，还需要使用-P, --port参数</strong></p> 
<p><strong>示例展示：</strong></p> 
<pre><code class="prism language-powershell">locust <span class="token operator">-</span>f prof_load<span class="token punctuation">.</span>py <span class="token operator">--</span>master <span class="token operator">--</span>port=8089
</code></pre> 
<h4><a id="522_slave__595"></a>5.2.2 slave 启动</h4> 
<p>1、<strong>启动slave时需要使用–slave参数</strong><br> 2、<strong>在slave中，就不需要再指定端口</strong><br> 3、<strong>master启动后，还需要启动slave才能执行测试任务</strong></p> 
<p><strong>示例展示</strong></p> 
<pre><code class="prism language-powershell">locust <span class="token operator">-</span>f monitorAgent<span class="token punctuation">.</span>py <span class="token operator">--</span>slave
</code></pre> 
<pre><code class="prism language-powershell">ocust <span class="token operator">-</span>f monitorAgent<span class="token punctuation">.</span>py <span class="token operator">--</span>slave <span class="token operator">--</span>master<span class="token operator">-</span>host=&lt;locust_machine_ip&gt;
</code></pre> 
<p>master和slave都启动完成，就可以进入到Locust 的web界面。剩下的操作，就是界面操作了~</p> 
<h2><a id="6_Locust__613"></a>6. Locust 结果分析</h2> 
<p><img src="https://images2.imgbox.com/f1/01/m7CPgq8K_o.png" alt="在这里插入图片描述"><br> <strong>Number of users to simulate</strong>： 设置虚拟用户数，对应中no_web模式的-c, --clients参数；</p> 
<p><strong>Hatch rate（users spawned/second）</strong>： 每秒产生(启动）的虚拟用户数 ， 对应着no_web模式的-r, --hatch-rate参数，默认为1。<br> <img src="https://images2.imgbox.com/d1/31/oueGLUCe_o.png" alt="在这里插入图片描述"><br> 上图：启动了一个 master 和两个 slave，由两个 slave 来向被测试系统发送请求</p> 
<p>性能测试参数</p> 
<p><strong>Type</strong>： 请求的类型，例如GET/POST。</p> 
<p><strong>Name</strong>：请求的路径。这里为百度首页，即：https://www.baidu.com/</p> 
<p><strong>request</strong>：当前请求的数量。</p> 
<p><strong>fails</strong>：当前请求失败的数量。</p> 
<p><strong>Median</strong>：中间值，单位毫秒，一半的服务器响应时间低于该值，而另一半高于该值。</p> 
<p><strong>Average</strong>：平均值，单位毫秒，所有请求的平均响应时间。</p> 
<p><strong>Min</strong>：请求的最小服务器响应时间，单位毫秒。</p> 
<p><strong>Max</strong>：请求的最大服务器响应时间，单位毫秒。</p> 
<p><strong>Content Size</strong>：单个请求的大小，单位字节。</p> 
<p><strong>reqs/sec</strong>：是每秒钟请求的个数。</p> 
<p>相比于LoadRunner，Locust的结果展示十分简单，主要就四个指标：并发数、RPS、响应时间、异常率。但对于大多数场景来说，这几个指标已经足够了。<br> <img src="https://images2.imgbox.com/50/db/1Wsr8VeK_o.png" alt="在这里插入图片描述"></p> 
<p>上图是 曲线分析图。</p> 
<p>关于locust的代码实战及结果分析，就先到这里。<br> 在这里，小鱼再多说一句：<br> <strong>万行代码从头写，先看基础挺要紧</strong><br> 所以，要弄懂代码，还是先看基础。<br> 点击传送<a href="https://blog.csdn.net/wuyoudeyuer/article/details/108596264">《深聊性能测试，从入门到放弃之：Locust性能自动化(一)初识Locust》</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3b3a36b152a6a887943aa3905b34b2f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python中对csv文件进行转置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e93a0ab048ade351d913a66ea6047fa5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python中id()函数、is操作符、zip()函数、map()函数、lambda函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>