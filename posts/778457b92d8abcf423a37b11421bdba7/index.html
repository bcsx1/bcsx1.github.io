<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>浅谈基于Pytest框架的自动化测试开发实践 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="浅谈基于Pytest框架的自动化测试开发实践" />
<meta property="og:description" content="Pytest是Python的一种易用、高效和灵活的单元测试框架，可以支持单元测试和功能测试。本文不以介绍Pytest工具本身为目的，而是以一个实际的API测试项目为例，将Pytest的功能应用到实际的测试工程实践中，教大家将Pytest用起来。
在开始本文之前，我想跟大家澄清两个概念，一个是测试框架一个是测试工具。很多人容易把他们搞混了，测试框架是诸如Unittest、Pytest、TestNG这类，而测试工具指的则是Selenium、Appium、Jmeter这类。
测试框架的作用是，帮助我们管理测试用例、执行测试用例、参数化、断言、生成测试报告等基础性工作，让我们将精力用在测试用例的编写上。好的测试框架应该具有很高的扩展性，支持二次开发，并能够支持多种类型的自动化测试。
测试工具的作用是为了完成某一类型的测试，比如Selenium用于对WEB UI进行自动化测试，Appium用来对APP进行自动化测试，Jmeter可以用来进行API自动化测试和性能测试。另外，Java语言中OkHttp库，Python语言中的requests库，这些HTTP的client也可以看做是一种API测试工具。
澄清了这两个概念，说一下本文的目的。其实网上已经有很多教程，包括官方文档，都是以介绍Pytest的功能为出发点，罗列了各种功能的使用方法，大家看完之后会感觉都明白了，但是还是不知道如何与实际项目相结合，真正落地用起来。本文不以介绍Pytest工具本身为目的，而是以一个实际的API测试项目为例，通过单元测试框架Pytest和Python的Requests库相结合，将Pytest功能应用到实际的测试工程实践中，教大家将Pytest用起来。
请相信我，使用Pytest会让你的测试工作非常高效。
01 — Pytest核心功能 在开始使用Pytest之前，先来了解一下Pytest的核心功能，根据官方网站介绍，它具有如下功能和特点：
非常容易上手，入门简单，文档丰富，文档中有很多实例可以参考。能够支持简单的单元测试和复杂的功能测试。支持参数化。能够执行全部测试用例，也可以挑选部分测试用例执行，并能重复执行失败的用例。支持并发执行，还能运行由nose, unittest编写的测试用例。方便、简单的断言方式。能够生成标准的Junit XML格式的测试结果。具有很多第三方插件，并且可以自定义扩展。方便的和持续集成工具集成。 Pytest的安装方法与安装其他的python软件无异，直接使用pip安装即可。
1
$ pip install -U pytest
安装完成后，可以通过下面方式验证是否安装成功：
1
$ py.test --help
如果能够输出帮助信息，则表示安装成功了。
接下来，通过开发一个API自动化测试项目，详细介绍以上这些功能是如何使用的。
02 — 创建测试项目 先创建一个测试项目目录api_pytest，为这个项目创建虚拟环境。关于虚拟环境的创建，可以参考这篇文章《利用pyenv和pipenv管理多个相互独立的Python虚拟开发环境》。这里我们直接介绍如何使用，执行下面两条命令：
1
2
$ mkdir api_pytest
$ pipenv --python 3.7.7
这样，项目目录和虚拟环境就创建完成了。
接着，安装依赖包，第一个是要安装pytest，另外本文是以API自动化测试为例，因此还要安装一下HTTP 的client包requests。
1
$ pipenv install pytest requests
现在我们创建一个data目录，用来存放测试数据，一个tests目录，用来存放测试脚本，一个config目录，用来存放配置文件，一个utils目录从来存放工具。
1
2
3
4
$ mkdir data
$ mkdir tests
$ mkdir config
$ mkdir utils
现在，项目的目录结构应该是如下这样：
1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/778457b92d8abcf423a37b11421bdba7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T14:31:16+08:00" />
<meta property="article:modified_time" content="2023-12-27T14:31:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">浅谈基于Pytest框架的自动化测试开发实践</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Pytest是Python的一种易用、高效和灵活的单元测试框架，可以支持单元测试和功能测试。本文不以介绍Pytest工具本身为目的，而是以一个实际的API测试项目为例，将Pytest的功能应用到实际的测试工程实践中，教大家将Pytest用起来。</p> 
<p>在开始本文之前，我想跟大家澄清两个概念，一个是测试框架一个是测试工具。很多人容易把他们搞混了，测试框架是诸如Unittest、Pytest、TestNG这类，而测试工具指的则是Selenium、Appium、Jmeter这类。</p> 
<p>测试框架的作用是，帮助我们管理测试用例、执行测试用例、参数化、断言、生成测试报告等基础性工作，让我们将精力用在测试用例的编写上。好的测试框架应该具有很高的扩展性，支持二次开发，并能够支持多种类型的自动化测试。</p> 
<p>测试工具的作用是为了完成某一类型的测试，比如Selenium用于对WEB UI进行自动化测试，Appium用来对APP进行自动化测试，Jmeter可以用来进行API自动化测试和性能测试。另外，Java语言中OkHttp库，Python语言中的requests库，这些HTTP的client也可以看做是一种API测试工具。</p> 
<p>澄清了这两个概念，说一下本文的目的。其实网上已经有很多教程，包括官方文档，都是以介绍Pytest的功能为出发点，罗列了各种功能的使用方法，大家看完之后会感觉都明白了，但是还是不知道如何与实际项目相结合，真正落地用起来。本文不以介绍Pytest工具本身为目的，而是以一个实际的API测试项目为例，通过单元测试框架Pytest和Python的Requests库相结合，将Pytest功能应用到实际的测试工程实践中，教大家将Pytest用起来。</p> 
<p>请相信我，使用Pytest会让你的测试工作非常高效。</p> 
<p><a name="_label0"></a></p> 
<h3 id="heading-0">01 — Pytest核心功能</h3> 
<p>在开始使用Pytest之前，先来了解一下Pytest的核心功能，根据官方网站介绍，它具有如下功能和特点：</p> 
<ul><li>非常容易上手，入门简单，文档丰富，文档中有很多实例可以参考。</li><li>能够支持简单的单元测试和复杂的功能测试。</li><li>支持参数化。</li><li>能够执行全部测试用例，也可以挑选部分测试用例执行，并能重复执行失败的用例。</li><li>支持并发执行，还能运行由nose, unittest编写的测试用例。</li><li>方便、简单的断言方式。</li><li>能够生成标准的Junit XML格式的测试结果。</li><li>具有很多第三方插件，并且可以自定义扩展。</li><li>方便的和持续集成工具集成。</li></ul> 
<p>Pytest的安装方法与安装其他的python软件无异，直接使用pip安装即可。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>$ pip install </code><code>-</code><code>U pytest</code></p> </td></tr></tbody></table> 
<p>安装完成后，可以通过下面方式验证是否安装成功：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>$ py.test </code><code>-</code><code>-</code><code>help</code></p> </td></tr></tbody></table> 
<p>如果能够输出帮助信息，则表示安装成功了。</p> 
<p>接下来，通过开发一个API自动化测试项目，详细介绍以上这些功能是如何使用的。</p> 
<p><a name="_label1"></a></p> 
<h3 id="heading-1">02 — 创建测试项目</h3> 
<p>先创建一个测试项目目录api_pytest，为这个项目创建虚拟环境。关于虚拟环境的创建，可以参考这篇文章《利用pyenv和pipenv管理多个相互独立的Python虚拟开发环境》。这里我们直接介绍如何使用，执行下面两条命令：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>$ mkdir api_pytest</code></p> <p><code>$ pipenv </code><code>-</code><code>-</code><code>python </code><code>3.7</code><code>.</code><code>7</code></p> </td></tr></tbody></table> 
<p>这样，项目目录和虚拟环境就创建完成了。</p> 
<p>接着，安装依赖包，第一个是要安装pytest，另外本文是以API自动化测试为例，因此还要安装一下HTTP 的client包requests。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>$ pipenv install pytest requests</code></p> </td></tr></tbody></table> 
<p>现在我们创建一个data目录，用来存放测试数据，一个tests目录，用来存放测试脚本，一个config目录，用来存放配置文件，一个utils目录从来存放工具。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> </td><td> <p><code>$ </code><code>mkdir</code> <code>data</code></p> <p><code>$ </code><code>mkdir</code> <code>tests</code></p> <p><code>$ </code><code>mkdir</code> <code>config</code></p> <p><code>$ </code><code>mkdir</code> <code>utils</code></p> </td></tr></tbody></table> 
<p>现在，项目的目录结构应该是如下这样：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>$ tree</code></p> <p><code>.</code></p> <p><code>├── Pipfile</code></p> <p><code>├── Pipfile.lock</code></p> <p><code>├── config</code></p> <p><code>├── data</code></p> <p><code>├── tests</code></p> <p><code>└── utils</code></p> <p><code>​</code></p> <p><code>4 directories, 2 files</code></p> </td></tr></tbody></table> 
<p>至此测试项目就创建完成了。接着编写测试用例。</p> 
<p><a name="_label2"></a></p> 
<h3 id="heading-2">03 — 编写测试用例</h3> 
<p>在这部分，我们以测试豆瓣电影列表API和电影详情API为例，编写测试用例。</p> 
<p>这两个API信息如下：</p> 
<p></p> 
<table><thead><tr><th>接口</th><th>示例</th></tr></thead><tbody><tr><td>电影列表</td><td>http://api.douban.com/v2/movie/in_theaters?apikey=0df993c66c0c636e29ecbb5344252a4a&amp;start=0&amp;count=10</td></tr><tr><td>电影详情</td><td>https://api.douban.com/v2/movie/subject/30261964?apikey=0df993c66c0c636e29ecbb5344252a4a</td></tr></tbody></table> 
<p></p> 
<p>我们先写电影列表API的自动化测试用例，设置3个校验点：</p> 
<ul><li>验证请求中的start与响应中的start一致。</li><li>验证请求中的count与响应中的count一致。</li><li>验证响应中的title是"正在上映的电影-上海"。</li></ul> 
<p>在tests目录里面，创建个test_in_theaters.py文件，里面编写测试用例，内容如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> </td><td> <p><code>import</code> <code>requests</code></p> <p></p> <p><code>class</code> <code>TestInTheaters(</code><code>object</code><code>):</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>):</code></p> <p><code>        </code><code>host </code><code>=</code> <code>"http://api.douban.com"</code></p> <p><code>        </code><code>path </code><code>=</code> <code>"/v2/movie/in_theaters"</code></p> <p><code>        </code><code>params </code><code>=</code> <code>{<!-- --></code><code>"apikey"</code><code>: </code><code>"0df993c66c0c636e29ecbb5344252a4a"</code><code>,</code></p> <p><code>                  </code><code>"start"</code><code>: </code><code>0</code><code>,</code></p> <p><code>                  </code><code>"count"</code><code>: </code><code>10</code></p> <p><code>                  </code><code>}</code></p> <p><code>        </code><code>headers </code><code>=</code> <code>{<!-- --></code></p> <p><code>            </code><code>"User-Agent"</code><code>: </code><code>"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</code></p> <p><code>        </code><code>}</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(</code><code>"GET"</code><code>, url</code><code>=</code><code>host </code><code>+</code> <code>path, headers</code><code>=</code><code>headers, params</code><code>=</code><code>params)</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"count"</code><code>] </code><code>=</code><code>=</code> <code>params[</code><code>"count"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"start"</code><code>] </code><code>=</code><code>=</code> <code>params[</code><code>"start"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"title"</code><code>] </code><code>=</code><code>=</code> <code>"正在上映的电影-上海"</code><code>, </code><code>"实际的标题是：{}"</code><code>.</code><code>format</code><code>(response[</code><code>"title"</code><code>])</code></p> </td></tr></tbody></table> 
<p>你可能会问，这就是测试用例了？这就是基于Pytest的测试用例了吗？答案是肯定的。基于Pytest编写自动化测试用例，与编写平常的Python代码没有任何区别，唯一的区别在于文件名、函数名或者方法名要以test_开头或者_test结尾，类名以Test开头。</p> 
<p>Pytest会在test_*.py 或者 *_test.py 文件中，寻找class外边的test_开头的函数，或者Test开头的class里面的test_开头的方法，将这些函数和方法作为测试用例来管理。可以通过下面的命令，查看Pytest收集到哪些测试用例：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>$ py.test </code><code>-</code><code>-</code><code>collect</code><code>-</code><code>only</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest</code></p> <p><code>collected </code><code>1</code> <code>item                                                                                                                 </code></p> <p><code>&lt;Module tests</code><code>/</code><code>test_in_theaters.py&gt;</code></p> <p><code>  </code><code>&lt;Class TestInTheaters&gt;</code></p> <p><code>      </code><code>&lt;Function test_in_theaters&gt;</code></p> <p><code>​</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>no tests ran </code><code>in</code> <code>0.10s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>从结果中看到，一共有一条测试用例，测试用例位于tests/test_in_theaters.py这个module里面TestInTheaters这个类中的test_in_theaters这个方法。</p> 
<p>在Pytest中断言使用的是Python自带的assert语句，非常简单。</p> 
<p><a name="_label3"></a></p> 
<h3 id="heading-3">04 — 执行测试用例</h3> 
<p>下面来运行这个测试：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> <p>49</p> <p>50</p> </td><td> <p><code>$ py.test tests</code><code>/</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest</code></p> <p><code>collected </code><code>1</code> <code>item</code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py .                                                                                                [</code><code>100</code><code>%</code><code>]</code></p> <p><code>​</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>1</code> <code>passed </code><code>in</code> <code>0.61s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>(api_pytest) MBC02X21W4G8WN:api_pytest chunming.liu$ py.test tests</code><code>/</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest</code></p> <p><code>collected </code><code>1</code> <code>item</code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py F                                                                                                [</code><code>100</code><code>%</code><code>]</code></p> <p><code>​</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>FAILURES </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>________________________________________________ TestInTheaters.test_in_theaters _________________________________________________</code></p> <p><code>​</code></p> <p><code>self</code> <code>=</code> <code>&lt;test_in_theaters.TestInTheaters </code><code>object</code> <code>at </code><code>0x110eee9d0</code><code>&gt;</code></p> <p><code>​</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>):</code></p> <p><code>        </code><code>host </code><code>=</code> <code>"http://api.douban.com"</code></p> <p><code>        </code><code>path </code><code>=</code> <code>"/v2/movie/in_theaters"</code></p> <p><code>        </code><code>params </code><code>=</code> <code>{<!-- --></code><code>"apikey"</code><code>: </code><code>"0df993c66c0c636e29ecbb5344252a4a"</code><code>,</code></p> <p><code>                  </code><code>"start"</code><code>: </code><code>0</code><code>,</code></p> <p><code>                  </code><code>"count"</code><code>: </code><code>10</code></p> <p><code>                  </code><code>}</code></p> <p><code>        </code><code>headers </code><code>=</code> <code>{<!-- --></code></p> <p><code>            </code><code>"User-Agent"</code><code>: </code><code>"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</code></p> <p><code>        </code><code>}</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(</code><code>"GET"</code><code>, url</code><code>=</code><code>host </code><code>+</code> <code>path, headers</code><code>=</code><code>headers, params</code><code>=</code><code>params)</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"count"</code><code>] </code><code>=</code><code>=</code> <code>params[</code><code>"count"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"start"</code><code>] </code><code>=</code><code>=</code> <code>params[</code><code>"start"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"total"</code><code>] </code><code>=</code><code>=</code> <code>len</code><code>(response[</code><code>"subjects"</code><code>])</code></p> <p><code>​</code></p> <p><code>&gt;       </code><code>assert</code> <code>response[</code><code>"title"</code><code>] </code><code>=</code><code>=</code> <code>"正在上映的电影-上海"</code><code>, </code><code>"实际的标题是：{}"</code><code>.</code><code>format</code><code>(response[</code><code>"title"</code><code>])</code></p> <p><code>E       AssertionError: 实际的标题是：正在上映的电影</code><code>-</code><code>北京</code></p> <p><code>E       </code><code>assert</code> <code>'正在上映的电影-北京'</code> <code>=</code><code>=</code> <code>'正在上映的电影-上海'</code></p> <p><code>E         </code><code>-</code> <code>正在上映的电影</code><code>-</code><code>上海</code></p> <p><code>E         ?         ^^</code></p> <p><code>E         </code><code>+</code> <code>正在上映的电影</code><code>-</code><code>北京</code></p> <p><code>E         ?         ^^</code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py:</code><code>20</code><code>: AssertionError</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>short test summary info </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>FAILED tests</code><code>/</code><code>test_in_theaters.py::TestInTheaters::test_in_theaters </code><code>-</code> <code>AssertionError: 实际的标题是正在上映的电影</code><code>-</code><code>北京</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>1</code> <code>failed </code><code>in</code> <code>0.96s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>这个命令执行时，会在tests/目录里面寻找测试用例。执行测试的时候，如果不指定测试用例所在目录，Pytest会在当前的目录下，按照前面介绍的规则寻找测试用例并执行。</p> 
<p>通过上面的测试输出，我们可以看到该测试过程中，一共收集到了一个测试用例，测试结果是失败的（标记为F），并且在FAILURES部分输出了详细的错误信息，通过这些信息，我们可以分析测试失败的原因。上面测试用例的失败原因是在断言title的时候出错了，预期的title是“正在上映的电影-上海”，但是实际是“正在上映的电影-北京”，预期和实际的对比非常直观。</p> 
<p>执行测试用例的方法还有很多种，都是在py.test后面添加不同的参数即可，我在下面罗列了一下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>$ py.test               </code><code># run all tests below current dir</code></p> <p><code>$ py.test test_module.py   </code><code># run tests in module</code></p> <p><code>$ py.test somepath      </code><code># run all tests below somepath</code></p> <p><code>$ py.test </code><code>-</code><code>k stringexpr </code><code># only run tests with names that match the</code></p> <p><code>                      </code><code># the "string expression", e.g. "MyClass and not method"</code></p> <p><code>                      </code><code># will select TestMyClass.test_something</code></p> <p><code>                      </code><code># but not TestMyClass.test_method_simple</code></p> <p><code>$ py.test test_module.py::test_func </code><code># only run tests that match the "node ID",</code></p> <p><code>                                    </code><code># e.g "test_mod.py::test_func" will select</code></p> <p><code>                                    </code><code># only test_func in test_mod.py</code></p> </td></tr></tbody></table> 
<p>上面这些用法，通过注释很容易理解。在测试执行过程中，这些方法都有机会被用到，最好掌握一下。</p> 
<p><a name="_label4"></a></p> 
<h3 id="heading-4">05 — 数据与脚本分离</h3> 
<p>03小节的测试用例，将测试数据和测试代码放到了同一个py文件中，而且是同一个测试方法中，产生了紧耦合，会导致修改测试数据或测试代码时，可能会相互影响，不利于测试数据和测试脚本的维护。比如，为测试用例添加几组新的测试数据，除了准备测试数据外，还要修改测试代码，降低了测试代码的可维护性。</p> 
<p>另外接口测试往往是数据驱动的测试，测试数据和测试代码放到一起也不方便借助Pytest做参数化。</p> 
<p>将测试代码和测试数据分离已经是测试领域中的共识了。在data/目录下创建一个用于存放测试数据的Yaml文件test_in_theaters.yaml，内容如下:</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> </td><td> <p><code>---</code></p> <p><code>tests:</code></p> <p><code>- case: 验证响应中start和count与请求中的参数一致</code></p> <p><code>  </code><code>http:</code></p> <p><code>    </code><code>method: GET</code></p> <p><code>    </code><code>path: /v2/movie/in_theaters</code></p> <p><code>    </code><code>headers:</code></p> <p><code>      </code><code>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36</code></p> <p><code>    </code><code>params:</code></p> <p><code>      </code><code>apikey: 0df993c66c0c636e29ecbb5344252a4a</code></p> <p><code>      </code><code>start: 0</code></p> <p><code>      </code><code>count: 10</code></p> <p><code>  </code><code>expected:</code></p> <p><code>    </code><code>response:</code></p> <p><code>      </code><code>title: 正在上映的电影-上海</code></p> <p><code>      </code><code>count: 10</code></p> <p><code>      </code><code>start: 0</code></p> </td></tr></tbody></table> 
<p>熟悉Yaml格式的同学，应该很容易看懂上面测试数据文件的内容。这个测试数据文件中，有一个数组tests，里面包含的是一条完整的测试数据。一个完整的测试数据由三部分组成：</p> 
<ul><li>case，表示测试用例名称。</li><li>http，表示请求对象。</li><li>expected，表示预期结果。</li></ul> 
<p>http这个请求对象包含了被测接口的所有参数，包括请求方法、请求路径、请求头、请求参数。<br> expected表示预期结果，上面的测试数据中，只列出了对请求响应的预期值，实际测试中，还可以列出对数据库的预期值。</p> 
<p>测试脚本也要做相应的改造，需要读取test_in_theaters.yaml文件获取请求数据和预期结果，然后通过requests发出请求。修改后的测试代码如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> </td><td> <p><code>import</code> <code>requests</code></p> <p><code>import</code> <code>yaml</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>def</code> <code>get_test_data(test_data_path):</code></p> <p><code>    </code><code>case </code><code>=</code> <code>[]  </code><code># 存储测试用例名称</code></p> <p><code>    </code><code>http </code><code>=</code> <code>[]  </code><code># 存储请求对象</code></p> <p><code>    </code><code>expected </code><code>=</code> <code>[]  </code><code># 存储预期结果</code></p> <p><code>    </code><code>with </code><code>open</code><code>(test_data_path) as f:</code></p> <p><code>        </code><code>dat </code><code>=</code> <code>yaml.load(f.read(), Loader</code><code>=</code><code>yaml.SafeLoader)</code></p> <p><code>        </code><code>test </code><code>=</code> <code>dat[</code><code>'tests'</code><code>]</code></p> <p><code>        </code><code>for</code> <code>td </code><code>in</code> <code>test:</code></p> <p><code>            </code><code>case.append(td.get(</code><code>'case'</code><code>, ''))</code></p> <p><code>            </code><code>http.append(td.get(</code><code>'http'</code><code>, {}))</code></p> <p><code>            </code><code>expected.append(td.get(</code><code>'expected'</code><code>, {}))</code></p> <p><code>    </code><code>parameters </code><code>=</code> <code>zip</code><code>(case, http, expected)</code></p> <p><code>    </code><code>return</code> <code>case, parameters</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>cases, parameters </code><code>=</code> <code>get_test_data(</code><code>"/Users/chunming.liu/learn/api_pytest/data/test_in_theaters.yaml"</code><code>)</code></p> <p><code>list_params</code><code>=</code><code>list</code><code>(parameters)</code></p> <p><code>​</code></p> <p><code>class</code> <code>TestInTheaters(</code><code>object</code><code>):</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>):</code></p> <p><code>        </code><code>host </code><code>=</code> <code>"http://api.douban.com"</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(list_params[</code><code>0</code><code>][</code><code>1</code><code>][</code><code>"method"</code><code>],</code></p> <p><code>                             </code><code>url</code><code>=</code><code>host </code><code>+</code> <code>list_params[</code><code>0</code><code>][</code><code>1</code><code>][</code><code>"path"</code><code>],</code></p> <p><code>                             </code><code>headers</code><code>=</code><code>list_params[</code><code>0</code><code>][</code><code>1</code><code>][</code><code>"headers"</code><code>],</code></p> <p><code>                             </code><code>params</code><code>=</code><code>list_params[</code><code>0</code><code>][</code><code>1</code><code>][</code><code>"params"</code><code>])</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"count"</code><code>] </code><code>=</code><code>=</code> <code>list_params[</code><code>0</code><code>][</code><code>2</code><code>][</code><code>'response'</code><code>][</code><code>"count"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"start"</code><code>] </code><code>=</code><code>=</code> <code>list_params[</code><code>0</code><code>][</code><code>2</code><code>][</code><code>'response'</code><code>][</code><code>"start"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"total"</code><code>] </code><code>=</code><code>=</code> <code>len</code><code>(response[</code><code>"subjects"</code><code>])</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"title"</code><code>] </code><code>=</code><code>=</code> <code>list_params[</code><code>0</code><code>][</code><code>2</code><code>][</code><code>'response'</code><code>][</code><code>"title"</code><code>], </code><code>"实际的标题是：{}"</code><code>.</code><code>format</code><code>(response[</code><code>"title"</code><code>])</code></p> </td></tr></tbody></table> 
<p>注意，读取Yaml文件，需要安装PyYAML包。</p> 
<p>测试脚本中定义了一个读取测试数据的函数get_test_data，通过这个函数从测试数据文件test_in_theaters.yaml中读取到了测试用例名称case，请求对象http和预期结果expected。这三部分分别是一个列表，通过zip将他们压缩到一起。</p> 
<p>测试方法test_in_theaters并没有太大变化，只是发送请求所使用的测试数据不是写死的，而是来自于测试数据文件了。</p> 
<p>通常情况下，读取测试数据的函数不会定义在测试用例文件中，而是会放到utils包中，比如放到utils/commonlib.py中。至此，整个项目的目录结构应该是如下所示：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> </td><td> <p><code>$ tree</code></p> <p><code>.</code></p> <p><code>├── Pipfile</code></p> <p><code>├── Pipfile.lock</code></p> <p><code>├── config</code></p> <p><code>├── data</code></p> <p><code>│   └── test_in_theaters.yaml</code></p> <p><code>├── tests</code></p> <p><code>│   └── test_in_theaters.py</code></p> <p><code>└── utils</code></p> <p><code>    </code><code>└── commlib.py</code></p> </td></tr></tbody></table> 
<p>这样，我们修改测试脚本，就修改test_in_theaters.py，变更测试数据，就修改test_in_theaters.yaml。但是目前看，感觉好像并没有真正看到测试数据和脚本分离的厉害之处，或者更加有价值的地方，那么我们接着往下看。</p> 
<p><a name="_label5"></a></p> 
<h3 id="heading-5">06 — 参数化</h3> 
<p>上面我们将测试数据和测试脚本相分离，如果要为测试用例添加更多的测试数据，往tests数组中添加更多的同样格式的测试数据即可。这个过程叫作参数化。</p> 
<p>参数化的意思是对同一个接口，使用多种不同的输入对其进行测试，以验证是否每一组输入参数都能得到预期结果。Pytest提供了pytest.mark.paramtrize这种方式来进行参数化，我们先看下官方网站提供的介绍pytest.mark.paramtrize用法的例子：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> </td><td> <p><code># content of tests/test_time.py</code></p> <p><code>import</code> <code>pytest</code></p> <p><code>​</code></p> <p><code>from</code> <code>datetime </code><code>import</code> <code>datetime, timedelta</code></p> <p><code>​</code></p> <p><code>testdata </code><code>=</code> <code>[</code></p> <p><code>    </code><code>(datetime(</code><code>2001</code><code>, </code><code>12</code><code>, </code><code>12</code><code>), datetime(</code><code>2001</code><code>, </code><code>12</code><code>, </code><code>11</code><code>), timedelta(</code><code>1</code><code>)),</code></p> <p><code>    </code><code>(datetime(</code><code>2001</code><code>, </code><code>12</code><code>, </code><code>11</code><code>), datetime(</code><code>2001</code><code>, </code><code>12</code><code>, </code><code>12</code><code>), timedelta(</code><code>-</code><code>1</code><code>)),</code></p> <p><code>]</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>@pytest</code><code>.mark.parametrize(</code><code>"a,b,expected"</code><code>, testdata)</code></p> <p><code>def</code> <code>test_timedistance_v0(a, b, expected):</code></p> <p><code>    </code><code>diff </code><code>=</code> <code>a </code><code>-</code> <code>b</code></p> <p><code>    </code><code>assert</code> <code>diff </code><code>=</code><code>=</code> <code>expected</code></p> </td></tr></tbody></table> 
<p>执行上面的脚本将会得到下面的输出，测试方法test_timedistance_v0被执行了两遍，第一遍执行用的测试数据是testdata列表中的第一个元组，第二遍执行时用的测试数据是testdata列表中的第二个元组。这就是参数化的效果，同一个脚本可以使用不同的输入参数执行测试。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> </td><td> <p><code>============================= test session starts ==============================</code></p> <p><code>platform darwin -- Python 3.7.7, pytest-5.4.1, py-1.8.1, pluggy-0.13.1 -- /Users/chunming.liu/.local/share/virtualenvs/api_pytest-wCozfXSU/bin/python</code></p> <p><code>cachedir: .pytest_cache</code></p> <p><code>rootdir: /Users/chunming.liu/learn/api_pytest/tests</code></p> <p><code>collecting ... collected 2 items</code></p> <p><code>​</code></p> <p><code>test_time.py::test_timedistance_v0[a0-b0-expected0] PASSED    [ 50%]</code></p> <p><code>test_time.py::test_timedistance_v0[a1-b1-expected1] PASSED    [100%]</code></p> <p><code>​</code></p> <p><code>============================== 2 passed in 0.02s ===============================</code></p> </td></tr></tbody></table> 
<p>照猫画虎，对我们自己的测试项目中的测试脚本进行如下修改。</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> </td><td> <p><code>import</code> <code>pytest</code></p> <p><code>import</code> <code>requests</code></p> <p><code>​</code></p> <p><code>from</code> <code>utils.commlib </code><code>import</code> <code>get_test_data</code></p> <p><code>​</code></p> <p><code>cases, list_params </code><code>=</code> <code>get_test_data(</code><code>"/Users/chunming.liu/learn/api_pytest/data/test_in_theaters.yaml"</code><code>)</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>class</code> <code>TestInTheaters(</code><code>object</code><code>):</code></p> <p><code>    </code><code>@pytest</code><code>.mark.parametrize(</code><code>"case,http,expected"</code><code>, </code><code>list</code><code>(list_params), ids</code><code>=</code><code>cases)</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>, case, http, expected):</code></p> <p><code>        </code><code>host </code><code>=</code> <code>"http://api.douban.com"</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(http[</code><code>"method"</code><code>],</code></p> <p><code>                             </code><code>url</code><code>=</code><code>host </code><code>+</code> <code>http[</code><code>"path"</code><code>],</code></p> <p><code>                             </code><code>headers</code><code>=</code><code>http[</code><code>"headers"</code><code>],</code></p> <p><code>                             </code><code>params</code><code>=</code><code>http[</code><code>"params"</code><code>])</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"count"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"count"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"start"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"start"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"title"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"title"</code><code>], </code><code>"实际的标题是：{}"</code><code>.</code><code>format</code><code>(response[</code><code>"title"</code><code>])</code></p> </td></tr></tbody></table> 
<p>在测试方法上面添加了一个装饰器@pytest.mark.parametrize，装饰器会自动对list(list_params)解包并赋值给装饰器的第一参数。装饰器的第一个参数中逗号分隔的变量可以作为测试方法的参数，在测试方法内就可以直接获取这些变量的值，利用这些值发起请求和进行断言。装饰器还有一个参数叫ids，这个值作为测试用例的名称将打印到测试结果中。</p> 
<p>在执行修改后的测试脚本前，我们在测试数据文件再增加一组测试数据，现在测试数据文件中，包含了两组测试数据：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> </td><td> <p><code>---</code></p> <p><code>tests:</code></p> <p><code>- case: 验证响应中start和count与请求中的参数一致</code></p> <p><code>  </code><code>http:</code></p> <p><code>    </code><code>method: GET</code></p> <p><code>    </code><code>path: /v2/movie/in_theaters</code></p> <p><code>    </code><code>headers:</code></p> <p><code>      </code><code>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36</code></p> <p><code>    </code><code>params:</code></p> <p><code>      </code><code>apikey: 0df993c66c0c636e29ecbb5344252a4a</code></p> <p><code>      </code><code>start: 0</code></p> <p><code>      </code><code>count: 10</code></p> <p><code>  </code><code>expected:</code></p> <p><code>    </code><code>response:</code></p> <p><code>      </code><code>title: 正在上映的电影-上海</code></p> <p><code>      </code><code>count: 10</code></p> <p><code>      </code><code>start: 0</code></p> <p><code>- case: 验证响应中title是"正在上映的电影-北京"</code></p> <p><code>  </code><code>http:</code></p> <p><code>    </code><code>method: GET</code></p> <p><code>    </code><code>path: /v2/movie/in_theaters</code></p> <p><code>    </code><code>headers:</code></p> <p><code>      </code><code>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36</code></p> <p><code>    </code><code>params:</code></p> <p><code>      </code><code>apikey: 0df993c66c0c636e29ecbb5344252a4a</code></p> <p><code>      </code><code>start: 1</code></p> <p><code>      </code><code>count: 5</code></p> <p><code>  </code><code>expected:</code></p> <p><code>    </code><code>response:</code></p> <p><code>      </code><code>title: 正在上映的电影-北京</code></p> <p><code>      </code><code>count: 5</code></p> <p><code>      </code><code>start: 1</code></p> </td></tr></tbody></table> 
<p>现在我们执行一下测试脚本，看看效果：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> </td><td> <p><code>$ export PYTHONPATH</code><code>=</code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest</code></p> <p><code>$ py.test tests</code><code>/</code><code>test_in_theaters.py </code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest, inifile: pytest.ini</code></p> <p><code>collected </code><code>2</code> <code>items                                                                                                                </code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py F.                                                                                               [</code><code>100</code><code>%</code><code>]</code></p> <p><code>​</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>FAILURES </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>___________________________________ TestInTheaters.test_in_theaters[验证响应中start和count与请求中的参数一致] ___________________________________</code></p> <p></p> <p></p> <p><code>​</code></p> <p><code>self</code> <code>=</code> <code>&lt;test_in_theaters.TestInTheaters </code><code>object</code> <code>at </code><code>0x102659510</code><code>&gt;, case </code><code>=</code> <code>'验证响应中start和count与请求中的参数一致'</code></p> <p><code>http </code><code>=</code> <code>{<!-- --></code><code>'headers'</code><code>: {<!-- --></code><code>'User-Agent'</code><code>: </code><code>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chr...T'</code><code>, </code><code>'params'</code><code>: {<!-- --></code><code>'apikey'</code><code>: </code><code>'0df993c66c0c636e29ecbb5344252a4a'</code><code>, </code><code>'count'</code><code>: </code><code>10</code><code>, </code><code>'start'</code><code>: </code><code>0</code><code>}, </code><code>'path'</code><code>: </code><code>'/v2/movie/in_theaters'</code><code>}</code></p> <p><code>expected </code><code>=</code> <code>{<!-- --></code><code>'response'</code><code>: {<!-- --></code><code>'count'</code><code>: </code><code>10</code><code>, </code><code>'start'</code><code>: </code><code>0</code><code>, </code><code>'title'</code><code>: </code><code>'正在上映的电影-上海'</code><code>}}</code></p> <p><code>​</code></p> <p><code>    </code><code>@pytest</code><code>.mark.parametrize(</code><code>"case,http,expected"</code><code>, </code><code>list</code><code>(list_params), ids</code><code>=</code><code>cases)</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>, case, http, expected):</code></p> <p><code>        </code><code>host </code><code>=</code> <code>"http://api.douban.com"</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(http[</code><code>"method"</code><code>],</code></p> <p><code>                             </code><code>url</code><code>=</code><code>host </code><code>+</code> <code>http[</code><code>"path"</code><code>],</code></p> <p><code>                             </code><code>headers</code><code>=</code><code>http[</code><code>"headers"</code><code>],</code></p> <p><code>                             </code><code>params</code><code>=</code><code>http[</code><code>"params"</code><code>])</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"count"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"count"</code><code>]</code></p> <p><code>        </code><code>assert</code> <code>response[</code><code>"start"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"start"</code><code>]</code></p> <p><code>&gt;       </code><code>assert</code> <code>response[</code><code>"title"</code><code>] </code><code>=</code><code>=</code> <code>expected[</code><code>'response'</code><code>][</code><code>"title"</code><code>], </code><code>"实际的标题是：{}"</code><code>.</code><code>format</code><code>(response[</code><code>"title"</code><code>])</code></p> <p><code>E       AssertionError: 实际的标题是：正在上映的电影</code><code>-</code><code>北京</code></p> <p><code>E       </code><code>assert</code> <code>'正在上映的电影-北京'</code> <code>=</code><code>=</code> <code>'正在上映的电影-上海'</code></p> <p><code>E         </code><code>-</code> <code>正在上映的电影</code><code>-</code><code>上海</code></p> <p><code>E         ?         ^^</code></p> <p><code>E         </code><code>+</code> <code>正在上映的电影</code><code>-</code><code>北京</code></p> <p><code>E         ?         ^^</code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py:</code><code>20</code><code>: AssertionError</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>short test summary info </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>FAILED tests</code><code>/</code><code>test_in_theaters.py::TestInTheaters::test_in_theaters[\u9a8c\u8bc1\u54cd\u5e94\u4e2dstart\u548ccount\u4e0e\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\u4e00\u81f4]</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>1</code> <code>failed, </code><code>1</code> <code>passed </code><code>in</code> <code>0.69s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>从结果看，Pytest收集到了2个items，测试脚本执行了两遍，第一遍执行用第一组测试数据，结果是失败(F)，第二遍执行用第二组测试数据，结果是通过(.)。执行完成后的summary info部分，看到了一些Unicode编码，这里其实是ids的内容，因为是中文，所以默认这里显示Unicode编码。为了显示中文，需要在测试项目的根目录下创建一个Pytest的配置文件pytest.ini，在其中添加如下代码：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>[pytest]</code></p> <p><code>disable_test_id_escaping_and_forfeit_all_rights_to_community_support </code><code>=</code> <code>True</code></p> </td></tr></tbody></table> 
<p>再次执行测试脚本，在测试结果的summary_info部分，则会显示正确中文内容了。</p> 
<blockquote> 
 <p>FAILED tests/test_in_theaters.py::TestInTheaters::test_in_theaters[验证响应中start和count与请求中的参数一致] - AssertionError: ...</p> 
</blockquote> 
<p>按照这种参数化的方法，如果想修改或者添加测试数据，只需要修改测试数据文件即可。</p> 
<p>现在，自动化测试项目的目录结构应该是如下这样：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> </td><td> <p><code>$ tree</code></p> <p><code>.</code></p> <p><code>├── Pipfile</code></p> <p><code>├── Pipfile.lock</code></p> <p><code>├── config</code></p> <p><code>├── data</code></p> <p><code>│   └── test_in_theaters.yaml</code></p> <p><code>├── pytest.ini</code></p> <p><code>├── tests</code></p> <p><code>│   ├── test_in_theaters.py</code></p> <p><code>│   └── test_time.py</code></p> <p><code>└── utils</code></p> <p><code>    </code><code>└── commlib.py</code></p> <p><code>​</code></p> <p><code>4 directories, 7 files</code></p> </td></tr></tbody></table> 
<p><a name="_label6"></a></p> 
<h3 id="heading-6">07 — 测试配置管理</h3> 
<p>06小节的自动化测试代码中，host是写在测试脚本中的，这种硬编码方式显然是不合适的。这个host在不同的测试脚本都会用到，应该放到一个公共的地方来维护。如果需要对其进行修改，那么只需要修改一个地方就可以了。根据我的实践经验，将其放到config文件夹中，是比较好的。</p> 
<p>除了host外，其他与测试环境相关的配置信息也可以放到config文件夹中，比如数据库信息、kafka连接信息等，以及与测试环境相关的基础测试数据，比如测试账号。很多时候，我们会有不同的测试环境，比如dev环境、test环境、stg环境、prod环境等。我们可以在config文件夹下面创建子目录来区分不同的测试环境。因此config文件夹，应该是类似这样的结构：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> </td><td> <p><code>├── config</code></p> <p><code>│   ├── prod</code></p> <p><code>│   │   └── config.yaml</code></p> <p><code>│   └── test</code></p> <p><code>│       └── config.yaml</code></p> </td></tr></tbody></table> 
<p>在config.yaml中存放不同环境的配置信息，以前面的例子为例，应该是这样：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>host:</code></p> <p><code>  </code><code>douban: http://api.douban.com</code></p> </td></tr></tbody></table> 
<p>将测试配置信息从脚本中拆分出来，就需要有一种机制将其读取到，才能在测试脚本中使用。Pytest提供了fixture机制，通过它可以在测试执行前执行一些操作，在这里我们利用fixture提前读取到配置信息。我们先对官方文档上的例子稍加修改，来介绍fixture的使用。请看下面的代码：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> </td><td> <p><code>import</code> <code>pytest</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>@pytest</code><code>.fixture</code></p> <p><code>def</code> <code>smtp_connection():</code></p> <p><code>    </code><code>import</code> <code>smtplib</code></p> <p><code>    </code><code>connection </code><code>=</code> <code>smtplib.SMTP_SSL(</code><code>"smtp.163.com"</code><code>, </code><code>465</code><code>, timeout</code><code>=</code><code>5</code><code>)</code></p> <p><code>    </code><code>yield</code> <code>connection</code></p> <p><code>    </code><code>print</code><code>(</code><code>"teardown smtp"</code><code>)</code></p> <p><code>    </code><code>connection.close()</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>def</code> <code>test_ehlo(smtp_connection):</code></p> <p><code>    </code><code>response, msg </code><code>=</code> <code>smtp_connection.ehlo()</code></p> <p><code>    </code><code>assert</code> <code>response </code><code>=</code><code>=</code> <code>250</code></p> <p><code>    </code><code>assert</code> <code>0</code></p> </td></tr></tbody></table> 
<p>这段代码中，smtp_connection被装饰器@pytest.fixture装饰，表明它是一个fixture函数。这个函数的功能是连接163邮箱服务器，返回一个连接对象。当test_ehlo的最后一次测试执行完成后，执行print(“teardown smtp”)和connection.close()断开smtp连接。</p> 
<p>fixture函数名可以作为测试方法test_ehlo的参数，在测试方法内部，使用fixture函数名这个变量，就相当于是在使用fixture函数的返回值。</p> 
<p>回到我们读取测试配置信息的需求上，在自动化测试项目tests/目录中创建一个文件conftest.py，定义一个fixture函数env：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> </td><td> <p><code>@pytest</code><code>.fixture(scope</code><code>=</code><code>"session"</code><code>)</code></p> <p><code>def</code> <code>env(request):</code></p> <p><code>    </code><code>config_path </code><code>=</code> <code>os.path.join(request.config.rootdir, </code></p> <p><code>                               </code><code>"config"</code><code>, </code></p> <p><code>                               </code><code>"test"</code><code>, </code></p> <p><code>                               </code><code>"config.yaml"</code><code>)</code></p> <p><code>    </code><code>with </code><code>open</code><code>(config_path) as f:</code></p> <p><code>        </code><code>env_config </code><code>=</code> <code>yaml.load(f.read(), Loader</code><code>=</code><code>yaml.SafeLoader)</code></p> <p><code>    </code><code>return</code> <code>env_config</code></p> </td></tr></tbody></table> 
<p>conftest.py文件是一个plugin文件，里面可以实现Pytest提供的Hook函数或者自定义的fixture函数，这些函数只在conftest.py所在目录及其子目录中生效。scope="session"表示这个fixture函数的作用域是session级别的，在整个测试活动中开始前执行，并且只会被执行一次。除了session级别的fixture函数，还有function级别、class级别等。</p> 
<p>env函数中有一个参数request，其实request也是一个fixture函数。在这里用到了它的request.config.rootdir属性，这个属性表示的是pytest.ini这个配置文件所在的目录，因为我们的测试项目中pytest.ini处于项目的根目录，所以config_path的完整路径就是：</p> 
<p>/Users/chunming.liu/learn/api_pytest/config/test/config.yaml</p> 
<p>将env作为参数传入测试方法test_in_theaters，将测试方法内的host改为env[“host”][“douban”]：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> </td><td> <p><code>class</code> <code>TestInTheaters(</code><code>object</code><code>):</code></p> <p><code>    </code><code>@pytest</code><code>.mark.parametrize(</code><code>"case,http,expected"</code><code>, </code><code>list</code><code>(list_params), ids</code><code>=</code><code>cases)</code></p> <p><code>    </code><code>def</code> <code>test_in_theaters(</code><code>self</code><code>, env, case, http, expected):</code></p> <p><code>        </code><code>r </code><code>=</code> <code>requests.request(http[</code><code>"method"</code><code>],</code></p> <p><code>                             </code><code>url</code><code>=</code><code>env[</code><code>"host"</code><code>][</code><code>"douban"</code><code>] </code><code>+</code> <code>http[</code><code>"path"</code><code>],</code></p> <p><code>                             </code><code>headers</code><code>=</code><code>http[</code><code>"headers"</code><code>],</code></p> <p><code>                             </code><code>params</code><code>=</code><code>http[</code><code>"params"</code><code>])</code></p> <p><code>        </code><code>response </code><code>=</code> <code>r.json()</code></p> </td></tr></tbody></table> 
<p>这样就达到了测试配置文件与测试脚本相互分离的效果，如果需要修改host，只需要修改配置文件即可，测试脚本文件就不用修改了。修改完成后执行测试的方法不变。</p> 
<p>上面的env函数实现中，有点点小缺憾，就是读取的配置文件是固定的，读取的都是test环境的配置信息，我们希望在执行测试时，通过命令行选项，可指定读取哪个环境的配置，以便在不同的测试环境下开展测试。Pytest提供了一个叫作pytest_addoption的Hook函数，可以接受命令行选项的参数，写法如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> </td><td> <p><code>def</code> <code>pytest_addoption(parser):</code></p> <p><code>    </code><code>parser.addoption(</code><code>"--env"</code><code>,</code></p> <p><code>                     </code><code>action</code><code>=</code><code>"store"</code><code>,</code></p> <p><code>                     </code><code>dest</code><code>=</code><code>"environment"</code><code>,</code></p> <p><code>                     </code><code>default</code><code>=</code><code>"test"</code><code>,</code></p> <p><code>                     </code><code>help</code><code>=</code><code>"environment: test or prod"</code><code>)</code></p> </td></tr></tbody></table> 
<p>pytest_addoption的含义是，接收命令行选项–env选项的值，存到environment变量中，如果不指定命令行选项，environment变量默认值是test。将上面代码也放入conftest.py中，并修改env函数，将os.path.join中的"test"替换为request.config.getoption(“environment”)，这样就可以通过命令行选项来控制读取的配置文件了。比如执行test环境的测试，可以指定–env test：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>$ py.test </code><code>-</code><code>-</code><code>env test tests</code><code>/</code><code>test_in_theaters.py</code></p> </td></tr></tbody></table> 
<p>如果不想每次都在命令行上指定–env，还可以将其放入pyest.ini中：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>[pytest]</code></p> <p><code>addopts = --env prod</code></p> </td></tr></tbody></table> 
<p>命令行上的参数会覆盖pyest.ini里面的参数。</p> 
<p><a name="_label7"></a></p> 
<h3 id="heading-7">08 — 测试的准备与收尾</h3> 
<p>很多时候，我们需要在测试用例执行前做数据库连接的准备，做测试数据的准备，测试执行后断开数据库连接，清理测试脏数据这些工作。通过07小节大家对于通过env这个fixture函数，如何在测试开始前的开展准备工作有所了解，本小节将介绍更多内容。</p> 
<p>@pytest.fixture函数的scope可能的取值有function，class，module，package 或 session。他们的具体含义如下：</p> 
<ul><li>function，表示fixture函数在测试方法执行前和执行后执行一次。</li><li>class，表示fixture函数在测试类执行前和执行后执行一次。</li><li>module，表示fixture函数在测试脚本执行前和执行后执行一次。</li><li>package，表示fixture函数在测试包（文件夹）中第一个测试用例执行前和最后一个测试用例执行后执行一次。</li><li>session，表示所有测试的最开始和测试结束后执行一次。</li></ul> 
<p>通常，数据库连接和断开、测试配置文件的读取等工作，是需要放到session级别的fixture函数中，因为这些操作针对整个测试活动只需要做一次。而针对测试数据的准备，通常是function级别或者class级别的，因为测试数据针对不同的测试方法或者测试类往往都不相同。</p> 
<p>在TestInTheaters测试类中，模拟一个准备和清理测试数据的fixture函数preparation，scope设置为function：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> </td><td> <p><code>@pytest</code><code>.fixture(scope</code><code>=</code><code>"function"</code><code>)</code></p> <p><code>    </code><code>def</code> <code>preparation(</code><code>self</code><code>):</code></p> <p><code>        </code><code>print</code><code>(</code><code>"在数据库中准备测试数据"</code><code>)</code></p> <p><code>        </code><code>test_data </code><code>=</code> <code>"在数据库中准备测试数据"</code></p> <p><code>        </code><code>yield</code> <code>test_data</code></p> <p><code>        </code><code>print</code><code>(</code><code>"清理测试数据"</code><code>)</code></p> </td></tr></tbody></table> 
<p>在测试方法中，将preparation作为参数，通过下面的命令执行测试：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> </td><td> <p><code>$ pipenv py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>tb</code><code>=</code><code>no tests</code><code>/</code><code>test_in_theaters.py</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest, inifile: pytest.ini</code></p> <p><code>collected </code><code>2</code> <code>items                                                </code></p> <p><code>tests</code><code>/</code><code>test_in_theaters.py 在数据库中准备测试数据</code></p> <p><code>F清理测试数据</code></p> <p><code>在数据库中准备测试数据</code></p> <p><code>.清理测试数据</code></p> <p><code>​</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>short test summary info </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>FAILED tests</code><code>/</code><code>test_in_theaters.py::TestInTheaters::test_in_theaters[验证响应中start和count与请求中的参数一致] </code><code>-</code> <code>AssertionError: ...</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>1</code> <code>failed, </code><code>1</code> <code>passed </code><code>in</code> <code>0.81s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>通过输出可以看到在每一条测试用例执行前后，各执行了一次“在数据库中准备测试数据”和“清理测试数据”。如果scope的值改为class，执行测试用例的输出信息将是下面这样：</p> 
<p>tests/test_in_theaters.py 在数据库中准备测试数据<br> F.清理测试数据<br> 在测试类执行前后各执行一次“在数据库中准备测试数据”和“清理测试数据”。</p> 
<p><a name="_label8"></a></p> 
<h3 id="heading-8">09 — 标记与分组</h3> 
<p>通过pytest.mark可以给测试用例打上标记，常见的应用场景是：针对某些还未实现的功能，将测试用例主动跳过不执行。或者在某些条件下，测试用例跳过不执行。还有可以主动将测试用例标记为失败等等。针对三个场景，pytest提供了内置的标签，我们通过具体代码来看一下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> </td><td> <p><code>import</code> <code>sys</code></p> <p><code>​</code></p> <p><code>import</code> <code>pytest</code></p> <p><code>​</code></p> <p><code>​</code></p> <p><code>class</code> <code>TestMarks(</code><code>object</code><code>):</code></p> <p><code>    </code><code>@pytest</code><code>.mark.skip(reason</code><code>=</code><code>"not implementation"</code><code>)</code></p> <p><code>    </code><code>def</code> <code>test_the_unknown(</code><code>self</code><code>):</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>跳过不执行，因为被测逻辑还没有被实现</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>assert</code> <code>0</code></p> <p><code>​</code></p> <p><code>    </code><code>@pytest</code><code>.mark.skipif(sys.version_info &lt; (</code><code>3</code><code>, </code><code>7</code><code>), reason</code><code>=</code><code>"requires python3.7 or higher"</code><code>)</code></p> <p><code>    </code><code>def</code> <code>test_skipif(</code><code>self</code><code>):</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>低于python3.7版本不执行这条测试用例</code></p> <p><code>        </code><code>:return:</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>assert</code> <code>1</code></p> <p><code>​</code></p> <p><code>    </code><code>@pytest</code><code>.mark.xfail</code></p> <p><code>    </code><code>def</code> <code>test_xfail(</code><code>self</code><code>):</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>Indicate that you expect it to fail</code></p> <p><code>        </code><code>这条用例失败时，测试结果被标记为xfail（expected to fail），并且不打印错误信息。</code></p> <p><code>        </code><code>这条用例执行成功时，测试结果被标记为xpassed（unexpectedly passing）</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>assert</code> <code>0</code></p> <p><code>​</code></p> <p><code>    </code><code>@pytest</code><code>.mark.xfail(run</code><code>=</code><code>False</code><code>)</code></p> <p><code>    </code><code>def</code> <code>test_xfail_not_run(</code><code>self</code><code>):</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>run=False表示这条用例不用执行</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>assert</code> <code>0</code></p> </td></tr></tbody></table> 
<p>下面来运行这个测试：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> </td><td> <p><code>$ py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>tb</code><code>=</code><code>no tests</code><code>/</code><code>test_marks.py</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest, inifile: pytest.ini</code></p> <p><code>collected </code><code>4</code> <code>items                                                                                                                </code></p> <p><code>​</code></p> <p><code>tests</code><code>/</code><code>test_marks.py s.xx</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>1</code> <code>passed, </code><code>1</code> <code>skipped, </code><code>2</code> <code>xfailed </code><code>in</code> <code>0.06s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>从结果中可以看到，第一条测试用例skipped了，第二条测试用例passed了，第三条和第四条测试用例xfailed了。</p> 
<p>除了内置的标签，还可以自定义标签并加到测试方法上：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> </td><td> <p><code>@pytest</code><code>.mark.slow</code></p> <p><code>    </code><code>def</code> <code>test_slow(</code><code>self</code><code>):</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>自定义标签</code></p> <p><code>        </code><code>"""</code></p> <p><code>        </code><code>assert</code> <code>0</code></p> </td></tr></tbody></table> 
<p>这样就可以通过-m过滤或者反过滤，比如只执行被标记为slow的测试用例：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>$ py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>tb</code><code>=</code><code>no </code><code>-</code><code>m </code><code>"slow"</code> <code>tests</code><code>/</code><code>test_marks.py</code></p> <p><code>$ py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>tb</code><code>=</code><code>no </code><code>-</code><code>m </code><code>"not slow"</code> <code>tests</code><code>/</code><code>test_marks.py</code></p> </td></tr></tbody></table> 
<p>对于自定义标签，为了避免出现PytestUnknownMarkWarning，最好在pytest.ini中注册一下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> </td><td> <p><code>[pytest]</code></p> <p><code>markers </code><code>=</code></p> <p><code>    </code><code>slow: marks tests as slow (deselect with </code><code>'-m "not slow"'</code><code>)</code></p> </td></tr></tbody></table> 
<p><a name="_label9"></a></p> 
<h3 id="heading-9">10 — 并发执行</h3> 
<p>如果自动化测试用例数量成千上万，那么并发执行它们是个很好的主意，可以加快整体测试用例的执行时间。</p> 
<p>pyest有一个插件pytest-xdist可以做到并发执行，安装之后，执行测试用例通过执行-n参数可以指定并发度，通过auto参数自动匹配CPU数量作为并发度。并发执行本文的所有测试用例：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> </td><td> <p><code>$ py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>tb</code><code>=</code><code>no </code><code>-</code><code>n auto tests</code><code>/</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>test session starts </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>platform darwin </code><code>-</code><code>-</code> <code>Python </code><code>3.7</code><code>.</code><code>7</code><code>, pytest</code><code>-</code><code>5.4</code><code>.</code><code>1</code><code>, py</code><code>-</code><code>1.8</code><code>.</code><code>1</code><code>, pluggy</code><code>-</code><code>0.13</code><code>.</code><code>1</code></p> <p><code>rootdir: </code><code>/</code><code>Users</code><code>/</code><code>chunming.liu</code><code>/</code><code>learn</code><code>/</code><code>api_pytest, inifile: pytest.ini</code></p> <p><code>plugins: xdist</code><code>-</code><code>1.31</code><code>.</code><code>0</code><code>, forked</code><code>-</code><code>1.1</code><code>.</code><code>3</code></p> <p><code>gw0 [</code><code>10</code><code>] </code><code>/</code> <code>gw1 [</code><code>10</code><code>] </code><code>/</code> <code>gw2 [</code><code>10</code><code>] </code><code>/</code> <code>gw3 [</code><code>10</code><code>] </code><code>/</code> <code>gw4 [</code><code>10</code><code>] </code><code>/</code> <code>gw5 [</code><code>10</code><code>] </code><code>/</code> <code>gw6 [</code><code>10</code><code>] </code><code>/</code> <code>gw7 [</code><code>10</code><code>]</code></p> <p><code>s.FxxF..F.</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>short test summary info </code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> <p><code>FAILED tests</code><code>/</code><code>test_marks.py::TestMarks::test_slow </code><code>-</code> <code>assert</code> <code>0</code></p> <p><code>FAILED tests</code><code>/</code><code>test_smtpsimple.py::test_ehlo </code><code>-</code> <code>assert</code> <code>0</code></p> <p><code>FAILED tests</code><code>/</code><code>test_in_theaters.py::TestInTheaters::test_in_theaters[验证响应中start和count与请求中的参数一致] </code><code>-</code> <code>AssertionError: ...</code></p> <p><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code> <code>3</code> <code>failed, </code><code>4</code> <code>passed, </code><code>1</code> <code>skipped, </code><code>2</code> <code>xfailed </code><code>in</code> <code>1.91s</code> <code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code><code>=</code></p> </td></tr></tbody></table> 
<p>可以非常直观的感受到，并发执行比顺序执行快得多。但是并发执行需要注意的是，不同的测试用例之间不要有测试数据的相互干扰，最好不同的测试用例使用不同的测试数据。</p> 
<p>这里提一下，pytest生态中，有很多第三方插件很好用，更多的插件可以在这里<a href="https://pypi.org/search/?q=pytest" rel="nofollow" title="Search results · PyPI">Search results · PyPI</a>-查看和搜索，当然我们也可以开发自己的插件。</p> 
<p><a name="_label10"></a></p> 
<h3 id="heading-10">11 — 测试报告</h3> 
<p>Pytest可以方便的生成测试报告，通过指定–junitxml参数可以生成XML格式的测试报告，junitxml是一种非常通用的标准的测试报告格式，可以用来与持续集成工具等很多工具集成：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>$ py.test </code><code>-</code><code>s </code><code>-</code><code>q </code><code>-</code><code>-</code><code>junitxml</code><code>=</code><code>.</code><code>/</code><code>report.xml tests</code><code>/</code></p> </td></tr></tbody></table> 
<p>现在应用更加广泛的测试报告是Allure，可以方便的与Pytest集成，大家可以参考我的另外一篇公众号文章《用Pytest+Allure生成漂亮的HTML图形化测试报告》。</p> 
<p><a name="_label11"></a></p> 
<h3 id="heading-11">12 — 总结</h3> 
<p>本文章以实际项目出发，介绍了如何编写测试用例、如何参数化、如何进行测试配置管理、如何进行测试的准备和清理，如何进行并发测试并生成报告。根据本文的介绍，你能够逐步搭建起一套完整的测试项目。</p> 
<p>本文并没有对Pytest的细节和比较高阶的内容做充分介绍，以后再进行专题介绍，这篇文章主要目的是让大家能够将Pytest用起来。更高阶的内容，公众号后续文章还将继续对其进行介绍。至此，我们的自动化测试项目完整目录结构如下：</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> </td><td> <p><code>$ tree</code></p> <p><code>.</code></p> <p><code>├── Pipfile</code></p> <p><code>├── Pipfile.lock</code></p> <p><code>├── config</code></p> <p><code>│   ├── prod</code></p> <p><code>│   │   └── config.yaml</code></p> <p><code>│   └── test</code></p> <p><code>│       └── config.yaml</code></p> <p><code>├── data</code></p> <p><code>│   └── test_in_theaters.yaml</code></p> <p><code>├── pytest.ini</code></p> <p><code>├── tests</code></p> <p><code>│   ├── conftest.py</code></p> <p><code>│   ├── test_in_theaters.py</code></p> <p><code>│   ├── test_marks.py</code></p> <p><code>│   ├── test_smtpsimple.py</code></p> <p><code>│   └── test_time.py</code></p> <p><code>└── utils</code></p> <p><code>    </code><code>└── commlib.py</code></p> <p><code>​</code></p> <p><code>6 directories, 12 files</code></p> </td></tr></tbody></table> 
<pre><code>​现在我也找了很多测试的朋友，做了一个分享技术的交流群，共享了很多我们收集的技术文档和视频教程。
如果你不想再体验自学时找不到资源，没人解答问题，坚持几天便放弃的感受
可以加入我们一起交流。而且还有很多在自动化，性能，安全，测试开发等等方面有一定建树的技术大牛
分享他们的经验，还会分享很多直播讲座和技术沙龙
可以免费学习！划重点！开源的！！！
qq群号：485187702【暗号：csdn11】</code></pre> 
<p><strong>最后感谢每一个认真阅读我文章的人，看着粉丝一路的上涨和关注，礼尚往来总是要有的，虽然不是什么很值钱的东西，如果你用得到的话可以直接拿走！</strong> <strong>希望能帮助到你！<span style="color:#fe2c24;">【100%无套路免费领取】</span></strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/af/ba/ZBG4a0kz_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/55/e5/RPF5aeri_o.png"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6c7b6190c6455f4b33672e426ce7fd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">408计算机网络错题知识点拾遗</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6e34590884274f53564672b9e7ceeb8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">高斯函数、高斯核函数（RBF、径向基函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>