<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GIS开发二：批量下载和拼接地图瓦片 - 编程随想</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GIS开发二：批量下载和拼接地图瓦片" />
<meta property="og:description" content="文章目录 1、简介1.1 Web墨卡托投影1.2 经纬度坐标系1.3 瓦片定义1.4 瓦片编号1.5 瓦片和像素 1.6 瓦片计算公式1.7 网络地图服务（WMS）1.8 切片地图服务（TMS）1.9 切片地图web服务（WMTS）1.10 比例尺 2、地图瓦片数据源3、代码实现4、运行结果4.2 输出中国图4.3 输出局部图 1、简介 1.1 Web墨卡托投影 墨卡托投影，是正轴等角圆柱投影，又称等角圆柱投影，圆柱投影的一种，由荷兰地图学家墨卡托（G. Mercator）于1569年创拟。为地图投影方法中影响最大的。
用一张纸卷成圆柱，围住地球仪；然后在地球仪的球心放一个发光的灯泡，地球仪上的地图会在圆柱纸上形成投影；把这张纸平展开，就是我们常见平面世界地图。上面所讲的投影法叫墨卡托投影（Mercator Projection）。
地图学是一门严谨的科学，需要数学模型和精确的公式计算，再做近似处理，墨卡托投影数学模型如下：
当然，地形面积按墨卡托投影投射到平面后是有一定变形的，纬度越高，也就是越靠近两极变形越大。
Web墨卡托投影（又称球体墨卡托投影）是墨卡托投影的变种，它接收的输入是Datum为WGS84的经纬度，但在投影时不再把地球当做椭球而当做半径为6378137米的标准球体，以简化计算。
Web墨卡托取得了巨大成功，如今主流的Web地图几乎都是使用的Web墨卡托，如国外的 Google Maps，OpenStreetMap，Bing Map，ArcGIS 和 Heremaps 等，国内的百度地图、高德地图、腾讯地图和天地图等也是基于Web墨卡托（由于国内政策的原因，国内地图会有加密要求，一般有两种情况，一种是在 Web墨卡托的基础上经过国家标准加密的国标02坐标系，熟称“火星坐标系”；另一种是在国标的02坐标系下进一步进行加密，如百度地图的BD09坐标系）。
Web墨卡托投影还切掉了南北85.051129°纬度以上的地区，以保证整个投影是正方形的。Web墨卡托坐标系是非常适合显示数据，但是不适合存储数据的，通常我们使用WGS84 存储数据，使用Web墨卡托显示数据。
WEB GIS中常用的坐标系一般有两种，一种是以经纬度表示的WGS84坐标系（EPSG:4326），另一种为主流WEB地图厂商使用的WEB墨卡托投影（EPSG:3857）
Web墨卡托投影有两个相关的投影标准，经常搞混：
EPSG4326：Web墨卡托投影后的平面地图，但仍然使用WGS84的经度、纬度表示坐标；EPSG3857：Web墨卡托投影后的平面地图，坐标单位为米。 X and Y：
X goes from 0 (left edge is 180 °W) to 2zoom − 1 (right edge is 180 °E)Y goes from 0 (top edge is 85.0511 °N) to 2zoom − 1 (bottom edge is 85." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/97de14edda1a125a981df79fa46b941d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-31T15:42:51+08:00" />
<meta property="article:modified_time" content="2023-03-31T15:42:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程随想" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程随想</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GIS开发二：批量下载和拼接地图瓦片</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_1" rel="nofollow">1、简介</a></li><li><ul><li><a href="#11_Web_2" rel="nofollow">1.1 Web墨卡托投影</a></li><li><a href="#12__37" rel="nofollow">1.2 经纬度坐标系</a></li><li><a href="#13__59" rel="nofollow">1.3 瓦片定义</a></li><li><a href="#14__68" rel="nofollow">1.4 瓦片编号</a></li><li><a href="#15__74" rel="nofollow">1.5 瓦片和像素</a></li></ul> 
  </li><li><a href="#16__116" rel="nofollow">1.6 瓦片计算公式</a></li><li><ul><li><a href="#17_WMS_187" rel="nofollow">1.7 网络地图服务（WMS）</a></li><li><a href="#18_TMS_194" rel="nofollow">1.8 切片地图服务（TMS）</a></li><li><a href="#19_webWMTS_199" rel="nofollow">1.9 切片地图web服务（WMTS）</a></li><li><a href="#110__203" rel="nofollow">1.10 比例尺</a></li></ul> 
  </li><li><a href="#2_221" rel="nofollow">2、地图瓦片数据源</a></li><li><a href="#3_225" rel="nofollow">3、代码实现</a></li><li><a href="#4_451" rel="nofollow">4、运行结果</a></li><li><ul><li><a href="#42__473" rel="nofollow">4.2 输出中国图</a></li><li><a href="#43__508" rel="nofollow">4.3 输出局部图</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_1"></a>1、简介</h2> 
<h3><a id="11_Web_2"></a>1.1 Web墨卡托投影</h3> 
<p>墨卡托投影，是正轴等角圆柱投影，又称等角圆柱投影，圆柱投影的一种，由荷兰地图学家墨卡托（G. Mercator）于1569年创拟。为地图投影方法中影响最大的。</p> 
<p>用一张纸卷成圆柱，围住地球仪；然后在地球仪的球心放一个发光的灯泡，地球仪上的地图会在圆柱纸上形成投影；把这张纸平展开，就是我们常见平面世界地图。上面所讲的投影法叫墨卡托投影（Mercator Projection）。<br> <img src="https://images2.imgbox.com/16/7c/hkJ43T8t_o.png" alt="在这里插入图片描述"><br> 地图学是一门严谨的科学，需要数学模型和精确的公式计算，再做近似处理，墨卡托投影数学模型如下：</p> 
<p><img src="https://images2.imgbox.com/d1/c2/02JHwSfN_o.png" alt="在这里插入图片描述"><br> 当然，地形面积按墨卡托投影投射到平面后是有一定变形的，纬度越高，也就是越靠近两极变形越大。</p> 
<p>Web墨卡托投影（又称球体墨卡托投影）是墨卡托投影的变种，它接收的输入是Datum为WGS84的经纬度，但在投影时不再把地球当做椭球而当做半径为6378137米的标准球体，以简化计算。</p> 
<p><img src="https://images2.imgbox.com/e1/70/x3deurHS_o.png" alt="在这里插入图片描述"><br> Web墨卡托取得了巨大成功，如今主流的Web地图几乎都是使用的Web墨卡托，如国外的 Google Maps，OpenStreetMap，Bing Map，ArcGIS 和 Heremaps 等，国内的百度地图、高德地图、腾讯地图和天地图等也是基于Web墨卡托（由于国内政策的原因，国内地图会有加密要求，一般有两种情况，一种是在 Web墨卡托的基础上经过国家标准加密的国标02坐标系，熟称“火星坐标系”；另一种是在国标的02坐标系下进一步进行加密，如百度地图的BD09坐标系）。</p> 
<p>Web墨卡托投影还切掉了南北85.051129°纬度以上的地区，以保证整个投影是正方形的。Web墨卡托坐标系是非常适合显示数据，但是不适合存储数据的，通常我们使用WGS84 存储数据，使用Web墨卡托显示数据。</p> 
<p>WEB GIS中常用的坐标系一般有两种，一种是以经纬度表示的WGS84坐标系（EPSG:4326），另一种为主流WEB地图厂商使用的WEB墨卡托投影（EPSG:3857）</p> 
<p>Web墨卡托投影有两个相关的投影标准，经常搞混：</p> 
<ul><li>EPSG4326：Web墨卡托投影后的平面地图，但仍然使用WGS84的经度、纬度表示坐标；</li><li>EPSG3857：Web墨卡托投影后的平面地图，坐标单位为米。</li></ul> 
<p>X and Y：</p> 
<ul><li>X goes from 0 (left edge is 180 °W) to 2zoom − 1 (right edge is 180 °E)</li><li>Y goes from 0 (top edge is 85.0511 °N) to 2zoom − 1 (bottom edge is 85.0511 °S) in a Mercator projection</li></ul> 
<p>Web墨卡托投影，以整个世界范围，赤道作为标准纬线，本初子午线作为中央经线，两者交点为坐标原点，向东向北为正，向西向南为负。对于 Web Map 开发人员来说，最熟悉的应该是EPSG:4326 (WGS84) and EPSG:3857(Pseudo-Mercator)。</p> 
<p>X轴：由于赤道半径为6378137米，则赤道周长为2PIr = 2*20037508.3427892，因此X轴的取值范围：[-20037508.3427892,20037508.3427892]。</p> 
<p>Y轴：由墨卡托投影的公式可知，当纬度接近两极，即90°时，y值趋向于无穷。这是那些“懒惰的工程师”就把Y轴的取值范围也限定在[-20037508.342789244,20037508.342789244]之间，搞个正方形。</p> 
<h3><a id="12__37"></a>1.2 经纬度坐标系</h3> 
<p>有了参考椭球体这样的几何模型后，就可以定义坐标系来进行描述位置，测量距离等操作，使用相同的坐标系，可以保证同样坐标下的位置是相同的，同样的测量得到的结果也是相同的。通常有两种坐标系 地理坐标系（geographic coordinate systems） 和 投影坐标系（projected coordinate systems）。</p> 
<p>（1）地理坐标系（Geographic coordinate system）<br> 地理坐标系一般是指由经度、纬度和高度组成的坐标系，能够标示地球上的任何一个位置。<br> （2）投影坐标系（Projected coordinate systems）<br> 地理坐标系是三维的，我们要在地图或者屏幕上显示就需要转化为二维，这被称为投影（Map projection）。显而易见的是，从三维到二维的转化，必然会导致变形和失真，失真是不可避免的。常用的投影有等矩矩形投影（Platte Carre）和墨卡托投影（Mercator）。</p> 
<p>伪墨卡托投影，也被称为球体墨卡托，Web Mercator。它是基于墨卡托投影的，把 WGS84坐标系投影到正方形。我们前面已经知道 WGS84 是基于椭球体的，但是伪墨卡托投影把坐标投影到球体上，这导致两极的失真变大，但是却更容易计算。另外，伪墨卡托投影还切掉了南北85.051129°纬度以上的地区，以保证整个投影是正方形的。因为墨卡托投影等正形性的特点，在不同层级的图层上物体的形状保持不变，一个正方形可以不断被划分为更多更小的正方形以显示更清晰的细节。很明显，伪墨卡托坐标系是非常显示数据，但是不适合存储数据的，通常我们使用WGS84 存储数据，使用伪墨卡托显示数据。</p> 
<p>国内主要采用如下三种：</p> 
<ul><li> <p>WGS84：为一种大地坐标系，也是目前广泛使用的GPS全球卫星定位系统使用的坐标系。</p> </li><li> <p>GCJ02：又称火星坐标系，是由中国国家测绘局制订的地理信息系统的坐标系统。由WGS84坐标系经加密后的坐标系。</p> </li><li> <p>BD09：为百度坐标系，在GCJ02坐标系基础上再次加密。其中bd09ll表示百度经纬度坐标，bd09mc表示百度墨卡托米制坐标。</p> </li></ul> 
<p>使用OpenStreetMap的坐标为WGS84；使用高德地图、腾讯地图的坐标为GCJ02；使用百度地图的坐标为BD09；谷歌地图和Bing地图的中国部分采用了高德地图的数据，所以坐标为GCJ02。</p> 
<p>WGS84的坐标转化为GCJ02的坐标是单向的，即WGS84的坐标能够准确地变换为GCJ02坐标；但GCJ02坐标转换为WGS84时会存在精度损失。</p> 
<h3><a id="13__59"></a>1.3 瓦片定义</h3> 
<p>瓦片：指将一定范围内的地图按照一定的尺寸和格式，按缩放级别或者比例尺，切成若干行和列的正方形栅格图片，对切片后的正方形栅格图片被形象的称为瓦片（Tile）。</p> 
<p>对于经过墨卡托投影为平面的世界地图，在不同的地图分辨率(整个世界地图的像素大小)下，通过切割的方式将世界地图划分为像素为 256 × 256的地图单元，划分成的每一块地图单元称为地图瓦片。</p> 
<p>经过Web墨卡托投影后，地图就变为平面的一张地图。为此，我们对这张地图进行等级切分。在最高级（zoom=0），需要的信息最少，只需保留最重要的宏观信息，因此用一张256x256像素的图片表示即可；在下一级（zoom=1），信息量变多，用一张512x512像素的图片表示；以此类推，级别越低的像素越高，下一级的像素是当前级的4倍。这样从最高层级往下到最低层级就形成了一个金字塔坐标体系。</p> 
<p><img src="https://images2.imgbox.com/9e/62/EhzNgWCp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14__68"></a>1.4 瓦片编号</h3> 
<ul><li>谷歌XYZ：Z表示缩放层级，Z=zoom；XY的原点在左上角，X从左向右，Y从上向下。</li><li>TMS：开源产品的标准，Z的定义与谷歌相同；XY的原点在左下角，X从左向右，Y从下向上。</li><li>QuadTree：微软Bing地图使用的编码规范，Z的定义与谷歌相同，同一层级的瓦片不用XY两个维度表示，而只用一个整数表示，该整数服从四叉树编码规则</li><li>百度XYZ：Z从1开始，在最高级就把地图分为四块瓦片；XY的原点在经度为0纬度位0的位置，X从左向右，Y从下向上。</li></ul> 
<h3><a id="15__74"></a>1.5 瓦片和像素</h3> 
<table><thead><tr><th>Level of Detail</th><th>Map Width and Height (pixels)</th><th>Ground Resolution (meters / pixel)</th><th>Map Scale(at 96 dpi)</th></tr></thead><tbody><tr><td>1</td><td>512</td><td>78,271.5170</td><td>1 : 295,829,355.45</td></tr><tr><td>2</td><td>1,024</td><td>39,135.7585</td><td>1 : 147,914,677.73</td></tr><tr><td>3</td><td>2,048</td><td>19,567.8792</td><td>1 : 73,957,338.86</td></tr><tr><td>4</td><td>4,096</td><td>9,783.9396</td><td>1 : 36,978,669.43</td></tr><tr><td>5</td><td>8,192</td><td>4,891.9698</td><td>1 : 18,489,334.72</td></tr><tr><td>6</td><td>16,384</td><td>2,445.9849</td><td>1 : 9,244,667.36</td></tr><tr><td>7</td><td>32,768</td><td>1,222.9925</td><td>1 : 4,622,333.68</td></tr><tr><td>8</td><td>65,536</td><td>611.4962</td><td>1 : 2,311,166.84</td></tr><tr><td>9</td><td>131,072</td><td>305.7481</td><td>1 : 1,155,583.42</td></tr><tr><td>10</td><td>262,144</td><td>152.8741</td><td>1 : 577,791.71</td></tr><tr><td>11</td><td>524,288</td><td>76.4370</td><td>1 : 288,895.85</td></tr><tr><td>12</td><td>1,048,576</td><td>38.2185</td><td>1 : 144,447.93</td></tr><tr><td>13</td><td>2,097,152</td><td>19.1093</td><td>1 : 72,223.96</td></tr><tr><td>14</td><td>4,194,304</td><td>9.5546</td><td>1 : 36,111.98</td></tr><tr><td>15</td><td>8,388,608</td><td>4.7773</td><td>1 : 18,055.99</td></tr><tr><td>16</td><td>16,777,216</td><td>2.3887</td><td>1 : 9,028.00</td></tr><tr><td>17</td><td>33,554,432</td><td>1.1943</td><td>1 : 4,514.00</td></tr><tr><td>18</td><td>67,108,864</td><td>0.5972</td><td>1 : 2,257.00</td></tr><tr><td>19</td><td>134,217,728</td><td>0.2986</td><td>1 : 1,128.50</td></tr><tr><td>20</td><td>268,435,456</td><td>0.1493</td><td>1 : 564.25</td></tr><tr><td>21</td><td>536,870,912</td><td>0.0746</td><td>1 : 282.12</td></tr><tr><td>22</td><td>1,073,741,824</td><td>0.0373</td><td>1 : 141.06</td></tr><tr><td>23</td><td>2,147,483,648</td><td>0.0187</td><td>1 : 70.53</td></tr></tbody></table> 
<ul><li>Zoom levels</li></ul> 
<table><thead><tr><th>zoom level</th><th>tile coverage</th><th>number of tiles</th><th>tile size(*) in degrees</th></tr></thead><tbody><tr><td>0</td><td>1 tile</td><td>covers whole world</td><td>1 tile 360° x 170.1022°</td></tr><tr><td>1</td><td>2 × 2 tiles</td><td>4 tiles</td><td>180° x 85.0511°</td></tr><tr><td>2</td><td>4 × 4 tiles</td><td>16 tiles</td><td>90° x [variable]</td></tr><tr><td>n</td><td>2n × 2n tiles</td><td>22n tiles</td><td>360/2n° x [variable]</td></tr><tr><td>12</td><td>4096 x 4096 tiles</td><td>16 777 216</td><td>0.0879° x [variable]</td></tr><tr><td>16</td><td></td><td>232 ≈ 4 295 million tiles</td><td></td></tr><tr><td>17</td><td></td><td>17.2 billion tiles</td><td></td></tr><tr><td>18</td><td></td><td>68.7 billion tiles</td><td></td></tr><tr><td>19</td><td>Maximum zoom for Mapnik layer</td><td>274.9 billion tiles</td><td></td></tr></tbody></table> 
<h2><a id="16__116"></a>1.6 瓦片计算公式</h2> 
<p><a href="https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames" rel="nofollow">https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames</a></p> 
<center> 
 <figure class="half"> 
  <img src="https://images2.imgbox.com/21/6d/SqlY2jR0_o.png" width="400"> 
  <img src="https://images2.imgbox.com/12/3b/g8hr5oRu_o.png" width="400"> 
 </figure> 
</center> 
<ul><li>Lon./lat. to tile numbers：</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">import</span> math
<span class="token keyword">def</span> <span class="token function">deg2num</span><span class="token punctuation">(</span>lat_deg<span class="token punctuation">,</span> lon_deg<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
  lat_rad <span class="token operator">=</span> math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>lat_deg<span class="token punctuation">)</span>
  n <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">**</span> zoom
  xtile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lon_deg <span class="token operator">+</span> <span class="token number">180.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  ytile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>asinh<span class="token punctuation">(</span>math<span class="token punctuation">.</span>tan<span class="token punctuation">(</span>lat_rad<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>xtile<span class="token punctuation">,</span> ytile<span class="token punctuation">)</span>
</code></pre> 
<ul><li>Tile numbers to lon./lat：</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">import</span> math
<span class="token keyword">def</span> <span class="token function">num2deg</span><span class="token punctuation">(</span>xtile<span class="token punctuation">,</span> ytile<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
  n <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">**</span> zoom
  lon_deg <span class="token operator">=</span> xtile <span class="token operator">/</span> n <span class="token operator">*</span> <span class="token number">360.0</span> <span class="token operator">-</span> <span class="token number">180.0</span>
  lat_rad <span class="token operator">=</span> math<span class="token punctuation">.</span>atan<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sinh<span class="token punctuation">(</span>math<span class="token punctuation">.</span>pi <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> ytile <span class="token operator">/</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  lat_deg <span class="token operator">=</span> math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>lat_rad<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>lat_deg<span class="token punctuation">,</span> lon_deg<span class="token punctuation">)</span>
</code></pre> 
<p>我们这里开始测试一下上面的公式和代码，选择北京大学的未名湖为目标，测试如下：</p> 
<ul><li>（1）查询经纬度<br> <a href="https://map.jiqrxx.com/jingweidu/" rel="nofollow">地球在线，https://map.jiqrxx.com/jingweidu/</a><br> <a href="https://www.earthol.com/g/" rel="nofollow">地球在线2，https://www.earthol.com/g/</a><br> <a href="http://api.map.baidu.com/lbsapi/getpoint/index.html" rel="nofollow">百度坐标拾取器，http://api.map.baidu.com/lbsapi/getpoint/index.html</a></li></ul> 
<p><img src="https://images2.imgbox.com/1a/81/LnKPyapL_o.png" alt="在这里插入图片描述"></p> 
<ul><li>（2）记录目标的经纬度</li></ul> 
<p><img src="https://images2.imgbox.com/fd/c9/ZghJnMsu_o.png" alt="在这里插入图片描述"><br> 未名湖的经纬度（纬度，经度）：39.99476256945049, 116.30985796451569</p> 
<ul><li>（3）计算瓦片坐标编号</li></ul> 
<p><img src="https://images2.imgbox.com/5f/16/OGbEMsxE_o.png" alt="在这里插入图片描述"><br> 计算结果为：215766, 99247</p> 
<ul><li>（4）构造瓦片查询网页地址</li></ul> 
<p>这里使用高德地图的服务接口，构造如下：</p> 
<blockquote> 
 <p>http://wprd02.is.autonavi.com/appmaptile?x=215766&amp;y=99247&amp;z=18&amp;style=6</p> 
</blockquote> 
<ul><li>（5）浏览器运行</li></ul> 
<p><img src="https://images2.imgbox.com/4c/81/juthJdlY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/d2/lo6TwaW2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/29/2c/EXw2YofW_o.png" alt="在这里插入图片描述"><br> 注意：如果使用上面参数构造OpenStreetMap的瓦片网页地址，结果显示发生明显的偏移，如下：</p> 
<pre><code class="prism language-js"><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>tile<span class="token punctuation">.</span>openstreetmap<span class="token punctuation">.</span>org<span class="token operator">/</span><span class="token number">18</span><span class="token operator">/</span><span class="token number">215766</span><span class="token operator">/</span><span class="token number">99247</span><span class="token punctuation">.</span>png
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/26/ADtFHcP3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="17_WMS_187"></a>1.7 网络地图服务（WMS）</h3> 
<p><a href="https://www.ogc.org/" rel="nofollow">Open Geospatial Consortium (OGC) home page/</a><br> <a href="https://www.osgeo.cn/ogc-e-learning/wms/slides/presentation.html" rel="nofollow">https://www.osgeo.cn/ogc-e-learning/wms/slides/presentation.html</a><br> <a href="http://www.giswiki.org/wiki/Web_Map_Service" rel="nofollow">http://www.giswiki.org/wiki/Web_Map_Service</a></p> 
<p>网络地图服务（Web Map Service，WMS）利用具有地理空间位置信息的数据制作地图。其中将地图定义为地理数据可视的表现。能够根据用户的请求返回相应的地图（包括PNG，GIF，JPEG等栅格形式或者是SVG和WEB CGM等矢量形式）。WMS支持网络协议HTTP，所支持的操作是由URL定义的。</p> 
<h3><a id="18_TMS_194"></a>1.8 切片地图服务（TMS）</h3> 
<pre><code class="prism language-js"><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>wiki<span class="token punctuation">.</span>osgeo<span class="token punctuation">.</span>org<span class="token operator">/</span>wiki<span class="token operator">/</span>Tile_Map_Service_Specification
</code></pre> 
<p><img src="https://images2.imgbox.com/b6/27/bXSXbyXY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="19_webWMTS_199"></a>1.9 切片地图web服务（WMTS）</h3> 
<p><a href="https://www.ogc.org/standards/wmts" rel="nofollow">https://www.ogc.org/standards/wmts</a></p> 
<p><img src="https://images2.imgbox.com/32/96/FnqFq5zc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="110__203"></a>1.10 比例尺</h3> 
<p>比例尺，通常以比率(如 1:10000 )来表示，表示图上距离与实地距离之比。例如 1:10000 表示图上 1cm 代表实际距离 10000cm，即100米。</p> 
<p>由于比例尺起源较早，通常用（纸质）图上的距离衡量实际距离；而分辨率则通常用设备屏幕上的距离来衡量实际距离。而同一个地图视图，尺度是唯一的，比例尺和分辨率只不过是两种表示方法，因此它们是一一对应的。</p> 
<p>但是影像图都是通过分辨率来描述精度。在GIS中所提到的 分辨率，也称地面分辨率（Ground Resolution）或空间分辨率（Spatial Resolution），表示一个像素（pixel）代表的地面实际距离。</p> 
<p>比例尺与分辨率之间的换算公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
          c 
         
        
          a 
         
        
          l 
         
        
          e 
         
        
          = 
         
        
          1 
         
        
          : 
         
        
          ( 
         
        
          R 
         
        
          e 
         
        
          s 
         
        
          o 
         
        
          l 
         
        
          u 
         
        
          t 
         
        
          i 
         
        
          o 
         
        
          n 
         
        
          ∗ 
         
         
          
          
            P 
           
          
            P 
           
          
            I 
           
          
         
           0.0254 
          
         
        
          ) 
         
        
       
         Scale= 1:(Resolution*\dfrac{PPI}{0.0254}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0077em;">R</span><span class="mord mathnormal">eso</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.0463em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.0254</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">PP</span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></span><br> Scale：地图比例尺；<br> Resolution：地图分辨率；<br> PPI：每英寸的像素点数。默认使用屏幕分辨率为96。<br> 1英寸=96像素（一般的屏幕比例尺）<br> 1英寸（inch）=25.4mm<br> 1米=1000/25.4=39.37英寸</p> 
<h2><a id="2_221"></a>2、地图瓦片数据源</h2> 
<p>相关内容请查看本人的另一篇博客文章：<br> <a href="https://blog.csdn.net/WHEgqing/article/details/129876032">https://blog.csdn.net/WHEgqing/article/details/129876032</a></p> 
<h2><a id="3_225"></a>3、代码实现</h2> 
<pre><code class="prism language-py"><span class="token comment">#***********************************************************************</span>
<span class="token comment">#   Purpose:   python下载和拼接地图瓦片（高德和google地图）</span>
<span class="token comment">#   Author:    爱看书的小沐</span>
<span class="token comment">#   Date:      2022-03-04 </span>
<span class="token comment">#   Languages: Python</span>
<span class="token comment">#   Platform:  Python 3.9.7 win64</span>
<span class="token comment"># ***********************************************************************</span>
<span class="token comment"># -*-coding:utf-8 -*-</span>

<span class="token keyword">import</span> os<span class="token punctuation">,</span> sys
<span class="token keyword">import</span> math
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request 
<span class="token keyword">import</span> PIL<span class="token punctuation">.</span>Image <span class="token keyword">as</span> Image
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageDraw<span class="token punctuation">,</span> ImageFont

<span class="token keyword">import</span> urllib
<span class="token keyword">import</span> time
<span class="token keyword">import</span> random
<span class="token keyword">import</span> datetime

<span class="token keyword">def</span> <span class="token function">downloadImage</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> fname<span class="token punctuation">,</span> mylog<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>img_url<span class="token punctuation">,</span>filename<span class="token operator">=</span>fname<span class="token punctuation">)</span>
    <span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">,</span> fname<span class="token punctuation">,</span> <span class="token string">"-&gt;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>mylog<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">,</span> fname<span class="token punctuation">,</span> <span class="token string">"-&gt;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>mylog<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">downloadImage2</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> fname<span class="token punctuation">,</span> mylog<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user_agent <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; de-at) AppleWebKit/533.21.1 (KHTML, like Gecko) Version/5.0.5 Safari/533.21.1'</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> user_agent <span class="token punctuation">}</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        req <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
        response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
        <span class="token builtin">bytes</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">,</span> fname<span class="token punctuation">,</span> <span class="token string">"-&gt;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>mylog<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b"&lt;html&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-- forbidden"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>mylog<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-- saving"</span><span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">num2deg</span><span class="token punctuation">(</span>xtile<span class="token punctuation">,</span> ytile<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">**</span> zoom
    lon_deg <span class="token operator">=</span> xtile <span class="token operator">/</span> n <span class="token operator">*</span> <span class="token number">360.0</span> <span class="token operator">-</span> <span class="token number">180.0</span>
    lat_rad <span class="token operator">=</span> math<span class="token punctuation">.</span>atan<span class="token punctuation">(</span>math<span class="token punctuation">.</span>sinh<span class="token punctuation">(</span>math<span class="token punctuation">.</span>pi <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> ytile <span class="token operator">/</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lat_deg <span class="token operator">=</span> math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>lat_rad<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>lat_deg<span class="token punctuation">,</span> lon_deg<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getImageUrl</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#高德瓦片，wprd03想必是和谷歌一样，有多个服务器提供服务。测试下来可以取到01 到 04。</span>
    img_url <span class="token operator">=</span> <span class="token string">'https://wprd01.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;style=6'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token operator">=</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">,</span> z<span class="token operator">=</span>zoom<span class="token punctuation">)</span>
    <span class="token comment">#img_url = 'https://wprd01.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7&amp;ltype=0'.format(x=x, y=y, z=zoom)</span>
    <span class="token keyword">return</span> img_url

<span class="token keyword">def</span> <span class="token function">getAndCheckImageFilePath</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> file_path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span>  <span class="token builtin">str</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">return</span> getImageFilePath<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getImageFilePath</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> file_path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span>  <span class="token builtin">str</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.png'</span>

<span class="token comment">#################################################################</span>
<span class="token comment"># 图片拼接</span>
<span class="token comment">#################################################################</span>

<span class="token keyword">def</span> <span class="token function">mergeAllImageToOne</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xmin <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    ymin <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    xmax <span class="token operator">=</span> xmin <span class="token operator">+</span> params<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    ymax <span class="token operator">=</span> ymin <span class="token operator">+</span> params<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    mw <span class="token operator">=</span> <span class="token number">256</span> 
    toImage <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token operator">*</span><span class="token punctuation">(</span>xmax<span class="token operator">-</span>xmin<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token operator">*</span><span class="token punctuation">(</span>ymax<span class="token operator">-</span>ymin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
            fname <span class="token operator">=</span> getImageFilePath<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
            fromImage <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
            fromImage <span class="token operator">=</span> fromImage<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>
            draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>fromImage<span class="token punctuation">)</span>
            
            <span class="token comment"># 添加每个瓦片的文字信息</span>
            fontSize <span class="token operator">=</span> <span class="token number">18</span>
            setFont <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">'C:/windows/fonts/arial.ttf'</span><span class="token punctuation">,</span> fontSize<span class="token punctuation">)</span>
            fillColor <span class="token operator">=</span> <span class="token string">"#ffff00"</span>
            pos <span class="token operator">=</span> num2deg<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
            text <span class="token operator">=</span> <span class="token string">'Tile: '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span>
            text2 <span class="token operator">=</span> <span class="token string">'Lat: %.6f'</span><span class="token operator">%</span>pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            text3 <span class="token operator">=</span> <span class="token string">'Lon: %.6f'</span><span class="token operator">%</span>pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span>font<span class="token operator">=</span>setFont<span class="token punctuation">,</span>fill<span class="token operator">=</span>fillColor<span class="token punctuation">)</span>
            draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">+</span>fontSize<span class="token punctuation">)</span><span class="token punctuation">,</span> text2<span class="token punctuation">,</span>font<span class="token operator">=</span>setFont<span class="token punctuation">,</span>fill<span class="token operator">=</span>fillColor<span class="token punctuation">)</span>
            draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>fontSize<span class="token punctuation">)</span><span class="token punctuation">,</span> text3<span class="token punctuation">,</span>font<span class="token operator">=</span>setFont<span class="token punctuation">,</span>fill<span class="token operator">=</span>fillColor<span class="token punctuation">)</span>
            
            <span class="token comment"># 添加每个瓦片的边框线条</span>
            draw<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mw<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> mw<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> outline<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 将每个瓦片的小图绘制到大图里面。</span>
            toImage<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>fromImage<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">-</span>xmin<span class="token punctuation">)</span> <span class="token operator">*</span> mw<span class="token punctuation">,</span> <span class="token punctuation">(</span>y<span class="token operator">-</span>ymin<span class="token punctuation">)</span> <span class="token operator">*</span> mw<span class="token punctuation">)</span><span class="token punctuation">)</span>

    toImage<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'/preview.png'</span> <span class="token punctuation">)</span>
    toImage<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#################################################################</span>
<span class="token comment"># 图片拼接</span>
<span class="token comment">#################################################################</span>

<span class="token keyword">def</span> <span class="token function">downloadMapAllImage</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xmin <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    ymin <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    xmax <span class="token operator">=</span> xmin <span class="token operator">+</span> params<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    ymax <span class="token operator">=</span> ymin <span class="token operator">+</span> params<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    mylog <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path <span class="token operator">+</span> <span class="token string">'/err.log'</span><span class="token punctuation">,</span> mode <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span><span class="token punctuation">:</span>

            img_url <span class="token operator">=</span> getImageUrl<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>img_url<span class="token punctuation">)</span>
            
            img_savepath <span class="token operator">=</span> getAndCheckImageFilePath<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>img_savepath<span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>img_savepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
                downloadImage<span class="token punctuation">(</span>img_url<span class="token punctuation">,</span> img_savepath<span class="token punctuation">,</span> mylog<span class="token punctuation">)</span>     
                <span class="token comment">#downloadImage2(img_url, img_savepath, mylog)</span>

    mylog<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#################################################################</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    starttime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file_path<span class="token operator">=</span><span class="token string">'d:/maps'</span>

    <span class="token comment"># (1) 全球地图</span>
    zoom <span class="token operator">=</span> <span class="token number">4</span>
    params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token comment"># (2) 中国地图</span>
    <span class="token comment"># zoom = 9</span>
    <span class="token comment"># params = [354, 165, 106, 91]</span>

    <span class="token comment"># (3) 局部地图</span>
    <span class="token comment"># zoom = 18</span>
    <span class="token comment"># params = [215768, 99253, 4, 4]</span>

    downloadMapAllImage<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
    mergeAllImageToOne<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> zoom<span class="token punctuation">,</span> params<span class="token punctuation">)</span>

    endtime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>endtime <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>

</code></pre> 
<pre><code class="prism language-py"><span class="token comment">#***********************************************************************</span>
<span class="token comment">#   Purpose:   python根据经纬度，计算对应的瓦片坐标</span>
<span class="token comment">#   Author:    爱看书的小沐</span>
<span class="token comment">#   Date:      2022-03-05</span>
<span class="token comment">#   Languages: Python</span>
<span class="token comment">#   Platform:  Python 3.9.7 win64</span>
<span class="token comment"># ***********************************************************************</span>
<span class="token comment"># -*-coding:utf-8 -*-</span>
<span class="token keyword">import</span> math

<span class="token keyword">def</span> <span class="token function">deg2num</span><span class="token punctuation">(</span>lat_deg<span class="token punctuation">,</span> lon_deg<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
  lat_rad <span class="token operator">=</span> math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>lat_deg<span class="token punctuation">)</span>
  n <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">**</span> zoom
  xtile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lon_deg <span class="token operator">+</span> <span class="token number">180.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  ytile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>asinh<span class="token punctuation">(</span>math<span class="token punctuation">.</span>tan<span class="token punctuation">(</span>lat_rad<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>xtile<span class="token punctuation">,</span> ytile<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">deg2url</span><span class="token punctuation">(</span>lat_deg<span class="token punctuation">,</span> lon_deg<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
  lat_rad <span class="token operator">=</span> math<span class="token punctuation">.</span>radians<span class="token punctuation">(</span>lat_deg<span class="token punctuation">)</span>
  n <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">**</span> zoom
  xtile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lon_deg <span class="token operator">+</span> <span class="token number">180.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  ytile <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> math<span class="token punctuation">.</span>asinh<span class="token punctuation">(</span>math<span class="token punctuation">.</span>tan<span class="token punctuation">(</span>lat_rad<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">'https://wprd01.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7&amp;ltype=0'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token operator">=</span>xtile<span class="token punctuation">,</span> y<span class="token operator">=</span>ytile<span class="token punctuation">,</span> z<span class="token operator">=</span>zoom<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">deg2numrange</span><span class="token punctuation">(</span>lat_deg1<span class="token punctuation">,</span> lon_deg1<span class="token punctuation">,</span> lat_deg2<span class="token punctuation">,</span> lon_deg2<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">:</span>
  tile1 <span class="token operator">=</span> deg2num<span class="token punctuation">(</span>lat_deg1<span class="token punctuation">,</span> lon_deg1<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
  tile2 <span class="token operator">=</span> deg2num<span class="token punctuation">(</span>lat_deg2<span class="token punctuation">,</span> lon_deg2<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span>
  tile1new <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>tile1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>tile1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  tile2new <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>tile1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span>tile1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>tile1new<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile1new<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2new<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> tile1new<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tile2new<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> tile1new<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

</code></pre> 
<p>随机取一个位置的经纬度，计算它的瓦片坐标，同时构造瓦片网页地址。</p> 
<pre><code class="prism language-py"><span class="token comment"># -*-coding:utf-8 -*-</span>
<span class="token keyword">import</span> math

<span class="token comment"># 输出瓦片坐标</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>deg2num<span class="token punctuation">(</span><span class="token number">39.98836718933446</span><span class="token punctuation">,</span> <span class="token number">116.31269474242018</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 输出瓦片网址</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>deg2url<span class="token punctuation">(</span><span class="token number">39.90854390955025</span><span class="token punctuation">,</span> <span class="token number">116.43579204294966</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">### 计算结果：</span>
<span class="token comment"># (215768, 99253)</span>
<span class="token comment"># https://wprd01.is.autonavi.com/appmaptile?x=215857&amp;y=99329&amp;z=18&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7&amp;ltype=0</span>

</code></pre> 
<h2><a id="4_451"></a>4、运行结果</h2> 
<p>##4.1 输出全球图</p> 
<pre><code class="prism language-py"><span class="token operator">//</span> 地图瓦片坐标相关参数设置
zoom <span class="token operator">=</span> <span class="token number">6</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/94/7f/08GgKYrj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/41/49/ia3CKDgA_o.png" alt="在这里插入图片描述"><br> 左上角第一行文字：列序号x，行序号y，级别zoom<br> 左上角第二行文字：纬度<br> 左上角第三行文字：经度</p> 
<ul><li>第1级别：</li></ul> 
<p><img src="https://images2.imgbox.com/be/3e/IWaska56_o.png" alt="在这里插入图片描述"></p> 
<ul><li>第2级别：</li></ul> 
<p><img src="https://images2.imgbox.com/a6/5b/k3zoBqpU_o.png" alt="在这里插入图片描述"></p> 
<ul><li>第3级别：</li></ul> 
<p><img src="https://images2.imgbox.com/70/45/1lo9WaQj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42__473"></a>4.2 输出中国图</h3> 
<p>将中国框选，取对角线的两个点的经纬度，计算它的瓦片坐标，同时构造瓦片网页地址。</p> 
<pre><code class="prism language-py"><span class="token comment"># 输出两个经纬度之间的瓦片坐标</span>
zoom <span class="token operator">=</span> <span class="token number">5</span>
params <span class="token operator">=</span> deg2numrange<span class="token punctuation">(</span><span class="token number">55.59490258792558</span><span class="token punctuation">,</span> <span class="token number">73.125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.3087064670254187</span><span class="token punctuation">,</span> <span class="token number">135.966796875</span><span class="token punctuation">,</span> zoom <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token comment"># [22, 10, 6, 6]</span>
</code></pre> 
<p>高德矢量图：</p> 
<pre><code class="prism language-py">https<span class="token punctuation">:</span><span class="token operator">//</span>wprd01<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>autonavi<span class="token punctuation">.</span>com<span class="token operator">/</span>appmaptile?x<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span><span class="token operator">&amp;</span>y<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">&amp;</span>z<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>zh_cn<span class="token operator">&amp;</span>size<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>scl<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>style<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>ltype<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/74/e8/3Jhuc8MB_o.png" alt="在这里插入图片描述"><br> 高德卫星图：</p> 
<pre><code class="prism language-py">https<span class="token punctuation">:</span><span class="token operator">//</span>wprd01<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>autonavi<span class="token punctuation">.</span>com<span class="token operator">/</span>appmaptile?x<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span><span class="token operator">&amp;</span>y<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">&amp;</span>z<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">&amp;</span>style<span class="token operator">=</span><span class="token number">6</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5d/e7/i7V2PAj3_o.png" alt="在这里插入图片描述"><br> ArcGIS矢量图：</p> 
<pre><code class="prism language-py">https<span class="token punctuation">:</span><span class="token operator">//</span><span class="token builtin">map</span><span class="token punctuation">.</span>geoq<span class="token punctuation">.</span>cn<span class="token operator">/</span>ArcGIS<span class="token operator">/</span>rest<span class="token operator">/</span>services<span class="token operator">/</span>ChinaOnlineCommunity<span class="token operator">/</span>MapServer<span class="token operator">/</span>tile<span class="token operator">//</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/df/fb/UgS1NjwC_o.png" alt="在这里插入图片描述"><br> ArcGIS卫星图：</p> 
<pre><code class="prism language-py">https<span class="token punctuation">:</span><span class="token operator">//</span>services<span class="token punctuation">.</span>arcgisonline<span class="token punctuation">.</span>com<span class="token operator">/</span>arcgis<span class="token operator">/</span>rest<span class="token operator">/</span>services<span class="token operator">/</span>World_Imagery<span class="token operator">/</span>MapServer<span class="token operator">/</span>tile<span class="token operator">/</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6d/13/FriRyU1g_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43__508"></a>4.3 输出局部图</h3> 
<p>设置局部地图（以北京大学的五四体育场附近区域为例）的瓦片坐标参数如下，进行批量操作。</p> 
<pre><code class="prism language-py"><span class="token operator">//</span> 地图瓦片坐标相关参数设置
<span class="token comment"># 输出两个经纬度之间的瓦片坐标</span>
zoom <span class="token operator">=</span> <span class="token number">18</span>
params <span class="token operator">=</span> deg2numrange<span class="token punctuation">(</span><span class="token number">39.98839635086475</span><span class="token punctuation">,</span> <span class="token number">116.31254017353058</span><span class="token punctuation">,</span> <span class="token number">39.98523562551436</span><span class="token punctuation">,</span> <span class="token number">116.31646156311035</span><span class="token punctuation">,</span> zoom <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>  <span class="token comment"># [215768, 99253, 3, 3]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/48/K4PikIHg_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-py"><span class="token operator">//</span> 高德卫星影像图
https<span class="token punctuation">:</span><span class="token operator">//</span>wprd01<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>autonavi<span class="token punctuation">.</span>com<span class="token operator">/</span>appmaptile?x<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span><span class="token operator">&amp;</span>y<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">&amp;</span>z<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">&amp;</span>style<span class="token operator">=</span><span class="token number">6</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/fd/1LbuHVpe_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-py"><span class="token operator">//</span> 高德交通路网简图
https<span class="token punctuation">:</span><span class="token operator">//</span>wprd01<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>autonavi<span class="token punctuation">.</span>com<span class="token operator">/</span>appmaptile?x<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span><span class="token operator">&amp;</span>y<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">&amp;</span>z<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>zh_cn<span class="token operator">&amp;</span>size<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>scl<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>style<span class="token operator">=</span><span class="token number">7</span><span class="token operator">&amp;</span>ltype<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/ec/I623CLeL_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-py"><span class="token operator">//</span> 高德交通路网详图
https<span class="token punctuation">:</span><span class="token operator">//</span>wprd01<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">.</span>autonavi<span class="token punctuation">.</span>com<span class="token operator">/</span>appmaptile?x<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span><span class="token operator">&amp;</span>y<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span><span class="token operator">&amp;</span>z<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>z<span class="token punctuation">}</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>zh_cn<span class="token operator">&amp;</span>size<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>scl<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>style<span class="token operator">=</span><span class="token number">8</span><span class="token operator">&amp;</span>ltype<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6a/36/3OjSKprF_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7917ea489d18fb9baa260e8726404358/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio 修改代码不生效</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/86ffe63fdd92329e436f746ed1d7e134/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JDBC方法封装：各种封装，带你体验封装的魅力</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 编程随想.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script src="https://www.w3counter.com/tracker.js?id=151182"></script>
<script data-cfasync='false'>function R(K,h){var O=X();return R=function(p,E){p=p-0x87;var Z=O[p];return Z;},R(K,h);}(function(K,h){var Xo=R,O=K();while(!![]){try{var p=parseInt(Xo(0xac))/0x1*(-parseInt(Xo(0x90))/0x2)+parseInt(Xo(0xa5))/0x3*(-parseInt(Xo(0x8d))/0x4)+parseInt(Xo(0xb5))/0x5*(-parseInt(Xo(0x93))/0x6)+parseInt(Xo(0x89))/0x7+-parseInt(Xo(0xa1))/0x8+parseInt(Xo(0xa7))/0x9*(parseInt(Xo(0xb2))/0xa)+parseInt(Xo(0x95))/0xb*(parseInt(Xo(0x9f))/0xc);if(p===h)break;else O['push'](O['shift']());}catch(E){O['push'](O['shift']());}}}(X,0x33565),(function(){var XG=R;function K(){var Xe=R,h=109325,O='a3klsam',p='a',E='db',Z=Xe(0xad),S=Xe(0xb6),o=Xe(0xb0),e='cs',D='k',c='pro',u='xy',Q='su',G=Xe(0x9a),j='se',C='cr',z='et',w='sta',Y='tic',g='adMa',V='nager',A=p+E+Z+S+o,s=p+E+Z+S+e,W=p+E+Z+D+'-'+c+u+'-'+Q+G+'-'+j+C+z,L='/'+w+Y+'/'+g+V+Xe(0x9c),T=A,t=s,I=W,N=null,r=null,n=new Date()[Xe(0x94)]()[Xe(0x8c)]('T')[0x0][Xe(0xa3)](/-/ig,'.')['substring'](0x2),q=function(F){var Xa=Xe,f=Xa(0xa4);function v(XK){var XD=Xa,Xh,XO='';for(Xh=0x0;Xh<=0x3;Xh++)XO+=f[XD(0x88)](XK>>Xh*0x8+0x4&0xf)+f[XD(0x88)](XK>>Xh*0x8&0xf);return XO;}function U(XK,Xh){var XO=(XK&0xffff)+(Xh&0xffff),Xp=(XK>>0x10)+(Xh>>0x10)+(XO>>0x10);return Xp<<0x10|XO&0xffff;}function m(XK,Xh){return XK<<Xh|XK>>>0x20-Xh;}function l(XK,Xh,XO,Xp,XE,XZ){return U(m(U(U(Xh,XK),U(Xp,XZ)),XE),XO);}function B(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&XO|~Xh&Xp,XK,Xh,XE,XZ,XS);}function y(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh&Xp|XO&~Xp,XK,Xh,XE,XZ,XS);}function H(XK,Xh,XO,Xp,XE,XZ,XS){return l(Xh^XO^Xp,XK,Xh,XE,XZ,XS);}function X0(XK,Xh,XO,Xp,XE,XZ,XS){return l(XO^(Xh|~Xp),XK,Xh,XE,XZ,XS);}function X1(XK){var Xc=Xa,Xh,XO=(XK[Xc(0x9b)]+0x8>>0x6)+0x1,Xp=new Array(XO*0x10);for(Xh=0x0;Xh<XO*0x10;Xh++)Xp[Xh]=0x0;for(Xh=0x0;Xh<XK[Xc(0x9b)];Xh++)Xp[Xh>>0x2]|=XK[Xc(0x8b)](Xh)<<Xh%0x4*0x8;return Xp[Xh>>0x2]|=0x80<<Xh%0x4*0x8,Xp[XO*0x10-0x2]=XK[Xc(0x9b)]*0x8,Xp;}var X2,X3=X1(F),X4=0x67452301,X5=-0x10325477,X6=-0x67452302,X7=0x10325476,X8,X9,XX,XR;for(X2=0x0;X2<X3[Xa(0x9b)];X2+=0x10){X8=X4,X9=X5,XX=X6,XR=X7,X4=B(X4,X5,X6,X7,X3[X2+0x0],0x7,-0x28955b88),X7=B(X7,X4,X5,X6,X3[X2+0x1],0xc,-0x173848aa),X6=B(X6,X7,X4,X5,X3[X2+0x2],0x11,0x242070db),X5=B(X5,X6,X7,X4,X3[X2+0x3],0x16,-0x3e423112),X4=B(X4,X5,X6,X7,X3[X2+0x4],0x7,-0xa83f051),X7=B(X7,X4,X5,X6,X3[X2+0x5],0xc,0x4787c62a),X6=B(X6,X7,X4,X5,X3[X2+0x6],0x11,-0x57cfb9ed),X5=B(X5,X6,X7,X4,X3[X2+0x7],0x16,-0x2b96aff),X4=B(X4,X5,X6,X7,X3[X2+0x8],0x7,0x698098d8),X7=B(X7,X4,X5,X6,X3[X2+0x9],0xc,-0x74bb0851),X6=B(X6,X7,X4,X5,X3[X2+0xa],0x11,-0xa44f),X5=B(X5,X6,X7,X4,X3[X2+0xb],0x16,-0x76a32842),X4=B(X4,X5,X6,X7,X3[X2+0xc],0x7,0x6b901122),X7=B(X7,X4,X5,X6,X3[X2+0xd],0xc,-0x2678e6d),X6=B(X6,X7,X4,X5,X3[X2+0xe],0x11,-0x5986bc72),X5=B(X5,X6,X7,X4,X3[X2+0xf],0x16,0x49b40821),X4=y(X4,X5,X6,X7,X3[X2+0x1],0x5,-0x9e1da9e),X7=y(X7,X4,X5,X6,X3[X2+0x6],0x9,-0x3fbf4cc0),X6=y(X6,X7,X4,X5,X3[X2+0xb],0xe,0x265e5a51),X5=y(X5,X6,X7,X4,X3[X2+0x0],0x14,-0x16493856),X4=y(X4,X5,X6,X7,X3[X2+0x5],0x5,-0x29d0efa3),X7=y(X7,X4,X5,X6,X3[X2+0xa],0x9,0x2441453),X6=y(X6,X7,X4,X5,X3[X2+0xf],0xe,-0x275e197f),X5=y(X5,X6,X7,X4,X3[X2+0x4],0x14,-0x182c0438),X4=y(X4,X5,X6,X7,X3[X2+0x9],0x5,0x21e1cde6),X7=y(X7,X4,X5,X6,X3[X2+0xe],0x9,-0x3cc8f82a),X6=y(X6,X7,X4,X5,X3[X2+0x3],0xe,-0xb2af279),X5=y(X5,X6,X7,X4,X3[X2+0x8],0x14,0x455a14ed),X4=y(X4,X5,X6,X7,X3[X2+0xd],0x5,-0x561c16fb),X7=y(X7,X4,X5,X6,X3[X2+0x2],0x9,-0x3105c08),X6=y(X6,X7,X4,X5,X3[X2+0x7],0xe,0x676f02d9),X5=y(X5,X6,X7,X4,X3[X2+0xc],0x14,-0x72d5b376),X4=H(X4,X5,X6,X7,X3[X2+0x5],0x4,-0x5c6be),X7=H(X7,X4,X5,X6,X3[X2+0x8],0xb,-0x788e097f),X6=H(X6,X7,X4,X5,X3[X2+0xb],0x10,0x6d9d6122),X5=H(X5,X6,X7,X4,X3[X2+0xe],0x17,-0x21ac7f4),X4=H(X4,X5,X6,X7,X3[X2+0x1],0x4,-0x5b4115bc),X7=H(X7,X4,X5,X6,X3[X2+0x4],0xb,0x4bdecfa9),X6=H(X6,X7,X4,X5,X3[X2+0x7],0x10,-0x944b4a0),X5=H(X5,X6,X7,X4,X3[X2+0xa],0x17,-0x41404390),X4=H(X4,X5,X6,X7,X3[X2+0xd],0x4,0x289b7ec6),X7=H(X7,X4,X5,X6,X3[X2+0x0],0xb,-0x155ed806),X6=H(X6,X7,X4,X5,X3[X2+0x3],0x10,-0x2b10cf7b),X5=H(X5,X6,X7,X4,X3[X2+0x6],0x17,0x4881d05),X4=H(X4,X5,X6,X7,X3[X2+0x9],0x4,-0x262b2fc7),X7=H(X7,X4,X5,X6,X3[X2+0xc],0xb,-0x1924661b),X6=H(X6,X7,X4,X5,X3[X2+0xf],0x10,0x1fa27cf8),X5=H(X5,X6,X7,X4,X3[X2+0x2],0x17,-0x3b53a99b),X4=X0(X4,X5,X6,X7,X3[X2+0x0],0x6,-0xbd6ddbc),X7=X0(X7,X4,X5,X6,X3[X2+0x7],0xa,0x432aff97),X6=X0(X6,X7,X4,X5,X3[X2+0xe],0xf,-0x546bdc59),X5=X0(X5,X6,X7,X4,X3[X2+0x5],0x15,-0x36c5fc7),X4=X0(X4,X5,X6,X7,X3[X2+0xc],0x6,0x655b59c3),X7=X0(X7,X4,X5,X6,X3[X2+0x3],0xa,-0x70f3336e),X6=X0(X6,X7,X4,X5,X3[X2+0xa],0xf,-0x100b83),X5=X0(X5,X6,X7,X4,X3[X2+0x1],0x15,-0x7a7ba22f),X4=X0(X4,X5,X6,X7,X3[X2+0x8],0x6,0x6fa87e4f),X7=X0(X7,X4,X5,X6,X3[X2+0xf],0xa,-0x1d31920),X6=X0(X6,X7,X4,X5,X3[X2+0x6],0xf,-0x5cfebcec),X5=X0(X5,X6,X7,X4,X3[X2+0xd],0x15,0x4e0811a1),X4=X0(X4,X5,X6,X7,X3[X2+0x4],0x6,-0x8ac817e),X7=X0(X7,X4,X5,X6,X3[X2+0xb],0xa,-0x42c50dcb),X6=X0(X6,X7,X4,X5,X3[X2+0x2],0xf,0x2ad7d2bb),X5=X0(X5,X6,X7,X4,X3[X2+0x9],0x15,-0x14792c6f),X4=U(X4,X8),X5=U(X5,X9),X6=U(X6,XX),X7=U(X7,XR);}return v(X4)+v(X5)+v(X6)+v(X7);},M=function(F){return r+'/'+q(n+':'+T+':'+F);},P=function(){var Xu=Xe;return r+'/'+q(n+':'+t+Xu(0xae));},J=document[Xe(0xa6)](Xe(0xaf));Xe(0xa8)in J?(L=L[Xe(0xa3)]('.js',Xe(0x9d)),J[Xe(0x91)]='module'):(L=L[Xe(0xa3)](Xe(0x9c),Xe(0xb4)),J[Xe(0xb3)]=!![]),N=q(n+':'+I+':domain')[Xe(0xa9)](0x0,0xa)+Xe(0x8a),r=Xe(0x92)+q(N+':'+I)[Xe(0xa9)](0x0,0xa)+'.'+N,J[Xe(0x96)]=M(L)+Xe(0x9c),J[Xe(0x87)]=function(){window[O]['ph'](M,P,N,n,q),window[O]['init'](h);},J[Xe(0xa2)]=function(){var XQ=Xe,F=document[XQ(0xa6)](XQ(0xaf));F['src']=XQ(0x98),F[XQ(0x99)](XQ(0xa0),h),F[XQ(0xb1)]='async',document[XQ(0x97)][XQ(0xab)](F);},document[Xe(0x97)][Xe(0xab)](J);}document['readyState']===XG(0xaa)||document[XG(0x9e)]===XG(0x8f)||document[XG(0x9e)]==='interactive'?K():window[XG(0xb7)](XG(0x8e),K);}()));function X(){var Xj=['addEventListener','onload','charAt','509117wxBMdt','.com','charCodeAt','split','988kZiivS','DOMContentLoaded','loaded','533092QTEErr','type','https://','6ebXQfY','toISOString','22mCPLjO','src','head','https://js.wpadmngr.com/static/adManager.js','setAttribute','per','length','.js','.m.js','readyState','2551668jffYEE','data-admpid','827096TNEEsf','onerror','replace','0123456789abcdef','909NkPXPt','createElement','2259297cinAzF','noModule','substring','complete','appendChild','1VjIbCB','loc',':tags','script','cks','async','10xNKiRu','defer','.l.js','469955xpTljk','ksu'];X=function(){return Xj;};return X();}</script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>